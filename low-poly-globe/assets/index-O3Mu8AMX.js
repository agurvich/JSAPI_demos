function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/IdentityManager-Cat8B4ml.js","assets/substitute-DRwF0VOB.js","assets/layersCreator-BH7lXUdS.js","assets/portalLayers-lCPM5pHW.js","assets/requestPresets-piqToxCR.js","assets/arcgisLayers-L3R0nDq5.js","assets/fetchService-oBOnmIbI.js","assets/statsWorker-DGhrTPTg.js","assets/utils-6vCjTrDF.js","assets/utils-Bi1l44LZ.js","assets/utils-CTIKZLAs.js","assets/ClassBreaksDefinition-DUnLJxly.js","assets/geometryEngineWorker-B7j3hlk7.js","assets/geometryEngineJSON-CtI8zAu5.js","assets/geometryEngineBase-Bc2ESXYb.js","assets/json-Wa8cmqdu.js","assets/CSVSourceWorker-COkaUuy_.js","assets/date-M6n_RqpC.js","assets/FeatureStore-CgyuIkqo.js","assets/BoundsStore-Crj31uaQ.js","assets/PooledRBush-BaGLuwa_.js","assets/quickselect-GuQm3B0S.js","assets/QueryEngine-PNZsNToZ.js","assets/WhereClause-CCygtHvR.js","assets/TimeOnly-B4e_dNOM.js","assets/QueryEngineCapabilities-CTDe3LlQ.js","assets/optimizedFeatureQueryEngineAdapter-C_PmEkYY.js","assets/number-BoLL6M1j.js","assets/clientSideDefaults-CLavYq3M.js","assets/ElevationSamplerWorker-DvmMRhvj.js","assets/FeatureServiceSnappingSourceWorker-CYbcLhwl.js","assets/symbologySnappingCandidates-BOmjhpOx.js","assets/GeoJSONSourceWorker-Dahj6xJw.js","assets/geojson-BUMepOzW.js","assets/sourceUtils-DogzJRQs.js","assets/MemorySourceWorker-Bk2igzXP.js","assets/objectIdUtils-4dd1rf9p.js","assets/FeaturePipelineWorker-vNMr227f.js","assets/TurboLine-BrdgF8kE.js","assets/constants-D5zmR9t2.js","assets/Rect-BAnET0xx.js","assets/geohashUtils-C_3HRT1v.js","assets/ogcFeatureUtils-4GU6b452.js","assets/StreamFeatureManager-DUho6iCE.js","assets/createConnection-DsveC4SD.js","assets/PointCloudWorker-k5FV1sls.js","assets/PointCloudWorkerUtil-DKUFJQeC.js","assets/PointCloudUniqueValueRenderer-Dx404rkH.js","assets/RasterWorker-Bn5Bz5Cu.js","assets/dataUtils-CAsOYGqe.js","assets/utils-BcSQrsOO.js","assets/rasterProjectionHelper-D27sav7o.js","assets/SceneLayerWorker-BvHNKtwN.js","assets/I3SNode-DbZPljN8.js","assets/WFSSourceWorker-c6MgkwXn.js","assets/wfsUtils-Dn-cd1Yz.js","assets/xmlUtils-CtUoQO7q.js","assets/WorkerTileHandler-CWJUz11B.js","assets/StyleRepository-C-3lsPNi.js","assets/Lyr3DWorker-B8MMZ_Qj.js","assets/ILyr3DWasmPerSceneView-vPx4somd.js","assets/Lyr3DModule-DnUN9v-U.js","assets/Popup-CsWJrj0c.js","assets/unitFormatUtils-BBi1KHyb.js","assets/AttachmentInfo-dVP1kpde.js","assets/TopFeaturesQuery-CA3pufQA.js","assets/FeatureLayer-BJkvQ9Vd.js","assets/FormTemplate-CP6JI4Hs.js","assets/editsZScale-yp68Mlru.js","assets/FeatureEffectLayer-DhrENgLp.js","assets/FeatureEffect-CEEtHmXX.js","assets/FeatureFilter-8HG2xPNt.js","assets/FeatureLayerBase-Dh_ZsCRO.js","assets/FeatureReductionLayer-CFnTbrdk.js","assets/OrderedLayer-CWnAb55f.js","assets/TemporalLayer-DaU3mkeG.js","assets/versionUtils-nYA_KIDG.js","assets/interfaces-CL2NbQte.js","assets/ReactiveSet-mpVyzPdI.js","assets/arcadeUtils-BhCpkzPt.js","assets/ImmutableArray-BlMso3qf.js","assets/hash-CcEbRgUF.js","assets/TileLayerView3D-Cuoj_acH.js","assets/LayerView3D-C8CJtSha.js","assets/TiledLayerView3D-CSCjls0y.js","assets/LayerView-CrtEiCUZ.js","assets/RefreshableLayerView-Dqm9uAqk.js","assets/MapServiceLayerViewHelper-CMAi7SgE.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/drapedUtils-B3G6l4MZ.js","assets/ElevationLayerView3D-Byc7DiTi.js","assets/BaseDynamicLayerView3D-C6ousWPY.js","assets/DynamicLayerView3D-DiB0NPft.js","assets/projectExtentUtils-Cx8opmom.js","assets/ImageMaterial.glsl-DtyynWhH.js","assets/BuildingSceneLayerView3D-CYVqfQJG.js","assets/BuildingGroupSublayer-BAdiRpq-.js","assets/BuildingComponentSublayer-IWbU1GdZ.js","assets/I3SMeshView3D-CQC7DeYp.js","assets/LayerElevationProvider-CNF2x0ou.js","assets/RenderTexture-kpEXCKT4.js","assets/I3SOverrides-BwHqqer6.js","assets/meshFeatureSet-JwziPvP2.js","assets/FeatureLayerView3D-B3Pq8C8n.js","assets/FeatureLayerViewBase3D-DvvCzP55.js","assets/HeatmapDensity.glsl-PRIs8u-N.js","assets/dehydratedFeatureComparison-BTRf2zT_.js","assets/queryForSymbologySnapping-jW6c9TNU.js","assets/Graphics3DObjectStates-Blwq2kzC.js","assets/EventedSet-C3rACCqm.js","assets/SceneModification-BxpluCXk.js","assets/I3SQueryFeatureStore-DiRdJfAZ.js","assets/TemporalSceneLayerView-c3MaBUkz.js","assets/CSVLayerView3D-BO7zTaHF.js","assets/DimensionLayerView3D-BqE3VcNn.js","assets/GeoJSONLayerView3D-BHn35LDG.js","assets/GraphicsLayerView3D-B3BtgfG1.js","assets/GraphicsProcessor-lx_8MRlu.js","assets/GroupLayerView-8FTgp5nh.js","assets/ImageryLayerView3D-DGw2hUfu.js","assets/IntegratedMeshLayerView3D-DwdLHlBx.js","assets/IntegratedMesh3DTilesLayerView3D-cQ0lWynC.js","assets/LineOfSightLayerView3D-BOoyqcV_.js","assets/MapImageLayerView3D-BWFF9hx0.js","assets/ExportImageParameters-DRmDrTtr.js","assets/MediaLayerView3D-DywLOphR.js","assets/MediaElementView-D_qJQ8P8.js","assets/normalizeUtilsSync-DKtSpvBI.js","assets/OGCFeatureLayerView3D-Bi9oWcUK.js","assets/PointCloudLayerView3D-CzYyKux8.js","assets/PopupSceneLayerView-CBXaGbfX.js","assets/VoxelLayerView3D-VAK_WjGf.js","assets/RouteLayerView3D-Di3KC2Vj.js","assets/Stop-Dzn03Q0U.js","assets/SceneLayerView3D-CLR1nuY1.js","assets/SceneLayerView-DAR8JmtA.js","assets/SceneLayerGraphicsView3D-CO5MdUX0.js","assets/StreamLayerView3D-BeQ_NWIm.js","assets/ImageryTileLayerView3D-B9Bdx6Q8.js","assets/VectorTileLayerView3D-BtKhFpsN.js","assets/vec4f32-CjrfB-0a.js","assets/WFSLayerView3D-CDjNjXYk.js","assets/WMSLayerView3D-OH3OJvS9.js","assets/ExportWMSImageParameters-DMb178ie.js","assets/WMTSLayerView3D-K3fA-7xr.js","assets/AreaMeasurementAnalysisView3D-Dv1Q6qhQ.js","assets/UnitNormalizer-BuZSFh4r.js","assets/Segment-B4LcIN-4.js","assets/LineVisualElement-CFA_yiN0.js","assets/geometryEngine-5DT1_oN4.js","assets/hydrated-rTNDlpsd.js","assets/EditGeometryOperations-CKPFXjtW.js","assets/DimensionAnalysisView3D-B9qmUWKj.js","assets/LengthDimension-BTCughYw.js","assets/RightAngleQuadVisualElement-oczsdHEs.js","assets/ShadedColorMaterial.glsl-0E4beRx6.js","assets/ToolIntersector-C9oa6zms.js","assets/Laserlines.glsl-BBfuLAaJ.js","assets/DirectLineMeasurementAnalysisView3D-CAfnQAKl.js","assets/LineOfSightAnalysisView3D-CiBwBwIs.js","assets/LineOfSightAnalysisTarget-BLTmsVY6.js","assets/SliceAnalysisView3D-Cq_uKhUj.js","assets/TerrainTileTree3DDebugger-Y8opW-sa.js","assets/TileTreeDebugger-BqlyCKHO.js","assets/Lyr3DWasmPerSceneView-CgUgWeHI.js","assets/calcite-button-DFNuuqus.js","assets/form-BzjxZ_PX.js","assets/dom-DPjEIMvi.js","assets/guid-Cgw_FQNn.js","assets/interactive-BcRzWxx5.js","assets/label2-W-YothA6.js","assets/component-CiBiWYk6.js","assets/loadable-CEU-mf6j.js","assets/t9n-BTKC7-ic.js","assets/observers-CaC5ED4P.js","assets/icon-DIF6Jxx0.js","assets/loader-DnVoLA6a.js","assets/calcite-icon-BtuxP3ni.js","assets/FeatureTileTree3DDebugger-BtySMpTq.js","assets/GraphicsView3D-BpEXIK9r.js","assets/layersLoader-Bu9k60dp.js","assets/BuildingSceneLayer-x_p83xB6.js","assets/CatalogLayer-Cd4B-HyY.js","assets/FeatureLayerSource-s-oykCP4.js","assets/editingSupport-C0lgLa5s.js","assets/CSVLayer-CztgOj-p.js","assets/DimensionLayer-AsV_oWuN.js","assets/Analysis-CsUM4AiC.js","assets/GeoJSONLayer-Dq_iLWOv.js","assets/GroupLayer-BGDRiZZ9.js","assets/ImageryLayer-BNiniZAz.js","assets/ImageHistogramParameters-BbY4Ja67.js","assets/ImageryTileLayer-BhHrsl2W.js","assets/IntegratedMeshLayer-BktgOJkP.js","assets/LineOfSightLayer-0muamk8-.js","assets/LinkChartLayer-D-y3OjFZ.js","assets/knowledgeGraphService-S6bxN5gy.js","assets/GraphQueryStreaming-BrxDxV98.js","assets/MapImageLayer-CpKTmmNI.js","assets/MapNotesLayer-SwRLZXf-.js","assets/MediaLayer-eaGJnh46.js","assets/OGCFeatureLayer-DFzp3TZH.js","assets/OpenStreetMapLayer-DScBxiJ6.js","assets/WebTileLayer-CJYKCic5.js","assets/OrientedImageryLayer-Bsc4K44R.js","assets/PointCloudLayer-CFTMPKbK.js","assets/RouteLayer-BAgvzG7s.js","assets/StreamLayer-lyTNH85v.js","assets/SubtypeGroupLayer-D9K4mpr6.js","assets/VectorTileLayer-O_ZxrkIG.js","assets/WFSLayer-D4wBiAPv.js","assets/WMSLayer-Di7wfc1x.js","assets/crsUtils-DAndLU68.js","assets/WMTSLayer-B3-JbwgU.js","assets/queryAttachments-CGdvzYF0.js","assets/executeTopFeaturesQuery-B-tBWowl.js","assets/queryTopFeatures-DatbXpnA.js","assets/executeForTopIds-wo3gc7pQ.js","assets/executeForTopExtents-CzTqjb8A.js","assets/executeForTopCount-BDxXnqce.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();var Gue={},h2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Gue<"u"?Gue:typeof self<"u"?self:{};function uie(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function I7e(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}),r}var uTe={exports:{}},$V={},hTe={exports:{}},yi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jD=Symbol.for("react.element"),L7e=Symbol.for("react.portal"),D7e=Symbol.for("react.fragment"),N7e=Symbol.for("react.strict_mode"),F7e=Symbol.for("react.profiler"),k7e=Symbol.for("react.provider"),U7e=Symbol.for("react.context"),z7e=Symbol.for("react.forward_ref"),V7e=Symbol.for("react.suspense"),B7e=Symbol.for("react.memo"),G7e=Symbol.for("react.lazy"),jue=Symbol.iterator;function j7e(t){return t===null||typeof t!="object"?null:(t=jue&&t[jue]||t["@@iterator"],typeof t=="function"?t:null)}var dTe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},pTe=Object.assign,fTe={};function IA(t,e,r){this.props=t,this.context=e,this.refs=fTe,this.updater=r||dTe}IA.prototype.isReactComponent={};IA.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};IA.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function mTe(){}mTe.prototype=IA.prototype;function hie(t,e,r){this.props=t,this.context=e,this.refs=fTe,this.updater=r||dTe}var die=hie.prototype=new mTe;die.constructor=hie;pTe(die,IA.prototype);die.isPureReactComponent=!0;var Hue=Array.isArray,gTe=Object.prototype.hasOwnProperty,pie={current:null},yTe={key:!0,ref:!0,__self:!0,__source:!0};function _Te(t,e,r){var i,n={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)gTe.call(e,i)&&!yTe.hasOwnProperty(i)&&(n[i]=e[i]);var a=arguments.length-2;if(a===1)n.children=r;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];n.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)n[i]===void 0&&(n[i]=a[i]);return{$$typeof:jD,type:t,key:s,ref:o,props:n,_owner:pie.current}}function H7e(t,e){return{$$typeof:jD,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function fie(t){return typeof t=="object"&&t!==null&&t.$$typeof===jD}function q7e(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var que=/\/+/g;function JG(t,e){return typeof t=="object"&&t!==null&&t.key!=null?q7e(""+t.key):e.toString(36)}function zk(t,e,r,i,n){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case jD:case L7e:o=!0}}if(o)return o=t,n=n(o),t=i===""?"."+JG(o,0):i,Hue(n)?(r="",t!=null&&(r=t.replace(que,"$&/")+"/"),zk(n,e,r,"",function(c){return c})):n!=null&&(fie(n)&&(n=H7e(n,r+(!n.key||o&&o.key===n.key?"":(""+n.key).replace(que,"$&/")+"/")+t)),e.push(n)),1;if(o=0,i=i===""?".":i+":",Hue(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+JG(s,a);o+=zk(s,e,r,l,n)}else if(l=j7e(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+JG(s,a++),o+=zk(s,e,r,l,n);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function c4(t,e,r){if(t==null)return t;var i=[],n=0;return zk(t,i,"","",function(s){return e.call(r,s,n++)}),i}function W7e(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Vc={current:null},Vk={transition:null},Y7e={ReactCurrentDispatcher:Vc,ReactCurrentBatchConfig:Vk,ReactCurrentOwner:pie};yi.Children={map:c4,forEach:function(t,e,r){c4(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return c4(t,function(){e++}),e},toArray:function(t){return c4(t,function(e){return e})||[]},only:function(t){if(!fie(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};yi.Component=IA;yi.Fragment=D7e;yi.Profiler=F7e;yi.PureComponent=hie;yi.StrictMode=N7e;yi.Suspense=V7e;yi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Y7e;yi.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=pTe({},t.props),n=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=pie.current),e.key!==void 0&&(n=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)gTe.call(e,l)&&!yTe.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=r;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:jD,type:t.type,key:n,ref:s,props:i,_owner:o}};yi.createContext=function(t){return t={$$typeof:U7e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:k7e,_context:t},t.Consumer=t};yi.createElement=_Te;yi.createFactory=function(t){var e=_Te.bind(null,t);return e.type=t,e};yi.createRef=function(){return{current:null}};yi.forwardRef=function(t){return{$$typeof:z7e,render:t}};yi.isValidElement=fie;yi.lazy=function(t){return{$$typeof:G7e,_payload:{_status:-1,_result:t},_init:W7e}};yi.memo=function(t,e){return{$$typeof:B7e,type:t,compare:e===void 0?null:e}};yi.startTransition=function(t){var e=Vk.transition;Vk.transition={};try{t()}finally{Vk.transition=e}};yi.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};yi.useCallback=function(t,e){return Vc.current.useCallback(t,e)};yi.useContext=function(t){return Vc.current.useContext(t)};yi.useDebugValue=function(){};yi.useDeferredValue=function(t){return Vc.current.useDeferredValue(t)};yi.useEffect=function(t,e){return Vc.current.useEffect(t,e)};yi.useId=function(){return Vc.current.useId()};yi.useImperativeHandle=function(t,e,r){return Vc.current.useImperativeHandle(t,e,r)};yi.useInsertionEffect=function(t,e){return Vc.current.useInsertionEffect(t,e)};yi.useLayoutEffect=function(t,e){return Vc.current.useLayoutEffect(t,e)};yi.useMemo=function(t,e){return Vc.current.useMemo(t,e)};yi.useReducer=function(t,e,r){return Vc.current.useReducer(t,e,r)};yi.useRef=function(t){return Vc.current.useRef(t)};yi.useState=function(t){return Vc.current.useState(t)};yi.useSyncExternalStore=function(t,e,r){return Vc.current.useSyncExternalStore(t,e,r)};yi.useTransition=function(){return Vc.current.useTransition()};yi.version="18.2.0";hTe.exports=yi;var $n=hTe.exports;const pL=uie($n);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X7e=$n,Z7e=Symbol.for("react.element"),J7e=Symbol.for("react.fragment"),Q7e=Object.prototype.hasOwnProperty,K7e=X7e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,eGe={key:!0,ref:!0,__self:!0,__source:!0};function vTe(t,e,r){var i,n={},s=null,o=null;r!==void 0&&(s=""+r),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)Q7e.call(e,i)&&!eGe.hasOwnProperty(i)&&(n[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)n[i]===void 0&&(n[i]=e[i]);return{$$typeof:Z7e,type:t,key:s,ref:o,props:n,_owner:K7e.current}}$V.Fragment=J7e;$V.jsx=vTe;$V.jsxs=vTe;uTe.exports=$V;var Su=uTe.exports,JY={},bTe={exports:{}},Yh={},wTe={exports:{}},xTe={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(I,k){var j=I.length;I.push(k);e:for(;0<j;){var q=j-1>>>1,Q=I[q];if(0<n(Q,k))I[q]=k,I[j]=Q,j=q;else break e}}function r(I){return I.length===0?null:I[0]}function i(I){if(I.length===0)return null;var k=I[0],j=I.pop();if(j!==k){I[0]=j;e:for(var q=0,Q=I.length,ie=Q>>>1;q<ie;){var ye=2*(q+1)-1,Ae=I[ye],Ze=ye+1,Et=I[Ze];if(0>n(Ae,j))Ze<Q&&0>n(Et,Ae)?(I[q]=Et,I[Ze]=j,q=Ze):(I[q]=Ae,I[ye]=j,q=ye);else if(Ze<Q&&0>n(Et,j))I[q]=Et,I[Ze]=j,q=Ze;else break e}}return k}function n(I,k){var j=I.sortIndex-k.sortIndex;return j!==0?j:I.id-k.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,p=3,f=!1,g=!1,y=!1,v=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(I){for(var k=r(c);k!==null;){if(k.callback===null)i(c);else if(k.startTime<=I)i(c),k.sortIndex=k.expirationTime,e(l,k);else break;k=r(c)}}function S(I){if(y=!1,x(I),!g)if(r(l)!==null)g=!0,le(E);else{var k=r(c);k!==null&&D(S,k.startTime-I)}}function E(I,k){g=!1,y&&(y=!1,b(L),L=-1),f=!0;var j=p;try{for(x(k),h=r(l);h!==null&&(!(h.expirationTime>k)||I&&!W());){var q=h.callback;if(typeof q=="function"){h.callback=null,p=h.priorityLevel;var Q=q(h.expirationTime<=k);k=t.unstable_now(),typeof Q=="function"?h.callback=Q:h===r(l)&&i(l),x(k)}else i(l);h=r(l)}if(h!==null)var ie=!0;else{var ye=r(c);ye!==null&&D(S,ye.startTime-k),ie=!1}return ie}finally{h=null,p=j,f=!1}}var P=!1,M=null,L=-1,U=5,z=-1;function W(){return!(t.unstable_now()-z<U)}function V(){if(M!==null){var I=t.unstable_now();z=I;var k=!0;try{k=M(!0,I)}finally{k?J():(P=!1,M=null)}}else P=!1}var J;if(typeof w=="function")J=function(){w(V)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,X=Y.port2;Y.port1.onmessage=V,J=function(){X.postMessage(null)}}else J=function(){v(V,0)};function le(I){M=I,P||(P=!0,J())}function D(I,k){L=v(function(){I(t.unstable_now())},k)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(I){I.callback=null},t.unstable_continueExecution=function(){g||f||(g=!0,le(E))},t.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<I?Math.floor(1e3/I):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(I){switch(p){case 1:case 2:case 3:var k=3;break;default:k=p}var j=p;p=k;try{return I()}finally{p=j}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(I,k){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var j=p;p=I;try{return k()}finally{p=j}},t.unstable_scheduleCallback=function(I,k,j){var q=t.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?q+j:q):j=q,I){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=j+Q,I={id:u++,callback:k,priorityLevel:I,startTime:j,expirationTime:Q,sortIndex:-1},j>q?(I.sortIndex=j,e(c,I),r(l)===null&&I===r(c)&&(y?(b(L),L=-1):y=!0,D(S,j-q))):(I.sortIndex=Q,e(l,I),g||f||(g=!0,le(E))),I},t.unstable_shouldYield=W,t.unstable_wrapCallback=function(I){var k=p;return function(){var j=p;p=k;try{return I.apply(this,arguments)}finally{p=j}}}})(xTe);wTe.exports=xTe;var tGe=wTe.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var STe=$n,Gh=tGe;function ke(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var TTe=new Set,fL={};function d2(t,e){_P(t,e),_P(t+"Capture",e)}function _P(t,e){for(fL[t]=e,t=0;t<e.length;t++)TTe.add(e[t])}var K0=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),QY=Object.prototype.hasOwnProperty,rGe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Wue={},Yue={};function iGe(t){return QY.call(Yue,t)?!0:QY.call(Wue,t)?!1:rGe.test(t)?Yue[t]=!0:(Wue[t]=!0,!1)}function nGe(t,e,r,i){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function sGe(t,e,r,i){if(e===null||typeof e>"u"||nGe(t,e,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Bc(t,e,r,i,n,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=n,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var cl={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){cl[t]=new Bc(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];cl[e]=new Bc(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){cl[t]=new Bc(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){cl[t]=new Bc(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){cl[t]=new Bc(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){cl[t]=new Bc(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){cl[t]=new Bc(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){cl[t]=new Bc(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){cl[t]=new Bc(t,5,!1,t.toLowerCase(),null,!1,!1)});var mie=/[\-:]([a-z])/g;function gie(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(mie,gie);cl[e]=new Bc(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(mie,gie);cl[e]=new Bc(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(mie,gie);cl[e]=new Bc(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){cl[t]=new Bc(t,1,!1,t.toLowerCase(),null,!1,!1)});cl.xlinkHref=new Bc("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){cl[t]=new Bc(t,1,!1,t.toLowerCase(),null,!0,!0)});function yie(t,e,r,i){var n=cl.hasOwnProperty(e)?cl[e]:null;(n!==null?n.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(sGe(e,r,n,i)&&(r=null),i||n===null?iGe(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):n.mustUseProperty?t[n.propertyName]=r===null?n.type===3?!1:"":r:(e=n.attributeName,i=n.attributeNamespace,r===null?t.removeAttribute(e):(n=n.type,r=n===3||n===4&&r===!0?"":""+r,i?t.setAttributeNS(i,e,r):t.setAttribute(e,r))))}var v_=STe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,u4=Symbol.for("react.element"),UC=Symbol.for("react.portal"),zC=Symbol.for("react.fragment"),_ie=Symbol.for("react.strict_mode"),KY=Symbol.for("react.profiler"),ETe=Symbol.for("react.provider"),CTe=Symbol.for("react.context"),vie=Symbol.for("react.forward_ref"),eX=Symbol.for("react.suspense"),tX=Symbol.for("react.suspense_list"),bie=Symbol.for("react.memo"),cv=Symbol.for("react.lazy"),PTe=Symbol.for("react.offscreen"),Xue=Symbol.iterator;function wO(t){return t===null||typeof t!="object"?null:(t=Xue&&t[Xue]||t["@@iterator"],typeof t=="function"?t:null)}var Ls=Object.assign,QG;function VM(t){if(QG===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);QG=e&&e[1]||""}return`
`+QG+t}var KG=!1;function ej(t,e){if(!t||KG)return"";KG=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var n=c.stack.split(`
`),s=i.stack.split(`
`),o=n.length-1,a=s.length-1;1<=o&&0<=a&&n[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(n[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||n[o]!==s[a]){var l=`
`+n[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{KG=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?VM(t):""}function oGe(t){switch(t.tag){case 5:return VM(t.type);case 16:return VM("Lazy");case 13:return VM("Suspense");case 19:return VM("SuspenseList");case 0:case 2:case 15:return t=ej(t.type,!1),t;case 11:return t=ej(t.type.render,!1),t;case 1:return t=ej(t.type,!0),t;default:return""}}function rX(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case zC:return"Fragment";case UC:return"Portal";case KY:return"Profiler";case _ie:return"StrictMode";case eX:return"Suspense";case tX:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case CTe:return(t.displayName||"Context")+".Consumer";case ETe:return(t._context.displayName||"Context")+".Provider";case vie:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case bie:return e=t.displayName||null,e!==null?e:rX(t.type)||"Memo";case cv:e=t._payload,t=t._init;try{return rX(t(e))}catch{}}return null}function aGe(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return rX(e);case 8:return e===_ie?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function mb(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function ATe(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function lGe(t){var e=ATe(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var n=r.get,s=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return n.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function h4(t){t._valueTracker||(t._valueTracker=lGe(t))}function OTe(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),i="";return t&&(i=ATe(t)?t.checked?"true":"false":t.value),t=i,t!==r?(e.setValue(t),!0):!1}function vU(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function iX(t,e){var r=e.checked;return Ls({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function Zue(t,e){var r=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;r=mb(e.value!=null?e.value:r),t._wrapperState={initialChecked:i,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function MTe(t,e){e=e.checked,e!=null&&yie(t,"checked",e,!1)}function nX(t,e){MTe(t,e);var r=mb(e.value),i=e.type;if(r!=null)i==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?sX(t,e.type,r):e.hasOwnProperty("defaultValue")&&sX(t,e.type,mb(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Jue(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function sX(t,e,r){(e!=="number"||vU(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var BM=Array.isArray;function O3(t,e,r,i){if(t=t.options,e){e={};for(var n=0;n<r.length;n++)e["$"+r[n]]=!0;for(r=0;r<t.length;r++)n=e.hasOwnProperty("$"+t[r].value),t[r].selected!==n&&(t[r].selected=n),n&&i&&(t[r].defaultSelected=!0)}else{for(r=""+mb(r),e=null,n=0;n<t.length;n++){if(t[n].value===r){t[n].selected=!0,i&&(t[n].defaultSelected=!0);return}e!==null||t[n].disabled||(e=t[n])}e!==null&&(e.selected=!0)}}function oX(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ke(91));return Ls({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Que(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(ke(92));if(BM(r)){if(1<r.length)throw Error(ke(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:mb(r)}}function RTe(t,e){var r=mb(e.value),i=mb(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),i!=null&&(t.defaultValue=""+i)}function Kue(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function $Te(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function aX(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?$Te(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var d4,ITe=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,i,n){MSApp.execUnsafeLocalFunction(function(){return t(e,r,i,n)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(d4=d4||document.createElement("div"),d4.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=d4.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function mL(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var eI={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},cGe=["Webkit","ms","Moz","O"];Object.keys(eI).forEach(function(t){cGe.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),eI[e]=eI[t]})});function LTe(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||eI.hasOwnProperty(t)&&eI[t]?(""+e).trim():e+"px"}function DTe(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var i=r.indexOf("--")===0,n=LTe(r,e[r],i);r==="float"&&(r="cssFloat"),i?t.setProperty(r,n):t[r]=n}}var uGe=Ls({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function lX(t,e){if(e){if(uGe[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ke(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ke(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ke(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ke(62))}}function cX(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var uX=null;function wie(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var hX=null,M3=null,R3=null;function ehe(t){if(t=WD(t)){if(typeof hX!="function")throw Error(ke(280));var e=t.stateNode;e&&(e=FV(e),hX(t.stateNode,t.type,e))}}function NTe(t){M3?R3?R3.push(t):R3=[t]:M3=t}function FTe(){if(M3){var t=M3,e=R3;if(R3=M3=null,ehe(t),e)for(t=0;t<e.length;t++)ehe(e[t])}}function kTe(t,e){return t(e)}function UTe(){}var tj=!1;function zTe(t,e,r){if(tj)return t(e,r);tj=!0;try{return kTe(t,e,r)}finally{tj=!1,(M3!==null||R3!==null)&&(UTe(),FTe())}}function gL(t,e){var r=t.stateNode;if(r===null)return null;var i=FV(r);if(i===null)return null;r=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(ke(231,e,typeof r));return r}var dX=!1;if(K0)try{var xO={};Object.defineProperty(xO,"passive",{get:function(){dX=!0}}),window.addEventListener("test",xO,xO),window.removeEventListener("test",xO,xO)}catch{dX=!1}function hGe(t,e,r,i,n,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(r,c)}catch(u){this.onError(u)}}var tI=!1,bU=null,wU=!1,pX=null,dGe={onError:function(t){tI=!0,bU=t}};function pGe(t,e,r,i,n,s,o,a,l){tI=!1,bU=null,hGe.apply(dGe,arguments)}function fGe(t,e,r,i,n,s,o,a,l){if(pGe.apply(this,arguments),tI){if(tI){var c=bU;tI=!1,bU=null}else throw Error(ke(198));wU||(wU=!0,pX=c)}}function p2(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function VTe(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function the(t){if(p2(t)!==t)throw Error(ke(188))}function mGe(t){var e=t.alternate;if(!e){if(e=p2(t),e===null)throw Error(ke(188));return e!==t?null:t}for(var r=t,i=e;;){var n=r.return;if(n===null)break;var s=n.alternate;if(s===null){if(i=n.return,i!==null){r=i;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===r)return the(n),t;if(s===i)return the(n),e;s=s.sibling}throw Error(ke(188))}if(r.return!==i.return)r=n,i=s;else{for(var o=!1,a=n.child;a;){if(a===r){o=!0,r=n,i=s;break}if(a===i){o=!0,i=n,r=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===r){o=!0,r=s,i=n;break}if(a===i){o=!0,i=s,r=n;break}a=a.sibling}if(!o)throw Error(ke(189))}}if(r.alternate!==i)throw Error(ke(190))}if(r.tag!==3)throw Error(ke(188));return r.stateNode.current===r?t:e}function BTe(t){return t=mGe(t),t!==null?GTe(t):null}function GTe(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=GTe(t);if(e!==null)return e;t=t.sibling}return null}var jTe=Gh.unstable_scheduleCallback,rhe=Gh.unstable_cancelCallback,gGe=Gh.unstable_shouldYield,yGe=Gh.unstable_requestPaint,co=Gh.unstable_now,_Ge=Gh.unstable_getCurrentPriorityLevel,xie=Gh.unstable_ImmediatePriority,HTe=Gh.unstable_UserBlockingPriority,xU=Gh.unstable_NormalPriority,vGe=Gh.unstable_LowPriority,qTe=Gh.unstable_IdlePriority,IV=null,Hg=null;function bGe(t){if(Hg&&typeof Hg.onCommitFiberRoot=="function")try{Hg.onCommitFiberRoot(IV,t,void 0,(t.current.flags&128)===128)}catch{}}var qf=Math.clz32?Math.clz32:SGe,wGe=Math.log,xGe=Math.LN2;function SGe(t){return t>>>=0,t===0?32:31-(wGe(t)/xGe|0)|0}var p4=64,f4=4194304;function GM(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function SU(t,e){var r=t.pendingLanes;if(r===0)return 0;var i=0,n=t.suspendedLanes,s=t.pingedLanes,o=r&268435455;if(o!==0){var a=o&~n;a!==0?i=GM(a):(s&=o,s!==0&&(i=GM(s)))}else o=r&~n,o!==0?i=GM(o):s!==0&&(i=GM(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&n)&&(n=i&-i,s=e&-e,n>=s||n===16&&(s&4194240)!==0))return e;if(i&4&&(i|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)r=31-qf(e),n=1<<r,i|=t[r],e&=~n;return i}function TGe(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function EGe(t,e){for(var r=t.suspendedLanes,i=t.pingedLanes,n=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-qf(s),a=1<<o,l=n[o];l===-1?(!(a&r)||a&i)&&(n[o]=TGe(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function fX(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function WTe(){var t=p4;return p4<<=1,!(p4&4194240)&&(p4=64),t}function rj(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function HD(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-qf(e),t[e]=r}function CGe(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<r;){var n=31-qf(r),s=1<<n;e[n]=0,i[n]=-1,t[n]=-1,r&=~s}}function Sie(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var i=31-qf(r),n=1<<i;n&e|t[i]&e&&(t[i]|=e),r&=~n}}var yn=0;function YTe(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var XTe,Tie,ZTe,JTe,QTe,mX=!1,m4=[],Xv=null,Zv=null,Jv=null,yL=new Map,_L=new Map,Sv=[],PGe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ihe(t,e){switch(t){case"focusin":case"focusout":Xv=null;break;case"dragenter":case"dragleave":Zv=null;break;case"mouseover":case"mouseout":Jv=null;break;case"pointerover":case"pointerout":yL.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":_L.delete(e.pointerId)}}function SO(t,e,r,i,n,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:r,eventSystemFlags:i,nativeEvent:s,targetContainers:[n]},e!==null&&(e=WD(e),e!==null&&Tie(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,n!==null&&e.indexOf(n)===-1&&e.push(n),t)}function AGe(t,e,r,i,n){switch(e){case"focusin":return Xv=SO(Xv,t,e,r,i,n),!0;case"dragenter":return Zv=SO(Zv,t,e,r,i,n),!0;case"mouseover":return Jv=SO(Jv,t,e,r,i,n),!0;case"pointerover":var s=n.pointerId;return yL.set(s,SO(yL.get(s)||null,t,e,r,i,n)),!0;case"gotpointercapture":return s=n.pointerId,_L.set(s,SO(_L.get(s)||null,t,e,r,i,n)),!0}return!1}function KTe(t){var e=VS(t.target);if(e!==null){var r=p2(e);if(r!==null){if(e=r.tag,e===13){if(e=VTe(r),e!==null){t.blockedOn=e,QTe(t.priority,function(){ZTe(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Bk(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=gX(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var i=new r.constructor(r.type,r);uX=i,r.target.dispatchEvent(i),uX=null}else return e=WD(r),e!==null&&Tie(e),t.blockedOn=r,!1;e.shift()}return!0}function nhe(t,e,r){Bk(t)&&r.delete(e)}function OGe(){mX=!1,Xv!==null&&Bk(Xv)&&(Xv=null),Zv!==null&&Bk(Zv)&&(Zv=null),Jv!==null&&Bk(Jv)&&(Jv=null),yL.forEach(nhe),_L.forEach(nhe)}function TO(t,e){t.blockedOn===e&&(t.blockedOn=null,mX||(mX=!0,Gh.unstable_scheduleCallback(Gh.unstable_NormalPriority,OGe)))}function vL(t){function e(n){return TO(n,t)}if(0<m4.length){TO(m4[0],t);for(var r=1;r<m4.length;r++){var i=m4[r];i.blockedOn===t&&(i.blockedOn=null)}}for(Xv!==null&&TO(Xv,t),Zv!==null&&TO(Zv,t),Jv!==null&&TO(Jv,t),yL.forEach(e),_L.forEach(e),r=0;r<Sv.length;r++)i=Sv[r],i.blockedOn===t&&(i.blockedOn=null);for(;0<Sv.length&&(r=Sv[0],r.blockedOn===null);)KTe(r),r.blockedOn===null&&Sv.shift()}var $3=v_.ReactCurrentBatchConfig,TU=!0;function MGe(t,e,r,i){var n=yn,s=$3.transition;$3.transition=null;try{yn=1,Eie(t,e,r,i)}finally{yn=n,$3.transition=s}}function RGe(t,e,r,i){var n=yn,s=$3.transition;$3.transition=null;try{yn=4,Eie(t,e,r,i)}finally{yn=n,$3.transition=s}}function Eie(t,e,r,i){if(TU){var n=gX(t,e,r,i);if(n===null)dj(t,e,i,EU,r),ihe(t,i);else if(AGe(n,t,e,r,i))i.stopPropagation();else if(ihe(t,i),e&4&&-1<PGe.indexOf(t)){for(;n!==null;){var s=WD(n);if(s!==null&&XTe(s),s=gX(t,e,r,i),s===null&&dj(t,e,i,EU,r),s===n)break;n=s}n!==null&&i.stopPropagation()}else dj(t,e,i,null,r)}}var EU=null;function gX(t,e,r,i){if(EU=null,t=wie(i),t=VS(t),t!==null)if(e=p2(t),e===null)t=null;else if(r=e.tag,r===13){if(t=VTe(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return EU=t,null}function e2e(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(_Ge()){case xie:return 1;case HTe:return 4;case xU:case vGe:return 16;case qTe:return 536870912;default:return 16}default:return 16}}var Rv=null,Cie=null,Gk=null;function t2e(){if(Gk)return Gk;var t,e=Cie,r=e.length,i,n="value"in Rv?Rv.value:Rv.textContent,s=n.length;for(t=0;t<r&&e[t]===n[t];t++);var o=r-t;for(i=1;i<=o&&e[r-i]===n[s-i];i++);return Gk=n.slice(t,1<i?1-i:void 0)}function jk(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function g4(){return!0}function she(){return!1}function Xh(t){function e(r,i,n,s,o){this._reactName=r,this._targetInst=n,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(r=t[a],this[a]=r?r(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?g4:she,this.isPropagationStopped=she,this}return Ls(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=g4)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=g4)},persist:function(){},isPersistent:g4}),e}var LA={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Pie=Xh(LA),qD=Ls({},LA,{view:0,detail:0}),$Ge=Xh(qD),ij,nj,EO,LV=Ls({},qD,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Aie,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==EO&&(EO&&t.type==="mousemove"?(ij=t.screenX-EO.screenX,nj=t.screenY-EO.screenY):nj=ij=0,EO=t),ij)},movementY:function(t){return"movementY"in t?t.movementY:nj}}),ohe=Xh(LV),IGe=Ls({},LV,{dataTransfer:0}),LGe=Xh(IGe),DGe=Ls({},qD,{relatedTarget:0}),sj=Xh(DGe),NGe=Ls({},LA,{animationName:0,elapsedTime:0,pseudoElement:0}),FGe=Xh(NGe),kGe=Ls({},LA,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),UGe=Xh(kGe),zGe=Ls({},LA,{data:0}),ahe=Xh(zGe),VGe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},BGe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},GGe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jGe(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=GGe[t])?!!e[t]:!1}function Aie(){return jGe}var HGe=Ls({},qD,{key:function(t){if(t.key){var e=VGe[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=jk(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?BGe[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Aie,charCode:function(t){return t.type==="keypress"?jk(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?jk(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),qGe=Xh(HGe),WGe=Ls({},LV,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lhe=Xh(WGe),YGe=Ls({},qD,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Aie}),XGe=Xh(YGe),ZGe=Ls({},LA,{propertyName:0,elapsedTime:0,pseudoElement:0}),JGe=Xh(ZGe),QGe=Ls({},LV,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),KGe=Xh(QGe),eje=[9,13,27,32],Oie=K0&&"CompositionEvent"in window,rI=null;K0&&"documentMode"in document&&(rI=document.documentMode);var tje=K0&&"TextEvent"in window&&!rI,r2e=K0&&(!Oie||rI&&8<rI&&11>=rI),che=" ",uhe=!1;function i2e(t,e){switch(t){case"keyup":return eje.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function n2e(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var VC=!1;function rje(t,e){switch(t){case"compositionend":return n2e(e);case"keypress":return e.which!==32?null:(uhe=!0,che);case"textInput":return t=e.data,t===che&&uhe?null:t;default:return null}}function ije(t,e){if(VC)return t==="compositionend"||!Oie&&i2e(t,e)?(t=t2e(),Gk=Cie=Rv=null,VC=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return r2e&&e.locale!=="ko"?null:e.data;default:return null}}var nje={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hhe(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!nje[t.type]:e==="textarea"}function s2e(t,e,r,i){NTe(i),e=CU(e,"onChange"),0<e.length&&(r=new Pie("onChange","change",null,r,i),t.push({event:r,listeners:e}))}var iI=null,bL=null;function sje(t){g2e(t,0)}function DV(t){var e=jC(t);if(OTe(e))return t}function oje(t,e){if(t==="change")return e}var o2e=!1;if(K0){var oj;if(K0){var aj="oninput"in document;if(!aj){var dhe=document.createElement("div");dhe.setAttribute("oninput","return;"),aj=typeof dhe.oninput=="function"}oj=aj}else oj=!1;o2e=oj&&(!document.documentMode||9<document.documentMode)}function phe(){iI&&(iI.detachEvent("onpropertychange",a2e),bL=iI=null)}function a2e(t){if(t.propertyName==="value"&&DV(bL)){var e=[];s2e(e,bL,t,wie(t)),zTe(sje,e)}}function aje(t,e,r){t==="focusin"?(phe(),iI=e,bL=r,iI.attachEvent("onpropertychange",a2e)):t==="focusout"&&phe()}function lje(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return DV(bL)}function cje(t,e){if(t==="click")return DV(e)}function uje(t,e){if(t==="input"||t==="change")return DV(e)}function hje(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var om=typeof Object.is=="function"?Object.is:hje;function wL(t,e){if(om(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var n=r[i];if(!QY.call(e,n)||!om(t[n],e[n]))return!1}return!0}function fhe(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function mhe(t,e){var r=fhe(t);t=0;for(var i;r;){if(r.nodeType===3){if(i=t+r.textContent.length,t<=e&&i>=e)return{node:r,offset:e-t};t=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=fhe(r)}}function l2e(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?l2e(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function c2e(){for(var t=window,e=vU();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=vU(t.document)}return e}function Mie(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function dje(t){var e=c2e(),r=t.focusedElem,i=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&l2e(r.ownerDocument.documentElement,r)){if(i!==null&&Mie(r)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var n=r.textContent.length,s=Math.min(i.start,n);i=i.end===void 0?s:Math.min(i.end,n),!t.extend&&s>i&&(n=i,i=s,s=n),n=mhe(r,s);var o=mhe(r,i);n&&o&&(t.rangeCount!==1||t.anchorNode!==n.node||t.anchorOffset!==n.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(n.node,n.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var pje=K0&&"documentMode"in document&&11>=document.documentMode,BC=null,yX=null,nI=null,_X=!1;function ghe(t,e,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;_X||BC==null||BC!==vU(i)||(i=BC,"selectionStart"in i&&Mie(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),nI&&wL(nI,i)||(nI=i,i=CU(yX,"onSelect"),0<i.length&&(e=new Pie("onSelect","select",null,e,r),t.push({event:e,listeners:i}),e.target=BC)))}function y4(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var GC={animationend:y4("Animation","AnimationEnd"),animationiteration:y4("Animation","AnimationIteration"),animationstart:y4("Animation","AnimationStart"),transitionend:y4("Transition","TransitionEnd")},lj={},u2e={};K0&&(u2e=document.createElement("div").style,"AnimationEvent"in window||(delete GC.animationend.animation,delete GC.animationiteration.animation,delete GC.animationstart.animation),"TransitionEvent"in window||delete GC.transitionend.transition);function NV(t){if(lj[t])return lj[t];if(!GC[t])return t;var e=GC[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in u2e)return lj[t]=e[r];return t}var h2e=NV("animationend"),d2e=NV("animationiteration"),p2e=NV("animationstart"),f2e=NV("transitionend"),m2e=new Map,yhe="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Kb(t,e){m2e.set(t,e),d2(e,[t])}for(var cj=0;cj<yhe.length;cj++){var uj=yhe[cj],fje=uj.toLowerCase(),mje=uj[0].toUpperCase()+uj.slice(1);Kb(fje,"on"+mje)}Kb(h2e,"onAnimationEnd");Kb(d2e,"onAnimationIteration");Kb(p2e,"onAnimationStart");Kb("dblclick","onDoubleClick");Kb("focusin","onFocus");Kb("focusout","onBlur");Kb(f2e,"onTransitionEnd");_P("onMouseEnter",["mouseout","mouseover"]);_P("onMouseLeave",["mouseout","mouseover"]);_P("onPointerEnter",["pointerout","pointerover"]);_P("onPointerLeave",["pointerout","pointerover"]);d2("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));d2("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));d2("onBeforeInput",["compositionend","keypress","textInput","paste"]);d2("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));d2("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));d2("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jM="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),gje=new Set("cancel close invalid load scroll toggle".split(" ").concat(jM));function _he(t,e,r){var i=t.type||"unknown-event";t.currentTarget=r,fGe(i,e,void 0,t),t.currentTarget=null}function g2e(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var i=t[r],n=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&n.isPropagationStopped())break e;_he(n,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&n.isPropagationStopped())break e;_he(n,a,c),s=l}}}if(wU)throw t=pX,wU=!1,pX=null,t}function Jn(t,e){var r=e[SX];r===void 0&&(r=e[SX]=new Set);var i=t+"__bubble";r.has(i)||(y2e(e,t,2,!1),r.add(i))}function hj(t,e,r){var i=0;e&&(i|=4),y2e(r,t,i,e)}var _4="_reactListening"+Math.random().toString(36).slice(2);function xL(t){if(!t[_4]){t[_4]=!0,TTe.forEach(function(r){r!=="selectionchange"&&(gje.has(r)||hj(r,!1,t),hj(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[_4]||(e[_4]=!0,hj("selectionchange",!1,e))}}function y2e(t,e,r,i){switch(e2e(e)){case 1:var n=MGe;break;case 4:n=RGe;break;default:n=Eie}r=n.bind(null,e,r,t),n=void 0,!dX||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(n=!0),i?n!==void 0?t.addEventListener(e,r,{capture:!0,passive:n}):t.addEventListener(e,r,!0):n!==void 0?t.addEventListener(e,r,{passive:n}):t.addEventListener(e,r,!1)}function dj(t,e,r,i,n){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===n||a.nodeType===8&&a.parentNode===n)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;o=o.return}for(;a!==null;){if(o=VS(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}zTe(function(){var c=s,u=wie(r),h=[];e:{var p=m2e.get(t);if(p!==void 0){var f=Pie,g=t;switch(t){case"keypress":if(jk(r)===0)break e;case"keydown":case"keyup":f=qGe;break;case"focusin":g="focus",f=sj;break;case"focusout":g="blur",f=sj;break;case"beforeblur":case"afterblur":f=sj;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=ohe;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=LGe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=XGe;break;case h2e:case d2e:case p2e:f=FGe;break;case f2e:f=JGe;break;case"scroll":f=$Ge;break;case"wheel":f=KGe;break;case"copy":case"cut":case"paste":f=UGe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=lhe}var y=(e&4)!==0,v=!y&&t==="scroll",b=y?p!==null?p+"Capture":null:p;y=[];for(var w=c,x;w!==null;){x=w;var S=x.stateNode;if(x.tag===5&&S!==null&&(x=S,b!==null&&(S=gL(w,b),S!=null&&y.push(SL(w,S,x)))),v)break;w=w.return}0<y.length&&(p=new f(p,g,null,r,u),h.push({event:p,listeners:y}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",p&&r!==uX&&(g=r.relatedTarget||r.fromElement)&&(VS(g)||g[e_]))break e;if((f||p)&&(p=u.window===u?u:(p=u.ownerDocument)?p.defaultView||p.parentWindow:window,f?(g=r.relatedTarget||r.toElement,f=c,g=g?VS(g):null,g!==null&&(v=p2(g),g!==v||g.tag!==5&&g.tag!==6)&&(g=null)):(f=null,g=c),f!==g)){if(y=ohe,S="onMouseLeave",b="onMouseEnter",w="mouse",(t==="pointerout"||t==="pointerover")&&(y=lhe,S="onPointerLeave",b="onPointerEnter",w="pointer"),v=f==null?p:jC(f),x=g==null?p:jC(g),p=new y(S,w+"leave",f,r,u),p.target=v,p.relatedTarget=x,S=null,VS(u)===c&&(y=new y(b,w+"enter",g,r,u),y.target=x,y.relatedTarget=v,S=y),v=S,f&&g)t:{for(y=f,b=g,w=0,x=y;x;x=F2(x))w++;for(x=0,S=b;S;S=F2(S))x++;for(;0<w-x;)y=F2(y),w--;for(;0<x-w;)b=F2(b),x--;for(;w--;){if(y===b||b!==null&&y===b.alternate)break t;y=F2(y),b=F2(b)}y=null}else y=null;f!==null&&vhe(h,p,f,y,!1),g!==null&&v!==null&&vhe(h,v,g,y,!0)}}e:{if(p=c?jC(c):window,f=p.nodeName&&p.nodeName.toLowerCase(),f==="select"||f==="input"&&p.type==="file")var E=oje;else if(hhe(p))if(o2e)E=uje;else{E=lje;var P=aje}else(f=p.nodeName)&&f.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(E=cje);if(E&&(E=E(t,c))){s2e(h,E,r,u);break e}P&&P(t,p,c),t==="focusout"&&(P=p._wrapperState)&&P.controlled&&p.type==="number"&&sX(p,"number",p.value)}switch(P=c?jC(c):window,t){case"focusin":(hhe(P)||P.contentEditable==="true")&&(BC=P,yX=c,nI=null);break;case"focusout":nI=yX=BC=null;break;case"mousedown":_X=!0;break;case"contextmenu":case"mouseup":case"dragend":_X=!1,ghe(h,r,u);break;case"selectionchange":if(pje)break;case"keydown":case"keyup":ghe(h,r,u)}var M;if(Oie)e:{switch(t){case"compositionstart":var L="onCompositionStart";break e;case"compositionend":L="onCompositionEnd";break e;case"compositionupdate":L="onCompositionUpdate";break e}L=void 0}else VC?i2e(t,r)&&(L="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(L="onCompositionStart");L&&(r2e&&r.locale!=="ko"&&(VC||L!=="onCompositionStart"?L==="onCompositionEnd"&&VC&&(M=t2e()):(Rv=u,Cie="value"in Rv?Rv.value:Rv.textContent,VC=!0)),P=CU(c,L),0<P.length&&(L=new ahe(L,t,null,r,u),h.push({event:L,listeners:P}),M?L.data=M:(M=n2e(r),M!==null&&(L.data=M)))),(M=tje?rje(t,r):ije(t,r))&&(c=CU(c,"onBeforeInput"),0<c.length&&(u=new ahe("onBeforeInput","beforeinput",null,r,u),h.push({event:u,listeners:c}),u.data=M))}g2e(h,e)})}function SL(t,e,r){return{instance:t,listener:e,currentTarget:r}}function CU(t,e){for(var r=e+"Capture",i=[];t!==null;){var n=t,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=gL(t,r),s!=null&&i.unshift(SL(t,s,n)),s=gL(t,e),s!=null&&i.push(SL(t,s,n))),t=t.return}return i}function F2(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function vhe(t,e,r,i,n){for(var s=e._reactName,o=[];r!==null&&r!==i;){var a=r,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,n?(l=gL(r,s),l!=null&&o.unshift(SL(r,l,a))):n||(l=gL(r,s),l!=null&&o.push(SL(r,l,a)))),r=r.return}o.length!==0&&t.push({event:e,listeners:o})}var yje=/\r\n?/g,_je=/\u0000|\uFFFD/g;function bhe(t){return(typeof t=="string"?t:""+t).replace(yje,`
`).replace(_je,"")}function v4(t,e,r){if(e=bhe(e),bhe(t)!==e&&r)throw Error(ke(425))}function PU(){}var vX=null,bX=null;function wX(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var xX=typeof setTimeout=="function"?setTimeout:void 0,vje=typeof clearTimeout=="function"?clearTimeout:void 0,whe=typeof Promise=="function"?Promise:void 0,bje=typeof queueMicrotask=="function"?queueMicrotask:typeof whe<"u"?function(t){return whe.resolve(null).then(t).catch(wje)}:xX;function wje(t){setTimeout(function(){throw t})}function pj(t,e){var r=e,i=0;do{var n=r.nextSibling;if(t.removeChild(r),n&&n.nodeType===8)if(r=n.data,r==="/$"){if(i===0){t.removeChild(n),vL(e);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=n}while(r);vL(e)}function Qv(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function xhe(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var DA=Math.random().toString(36).slice(2),Cg="__reactFiber$"+DA,TL="__reactProps$"+DA,e_="__reactContainer$"+DA,SX="__reactEvents$"+DA,xje="__reactListeners$"+DA,Sje="__reactHandles$"+DA;function VS(t){var e=t[Cg];if(e)return e;for(var r=t.parentNode;r;){if(e=r[e_]||r[Cg]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=xhe(t);t!==null;){if(r=t[Cg])return r;t=xhe(t)}return e}t=r,r=t.parentNode}return null}function WD(t){return t=t[Cg]||t[e_],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function jC(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ke(33))}function FV(t){return t[TL]||null}var TX=[],HC=-1;function ew(t){return{current:t}}function as(t){0>HC||(t.current=TX[HC],TX[HC]=null,HC--)}function qn(t,e){HC++,TX[HC]=t.current,t.current=e}var gb={},Jl=ew(gb),Lu=ew(!1),MT=gb;function vP(t,e){var r=t.type.contextTypes;if(!r)return gb;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in r)n[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=n),n}function Du(t){return t=t.childContextTypes,t!=null}function AU(){as(Lu),as(Jl)}function She(t,e,r){if(Jl.current!==gb)throw Error(ke(168));qn(Jl,e),qn(Lu,r)}function _2e(t,e,r){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var n in i)if(!(n in e))throw Error(ke(108,aGe(t)||"Unknown",n));return Ls({},r,i)}function OU(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||gb,MT=Jl.current,qn(Jl,t),qn(Lu,Lu.current),!0}function The(t,e,r){var i=t.stateNode;if(!i)throw Error(ke(169));r?(t=_2e(t,e,MT),i.__reactInternalMemoizedMergedChildContext=t,as(Lu),as(Jl),qn(Jl,t)):as(Lu),qn(Lu,r)}var S0=null,kV=!1,fj=!1;function v2e(t){S0===null?S0=[t]:S0.push(t)}function Tje(t){kV=!0,v2e(t)}function tw(){if(!fj&&S0!==null){fj=!0;var t=0,e=yn;try{var r=S0;for(yn=1;t<r.length;t++){var i=r[t];do i=i(!0);while(i!==null)}S0=null,kV=!1}catch(n){throw S0!==null&&(S0=S0.slice(t+1)),jTe(xie,tw),n}finally{yn=e,fj=!1}}return null}var qC=[],WC=0,MU=null,RU=0,$d=[],Id=0,RT=null,$0=1,I0="";function fx(t,e){qC[WC++]=RU,qC[WC++]=MU,MU=t,RU=e}function b2e(t,e,r){$d[Id++]=$0,$d[Id++]=I0,$d[Id++]=RT,RT=t;var i=$0;t=I0;var n=32-qf(i)-1;i&=~(1<<n),r+=1;var s=32-qf(e)+n;if(30<s){var o=n-n%5;s=(i&(1<<o)-1).toString(32),i>>=o,n-=o,$0=1<<32-qf(e)+n|r<<n|i,I0=s+t}else $0=1<<s|r<<n|i,I0=t}function Rie(t){t.return!==null&&(fx(t,1),b2e(t,1,0))}function $ie(t){for(;t===MU;)MU=qC[--WC],qC[WC]=null,RU=qC[--WC],qC[WC]=null;for(;t===RT;)RT=$d[--Id],$d[Id]=null,I0=$d[--Id],$d[Id]=null,$0=$d[--Id],$d[Id]=null}var Lh=null,$h=null,vs=!1,Pf=null;function w2e(t,e){var r=jd(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function Ehe(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Lh=t,$h=Qv(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Lh=t,$h=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=RT!==null?{id:$0,overflow:I0}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=jd(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,Lh=t,$h=null,!0):!1;default:return!1}}function EX(t){return(t.mode&1)!==0&&(t.flags&128)===0}function CX(t){if(vs){var e=$h;if(e){var r=e;if(!Ehe(t,e)){if(EX(t))throw Error(ke(418));e=Qv(r.nextSibling);var i=Lh;e&&Ehe(t,e)?w2e(i,r):(t.flags=t.flags&-4097|2,vs=!1,Lh=t)}}else{if(EX(t))throw Error(ke(418));t.flags=t.flags&-4097|2,vs=!1,Lh=t}}}function Che(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Lh=t}function b4(t){if(t!==Lh)return!1;if(!vs)return Che(t),vs=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!wX(t.type,t.memoizedProps)),e&&(e=$h)){if(EX(t))throw x2e(),Error(ke(418));for(;e;)w2e(t,e),e=Qv(e.nextSibling)}if(Che(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ke(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){$h=Qv(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}$h=null}}else $h=Lh?Qv(t.stateNode.nextSibling):null;return!0}function x2e(){for(var t=$h;t;)t=Qv(t.nextSibling)}function bP(){$h=Lh=null,vs=!1}function Iie(t){Pf===null?Pf=[t]:Pf.push(t)}var Eje=v_.ReactCurrentBatchConfig;function pf(t,e){if(t&&t.defaultProps){e=Ls({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}var $U=ew(null),IU=null,YC=null,Lie=null;function Die(){Lie=YC=IU=null}function Nie(t){var e=$U.current;as($U),t._currentValue=e}function PX(t,e,r){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===r)break;t=t.return}}function I3(t,e){IU=t,Lie=YC=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Pu=!0),t.firstContext=null)}function rp(t){var e=t._currentValue;if(Lie!==t)if(t={context:t,memoizedValue:e,next:null},YC===null){if(IU===null)throw Error(ke(308));YC=t,IU.dependencies={lanes:0,firstContext:t}}else YC=YC.next=t;return e}var BS=null;function Fie(t){BS===null?BS=[t]:BS.push(t)}function S2e(t,e,r,i){var n=e.interleaved;return n===null?(r.next=r,Fie(e)):(r.next=n.next,n.next=r),e.interleaved=r,t_(t,i)}function t_(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var uv=!1;function kie(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function T2e(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function z0(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Kv(t,e,r){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Ri&2){var n=i.pending;return n===null?e.next=e:(e.next=n.next,n.next=e),i.pending=e,t_(t,r)}return n=i.interleaved,n===null?(e.next=e,Fie(i)):(e.next=n.next,n.next=e),i.interleaved=e,t_(t,r)}function Hk(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,r|=i,e.lanes=r,Sie(t,r)}}function Phe(t,e){var r=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var n=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?n=s=o:s=s.next=o,r=r.next}while(r!==null);s===null?n=s=e:s=s.next=e}else n=s=e;r={baseState:i.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function LU(t,e,r,i){var n=t.updateQueue;uv=!1;var s=n.firstBaseUpdate,o=n.lastBaseUpdate,a=n.shared.pending;if(a!==null){n.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=n.baseState;o=0,u=c=l=null,a=s;do{var p=a.lane,f=a.eventTime;if((i&p)===p){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=t,y=a;switch(p=e,f=r,y.tag){case 1:if(g=y.payload,typeof g=="function"){h=g.call(f,h,p);break e}h=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=y.payload,p=typeof g=="function"?g.call(f,h,p):g,p==null)break e;h=Ls({},h,p);break e;case 2:uv=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,p=n.effects,p===null?n.effects=[a]:p.push(a))}else f={eventTime:f,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=h):u=u.next=f,o|=p;if(a=a.next,a===null){if(a=n.shared.pending,a===null)break;p=a,a=p.next,p.next=null,n.lastBaseUpdate=p,n.shared.pending=null}}while(!0);if(u===null&&(l=h),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=u,e=n.shared.interleaved,e!==null){n=e;do o|=n.lane,n=n.next;while(n!==e)}else s===null&&(n.shared.lanes=0);IT|=o,t.lanes=o,t.memoizedState=h}}function Ahe(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],n=i.callback;if(n!==null){if(i.callback=null,i=r,typeof n!="function")throw Error(ke(191,n));n.call(i)}}}var E2e=new STe.Component().refs;function AX(t,e,r,i){e=t.memoizedState,r=r(i,e),r=r==null?e:Ls({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var UV={isMounted:function(t){return(t=t._reactInternals)?p2(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var i=Ic(),n=tb(t),s=z0(i,n);s.payload=e,r!=null&&(s.callback=r),e=Kv(t,s,n),e!==null&&(Wf(e,t,n,i),Hk(e,t,n))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var i=Ic(),n=tb(t),s=z0(i,n);s.tag=1,s.payload=e,r!=null&&(s.callback=r),e=Kv(t,s,n),e!==null&&(Wf(e,t,n,i),Hk(e,t,n))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=Ic(),i=tb(t),n=z0(r,i);n.tag=2,e!=null&&(n.callback=e),e=Kv(t,n,i),e!==null&&(Wf(e,t,i,r),Hk(e,t,i))}};function Ohe(t,e,r,i,n,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!wL(r,i)||!wL(n,s):!0}function C2e(t,e,r){var i=!1,n=gb,s=e.contextType;return typeof s=="object"&&s!==null?s=rp(s):(n=Du(e)?MT:Jl.current,i=e.contextTypes,s=(i=i!=null)?vP(t,n):gb),e=new e(r,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=UV,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=n,t.__reactInternalMemoizedMaskedChildContext=s),e}function Mhe(t,e,r,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,i),e.state!==t&&UV.enqueueReplaceState(e,e.state,null)}function OX(t,e,r,i){var n=t.stateNode;n.props=r,n.state=t.memoizedState,n.refs=E2e,kie(t);var s=e.contextType;typeof s=="object"&&s!==null?n.context=rp(s):(s=Du(e)?MT:Jl.current,n.context=vP(t,s)),n.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(AX(t,e,s,r),n.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(e=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),e!==n.state&&UV.enqueueReplaceState(n,n.state,null),LU(t,r,n,i),n.state=t.memoizedState),typeof n.componentDidMount=="function"&&(t.flags|=4194308)}function CO(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(ke(309));var i=r.stateNode}if(!i)throw Error(ke(147,t));var n=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=n.refs;a===E2e&&(a=n.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(ke(284));if(!r._owner)throw Error(ke(290,t))}return t}function w4(t,e){throw t=Object.prototype.toString.call(e),Error(ke(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Rhe(t){var e=t._init;return e(t._payload)}function P2e(t){function e(b,w){if(t){var x=b.deletions;x===null?(b.deletions=[w],b.flags|=16):x.push(w)}}function r(b,w){if(!t)return null;for(;w!==null;)e(b,w),w=w.sibling;return null}function i(b,w){for(b=new Map;w!==null;)w.key!==null?b.set(w.key,w):b.set(w.index,w),w=w.sibling;return b}function n(b,w){return b=rb(b,w),b.index=0,b.sibling=null,b}function s(b,w,x){return b.index=x,t?(x=b.alternate,x!==null?(x=x.index,x<w?(b.flags|=2,w):x):(b.flags|=2,w)):(b.flags|=1048576,w)}function o(b){return t&&b.alternate===null&&(b.flags|=2),b}function a(b,w,x,S){return w===null||w.tag!==6?(w=wj(x,b.mode,S),w.return=b,w):(w=n(w,x),w.return=b,w)}function l(b,w,x,S){var E=x.type;return E===zC?u(b,w,x.props.children,S,x.key):w!==null&&(w.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===cv&&Rhe(E)===w.type)?(S=n(w,x.props),S.ref=CO(b,w,x),S.return=b,S):(S=Jk(x.type,x.key,x.props,null,b.mode,S),S.ref=CO(b,w,x),S.return=b,S)}function c(b,w,x,S){return w===null||w.tag!==4||w.stateNode.containerInfo!==x.containerInfo||w.stateNode.implementation!==x.implementation?(w=xj(x,b.mode,S),w.return=b,w):(w=n(w,x.children||[]),w.return=b,w)}function u(b,w,x,S,E){return w===null||w.tag!==7?(w=aT(x,b.mode,S,E),w.return=b,w):(w=n(w,x),w.return=b,w)}function h(b,w,x){if(typeof w=="string"&&w!==""||typeof w=="number")return w=wj(""+w,b.mode,x),w.return=b,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case u4:return x=Jk(w.type,w.key,w.props,null,b.mode,x),x.ref=CO(b,null,w),x.return=b,x;case UC:return w=xj(w,b.mode,x),w.return=b,w;case cv:var S=w._init;return h(b,S(w._payload),x)}if(BM(w)||wO(w))return w=aT(w,b.mode,x,null),w.return=b,w;w4(b,w)}return null}function p(b,w,x,S){var E=w!==null?w.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return E!==null?null:a(b,w,""+x,S);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case u4:return x.key===E?l(b,w,x,S):null;case UC:return x.key===E?c(b,w,x,S):null;case cv:return E=x._init,p(b,w,E(x._payload),S)}if(BM(x)||wO(x))return E!==null?null:u(b,w,x,S,null);w4(b,x)}return null}function f(b,w,x,S,E){if(typeof S=="string"&&S!==""||typeof S=="number")return b=b.get(x)||null,a(w,b,""+S,E);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case u4:return b=b.get(S.key===null?x:S.key)||null,l(w,b,S,E);case UC:return b=b.get(S.key===null?x:S.key)||null,c(w,b,S,E);case cv:var P=S._init;return f(b,w,x,P(S._payload),E)}if(BM(S)||wO(S))return b=b.get(x)||null,u(w,b,S,E,null);w4(w,S)}return null}function g(b,w,x,S){for(var E=null,P=null,M=w,L=w=0,U=null;M!==null&&L<x.length;L++){M.index>L?(U=M,M=null):U=M.sibling;var z=p(b,M,x[L],S);if(z===null){M===null&&(M=U);break}t&&M&&z.alternate===null&&e(b,M),w=s(z,w,L),P===null?E=z:P.sibling=z,P=z,M=U}if(L===x.length)return r(b,M),vs&&fx(b,L),E;if(M===null){for(;L<x.length;L++)M=h(b,x[L],S),M!==null&&(w=s(M,w,L),P===null?E=M:P.sibling=M,P=M);return vs&&fx(b,L),E}for(M=i(b,M);L<x.length;L++)U=f(M,b,L,x[L],S),U!==null&&(t&&U.alternate!==null&&M.delete(U.key===null?L:U.key),w=s(U,w,L),P===null?E=U:P.sibling=U,P=U);return t&&M.forEach(function(W){return e(b,W)}),vs&&fx(b,L),E}function y(b,w,x,S){var E=wO(x);if(typeof E!="function")throw Error(ke(150));if(x=E.call(x),x==null)throw Error(ke(151));for(var P=E=null,M=w,L=w=0,U=null,z=x.next();M!==null&&!z.done;L++,z=x.next()){M.index>L?(U=M,M=null):U=M.sibling;var W=p(b,M,z.value,S);if(W===null){M===null&&(M=U);break}t&&M&&W.alternate===null&&e(b,M),w=s(W,w,L),P===null?E=W:P.sibling=W,P=W,M=U}if(z.done)return r(b,M),vs&&fx(b,L),E;if(M===null){for(;!z.done;L++,z=x.next())z=h(b,z.value,S),z!==null&&(w=s(z,w,L),P===null?E=z:P.sibling=z,P=z);return vs&&fx(b,L),E}for(M=i(b,M);!z.done;L++,z=x.next())z=f(M,b,L,z.value,S),z!==null&&(t&&z.alternate!==null&&M.delete(z.key===null?L:z.key),w=s(z,w,L),P===null?E=z:P.sibling=z,P=z);return t&&M.forEach(function(V){return e(b,V)}),vs&&fx(b,L),E}function v(b,w,x,S){if(typeof x=="object"&&x!==null&&x.type===zC&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case u4:e:{for(var E=x.key,P=w;P!==null;){if(P.key===E){if(E=x.type,E===zC){if(P.tag===7){r(b,P.sibling),w=n(P,x.props.children),w.return=b,b=w;break e}}else if(P.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===cv&&Rhe(E)===P.type){r(b,P.sibling),w=n(P,x.props),w.ref=CO(b,P,x),w.return=b,b=w;break e}r(b,P);break}else e(b,P);P=P.sibling}x.type===zC?(w=aT(x.props.children,b.mode,S,x.key),w.return=b,b=w):(S=Jk(x.type,x.key,x.props,null,b.mode,S),S.ref=CO(b,w,x),S.return=b,b=S)}return o(b);case UC:e:{for(P=x.key;w!==null;){if(w.key===P)if(w.tag===4&&w.stateNode.containerInfo===x.containerInfo&&w.stateNode.implementation===x.implementation){r(b,w.sibling),w=n(w,x.children||[]),w.return=b,b=w;break e}else{r(b,w);break}else e(b,w);w=w.sibling}w=xj(x,b.mode,S),w.return=b,b=w}return o(b);case cv:return P=x._init,v(b,w,P(x._payload),S)}if(BM(x))return g(b,w,x,S);if(wO(x))return y(b,w,x,S);w4(b,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,w!==null&&w.tag===6?(r(b,w.sibling),w=n(w,x),w.return=b,b=w):(r(b,w),w=wj(x,b.mode,S),w.return=b,b=w),o(b)):r(b,w)}return v}var wP=P2e(!0),A2e=P2e(!1),YD={},qg=ew(YD),EL=ew(YD),CL=ew(YD);function GS(t){if(t===YD)throw Error(ke(174));return t}function Uie(t,e){switch(qn(CL,e),qn(EL,t),qn(qg,YD),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:aX(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=aX(e,t)}as(qg),qn(qg,e)}function xP(){as(qg),as(EL),as(CL)}function O2e(t){GS(CL.current);var e=GS(qg.current),r=aX(e,t.type);e!==r&&(qn(EL,t),qn(qg,r))}function zie(t){EL.current===t&&(as(qg),as(EL))}var Ps=ew(0);function DU(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var mj=[];function Vie(){for(var t=0;t<mj.length;t++)mj[t]._workInProgressVersionPrimary=null;mj.length=0}var qk=v_.ReactCurrentDispatcher,gj=v_.ReactCurrentBatchConfig,$T=0,Rs=null,ra=null,Ma=null,NU=!1,sI=!1,PL=0,Cje=0;function wl(){throw Error(ke(321))}function Bie(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!om(t[r],e[r]))return!1;return!0}function Gie(t,e,r,i,n,s){if($T=s,Rs=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,qk.current=t===null||t.memoizedState===null?Mje:Rje,t=r(i,n),sI){s=0;do{if(sI=!1,PL=0,25<=s)throw Error(ke(301));s+=1,Ma=ra=null,e.updateQueue=null,qk.current=$je,t=r(i,n)}while(sI)}if(qk.current=FU,e=ra!==null&&ra.next!==null,$T=0,Ma=ra=Rs=null,NU=!1,e)throw Error(ke(300));return t}function jie(){var t=PL!==0;return PL=0,t}function bg(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ma===null?Rs.memoizedState=Ma=t:Ma=Ma.next=t,Ma}function ip(){if(ra===null){var t=Rs.alternate;t=t!==null?t.memoizedState:null}else t=ra.next;var e=Ma===null?Rs.memoizedState:Ma.next;if(e!==null)Ma=e,ra=t;else{if(t===null)throw Error(ke(310));ra=t,t={memoizedState:ra.memoizedState,baseState:ra.baseState,baseQueue:ra.baseQueue,queue:ra.queue,next:null},Ma===null?Rs.memoizedState=Ma=t:Ma=Ma.next=t}return Ma}function AL(t,e){return typeof e=="function"?e(t):e}function yj(t){var e=ip(),r=e.queue;if(r===null)throw Error(ke(311));r.lastRenderedReducer=t;var i=ra,n=i.baseQueue,s=r.pending;if(s!==null){if(n!==null){var o=n.next;n.next=s.next,s.next=o}i.baseQueue=n=s,r.pending=null}if(n!==null){s=n.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if(($T&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=i):l=l.next=h,Rs.lanes|=u,IT|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,om(i,e.memoizedState)||(Pu=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,r.lastRenderedState=i}if(t=r.interleaved,t!==null){n=t;do s=n.lane,Rs.lanes|=s,IT|=s,n=n.next;while(n!==t)}else n===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function _j(t){var e=ip(),r=e.queue;if(r===null)throw Error(ke(311));r.lastRenderedReducer=t;var i=r.dispatch,n=r.pending,s=e.memoizedState;if(n!==null){r.pending=null;var o=n=n.next;do s=t(s,o.action),o=o.next;while(o!==n);om(s,e.memoizedState)||(Pu=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),r.lastRenderedState=s}return[s,i]}function M2e(){}function R2e(t,e){var r=Rs,i=ip(),n=e(),s=!om(i.memoizedState,n);if(s&&(i.memoizedState=n,Pu=!0),i=i.queue,Hie(L2e.bind(null,r,i,t),[t]),i.getSnapshot!==e||s||Ma!==null&&Ma.memoizedState.tag&1){if(r.flags|=2048,OL(9,I2e.bind(null,r,i,n,e),void 0,null),ka===null)throw Error(ke(349));$T&30||$2e(r,e,n)}return n}function $2e(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=Rs.updateQueue,e===null?(e={lastEffect:null,stores:null},Rs.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function I2e(t,e,r,i){e.value=r,e.getSnapshot=i,D2e(e)&&N2e(t)}function L2e(t,e,r){return r(function(){D2e(e)&&N2e(t)})}function D2e(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!om(t,r)}catch{return!0}}function N2e(t){var e=t_(t,1);e!==null&&Wf(e,t,1,-1)}function $he(t){var e=bg();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:AL,lastRenderedState:t},e.queue=t,t=t.dispatch=Oje.bind(null,Rs,t),[e.memoizedState,t]}function OL(t,e,r,i){return t={tag:t,create:e,destroy:r,deps:i,next:null},e=Rs.updateQueue,e===null?(e={lastEffect:null,stores:null},Rs.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(i=r.next,r.next=t,t.next=i,e.lastEffect=t)),t}function F2e(){return ip().memoizedState}function Wk(t,e,r,i){var n=bg();Rs.flags|=t,n.memoizedState=OL(1|e,r,void 0,i===void 0?null:i)}function zV(t,e,r,i){var n=ip();i=i===void 0?null:i;var s=void 0;if(ra!==null){var o=ra.memoizedState;if(s=o.destroy,i!==null&&Bie(i,o.deps)){n.memoizedState=OL(e,r,s,i);return}}Rs.flags|=t,n.memoizedState=OL(1|e,r,s,i)}function Ihe(t,e){return Wk(8390656,8,t,e)}function Hie(t,e){return zV(2048,8,t,e)}function k2e(t,e){return zV(4,2,t,e)}function U2e(t,e){return zV(4,4,t,e)}function z2e(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function V2e(t,e,r){return r=r!=null?r.concat([t]):null,zV(4,4,z2e.bind(null,e,t),r)}function qie(){}function B2e(t,e){var r=ip();e=e===void 0?null:e;var i=r.memoizedState;return i!==null&&e!==null&&Bie(e,i[1])?i[0]:(r.memoizedState=[t,e],t)}function G2e(t,e){var r=ip();e=e===void 0?null:e;var i=r.memoizedState;return i!==null&&e!==null&&Bie(e,i[1])?i[0]:(t=t(),r.memoizedState=[t,e],t)}function j2e(t,e,r){return $T&21?(om(r,e)||(r=WTe(),Rs.lanes|=r,IT|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Pu=!0),t.memoizedState=r)}function Pje(t,e){var r=yn;yn=r!==0&&4>r?r:4,t(!0);var i=gj.transition;gj.transition={};try{t(!1),e()}finally{yn=r,gj.transition=i}}function H2e(){return ip().memoizedState}function Aje(t,e,r){var i=tb(t);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},q2e(t))W2e(e,r);else if(r=S2e(t,e,r,i),r!==null){var n=Ic();Wf(r,t,i,n),Y2e(r,e,i)}}function Oje(t,e,r){var i=tb(t),n={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(q2e(t))W2e(e,n);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,r);if(n.hasEagerState=!0,n.eagerState=a,om(a,o)){var l=e.interleaved;l===null?(n.next=n,Fie(e)):(n.next=l.next,l.next=n),e.interleaved=n;return}}catch{}finally{}r=S2e(t,e,n,i),r!==null&&(n=Ic(),Wf(r,t,i,n),Y2e(r,e,i))}}function q2e(t){var e=t.alternate;return t===Rs||e!==null&&e===Rs}function W2e(t,e){sI=NU=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function Y2e(t,e,r){if(r&4194240){var i=e.lanes;i&=t.pendingLanes,r|=i,e.lanes=r,Sie(t,r)}}var FU={readContext:rp,useCallback:wl,useContext:wl,useEffect:wl,useImperativeHandle:wl,useInsertionEffect:wl,useLayoutEffect:wl,useMemo:wl,useReducer:wl,useRef:wl,useState:wl,useDebugValue:wl,useDeferredValue:wl,useTransition:wl,useMutableSource:wl,useSyncExternalStore:wl,useId:wl,unstable_isNewReconciler:!1},Mje={readContext:rp,useCallback:function(t,e){return bg().memoizedState=[t,e===void 0?null:e],t},useContext:rp,useEffect:Ihe,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,Wk(4194308,4,z2e.bind(null,e,t),r)},useLayoutEffect:function(t,e){return Wk(4194308,4,t,e)},useInsertionEffect:function(t,e){return Wk(4,2,t,e)},useMemo:function(t,e){var r=bg();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var i=bg();return e=r!==void 0?r(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=Aje.bind(null,Rs,t),[i.memoizedState,t]},useRef:function(t){var e=bg();return t={current:t},e.memoizedState=t},useState:$he,useDebugValue:qie,useDeferredValue:function(t){return bg().memoizedState=t},useTransition:function(){var t=$he(!1),e=t[0];return t=Pje.bind(null,t[1]),bg().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var i=Rs,n=bg();if(vs){if(r===void 0)throw Error(ke(407));r=r()}else{if(r=e(),ka===null)throw Error(ke(349));$T&30||$2e(i,e,r)}n.memoizedState=r;var s={value:r,getSnapshot:e};return n.queue=s,Ihe(L2e.bind(null,i,s,t),[t]),i.flags|=2048,OL(9,I2e.bind(null,i,s,r,e),void 0,null),r},useId:function(){var t=bg(),e=ka.identifierPrefix;if(vs){var r=I0,i=$0;r=(i&~(1<<32-qf(i)-1)).toString(32)+r,e=":"+e+"R"+r,r=PL++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=Cje++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Rje={readContext:rp,useCallback:B2e,useContext:rp,useEffect:Hie,useImperativeHandle:V2e,useInsertionEffect:k2e,useLayoutEffect:U2e,useMemo:G2e,useReducer:yj,useRef:F2e,useState:function(){return yj(AL)},useDebugValue:qie,useDeferredValue:function(t){var e=ip();return j2e(e,ra.memoizedState,t)},useTransition:function(){var t=yj(AL)[0],e=ip().memoizedState;return[t,e]},useMutableSource:M2e,useSyncExternalStore:R2e,useId:H2e,unstable_isNewReconciler:!1},$je={readContext:rp,useCallback:B2e,useContext:rp,useEffect:Hie,useImperativeHandle:V2e,useInsertionEffect:k2e,useLayoutEffect:U2e,useMemo:G2e,useReducer:_j,useRef:F2e,useState:function(){return _j(AL)},useDebugValue:qie,useDeferredValue:function(t){var e=ip();return ra===null?e.memoizedState=t:j2e(e,ra.memoizedState,t)},useTransition:function(){var t=_j(AL)[0],e=ip().memoizedState;return[t,e]},useMutableSource:M2e,useSyncExternalStore:R2e,useId:H2e,unstable_isNewReconciler:!1};function SP(t,e){try{var r="",i=e;do r+=oGe(i),i=i.return;while(i);var n=r}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:n,digest:null}}function vj(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function MX(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var Ije=typeof WeakMap=="function"?WeakMap:Map;function X2e(t,e,r){r=z0(-1,r),r.tag=3,r.payload={element:null};var i=e.value;return r.callback=function(){UU||(UU=!0,zX=i),MX(t,e)},r}function Z2e(t,e,r){r=z0(-1,r),r.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var n=e.value;r.payload=function(){return i(n)},r.callback=function(){MX(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){MX(t,e),typeof i!="function"&&(eb===null?eb=new Set([this]):eb.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),r}function Lhe(t,e,r){var i=t.pingCache;if(i===null){i=t.pingCache=new Ije;var n=new Set;i.set(e,n)}else n=i.get(e),n===void 0&&(n=new Set,i.set(e,n));n.has(r)||(n.add(r),t=Wje.bind(null,t,e,r),e.then(t,t))}function Dhe(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Nhe(t,e,r,i,n){return t.mode&1?(t.flags|=65536,t.lanes=n,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=z0(-1,1),e.tag=2,Kv(r,e,1))),r.lanes|=1),t)}var Lje=v_.ReactCurrentOwner,Pu=!1;function Tc(t,e,r,i){e.child=t===null?A2e(e,null,r,i):wP(e,t.child,r,i)}function Fhe(t,e,r,i,n){r=r.render;var s=e.ref;return I3(e,n),i=Gie(t,e,r,i,s,n),r=jie(),t!==null&&!Pu?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,r_(t,e,n)):(vs&&r&&Rie(e),e.flags|=1,Tc(t,e,i,n),e.child)}function khe(t,e,r,i,n){if(t===null){var s=r.type;return typeof s=="function"&&!ene(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=s,J2e(t,e,s,i,n)):(t=Jk(r.type,null,i,e,e.mode,n),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&n)){var o=s.memoizedProps;if(r=r.compare,r=r!==null?r:wL,r(o,i)&&t.ref===e.ref)return r_(t,e,n)}return e.flags|=1,t=rb(s,i),t.ref=e.ref,t.return=e,e.child=t}function J2e(t,e,r,i,n){if(t!==null){var s=t.memoizedProps;if(wL(s,i)&&t.ref===e.ref)if(Pu=!1,e.pendingProps=i=s,(t.lanes&n)!==0)t.flags&131072&&(Pu=!0);else return e.lanes=t.lanes,r_(t,e,n)}return RX(t,e,r,i,n)}function Q2e(t,e,r){var i=e.pendingProps,n=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},qn(ZC,bh),bh|=r;else{if(!(r&1073741824))return t=s!==null?s.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,qn(ZC,bh),bh|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:r,qn(ZC,bh),bh|=i}else s!==null?(i=s.baseLanes|r,e.memoizedState=null):i=r,qn(ZC,bh),bh|=i;return Tc(t,e,n,r),e.child}function K2e(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function RX(t,e,r,i,n){var s=Du(r)?MT:Jl.current;return s=vP(e,s),I3(e,n),r=Gie(t,e,r,i,s,n),i=jie(),t!==null&&!Pu?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,r_(t,e,n)):(vs&&i&&Rie(e),e.flags|=1,Tc(t,e,r,n),e.child)}function Uhe(t,e,r,i,n){if(Du(r)){var s=!0;OU(e)}else s=!1;if(I3(e,n),e.stateNode===null)Yk(t,e),C2e(e,r,i),OX(e,r,i,n),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=r.contextType;typeof c=="object"&&c!==null?c=rp(c):(c=Du(r)?MT:Jl.current,c=vP(e,c));var u=r.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&Mhe(e,o,i,c),uv=!1;var p=e.memoizedState;o.state=p,LU(e,i,o,n),l=e.memoizedState,a!==i||p!==l||Lu.current||uv?(typeof u=="function"&&(AX(e,r,u,i),l=e.memoizedState),(a=uv||Ohe(e,r,a,i,p,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,T2e(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:pf(e.type,a),o.props=c,h=e.pendingProps,p=o.context,l=r.contextType,typeof l=="object"&&l!==null?l=rp(l):(l=Du(r)?MT:Jl.current,l=vP(e,l));var f=r.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||p!==l)&&Mhe(e,o,i,l),uv=!1,p=e.memoizedState,o.state=p,LU(e,i,o,n);var g=e.memoizedState;a!==h||p!==g||Lu.current||uv?(typeof f=="function"&&(AX(e,r,f,i),g=e.memoizedState),(c=uv||Ohe(e,r,c,i,p,g,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,g,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,g,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=g),o.props=i,o.state=g,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),i=!1)}return $X(t,e,r,i,s,n)}function $X(t,e,r,i,n,s){K2e(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return n&&The(e,r,!1),r_(t,e,s);i=e.stateNode,Lje.current=e;var a=o&&typeof r.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=wP(e,t.child,null,s),e.child=wP(e,null,a,s)):Tc(t,e,a,s),e.memoizedState=i.state,n&&The(e,r,!0),e.child}function eEe(t){var e=t.stateNode;e.pendingContext?She(t,e.pendingContext,e.pendingContext!==e.context):e.context&&She(t,e.context,!1),Uie(t,e.containerInfo)}function zhe(t,e,r,i,n){return bP(),Iie(n),e.flags|=256,Tc(t,e,r,i),e.child}var IX={dehydrated:null,treeContext:null,retryLane:0};function LX(t){return{baseLanes:t,cachePool:null,transitions:null}}function tEe(t,e,r){var i=e.pendingProps,n=Ps.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(n&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(n|=1),qn(Ps,n&1),t===null)return CX(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=GV(o,i,0,null),t=aT(t,i,r,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=LX(r),e.memoizedState=IX,t):Wie(e,o));if(n=t.memoizedState,n!==null&&(a=n.dehydrated,a!==null))return Dje(t,e,o,i,a,n,r);if(s){s=i.fallback,o=e.mode,n=t.child,a=n.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==n?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=rb(n,l),i.subtreeFlags=n.subtreeFlags&14680064),a!==null?s=rb(a,s):(s=aT(s,o,r,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?LX(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~r,e.memoizedState=IX,i}return s=t.child,t=s.sibling,i=rb(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=r),i.return=e,i.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=i,e.memoizedState=null,i}function Wie(t,e){return e=GV({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function x4(t,e,r,i){return i!==null&&Iie(i),wP(e,t.child,null,r),t=Wie(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Dje(t,e,r,i,n,s,o){if(r)return e.flags&256?(e.flags&=-257,i=vj(Error(ke(422))),x4(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,n=e.mode,i=GV({mode:"visible",children:i.children},n,0,null),s=aT(s,n,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&wP(e,t.child,null,o),e.child.memoizedState=LX(o),e.memoizedState=IX,s);if(!(e.mode&1))return x4(t,e,o,null);if(n.data==="$!"){if(i=n.nextSibling&&n.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(ke(419)),i=vj(s,i,void 0),x4(t,e,o,i)}if(a=(o&t.childLanes)!==0,Pu||a){if(i=ka,i!==null){switch(o&-o){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(i.suspendedLanes|o)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,t_(t,n),Wf(i,t,n,-1))}return Kie(),i=vj(Error(ke(421))),x4(t,e,o,i)}return n.data==="$?"?(e.flags|=128,e.child=t.child,e=Yje.bind(null,t),n._reactRetry=e,null):(t=s.treeContext,$h=Qv(n.nextSibling),Lh=e,vs=!0,Pf=null,t!==null&&($d[Id++]=$0,$d[Id++]=I0,$d[Id++]=RT,$0=t.id,I0=t.overflow,RT=e),e=Wie(e,i.children),e.flags|=4096,e)}function Vhe(t,e,r){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),PX(t.return,e,r)}function bj(t,e,r,i,n){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:n}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=r,s.tailMode=n)}function rEe(t,e,r){var i=e.pendingProps,n=i.revealOrder,s=i.tail;if(Tc(t,e,i.children,r),i=Ps.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Vhe(t,r,e);else if(t.tag===19)Vhe(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(qn(Ps,i),!(e.mode&1))e.memoizedState=null;else switch(n){case"forwards":for(r=e.child,n=null;r!==null;)t=r.alternate,t!==null&&DU(t)===null&&(n=r),r=r.sibling;r=n,r===null?(n=e.child,e.child=null):(n=r.sibling,r.sibling=null),bj(e,!1,n,r,s);break;case"backwards":for(r=null,n=e.child,e.child=null;n!==null;){if(t=n.alternate,t!==null&&DU(t)===null){e.child=n;break}t=n.sibling,n.sibling=r,r=n,n=t}bj(e,!0,r,null,s);break;case"together":bj(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Yk(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function r_(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),IT|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ke(153));if(e.child!==null){for(t=e.child,r=rb(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=rb(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function Nje(t,e,r){switch(e.tag){case 3:eEe(e),bP();break;case 5:O2e(e);break;case 1:Du(e.type)&&OU(e);break;case 4:Uie(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,n=e.memoizedProps.value;qn($U,i._currentValue),i._currentValue=n;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(qn(Ps,Ps.current&1),e.flags|=128,null):r&e.child.childLanes?tEe(t,e,r):(qn(Ps,Ps.current&1),t=r_(t,e,r),t!==null?t.sibling:null);qn(Ps,Ps.current&1);break;case 19:if(i=(r&e.childLanes)!==0,t.flags&128){if(i)return rEe(t,e,r);e.flags|=128}if(n=e.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),qn(Ps,Ps.current),i)break;return null;case 22:case 23:return e.lanes=0,Q2e(t,e,r)}return r_(t,e,r)}var iEe,DX,nEe,sEe;iEe=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};DX=function(){};nEe=function(t,e,r,i){var n=t.memoizedProps;if(n!==i){t=e.stateNode,GS(qg.current);var s=null;switch(r){case"input":n=iX(t,n),i=iX(t,i),s=[];break;case"select":n=Ls({},n,{value:void 0}),i=Ls({},i,{value:void 0}),s=[];break;case"textarea":n=oX(t,n),i=oX(t,i),s=[];break;default:typeof n.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=PU)}lX(r,i);var o;r=null;for(c in n)if(!i.hasOwnProperty(c)&&n.hasOwnProperty(c)&&n[c]!=null)if(c==="style"){var a=n[c];for(o in a)a.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(fL.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=n!=null?n[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(r||(r={}),r[o]=l[o])}else r||(s||(s=[]),s.push(c,r)),r=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(fL.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Jn("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}r&&(s=s||[]).push("style",r);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};sEe=function(t,e,r,i){r!==i&&(e.flags|=4)};function PO(t,e){if(!vs)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function xl(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,i=0;if(e)for(var n=t.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags&14680064,i|=n.flags&14680064,n.return=t,n=n.sibling;else for(n=t.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags,i|=n.flags,n.return=t,n=n.sibling;return t.subtreeFlags|=i,t.childLanes=r,e}function Fje(t,e,r){var i=e.pendingProps;switch($ie(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xl(e),null;case 1:return Du(e.type)&&AU(),xl(e),null;case 3:return i=e.stateNode,xP(),as(Lu),as(Jl),Vie(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(b4(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Pf!==null&&(GX(Pf),Pf=null))),DX(t,e),xl(e),null;case 5:zie(e);var n=GS(CL.current);if(r=e.type,t!==null&&e.stateNode!=null)nEe(t,e,r,i,n),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(ke(166));return xl(e),null}if(t=GS(qg.current),b4(e)){i=e.stateNode,r=e.type;var s=e.memoizedProps;switch(i[Cg]=e,i[TL]=s,t=(e.mode&1)!==0,r){case"dialog":Jn("cancel",i),Jn("close",i);break;case"iframe":case"object":case"embed":Jn("load",i);break;case"video":case"audio":for(n=0;n<jM.length;n++)Jn(jM[n],i);break;case"source":Jn("error",i);break;case"img":case"image":case"link":Jn("error",i),Jn("load",i);break;case"details":Jn("toggle",i);break;case"input":Zue(i,s),Jn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Jn("invalid",i);break;case"textarea":Que(i,s),Jn("invalid",i)}lX(r,s),n=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&v4(i.textContent,a,t),n=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&v4(i.textContent,a,t),n=["children",""+a]):fL.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Jn("scroll",i)}switch(r){case"input":h4(i),Jue(i,s,!0);break;case"textarea":h4(i),Kue(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=PU)}i=n,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=n.nodeType===9?n:n.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=$Te(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(r,{is:i.is}):(t=o.createElement(r),r==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,r),t[Cg]=e,t[TL]=i,iEe(t,e,!1,!1),e.stateNode=t;e:{switch(o=cX(r,i),r){case"dialog":Jn("cancel",t),Jn("close",t),n=i;break;case"iframe":case"object":case"embed":Jn("load",t),n=i;break;case"video":case"audio":for(n=0;n<jM.length;n++)Jn(jM[n],t);n=i;break;case"source":Jn("error",t),n=i;break;case"img":case"image":case"link":Jn("error",t),Jn("load",t),n=i;break;case"details":Jn("toggle",t),n=i;break;case"input":Zue(t,i),n=iX(t,i),Jn("invalid",t);break;case"option":n=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},n=Ls({},i,{value:void 0}),Jn("invalid",t);break;case"textarea":Que(t,i),n=oX(t,i),Jn("invalid",t);break;default:n=i}lX(r,n),a=n;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?DTe(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&ITe(t,l)):s==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&mL(t,l):typeof l=="number"&&mL(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(fL.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Jn("scroll",t):l!=null&&yie(t,s,l,o))}switch(r){case"input":h4(t),Jue(t,i,!1);break;case"textarea":h4(t),Kue(t);break;case"option":i.value!=null&&t.setAttribute("value",""+mb(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?O3(t,!!i.multiple,s,!1):i.defaultValue!=null&&O3(t,!!i.multiple,i.defaultValue,!0);break;default:typeof n.onClick=="function"&&(t.onclick=PU)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return xl(e),null;case 6:if(t&&e.stateNode!=null)sEe(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(ke(166));if(r=GS(CL.current),GS(qg.current),b4(e)){if(i=e.stateNode,r=e.memoizedProps,i[Cg]=e,(s=i.nodeValue!==r)&&(t=Lh,t!==null))switch(t.tag){case 3:v4(i.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&v4(i.nodeValue,r,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[Cg]=e,e.stateNode=i}return xl(e),null;case 13:if(as(Ps),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(vs&&$h!==null&&e.mode&1&&!(e.flags&128))x2e(),bP(),e.flags|=98560,s=!1;else if(s=b4(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(ke(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ke(317));s[Cg]=e}else bP(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;xl(e),s=!1}else Pf!==null&&(GX(Pf),Pf=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Ps.current&1?oa===0&&(oa=3):Kie())),e.updateQueue!==null&&(e.flags|=4),xl(e),null);case 4:return xP(),DX(t,e),t===null&&xL(e.stateNode.containerInfo),xl(e),null;case 10:return Nie(e.type._context),xl(e),null;case 17:return Du(e.type)&&AU(),xl(e),null;case 19:if(as(Ps),s=e.memoizedState,s===null)return xl(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)PO(s,!1);else{if(oa!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=DU(t),o!==null){for(e.flags|=128,PO(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=r,r=e.child;r!==null;)s=r,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return qn(Ps,Ps.current&1|2),e.child}t=t.sibling}s.tail!==null&&co()>TP&&(e.flags|=128,i=!0,PO(s,!1),e.lanes=4194304)}else{if(!i)if(t=DU(o),t!==null){if(e.flags|=128,i=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),PO(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!vs)return xl(e),null}else 2*co()-s.renderingStartTime>TP&&r!==1073741824&&(e.flags|=128,i=!0,PO(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(r=s.last,r!==null?r.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=co(),e.sibling=null,r=Ps.current,qn(Ps,i?r&1|2:r&1),e):(xl(e),null);case 22:case 23:return Qie(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?bh&1073741824&&(xl(e),e.subtreeFlags&6&&(e.flags|=8192)):xl(e),null;case 24:return null;case 25:return null}throw Error(ke(156,e.tag))}function kje(t,e){switch($ie(e),e.tag){case 1:return Du(e.type)&&AU(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return xP(),as(Lu),as(Jl),Vie(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return zie(e),null;case 13:if(as(Ps),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ke(340));bP()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return as(Ps),null;case 4:return xP(),null;case 10:return Nie(e.type._context),null;case 22:case 23:return Qie(),null;case 24:return null;default:return null}}var S4=!1,Hl=!1,Uje=typeof WeakSet=="function"?WeakSet:Set,Pt=null;function XC(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){Xs(t,e,i)}else r.current=null}function NX(t,e,r){try{r()}catch(i){Xs(t,e,i)}}var Bhe=!1;function zje(t,e){if(vX=TU,t=c2e(),Mie(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var n=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=t,p=null;t:for(;;){for(var f;h!==r||n!==0&&h.nodeType!==3||(a=o+n),h!==s||i!==0&&h.nodeType!==3||(l=o+i),h.nodeType===3&&(o+=h.nodeValue.length),(f=h.firstChild)!==null;)p=h,h=f;for(;;){if(h===t)break t;if(p===r&&++c===n&&(a=o),p===s&&++u===i&&(l=o),(f=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=f}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(bX={focusedElem:t,selectionRange:r},TU=!1,Pt=e;Pt!==null;)if(e=Pt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Pt=t;else for(;Pt!==null;){e=Pt;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var y=g.memoizedProps,v=g.memoizedState,b=e.stateNode,w=b.getSnapshotBeforeUpdate(e.elementType===e.type?y:pf(e.type,y),v);b.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var x=e.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ke(163))}}catch(S){Xs(e,e.return,S)}if(t=e.sibling,t!==null){t.return=e.return,Pt=t;break}Pt=e.return}return g=Bhe,Bhe=!1,g}function oI(t,e,r){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var n=i=i.next;do{if((n.tag&t)===t){var s=n.destroy;n.destroy=void 0,s!==void 0&&NX(e,r,s)}n=n.next}while(n!==i)}}function VV(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var i=r.create;r.destroy=i()}r=r.next}while(r!==e)}}function FX(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function oEe(t){var e=t.alternate;e!==null&&(t.alternate=null,oEe(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Cg],delete e[TL],delete e[SX],delete e[xje],delete e[Sje])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function aEe(t){return t.tag===5||t.tag===3||t.tag===4}function Ghe(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||aEe(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function kX(t,e,r){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=PU));else if(i!==4&&(t=t.child,t!==null))for(kX(t,e,r),t=t.sibling;t!==null;)kX(t,e,r),t=t.sibling}function UX(t,e,r){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(UX(t,e,r),t=t.sibling;t!==null;)UX(t,e,r),t=t.sibling}var Wa=null,yf=!1;function B_(t,e,r){for(r=r.child;r!==null;)lEe(t,e,r),r=r.sibling}function lEe(t,e,r){if(Hg&&typeof Hg.onCommitFiberUnmount=="function")try{Hg.onCommitFiberUnmount(IV,r)}catch{}switch(r.tag){case 5:Hl||XC(r,e);case 6:var i=Wa,n=yf;Wa=null,B_(t,e,r),Wa=i,yf=n,Wa!==null&&(yf?(t=Wa,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):Wa.removeChild(r.stateNode));break;case 18:Wa!==null&&(yf?(t=Wa,r=r.stateNode,t.nodeType===8?pj(t.parentNode,r):t.nodeType===1&&pj(t,r),vL(t)):pj(Wa,r.stateNode));break;case 4:i=Wa,n=yf,Wa=r.stateNode.containerInfo,yf=!0,B_(t,e,r),Wa=i,yf=n;break;case 0:case 11:case 14:case 15:if(!Hl&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){n=i=i.next;do{var s=n,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&NX(r,e,o),n=n.next}while(n!==i)}B_(t,e,r);break;case 1:if(!Hl&&(XC(r,e),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(a){Xs(r,e,a)}B_(t,e,r);break;case 21:B_(t,e,r);break;case 22:r.mode&1?(Hl=(i=Hl)||r.memoizedState!==null,B_(t,e,r),Hl=i):B_(t,e,r);break;default:B_(t,e,r)}}function jhe(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new Uje),e.forEach(function(i){var n=Xje.bind(null,t,i);r.has(i)||(r.add(i),i.then(n,n))})}}function Cp(t,e){var r=e.deletions;if(r!==null)for(var i=0;i<r.length;i++){var n=r[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Wa=a.stateNode,yf=!1;break e;case 3:Wa=a.stateNode.containerInfo,yf=!0;break e;case 4:Wa=a.stateNode.containerInfo,yf=!0;break e}a=a.return}if(Wa===null)throw Error(ke(160));lEe(s,o,n),Wa=null,yf=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(c){Xs(n,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)cEe(e,t),e=e.sibling}function cEe(t,e){var r=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Cp(e,t),Tm(t),i&4){try{oI(3,t,t.return),VV(3,t)}catch(y){Xs(t,t.return,y)}try{oI(5,t,t.return)}catch(y){Xs(t,t.return,y)}}break;case 1:Cp(e,t),Tm(t),i&512&&r!==null&&XC(r,r.return);break;case 5:if(Cp(e,t),Tm(t),i&512&&r!==null&&XC(r,r.return),t.flags&32){var n=t.stateNode;try{mL(n,"")}catch(y){Xs(t,t.return,y)}}if(i&4&&(n=t.stateNode,n!=null)){var s=t.memoizedProps,o=r!==null?r.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&MTe(n,s),cX(a,o);var c=cX(a,s);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?DTe(n,h):u==="dangerouslySetInnerHTML"?ITe(n,h):u==="children"?mL(n,h):yie(n,u,h,c)}switch(a){case"input":nX(n,s);break;case"textarea":RTe(n,s);break;case"select":var p=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?O3(n,!!s.multiple,f,!1):p!==!!s.multiple&&(s.defaultValue!=null?O3(n,!!s.multiple,s.defaultValue,!0):O3(n,!!s.multiple,s.multiple?[]:"",!1))}n[TL]=s}catch(y){Xs(t,t.return,y)}}break;case 6:if(Cp(e,t),Tm(t),i&4){if(t.stateNode===null)throw Error(ke(162));n=t.stateNode,s=t.memoizedProps;try{n.nodeValue=s}catch(y){Xs(t,t.return,y)}}break;case 3:if(Cp(e,t),Tm(t),i&4&&r!==null&&r.memoizedState.isDehydrated)try{vL(e.containerInfo)}catch(y){Xs(t,t.return,y)}break;case 4:Cp(e,t),Tm(t);break;case 13:Cp(e,t),Tm(t),n=t.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(Zie=co())),i&4&&jhe(t);break;case 22:if(u=r!==null&&r.memoizedState!==null,t.mode&1?(Hl=(c=Hl)||u,Cp(e,t),Hl=c):Cp(e,t),Tm(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(Pt=t,u=t.child;u!==null;){for(h=Pt=u;Pt!==null;){switch(p=Pt,f=p.child,p.tag){case 0:case 11:case 14:case 15:oI(4,p,p.return);break;case 1:XC(p,p.return);var g=p.stateNode;if(typeof g.componentWillUnmount=="function"){i=p,r=p.return;try{e=i,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(y){Xs(i,r,y)}}break;case 5:XC(p,p.return);break;case 22:if(p.memoizedState!==null){qhe(h);continue}}f!==null?(f.return=p,Pt=f):qhe(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{n=h.stateNode,c?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=LTe("display",o))}catch(y){Xs(t,t.return,y)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(y){Xs(t,t.return,y)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Cp(e,t),Tm(t),i&4&&jhe(t);break;case 21:break;default:Cp(e,t),Tm(t)}}function Tm(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(aEe(r)){var i=r;break e}r=r.return}throw Error(ke(160))}switch(i.tag){case 5:var n=i.stateNode;i.flags&32&&(mL(n,""),i.flags&=-33);var s=Ghe(t);UX(t,s,n);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Ghe(t);kX(t,a,o);break;default:throw Error(ke(161))}}catch(l){Xs(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Vje(t,e,r){Pt=t,uEe(t)}function uEe(t,e,r){for(var i=(t.mode&1)!==0;Pt!==null;){var n=Pt,s=n.child;if(n.tag===22&&i){var o=n.memoizedState!==null||S4;if(!o){var a=n.alternate,l=a!==null&&a.memoizedState!==null||Hl;a=S4;var c=Hl;if(S4=o,(Hl=l)&&!c)for(Pt=n;Pt!==null;)o=Pt,l=o.child,o.tag===22&&o.memoizedState!==null?Whe(n):l!==null?(l.return=o,Pt=l):Whe(n);for(;s!==null;)Pt=s,uEe(s),s=s.sibling;Pt=n,S4=a,Hl=c}Hhe(t)}else n.subtreeFlags&8772&&s!==null?(s.return=n,Pt=s):Hhe(t)}}function Hhe(t){for(;Pt!==null;){var e=Pt;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Hl||VV(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Hl)if(r===null)i.componentDidMount();else{var n=e.elementType===e.type?r.memoizedProps:pf(e.type,r.memoizedProps);i.componentDidUpdate(n,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Ahe(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}Ahe(e,o,r)}break;case 5:var a=e.stateNode;if(r===null&&e.flags&4){r=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&vL(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ke(163))}Hl||e.flags&512&&FX(e)}catch(p){Xs(e,e.return,p)}}if(e===t){Pt=null;break}if(r=e.sibling,r!==null){r.return=e.return,Pt=r;break}Pt=e.return}}function qhe(t){for(;Pt!==null;){var e=Pt;if(e===t){Pt=null;break}var r=e.sibling;if(r!==null){r.return=e.return,Pt=r;break}Pt=e.return}}function Whe(t){for(;Pt!==null;){var e=Pt;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{VV(4,e)}catch(l){Xs(e,r,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var n=e.return;try{i.componentDidMount()}catch(l){Xs(e,n,l)}}var s=e.return;try{FX(e)}catch(l){Xs(e,s,l)}break;case 5:var o=e.return;try{FX(e)}catch(l){Xs(e,o,l)}}}catch(l){Xs(e,e.return,l)}if(e===t){Pt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Pt=a;break}Pt=e.return}}var Bje=Math.ceil,kU=v_.ReactCurrentDispatcher,Yie=v_.ReactCurrentOwner,Jd=v_.ReactCurrentBatchConfig,Ri=0,ka=null,Vo=null,ll=0,bh=0,ZC=ew(0),oa=0,ML=null,IT=0,BV=0,Xie=0,aI=null,yu=null,Zie=0,TP=1/0,g0=null,UU=!1,zX=null,eb=null,T4=!1,$v=null,zU=0,lI=0,VX=null,Xk=-1,Zk=0;function Ic(){return Ri&6?co():Xk!==-1?Xk:Xk=co()}function tb(t){return t.mode&1?Ri&2&&ll!==0?ll&-ll:Eje.transition!==null?(Zk===0&&(Zk=WTe()),Zk):(t=yn,t!==0||(t=window.event,t=t===void 0?16:e2e(t.type)),t):1}function Wf(t,e,r,i){if(50<lI)throw lI=0,VX=null,Error(ke(185));HD(t,r,i),(!(Ri&2)||t!==ka)&&(t===ka&&(!(Ri&2)&&(BV|=r),oa===4&&Tv(t,ll)),Nu(t,i),r===1&&Ri===0&&!(e.mode&1)&&(TP=co()+500,kV&&tw()))}function Nu(t,e){var r=t.callbackNode;EGe(t,e);var i=SU(t,t===ka?ll:0);if(i===0)r!==null&&rhe(r),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(r!=null&&rhe(r),e===1)t.tag===0?Tje(Yhe.bind(null,t)):v2e(Yhe.bind(null,t)),bje(function(){!(Ri&6)&&tw()}),r=null;else{switch(YTe(i)){case 1:r=xie;break;case 4:r=HTe;break;case 16:r=xU;break;case 536870912:r=qTe;break;default:r=xU}r=_Ee(r,hEe.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function hEe(t,e){if(Xk=-1,Zk=0,Ri&6)throw Error(ke(327));var r=t.callbackNode;if(L3()&&t.callbackNode!==r)return null;var i=SU(t,t===ka?ll:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=VU(t,i);else{e=i;var n=Ri;Ri|=2;var s=pEe();(ka!==t||ll!==e)&&(g0=null,TP=co()+500,oT(t,e));do try{Hje();break}catch(a){dEe(t,a)}while(!0);Die(),kU.current=s,Ri=n,Vo!==null?e=0:(ka=null,ll=0,e=oa)}if(e!==0){if(e===2&&(n=fX(t),n!==0&&(i=n,e=BX(t,n))),e===1)throw r=ML,oT(t,0),Tv(t,i),Nu(t,co()),r;if(e===6)Tv(t,i);else{if(n=t.current.alternate,!(i&30)&&!Gje(n)&&(e=VU(t,i),e===2&&(s=fX(t),s!==0&&(i=s,e=BX(t,s))),e===1))throw r=ML,oT(t,0),Tv(t,i),Nu(t,co()),r;switch(t.finishedWork=n,t.finishedLanes=i,e){case 0:case 1:throw Error(ke(345));case 2:mx(t,yu,g0);break;case 3:if(Tv(t,i),(i&130023424)===i&&(e=Zie+500-co(),10<e)){if(SU(t,0)!==0)break;if(n=t.suspendedLanes,(n&i)!==i){Ic(),t.pingedLanes|=t.suspendedLanes&n;break}t.timeoutHandle=xX(mx.bind(null,t,yu,g0),e);break}mx(t,yu,g0);break;case 4:if(Tv(t,i),(i&4194240)===i)break;for(e=t.eventTimes,n=-1;0<i;){var o=31-qf(i);s=1<<o,o=e[o],o>n&&(n=o),i&=~s}if(i=n,i=co()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Bje(i/1960))-i,10<i){t.timeoutHandle=xX(mx.bind(null,t,yu,g0),i);break}mx(t,yu,g0);break;case 5:mx(t,yu,g0);break;default:throw Error(ke(329))}}}return Nu(t,co()),t.callbackNode===r?hEe.bind(null,t):null}function BX(t,e){var r=aI;return t.current.memoizedState.isDehydrated&&(oT(t,e).flags|=256),t=VU(t,e),t!==2&&(e=yu,yu=r,e!==null&&GX(e)),t}function GX(t){yu===null?yu=t:yu.push.apply(yu,t)}function Gje(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var n=r[i],s=n.getSnapshot;n=n.value;try{if(!om(s(),n))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Tv(t,e){for(e&=~Xie,e&=~BV,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-qf(e),i=1<<r;t[r]=-1,e&=~i}}function Yhe(t){if(Ri&6)throw Error(ke(327));L3();var e=SU(t,0);if(!(e&1))return Nu(t,co()),null;var r=VU(t,e);if(t.tag!==0&&r===2){var i=fX(t);i!==0&&(e=i,r=BX(t,i))}if(r===1)throw r=ML,oT(t,0),Tv(t,e),Nu(t,co()),r;if(r===6)throw Error(ke(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,mx(t,yu,g0),Nu(t,co()),null}function Jie(t,e){var r=Ri;Ri|=1;try{return t(e)}finally{Ri=r,Ri===0&&(TP=co()+500,kV&&tw())}}function LT(t){$v!==null&&$v.tag===0&&!(Ri&6)&&L3();var e=Ri;Ri|=1;var r=Jd.transition,i=yn;try{if(Jd.transition=null,yn=1,t)return t()}finally{yn=i,Jd.transition=r,Ri=e,!(Ri&6)&&tw()}}function Qie(){bh=ZC.current,as(ZC)}function oT(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,vje(r)),Vo!==null)for(r=Vo.return;r!==null;){var i=r;switch($ie(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&AU();break;case 3:xP(),as(Lu),as(Jl),Vie();break;case 5:zie(i);break;case 4:xP();break;case 13:as(Ps);break;case 19:as(Ps);break;case 10:Nie(i.type._context);break;case 22:case 23:Qie()}r=r.return}if(ka=t,Vo=t=rb(t.current,null),ll=bh=e,oa=0,ML=null,Xie=BV=IT=0,yu=aI=null,BS!==null){for(e=0;e<BS.length;e++)if(r=BS[e],i=r.interleaved,i!==null){r.interleaved=null;var n=i.next,s=r.pending;if(s!==null){var o=s.next;s.next=n,i.next=o}r.pending=i}BS=null}return t}function dEe(t,e){do{var r=Vo;try{if(Die(),qk.current=FU,NU){for(var i=Rs.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}NU=!1}if($T=0,Ma=ra=Rs=null,sI=!1,PL=0,Yie.current=null,r===null||r.return===null){oa=1,ML=e,Vo=null;break}e:{var s=t,o=r.return,a=r,l=e;if(e=ll,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=Dhe(o);if(f!==null){f.flags&=-257,Nhe(f,o,a,s,e),f.mode&1&&Lhe(s,c,e),e=f,l=c;var g=e.updateQueue;if(g===null){var y=new Set;y.add(l),e.updateQueue=y}else g.add(l);break e}else{if(!(e&1)){Lhe(s,c,e),Kie();break e}l=Error(ke(426))}}else if(vs&&a.mode&1){var v=Dhe(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),Nhe(v,o,a,s,e),Iie(SP(l,a));break e}}s=l=SP(l,a),oa!==4&&(oa=2),aI===null?aI=[s]:aI.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var b=X2e(s,l,e);Phe(s,b);break e;case 1:a=l;var w=s.type,x=s.stateNode;if(!(s.flags&128)&&(typeof w.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(eb===null||!eb.has(x)))){s.flags|=65536,e&=-e,s.lanes|=e;var S=Z2e(s,a,e);Phe(s,S);break e}}s=s.return}while(s!==null)}mEe(r)}catch(E){e=E,Vo===r&&r!==null&&(Vo=r=r.return);continue}break}while(!0)}function pEe(){var t=kU.current;return kU.current=FU,t===null?FU:t}function Kie(){(oa===0||oa===3||oa===2)&&(oa=4),ka===null||!(IT&268435455)&&!(BV&268435455)||Tv(ka,ll)}function VU(t,e){var r=Ri;Ri|=2;var i=pEe();(ka!==t||ll!==e)&&(g0=null,oT(t,e));do try{jje();break}catch(n){dEe(t,n)}while(!0);if(Die(),Ri=r,kU.current=i,Vo!==null)throw Error(ke(261));return ka=null,ll=0,oa}function jje(){for(;Vo!==null;)fEe(Vo)}function Hje(){for(;Vo!==null&&!gGe();)fEe(Vo)}function fEe(t){var e=yEe(t.alternate,t,bh);t.memoizedProps=t.pendingProps,e===null?mEe(t):Vo=e,Yie.current=null}function mEe(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=kje(r,e),r!==null){r.flags&=32767,Vo=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{oa=6,Vo=null;return}}else if(r=Fje(r,e,bh),r!==null){Vo=r;return}if(e=e.sibling,e!==null){Vo=e;return}Vo=e=t}while(e!==null);oa===0&&(oa=5)}function mx(t,e,r){var i=yn,n=Jd.transition;try{Jd.transition=null,yn=1,qje(t,e,r,i)}finally{Jd.transition=n,yn=i}return null}function qje(t,e,r,i){do L3();while($v!==null);if(Ri&6)throw Error(ke(327));r=t.finishedWork;var n=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(ke(177));t.callbackNode=null,t.callbackPriority=0;var s=r.lanes|r.childLanes;if(CGe(t,s),t===ka&&(Vo=ka=null,ll=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||T4||(T4=!0,_Ee(xU,function(){return L3(),null})),s=(r.flags&15990)!==0,r.subtreeFlags&15990||s){s=Jd.transition,Jd.transition=null;var o=yn;yn=1;var a=Ri;Ri|=4,Yie.current=null,zje(t,r),cEe(r,t),dje(bX),TU=!!vX,bX=vX=null,t.current=r,Vje(r),yGe(),Ri=a,yn=o,Jd.transition=s}else t.current=r;if(T4&&(T4=!1,$v=t,zU=n),s=t.pendingLanes,s===0&&(eb=null),bGe(r.stateNode),Nu(t,co()),e!==null)for(i=t.onRecoverableError,r=0;r<e.length;r++)n=e[r],i(n.value,{componentStack:n.stack,digest:n.digest});if(UU)throw UU=!1,t=zX,zX=null,t;return zU&1&&t.tag!==0&&L3(),s=t.pendingLanes,s&1?t===VX?lI++:(lI=0,VX=t):lI=0,tw(),null}function L3(){if($v!==null){var t=YTe(zU),e=Jd.transition,r=yn;try{if(Jd.transition=null,yn=16>t?16:t,$v===null)var i=!1;else{if(t=$v,$v=null,zU=0,Ri&6)throw Error(ke(331));var n=Ri;for(Ri|=4,Pt=t.current;Pt!==null;){var s=Pt,o=s.child;if(Pt.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(Pt=c;Pt!==null;){var u=Pt;switch(u.tag){case 0:case 11:case 15:oI(8,u,s)}var h=u.child;if(h!==null)h.return=u,Pt=h;else for(;Pt!==null;){u=Pt;var p=u.sibling,f=u.return;if(oEe(u),u===c){Pt=null;break}if(p!==null){p.return=f,Pt=p;break}Pt=f}}}var g=s.alternate;if(g!==null){var y=g.child;if(y!==null){g.child=null;do{var v=y.sibling;y.sibling=null,y=v}while(y!==null)}}Pt=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,Pt=o;else e:for(;Pt!==null;){if(s=Pt,s.flags&2048)switch(s.tag){case 0:case 11:case 15:oI(9,s,s.return)}var b=s.sibling;if(b!==null){b.return=s.return,Pt=b;break e}Pt=s.return}}var w=t.current;for(Pt=w;Pt!==null;){o=Pt;var x=o.child;if(o.subtreeFlags&2064&&x!==null)x.return=o,Pt=x;else e:for(o=w;Pt!==null;){if(a=Pt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:VV(9,a)}}catch(E){Xs(a,a.return,E)}if(a===o){Pt=null;break e}var S=a.sibling;if(S!==null){S.return=a.return,Pt=S;break e}Pt=a.return}}if(Ri=n,tw(),Hg&&typeof Hg.onPostCommitFiberRoot=="function")try{Hg.onPostCommitFiberRoot(IV,t)}catch{}i=!0}return i}finally{yn=r,Jd.transition=e}}return!1}function Xhe(t,e,r){e=SP(r,e),e=X2e(t,e,1),t=Kv(t,e,1),e=Ic(),t!==null&&(HD(t,1,e),Nu(t,e))}function Xs(t,e,r){if(t.tag===3)Xhe(t,t,r);else for(;e!==null;){if(e.tag===3){Xhe(e,t,r);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(eb===null||!eb.has(i))){t=SP(r,t),t=Z2e(e,t,1),e=Kv(e,t,1),t=Ic(),e!==null&&(HD(e,1,t),Nu(e,t));break}}e=e.return}}function Wje(t,e,r){var i=t.pingCache;i!==null&&i.delete(e),e=Ic(),t.pingedLanes|=t.suspendedLanes&r,ka===t&&(ll&r)===r&&(oa===4||oa===3&&(ll&130023424)===ll&&500>co()-Zie?oT(t,0):Xie|=r),Nu(t,e)}function gEe(t,e){e===0&&(t.mode&1?(e=f4,f4<<=1,!(f4&130023424)&&(f4=4194304)):e=1);var r=Ic();t=t_(t,e),t!==null&&(HD(t,e,r),Nu(t,r))}function Yje(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),gEe(t,r)}function Xje(t,e){var r=0;switch(t.tag){case 13:var i=t.stateNode,n=t.memoizedState;n!==null&&(r=n.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(ke(314))}i!==null&&i.delete(e),gEe(t,r)}var yEe;yEe=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||Lu.current)Pu=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return Pu=!1,Nje(t,e,r);Pu=!!(t.flags&131072)}else Pu=!1,vs&&e.flags&1048576&&b2e(e,RU,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Yk(t,e),t=e.pendingProps;var n=vP(e,Jl.current);I3(e,r),n=Gie(null,e,i,t,n,r);var s=jie();return e.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Du(i)?(s=!0,OU(e)):s=!1,e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,kie(e),n.updater=UV,e.stateNode=n,n._reactInternals=e,OX(e,i,t,r),e=$X(null,e,i,!0,s,r)):(e.tag=0,vs&&s&&Rie(e),Tc(null,e,n,r),e=e.child),e;case 16:i=e.elementType;e:{switch(Yk(t,e),t=e.pendingProps,n=i._init,i=n(i._payload),e.type=i,n=e.tag=Jje(i),t=pf(i,t),n){case 0:e=RX(null,e,i,t,r);break e;case 1:e=Uhe(null,e,i,t,r);break e;case 11:e=Fhe(null,e,i,t,r);break e;case 14:e=khe(null,e,i,pf(i.type,t),r);break e}throw Error(ke(306,i,""))}return e;case 0:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:pf(i,n),RX(t,e,i,n,r);case 1:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:pf(i,n),Uhe(t,e,i,n,r);case 3:e:{if(eEe(e),t===null)throw Error(ke(387));i=e.pendingProps,s=e.memoizedState,n=s.element,T2e(t,e),LU(e,i,null,r);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){n=SP(Error(ke(423)),e),e=zhe(t,e,i,r,n);break e}else if(i!==n){n=SP(Error(ke(424)),e),e=zhe(t,e,i,r,n);break e}else for($h=Qv(e.stateNode.containerInfo.firstChild),Lh=e,vs=!0,Pf=null,r=A2e(e,null,i,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(bP(),i===n){e=r_(t,e,r);break e}Tc(t,e,i,r)}e=e.child}return e;case 5:return O2e(e),t===null&&CX(e),i=e.type,n=e.pendingProps,s=t!==null?t.memoizedProps:null,o=n.children,wX(i,n)?o=null:s!==null&&wX(i,s)&&(e.flags|=32),K2e(t,e),Tc(t,e,o,r),e.child;case 6:return t===null&&CX(e),null;case 13:return tEe(t,e,r);case 4:return Uie(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=wP(e,null,i,r):Tc(t,e,i,r),e.child;case 11:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:pf(i,n),Fhe(t,e,i,n,r);case 7:return Tc(t,e,e.pendingProps,r),e.child;case 8:return Tc(t,e,e.pendingProps.children,r),e.child;case 12:return Tc(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(i=e.type._context,n=e.pendingProps,s=e.memoizedProps,o=n.value,qn($U,i._currentValue),i._currentValue=o,s!==null)if(om(s.value,o)){if(s.children===n.children&&!Lu.current){e=r_(t,e,r);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=z0(-1,r&-r),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=r,l=s.alternate,l!==null&&(l.lanes|=r),PX(s.return,r,e),a.lanes|=r;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(ke(341));o.lanes|=r,a=o.alternate,a!==null&&(a.lanes|=r),PX(o,r,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Tc(t,e,n.children,r),e=e.child}return e;case 9:return n=e.type,i=e.pendingProps.children,I3(e,r),n=rp(n),i=i(n),e.flags|=1,Tc(t,e,i,r),e.child;case 14:return i=e.type,n=pf(i,e.pendingProps),n=pf(i.type,n),khe(t,e,i,n,r);case 15:return J2e(t,e,e.type,e.pendingProps,r);case 17:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:pf(i,n),Yk(t,e),e.tag=1,Du(i)?(t=!0,OU(e)):t=!1,I3(e,r),C2e(e,i,n),OX(e,i,n,r),$X(null,e,i,!0,t,r);case 19:return rEe(t,e,r);case 22:return Q2e(t,e,r)}throw Error(ke(156,e.tag))};function _Ee(t,e){return jTe(t,e)}function Zje(t,e,r,i){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function jd(t,e,r,i){return new Zje(t,e,r,i)}function ene(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Jje(t){if(typeof t=="function")return ene(t)?1:0;if(t!=null){if(t=t.$$typeof,t===vie)return 11;if(t===bie)return 14}return 2}function rb(t,e){var r=t.alternate;return r===null?(r=jd(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function Jk(t,e,r,i,n,s){var o=2;if(i=t,typeof t=="function")ene(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case zC:return aT(r.children,n,s,e);case _ie:o=8,n|=8;break;case KY:return t=jd(12,r,e,n|2),t.elementType=KY,t.lanes=s,t;case eX:return t=jd(13,r,e,n),t.elementType=eX,t.lanes=s,t;case tX:return t=jd(19,r,e,n),t.elementType=tX,t.lanes=s,t;case PTe:return GV(r,n,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case ETe:o=10;break e;case CTe:o=9;break e;case vie:o=11;break e;case bie:o=14;break e;case cv:o=16,i=null;break e}throw Error(ke(130,t==null?t:typeof t,""))}return e=jd(o,r,e,n),e.elementType=t,e.type=i,e.lanes=s,e}function aT(t,e,r,i){return t=jd(7,t,i,e),t.lanes=r,t}function GV(t,e,r,i){return t=jd(22,t,i,e),t.elementType=PTe,t.lanes=r,t.stateNode={isHidden:!1},t}function wj(t,e,r){return t=jd(6,t,null,e),t.lanes=r,t}function xj(t,e,r){return e=jd(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Qje(t,e,r,i,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rj(0),this.expirationTimes=rj(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rj(0),this.identifierPrefix=i,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function tne(t,e,r,i,n,s,o,a,l){return t=new Qje(t,e,r,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=jd(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},kie(s),t}function Kje(t,e,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:UC,key:i==null?null:""+i,children:t,containerInfo:e,implementation:r}}function vEe(t){if(!t)return gb;t=t._reactInternals;e:{if(p2(t)!==t||t.tag!==1)throw Error(ke(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Du(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ke(171))}if(t.tag===1){var r=t.type;if(Du(r))return _2e(t,r,e)}return e}function bEe(t,e,r,i,n,s,o,a,l){return t=tne(r,i,!0,t,n,s,o,a,l),t.context=vEe(null),r=t.current,i=Ic(),n=tb(r),s=z0(i,n),s.callback=e??null,Kv(r,s,n),t.current.lanes=n,HD(t,n,i),Nu(t,i),t}function jV(t,e,r,i){var n=e.current,s=Ic(),o=tb(n);return r=vEe(r),e.context===null?e.context=r:e.pendingContext=r,e=z0(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Kv(n,e,o),t!==null&&(Wf(t,n,o,s),Hk(t,n,o)),o}function BU(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Zhe(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function rne(t,e){Zhe(t,e),(t=t.alternate)&&Zhe(t,e)}function eHe(){return null}var wEe=typeof reportError=="function"?reportError:function(t){console.error(t)};function ine(t){this._internalRoot=t}HV.prototype.render=ine.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ke(409));jV(t,e,null,null)};HV.prototype.unmount=ine.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;LT(function(){jV(null,t,null,null)}),e[e_]=null}};function HV(t){this._internalRoot=t}HV.prototype.unstable_scheduleHydration=function(t){if(t){var e=JTe();t={blockedOn:null,target:t,priority:e};for(var r=0;r<Sv.length&&e!==0&&e<Sv[r].priority;r++);Sv.splice(r,0,t),r===0&&KTe(t)}};function nne(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function qV(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Jhe(){}function tHe(t,e,r,i,n){if(n){if(typeof i=="function"){var s=i;i=function(){var c=BU(o);s.call(c)}}var o=bEe(e,i,t,0,null,!1,!1,"",Jhe);return t._reactRootContainer=o,t[e_]=o.current,xL(t.nodeType===8?t.parentNode:t),LT(),o}for(;n=t.lastChild;)t.removeChild(n);if(typeof i=="function"){var a=i;i=function(){var c=BU(l);a.call(c)}}var l=tne(t,0,!1,null,null,!1,!1,"",Jhe);return t._reactRootContainer=l,t[e_]=l.current,xL(t.nodeType===8?t.parentNode:t),LT(function(){jV(e,l,r,i)}),l}function WV(t,e,r,i,n){var s=r._reactRootContainer;if(s){var o=s;if(typeof n=="function"){var a=n;n=function(){var l=BU(o);a.call(l)}}jV(e,o,t,n)}else o=tHe(r,e,t,n,i);return BU(o)}XTe=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=GM(e.pendingLanes);r!==0&&(Sie(e,r|1),Nu(e,co()),!(Ri&6)&&(TP=co()+500,tw()))}break;case 13:LT(function(){var i=t_(t,1);if(i!==null){var n=Ic();Wf(i,t,1,n)}}),rne(t,1)}};Tie=function(t){if(t.tag===13){var e=t_(t,134217728);if(e!==null){var r=Ic();Wf(e,t,134217728,r)}rne(t,134217728)}};ZTe=function(t){if(t.tag===13){var e=tb(t),r=t_(t,e);if(r!==null){var i=Ic();Wf(r,t,e,i)}rne(t,e)}};JTe=function(){return yn};QTe=function(t,e){var r=yn;try{return yn=t,e()}finally{yn=r}};hX=function(t,e,r){switch(e){case"input":if(nX(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var i=r[e];if(i!==t&&i.form===t.form){var n=FV(i);if(!n)throw Error(ke(90));OTe(i),nX(i,n)}}}break;case"textarea":RTe(t,r);break;case"select":e=r.value,e!=null&&O3(t,!!r.multiple,e,!1)}};kTe=Jie;UTe=LT;var rHe={usingClientEntryPoint:!1,Events:[WD,jC,FV,NTe,FTe,Jie]},AO={findFiberByHostInstance:VS,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},iHe={bundleType:AO.bundleType,version:AO.version,rendererPackageName:AO.rendererPackageName,rendererConfig:AO.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:v_.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=BTe(t),t===null?null:t.stateNode},findFiberByHostInstance:AO.findFiberByHostInstance||eHe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var E4=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!E4.isDisabled&&E4.supportsFiber)try{IV=E4.inject(iHe),Hg=E4}catch{}}Yh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rHe;Yh.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nne(e))throw Error(ke(200));return Kje(t,e,null,r)};Yh.createRoot=function(t,e){if(!nne(t))throw Error(ke(299));var r=!1,i="",n=wEe;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(n=e.onRecoverableError)),e=tne(t,1,!1,null,null,r,!1,i,n),t[e_]=e.current,xL(t.nodeType===8?t.parentNode:t),new ine(e)};Yh.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ke(188)):(t=Object.keys(t).join(","),Error(ke(268,t)));return t=BTe(e),t=t===null?null:t.stateNode,t};Yh.flushSync=function(t){return LT(t)};Yh.hydrate=function(t,e,r){if(!qV(e))throw Error(ke(200));return WV(null,t,e,!0,r)};Yh.hydrateRoot=function(t,e,r){if(!nne(t))throw Error(ke(405));var i=r!=null&&r.hydratedSources||null,n=!1,s="",o=wEe;if(r!=null&&(r.unstable_strictMode===!0&&(n=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),e=bEe(e,null,t,1,r??null,n,!1,s,o),t[e_]=e.current,xL(t),i)for(t=0;t<i.length;t++)r=i[t],n=r._getVersion,n=n(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,n]:e.mutableSourceEagerHydrationData.push(r,n);return new HV(e)};Yh.render=function(t,e,r){if(!qV(e))throw Error(ke(200));return WV(null,t,e,!1,r)};Yh.unmountComponentAtNode=function(t){if(!qV(t))throw Error(ke(40));return t._reactRootContainer?(LT(function(){WV(null,null,t,!1,function(){t._reactRootContainer=null,t[e_]=null})}),!0):!1};Yh.unstable_batchedUpdates=Jie;Yh.unstable_renderSubtreeIntoContainer=function(t,e,r,i){if(!qV(r))throw Error(ke(200));if(t==null||t._reactInternals===void 0)throw Error(ke(38));return WV(t,e,r,!1,i)};Yh.version="18.2.0-next-9e3b772b8-20220608";function xEe(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(xEe)}catch(t){console.error(t)}}xEe(),bTe.exports=Yh;var nHe=bTe.exports,Qhe=nHe;JY.createRoot=Qhe.createRoot,JY.hydrateRoot=Qhe.hydrateRoot;function d(t,e,r,i){var n,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o}function iHt(t,e){return function(r,i){e(r,i,t)}}function nHt(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(h){o(h)}}function l(u){try{c(i.throw(u))}catch(h){o(h)}}function c(u){u.done?s(u.value):n(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}const sHe="modulepreload",oHe=function(t){return"/JSAPI_demos/low-poly-globe/"+t},Khe={},re=function(e,r,i){let n=Promise.resolve();if(r&&r.length>0){const s=document.getElementsByTagName("link");n=Promise.all(r.map(o=>{if(o=oHe(o),o in Khe)return;Khe[o]=!0;const a=o.endsWith(".css"),l=a?'[rel="stylesheet"]':"";if(!!i)for(let h=s.length-1;h>=0;h--){const p=s[h];if(p.href===o&&(!a||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${l}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":sHe,a||(u.as="script",u.crossOrigin=""),u.href=o,document.head.appendChild(u),a)return new Promise((h,p)=>{u.addEventListener("load",h),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${o}`)))})}))}return n.then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})};let Iv;function ne(t){return typeof Iv[t]=="function"?Iv[t]=Iv[t](globalThis):Iv[t]}var rTe,iTe,nTe,sTe;Iv=(rTe=globalThis.dojoConfig)!=null&&rTe.has||(iTe=globalThis.esriConfig)!=null&&iTe.has?{...(nTe=globalThis.dojoConfig)==null?void 0:nTe.has,...(sTe=globalThis.esriConfig)==null?void 0:sTe.has}:{},ne.add=(t,e,r,i)=>((i||Iv[t]===void 0)&&(Iv[t]=e),r&&ne(t)),ne.cache=Iv,ne.add("big-integer-warning-enabled",!0),ne.add("esri-deprecation-warnings",!0),ne.add("esri-tests-disable-screenshots",!1),ne.add("esri-tests-use-full-window",!1),ne.add("esri-tests-post-to-influx",!0),(()=>{var e;ne.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(ne.add("host-browser",t),ne.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),ne.add("dom",t),ne("host-browser")){const r=navigator,i=r.userAgent,n=r.appVersion,s=parseFloat(n);if(ne.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),ne.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),ne.add("khtml",n.includes("Konqueror")?s:void 0),ne.add("edge",parseFloat(i.split("Edge/")[1])||void 0),ne.add("opr",parseFloat(i.split("OPR/")[1])||void 0),ne.add("webkit",!ne("wp")&&!ne("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),ne.add("chrome",!ne("edge")&&!ne("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),ne.add("android",!ne("wp")&&parseFloat(i.split("Android ")[1])||void 0),ne.add("safari",!n.includes("Safari")||ne("wp")||ne("chrome")||ne("android")||ne("edge")||ne("opr")?void 0:parseFloat(n.split("Version/")[1])),ne.add("mac",n.includes("Macintosh")),!ne("wp")&&/(iPhone|iPod|iPad)/.test(i)){const o=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replaceAll("_",""));ne.add(o,l),ne.add("ios",l)}ne("webkit")||(!i.includes("Gecko")||ne("wp")||ne("khtml")||ne("edge")||ne.add("mozilla",s),ne("mozilla")&&ne.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),r=/iPhone/i.test(t);e&&ne.add("esri-mobile",e),r&&ne.add("esri-iPhone",r),ne.add("esri-geolocation",!!navigator.geolocation)}ne.add("esri-wasm","WebAssembly"in globalThis),ne.add("esri-performance-mode-frames-between-render",20),ne.add("esri-force-performance-mode",!1),ne.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),ne.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),ne.add("esri-atomics","Atomics"in globalThis),ne.add("esri-workers","Worker"in globalThis),ne.add("web-feat:cache","caches"in globalThis),ne.add("esri-workers-arraybuffer-transfer",!ne("safari")||Number(ne("safari"))>=12),ne.add("workers-pool-size",8),ne.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ne.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ne.add("featurelayer-fast-triangulation-enabled",!0),ne.add("featurelayer-animation-enabled",!0),ne.add("featurelayer-snapshot-enabled",!0),ne.add("featurelayer-snapshot-point-min-threshold",8e4),ne.add("featurelayer-snapshot-point-max-threshold",4e5),ne.add("featurelayer-snapshot-point-coverage",.1),ne.add("featurelayer-query-max-depth",4),ne.add("featurelayer-query-pausing-enabled",!1),ne.add("hittest-2d-mobile-tolerance",3),ne.add("hittest-2d-desktop-tolerance",1),ne.add("hittest-2d-small-symbol-tolerance",3),ne.add("hittest-2d-small-symbol-tolerance-threshold",3),ne.add("featurelayer-advanced-symbols",!1),ne.add("featurelayer-pbf",!0),ne.add("featurelayer-pbf-statistics",!1),ne.add("feature-layers-workers",!0),ne.add("feature-polyline-generalization-factor",1),ne.add("mapview-transitions-duration",200),ne.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ne.add("mapserver-pbf-version-support",10.81),ne.add("mapservice-popup-identify-max-tolerance",20),ne("host-webworker")||ne("host-browser")&&(ne.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ne.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{ne.add("esri-image-decode",!0,!0,!0)}).catch(()=>{ne.add("esri-image-decode",!1,!0,!0)})}return!1}),ne.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();let lT=class gx{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*gx._m}getInt(){return this._seed=(gx._a*this._seed+gx._c)%gx._m,this._seed}getFloat(){return this.getInt()/(gx._m-1)}getIntRange(e,r){return Math.round(this.getFloatRange(e,r))}getFloatRange(e,r){const i=r-e;return e+this.getInt()/gx._m*i}};lT._m=2147483647,lT._a=48271,lT._c=0;const YV=1.5,aHe=1/YV,lHe=.5;function sHt(t,e){for(let r=t.length-1;r>=0;r--){const i=t[r];if(e(i))return i}}function XV(t,e){return e?t.filter((r,i,n)=>n.findIndex(e.bind(null,r))===i):Array.from(new Set(t))}function ny(t,e,r){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function SEe(t,e){let r=t.length!==e.length;r&&(t.length=e.length);for(let i=0;i<e.length;++i)t[i]!==e[i]&&(t[i]=e[i],r=!0);return r}function jX(t,e,r){let i,n;return r?(i=e.filter(s=>!t.some(o=>r(o,s))),n=t.filter(s=>!e.some(o=>r(o,s)))):(i=e.filter(s=>!t.includes(s)),n=t.filter(s=>!e.includes(s))),{added:i,removed:n}}function cHe(t){return t&&typeof t.length=="number"}function uHe(t,e){const r=t.length;if(r===0)return[];const i=[];for(let n=0;n<r;n+=e)i.push(t.slice(n,n+e));return i}const hHe=!!Array.prototype.fill;function dHe(t,e){if(hHe)return new Array(t).fill(e);const r=new Array(t);for(let i=0;i<t;i++)r[i]=e;return r}function pHe(t,e){e===void 0&&(e=t,t=0);const r=new Array(e-t);for(let i=t;i<e;i++)r[i-t]=i;return r}function TEe(t,e,r){const i=t.length;let n=0,s=i-1;for(;n<s;){const a=n+Math.floor((s-n)/2);e>t[a]?n=a+1:s=a}const o=t[n];return r?e>=t[i-1]?-1:o===e?n:n-1:o===e?n:-1}let EEe=class{constructor(){this.last=0}};const CEe=new EEe;function HX(t,e,r,i){i=i||CEe;const n=Math.max(0,i.last-10);for(let o=n;o<r;++o)if(t[o]===e)return i.last=o,o;const s=Math.min(n,r);for(let o=0;o<s;++o)if(t[o]===e)return i.last=o,o;return-1}function RL(t,e,r,i){const n=r??t.length,s=HX(t,e,n,i);if(s!==-1)return t[s]=t[n-1],r==null&&t.pop(),e}const Pp=new Set;function fHe(t,e,r=t.length,i=e.length,n,s){if(i===0||r===0)return r;Pp.clear();for(let a=0;a<i;++a)Pp.add(e[a]);n=n||CEe;const o=Math.max(0,n.last-10);for(let a=o;a<r;++a)if(Pp.has(t[a])&&(s==null||s.push(t[a]),Pp.delete(t[a]),t[a]=t[r-1],--r,--a,Pp.size===0||r===0))return Pp.clear(),r;for(let a=0;a<o;++a)if(Pp.has(t[a])&&(s==null||s.push(t[a]),Pp.delete(t[a]),t[a]=t[r-1],--r,--a,Pp.size===0||r===0))return Pp.clear(),r;return Pp.clear(),r}function mHe(t,e){let r=0;for(let i=0;i<t.length;++i){const n=t[i];e(n,i)&&(t[r]=n,r++)}t.length=r}function gHe(t){return t?(ede.seed=t,()=>ede.getFloat()):Math.random}function aHt(t,e){const r=gHe(e);for(let i=t.length-1;i>0;i--){const n=Math.floor(r()*(i+1)),s=t[i];t[i]=t[n],t[n]=s}return t}const ede=new lT;function sne(t,e){const r=t.indexOf(e);return r!==-1?(t.splice(r,1),e):null}function lHt(t,e){const r=new Map,i=t.length;for(let n=0;n<i;n++){const s=t[n],o=e(s,n,t),a=r.get(o);a?a.push(s):r.set(o,[s])}return r}function rw(t,e){return t!=null}const yHe=[];function PEe(t){return 32+t.length}function one(){return 16}function AEe(t){if(!t)return 0;let e=REe;for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];switch(typeof i){case"string":e+=PEe(i);break;case"number":e+=one();break;case"boolean":e+=4}}return e}function OEe(t){if(!t)return 0;if(Array.isArray(t))return _He(t);let e=REe;for(const r in t)t.hasOwnProperty(r)&&(e+=MEe(t[r]));return e}function _He(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let r=$Ee;for(let i=0;i<e;i++)r+=MEe(t[i]);return r}function MEe(t){switch(typeof t){case"object":return OEe(t);case"string":return PEe(t);case"number":return one();case"boolean":return 4;default:return 8}}function vHe(t,e){return $Ee+t.length*e}const REe=32,$Ee=16;function HM(t){return t instanceof ArrayBuffer}function ane(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int8Array"}function Lv(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8Array"}function IEe(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8ClampedArray"}function ZV(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int16Array"}function JV(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint16Array"}function QV(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int32Array"}function KV(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint32Array"}function XD(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float32Array"}function ZD(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float64Array"}function np(t){return!("buffer"in t)}function i_(...t){return t.reduce((e,r)=>e+(r?np(r)?vHe(r,one()):r.byteLength+LEe:0),0)}const LEe=145,Vu=1024;function bHe(t){return ZD(t)||XD(t)||QV(t)||ZV(t)||ane(t)}function wHe(t){return ZD(t)||XD(t)}function xHe(t){return ZD(t)?179769e303:XD(t)?3402823e32:KV(t)?4294967295:JV(t)?65535:Lv(t)||IEe(t)?255:QV(t)?2147483647:ZV(t)?32767:ane(t)?127:256}function DEe(t,e){let r;if(e)for(r in t)t.hasOwnProperty(r)&&(t[r]===void 0?delete t[r]:t[r]instanceof Object&&DEe(t[r],!0));else for(r in t)t.hasOwnProperty(r)&&t[r]===void 0&&delete t[r];return t}function ae(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=kEe(t);if(e!=null)return e;if(GU(t))return t.clone();if(NEe(t))return t.map(ae);if(FEe(t))return t.clone();const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=ae(t[i]);return r}function qX(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=kEe(t);if(e!=null)return e;if(NEe(t)){let r=!0;const i=t.map(n=>{const s=qX(n);return n!=null&&s==null&&(r=!1),s});return r?i:null}if(GU(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!FEe(t)){const r=new(Object.getPrototypeOf(t)).constructor;for(const i of Object.getOwnPropertyNames(t)){const n=t[i],s=qX(n);if(n!=null&&s==null)return null;r[i]=s}return r}return null}function GU(t){return typeof t.clone=="function"}function NEe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function FEe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function tde(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function kEe(t){if(ane(t)||Lv(t)||IEe(t)||ZV(t)||JV(t)||QV(t)||KV(t)||XD(t)||ZD(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[r,i]of t)e.set(r,ae(i));return e}if(t instanceof Set){const e=new Set;for(const r of t)e.add(ae(r));return e}return null}function lne(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t==null?void 0:t.getTime)=="function"&&typeof(e==null?void 0:e.getTime)=="function"&&t.getTime()===e.getTime()||!1}function UEe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&ny(t,e):t instanceof Set?e instanceof Set&&THe(t,e):t instanceof Map?e instanceof Map&&EHe(t,e):!!tde(t)&&tde(e)&&SHe(t,e))}function SHe(t,e){if(t===null||e===null)return!1;const r=Object.keys(t);if(e===null||Object.keys(e).length!==r.length)return!1;for(const i of r)if(t[i]!==e[i]||!Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function THe(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function EHe(t,e){if(t.size!==e.size)return!1;for(const[r,i]of t){const n=e.get(r);if(n!==i||n===void 0&&!e.has(r))return!1}return!0}function cne(t,e,r=!1){return VEe(t,e,r)}function eB(t,e){if(e!=null)return e[t]||zEe(t.split("."),!1,e)}function f2(t,e,r){const i=t.split("."),n=i.pop(),s=zEe(i,!0,r);s&&n&&(s[n]=e)}function zEe(t,e,r){let i=r;for(const n of t){if(i==null)return;if(!(n in i)){if(!e)return;i[n]={}}i=i[n]}return i}function VEe(t,e,r){return e?Object.keys(e).reduce((i,n)=>{let s=i[n],o=e[n];return s===o?i:s===void 0?(i[n]=ae(o),i):(Array.isArray(o)||Array.isArray(i)?(s=s?Array.isArray(s)?i[n]=s.concat():i[n]=[s]:i[n]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{s.includes(a)||s.push(a)}):i[n]=o.concat())):o&&typeof o=="object"?i[n]=VEe(s,o,r):i.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(i[n]=o),i)},t||{}):t}var oTe;const ai={apiKey:void 0,applicationName:"",applicationUrl:(oTe=globalThis.location)==null?void 0:oTe.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(cne(ai,globalThis.esriConfig,!0),delete ai.has),!ai.assetsPath){{const t="4.29";ai.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}ai.defaultAssetsPath=ai.assetsPath}const CHe=/\{([^\}]+)\}/g;function rde(t){return t??""}function une(t,e){return e?t.replaceAll(CHe,typeof e=="object"?(r,i)=>rde(eB(i,e)):(r,i)=>rde(e(i))):t}function cHt(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>e&&e.includes(r)?r:`\\${r}`)}function hne(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}function uHt(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}function hHt(t,e){return new RegExp(`{${e}}`,"ig").test(t)}const ide={info:0,warn:1,error:2,none:3};let K=class Ml{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Ml._loggers.set(this.module,this);const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=Ml.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(e=new Map){const r=Ml._loggers;return Ml._loggers=e,r},set throttlingDisabled(e){Ml._throttlingDisabled=e}}}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,Ml._loggers.get(e)||new Ml({module:e})}_log(e,r,...i){if(this._matchLevel(e)){if(r!=="always"&&!Ml._throttlingDisabled){const n=this._argsToKey(i),s=this._loggedMessages[e].get(n);if(r==="once"&&s!=null||r==="oncePerTick"&&s&&s>=Ml._tickCounter)return;this._loggedMessages[e].set(n,Ml._tickCounter),Ml._scheduleTickCounterIncrement()}for(const n of ai.log.interceptors)if(n(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,r){let i=this;for(;i!=null;){const n=i[e];if(n!=null)return n;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,r,...i){console[e](`[${r}]`,...i)}_matchLevel(e){const r=ai.log.level||"warn";return ide[this._parentWithMember("level",r)]<=ide[e]}_argsToKey(...e){return hne(JSON.stringify(e,(i,n)=>typeof n!="object"||Array.isArray(n)?n:"[Object]"))}static _scheduleTickCounterIncrement(){Ml._tickCounterScheduled||(Ml._tickCounterScheduled=!0,Promise.resolve().then(()=>{Ml._tickCounter++,Ml._tickCounterScheduled=!1}))}};K._loggers=new Map,K._tickCounter=0,K._tickCounterScheduled=!1,K._throttlingDisabled=!1;function PHe(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>i===""?"$":(eB(i,e)??"").toString())}let BEe=class{constructor(e,r,i){this.name=e,this.details=i,this.message=(r&&PHe(r,i))??""}toString(){return"["+this.name+"]: "+this.message}},B=class GEe extends BEe{constructor(e,r,i){super(e,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return ae(r)}catch{return"[object]"}}))}}catch(e){throw K.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new GEe(e.name,e.message,e.details)}};B.prototype.type="error";const nde=new WeakMap;function AHe(t,e,r=!1){const i=`🛑 DEPRECATED - ${e}`;if(!r)return void t.warn(i);let n=nde.get(t);n||(n=new Set,nde.set(t,n)),n.has(e)||(n.add(e),t.warn(i))}function dne(t,e,r={}){if(ne("esri-deprecation-warnings")){const{moduleName:i}=r;yb(t,`Function: ${(i?i+"::":"")+e+"()"}`,r)}}function L0(t,e,r={}){if(ne("esri-deprecation-warnings")){const{moduleName:i}=r;yb(t,`Property: ${(i?i+"::":"")+e}`,r)}}function yb(t,e,r={}){if(ne("esri-deprecation-warnings")){const{replacement:i,version:n,see:s,warnOnce:o}=r;let a=e;i&&(a+=`
	🛠️ Replacement: ${i}`),n&&(a+=`
	⚙️ Version: ${n}`),s&&(a+=`
	🔗 See ${s} for more details.`),AHe(t,a,o)}}function pHt(t){const e=[];return function*(){yield*e;for(const r of t)e.push(r),yield r}}function OHe(t,e){for(const r of t)if(r!=null&&e(r))return r}function WX(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let iw=class YX{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(r=>{e+=r.length}),e}add(e,r){if(WX(e)){const i=this._getOrCreateGroup(r);for(const n of e)this._isHandle(n)&&i.push(n)}else this._isHandle(e)&&this._getOrCreateGroup(r).push(e);return this}forEach(e,r){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&r&&i.forEach(r)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&WX(e)){for(const r of e)this.remove(r);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&(!!e.remove||e instanceof YX)}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const r=[];return this._groups.set(this._ensureGroupKey(e),r),r}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){for(const r of e)r instanceof YX?r.removeAll():r.remove()}};function JD(t,e){if(t==null)throw new Error(e??"value is None")}function Me(t){return t==null||t.destroy(),null}function wt(t){return t==null||t.dispose(),null}function Pi(t){return t==null||t.remove(),null}function Ql(t){return t==null||t.abort(),null}function lr(t){return t==null||t.release(),null}function MHe(t,e,r){return t!=null&&e!=null?r!=null?r(t,e):t.equals(e):t===e}function sde(t,e){return t==null?void 0:t[e]}function RHe(t,e){let r;return t.some((i,n)=>(r=e(i,n),r!=null)),r??void 0}const jEe=Symbol("Accessor-beforeDestroy"),$He={remove:()=>{}};function ri(t){return t?{remove(){t&&(t(),t=void 0)}}:$He}function IHe(t){t.forEach(e=>e==null?void 0:e.remove())}function DT(t){return ri(()=>IHe(t))}function HEe(t){return ri(t!=null?()=>t.destroy():void 0)}function $s(t){return t.__accessor__??null}function LHe(t,e){var r;return((r=t==null?void 0:t.metadata)==null?void 0:r[e])!=null}function Qk(t,e,r){return r?jU(t,e,{policy:r,path:""}):jU(t,e,null)}function jU(t,e,r){return e?Object.keys(e).reduce((i,n)=>{const s=n;let o=null,a="merge";if(r&&(o=r.path?`${r.path}.${n}`:n,a=r.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(i[s]))return i[s]=e[s],i;if(i[s]===void 0)return i[s]=ae(e[s]),i;let l=i[s],c=e[s];if(l===c)return i;if(Array.isArray(c)||Array.isArray(i))l=l?Array.isArray(l)?i[s]=l.concat():i[s]=[l]:i[s]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(u=>{l.includes(u)||l.push(u)}));else if(c&&typeof c=="object")if(r){const u=r.path;r.path=o,i[s]=jU(l,c,r),r.path=u}else i[s]=jU(l,c,null);else i.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(i[s]=c);return i},t||{}):t}function qEe(t){return Array.isArray(t)?t:t.split(".")}function ode(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function DHe(t){if(Array.isArray(t)){const e=[];for(const r of t)e.push(...ode(r));return e}return ode(t)}function WEe(t,e,r,i){const n=DHe(e);if(n.length!==1){const s=n.map(o=>i(t,o,r));return DT(s)}return i(t,n[0],r)}function YEe(t,e){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(e)?e[n]:e.at(n)}const i=$s(e);return LHe(i,r)?i.get(r):e[r]}function XEe(t,e,r){if(t==null)return t;const i=YEe(e[r],t);return!i&&r<e.length-1?void 0:r===e.length-1?i:XEe(i,e,r+1)}function QD(t,e,r=0){return typeof e!="string"||e.includes(".")?XEe(t,qEe(e),r):YEe(e,t)}function Yf(t,e){return QD(t,e)}function ade(t,e){return QD(e,t)!==void 0}var _u;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED",t[t.DESTROYED=3]="DESTROYED"})(_u||(_u={}));function KD(t){let e=t.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!r){e=Object.create(e);for(const i in e)e[i]=ae(e[i]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function eN(t,e){const r=KD(t);let i=r[e];return i||(i=r[e]={}),i}function NHe(t,e){return Qk(t,e,kHe)}const FHe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function kHe(t){return FHe.test(t)?"replace":"merge"}function UHe(t){return(t==null?void 0:t.release)&&typeof t.release=="function"}function zHe(t){return(t==null?void 0:t.acquire)&&typeof t.acquire=="function"}let fa=class XX{constructor(e,r,i,n=1,s=0){if(this._ctor=e,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=n,this._pool=new Array(s),this._initialSize=s,this._ctor)for(let o=0;o<s;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(n,1)}destroy(){this.prune(0)}acquire(...e){let r;if(XX.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let n=0;n<i;n++)this._pool[n]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...e):zHe(r)&&r.acquire(...e),r}release(e){e&&!XX.test.disabled&&(this._releaseFunction?this._releaseFunction(e):UHe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let r=e;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};fa.test={disabled:!1};let VHe=class{constructor(e,r){this._observers=e,this._observer=r}remove(){sne(this._observers,this._observer)}},ZEe=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return BHe;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,n=!1;const s=r.length;for(let o=0;o<s;++o){const a=r[o];if(a.destroyed)n=!0;else if(a===e){i=!0;break}}return i||(r.push(e),n&&this._removeDestroyedObservers()),new VHe(r,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const r=e.length;let i=0;for(let n=0;n<r;++n){for(;n+i<r&&e[n+i].destroyed;)++i;if(i>0){if(!(n+i<r))break;e[n]=e[n+i]}}e.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const r of e)r.onCommitted();this._observers=null}}};const BHe=ri();var We;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(We||(We={}));const ZX=We.USER+1;function Au(t){switch(t){case"defaults":return We.DEFAULTS;case"service":return We.SERVICE;case"portal-item":return We.PORTAL_ITEM;case"web-scene":return We.WEB_SCENE;case"web-map":return We.WEB_MAP;case"link-chart":return We.LINK_CHART;case"user":return We.USER;default:return null}}function $L(t){switch(t){case We.DEFAULTS:return"defaults";case We.SERVICE:return"service";case We.PORTAL_ITEM:return"portal-item";case We.WEB_SCENE:return"web-scene";case We.WEB_MAP:return"web-map";case We.LINK_CHART:return"link-chart";case We.USER:return"user"}}function GHe(t){return $L(t)}var en;(function(t){t[t.Dirty=1]="Dirty",t[t.Overridden=2]="Overridden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(en||(en={}));const HU={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},qM=[];let cI=HU;function Ft(t){cI.onObservableAccessed(t)}let Kk=!1,e6=!1;function n_(t,e,r){if(Kk)return pne(t,e,r);JEe(t);const i=e.call(r);return QEe(),i}function jHe(t,e){return n_(HU,t,e)}function pne(t,e,r){const i=Kk;Kk=!0,JEe(t);let n=null;try{n=e.call(r)}catch(s){e6&&K.getLogger("esri.core.accessorSupport.tracking").error(s)}return QEe(),Kk=i,n}function JEe(t){cI=t,qM.push(t)}function QEe(){const t=qM.length;if(t>1){const e=qM.pop();cI=qM[t-2],e.onTrackingEnd()}else if(t===1){const e=qM.pop();cI=HU,e.onTrackingEnd()}else cI=HU}function KEe(t,e){if(e.flags&en.DepTrackingInitialized)return;const r=e6;e6=!1,e.flags&en.AutoTracked?pne(e,e.metadata.get,t):eCe(t,e),e6=r}const HHe=[];function eCe(t,e){e.flags&en.ExplicitlyTracking||(e.flags|=en.ExplicitlyTracking,pne(e,()=>{const r=e.metadata.dependsOn||HHe;for(const i of r)if(typeof i!="string"||i.includes(".")){const n=qEe(i);for(let s=0,o=t;s<n.length&&o!=null&&typeof o=="object";++s)o=lde(o,n[s],s!==n.length-1)}else lde(t,i,!1)}),e.flags&=~en.ExplicitlyTracking)}function lde(t,e,r){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.at(s)}const n=$s(t);if(n){const s=n.propertiesByName.get(i);s&&(Ft(s),KEe(t,s))}return r?t[i]:void 0}let cde=class extends ZEe{constructor(e,r){super(),this.propertyName=e,this.metadata=r,this._accessed=null,this._handles=null,this.flags=0,this.flags=en.Dirty|(r.nonNullable?en.NonNullable:0)|(r.hasOwnProperty("value")?en.HasDefaultValue:0)|(r.get===void 0?en.DepTrackingInitialized:0)|(r.dependsOn===void 0?en.AutoTracked:0)}destroy(){this.flags&en.Dirty&&this.onCommitted(),super.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){Ft(this);const r=e.store,i=this.propertyName,n=this.flags,s=r.get(i);if(n&en.Computing||~n&en.Dirty&&r.has(i))return s;this.flags|=en.Computing;const o=e.host;let a;n&en.AutoTracked?a=n_(this,this.metadata.get,o):(eCe(o,this),a=this.metadata.get.call(o)),r.set(i,a,We.COMPUTED);const l=r.get(i);return l===s?this.flags&=~en.Dirty:jHe(this.commit,this),this.flags&=~en.Computing,l}onObservableAccessed(e){if(e===this)return;let r=this._accessed;if(r==null)r=[],this._accessed=r;else if(r.includes(e))return;r.push(e)}onTrackingEnd(){this._clearObservationHandles(),this.flags|=en.DepTrackingInitialized;const e=this._accessed;if(e==null||e.length===0)return;let r=this._handles;r==null&&(r=[],this._handles=r);for(let i=0;i<e.length;++i)r.push(e[i].observe(this));e.length=0}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~en.Dirty,this.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let r=0;r<e.length;++r)e[r].remove();e.length=0}}onInvalidated(){~this.flags&en.Overridden&&(this.flags|=en.Dirty);const e=this._observers;if(e&&e.length>0)for(const r of e)r.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onCommitted()}}},qHe=class tCe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new tCe;return this._values.forEach((i,n)=>{e&&e.has(n)||r.set(n,ae(i))}),r}get(e){return this._values.get(e)}originOf(){return We.USER}keys(){return[...this._values.keys()]}set(e,r){this._values.set(e,r)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function C4(t,e,r){return t!==void 0}function ude(t,e,r,i){return t!==void 0&&(!(r==null&&t.flags&en.NonNullable)||(i.lifecycle,_u.INITIALIZING,!1))}let WHe=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=_u.INITIALIZING,this.store=new qHe,this._origin=We.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const n=new cde(i,r[i]);this.propertiesByName.set(i,n)}this.metadata=r}initialize(){this.lifecycle=_u.CONSTRUCTING}constructed(){this.lifecycle=_u.CONSTRUCTED}destroy(){this.lifecycle=_u.DESTROYED,this.propertiesByName.forEach(e=>e.destroy())}get initialized(){return this.lifecycle!==_u.INITIALIZING}get(e){const r=this.propertiesByName.get(e);if(r.metadata.get)return r.getComputed(this);Ft(r);const i=this.store;return i.has(e)?i.get(e):r.metadata.value}originOf(e){const r=this.store.originOf(e);if(r===void 0){const i=this.propertiesByName.get(e);if(i!==void 0&&i.flags&en.HasDefaultValue)return"defaults"}return $L(r)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const r=this.propertiesByName.get(e);if(C4(r))return this.store.has(e)?this.store.get(e):r.metadata.value}internalSet(e,r){const i=this.propertiesByName.get(e);C4(i)&&this._internalSet(i,r)}getDependsInfo(e,r,i){const n=this.propertiesByName.get(r);if(!C4(n))return"";const s=new Set,o=n_({onObservableAccessed:l=>s.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=n.metadata.get)==null?void 0:l.call(e)});let a=`${i}${e.declaredClass.split(".").pop()}.${r}: ${o}
`;if(s.size===0)return a;i+="  ";for(const l of s)l instanceof cde&&(a+=`${i}${l.propertyName}: undefined
`);return a}setAtOrigin(e,r,i){const n=this.propertiesByName.get(e);if(C4(n))return this._setAtOrigin(n,r,i)}isOverridden(e){const r=this.propertiesByName.get(e);return r!==void 0&&!!(r.flags&en.Overridden)}clearOverride(e){const r=this.propertiesByName.get(e);r&&r.flags&en.Overridden&&(r.flags&=~en.Overridden,r.notifyChange())}override(e,r){const i=this.propertiesByName.get(e);if(!ude(i,e,r,this))return;const n=i.metadata.cast;if(n){const s=this._cast(n,r),{valid:o,value:a}=s;if(Sj.release(s),!o)return;r=a}i.flags|=en.Overridden,this._internalSet(i,r)}set(e,r){const i=this.propertiesByName.get(e);if(!ude(i,e,r,this))return;const n=i.metadata.cast;if(n){const o=this._cast(n,r),{valid:a,value:l}=o;if(Sj.release(o),!a)return;r=l}const s=i.metadata.set;s?s.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(e){this._origin=Au(e)}getDefaultOrigin(){return $L(this._origin)}notifyChange(e){const r=this.propertiesByName.get(e);r!==void 0&&r.notifyChange()}invalidate(e){const r=this.propertiesByName.get(e);r!==void 0&&r.invalidate()}commit(e){const r=this.propertiesByName.get(e);r!==void 0&&r.commit()}_internalSet(e,r){const i=this.lifecycle!==_u.INITIALIZING?this._origin:We.DEFAULTS;this._setAtOrigin(e,r,i)}_setAtOrigin(e,r,i){const n=this.store,s=e.propertyName;n.has(s,i)&&lne(r,n.get(s))&&~e.flags&en.Overridden&&i===n.originOf(s)||(e.invalidate(),n.set(s,r,i),e.commit(),KEe(this.host,e))}_cast(e,r){const i=Sj.acquire();return i.valid=!0,i.value=r,e&&(i.value=e.call(this.host,r,i)),i}},YHe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const Sj=new fa(YHe);function qU(t,e,r){if(t&&e)if(typeof e=="object")for(const i of Object.getOwnPropertyNames(e))qU(t,i,e[i]);else{if(e.includes(".")){const n=e.split("."),s=n.splice(-1,1)[0];return void qU(Yf(t,n),s,r)}const i=t.__accessor__;i!=null&&XHe(e,i),t[e]=r}}function XHe(t,e){if(ne("esri-unknown-property-errors")&&!ZHe(t,e))throw new B("set:unknown-property",JHe(t,e))}function ZHe(t,e){return e.metadata[t]!=null}function JHe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let QHe;function KHe(){return QHe}var hde;(function(t){t[t.Ignore=0]="Ignore",t[t.Destroy=1]="Destroy",t[t.ThrowError=2]="ThrowError"})(hde||(hde={}));function eqe(t){t.length=0}let vu=class{constructor(e=50,r=50){this._pool=new fa(Array,void 0,eqe,r,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return Tj.acquire()}static release(e){return Tj.release(e)}static prune(){Tj.prune()}};const Tj=new vu(100);let rCe=class extends fa{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const r=super.acquire(...e);return this._set.delete(r),r}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const P4=[];function EP(t){P4.push(t),P4.length===1&&queueMicrotask(()=>{const e=P4.slice();P4.length=0;for(const r of e)r()})}let D0=class{constructor(e,r=30){this.name=e,this._counter=0,this._samples=new Array(r)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,r)=>e-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,r)=>e+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var JX;(function(t){const e=(s,o,a,l)=>{let c=o,u=o;const h=a>>>1,p=s[c-1];for(;u<=h;){u=c<<1,u<a&&l(s[u-1],s[u])<0&&++u;const f=s[u-1];if(l(f,p)<=0)break;s[c-1]=f,c=u}s[c-1]=p},r=(s,o)=>s<o?-1:s>o?1:0;function i(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(s,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const h=s[o];s[o]=s[u],s[u]=h,e(s,c,u,l)}}function*n(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(s,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const h=s[o];s[o]=s[u],s[u]=h,e(s,c,u,l),yield}}t.sort=i,t.iterableSort=n})(JX||(JX={}));const dde=JX,tqe=1.5,rqe=1.1;let jt=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new EEe,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>pde(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const r=new Array;for(let i=0;i<this._length;i++){const n=this.data[i];e(n)&&r.push(n)}return r}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,r){const i=this.data.indexOf(e,r);return i!==-1&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let r=e;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,r=e.length){for(let i=0;i<r;i++)this.data[this._length++]=e[i]}fill(e,r){for(let i=0;i<r;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,pde(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const r=HX(this.data,e,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(HX(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,r=e.length,i){this.length=fHe(this.data,e,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,r){if(e>=this.length||r>=this.length||e===r)return;const i=this.data[e];this.data[e]=this.data[r],this.data[r]=i}sort(e){dde.sort(this.data,0,this.length,e)}iterableSort(e){return dde.iterableSort(this.data,0,this.length,e)}some(e,r){for(let i=0;i<this.length;++i)if(e.call(r,this.data[i],i,this.data))return!0;return!1}find(e,r){for(let i=0;i<this.length;++i){const n=this.data[i];if(e.call(r,n,i))return n}}filterInPlace(e,r){let i=0;for(let n=0;n<this._length;++n){const s=this.data[n];e.call(r,s,n,this.data)&&(this.data[n]=this.data[i],this.data[i]=s,i++)}if(this._deallocator)for(let n=i;n<this._length;n++)this.data[n]=this._deallocator(this.data[n]);return this._length=i,this._shrink(),this}forAll(e,r){const{data:i,length:n}=this;for(let s=0;s<n;++s)e.call(r,i[s],s,i)}forEach(e,r){this.data.slice(0,this.length).forEach(e,r)}map(e,r){const i=new Array(this.length);for(let n=0;n<this.length;++n)i[n]=e.call(r,this.data[n],n,this.data);return i}reduce(e,r){let i=r;for(let n=0;n<this.length;++n)i=e(i,this.data[n],n,this.data);return i}has(e){const r=this.length,i=this.data;for(let n=0;n<r;++n)if(i[n]===e)return!0;return!1}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.data[e]}};function pde(t){t.data.length>tqe*t.length&&(t.data.length=Math.floor(t.length*rqe))}function iqe(t){return{setTimeout:(e,r)=>{const i=t.setTimeout(e,r);return ri(()=>t.clearTimeout(i))}}}const tN=iqe(globalThis);function tB(t){return nqe(t)||iCe(t)}function nqe(t){return t!=null&&typeof t=="object"&&"on"in t&&typeof t.on=="function"}function iCe(t){return t!=null&&typeof t=="object"&&"addEventListener"in t&&typeof t.addEventListener=="function"}function NA(t,e,r){if(!tB(t))throw new TypeError("target is not a Evented or EventTarget object");return iCe(t)?sqe(t,e,r):t.on(e,r)}function sqe(t,e,r,i){if(Array.isArray(e)){const n=e.slice();for(const s of n)t.addEventListener(s,r,i);return ri(()=>{for(const s of n)t.removeEventListener(s,r,i)})}return t.addEventListener(e,r,i),ri(()=>t.removeEventListener(e,r,i))}function nCe(t,e,r){if(!tB(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,r);const i=NA(t,e,n=>{i.remove(),r.call(t,n)});return i}function gr(t="Aborted"){return new B("AbortError",t)}function dt(t,e="Aborted"){if(Ms(t))throw gr(e)}function rB(t){return t instanceof AbortSignal?t:t==null?void 0:t.signal}function Ms(t){const e=rB(t);return e!=null&&e.aborted}function ko(t){if(on(t))throw t}function fde(t){if(!on(t))throw t}function la(t,e){const r=rB(t);if(r!=null){if(!r.aborted)return nCe(r,"abort",()=>e());e()}}function iB(t,e){const r=rB(t);if(r!=null)return dt(r),nCe(r,"abort",()=>e(gr()))}function ff(t,e){return rB(e)==null?t:new Promise((r,i)=>{let n=la(e,()=>i(gr()));const s=()=>{n=Pi(n)};t.then(s,s),t.then(r,i)})}function on(t){return(t==null?void 0:t.name)==="AbortError"}async function IL(t){try{return await t}catch(e){if(!on(e))throw e;return}}async function SHt(t,e=K.getLogger("esri")){try{return await t}catch(r){on(r)||e.error(r)}}async function nB(t){if(!t)return;if(typeof t.forEach!="function"){const r=Object.keys(t),i=r.map(o=>t[o]),n=await nB(i),s={};return r.map((o,a)=>s[o]=n[a]),s}const e=t;return Promise.allSettled(e).then(r=>Array.from(e,(i,n)=>{const s=r[n];return s.status==="fulfilled"?{promise:i,value:s.value}:{promise:i,error:s.reason}}))}async function WU(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function oqe(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function LL(t,e=void 0,r){const i=new AbortController;return la(r,()=>i.abort()),new Promise((n,s)=>{let o=setTimeout(()=>{o=0,n(e)},t);la(i,()=>{o&&(clearTimeout(o),s(gr()))})})}function aqe(t,e){const r=new AbortController,i=setTimeout(()=>r.abort(),e);return la(t,()=>{r.abort(),clearTimeout(i)}),{...t,signal:r.signal}}function Xu(t){return t&&typeof t.then=="function"}function QX(t){return Xu(t)?t:Promise.resolve(t)}function fne(t,e=-1){let r,i,n,s,o=null;const a=(...l)=>{if(r){i=l,s&&s.reject(gr()),s=ma();const p=s.promise;if(o){const f=o;o=null,f.abort()}return p}if(n=s||ma(),s=null,e>0){const p=new AbortController;r=QX(t(...l,p.signal));const f=r;LL(e).then(()=>{r===f&&(s?p.abort():o=p)})}else r=1,r=QX(t(...l));const c=()=>{const p=i;i=n=r=o=null,p!=null&&a(...p)},u=r,h=n;return u.then(c,c),u.then(h.resolve,h.reject),h.promise};return a}function ma(){let t,e;const r=new Promise((n,s)=>{t=n,e=s}),i=n=>{t(n)};return i.resolve=n=>t(n),i.reject=n=>e(n),i.timeout=(n,s)=>tN.setTimeout(()=>i.reject(s),n),i.promise=r,i}function THt(t,e){return t.then(e,e)}async function YU(t){await Promise.resolve(),dt(t)}function EHt(t){return t}function sCe(t){return 1e3*t}function CHt(t){return t}function mne(t){return .001*t}let lqe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},cqe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},KX=0,eZ=0;const OO={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},tZ=["prepare","preRender","render","postRender","update","finish"],rZ=[],NT=new jt;let uqe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};function hqe(){cT!=null&&(cancelAnimationFrame(cT),cT=requestAnimationFrame(gne))}const XU={frameTasks:NT,willDispatch:!1,clearFrameTasks:dqe,dispatch:aCe,executeFrameTasks:fqe,reschedule:hqe};function m2(t){const e=new cqe(t);return rZ.push(e),XU.willDispatch||(XU.willDispatch=!0,EP(aCe)),e}function FT(t){const e=new lqe(t);return NT.push(e),cT==null&&(KX=performance.now(),cT=requestAnimationFrame(gne)),new uqe(e)}let cT=null;function dqe(t=!1){NT.forAll(e=>{e.removed=!0}),t&&oCe()}function pqe(t){eZ=Math.max(0,t)}function gne(){const t=performance.now();cT=null,cT=NT.length>0?requestAnimationFrame(gne):null,XU.executeFrameTasks(t)}function fqe(t){const e=t-KX;KX=t;const r=eZ>0?eZ:1e3/60,i=Math.max(0,e-r);OO.time=t,OO.frameDuration=r-i;for(let n=0;n<tZ.length;n++){const s=performance.now(),o=tZ[n];NT.forAll(a=>{var l;a.paused||a.removed||(n===0&&a.ticks++,a.phases[o]&&(OO.elapsedFrameTime=performance.now()-t,OO.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,OO)))}),gqe[n].record(performance.now()-s)}oCe(),yqe.record(performance.now()-t)}const A4=new jt;function oCe(){NT.forAll(t=>{t.removed&&A4.push(t)}),NT.removeUnorderedMany(A4.data,A4.length),A4.clear()}function aCe(){for(;rZ.length;){const t=rZ.shift();t.isActive&&t.callback()}XU.willDispatch=!1}function mqe(t=1,e){const r=ma(),i=()=>{Ms(e)?r.reject(gr()):t===0?r():(--t,EP(()=>i()))};return i(),r.promise}const gqe=tZ.map(t=>new D0(t)),yqe=new D0("total");function t6(t,e){for(const r of t.entries())if(e(r[0]))return!0;return!1}function mde(t,e){if(!e)return t;for(const r of e)t.add(r);return t}function lCe(t,e){const r=new Set;return mde(r,t),mde(r,e),r}function _qe(t,e){const r=new Set;for(const i of e)t.has(i)&&r.add(i);return r}function MHt(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const r of t)if(!e.has(r))return!1;return!0}function RHt(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function vqe(t,e){const r=new Set(t);for(const i of e)r.delete(i);return r}function bqe(t,e){return vqe(lCe(t,e),_qe(t,e))}let wqe=0;const xqe=0;function Dh(){return++wqe}let sB=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new Sqe(e),gde.register(this,new WeakRef(this._observerObject),this)}destroy(){var e;gde.unregister(this._observerObject),this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear()}onObservableAccessed(e){const r=this._accessed;r.includes(e)||r.push(e)}onTrackingEnd(){const e=this._handles,r=this._accessed,i=this._observerObject;for(let n=0;n<r.length;++n)e.push(r[n].observe(i));r.length=0}clear(){const e=this._handles;for(let r=0;r<e.length;++r)e[r].remove();e.length=0}},Sqe=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=Tqe}};const gde=new FinalizationRegistry(t=>{var e;(e=t.deref())==null||e.destroy()});function Tqe(){}let D3=!1;const ZU=[];function cCe(t,e){let r=new sB(s),i=null,n=!1;function s(){if(!r||n)return;if(D3)return void dCe(s);const a=i;r.clear(),D3=!0,n=!0,i=n_(r,t),n=!1,D3=!1,e(i,a),pCe()}function o(){r&&(r.destroy(),r=null,i=null)}return n=!0,i=n_(r,t),n=!1,ri(o)}function uCe(t,e){let r=new sB(n),i=null;function n(){e(i,o)}function s(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=n_(r,t),i):null}return o(),ri(s)}function hCe(t){let e=new sB(i),r=!1;function i(){e&&!r&&(D3?dCe(i):(e.clear(),D3=!0,r=!0,n_(e,t),r=!1,D3=!1,pCe()))}function n(){e&&(e.destroy(),e=null)}return r=!0,n_(e,t),r=!1,ri(n)}function dCe(t){ZU.includes(t)||ZU.unshift(t)}function pCe(){for(;ZU.length;)ZU.pop()()}var uI;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(uI||(uI={}));let DL=class{constructor(){this.uid=Dh(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,r,i,n,s){return this.pool.acquire(uI.Untracked,e,r,i,n,s,lne)}static acquireTracked(e,r,i,n){return this.pool.acquire(uI.Tracked,e,r,i,null,null,n)}notify(e,r){this.type===uI.Untracked?this.callback.call(this.target,e,r,this.path,this.target):this.callback.call(null,e,r,void 0,void 0)}acquire(e,r,i,n,s,o,a){this.uid=Dh(),this.removed=!1,this.type=e,this.oldValue=r,this.callback=i,this.getValue=n,this.target=s,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Dh(),this.removed=!0}};DL.pool=new rCe(DL);const r6=new vu,V0=new Set;let JU;function QU(t){V0.delete(t),V0.add(t),JU||(JU=m2(Pqe))}function Eqe(t){if(t.removed)return;const e=t.oldValue,r=t.getValue();t.equals(e,r)||(t.oldValue=r,t.notify(r,e))}function Cqe(t){for(const e of V0.values())e.target===t&&(e.removed=!0)}function Pqe(){let t=10;for(;JU&&t--;){JU=null;const e=Aqe(),r=r6.acquire();for(const i of e){const n=i.uid;Eqe(i),n===i.uid&&i.removed&&r.push(i)}for(const i of V0)i.removed&&(r.push(i),V0.delete(i));for(const i of r)DL.pool.release(i);r6.release(r),r6.release(e),iZ.forEach(i=>i())}}function Aqe(){const t=r6.acquire();t.length=V0.size;let e=0;for(const r of V0)t[e]=r,++e;return V0.clear(),t}const iZ=new Set;function fCe(t){return iZ.add(t),ri(()=>iZ.delete(t))}function Oqe(t,e,r){let i=WEe(t,e,r,(n,s,o)=>{let a,l,c=uCe(()=>QD(n,s),(u,h)=>{var p;((p=n.__accessor__)==null?void 0:p.lifecycle)===_u.DESTROYED||a&&a.uid!==l?i.remove():(a||(a=DL.acquireUntracked(u,o,h,n,s),l=a.uid),QU(a))});return ri(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,QU(a)),a=null),i=c=null})});return i}function Mqe(t,e,r){const i=WEe(t,e,r,(n,s,o)=>{let a=!1;return cCe(()=>QD(n,s),(l,c)=>{n.__accessor__.lifecycle!==_u.DESTROYED?a||(a=!0,lne(c,l)||o.call(n,l,c,s,n),a=!1):i.remove()})});return i}function Rqe(t,e,r,i=!1){return t.__accessor__&&t.__accessor__.lifecycle!==_u.DESTROYED?i?Mqe(t,e,r):Oqe(t,e,r):ri()}function $qe(t,e,r){let i,n,s=uCe(t,(o,a)=>{i&&i.uid!==n?s.remove():(i||(i=DL.acquireTracked(o,e,a,r),n=i.uid),QU(i))});return ri(()=>{s.remove(),i&&(i.uid!==n||i.removed||(i.removed=!0,QU(i)),i=null),s=null})}function Iqe(t,e,r){let i=!1;return cCe(t,(n,s)=>{i||(i=!0,r(s,n)||e(n,s),i=!1)})}function Lqe(t,e,r=!1,i=UEe){return r?Iqe(t,e,i):$qe(t,e,i)}function yde(t){return t6(V0,e=>e.oldValue===t)}function Hd(t,e){for(const[r,i]of t)if(e(i,r))return!0;return!1}function DHt(t,e){for(const[r,i]of t)if(e(i,r))return i;return null}function rN(t,e,r){const i=t.get(e);if(i!==void 0)return i;const n=r();return t.set(e,n),n}function NHt(t){const e=new Map;return r=>(e.has(r)||e.set(r,t(r)),e.get(r))}const N3=()=>K.getLogger("esri.core.accessorSupport.ensureTypes");function Dqe(t){return t==null?t:new Date(t)}function Nqe(t){return t==null?t:!!t}function iN(t){return t==null?t:t.toString()}function Ld(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function oB(t){return t==null?t:Math.round(parseFloat(t))}function mCe(t){return(t==null?void 0:t.constructor)&&t.constructor.__accessorMetadata__!==void 0}function KU(t,e){return e!=null&&t&&!(e instanceof t)}function gCe(t){return t&&"isCollection"in t}function _de(t){return t!=null&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function Fqe(t,e){if(!(e!=null&&e.constructor)||!gCe(e.constructor))return nZ(t,e)?e:new t(e);const r=_de(t.prototype.itemType),i=_de(e.constructor.prototype.itemType);return r?i?r===i?e:r.prototype.isPrototypeOf(i.prototype)?new t(e):(nZ(t,e),e):new t(e):e}function nZ(t,e){return!!mCe(e)&&(N3().error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+aB(t)+"'"),!0)}function s_(t,e){return e==null?e:gCe(t)?Fqe(t,e):KU(t,e)?nZ(t,e)?e:new t(e):e}function aB(t){var e;return((e=t==null?void 0:t.prototype)==null?void 0:e.declaredClass)||"unknown"}const kqe=new WeakMap;function Uqe(t){switch(t){case Number:return Ld;case Vi:return oB;case Boolean:return Nqe;case String:return iN;case Date:return Dqe;default:return rN(kqe,t,()=>s_.bind(null,t))}}function to(t,e){const r=Uqe(t);return arguments.length===1?r:r(e)}function NL(t,e,r){return arguments.length===1?NL.bind(null,t):e&&(Array.isArray(e)?e.map(i=>t(i,r)):[t(e,r)])}function zqe(t,e){return arguments.length===1?NL(r=>to(t,r)):NL(r=>to(t,r),e)}function yCe(t,e,r){return e!==0&&Array.isArray(r)?r.map(i=>yCe(t,e-1,i)):t(r)}function ez(t,e,r){if(arguments.length===2)return s=>ez(t,e,s);if(!r)return r;r=yCe(t,e,r);let i=e,n=r;for(;i>0&&Array.isArray(n);)i--,n=n[0];if(n!==void 0)for(let s=0;s<i;s++)r=[r];return r}function Vqe(t,e,r){return arguments.length===2?ez(i=>to(t,i),e):ez(i=>to(t,i),e,r)}function _Ce(t){return!!Array.isArray(t)&&!t.some(e=>{const r=typeof e;return!(r==="string"||r==="number"||r==="function"&&t.length>1)})}function sZ(t,e){if(arguments.length===2)return sZ(t).call(null,e);const r=new Set,i=t.filter(a=>typeof a!="function"),n=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||r.add(a);let s=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(r.has(a)||n.some(h=>c==="string"&&h===String||c==="number"&&h===Number))||c==="object"&&n.some(h=>!KU(a,h))?a:(u&&i.length?(s||(s=i.map(h=>typeof h=="string"?`'${h}'`:`${h}`).join(", ")),N3().error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${s}`)):typeof a=="object"&&n.length?(o||(o=n.map(h=>aB(h)).join(", ")),N3().error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):N3().error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function sy(t,e){if(arguments.length===2)return sy(t).call(null,e);const r={},i=[],n=[];for(const l in t.typeMap){const c=t.typeMap[l];r[l]=to(c),i.push(aB(c)),n.push(l)}const s=()=>`'${i.join("', '")}'`,o=()=>`'${n.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!KU(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,u=r[c];if(!u)return N3().error("Accessor#set",`Invalid property value, value needs to be one of ${s()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!KU(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!mCe(l)){const h={};for(const p in l)p!==t.key&&(h[p]=l[p]);return u(h)}return u(l)}}let Vi=class{};const kHt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function Bqe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function vCe(t){switch(t.type){case"native":return to(t.value);case"array":return NL(vCe(t.value));case"one-of":return Gqe(t);default:return null}}function Gqe(t){let e=null;return(r,i)=>aZ(r,t)?r:(e==null&&(e=oZ(t)),N3().error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),i&&(i.valid=!1),null)}function oZ(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Vi:return"integer";case Date:return"date";default:return aB(t.value)}case"array":return`array of ${oZ(t.value)}`;case"one-of":{const e=t.values.map(r=>oZ(r));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function aZ(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Vi:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(r=>!aZ(r,e.value));case"one-of":return e.values.some(r=>aZ(t,r))}}function m(t={}){return(e,r)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(e,r),n=eN(e,r);i&&(i.get||i.set?(n.get=i.get||n.get,n.set=i.set||n.set):"value"in i&&("value"in t&&K.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${e.constructor.name}" already defined in the metadata`,t),n.value=t.value=i.value)),t.readOnly!=null&&(n.readOnly=t.readOnly);const s=t.aliasOf;if(s){const l=typeof s=="string"?s:s.source,c=typeof s=="string"?null:s.overridable===!0;let u;n.dependsOn=[l],n.get=function(){let h=Yf(this,l);if(typeof h=="function"){u||(u=l.split(".").slice(0,-1).join("."));const p=Yf(this,u);p&&(h=h.bind(p))}return h},n.readOnly||(n.set=c?function(h){this._override(r,h)}:function(h){qU(this,l,h)})}const o=t.type,a=t.types;n.cast||(o?n.cast=jqe(o):a&&(Array.isArray(a)?n.cast=NL(sy(a[0])):n.cast=sy(a))),NHe(n,t),t.range&&(n.cast=Hqe(n.cast,t.range))}}function yne(t,e,r){const i=eN(t,r);i.json||(i.json={});let n=i.json;return e!==void 0&&(n.origins||(n.origins={}),n.origins[e]||(n.origins[e]={}),n=n.origins[e]),n}function jqe(t){let e=0,r=t;if(Bqe(t))return vCe(t);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],e++;const i=r;if(_Ce(i))return e===0?sZ(i):ez(sZ(i),e);if(e===1)return zqe(i);if(e>1)return Vqe(i,e);const n=t;return n.from?n.from:to(n)}function Hqe(t,e){return r=>{let i=+t(r);return e.step!=null&&(i=Math.round(i/e.step)*e.step),e.min!=null&&(i=Math.max(e.min,i)),e.max!=null&&(i=Math.min(e.max,i)),i}}function qqe(t){if(t.json&&t.json.origins){const e=t.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(e[i]){const n=e[i];r[i].forEach(s=>{e[s]=n}),delete e[i]}}}let sp=class extends BEe{constructor(e,r,i){super(e,r,i)}};sp.prototype.type="warning";function bCe(t){var e;return!!t&&((e=t.prototype)==null?void 0:e.declaredClass)&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const lZ=()=>K.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function vde(t,e,r){var i,n;t&&(!r&&!e.read||(i=e.read)!=null&&i.reader||((n=e.read)==null?void 0:n.enabled)===!1||Xqe(t)&&f2("read.reader",FA(t),e))}function FA(t){var r,i;const e=t.ndimArray??0;if(e>1)return Yqe(t);if(e===1)return bde(t);if("type"in t&&xCe(t.type)){const n=(i=(r=t.type.prototype)==null?void 0:r.itemType)==null?void 0:i.Type,s=bde(typeof n=="function"?{type:n}:{types:n});return(o,a,l)=>{const c=s(o,a,l);return c&&new t.type(c)}}return _ne(t)}function _ne(t){return"type"in t?Wqe(t.type):Zqe(t.types)}function Wqe(t){return t.prototype.read?(e,r,i)=>{if(e==null)return e;const n=typeof e;if(n!=="object")return void lZ().error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${n}'`);const s=new t;return s.read(e,i),s}:t.fromJSON}function wCe(t,e,r,i){return i!==0&&Array.isArray(e)?e.map(n=>wCe(t,n,r,i-1)):t(e,void 0,r)}function Yqe(t){const e=_ne(t),r=wCe.bind(null,e),i=t.ndimArray??0;return(n,s,o)=>{if(n==null)return n;n=r(n,o,i);let a=i,l=n;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)n=[n];return n}}function bde(t){const e=_ne(t);return(r,i,n)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=e(a,void 0,n);l!==void 0&&o.push(l)}return o}const s=e(r,void 0,n);return s!==void 0?[s]:void 0}}function xCe(t){if(!bCe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?vne(e.Type):SCe(e.Type))}function Xqe(t){return"types"in t?SCe(t.types):vne(t.type)}function vne(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||xCe(t))}function SCe(t){for(const e in t.typeMap)if(!vne(t.typeMap[e]))return!1;return!0}function Zqe(t){let e=null;const r=t.errorContext??"type",i=t.validate;return(n,s,o)=>{if(n==null)return n;const a=typeof n;if(a!=="object")return void lZ().error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);e||(e=Jqe(t));const l=t.key;if(typeof l!="string")return;const c=n[l],u=c?e[c]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!u){const p=`Type '${c||"unknown"}' is not supported`;return o!=null&&o.messages&&n&&o.messages.push(new sp(`${r}:unsupported`,p,{definition:n,context:o})),void lZ().error(p)}const h=new u;return h.read(n,o),i?i(h):h}}function Jqe(t){var r,i;const e={};for(const n in t.typeMap){const s=t.typeMap[n],o=KD(s.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(r=a.json)!=null&&r.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=s);const l=(i=a.json)==null?void 0:i.write;if(!(l!=null&&l.writer)){e[n]=s;continue}const c=l.target,u=typeof c=="string"?c:t.key,h={};l.writer(n,h,u),h[u]&&(e[h[u]]=s)}return e}function Qqe(t){if(t.json||(t.json={}),xde(t.json),Sde(t.json),wde(t.json),t.json.origins)for(const e in t.json.origins)xde(t.json.origins[e]),Sde(t.json.origins[e]),wde(t.json.origins[e]);return!0}function wde(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function xde(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function Sde(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function Tde(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const r=(t==null?void 0:t.ndimArray)??0;t&&(r===1||"type"in t&&bCe(t.type))?e.write.writer=tWe:r>1?e.write.writer=rWe(r):e.types?Array.isArray(e.types)?e.write.writer=eWe(e.types[0]):e.write.writer=Kqe(e.types):e.write.writer=FL}function Kqe(t){return(e,r,i,n)=>e?TCe(e,t,n)?FL(e,r,i,n):void 0:FL(e,r,i,n)}function TCe(t,e,r){for(const i in e.typeMap)if(t instanceof e.typeMap[i])return!0;if(r!=null&&r.messages){const i=e.errorContext??"type",n=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&t&&r.messages.push(new B(`${i}:unsupported`,n,{definition:t,context:r})),K.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(n)}return!1}function eWe(t){return(e,r,i,n)=>!e||!Array.isArray(e)?FL(e,r,i,n):FL(e.filter(s=>TCe(s,t,n)),r,i,n)}function FL(t,e,r,i){f2(r,tz(t,i),e)}function tz(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?rz(t):t}function rz(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function tWe(t,e,r,i){let n;t===null?n=null:t&&typeof t.map=="function"?(n=t.map(s=>tz(s,i)),typeof n.toArray=="function"&&(n=n.toArray())):n=[tz(t,i)],f2(r,n,e)}function ECe(t,e,r){return r!==0&&Array.isArray(t)?t.map(i=>ECe(i,e,r-1)):tz(t,e)}function rWe(t){return(e,r,i,n)=>{let s;if(e===null)s=null;else{s=ECe(e,n,t);let o=t,a=s;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)s=[s]}f2(i,s,r)}}function iWe(t,e){return bne(t,"any",e==null?void 0:e.origin)}function cZ(t,e){return bne(t,"read",e==null?void 0:e.origin)}function CCe(t,e){return bne(t,"write",e==null?void 0:e.origin)}function bne(t,e,r){let i=t==null?void 0:t.json;if(i!=null&&i.origins&&r){let n;n=r==="link-chart"?i.origins[r]&&(e==="any"||e in i.origins[r])?i.origins[r]:i.origins["web-map"]:i.origins[r],n&&(e==="any"||e in n)&&(i=n)}return i}function nWe(t){const e=sWe(t);if(t.json.origins)for(const r in t.json.origins){const i=t.json.origins[r],n=i.types?oWe(i):e;vde(n,i,!1),i.types&&!i.write&&t.json.write&&t.json.write.enabled&&(i.write={...t.json.write}),Tde(n,i)}vde(e,t.json,!0),Tde(e,t.json)}function sWe(t){return t.json.types?uZ(t.json):t.type?PCe(t):uZ(t)}function oWe(t){return t.type?PCe(t):uZ(t)}function PCe(t){if(!t.type)return;let e=0,r=t.type;for(;Array.isArray(r)&&!_Ce(r);)r=r[0],e++;return{type:r,ndimArray:e}}function uZ(t){if(!t.types)return;let e=0,r=t.types;for(;Array.isArray(r);)r=r[0],e++;return{types:r,ndimArray:e}}function aWe(t){Qqe(t)&&(qqe(t),nWe(t))}const Ej=new Set,Cj=new Set;function F(t){return e=>{t??(t="esri.core.Accessor"),e.prototype.declaredClass=t,cWe(e);const r=[],i=[];let n=e.prototype;for(;n;)n.hasOwnProperty("initialize")&&!Ej.has(n.initialize)&&(Ej.add(n.initialize),r.push(n.initialize)),n.hasOwnProperty("destroy")&&!Cj.has(n.destroy)&&(Cj.add(n.destroy),i.push(n.destroy)),n=Object.getPrototypeOf(n);Ej.clear(),Cj.clear();const s=class extends e{constructor(...a){if(super(...a),this.constructor===s&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[jEe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<i.length;u++)i[u].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript(...a)}}};s.__accessorMetadata__=KD(e.prototype),s.prototype.declaredClass=t;const o=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(s,"name",{value:o,configurable:!0}),s}}function lWe(t,e){return e.get==null?function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i===void 0)return;Ft(i);const n=r.store;return n.has(t)?n.get(t):i.metadata.value}:function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i!==void 0)return i.getComputed(r)}}function cWe(t){const e=t.prototype,r=KD(e),i={};for(const n of Object.getOwnPropertyNames(r)){const s=r[n];aWe(s),i[n]={enumerable:!0,configurable:!0,get:lWe(n,s),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&s.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${n}' of ${this.declaredClass}`);if(a.lifecycle===_u.CONSTRUCTED&&s.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${n}' of ${this.declaredClass}`);a.set(n,o)}}else Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,i)}var ACe,OCe;function uWe(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const P1=Symbol("Accessor-Handles"),hZ=Symbol("Accessor-Initialized");let Pe=class MCe{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:n}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const s=this;class o extends s{constructor(...l){super(...l),this.inherited=null,n&&n.apply(this,l)}}KD(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let h;this.inherited=function(...p){if(s.prototype[a])return s.prototype[a].apply(this,p)};try{h=l.apply(this,c)}catch(p){throw this.inherited=u,p}return this.inherited=u,h}:e[a]}for(const a in r){const l=uWe(r[a]);m(l)(o.prototype,a)}return F(i)(o)}constructor(...e){if(this[ACe]=null,this[OCe]=!1,this.constructor===MCe)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const r=new WHe(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:r}),e.length>0&&this.normalizeCtorArgs&&(r.ctorArgs=this.normalizeCtorArgs.apply(this,e))}postscript(e){const r=this.__accessor__,i=r.ctorArgs||e;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[hZ]=!0}initialize(){}[jEe](){this[P1]=Me(this[P1])}destroy(){var e;this.destroyed||(Cqe(this),this.__accessor__.destroy(),(e=KHe())==null||e.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[hZ]}get destroyed(){var e;return((e=this.__accessor__)==null?void 0:e.lifecycle)===_u.DESTROYED||!1}commitProperty(e){Yf(this,e)}get(e){return dne(K.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),Yf(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,r){return qU(this,e,r),this}watch(e,r,i){return Rqe(this,e,r,i)}addHandles(e,r){if(this.destroyed){const n=Array.isArray(e)?e:[e];for(const s of n)s.remove();return}let i=this[P1];i==null&&(i=this[P1]=new iw),i.add(e,r)}removeHandles(e){const r=this[P1];r!=null&&r.remove(e)}removeAllHandles(){const e=this[P1];e!=null&&e.removeAll()}hasHandles(e){const r=this[P1];return r!=null&&r.has(e)}_override(e,r){r===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,r){r==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,r){return this.__accessor__.internalSet(e,r),this}};ACe=P1,OCe=hZ;let hWe=class RCe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new RCe;return this._values.forEach((i,n)=>{e&&e.has(n)||r.set(n,ae(i.value),i.origin)}),r}get(e,r){r=this._normalizeOrigin(r);const i=this._values.get(e);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(e){var r;return((r=this._values.get(e))==null?void 0:r.origin)??We.USER}keys(e){e=this._normalizeOrigin(e);const r=[...this._values.keys()];return e==null?r:r.filter(i=>{var n;return((n=this._values.get(i))==null?void 0:n.origin)===e})}set(e,r,i){if((i=this._normalizeOrigin(i))===We.DEFAULTS){const n=this._values.get(e);if((n==null?void 0:n.origin)!=null&&n.origin>i)return}this._values.set(e,new dWe(r,i))}delete(e,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(e))==null?void 0:i.origin)!==r||this._values.delete(e)}has(e,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(e))==null?void 0:i.origin)===r:this._values.has(e)}forEach(e){this._values.forEach(({value:r},i)=>e(r,i))}_normalizeOrigin(e){if(e!=null)return e===We.DEFAULTS?e:We.USER}},dWe=class{constructor(e,r){this.value=e,this.origin=r}};function $Ce(t,e,r){e.keys().forEach(n=>{r.set(n,e.get(n),We.DEFAULTS)});const i=t.metadata;Object.keys(i).forEach(n=>{t.internalGet(n)&&r.set(n,t.internalGet(n),We.DEFAULTS)})}function pWe(t,e,r){if(!(t!=null&&t.read)||t.read.enabled===!1||!t.read.source)return!1;const i=t.read.source;if(typeof i=="string"){if(i===e||i.includes(".")&&i.indexOf(e)===0&&ade(i,r))return!0}else for(const n of i)if(n===e||n.includes(".")&&n.indexOf(e)===0&&ade(n,r))return!0;return!1}function fWe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function mWe(t,e,r,i,n){let s=cZ(e[r],n);fWe(s)&&(t[r]=!0);for(const o of Object.getOwnPropertyNames(e))s=cZ(e[o],n),pWe(s,r,i)&&(t[o]=!0)}function gWe(t,e,r,i){const n=r.metadata,s=iWe(n[e],i),o=s==null?void 0:s.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,i):o;a!==void 0&&r.set(e,a)}const ICe={origin:"service"};function LCe(t,e,r=ICe){if(!e||typeof e!="object")return;const i=$s(t),n=i.metadata,s={};for(const o of Object.getOwnPropertyNames(e))mWe(s,n,o,e,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(s)){const a=cZ(n[o],r).read,l=a==null?void 0:a.source;let c;c=l&&typeof l=="string"?QD(e,l):e[o],a!=null&&a.reader&&(c=a.reader.call(t,c,e,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(n))s[o]||gWe(t,o,i,r)}i.setDefaultOrigin("user")}function yWe(t,e,r,i=ICe){var s;const n={...i,messages:[]};r(n),(s=n.messages)==null||s.forEach(o=>{o.type!=="warning"||t.loaded?i!=null&&i.messages&&i.messages.push(o):t.loadWarnings.push(o)})}function _We(t,e,r,i,n){var o,a;const s={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,i,s,r,n),s}function DCe(t,e,r,i,n,s){if(!(i!=null&&i.write))return!1;const o=Yf(t,r);if(!n&&i.write.overridePolicy){const a=i.write.overridePolicy.call(t,o,r,s??void 0);a!==void 0&&(n=a)}if(n||(n=i.write),!n||n.enabled===!1||n.layerContainerTypes&&(s!=null&&s.layerContainerType)&&!n.layerContainerTypes.includes(s.layerContainerType))return!1;if((o===null&&!n.allowNull&&!n.writerEnsuresNonNull||o===void 0)&&n.isRequired){const a=new B("web-document-write:property-required",`Missing value for required property '${r}' on '${t.declaredClass}'`,{propertyName:r,target:t});return a&&(s!=null&&s.messages)?s.messages.push(a):a&&!s&&K.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!n.allowNull&&!n.writerEnsuresNonNull||!n.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(r)===We.DEFAULTS)&&vWe(t,r,s,i,o)||!n.ignoreOrigin&&(s!=null&&s.origin)&&e.store.multipleOriginsSupported&&e.store.originOf(r)<Au(s.origin))}function vWe(t,e,r,i,n){const s=i.default;if(s===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(n);if(typeof s=="function"){if(Array.isArray(n)){const o=s.call(t,e,r??void 0);return ny(o,n)}return!1}return s===n}function bWe(t,e,r,i){const n=$s(t),s=n.metadata,o=CCe(s[e],i);return!!o&&DCe(t,n,e,o,r,i)}function NCe(t,e,r){var s,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return Qk(e,t.toJSON(r));const i=$s(t),n=i.metadata;for(const a in n){const l=CCe(n[a],r);if(!DCe(t,i,a,l,void 0,r))continue;const c=Yf(t,a),u=_We(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,r);Object.keys(u).length>0&&(e=Qk(e,u),(o=(s=r==null?void 0:r.resources)==null?void 0:s.pendingOperations)!=null&&o.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>Qk(e,u,()=>"replace-arrays"))),r!=null&&r.writtenProperties&&r.writtenProperties.push({target:t,propName:a,oldOrigin:GHe(i.store.originOf(a)),newOrigin:r.origin}))}return e}const kA=t=>{let e=class extends t{constructor(...r){super(...r);const i=$s(this),n=i.store,s=new hWe;i.store=s,$Ce(i,n,s)}read(r,i){LCe(this,r,i)}write(r,i){return NCe(this,r??{},i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return wWe.call(this,r,i)}};return e=d([F("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function wWe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(t,e),r}function iz(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}let Se=class extends kA(Pe){};Se=d([F("esri.core.JSONSupport")],Se);const xWe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,SWe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function Ede(t){const e=t==null?void 0:t.match(xWe);if(!e)return null;const[,r,i,n]=e;if(!r)return null;let s=null,o=null,a=null;const{devext:l,qaext:c,www:u}=SWe;if(i)if(s=r,n)switch(n.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:s}}function TWe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function FCe(t){const e=atob(t),r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r.buffer}function EWe(t){const e=new Uint8Array(t);let r="";for(let i=0;i<e.length;i++)r+=String.fromCharCode(e[i]);return btoa(r)}const CWe=()=>K.getLogger("esri.core.urlUtils"),UA=ai.request,Cde="esri/config: esriConfig.request.proxyUrl is not set.",kCe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,UCe=/^\s*http:/i,PWe=/^\s*https:/i,AWe=/^\s*file:/i,OWe=/:\d+$/,MWe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,RWe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),$We=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let F3=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(RWe);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match($We),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}};const O4={},IWe=new F3(ai.applicationUrl);let Wl=IWe;const LWe=DWe();let wne=LWe;const xne=()=>Wl,GHt=()=>wne;function DWe(){const t=Wl.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${Wl.scheme}://${Wl.host}${Wl.port!=null?`:${Wl.port}`:""}`}${e}`}function xs(t){if(!t)return null;const e={path:null,query:null},r=new F3(t),i=t.indexOf("?");return r.query===null?e.path=t:(e.path=t.substring(0,i),e.query=Sne(r.query)),r.fragment&&(e.hash=r.fragment,r.query===null&&(e.path=e.path.substring(0,e.path.length-(r.fragment.length+1)))),e}function Sne(t){const e=t.split("&"),r={};for(const i of e){if(!i)continue;const n=i.indexOf("=");let s,o;n<0?(s=decodeURIComponent(i),o=""):(s=decodeURIComponent(i.slice(0,n)),o=decodeURIComponent(i.slice(n+1)));let a=r[s];typeof a=="string"&&(a=r[s]=[a]),Array.isArray(a)?a.push(o):r[s]=o}return r}function _b(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(e(r,t[r]))).join("&"):Object.keys(t).map(r=>{const i=t[r];if(i==null)return"";const n=encodeURIComponent(r)+"=",s=e==null?void 0:e[r];return s?n+encodeURIComponent(s(i)):Array.isArray(i)?i.map(o=>iz(o)?n+encodeURIComponent(JSON.stringify(o)):n+encodeURIComponent(o)).join("&"):iz(i)?n+encodeURIComponent(JSON.stringify(i)):n+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function NWe(t=!1){let e,r=UA.proxyUrl;if(typeof t=="string"){e=GWe(t);const i=lB(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw CWe().warn(Cde),new B("urlUtils:proxy-not-set",Cde);return e&&dZ()&&(r=Ane(r)),xs(r)}function jHt(t){const e=lB(t);let r,i;if(e){const n=Tne(e.proxyUrl);r=n.path,i=n.query?Sne(n.query):null}if(r){const n=xs(t);t=r+"?"+n.path;const s=_b({...i,...n.query});s&&(t=`${t}?${s}`)}return t}const MO={path:"",query:""};function Tne(t){const e=t.indexOf("?");return e!==-1?(MO.path=t.slice(0,e),MO.query=t.slice(e+1)):(MO.path=t,MO.query=null),MO}function zCe(t){return t=(t=sz(t=YWe(t=Tne(t).path),!0)).toLowerCase()}function FWe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:zCe(t.urlPrefix)},r=UA.proxyRules,i=e.urlPrefix;let n=r.length;for(let s=0;s<r.length;s++){const o=r[s].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;n=s;break}o.indexOf(i)===0&&(n=s+1)}return r.splice(n,0,e),n}function lB(t){const e=UA.proxyRules,r=zCe(t);for(let i=0;i<e.length;i++)if(r.indexOf(e[i].urlPrefix)===0)return e[i]}function kWe(t,e){if(!t||!e)return!1;t=nz(t),e=nz(e);const r=Ede(t),i=Ede(e);return r!=null&&i!=null?r.portalHostname===i.portalHostname:r==null&&i==null&&CP(t,e,!0)}function VCe(t,e){return t=nz(t),e=nz(e),sz(t)===sz(e)}function nz(t){const e=(t=Xf(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function BCe(t){const e=i=>i==null||i instanceof RegExp&&i.test(t)||typeof i=="string"&&t.startsWith(i),r=UA.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(e))return i}else if(e(i.urls))return i}return null}function CP(t,e,r=!1){if(!t||!e)return!1;const i=fZ(t),n=fZ(e);return!(!r&&i.scheme!==n.scheme)&&i.host!=null&&n.host!=null&&i.host.toLowerCase()===n.host.toLowerCase()&&i.port===n.port}function Ene(t){if(typeof t=="string"){if(!Fu(t))return!0;t=fZ(t)}if(CP(t,Wl))return!0;const e=UA.trustedServers||[];for(let r=0;r<e.length;r++){const i=UWe(e[r]);for(let n=0;n<i.length;n++)if(CP(t,i[n]))return!0}return!1}function UWe(t){return O4[t]||(Pne(t)||oy(t)?O4[t]=[new F3(Tu(t))]:O4[t]=[new F3(`http://${t}`),new F3(`https://${t}`)]),O4[t]}function Tu(t,e=wne,r){return oy(t)?r&&r.preserveProtocolRelative?t:Wl.scheme==="http"&&Wl.authority===Zf(t).slice(2)?`http:${t}`:`https:${t}`:Pne(t)?t:Nc(t[0]==="/"?WWe(e):e,t)}function cB(t,e=wne,r){if(t==null||!Fu(t))return t;const i=Xf(t),n=i.toLowerCase(),s=Xf(e).toLowerCase().replace(/\/+$/,""),o=r?Xf(r).toLowerCase().replace(/\/+$/,""):null;if(o&&s.indexOf(o)!==0)return t;const a=(h,p,f)=>(f=h.indexOf(p,f))===-1?h.length:f;let l=a(n,"/",n.indexOf("//")+2),c=-1;for(;n.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==n.length);)l=a(n,"/",l+1);if(c===-1||o&&c<o.length)return t;t=i.slice(c);const u=s.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let h=0;h<u;h++)t=`../${t}`;else t=`./${t}`;return t}function Xf(t){return t=JWe(t=ZWe(t=XWe(t=Tu(t=t.trim()))))}function Nc(...t){const e=t.filter(rw);if(!(e!=null&&e.length))return;const r=[];if(Fu(e[0])){const n=e[0],s=n.indexOf("//");s!==-1&&(r.push(n.slice(0,s+1)),HWe(e[0])&&(r[0]+="/"),e[0]=n.slice(s+2))}else e[0][0]==="/"&&r.push("");const i=e.reduce((n,s)=>s?n.concat(s.split("/")):n,[]);for(let n=0;n<i.length;n++){const s=i[n];s===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!s&&n===i.length-1||s&&(s!=="."||r.length===0))&&r.push(s)}return r.join("/")}function Zf(t,e=!1){if(t==null||vb(t)||yy(t))return null;let r=t.indexOf("://");if(r===-1&&oy(t))r=2;else{if(r===-1)return null;r+=3}const i=t.indexOf("/",r);return i!==-1&&(t=t.slice(0,i)),e&&(t=sz(t,!0)),t}function Fu(t){return oy(t)||Pne(t)}function vb(t){return t!=null&&t.slice(0,5)==="blob:"}function yy(t){return t!=null&&t.slice(0,5)==="data:"}function Cne(t){const e=bb(t);return e&&e.isBase64?FCe(e.data):null}function HHt(t){return EWe(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const zWe=/^data:(.*?)(;base64)?,(.*)$/;function bb(t){const e=t.match(zWe);if(!e)return null;const[,r,i,n]=e;return{mediaType:r,isBase64:!!i,data:n}}function GCe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function VWe(t){return(await fetch(t)).blob()}function qHt(t){const e=Cne(t);if(!e)return null;const r=bb(t);return new Blob([e],{type:r.mediaType})}function WHt(t,e){BWe(t,e)}function BWe(t,e){if(!t)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(t);return r.download=e,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function oy(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function Pne(t){return t!=null&&kCe.test(t)}function GWe(t){return t!=null&&PWe.test(t)||Wl.scheme==="https"&&oy(t)}function jWe(t){return t!=null&&UCe.test(t)||Wl.scheme==="http"&&oy(t)}function HWe(t){return t!=null&&AWe.test(t)}function Ane(t){return oy(t)?`https:${t}`:t.replace(UCe,"https:")}function qWe(){return Wl.scheme==="http"}function dZ(){return Wl.scheme==="https"}function sz(t,e=!1){return oy(t)?t.slice(2):(t=t.replace(kCe,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function WWe(t){const e=t.indexOf("//"),r=t.indexOf("/",e+2);return r===-1?t:t.slice(0,r)}function uB(t){let e=0;if(Fu(t)){const i=t.indexOf("//");i!==-1&&(e=i+2)}const r=t.lastIndexOf("/");return r<e?t:t.slice(0,r+1)}function YHt(t,e){if(!t)return"";const r=xs(t).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(e!=null&&e.length))return i;const n=new RegExp(`.(${e.join("|")})$`,"ig");return i.replace(n,"")}function YWe(t){return t.endsWith("/")?t:`${t}/`}function jCe(t){return t.replace(/\/+$/,"")}function XWe(t){if(/^https?:\/\//i.test(t)){const e=Tne(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function ZWe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function JWe(t){const e=UA.httpsDomains;if(!jWe(t))return t;const r=t.indexOf("/",7);let i;if(i=r===-1?t:t.slice(0,r),i=i.toLowerCase().slice(7),OWe.test(i)){if(!i.endsWith(":80"))return t;i=i.slice(0,-3),t=t.replace(":80","")}return qWe()&&i===Wl.authority&&!MWe.test(t)||(dZ()&&i===Wl.authority||e&&e.some(n=>i===n||i.endsWith(`.${n}`))||dZ()&&!lB(t))&&(t=Ane(t)),t}function pZ(t,e,r){if(!(e&&r&&t&&Fu(t)))return t;const i=t.indexOf("//"),n=t.indexOf("/",i+2),s=t.indexOf(":",i+2),o=Math.min(n<0?t.length:n,s<0?t.length:s);return t.slice(i+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,i+2)}${r}${t.slice(o)}`}function fZ(t){return typeof t=="string"?new F3(Tu(t)):(t.scheme||(t.scheme=Wl.scheme),t)}function HCe(t){return KWe.test(t)}function qCe(t,e){const r=xs(t),i=Object.keys(r.query||{});return i.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function QWe(t,e,r){const i=xs(t),n=i.query||{};return n[e]=String(r),`${i.path}?${_b(n)}`}function Pj(t,e){if(!e)return t;const r=xs(t),i=r.query||{};for(const[s,o]of Object.entries(e))o!=null&&(i[s]=o);const n=_b(i);return n?`${r.path}?${n}`:r.path}function One(t){if(t==null)return null;const e=t.match(WCe);return e?e[2]:null}function Pde(t){if(t==null)return null;const e=t.match(WCe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function XHt(t){return typeof t=="string"?bb(t)??{data:t}:new Promise((e,r)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(bb(i.result)),i.onerror=n=>r(n)})}const WCe=/([^.]*)\.([^\/]*)$/,KWe=/(^data:image\/svg|\.svg$)/i,YCe="20240307",XCe="8edb474d2bd6a26e9cb72a83b1b1aaddd81bbf2a";Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const eYe="4.29";let vr,Mne=eYe;Mne="4.29.7";function ZHt(t){vr=t}function JHt(t){const e=vr==null?void 0:vr.findCredential(t);return e!=null&&e.token?QWe(t,"token",e.token):t}ne("host-webworker");const tYe=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function Rne(t){const e=Zf(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!tYe.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function ZCe(t,e,r=!1,i){return new Promise((n,s)=>{if(Ms(i))return void s(Ade());let o=()=>{c(),s(new Error(`Unable to load ${e}`))},a=()=>{const u=t;c(),n(u)},l=()=>{if(!t)return;const u=t;c(),u.src="",s(Ade())};const c=()=>{ne("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,i!=null&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(e)};i!=null&&i.addEventListener("abort",l),ne("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function Ade(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const JCe="Timeout exceeded";function rYe(){return new Error(JCe)}function QHt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===JCe}function iYe(t){ai.request.crossOriginNoCorsDomains||(ai.request.crossOriginNoCorsDomains={});const e=ai.request.crossOriginNoCorsDomains;for(let r of t)r=r.toLowerCase(),/^https?:\/\//.test(r)?e[Zf(r)??""]=0:(e[Zf("http://"+r)??""]=0,e[Zf("https://"+r)??""]=0)}function nYe(t){const e=ai.request.crossOriginNoCorsDomains;if(e){let r=Zf(t);if(r)return r=r.toLowerCase(),!CP(r,xne())&&e[r]<Date.now()-36e5}return!1}async function sYe(t){var n;const e=ai.request.crossOriginNoCorsDomains,r=Zf(t);e&&r&&(e[r.toLowerCase()]=Date.now());const i=xs(t);t=i.path,((n=i.query)==null?void 0:n.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function Vt(t,e){var c;t instanceof URL&&(t=t.toString()),(e==null?void 0:e.query)instanceof URLSearchParams&&(e.query=Sne(e.query.toString().replaceAll("+"," ")));const r=yy(t),i=vb(t);i||r||(t=Xf(t));const n={url:t,requestOptions:{...e}};let s=BCe(t);if(s){const u=await pYe(s,n);if(u!=null)return{data:u,getAllHeaders:PP,getHeader:PP,httpStatus:200,requestOptions:n.requestOptions,url:n.url};s.after||s.error||(s=null)}if(t=n.url,(e=n.requestOptions).responseType==="image"&&(ne("host-webworker")||ne("host-node")))throw Wg("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),n);if(e.method==="head"){if(e.body)throw Wg("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),n);if(r||i)throw Wg("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),n)}if(await uYe(),oz)return oz.execute(t,e);const o=new AbortController;la(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:s,params:n,redoRequest:!1,useIdentity:_f.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await mYe(a);return(c=s==null?void 0:s.after)==null||c.call(s,l),l}let oz;const _f=ai.request,QCe="FormData"in globalThis,oYe=new Set([499,498,403,401]),aYe=new Set(["COM_0056","COM_0057","SB_0008"]),lYe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],PP=()=>null,az=Symbol();function cYe(t){const e=Zf(t);e&&!Vt._corsServers.includes(e)&&Vt._corsServers.push(e)}function Ode(t){const e=Zf(t);return!e||e.endsWith(".arcgis.com")||Vt._corsServers.includes(e)||Ene(e)}function Wg(t,e,r,i){let n="Error";const s={url:r.url,requestOptions:r.requestOptions,getAllHeaders:PP,getHeader:PP,ssl:!1};if(e instanceof B)return e.details?(e.details=ae(e.details),e.details.url=r.url,e.details.requestOptions=r.requestOptions):e.details=s,e;if(e){const o=i&&(()=>Array.from(i.headers)),a=i&&(u=>i.headers.get(u)),l=i==null?void 0:i.status,c=e.message;c&&(n=c),o&&a&&(s.getAllHeaders=o,s.getHeader=a),s.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||l||0,s.subCode=e.subcode,s.messageCode=e.messageCode,typeof e.details=="string"?s.messages=[e.details]:s.messages=e.details,s.raw=az in e?e[az]:e}return on(e)?gr():new B(t,n,s)}async function uYe(){ne("host-webworker")&&!oz&&(oz=await re(()=>import("./request-EKlw81r-.js"),__vite__mapDeps([])))}async function mZ(){vr||await re(()=>import("./IdentityManager-Cat8B4ml.js"),__vite__mapDeps([0,1]))}async function hYe(t){var a;const e=t.params.url,r=t.params.requestOptions,i=t.controller.signal,n=r.body;let s=null,o=null;if(QCe&&"HTMLFormElement"in globalThis&&(n instanceof FormData?s=n:n instanceof HTMLFormElement&&(s=new FormData(n))),typeof n=="string"&&(o=n),t.fetchOptions={cache:r.cacheBust?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:_f.priority,redirect:"follow",signal:i},(s||o)&&(t.fetchOptions.body=s||o),r.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=r.query)!=null&&a.token||s!=null&&s.get("token")),!t.hasToken&&ai.apiKey&&Rne(e)&&(r.query||(r.query={}),r.query.token=ai.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!KCe(e)&&!Ms(i)){let l;r.authMode==="immediate"?(await mZ(),l=await vr.getCredential(e,{signal:i}),t.credential=l):r.authMode==="no-prompt"?(await mZ(),l=await vr.getCredential(e,{prompt:!1,signal:i}).catch(()=>{}),t.credential=l):vr&&(l=vr.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function KCe(t){return lYe.some(e=>e.test(t))}async function dYe(t){let e=t.params.url;const r=t.params.requestOptions,i=t.fetchOptions??{},n=vb(e)||yy(e),s=r.responseType||"json",o=n?0:r.timeout!=null?r.timeout:_f.timeout;let a=!1;if(!n){t.useSSL&&(e=Ane(e));let p={...r.query};t.credentialToken&&(p.token=t.credentialToken);let f=_b(p);ne("esri-url-encodes-apostrophe")&&(f=f.replaceAll("'","%27"));const g=e.length+1+f.length;let y;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||g>_f.maxUrlLength;const v=r.useProxy||!!lB(e);if(v){const b=NWe(e);y=b.path,!a&&y.length+1+g>_f.maxUrlLength&&(a=!0),b.query&&(p={...b.query,...p})}if(i.method==="HEAD"&&(a||v)){if(a)throw g>_f.maxUrlLength?Wg("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):Wg("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw Wg("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=Pj(e,p):(i.body=_b(p),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):e=Pj(e,p),v&&(t.useProxy=!0,e=`${y}?${e}`),p.token&&QCe&&i.body instanceof FormData&&!TWe(e)&&i.body.set("token",p.token),r.hasOwnProperty("withCredentials"))t.withCredentials=r.withCredentials;else if(!CP(e,xne())){if(Ene(e))t.withCredentials=!0;else if(vr){const b=vr.findServerInfo(e);b!=null&&b.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(i.credentials="include",nYe(e)&&await sYe(a?Pj(e,p):e))}let l,c,u=0,h=!1;o>0&&(u=setTimeout(()=>{h=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=e;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||fYe(r.headers)||!n&&!t.useProxy&&_f.proxyUrl&&!Ode(e)){if(Vt._beforeFetch&&await Vt._beforeFetch(e,i),l=await fetch(e,i),Vt._afterFetch&&await Vt._afterFetch(l),t.useProxy||cYe(e),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(s){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),s==="json"||s==="xml"||s==="document")if(c)switch(s){case"json":c=JSON.parse(c);break;case"xml":c=Mde(c,"application/xml");break;case"document":c=Mde(c,"text/html")}else c=null;if(c){if(s==="array-buffer"||s==="blob"){const p=l.headers.get("Content-Type");if(p&&/application\/json|text\/plain/i.test(p)&&c[s==="blob"?"size":"byteLength"]<=750)try{const f=await new Response(c).json();f.error&&(c=f)}catch{}}s==="image"&&c instanceof Blob&&(c=await Rde(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await Rde(e,t)}catch(p){if(p.name==="AbortError")throw h?rYe():gr("Request canceled");if(!(!l&&p instanceof TypeError&&_f.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||Ode(e))throw p;t.redoRequest=!0,FWe({proxyUrl:_f.proxyUrl,urlPrefix:Zf(e)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function pYe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let r,i;try{i=await t.before(e)}catch(n){r=Wg("request:interceptor",n,e)}if((i instanceof Error||i instanceof B)&&(r=Wg("request:interceptor",i,e)),r)throw t.error&&t.error(r),r;return i}}function fYe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function Mde(t,e){let r;try{r=new DOMParser().parseFromString(t,e)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function mYe(t){var s,o;let e,r;await hYe(t);try{do[e,r]=await dYe(t);while(!await gYe(t,e,r))}catch(a){const l=Wg("request:server",a,t.params,e);throw l.details.ssl=t.useSSL,(s=t.interceptor)!=null&&s.error&&t.interceptor.error(l),l}const i=t.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!t.hasToken&&!t.credentialToken&&((o=r.user)!=null&&o.username)&&!Ene(i)){const a=Zf(i,!0);a&&_f.trustedServers.push(a)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&iYe(r.authorizedCrossOriginNoCorsDomains)}const n=t.credential;if(n&&vr){const a=vr.findServerInfo(n.server);let l=a==null?void 0:a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=vr.findCredential(l,n.userId);c&&vr._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:r,getAllHeaders:e?()=>Array.from(e.headers):PP,getHeader:e?a=>e.headers.get(a):PP,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function gYe(t,e,r){var c;if(t.redoRequest)return t.redoRequest=!1,!1;const i=t.params.requestOptions;if(!e||i.responseType==="native"||i.responseType==="native-request-init")return!0;let n,s;if(r&&(r.error?n=r.error:r.status==="error"&&Array.isArray(r.messages)&&(n={...r},n[az]=r,n.details=r.messages)),!n&&!e.ok)throw n=new Error(`Unable to load ${e.url} status: ${e.status}`),n[az]=r,n;let o,a=null;n&&(s=Number(n.code),a=n.hasOwnProperty("subcode")?Number(n.subcode):null,o=n.messageCode,o=o==null?void 0:o.toUpperCase());const l=i.authMode;if(s===403&&(a===4||(c=n.message)!=null&&c.toLowerCase().includes("ssl")&&!n.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||s===498)&&s!==void 0&&oYe.has(s)&&!KCe(t.params.url)&&(s!==403||(!o||!aYe.has(o))&&(a==null||a===2&&t.credentialToken))){await mZ();try{const u=await vr.getCredential(t.params.url,{error:Wg("request:server",n,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=u,t.credentialToken=u.token,t.useSSL=t.useSSL||u.ssl,!1}catch(u){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;n=u}}if(n)throw n;return!0}function Rde(t,e,r=!1){const i=e.controller.signal,n=new Image;return e.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.fetchPriority=_f.priority,n.src=t,ZCe(n,t,r,i)}Vt._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],Vt._beforeFetch=void 0,Vt._afterFetch=void 0;let i6=class e3e{constructor(){this._emitter=new e3e.EventEmitter(this)}emit(e,r){return this._emitter.emit(e,r)}on(e,r){return this._emitter.on(e,r)}once(e,r){return this._emitter.once(e,r)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(n=null){this._target=n,this._listenersMap=null}clear(){var n;(n=this._listenersMap)==null||n.clear(),this._listenersMap=null}destroy(){this.clear()}emit(n,s){var c;let o=(c=this._listenersMap)==null?void 0:c.get(n);if(!o)return!1;const a=this._target||this;let l=!1;for(const u of o.slice()){const h="deref"in u?u.deref():u;h?h==null||h.call(a,s):l=!0}return l&&(o=o.filter(u=>!("deref"in u)||u.deref()!=null),this._listenersMap.set(n,o)),o.length>0}on(n,s){if(Array.isArray(n)){const a=n.map(l=>this.on(l,s));return DT(a)}if(n.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const o=this._listenersMap.get(n)||[];return o.push(s),this._listenersMap.set(n,o),ri(()=>{var c;const a=(c=this._listenersMap)==null?void 0:c.get(n),l=(a==null?void 0:a.indexOf(s))??-1;l>=0&&a.splice(l,1)})}once(n,s){const o=this.on(n,a=>{o.remove();const l="deref"in s?s.deref():s;l==null||l.call(null,a)});return o}hasEventListener(n){var o;const s=(o=this._listenersMap)==null?void 0:o.get(n);return s!=null&&s.length>0}}t.EventEmitter=e,t.EventedMixin=i=>{let n=class extends i{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(s,o){return this._emitter.emit(s,o)}on(s,o){return this._emitter.on(s,o)}once(s,o){return this._emitter.once(s,o)}hasEventListener(s){return this._emitter.hasEventListener(s)}};return n=d([F("esri.core.Evented")],n),n};let r=class extends Pe{constructor(){super(...arguments),this._emitter=new i6.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,n){return this._emitter.emit(i,n)}on(i,n){return this._emitter.on(i,n)}once(i,n){return this._emitter.once(i,n)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=d([F("esri.core.Evented")],r),t.EventedAccessor=r})(i6||(i6={}));const Xn=i6;var Ei;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(Ei||(Ei={}));function t3e(t){return(e,r)=>{e[r]=t}}let nN=class extends ZEe{notify(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}};var T0;let yYe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},_Ye=class{constructor(e,r,i,n,s){this.target=e,this.added=r,this.removed=i,this.start=n,this.deleteCount=s}};const Jh=new fa(yYe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function Aj(t){return t?t instanceof y0?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function Oj(t){if(t!=null&&t.length)return t[0]}function vYe(t,e,r,i){const n=Math.min(t.length-r,e.length-i);let s=0;for(;s<n&&t[r+s]===e[i+s];)s++;return s}function r3e(t,e,r,i){e&&e.forEach((n,s,o)=>{t.push(n),r3e(t,r.call(i,n,s,o),r,i)})}const G_=new Set,j_=new Set,H_=new Set,Mj=new Map;let bYe=0,y0=T0=class extends Xn.EventedAccessor{static isCollection(t){return t!=null&&t instanceof T0}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new nN,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:bYe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof T0?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return Ft(this._observable),this._items}set items(t){this._emitBeforeChanges(Ei.ADD)||(this._splice(0,this.length,Aj(t)),this._emitAfterChanges(Ei.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const r=this._chgListeners,i={removed:!1,callback:e};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),ri(()=>{i.removed=!0,r.splice(r.indexOf(i),1)})}return this._emitter.on(t,e)}once(t,e){const r="deref"in e?()=>e.deref():()=>e,i=this.on(t,n=>{var s;(s=r())==null||s.call(null,n),i.remove()});return i}add(t,e){if(Ft(this._observable),this._emitBeforeChanges(Ei.ADD))return this;const r=this.getNextIndex(e??null);return this._splice(r,0,[t]),this._emitAfterChanges(Ei.ADD),this}addMany(t,e=this._items.length){if(Ft(this._observable),!(t!=null&&t.length))return this;if(this._emitBeforeChanges(Ei.ADD))return this;const r=this.getNextIndex(e);return this._splice(r,0,Aj(t)),this._emitAfterChanges(Ei.ADD),this}at(t){if(Ft(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Ei.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(Ei.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Ft(this._observable),this._createNewInstance({items:this._items.map(ae)})}concat(...t){Ft(this._observable);const e=t.map(Aj);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Ei.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let n=0;n<i;n++)t.call(e,r[n],n,r);this._emitAfterChanges(Ei.REMOVE)}every(t,e){return Ft(this._observable),this._items.every(t,e)}filter(t,e){let r;return Ft(this._observable),r=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:r})}find(t,e){return Ft(this._observable),this._items.find(t,e)}findIndex(t,e){return Ft(this._observable),this._items.findIndex(t,e)}flatten(t,e){Ft(this._observable);const r=[];return r3e(r,this,t,e),new T0(r)}forEach(t,e){return Ft(this._observable),this._items.forEach(t,e)}getItemAt(t){return Ft(this._observable),this._items[t]}getNextIndex(t){Ft(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Ft(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Ft(this._observable),this._items.indexOf(t,e)}join(t=","){return Ft(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Ft(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Ft(this._observable);const r=this._items.map(t,e);return new T0({items:r})}reorder(t,e=this.length-1){Ft(this._observable);const r=this.indexOf(t);if(r!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),r!==e){if(this._emitBeforeChanges(Ei.MOVE))return t;this._splice(r,1),this._splice(e,0,[t]),this._emitAfterChanges(Ei.MOVE)}return t}}pop(){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Ei.REMOVE))return;const t=Oj(this._splice(this.length-1,1));return this._emitAfterChanges(Ei.REMOVE),t}push(...t){return Ft(this._observable),this._emitBeforeChanges(Ei.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(Ei.ADD)),this.length}reduce(t,e){Ft(this._observable);const r=this._items;return arguments.length===2?r.reduce(t,e):r.reduce(t)}reduceRight(t,e){Ft(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(t,e):r.reduceRight(t)}remove(t){return Ft(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Ft(this._observable),t<0||t>=this.length||this._emitBeforeChanges(Ei.REMOVE))return;const e=Oj(this._splice(t,1));return this._emitAfterChanges(Ei.REMOVE),e}removeMany(t){if(Ft(this._observable),!(t!=null&&t.length)||this._emitBeforeChanges(Ei.REMOVE))return[];const e=t instanceof T0?t.toArray():t,r=this._items,i=[],n=e.length;for(let s=0;s<n;s++){const o=e[s],a=r.indexOf(o);if(a>-1){const l=1+vYe(e,r,s+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),s+=l-1}}return this._emitAfterChanges(Ei.REMOVE),i}reverse(){if(Ft(this._observable),this._emitBeforeChanges(Ei.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(Ei.MOVE),this}shift(){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Ei.REMOVE))return;const t=Oj(this._splice(0,1));return this._emitAfterChanges(Ei.REMOVE),t}slice(t=0,e=this.length){return Ft(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Ft(this._observable),this._items.some(t,e)}sort(t){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Ei.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(Ei.MOVE),this}splice(t,e,...r){Ft(this._observable);const i=(e?Ei.REMOVE:0)|(r.length?Ei.ADD:0);if(this._emitBeforeChanges(i))return[];const n=this._splice(t,e,r)||[];return this._emitAfterChanges(i),n}toArray(){return Ft(this._observable),this._items.slice()}toJSON(){return Ft(this._observable),this.toArray()}toLocaleString(){return Ft(this._observable),this._items.toLocaleString()}toString(){return Ft(this._observable),this._items.toString()}unshift(...t){return Ft(this._observable),!t.length||this._emitBeforeChanges(Ei.ADD)||(this._splice(0,0,t),this._emitAfterChanges(Ei.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,r){const i=this._items,n=this.itemType;let s,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=m2(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(o=i.splice(t,e),this.hasEventListener("before-remove")){const a=Jh.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)s=o[l],a.reset(s),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(t,0,s),t+=1,l-=1,c-=1);Jh.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Jh.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Jh.release(a)}}if(r!=null&&r.length){if(n){const u=[];for(const h of r){const p=n.ensureType(h);p==null&&h!=null||u.push(p)}r=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const u=Jh.acquire();u.target=this,u.cancellable=!0;const h=Jh.acquire();h.target=this,h.cancellable=!1;for(const p of r)a?(u.reset(p),this.emit("before-add",u),u.defaultPrevented||(c?i.push(p):i.splice(t++,0,p),this._set("length",i.length),l&&(h.reset(p),this.emit("after-add",h)))):(c?i.push(p):i.splice(t++,0,p),this._set("length",i.length),h.reset(p),this.emit("after-add",h));Jh.release(h),Jh.release(u)}else{if(c)for(const u of r)i.push(u);else i.splice(t,0,...r);this._set("length",i.length)}}if((r!=null&&r.length||o!=null&&o.length)&&this._notifyChangeEvent(r,o),this.hasEventListener("after-splice")){const a=new _Ye(this,r,o,t,e);this.emit("after-splice",a)}return o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const r=Jh.acquire();r.target=this,r.cancellable=!0,r.type=t,this.emit("before-changes",r),e=r.defaultPrevented,Jh.release(r)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=Jh.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),Jh.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const r=e.changes;G_.clear(),j_.clear(),H_.clear();for(const{added:l,removed:c}of r){if(l)if(H_.size===0&&j_.size===0)for(const u of l)G_.add(u);else for(const u of l)j_.has(u)?(H_.add(u),j_.delete(u)):H_.has(u)||G_.add(u);if(c)if(H_.size===0&&G_.size===0)for(const u of c)j_.add(u);else for(const u of c)G_.has(u)?G_.delete(u):(H_.delete(u),j_.add(u))}const i=vu.acquire();G_.forEach(l=>{i.push(l)});const n=vu.acquire();j_.forEach(l=>{n.push(l)});const s=this._items,o=e.items,a=vu.acquire();if(H_.forEach(l=>{o.indexOf(l)!==s.indexOf(l)&&a.push(l)}),e.listeners&&(i.length||n.length||a.length)){const l={target:this,added:i,removed:n,moved:a},c=e.listeners.length;for(let u=0;u<c;u++){const h=e.listeners[u];h.removed||h.callback.call(this,l)}}vu.release(i),vu.release(n),vu.release(a)}G_.clear(),j_.clear(),H_.clear()}};y0.ofType=t=>{if(!t)return T0;if(Mj.has(t))return Mj.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const i in t.typeMap){const n=t.typeMap[i].prototype.declaredClass;e?e+=` | ${n}`:e=n}let r=class extends T0{};return d([t3e({Type:t,ensureType:typeof t=="function"?to(t):sy(t)})],r.prototype,"itemType",void 0),r=d([F(`esri.core.Collection<${e}>`)],r),Mj.set(t,r),r},d([m()],y0.prototype,"_updating",void 0),d([m()],y0.prototype,"length",void 0),d([m()],y0.prototype,"items",null),d([m({readOnly:!0})],y0.prototype,"updating",null),y0=T0=d([F("esri.core.Collection")],y0);const St=y0;function kT(t,e,r=St){return e||(e=new r),e===t||(e.removeAll(),wYe(t)?e.addMany(t):t&&e.add(t)),e}function i3e(t){return t}function wYe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}var hv;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(hv||(hv={}));let xYe=class{constructor(){this._resolver=ma(),this._status=hv.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=hv.RESOLVED,this._cleanUp()},()=>{this._status=hv.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===hv.RESOLVED}isRejected(){return this._status===hv.REJECTED}isFulfilled(){return this._status!==hv.PENDING}abort(){this._resolver.reject(gr())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=ma(),r=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve()},n=>{this.isFulfilled()||this._allPromise!==i||on(n)||this._resolver.reject(n)}),e.resolve()}};const hB=t=>{let e=class extends t{constructor(...r){super(...r),this._promiseProps=new xYe,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return this._promiseProps.promise.then(()=>this).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return e=d([F("esri.core.Promise")],e),e};let lz=class extends hB(Pe){};lz=d([F("esri.core.Promise")],lz);const SYe="not-loaded",TYe="loading",EYe="failed",$de="loaded",n3e=t=>{let e=class extends t{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const n=this.load.bind(this);this.load=s=>{const o=new Promise((a,l)=>{const c=iB(s,l);this.destroyed&&l(new B("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===SYe){this._set("loadStatus",TYe);const a=this._loadController=new AbortController;n({signal:a.signal})}return i(),o}})),this.when(()=>{this._set("loadStatus",$de),this._loadController=null},i=>{this._set("loadStatus",EYe),this._set("loadError",i),this._loadController=null})}destroy(){this._loadController&&(this._loadController=Ql(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===$de}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new B("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort(),this._promiseProps.abort()),this}};return d([m({readOnly:!0})],e.prototype,"loaded",null),d([m({readOnly:!0})],e.prototype,"loadError",void 0),d([m({clonable:!1})],e.prototype,"loadStatus",void 0),d([m({type:[sp],readOnly:!0})],e.prototype,"loadWarnings",null),e=d([F("esri.core.Loadable")],e),e};let WM=class extends n3e(lz){};WM=d([F("esri.core.Loadable")],WM),function(t){function e(r){return!(!r||!r.load)}t.LoadableMixin=n3e,t.isLoadable=e}(WM||(WM={}));const ay=WM;function dB(t,e,r){return nB(t.map((i,n)=>e.apply(r,[i,n])))}async function CYe(t,e,r){return(await nB(t.map((i,n)=>e.apply(r,[i,n])))).map(i=>i.value)}function $ne(t){return{ok:!0,value:t}}function Ine(t){return{ok:!1,error:t}}function PYe(t){return t!=null&&t.ok===!0?t.value:null}function AYe(t){return t!=null&&t.ok===!1?t.error:null}async function op(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return $ne(await t)}catch(e){return Ine(e)}}async function OYe(t){try{return $ne(await t)}catch(e){return ko(e),Ine(e)}}function sqt(t){if(t.ok===!0)return t.value;throw t.error}function b_(t,e){return new A1(t,e)}let A1=class extends Pe{get value(){return PYe(this._result)}get error(){return AYe(this._result)}get finished(){return this._result!=null}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=Ql(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(n=>{this._result=$ne(n),this._cleanup()},n=>{this._result=Ine(n),this._cleanup()}),this._abortHandle=la(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Pi(this._abortHandle),this._abortController=null}};d([m()],A1.prototype,"value",null),d([m()],A1.prototype,"error",null),d([m()],A1.prototype,"finished",null),d([m()],A1.prototype,"promise",void 0),d([m()],A1.prototype,"_result",void 0),A1=d([F("esri.core.asyncUtils.ReactiveTask")],A1);async function Lne(t,e){return await t.load(),MYe(t,e)}async function MYe(t,e){const r=[],i=(...s)=>{for(const o of s)o!=null&&(Array.isArray(o)?i(...o):St.isCollection(o)?o.forEach(a=>i(a)):ay.isLoadable(o)&&r.push(o))};e(i);let n=null;if(await CYe(r,async s=>{const o=await op(RYe(s)?s.loadAll():s.load());o.ok!==!1||n||(n=o)}),n)throw n.error;return t}function RYe(t){return"loadAll"in t&&typeof t.loadAll=="function"}function nt(t,e,r){let i,n;return e===void 0?(n=t,i=[void 0]):typeof e!="string"?(n=t,i=[void 0],r=e):(n=e,i=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;for(const l of i){const c=yne(s,l,n);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}let Ii=class{constructor(e,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,n,s)=>{const o=this.toJSON(i);o!==void 0&&f2(s,o,n)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const r=this._apiToJSON[e];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const r={};for(const i in e)r[e[i]]=i;return r}_getKeysSorted(e){const r=[];for(const i in e)r.push(i);return r.sort(),r}};function tc(){return function(t,e){return new Ii(t,{ignoreUnknown:!0,...e})}}let Dne=class{constructor(e,r,i,n){this.semiMajorAxis=e,this.flattening=r,this.outerAtmosphereRimWidth=i;const s=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*s,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=n||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const ni=new Dne(6378137,1/298.257223563,3e5,.006694379990137799),Jf=new Dne(3396190,1/169.8944472236118,23e4),o_=new Dne(1737400,0,0);function $Ye(t,e){return Vt(di(t),e)}function di(t){if(!ai.assetsPath)throw K.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new B("assets:path-not-set","config.assetsPath is not set");return Nc(ai.assetsPath,t)}let Rj,ce=null;function s3e(){return!!ce}function IYe(){return!!ne("esri-wasm")}function o3e(){return Rj||(Rj=re(()=>import("./pe-wasm-cK_NzllQ.js"),__vite__mapDeps([])).then(t=>t.p).then(({default:t})=>t({locateFile:e=>di(`esri/geometry/support/${e}`)})).then(t=>{l3e(t)}),Rj)}var gZ,is,yZ;(function(t){function e(s,o,a){ce.ensureCache.prepare();const l=_S(a),c=a===l,u=ce.ensureFloat64(l),h=ce._pe_geog_to_proj(ce.getPointer(s),o,u);return h&&Ev(a,o,u,c),h}function r(s,o,a,l){switch(l){case is.PE_TRANSFORM_P_TO_G:return i(s,o,a);case is.PE_TRANSFORM_G_TO_P:return e(s,o,a)}return 0}function i(s,o,a){return n(s,o,a,0)}function n(s,o,a,l){ce.ensureCache.prepare();const c=_S(a),u=a===c,h=ce.ensureFloat64(c),p=ce._pe_proj_to_geog_center(ce.getPointer(s),o,h,l);return p&&Ev(a,o,h,u),p}t.geogToProj=e,t.projGeog=r,t.projToGeog=i,t.projToGeogCenter=n})(gZ||(gZ={})),function(t){function e(){t.PE_BUFFER_MAX=ce.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=ce.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=ce.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=ce.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=ce.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=ce.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=ce.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=ce.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=ce.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=ce.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=ce.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=ce.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=ce.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=ce.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=ce.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=ce.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=ce.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=ce.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=ce.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=ce.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_STR_FMT_WKT=ce.PeDefs.prototype.PE_STR_FMT_WKT,t.PE_STR_FMT_WKT2=ce.PeDefs.prototype.PE_STR_FMT_WKT2,t.PE_PARM_X0=ce.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=ce.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=ce.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=ce.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=ce.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=ce.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=ce.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=ce.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=ce.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=ce.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(is||(is={})),function(t){const e={},r={},i=f=>{if(f){const g=f.getType();switch(g){case is.PE_TYPE_GEOGCS:f=ce.castObject(f,ce.PeGeogcs);break;case is.PE_TYPE_PROJCS:f=ce.castObject(f,ce.PeProjcs);break;case is.PE_TYPE_GEOGTRAN:f=ce.castObject(f,ce.PeGeogtran);break;default:g&is.PE_TYPE_UNIT&&(f=ce.castObject(f,ce.PeUnit))}}return f};function n(){ce.PeFactory.prototype.initialize(null)}function s(f){return o(is.PE_TYPE_COORDSYS,f)}function o(f,g){let y=null,v=e[f];if(v||(v={},e[f]=v),v.hasOwnProperty(String(g)))y=v[g];else{const b=ce.PeFactory.prototype.factoryByType(f,g);ce.compare(b,ce.NULL)||(y=b,v[g]=y)}return y=i(y),y}function a(f,g){let y=null,v=r[f];if(v||(v={},r[f]=v),v.hasOwnProperty(g))y=v[g];else{const b=ce.PeFactory.prototype.fromString(f,g);ce.compare(b,ce.NULL)||(y=b,v[g]=y)}return y=i(y),y}function l(f){return o(is.PE_TYPE_GEOGCS,f)}function c(f){return o(is.PE_TYPE_GEOGTRAN,f)}function u(f){return ce.PeFactory.prototype.getCode(f)}function h(f){return o(is.PE_TYPE_PROJCS,f)}function p(f){return o(is.PE_TYPE_UNIT,f)}t.initialize=n,t.coordsys=s,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=u,t.projcs=h,t.unit=p}(yZ||(yZ={}));let a3e=null;var cz,_Z,vZ,bZ,uz,wZ,hz,dz,xZ;function l3e(t){function e(s,o,a){s[o]=a(s[o])}ce=t,is.init(),cz.init(),uz.init(),hz.init(),dz.init(),a3e=class extends ce.PeGCSExtent{destroy(){ce.destroy(this)}};const r=[ce.PeDatum,ce.PeGeogcs,ce.PeGeogtran,ce.PeObject,ce.PeParameter,ce.PePrimem,ce.PeProjcs,ce.PeSpheroid,ce.PeUnit];for(const s of r)e(s.prototype,"getName",o=>function(){return o.call(this,new Array(is.PE_NAME_MAX))});for(const s of[ce.PeGeogtran,ce.PeProjcs])e(s.prototype,"getParameters",o=>function(){const a=new Array(is.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=ce.getValue(l,"*");a[c]=u?ce.wrapPointer(u,ce.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(ce.PeHorizon.prototype,"getCoord",s=>function(){const o=this.getSize();if(!o)return null;const a=[];return Ev(a,o,s.call(this)),a}),e(ce.PeGTlistExtendedEntry.prototype,"getEntries",s=>{const o=ce._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=s.call(this);if(!ce.compare(l,ce.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=ce.getPointer(l);for(let h=1;h<c;h++)a.push(ce.wrapPointer(u+o*h,ce.PeGTlistExtendedGTs))}}return a}});const i=ce._pe_getPeHorizonSize(),n=s=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(s))return o.get(s);let a=null;const l=s.call(this);if(!ce.compare(l,ce.NULL)){a=[l];const c=l.getNump();if(c>1){const u=ce.getPointer(l);for(let h=1;h<c;h++)a.push(ce.wrapPointer(u+i*h,ce.PeHorizon))}}return o.set(s,a),a};e(ce.PeProjcs.prototype,"horizonGcsGenerate",n),e(ce.PeProjcs.prototype,"horizonPcsGenerate",n),ce.PeObject.prototype.toString=function(s=is.PE_STR_OPTS_NONE){ce.ensureCache.prepare();const o=ce.getPointer(this),a=ce.ensureInt8(new Array(is.PE_BUFFER_MAX));return ce.UTF8ToString(ce._pe_object_to_string_ext(o,s,a))}}function My(t){if(!t)return;const e=ce.getClass(t);if(!e)return;const r=ce.getCache(e);if(!r)return;const i=ce.getPointer(t);i&&delete r[i]}function M4(t,e){const r=[],i=new Array(e);for(let n=0;n<t;n++)r.push(ce.ensureInt8(i));return r}function _S(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(r=>{e.push(r[0],r[1])})):e=t,e}function Ev(t,e,r,i=!1){if(i)for(let n=0;n<2*e;n++)t[n]=ce.getValue(r+n*Float64Array.BYTES_PER_ELEMENT,"double");else{const n=t.length===0;for(let s=0;s<e;s++)n&&(t[s]=new Array(2)),t[s][0]=ce.getValue(r,"double"),t[s][1]=ce.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function r(){t.PE_GTLIST_OPTS_COMMON=ce.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=ce._pe_getPeGTlistExtendedEntrySize()}function i(n,s,o,a,l,c){let u=null;const h=new ce.PeInteger(c);try{const p=ce.PeGTlistExtended.prototype.getGTlist(n,s,o,a,l,h);if((c=h.val)&&(u=[p],c>1)){const f=ce.getPointer(p);for(let g=1;g<c;g++)u.push(ce.wrapPointer(f+e*g,ce.PeGTlistExtendedEntry))}}finally{ce.destroy(h)}return u}t.init=r,t.getGTlist=i})(cz||(cz={})),function(t){function e(r){if(r!=null&&r.length){for(const i of r)My(i),i.getEntries().forEach(n=>{My(n);const s=n.getGeogtran();My(s),s.getParameters().forEach(My),[s.getGeogcs1(),s.getGeogcs2()].forEach(o=>{My(o);const a=o.getDatum();My(a),My(a.getSpheroid()),My(o.getPrimem()),My(o.getUnit())})});ce.PeGTlistExtendedEntry.prototype.Delete(r[0])}}t.destroy=e}(_Z||(_Z={})),function(t){function e(r,i,n,s,o){ce.ensureCache.prepare();const a=_S(n),l=n===a,c=ce.ensureFloat64(a);let u=0;s&&(u=ce.ensureFloat64(s));const h=ce._pe_geog_to_geog(ce.getPointer(r),i,c,u,o);return h&&Ev(n,i,c,l),h}t.geogToGeog=e}(vZ||(vZ={})),function(t){const e=(c,u,h,p,f,g)=>{let y,v;switch(ce.ensureCache.prepare(),c){case"dd":y=ce._pe_geog_to_dd,v=is.PE_DD_MAX;break;case"ddm":y=ce._pe_geog_to_ddm,v=is.PE_DDM_MAX;break;case"dms":y=ce._pe_geog_to_dms,v=is.PE_DMS_MAX}let b=0;u&&(b=ce.getPointer(u));const w=_S(p),x=ce.ensureFloat64(w),S=M4(h,v),E=y(b,h,x,f,ce.ensureInt32(S));if(E)for(let P=0;P<h;P++)g[P]=ce.UTF8ToString(S[P]);return E},r=(c,u,h,p,f)=>{let g;switch(ce.ensureCache.prepare(),c){case"dd":g=ce._pe_dd_to_geog;break;case"ddm":g=ce._pe_ddm_to_geog;break;case"dms":g=ce._pe_dms_to_geog}let y=0;u&&(y=ce.getPointer(u));const v=p.map(S=>ce.ensureString(S)),b=ce.ensureInt32(v),w=ce.ensureFloat64(new Array(2*h)),x=g(y,h,b,w);return x&&Ev(f,h,w),x};function i(c,u,h,p,f){return e("dms",c,u,h,p,f)}function n(c,u,h,p){return r("dms",c,u,h,p)}function s(c,u,h,p,f){return e("ddm",c,u,h,p,f)}function o(c,u,h,p){return r("ddm",c,u,h,p)}function a(c,u,h,p,f){return e("dd",c,u,h,p,f)}function l(c,u,h,p){return r("dd",c,u,h,p)}t.geogToDms=i,t.dmsToGeog=n,t.geogToDdm=s,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(bZ||(bZ={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=ce.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=ce.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=ce.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=ce.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=ce.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(n,s,o,a,l,c,u){ce.ensureCache.prepare();let h=0;n&&(h=ce.getPointer(n));const p=_S(o),f=ce.ensureFloat64(p),g=M4(s,is.PE_MGRS_MAX),y=ce.ensureInt32(g),v=ce._pe_geog_to_mgrs_extended(h,s,f,a,l,c,y);if(v)for(let b=0;b<s;b++)u[b]=ce.UTF8ToString(g[b]);return v}function i(n,s,o,a,l){ce.ensureCache.prepare();let c=0;n&&(c=ce.getPointer(n));const u=o.map(g=>ce.ensureString(g)),h=ce.ensureInt32(u),p=ce.ensureFloat64(new Array(2*s)),f=ce._pe_mgrs_to_geog_extended(c,s,h,a,p);return f&&Ev(l,s,p),f}t.init=e,t.geogToMgrsExtended=r,t.mgrsToGeogExtended=i}(uz||(uz={})),function(t){function e(i,n,s,o,a,l,c){ce.ensureCache.prepare();let u=0;i&&(u=ce.getPointer(i));const h=_S(s),p=ce.ensureFloat64(h),f=M4(n,is.PE_MGRS_MAX),g=ce.ensureInt32(f),y=ce._pe_geog_to_usng(u,n,p,o,a,l,g);if(y)for(let v=0;v<n;v++)c[v]=ce.UTF8ToString(f[v]);return y}function r(i,n,s,o){ce.ensureCache.prepare();let a=0;i&&(a=ce.getPointer(i));const l=s.map(p=>ce.ensureString(p)),c=ce.ensureInt32(l),u=ce.ensureFloat64(new Array(2*n)),h=ce._pe_usng_to_geog(a,n,c,u);return h&&Ev(o,n,u),h}t.geogToUsng=e,t.usngToGeog=r}(wZ||(wZ={})),function(t){function e(){t.PE_UTM_OPTS_NONE=ce.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=ce.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=ce.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(n,s,o,a,l){ce.ensureCache.prepare();let c=0;n&&(c=ce.getPointer(n));const u=_S(o),h=ce.ensureFloat64(u),p=M4(s,is.PE_UTM_MAX),f=ce.ensureInt32(p),g=ce._pe_geog_to_utm(c,s,h,a,f);if(g)for(let y=0;y<s;y++)l[y]=ce.UTF8ToString(p[y]);return g}function i(n,s,o,a,l){ce.ensureCache.prepare();let c=0;n&&(c=ce.getPointer(n));const u=o.map(g=>ce.ensureString(g)),h=ce.ensureInt32(u),p=ce.ensureFloat64(new Array(2*s)),f=ce._pe_utm_to_geog(c,s,h,a,p);return f&&Ev(l,s,p),f}t.init=e,t.geogToUtm=r,t.utmToGeog=i}(hz||(hz={})),function(t){const e=new Map;function r(){t.PE_PCSINFO_OPTION_NONE=ce.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=ce.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=ce.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=ce.PePCSInfo.prototype.PE_POLE_POINT}function i(n,s=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(n)&&(a=e.get(n),a[s]&&(o=a[s])),o||(o=ce.PePCSInfo.prototype.generate(n,s),a||(a=[],e.set(n,a)),a[s]=o),o}t.init=r,t.generate=i}(dz||(dz={})),function(t){function e(){return ce.PeVersion.prototype.version_string()}t.versionString=e}(xZ||(xZ={}));const LYe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return gZ},get PeDefs(){return is},get PeFactory(){return yZ},get PeGCSExtent(){return a3e},get PeGTTransformations(){return vZ},get PeGTlistExtended(){return cz},get PeGTlistExtendedEntry(){return _Z},get PeNotationDms(){return bZ},get PeNotationMgrs(){return uz},get PeNotationUsng(){return wZ},get PeNotationUtm(){return hz},get PePCSInfo(){return dz},get PeVersion(){return xZ},_init:l3e,get _pe(){return ce},isLoaded:s3e,isSupported:IYe,load:o3e},Symbol.toStringTag,{value:"Module"}));var Vd;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(Vd||(Vd={}));let _;const N={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(_=2e3;_<=2045;_++)N[_]=0;for(_=2056;_<=2065;_++)N[_]=0;for(_=2067;_<=2135;_++)N[_]=0;for(_=2137;_<=2154;_++)N[_]=0;for(_=2161;_<=2170;_++)N[_]=0;for(_=2172;_<=2193;_++)N[_]=0;for(_=2195;_<=2198;_++)N[_]=0;for(_=2200;_<=2203;_++)N[_]=0;for(_=2205;_<=2217;_++)N[_]=0;for(_=2222;_<=2224;_++)N[_]=1;for(_=2225;_<=2250;_++)N[_]=2;for(_=2251;_<=2253;_++)N[_]=1;for(_=2257;_<=2264;_++)N[_]=2;for(_=2274;_<=2279;_++)N[_]=2;for(_=2280;_<=2282;_++)N[_]=1;for(_=2283;_<=2289;_++)N[_]=2;for(_=2290;_<=2292;_++)N[_]=0;for(_=2308;_<=2313;_++)N[_]=0;for(_=2315;_<=2491;_++)N[_]=0;for(_=2494;_<=2866;_++)N[_]=0;for(_=2867;_<=2869;_++)N[_]=1;for(_=2870;_<=2888;_++)N[_]=2;for(_=2891;_<=2895;_++)N[_]=2;for(_=2896;_<=2898;_++)N[_]=1;for(_=2902;_<=2908;_++)N[_]=2;for(_=2915;_<=2920;_++)N[_]=2;for(_=2921;_<=2923;_++)N[_]=1;for(_=2924;_<=2930;_++)N[_]=2;for(_=2931;_<=2962;_++)N[_]=0;for(_=2964;_<=2968;_++)N[_]=2;for(_=2969;_<=2973;_++)N[_]=0;for(_=2975;_<=2991;_++)N[_]=0;for(_=2995;_<=3051;_++)N[_]=0;for(_=3054;_<=3079;_++)N[_]=0;for(_=3081;_<=3088;_++)N[_]=0;for(_=3092;_<=3101;_++)N[_]=0;for(_=3106;_<=3138;_++)N[_]=0;for(_=3146;_<=3151;_++)N[_]=0;for(_=3153;_<=3166;_++)N[_]=0;for(_=3168;_<=3172;_++)N[_]=0;for(_=3174;_<=3203;_++)N[_]=0;for(_=3294;_<=3358;_++)N[_]=0;for(_=3367;_<=3403;_++)N[_]=0;for(_=3408;_<=3416;_++)N[_]=0;for(_=3417;_<=3438;_++)N[_]=2;for(_=3441;_<=3446;_++)N[_]=2;for(_=3447;_<=3450;_++)N[_]=0;for(_=3451;_<=3459;_++)N[_]=2;for(_=3460;_<=3478;_++)N[_]=0;for(_=3554;_<=3559;_++)N[_]=0;for(_=3560;_<=3570;_++)N[_]=2;for(_=3571;_<=3581;_++)N[_]=0;for(_=3594;_<=3597;_++)N[_]=0;for(_=3601;_<=3604;_++)N[_]=0;for(_=3637;_<=3639;_++)N[_]=0;for(_=3665;_<=3667;_++)N[_]=0;for(_=3693;_<=3695;_++)N[_]=0;for(_=3701;_<=3727;_++)N[_]=0;for(_=3728;_<=3739;_++)N[_]=2;for(_=3740;_<=3751;_++)N[_]=0;for(_=3753;_<=3760;_++)N[_]=2;for(_=3761;_<=3773;_++)N[_]=0;for(_=3775;_<=3777;_++)N[_]=0;for(_=3779;_<=3781;_++)N[_]=0;for(_=3783;_<=3785;_++)N[_]=0;for(_=3788;_<=3791;_++)N[_]=0;for(_=3797;_<=3802;_++)N[_]=0;for(_=3814;_<=3816;_++)N[_]=0;for(_=3825;_<=3829;_++)N[_]=0;for(_=3832;_<=3841;_++)N[_]=0;for(_=3844;_<=3852;_++)N[_]=0;for(_=3873;_<=3885;_++)N[_]=0;for(_=3890;_<=3893;_++)N[_]=0;for(_=3907;_<=3912;_++)N[_]=0;for(_=3942;_<=3950;_++)N[_]=0;for(_=3968;_<=3970;_++)N[_]=0;for(_=3973;_<=3976;_++)N[_]=0;for(_=3986;_<=3989;_++)N[_]=0;for(_=3994;_<=3997;_++)N[_]=0;for(_=4048;_<=4051;_++)N[_]=0;for(_=4056;_<=4063;_++)N[_]=0;for(_=4093;_<=4096;_++)N[_]=0;for(_=4390;_<=4398;_++)N[_]=0;for(_=4399;_<=4413;_++)N[_]=2;for(_=4418;_<=4433;_++)N[_]=2;for(_=4455;_<=4457;_++)N[_]=2;for(_=4484;_<=4489;_++)N[_]=0;for(_=4491;_<=4554;_++)N[_]=0;for(_=4568;_<=4589;_++)N[_]=0;for(_=4652;_<=4656;_++)N[_]=0;for(_=4766;_<=4800;_++)N[_]=0;for(_=5014;_<=5016;_++)N[_]=0;for(_=5069;_<=5072;_++)N[_]=0;for(_=5105;_<=5130;_++)N[_]=0;for(_=5167;_<=5188;_++)N[_]=0;for(_=5253;_<=5259;_++)N[_]=0;for(_=5269;_<=5275;_++)N[_]=0;for(_=5292;_<=5311;_++)N[_]=0;for(_=5329;_<=5331;_++)N[_]=0;for(_=5343;_<=5349;_++)N[_]=0;for(_=5355;_<=5357;_++)N[_]=0;for(_=5387;_<=5389;_++)N[_]=0;for(_=5459;_<=5463;_++)N[_]=0;for(_=5479;_<=5482;_++)N[_]=0;for(_=5518;_<=5520;_++)N[_]=0;for(_=5530;_<=5539;_++)N[_]=0;for(_=5550;_<=5552;_++)N[_]=0;for(_=5562;_<=5583;_++)N[_]=0;for(_=5623;_<=5625;_++)N[_]=2;for(_=5631;_<=5639;_++)N[_]=0;for(_=5649;_<=5653;_++)N[_]=0;for(_=5663;_<=5680;_++)N[_]=0;for(_=5682;_<=5685;_++)N[_]=0;for(_=5875;_<=5877;_++)N[_]=0;for(_=5896;_<=5899;_++)N[_]=0;for(_=5921;_<=5940;_++)N[_]=0;for(_=6050;_<=6125;_++)N[_]=0;for(_=6244;_<=6275;_++)N[_]=0;for(_=6328;_<=6348;_++)N[_]=0;for(_=6350;_<=6356;_++)N[_]=0;for(_=6366;_<=6372;_++)N[_]=0;for(_=6381;_<=6387;_++)N[_]=0;for(_=6393;_<=6404;_++)N[_]=0;for(_=6480;_<=6483;_++)N[_]=0;for(_=6511;_<=6514;_++)N[_]=0;for(_=6579;_<=6581;_++)N[_]=0;for(_=6619;_<=6624;_++)N[_]=0;for(_=6625;_<=6627;_++)N[_]=2;for(_=6628;_<=6632;_++)N[_]=0;for(_=6634;_<=6637;_++)N[_]=0;for(_=6669;_<=6692;_++)N[_]=0;for(_=6707;_<=6709;_++)N[_]=0;for(_=6720;_<=6723;_++)N[_]=0;for(_=6732;_<=6738;_++)N[_]=0;for(_=6931;_<=6933;_++)N[_]=0;for(_=6956;_<=6959;_++)N[_]=0;for(_=7005;_<=7007;_++)N[_]=0;for(_=7057;_<=7070;_++)N[_]=2;for(_=7074;_<=7082;_++)N[_]=0;for(_=7109;_<=7118;_++)N[_]=0;for(_=7119;_<=7127;_++)N[_]=1;for(_=7374;_<=7376;_++)N[_]=0;for(_=7528;_<=7586;_++)N[_]=0;for(_=7587;_<=7645;_++)N[_]=2;for(_=7692;_<=7696;_++)N[_]=0;for(_=7755;_<=7787;_++)N[_]=0;for(_=7791;_<=7795;_++)N[_]=0;for(_=7799;_<=7801;_++)N[_]=0;for(_=7803;_<=7805;_++)N[_]=0;for(_=7825;_<=7831;_++)N[_]=0;for(_=7845;_<=7859;_++)N[_]=0;for(_=8013;_<=8032;_++)N[_]=0;for(_=8065;_<=8068;_++)N[_]=1;for(_=8518;_<=8529;_++)N[_]=2;for(_=8533;_<=8536;_++)N[_]=2;for(_=8538;_<=8540;_++)N[_]=2;for(_=8677;_<=8679;_++)N[_]=0;for(_=8836;_<=8840;_++)N[_]=0;for(_=8857;_<=8859;_++)N[_]=0;for(_=8908;_<=8910;_++)N[_]=0;for(_=9154;_<=9159;_++)N[_]=0;for(_=9205;_<=9218;_++)N[_]=0;for(_=9271;_<=9273;_++)N[_]=0;for(_=9295;_<=9297;_++)N[_]=0;for(_=9356;_<=9360;_++)N[_]=0;for(_=9404;_<=9407;_++)N[_]=0;for(_=9476;_<=9482;_++)N[_]=0;for(_=9487;_<=9494;_++)N[_]=0;for(_=9697;_<=9699;_++)N[_]=0;for(_=9821;_<=9865;_++)N[_]=0;for(_=10285;_<=10291;_++)N[_]=0;for(_=10314;_<=10317;_++)N[_]=0;for(_=10448;_<=10465;_++)N[_]=0;for(_=11114;_<=11118;_++)N[_]=0;for(_=20004;_<=20032;_++)N[_]=0;for(_=20047;_<=20049;_++)N[_]=0;for(_=20062;_<=20092;_++)N[_]=0;for(_=20135;_<=20138;_++)N[_]=0;for(_=20248;_<=20258;_++)N[_]=0;for(_=20348;_<=20358;_++)N[_]=0;for(_=20436;_<=20440;_++)N[_]=0;for(_=20822;_<=20824;_++)N[_]=0;for(_=20904;_<=20932;_++)N[_]=0;for(_=20934;_<=20936;_++)N[_]=0;for(_=21004;_<=21032;_++)N[_]=0;for(_=21035;_<=21037;_++)N[_]=0;for(_=21095;_<=21097;_++)N[_]=0;for(_=21148;_<=21150;_++)N[_]=0;for(_=21207;_<=21264;_++)N[_]=0;for(_=21307;_<=21364;_++)N[_]=0;for(_=21413;_<=21423;_++)N[_]=0;for(_=21453;_<=21463;_++)N[_]=0;for(_=21473;_<=21483;_++)N[_]=0;for(_=21780;_<=21782;_++)N[_]=0;for(_=21891;_<=21894;_++)N[_]=0;for(_=21896;_<=21899;_++)N[_]=0;for(_=22171;_<=22177;_++)N[_]=0;for(_=22181;_<=22187;_++)N[_]=0;for(_=22191;_<=22197;_++)N[_]=0;for(_=22207;_<=22222;_++)N[_]=0;for(_=22229;_<=22232;_++)N[_]=0;for(_=22234;_<=22236;_++)N[_]=0;for(_=22243;_<=22250;_++)N[_]=0;for(_=22262;_<=22265;_++)N[_]=0;for(_=22307;_<=22322;_++)N[_]=0;for(_=22348;_<=22357;_++)N[_]=0;for(_=22407;_<=22422;_++)N[_]=0;for(_=22462;_<=22465;_++)N[_]=0;for(_=22521;_<=22525;_++)N[_]=0;for(_=22607;_<=22622;_++)N[_]=0;for(_=22641;_<=22646;_++)N[_]=0;for(_=22648;_<=22657;_++)N[_]=0;for(_=22707;_<=22722;_++)N[_]=0;for(_=22762;_<=22765;_++)N[_]=0;for(_=22807;_<=22822;_++)N[_]=0;for(_=22991;_<=22994;_++)N[_]=0;for(_=23028;_<=23038;_++)N[_]=0;for(_=23301;_<=23333;_++)N[_]=2;for(_=23830;_<=23853;_++)N[_]=0;for(_=23866;_<=23872;_++)N[_]=0;for(_=23877;_<=23884;_++)N[_]=0;for(_=23886;_<=23894;_++)N[_]=0;for(_=23946;_<=23948;_++)N[_]=0;for(_=24311;_<=24313;_++)N[_]=0;for(_=24342;_<=24347;_++)N[_]=0;for(_=24370;_<=24374;_++)N[_]=10;for(_=24375;_<=24381;_++)N[_]=0;for(_=24718;_<=24721;_++)N[_]=0;for(_=24817;_<=24821;_++)N[_]=0;for(_=24877;_<=24882;_++)N[_]=0;for(_=24891;_<=24893;_++)N[_]=0;for(_=25391;_<=25395;_++)N[_]=0;for(_=25828;_<=25838;_++)N[_]=0;for(_=26191;_<=26195;_++)N[_]=0;for(_=26391;_<=26393;_++)N[_]=0;for(_=26701;_<=26722;_++)N[_]=0;for(_=26729;_<=26799;_++)N[_]=2;for(_=26801;_<=26803;_++)N[_]=2;for(_=26811;_<=26813;_++)N[_]=2;for(_=26847;_<=26870;_++)N[_]=2;for(_=26891;_<=26899;_++)N[_]=0;for(_=26901;_<=26923;_++)N[_]=0;for(_=26929;_<=26946;_++)N[_]=0;for(_=26948;_<=26998;_++)N[_]=0;for(_=27037;_<=27040;_++)N[_]=0;for(_=27205;_<=27232;_++)N[_]=0;for(_=27258;_<=27260;_++)N[_]=0;for(_=27391;_<=27398;_++)N[_]=0;for(_=27561;_<=27564;_++)N[_]=0;for(_=27571;_<=27574;_++)N[_]=0;for(_=27581;_<=27584;_++)N[_]=0;for(_=27591;_<=27594;_++)N[_]=0;for(_=28191;_<=28193;_++)N[_]=0;for(_=28348;_<=28358;_++)N[_]=0;for(_=28402;_<=28432;_++)N[_]=0;for(_=28462;_<=28492;_++)N[_]=0;for(_=29118;_<=29122;_++)N[_]=0;for(_=29168;_<=29172;_++)N[_]=0;for(_=29177;_<=29185;_++)N[_]=0;for(_=29187;_<=29195;_++)N[_]=0;for(_=29900;_<=29903;_++)N[_]=0;for(_=30161;_<=30179;_++)N[_]=0;for(_=30491;_<=30494;_++)N[_]=0;for(_=30729;_<=30732;_++)N[_]=0;for(_=31251;_<=31259;_++)N[_]=0;for(_=31265;_<=31268;_++)N[_]=0;for(_=31275;_<=31279;_++)N[_]=0;for(_=31281;_<=31297;_++)N[_]=0;for(_=31461;_<=31469;_++)N[_]=0;for(_=31491;_<=31495;_++)N[_]=0;for(_=31917;_<=31922;_++)N[_]=0;for(_=31965;_<=32e3;_++)N[_]=0;for(_=32001;_<=32003;_++)N[_]=2;for(_=32005;_<=32031;_++)N[_]=2;for(_=32033;_<=32060;_++)N[_]=2;for(_=32064;_<=32067;_++)N[_]=2;for(_=32074;_<=32077;_++)N[_]=2;for(_=32081;_<=32086;_++)N[_]=0;for(_=32107;_<=32130;_++)N[_]=0;for(_=32133;_<=32159;_++)N[_]=0;for(_=32164;_<=32167;_++)N[_]=2;for(_=32180;_<=32199;_++)N[_]=0;for(_=32201;_<=32260;_++)N[_]=0;for(_=32301;_<=32360;_++)N[_]=0;for(_=32401;_<=32460;_++)N[_]=0;for(_=32501;_<=32560;_++)N[_]=0;for(_=32601;_<=32662;_++)N[_]=0;for(_=32664;_<=32667;_++)N[_]=2;for(_=32701;_<=32761;_++)N[_]=0;for(_=53001;_<=53004;_++)N[_]=0;for(_=53008;_<=53019;_++)N[_]=0;for(_=53021;_<=53032;_++)N[_]=0;for(_=53034;_<=53037;_++)N[_]=0;for(_=53042;_<=53046;_++)N[_]=0;for(_=53074;_<=53080;_++)N[_]=0;for(_=54001;_<=54004;_++)N[_]=0;for(_=54008;_<=54019;_++)N[_]=0;for(_=54021;_<=54032;_++)N[_]=0;for(_=54034;_<=54037;_++)N[_]=0;for(_=54042;_<=54046;_++)N[_]=0;for(_=54048;_<=54053;_++)N[_]=0;for(_=54074;_<=54080;_++)N[_]=0;for(_=54098;_<=54101;_++)N[_]=0;for(_=102001;_<=102040;_++)N[_]=0;for(_=102042;_<=102063;_++)N[_]=0;for(_=102065;_<=102067;_++)N[_]=0;for(_=102070;_<=102117;_++)N[_]=0;for(_=102122;_<=102216;_++)N[_]=0;for(_=102221;_<=102377;_++)N[_]=0;for(_=102382;_<=102388;_++)N[_]=0;for(_=102389;_<=102398;_++)N[_]=2;for(_=102399;_<=102444;_++)N[_]=0;for(_=102445;_<=102447;_++)N[_]=2;for(_=102448;_<=102458;_++)N[_]=0;for(_=102459;_<=102468;_++)N[_]=2;for(_=102469;_<=102499;_++)N[_]=0;for(_=102500;_<=102519;_++)N[_]=1;for(_=102520;_<=102524;_++)N[_]=0;for(_=102525;_<=102529;_++)N[_]=2;for(_=102530;_<=102588;_++)N[_]=0;for(_=102590;_<=102598;_++)N[_]=0;for(_=102601;_<=102603;_++)N[_]=0;for(_=102605;_<=102628;_++)N[_]=0;for(_=102629;_<=102646;_++)N[_]=2;for(_=102648;_<=102700;_++)N[_]=2;for(_=102701;_<=102703;_++)N[_]=0;for(_=102707;_<=102730;_++)N[_]=2;for(_=102733;_<=102758;_++)N[_]=2;for(_=102767;_<=102900;_++)N[_]=0;for(_=102901;_<=102933;_++)N[_]=2;for(_=102934;_<=102950;_++)N[_]=13;for(_=102951;_<=102955;_++)N[_]=0;for(_=102961;_<=102963;_++)N[_]=0;for(_=102965;_<=102969;_++)N[_]=0;for(_=102971;_<=102973;_++)N[_]=0;for(_=102975;_<=102989;_++)N[_]=0;for(_=102990;_<=102992;_++)N[_]=1;for(_=102997;_<=103002;_++)N[_]=0;for(_=103003;_<=103008;_++)N[_]=2;for(_=103009;_<=103011;_++)N[_]=0;for(_=103012;_<=103014;_++)N[_]=2;for(_=103019;_<=103021;_++)N[_]=0;for(_=103022;_<=103024;_++)N[_]=2;for(_=103029;_<=103031;_++)N[_]=0;for(_=103032;_<=103034;_++)N[_]=2;for(_=103065;_<=103068;_++)N[_]=0;for(_=103074;_<=103076;_++)N[_]=0;for(_=103077;_<=103079;_++)N[_]=1;for(_=103080;_<=103082;_++)N[_]=0;for(_=103083;_<=103085;_++)N[_]=2;for(_=103090;_<=103093;_++)N[_]=0;for(_=103097;_<=103099;_++)N[_]=0;for(_=103100;_<=103102;_++)N[_]=2;for(_=103107;_<=103109;_++)N[_]=0;for(_=103110;_<=103112;_++)N[_]=2;for(_=103113;_<=103116;_++)N[_]=0;for(_=103117;_<=103120;_++)N[_]=2;for(_=103153;_<=103157;_++)N[_]=0;for(_=103158;_<=103162;_++)N[_]=2;for(_=103163;_<=103165;_++)N[_]=0;for(_=103166;_<=103168;_++)N[_]=1;for(_=103169;_<=103171;_++)N[_]=2;for(_=103186;_<=103188;_++)N[_]=0;for(_=103189;_<=103191;_++)N[_]=2;for(_=103192;_<=103195;_++)N[_]=0;for(_=103196;_<=103199;_++)N[_]=2;for(_=103200;_<=103224;_++)N[_]=0;for(_=103225;_<=103227;_++)N[_]=1;for(_=103232;_<=103237;_++)N[_]=0;for(_=103238;_<=103243;_++)N[_]=2;for(_=103244;_<=103246;_++)N[_]=0;for(_=103247;_<=103249;_++)N[_]=2;for(_=103254;_<=103256;_++)N[_]=0;for(_=103257;_<=103259;_++)N[_]=2;for(_=103264;_<=103266;_++)N[_]=0;for(_=103267;_<=103269;_++)N[_]=2;for(_=103300;_<=103375;_++)N[_]=0;for(_=103381;_<=103383;_++)N[_]=0;for(_=103384;_<=103386;_++)N[_]=1;for(_=103387;_<=103389;_++)N[_]=0;for(_=103390;_<=103392;_++)N[_]=2;for(_=103397;_<=103399;_++)N[_]=0;for(_=103400;_<=103471;_++)N[_]=2;for(_=103476;_<=103478;_++)N[_]=0;for(_=103479;_<=103481;_++)N[_]=2;for(_=103486;_<=103488;_++)N[_]=0;for(_=103489;_<=103491;_++)N[_]=2;for(_=103492;_<=103495;_++)N[_]=0;for(_=103496;_<=103499;_++)N[_]=2;for(_=103528;_<=103543;_++)N[_]=0;for(_=103544;_<=103548;_++)N[_]=2;for(_=103549;_<=103551;_++)N[_]=0;for(_=103552;_<=103554;_++)N[_]=1;for(_=103555;_<=103557;_++)N[_]=2;for(_=103558;_<=103560;_++)N[_]=0;for(_=103571;_<=103573;_++)N[_]=0;for(_=103574;_<=103576;_++)N[_]=2;for(_=103577;_<=103580;_++)N[_]=0;for(_=103581;_<=103583;_++)N[_]=2;for(_=103595;_<=103694;_++)N[_]=0;for(_=103696;_<=103699;_++)N[_]=0;for(_=103700;_<=103793;_++)N[_]=2;for(_=103794;_<=103890;_++)N[_]=0;for(_=103891;_<=103896;_++)N[_]=2;for(_=103900;_<=103971;_++)N[_]=2;for(_=103972;_<=103977;_++)N[_]=0;for(_=112e3;_<=112101;_++)N[_]=0;const c3e=[102100,102113,3857,3785],DYe=[104905,104971],NYe=[4326,...c3e,...DYe],Ide='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',R4=[-20037508342788905e-9,20037508342788905e-9],$4=[-20037508342787e-6,20037508342787e-6],u3e={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:R4,origin:$4,dx:1e-5},102100:{wkTemplate:Ide,valid:R4,origin:$4,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:R4,origin:$4,dx:1e-5},3857:{wkTemplate:Ide,valid:R4,origin:$4,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function yo(t,e){if(t===e)return!0;if(t==null||e==null)return!1;const r=t.wkid,i=e.wkid;if(r!=null||i!=null){if(r===i||UT(t)&&UT(e))return!0;const o=t.latestWkid;if(o!=null&&i===o)return!0;const a=e.latestWkid;return a!=null&&r===a}let n,s;return t.wkt2&&e.wkt2?(n=t.wkt2,s=e.wkt2):t.wkt&&e.wkt&&(n=t.wkt,s=e.wkt),!(!n||!s)&&n.toUpperCase()===s.toUpperCase()}function Qf(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&u3e[e]||null}function AP(t){if(!t)return;const{wkid:e,vcsWkid:r}=t;if(e)return r?JSON.stringify({wkid:e,vcsWkid:r}):String(e);const i=t.wkt||t.wkt2;return JSON.stringify(i?r?{wkt:i,vcsWkid:r}:{wkt:i}:{})}function Nne(t){if(!Ng(t))return!1;const{wkid:e}=t;if(e)return N[e]==null;const r=t.wkt2||t.wkt;return!!r&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(r)}function kL(t){return!(nw(t)||sw(t))}function UL(t){return(t==null?void 0:t.wkid)===4326}function cqt(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function h3e(t){return(t==null?void 0:t.wkid)===Vd.CGCS2000}function UT(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&c3e.includes(e)}function zL(t){return(t==null?void 0:t.wkid)===32662}function OP(t){return t===Vd.GCSMARS2000||t===Vd.GCSMARS2000_SPHERE}function nw(t){return OP(t==null?void 0:t.wkid)}function MP(t){return t===Vd.GCSMOON2000}function sw(t){return MP(t==null?void 0:t.wkid)}function FYe(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&NYe.includes(e)}function Ng(t){if(t==null)return!1;const e=t.wkid;return e!=null&&e>=2e3||t.wkt2!=null||t.wkt!=null}const d3e={wkid:4326,wkt:une(u3e[4326].wkTemplate,{Central_Meridian:"0.0"})},p3e={wkid:102100,latestWkid:3857},kYe={wkid:32662};function Fne(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const f3e=Fne(ni),pB=Fne(Jf),fB=Fne(o_),m3e={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${ni.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`},UYe=pB.wkt.toUpperCase(),zYe=fB.wkt.toUpperCase();function zr(t){if(t!=null&&Ng(t)){const e=t.wkid,r=t.wkt2??t.wkt;if(OP(e))return Jf;const i=r==null?void 0:r.toUpperCase();if(r&&i===UYe)return Jf;if(MP(e)||i&&i===zYe)return o_}return ni}function uqt(t){return OP(t)?Jf:MP(t)?o_:ni}function pz(t){return yo(t,f3e)}function wb(t){return pz(t)||yo(t,pB)||yo(t,fB)}const kne=39.37,VYe=ni.radius*Math.PI/200,g3e=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,uT=N,y3e=/UNIT\[([^\]]+)]/i,BYe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),GYe=tc()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Em=t=>t*t,q_=t=>t*t*t,VL={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Em(.001)},"square-centimeters":{inBaseUnits:Em(.01)},"square-decimeters":{inBaseUnits:Em(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Em(1e3)},"square-inches":{inBaseUnits:Em(.0254)},"square-feet":{inBaseUnits:Em(.3048)},"square-yards":{inBaseUnits:Em(.9144)},"square-miles":{inBaseUnits:Em(1609.344)},"square-us-feet":{inBaseUnits:Em(1200/3937)},acres:{inBaseUnits:.0015625*Em(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*q_(.001)},"cubic-centimeters":{inBaseUnits:1e3*q_(.01)},"cubic-decimeters":{inBaseUnits:1e3*q_(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*q_(1e3)},"cubic-inches":{inBaseUnits:1e3*q_(.0254)},"cubic-feet":{inBaseUnits:1e3*q_(.3048)},"cubic-yards":{inBaseUnits:1e3*q_(.9144)},"cubic-miles":{inBaseUnits:1e3*q_(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},jYe=(()=>{const t={};for(const e in VL)for(const r in VL[e].units)t[r]=e;return t})();function HYe(t,e,r){return t*VL[r].units[e].inBaseUnits}function qYe(t,e,r){return t/VL[r].units[e].inBaseUnits}const _3e=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function SZ(t){const e=jYe[t];if(!e)throw new Error("unknown type");return e}function Lde(t,e=null){return e=e||SZ(t),VL[e].baseUnit===t}function Lo(t,e,r){if(e===r)return t;const i=SZ(e);if(i!==SZ(r))throw new Error("incompatible units");const n=Lde(e,i)?t:HYe(t,e,i);return Lde(r,i)?n:qYe(n,r,i)}function hqt(t,e,r){switch(r){case"metric":return WYe(t,e);case"imperial":return XYe(t,e);default:return r}}function dqt(t,e,r){switch(r){case"metric":return YYe(t,e);case"imperial":return ZYe(t,e);default:return r}}function WYe(t,e){const r=Lo(t,e,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function YYe(t,e){const r=Lo(t,e,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function XYe(t,e){const r=Lo(t,e,"feet");return Math.abs(r)<1e3?"feet":"miles"}function ZYe(t,e){const r=Lo(t,e,"feet");return Math.abs(r)<1e5?"feet":"miles"}function pqt(t,e){const r=Lo(t,e,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function fqt(t,e){const r=Lo(t,e,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function JYe(t,e,r){return Lo(t,e,"meters")/(r*Math.PI/180)}function v3e(t){return GYe.fromJSON(t.toLowerCase())||null}function zT(t){if(t!=null&&!kL(t))return 1;const e=fl(t);return e>1e5?1:e}function b3e(t){return fl(t)>=zr(t).metersPerDegree?"meters":mB(t)}function fl(t,e=ni.metersPerDegree){return QYe(t,!0)??e}function QYe(t,e=!1){const r=(t==null?void 0:t.wkid)??null,i=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let n=null;if(r){if(OP(r))return Jf.metersPerDegree;if(MP(r))return o_.metersPerDegree;n=uT.values[uT[r]],!n&&e&&BYe.has(r)&&(n=VYe)}else i&&(S3e(i)?n=Dde(g3e.exec(i),n):x3e(i)&&(n=Dde(y3e.exec(i),n)));return n}function TZ(t){return Nne(t)?1:fl(t)}function Dde(t,e){return t!=null&&t[1]?w3e(t[1]):e}function w3e(t){return parseFloat(t.split(",")[1])}function mB(t){const e=(t==null?void 0:t.wkid)??null,r=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let i=null;if(e)i=uT.units[uT[e]];else if(r){const n=S3e(r)?g3e:x3e(r)?y3e:null;if(n){const s=n.exec(r);s!=null&&s[1]&&(i=tXe(s[1]))}}return i!=null?v3e(i):null}function mqt(t){const e=mB(t);return e!=null&&_3e.includes(e)?e:null}function KYe(t){const e=b3e(t);return e!=null&&_3e.includes(e)?e:null}function x3e(t){return/^GEOCCS/i.test(t)}function S3e(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const eXe=1e-7;function tXe(t){const e=/[\\"']{1}([^\\"']+)/.exec(t);let r=e==null?void 0:e[1];if(!r||!uT.units.includes(r)){const i=w3e(t);r=null;const n=uT.values;for(let s=0;s<n.length;++s)if(Math.abs(i-n[s])<eXe){r=uT.units[s];break}}return r}function gqt(t){const e=mB(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const rXe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},iXe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},nXe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},yqt=tc()(rXe),_qt=tc()(iXe),vqt=tc()(nXe);var Xm;let Ti=Xm=class extends Se{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return Xm.WebMercator;if(t.wkid===4326)return Xm.WGS84}const e=new Xm;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return UL(this)}get isWebMercator(){return UT(this)}get isGeographic(){return Nne(this)}get isWrappable(){return FYe(this)}get metersPerUnit(){return fl(this)}get unit(){return mB(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Xm.WGS84)return new Xm(d3e);if(this===Xm.WebMercator)return new Xm(p3e);const t=new Xm;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(t.wkt=this.wkt),this.wkt2!=null&&(t.wkt2=this.wkt2)),this.imageCoordinateSystem&&(t.imageCoordinateSystem=ae(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:r}=t.imageCoordinateSystem,{geodataXform:i}=t.imageCoordinateSystem,n=this.imageCoordinateSystem;return e==null||i?JSON.stringify(n)===JSON.stringify(t.imageCoordinateSystem):r?n.id===e&&n.referenceServiceName===r:n.id===e}return yo(this,t)}toJSON(t){return this.write(void 0,t)}};Ti.GCS_NAD_1927=null,Ti.WGS84=null,Ti.WebMercator=null,Ti.PlateCarree=null,d([m({readOnly:!0})],Ti.prototype,"isWGS84",null),d([m({readOnly:!0})],Ti.prototype,"isWebMercator",null),d([m({readOnly:!0})],Ti.prototype,"isGeographic",null),d([m({readOnly:!0})],Ti.prototype,"isWrappable",null),d([m({type:Vi,json:{write:!0}})],Ti.prototype,"latestWkid",void 0),d([m({readOnly:!0})],Ti.prototype,"metersPerUnit",null),d([m({readOnly:!0})],Ti.prototype,"unit",null),d([m({type:Vi,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],Ti.prototype,"wkid",void 0),d([m({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],Ti.prototype,"wkt",void 0),d([nt("wkt"),nt("web-scene","wkt")],Ti.prototype,"writeWkt",null),d([m({type:String,json:{write:!1}})],Ti.prototype,"wkt2",void 0),d([m({type:Vi,json:{write:!0}})],Ti.prototype,"vcsWkid",void 0),d([m({type:Vi,json:{write:!0}})],Ti.prototype,"latestVcsWkid",void 0),d([m()],Ti.prototype,"imageCoordinateSystem",void 0),Ti=Xm=d([F("esri.geometry.SpatialReference")],Ti),Ti.prototype.toJSON.isDefaultToJSON=!0,Ti.GCS_NAD_1927=new Ti({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Ti.WGS84=new Ti(d3e),Ti.WebMercator=new Ti(p3e),Ti.PlateCarree=new Ti(kYe),Object.freeze&&(Object.freeze(Ti.GCS_NAD_1927),Object.freeze(Ti.WGS84),Object.freeze(Ti.WebMercator),Object.freeze(Ti.PlateCarree));const Ve=Ti;function Xe(t,e,r){let i,n;return e===void 0||Array.isArray(e)?(n=t,r=e,i=[void 0]):(n=e,i=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;i.forEach(l=>{const c=yne(s,l,n);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let Zm=class extends Se{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ve.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,r){if(e instanceof Ve)return e;if(e!=null){const i=new Ve;return i.read(e,r),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,r){this.cache[e]=r}};d([m()],Zm.prototype,"type",void 0),d([m({readOnly:!0})],Zm.prototype,"cache",null),d([m({readOnly:!0})],Zm.prototype,"extent",null),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Zm.prototype,"hasM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Zm.prototype,"hasZ",void 0),d([m({type:Ve,json:{write:!0},value:Ve.WGS84})],Zm.prototype,"spatialReference",void 0),d([Xe("spatialReference")],Zm.prototype,"readSpatialReference",null),Zm=d([F("esri.geometry.Geometry")],Zm);const w_=Zm,sXe=Object.prototype.toString;function oXe(t){const e="__accessorMetadata__"in t?to(t):t;return function(...r){if(r.push(e),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return aXe.apply(this,r)}}function aXe(t,e,r,i){eN(t,e).cast=i}function lXe(t){return(e,r)=>{eN(e,t).cast=e[r]}}function Dr(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&sXe.call(t[0])==="[object Function]"?oXe(t[0]):t.length===1&&typeof t[0]=="string"?lXe(t[0]):void 0}function cXe(t,e){const r=t.x-e.x,i=t.y-e.y,n=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(r*r+i*i+n*n)}const uXe=57.29577951308232,hXe=.017453292519943;function Nde(t){return t*uXe}function Fde(t){return t*hXe}function kde(t){return t/ni.radius}function fz(t){return Math.PI/2-2*Math.atan(Math.exp(-t/ni.radius))}function EZ(t){return t.wkid!=null||t.wkt!=null}const $j=[0,0];function mz(t,e,r,i,n){const s=t,o=n;if(o.spatialReference=r,"x"in s&&"x"in o)[o.x,o.y]=e(s.x,s.y,$j,i);else if("xmin"in s&&"xmin"in o)[o.xmin,o.ymin]=e(s.xmin,s.ymin,$j,i),[o.xmax,o.ymax]=e(s.xmax,s.ymax,$j,i);else if("paths"in s&&"paths"in o||"rings"in s&&"rings"in o){const a="paths"in s?s.paths:s.rings,l=[];let c;for(let u=0;u<a.length;u++){const h=a[u];c=[],l.push(c);for(let p=0;p<h.length;p++)c.push(e(h[p][0],h[p][1],[0,0],i)),h[p].length>2&&c[p].push(h[p][2]),h[p].length>3&&c[p].push(h[p][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in s&&"points"in o){const a=s.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return n}function n6(t,e){const r=t&&(EZ(t)?t:t.spatialReference),i=e&&(EZ(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!r||!i)&&(!!yo(i,r)||UT(i)&&UL(r)||UT(r)&&UL(i))}function sN(t,e){if(t==null)return null;const r=t.spatialReference,i=e&&(EZ(e)?e:e.spatialReference);return n6(r,i)?yo(r,i)?ae(t):UT(i)?mz(t,JC,Ve.WebMercator,!1,ae(t)):UL(i)?mz(t,hI,Ve.WGS84,!1,ae(t)):null:null}function JC(t,e,r=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const i=Fde(e);return r[0]=Fde(t)*ni.radius,r[1]=ni.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function hI(t,e,r=[0,0],i=!1){const n=Nde(t/ni.radius);return r[0]=i?n:n-360*Math.floor((n+180)/360),r[1]=Nde(Math.PI/2-2*Math.atan(Math.exp(-e/ni.radius))),r}function ib(t,e=!1,r=ae(t)){return mz(t,JC,Ve.WebMercator,e,r)}function QC(t,e=!1,r=ae(t)){return mz(t,hI,Ve.WGS84,e,r)}var s6;const RO=[0,0];function Ude(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let fc=s6=class extends w_{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const r=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,r,i,n){let s;if(Array.isArray(t))s=t,n=e,t=s[0],e=s[1],r=s[2],i=s[3];else if(t&&typeof t=="object"){if(s=t,t=s.x!=null?s.x:s.longitude,e=s.y!=null?s.y:s.latitude,r=s.z,i=s.m,(n=s.spatialReference)&&n.declaredClass!=="esri.geometry.SpatialReference"&&(n=new Ve(n)),s.longitude!=null||s.latitude!=null){if(s.longitude==null)K.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(s.latitude==null)K.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!s.declaredClass&&n&&n.isWebMercator){const a=JC(s.longitude,s.latitude,RO);t=a[0],e=a[1]}}}else Ude(r)?(n=r,r=null):Ude(i)&&(n=i,i=null);const o={x:t,y:e};return o.x==null&&o.y!=null?K.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&K.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),n!=null&&(o.spatialReference=n),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:r}=this;if(t){if(t.isWebMercator)return hI(e,r,RO)[1];if(t.isGeographic)return r}return null}set latitude(t){const{spatialReference:e,x:r}=this;t!=null&&e&&(e.isWebMercator?this._set("y",JC(r,t,RO)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:r}=this;if(r){if(r.isWebMercator)return hI(t,e,RO)[0];if(r.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:r}=this;t!=null&&r&&(r.isWebMercator?this._set("x",JC(t,e,RO)[0]):r.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,r){e[r]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new s6;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return s6.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:r,z:i,m:n,spatialReference:s}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:u}=t;if(!s.equals(u))if(s.isWebMercator&&u.isWGS84)[l,c]=JC(l,c),u=s;else{if(!s.isWGS84||!u.isWebMercator)return!1;[l,c]=hI(l,c),u=s}return e===l&&r===c&&i===o&&n===a&&s.wkid===u.wkid}offset(t,e,r){return this.x+=t,this.y+=e,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const t=Qf(this.spatialReference);if(!t)return this;let e=this.x;const[r,i]=t.valid,n=2*i;let s;return e>i?(s=Math.ceil(Math.abs(e-i)/n),e-=s*n):e<r&&(s=Math.ceil(Math.abs(e-r)/n),e+=s*n),this._set("x",e),this}distance(t){return cXe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],fc.prototype,"cache",null),d([m({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],fc.prototype,"hasM",null),d([m({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],fc.prototype,"hasZ",null),d([m({type:Number})],fc.prototype,"latitude",null),d([m({type:Number})],fc.prototype,"longitude",null),d([m({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Dr(t=>isNaN(t)?t:Ld(t))],fc.prototype,"x",void 0),d([nt("x")],fc.prototype,"writeX",null),d([Xe("x")],fc.prototype,"readX",null),d([m({type:Number,json:{write:!0}})],fc.prototype,"y",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],fc.prototype,"z",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],fc.prototype,"m",void 0),fc=s6=d([F("esri.geometry.Point")],fc),fc.prototype.toJSON.isDefaultToJSON=!0;const He=fc,Ij=[0,0];function Une(t,e){return e!=null&&Ul(t,e.x,e.y,e.z)}function wqt(t,e){if(!e.points||e.points.length)return!1;for(const r of e.points)if(!RP(t,r))return!1;return!0}function dXe(t,e){const{xmin:r,ymin:i,zmin:n,xmax:s,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?Ul(t,r,i,n)&&Ul(t,r,o,n)&&Ul(t,s,o,n)&&Ul(t,s,i,n)&&Ul(t,r,i,a)&&Ul(t,r,o,a)&&Ul(t,s,o,a)&&Ul(t,s,i,a):Ul(t,r,i)&&Ul(t,r,o)&&Ul(t,s,o)&&Ul(t,s,i)}function RP(t,e){return Ul(t,e[0],e[1])}function pXe(t,e){return Ul(t,e[0],e[1],e[2])}function Ul(t,e,r,i){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax&&(i==null||!t.hasZ||i>=t.zmin&&i<=t.zmax)}function fXe(t,e){return Ij[1]=e.y,Ij[0]=e.x,mXe(t,Ij)}function mXe(t,e){return T3e(t.rings,e)}function T3e(t,e){if(!t)return!1;if(gXe(t))return zde(!1,t,e);let r=!1;for(let i=0,n=t.length;i<n;i++)r=zde(r,t[i],e);return r}function gXe(t){return!Array.isArray(t[0][0])}function zde(t,e,r){const[i,n]=r;let s=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=e[a],[h,p]=e[o];(u<n&&p>=n||p<n&&u>=n)&&c+(n-u)/(p-u)*(h-c)<i&&(s=!s)}return s}function yXe(t,e){return Une(t,e)}function _Xe(t,e){const r=t.hasZ&&e.hasZ;let i,n,s;if(t.xmin<=e.xmin){if(i=e.xmin,t.xmax<i)return!1}else if(i=t.xmin,e.xmax<i)return!1;if(t.ymin<=e.ymin){if(n=e.ymin,t.ymax<n)return!1}else if(n=t.ymin,e.ymax<n)return!1;if(r&&e.hasZ){if(t.zmin<=e.zmin){if(s=e.zmin,t.zmax<s)return!1}else if(s=t.zmin,e.zmax<s)return!1}return!0}function vXe(t,e){const{points:r,hasZ:i}=e,n=i?pXe:RP;for(const s of r)if(n(t,s))return!0;return!1}const VT=[0,0],BT=[0,0],GT=[0,0],jT=[0,0],bXe=[VT,BT,GT,jT],E3e=[[GT,VT],[VT,BT],[BT,jT],[jT,GT]];function wXe(t,e){return xXe(t,e.rings)}function xXe(t,e){VT[0]=t.xmin,VT[1]=t.ymax,BT[0]=t.xmax,BT[1]=t.ymax,GT[0]=t.xmin,GT[1]=t.ymin,jT[0]=t.xmax,jT[1]=t.ymin;for(const r of bXe)if(T3e(e,r))return!0;for(const r of e){if(!r.length)continue;let i=r[0];if(RP(t,i))return!0;for(let n=1;n<r.length;n++){const s=r[n];if(RP(t,s)||C3e(i,s,E3e))return!0;i=s}}return!1}function SXe(t,e){VT[0]=t.xmin,VT[1]=t.ymax,BT[0]=t.xmax,BT[1]=t.ymax,GT[0]=t.xmin,GT[1]=t.ymin,jT[0]=t.xmax,jT[1]=t.ymin;const r=e.paths;for(const i of r){if(!r.length)continue;let n=i[0];if(RP(t,n))return!0;for(let s=1;s<i.length;s++){const o=i[s];if(RP(t,o)||C3e(n,o,E3e))return!0;n=o}}return!1}const ba=[0,0];function TXe(t){for(let e=0;e<t.length;e++){const r=t[e];for(let n=0;n<r.length-1;n++){const s=r[n],o=r[n+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],u=t[a][l+1];if(gz(s,o,c,u,ba)&&!(ba[0]===s[0]&&ba[1]===s[1]||ba[0]===c[0]&&ba[1]===c[1]||ba[0]===o[0]&&ba[1]===o[1]||ba[0]===u[0]&&ba[1]===u[1]))return!0}}const i=r.length;if(!(i<=4))for(let n=0;n<i-3;n++){let s=i-1;n===0&&(s=i-2);const o=r[n],a=r[n+1];for(let l=n+2;l<s;l++){const c=r[l],u=r[l+1];if(gz(o,a,c,u,ba)&&!(ba[0]===o[0]&&ba[1]===o[1]||ba[0]===c[0]&&ba[1]===c[1]||ba[0]===a[0]&&ba[1]===a[1]||ba[0]===u[0]&&ba[1]===u[1]))return!0}}}return!1}function C3e(t,e,r){for(let i=0;i<r.length;i++)if(gz(t,e,r[i][0],r[i][1]))return!0;return!1}function gz(t,e,r,i,n){const[s,o]=t,[a,l]=e,[c,u]=r,[h,p]=i,f=h-c,g=s-c,y=a-s,v=p-u,b=o-u,w=l-o,x=v*y-f*w;if(x===0)return!1;const S=(f*b-v*g)/x,E=(y*b-w*g)/x;return S>=0&&S<=1&&E>=0&&E<=1&&(n&&(n[0]=s+S*(a-s),n[1]=o+S*(l-o)),!0)}function EXe(t){switch(t){case"esriGeometryEnvelope":case"extent":return _Xe;case"esriGeometryMultipoint":case"multipoint":return vXe;case"esriGeometryPoint":case"point":return yXe;case"esriGeometryPolygon":case"polygon":return wXe;case"esriGeometryPolyline":case"polyline":return SXe}}var ld;function CXe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function W_(t,e,r){return e==null?r:r==null?e:t(e,r)}let Zo=ld=class extends w_{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,r,i,n){return CXe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?Ve.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:r,ymax:i,spatialReference:n??Ve.WGS84}}static fromBounds(t,e){return new ld({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new ld({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new He({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new ld;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&n6(e,r)&&(t=e.isWebMercator?ib(t):QC(t,!0)),t.type==="point"?Une(this,t):t.type==="extent"&&dXe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&n6(e,r)&&(t=e.isWebMercator?ib(t):QC(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),r=this.width*e,i=this.height*e;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const n=(this.zmax-this.zmin)*e;this.zmin+=n,this.zmax-=n}if(this.hasM){const n=(this.mmax-this.mmin)*e;this.mmin+=n,this.mmax-=n}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,r=t.spatialReference;return e&&r&&!yo(e,r)&&n6(e,r)&&(t=e.isWebMercator?ib(t):QC(t,!0)),EXe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,r){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=W_(Math.min,this.zmin,t.zmin),this.zmax=W_(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=W_(Math.min,this.mmin,t.mmin),this.mmax=W_(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=W_(Math.max,this.zmin,t.zmin),this.zmax=W_(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=W_(Math.max,this.mmin,t.mmin),this.mmax=W_(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=Qf(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,r=this._getCM(t);if(r){const i=e.isWebMercator?QC(r):r;this.xmin-=r.x,this.xmax-=r.x,e.isWebMercator||(i.x=this._normalizeX(i.x,t).x),this.spatialReference=new Ve(une((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(t){let e=null;const[r,i]=t.valid,n=this.xmin,s=this.xmax;return n>=r&&n<=i&&s>=r&&s<=i||(e=this.center),e}_normalize(t,e,r){const i=this.spatialReference;if(!i)return this;const n=r??Qf(i);if(n==null)return this;const s=this._getParts(n).map(l=>l.extent);if(s.length<2)return s[0]||this;if(s.length>2)return t?this._shiftCM(n):this.set({xmin:n.valid[0],xmax:n.valid[1]});if(t)return this._shiftCM(n);if(e)return s;let o=!0,a=!0;return s.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:s.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let h=0;h<c.length;h++)c[h].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let h=0;h<c.length;h++)c[h].push(u)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:n,ymax:s,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;t=t||Qf(o);const[h,p]=t.valid;u=this._normalizeX(this.xmin,t);const f=u.x,g=u.frameId;u=this._normalizeX(this.xmax,t);const y=u.x,v=u.frameId,b=f===y&&a>0;if(a>2*p){const w=new ld(l<c?f:y,n,p,s,o),x=new ld(h,n,l<c?y:f,s,o),S=new ld(0,n,p,s,o),E=new ld(h,n,0,s,o),P=[],M=[];w.contains(S)&&P.push(g),w.contains(E)&&M.push(g),x.contains(S)&&P.push(v),x.contains(E)&&M.push(v);for(let L=g+1;L<v;L++)P.push(L),M.push(L);e.push({extent:w,frameIds:[g]},{extent:x,frameIds:[v]},{extent:S,frameIds:P},{extent:E,frameIds:M})}else f>y||b?e.push({extent:new ld(f,n,p,s,o),frameIds:[g]},{extent:new ld(h,n,y,s,o),frameIds:[v]}):e.push({extent:new ld(f,n,y,s,o),frameIds:[g]});this.cache._parts=e}const r=this.hasZ,i=this.hasM;if(r||i){const n={};r&&(n.zmin=this.zmin,n.zmax=this.zmax),i&&(n.mmin=this.mmin,n.mmax=this.mmax);for(let s=0;s<e.length;s++)e[s].extent.set(n)}return e}_normalizeX(t,e){const[r,i]=e.valid,n=2*i;let s,o=0;return t>i?(s=Math.ceil(Math.abs(t-i)/n),t-=s*n,o=s):t<r&&(s=Math.ceil(Math.abs(t-r)/n),t+=s*n,o=-s),{x:t,frameId:o}}};d([m({readOnly:!0})],Zo.prototype,"cache",null),d([m({readOnly:!0})],Zo.prototype,"center",null),d([m({readOnly:!0})],Zo.prototype,"extent",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Zo.prototype,"hasM",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Zo.prototype,"hasZ",null),d([m({readOnly:!0})],Zo.prototype,"height",null),d([m({readOnly:!0})],Zo.prototype,"width",null),d([m({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Zo.prototype,"xmin",void 0),d([m({type:Number,json:{write:!0}})],Zo.prototype,"ymin",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Zo.prototype,"mmin",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Zo.prototype,"zmin",void 0),d([m({type:Number,json:{write:!0}})],Zo.prototype,"xmax",void 0),d([m({type:Number,json:{write:!0}})],Zo.prototype,"ymax",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Zo.prototype,"mmax",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Zo.prototype,"zmax",void 0),Zo=ld=d([F("esri.geometry.Extent")],Zo),Zo.prototype.toJSON.isDefaultToJSON=!0;const br=Zo;let dI;var aTe,lTe;const PXe=((aTe=globalThis.esriConfig)==null?void 0:aTe.locale)??((lTe=globalThis.dojoConfig)==null?void 0:lTe.locale);function P3e(){var t;return PXe??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function Nh(){return dI===void 0&&(dI=P3e()),dI}function AXe(t=Nh()){const e=/^([a-zA-Z]{2,3})(?:[_\-]\w+)*$/.exec(t);return e==null?void 0:e[1].toLowerCase()}const pI=[];function zne(t){return pI.push(t),ri(()=>pI.splice(pI.indexOf(t),1))}const CZ=[];function Vne(t){return CZ.push(t),ri(()=>pI.splice(CZ.indexOf(t),1))}function OXe(){const t=P3e();dI!==t&&(dI=t,[...CZ].forEach(e=>{e.call(null,t)}),[...pI].forEach(e=>{e.call(null,t)}))}var cTe;(cTe=globalThis.addEventListener)==null||cTe.call(globalThis,"languagechange",OXe);let I4;function MXe(t){return I4&&!I4.destroyed||(I4=t()),I4}var PZ;const RXe=new Ii({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let cd=PZ=class extends Pe{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new PZ({categories:this.categories?ae(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=sN(this.extent,Ve.WGS84);o!=null&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let n=this.query;!this.disableExtraQuery&&t.extraQuery&&(n="("+n+")"+t.extraQuery);const s={categories:r,bbox:i,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map(o=>RXe.toJSON(o.trim())).join(","),s.sortOrder=this.sortOrder),{query:{...e,...s}}}};d([m()],cd.prototype,"categories",void 0),d([m()],cd.prototype,"disableExtraQuery",void 0),d([m({type:br})],cd.prototype,"extent",void 0),d([m()],cd.prototype,"filter",void 0),d([m()],cd.prototype,"num",void 0),d([m()],cd.prototype,"query",void 0),d([m()],cd.prototype,"sortField",void 0),d([m()],cd.prototype,"sortOrder",null),d([m()],cd.prototype,"start",void 0),cd=PZ=d([F("esri.portal.PortalQueryParams")],cd);const Pg=cd;var AZ;let Eo=AZ=class extends Se{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){var r;const t=this.url,e=this.thumbnail;return t&&e&&this.portal?(r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const r=e.categorySchema||[];return r.some(i=>i.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):r})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new B("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new AZ;return e.sourceJSON=t,e.read(t),e}queryItems(t,e){let r=to(Pg,t);const i=this.portal;return parseFloat(i.currentVersion)>5?(r=r||new Pg,i.queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",e)):(r=r?r.clone():new Pg,r.query="group:"+this.id+(r.query?" "+r.query:""),i.queryItems(r,e))}_fetchCategorySchemaSet(t,e){const r=this.portal;return r.fetchSelf(r.authMode,!0,e).then(i=>{const n=i.contentCategorySetsGroupQuery;if(n){const s=new Pg;return s.disableExtraQuery=!0,s.num=1,s.query=n,r.queryGroups(s,e)}throw new B("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const n=i.results[0],s=new Pg;return s.num=1,s.query=`typekeywords:"${t}"`,n.queryItems(s,e)}throw new B("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",e).then(n=>{const s=n==null?void 0:n.categorySchema;return s!=null&&s.length?s:[]}):[])}};d([m()],Eo.prototype,"access",void 0),d([m({type:Date})],Eo.prototype,"created",void 0),d([m()],Eo.prototype,"description",void 0),d([m()],Eo.prototype,"id",void 0),d([m()],Eo.prototype,"isInvitationOnly",void 0),d([m({type:Date})],Eo.prototype,"modified",void 0),d([m()],Eo.prototype,"owner",void 0),d([m()],Eo.prototype,"portal",void 0),d([m()],Eo.prototype,"snippet",void 0),d([m()],Eo.prototype,"sortField",void 0),d([m()],Eo.prototype,"sortOrder",void 0),d([m()],Eo.prototype,"sourceJSON",void 0),d([m()],Eo.prototype,"tags",void 0),d([m()],Eo.prototype,"thumbnail",void 0),d([m({readOnly:!0})],Eo.prototype,"thumbnailUrl",null),d([m()],Eo.prototype,"title",void 0),d([m({readOnly:!0})],Eo.prototype,"url",null),Eo=AZ=d([F("esri.portal.PortalGroup")],Eo);const OZ=Eo;let yx=class extends Pe{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};d([m()],yx.prototype,"nextQueryParams",void 0),d([m()],yx.prototype,"queryParams",void 0),d([m()],yx.prototype,"results",void 0),d([m()],yx.prototype,"total",void 0),yx=d([F("esri.portal.PortalQueryResult")],yx);const $Xe=yx;let Xy=class extends Se{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){var r;const e=(r=this.portal)==null?void 0:r.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new B("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};d([m({type:Date})],Xy.prototype,"created",void 0),d([m()],Xy.prototype,"id",void 0),d([m()],Xy.prototype,"portal",void 0),d([m()],Xy.prototype,"title",void 0),d([m({readOnly:!0})],Xy.prototype,"url",null),d([m()],Xy.prototype,"username",void 0),Xy=d([F("esri.portal.PortalFolder")],Xy);const IXe=Xy;var MZ;let Un=MZ=class extends Se{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t==null?void 0:t.data,i=t==null?void 0:t.folder,n={method:"post"};e&&(n.query=e.createPostQuery(),r!=null&&(typeof r=="string"?n.query.text=r:typeof r=="object"&&(n.query.text=JSON.stringify(r))));let s=this.userContentUrl;return i&&(s+="/"+(typeof i=="string"?i:i.id)),this.portal.request(s+"/addItem",n).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(e,i).then(()=>{t.forEach(n=>{n.id=null,n.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let r;return r=e&&e.folders?e.folders.map(i=>{const n=IXe.fromJSON(i);return n.portal=this.portal,n}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(r=>{const i=OZ.fromJSON(r);return i.portal=this.portal,i}):[],e})}fetchItems(t){const e=t??{};let r,i=this.userContentUrl??"";return e.folder&&(i+="/"+e.folder.id),re(()=>Promise.resolve().then(()=>$3e),void 0).then(({default:n})=>{r=n;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(i,{query:s})}).then(n=>{let s;return n!=null&&n.items?(s=n.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(s.map(o=>o.load())).catch(o=>o).then(()=>({items:s,nextStart:n.nextStart,total:n.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new OZ({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new B("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new B("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new MZ;return e.sourceJSON=t,e.read(t),e}};d([m()],Un.prototype,"access",void 0),d([m({type:Date})],Un.prototype,"created",void 0),d([m()],Un.prototype,"culture",void 0),d([m()],Un.prototype,"description",void 0),d([m()],Un.prototype,"email",void 0),d([m()],Un.prototype,"favGroupId",void 0),d([m()],Un.prototype,"fullName",void 0),d([m({type:Date})],Un.prototype,"modified",void 0),d([m()],Un.prototype,"orgId",void 0),d([m()],Un.prototype,"portal",void 0),d([m()],Un.prototype,"preferredView",void 0),d([m()],Un.prototype,"privileges",void 0),d([m()],Un.prototype,"region",void 0),d([m()],Un.prototype,"role",void 0),d([m()],Un.prototype,"roleId",void 0),d([m()],Un.prototype,"sourceJSON",void 0),d([m()],Un.prototype,"thumbnail",void 0),d([m({readOnly:!0})],Un.prototype,"thumbnailUrl",null),d([m()],Un.prototype,"units",void 0),d([m({readOnly:!0})],Un.prototype,"userContentUrl",null),d([m({readOnly:!0})],Un.prototype,"url",null),d([m()],Un.prototype,"username",void 0),d([m()],Un.prototype,"userType",void 0),Un=MZ=d([F("esri.portal.PortalUser")],Un);const Bne=Un;var ah;let L4;const Vde={PortalGroup:()=>Promise.resolve({default:OZ}),PortalItem:()=>re(()=>Promise.resolve().then(()=>$3e),void 0),PortalUser:()=>Promise.resolve({default:Bne})};let Ue=ah=class extends kA(ay){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=ai.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){Bde.unregister(this),this.defaultBasemap=Me(this.defaultBasemap),this.defaultDevBasemap=Me(this.defaultDevBasemap),this.defaultVectorBasemap=Me(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Pi(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)ai.request.trustedServers.includes(e)||ai.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){var r;const t=(r=this.user)==null?void 0:r.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=Bne.fromJSON(t),e.portal=this),e}load(t){const e=re(()=>Promise.resolve().then(()=>hZe),void 0).then(({default:r})=>{dt(t),L4=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(r=>{var i;if(vr){const n=vr;this.credential=n.findCredential(this.restUrl),this.credential||this.authMode!==ah.AUTH_MODE_AUTO&&this.authMode!==ah.AUTH_MODE_NO_PROMPT||((i=this._esriIdCredentialCreateHandle)==null||i.remove(),this._esriIdCredentialCreateHandle=n.on("credential-create",LXe(new WeakRef(this))),Bde.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await re(()=>import("./ElevationLayer-CTwEgTNI.js"),__vite__mapDeps([]))).default;return t?t.map(r=>new e({id:r.id,url:r.url})):[]}async fetchBasemaps(t,e){const r=await this._fetchBasemaps(t,e);if((e==null?void 0:e.include3d)===!0&&this.use3dBasemaps!==!1){const i=await this._fetchBasemaps3D(t,e);r.unshift(...i)}return r}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):Ms(t)?Promise.reject(gr()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,r=new Pg;if(r.num=100,r.sortField="title",e&&e.length){const i=[];for(const n of e)i.push(`(title:"${n.title}" AND owner:${n.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,t).then(n=>n.results)}return Ms(t)?Promise.reject(gr()):Promise.resolve([])}fetchRegions(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||Nh();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||Nh();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return MXe(()=>new ah)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,r){const i=this.restUrl+"/portals/self",n={authMode:t,query:{culture:Nh().toLowerCase()},withCredentials:!0,...r};return n.authMode==="auto"&&(n.authMode="no-prompt"),e&&(n.query.default=!0),this.request(i,n)}queryPortal(t,e,r,i){const n=to(Pg,e),s=o=>this.request(this.restUrl+t,{...n.toRequestOptions(this),...i}).then(a=>{const l=n.clone();return l.start=a.nextStart,new $Xe({nextQueryParams:l,queryParams:n,total:a.total,results:ah._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(ko(l),a)));return r&&Vde[r]?Vde[r]().then(({default:o})=>(dt(i),s(o))):s()}signIn(){if(this.authMode===ah.AUTH_MODE_ANONYMOUS||this.authMode===ah.AUTH_MODE_NO_PROMPT&&!vr)return Promise.reject(new B("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return vr?vr.getCredential(this.restUrl,{prompt:this.authMode!==ah.AUTH_MODE_NO_PROMPT}).then(e=>t(e)):t(this.credential)}normalizeUrl(t){var r;const e=(r=this.credential)==null?void 0:r.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,r){return this.request(t,e).then(i=>{const n=ah._resultsToTypedArray(r,{portal:this},i);return Promise.all(n.map(s=>typeof s.when=="function"?s.when():i)).then(()=>n,()=>n)})}request(t,e={}){const r={f:"json",...e.query},{authMode:i=this.authMode===ah.AUTH_MODE_ANONYMOUS||this.authMode===ah.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:n=null,cacheBust:s=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:i,body:n,cacheBust:s,method:o,query:r,responseType:a,timeout:0,signal:l};return e.withCredentials&&(c.withCredentials=!0),Vt(this._normalizeSSL(t),c).then(u=>u.data)}toJSON(){throw new B("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new ah({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new B("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const r=new Pg;r.query=t||(ai.apiKey&&Rne(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const i=await this.queryGroups(r,e);if(!i.total)return[];const n=i.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc";const s=await n.queryItems(r,e);return s.total?s.results.filter(o=>o.type==="Web Map").map(o=>new L4({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const r=t||this.basemapGalleryGroupQuery3D;if(!r)return[];const i=new Pg({query:r,disableExtraQuery:!0}),n=await this.queryGroups(i,e);if(!n.total)return[];const s=n.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc";const o=await s.queryItems(i,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new L4({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=L4.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,r,i){let n=[];if(r){const s=i!=null?i.signal:null;n=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(t||e)&&(n=n.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(s),a}))}else n=[];return n}};Ue.AUTH_MODE_ANONYMOUS="anonymous",Ue.AUTH_MODE_AUTO="auto",Ue.AUTH_MODE_IMMEDIATE="immediate",Ue.AUTH_MODE_NO_PROMPT="no-prompt",d([m()],Ue.prototype,"access",void 0),d([m()],Ue.prototype,"allSSL",void 0),d([m()],Ue.prototype,"authMode",void 0),d([m()],Ue.prototype,"authorizedCrossOriginDomains",void 0),d([Xe("authorizedCrossOriginDomains")],Ue.prototype,"readAuthorizedCrossOriginDomains",null),d([m()],Ue.prototype,"basemapGalleryGroupQuery",void 0),d([m({json:{name:"3DBasemapGalleryGroupQuery"}})],Ue.prototype,"basemapGalleryGroupQuery3D",void 0),d([m()],Ue.prototype,"bingKey",void 0),d([m()],Ue.prototype,"canListApps",void 0),d([m()],Ue.prototype,"canListData",void 0),d([m()],Ue.prototype,"canListPreProvisionedItems",void 0),d([m()],Ue.prototype,"canProvisionDirectPurchase",void 0),d([m()],Ue.prototype,"canSearchPublic",void 0),d([m()],Ue.prototype,"canShareBingPublic",void 0),d([m()],Ue.prototype,"canSharePublic",void 0),d([m()],Ue.prototype,"canSignInArcGIS",void 0),d([m()],Ue.prototype,"canSignInIDP",void 0),d([m()],Ue.prototype,"colorSetsGroupQuery",void 0),d([m()],Ue.prototype,"commentsEnabled",void 0),d([m({type:Date})],Ue.prototype,"created",void 0),d([m()],Ue.prototype,"credential",void 0),d([m()],Ue.prototype,"culture",void 0),d([m()],Ue.prototype,"currentVersion",void 0),d([m()],Ue.prototype,"customBaseUrl",void 0),d([m()],Ue.prototype,"defaultBasemap",void 0),d([Xe("defaultBasemap")],Ue.prototype,"readDefaultBasemap",null),d([m()],Ue.prototype,"defaultDevBasemap",void 0),d([Xe("defaultDevBasemap")],Ue.prototype,"readDefaultDevBasemap",null),d([m({type:br})],Ue.prototype,"defaultExtent",void 0),d([m()],Ue.prototype,"defaultVectorBasemap",void 0),d([Xe("defaultVectorBasemap")],Ue.prototype,"readDefaultVectorBasemap",null),d([m()],Ue.prototype,"description",void 0),d([m()],Ue.prototype,"devBasemapGalleryGroupQuery",void 0),d([m()],Ue.prototype,"eueiEnabled",void 0),d([m({readOnly:!0})],Ue.prototype,"extraQuery",null),d([m()],Ue.prototype,"featuredGroups",void 0),d([m()],Ue.prototype,"featuredItemsGroupQuery",void 0),d([m()],Ue.prototype,"galleryTemplatesGroupQuery",void 0),d([m()],Ue.prototype,"layoutGroupQuery",void 0),d([m()],Ue.prototype,"livingAtlasGroupQuery",void 0),d([m()],Ue.prototype,"hasCategorySchema",void 0),d([m()],Ue.prototype,"helpBase",void 0),d([m()],Ue.prototype,"helperServices",void 0),d([m()],Ue.prototype,"helpMap",void 0),d([m()],Ue.prototype,"homePageFeaturedContent",void 0),d([m()],Ue.prototype,"homePageFeaturedContentCount",void 0),d([m()],Ue.prototype,"httpPort",void 0),d([m()],Ue.prototype,"httpsPort",void 0),d([m()],Ue.prototype,"id",void 0),d([m()],Ue.prototype,"ipCntryCode",void 0),d([m({readOnly:!0})],Ue.prototype,"isOrganization",null),d([m()],Ue.prototype,"isPortal",void 0),d([m()],Ue.prototype,"isReadOnly",void 0),d([m({readOnly:!0})],Ue.prototype,"itemPageUrl",null),d([m()],Ue.prototype,"layerTemplatesGroupQuery",void 0),d([m()],Ue.prototype,"maxTokenExpirationMinutes",void 0),d([m({type:Date})],Ue.prototype,"modified",void 0),d([m()],Ue.prototype,"name",void 0),d([m()],Ue.prototype,"portalHostname",void 0),d([m()],Ue.prototype,"portalMode",void 0),d([m()],Ue.prototype,"portalProperties",void 0),d([m()],Ue.prototype,"region",void 0),d([m({readOnly:!0})],Ue.prototype,"restUrl",null),d([m()],Ue.prototype,"rotatorPanels",void 0),d([m()],Ue.prototype,"showHomePageDescription",void 0),d([m()],Ue.prototype,"sourceJSON",void 0),d([m()],Ue.prototype,"staticImagesUrl",void 0),d([m({json:{name:"2DStylesGroupQuery"}})],Ue.prototype,"stylesGroupQuery2d",void 0),d([m({json:{name:"stylesGroupQuery"}})],Ue.prototype,"stylesGroupQuery3d",void 0),d([m()],Ue.prototype,"supportsHostedServices",void 0),d([m()],Ue.prototype,"symbolSetsGroupQuery",void 0),d([m()],Ue.prototype,"templatesGroupQuery",void 0),d([m()],Ue.prototype,"thumbnail",void 0),d([m({readOnly:!0})],Ue.prototype,"thumbnailUrl",null),d([m()],Ue.prototype,"units",void 0),d([m()],Ue.prototype,"url",void 0),d([m()],Ue.prototype,"urlKey",void 0),d([Xe("urlKey")],Ue.prototype,"readUrlKey",null),d([m()],Ue.prototype,"user",void 0),d([Xe("user")],Ue.prototype,"readUser",null),d([m()],Ue.prototype,"use3dBasemaps",void 0),d([m()],Ue.prototype,"useStandardizedQuery",void 0),d([m()],Ue.prototype,"useVectorBasemaps",void 0),d([m()],Ue.prototype,"vectorBasemapGalleryGroupQuery",void 0),Ue=ah=d([F("esri.portal.Portal")],Ue);const Ho=Ue,Bde=new FinalizationRegistry(t=>{t.remove()});function LXe(t){const e=vr;return()=>{const r=t.deref();r&&e.findCredential(r.restUrl)&&r.signIn().catch(()=>{})}}let Zy=class extends Pe{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e!=null&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&Fu(e)?K.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",r){const i=this.cdnUrl;if(i==null)throw new B("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:r==null?void 0:r.signal})}async update(e,r){const{addOrUpdateResources:i}=await re(()=>Promise.resolve().then(()=>P3),void 0);return await i(this.portalItem,[{resource:this,content:e,compress:r==null?void 0:r.compress,access:r==null?void 0:r.access}],"update",r),this}hasPath(){return this.path!=null}_normalizePath(e,r){return e==null?e:(e=e.replace(/^\/+/,""),r!=null&&Fu(e)&&(e=cB(e,r.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};d([m()],Zy.prototype,"portalItem",void 0),d([m({type:String,value:null})],Zy.prototype,"path",null),d([Dr("path")],Zy.prototype,"_castPath",null),d([m({type:String,readOnly:!0})],Zy.prototype,"url",null),d([m({type:String,readOnly:!0})],Zy.prototype,"cdnUrl",null),d([m({type:String,readOnly:!0})],Zy.prototype,"itemRelativeUrl",null),Zy=d([F("esri.portal.PortalItemResource")],Zy);const DXe=Zy;let YM=class extends Pe{constructor(e){super(e),this.created=null,this.rating=null}};d([m()],YM.prototype,"created",void 0),d([m()],YM.prototype,"rating",void 0),YM=d([F("esri.portal.PortalRating")],YM);const Lj=YM;function a_(t,e){var i;const r=(i=e==null?void 0:e.url)==null?void 0:i.path;if(t&&r&&(t=Tu(t,r,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const n=cB(t,e.portalItem.itemUrl);n!=null&&NXe.test(n)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(n).path)}return(t=RZ(t,e==null?void 0:e.portal))&&yB.test(t)?Gne(t):t}function l_(t,e,r=$P.YES){var n,s;if((t=t&&yB.test(t)?R3e(t):t)==null)return t;!Fu(t)&&(e!=null&&e.blockedRelativeUrls)&&e.blockedRelativeUrls.push(t);let i=Tu(t);if(e){const o=((n=e.verifyItemRelativeUrls)==null?void 0:n.rootPath)||((s=e.url)==null?void 0:s.path);if(o){const a=RZ(o,e.portal),l=RZ(i,e.portal);i=cB(l,a,a),i!=null&&i!==l&&i!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=M3e(i,e==null?void 0:e.portal),Fu(i)&&(i=Xf(i)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!Fu(i)&&!yy(i)&&r===$P.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),i}function gB(t,e,r){return a_(t,r)}function xb(t,e,r,i){const n=l_(t,i);n!==void 0&&(e[r]=n)}const yB=/\/items\/([^\/]+)\/resources\/(.*)/,NXe=/^\.\/resources\//;function A3e(t){const e=(t==null?void 0:t.match(yB))??null;return(e==null?void 0:e[1])??null}function O3e(t){const e=(t==null?void 0:t.match(yB))??null;if(e==null)return null;const r=e[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=Pde(r);return{prefix:null,filename:o,extension:a}}const{path:n,extension:s}=Pde(r.slice(i+1));return{prefix:r.slice(0,i),filename:n,extension:s}}function M3e(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?pZ(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function RZ(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const r=`${e.urlKey}.${e.customBaseUrl}`,i=xne();return CP(i,`${i.scheme}://${r}`)?pZ(t,e.portalHostname,r):pZ(t,r,e.portalHostname)}function Gne(t){if(!t)return t||null;let e=t;return e&&vr&&!vr.findCredential(e)&&(e=vr._normalizeAGOLorgDomain(e),e=e.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),e=e.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),e=e.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),e}function R3e(t){if(!t)return t||null;let e=t;return e=e.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),e=e.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),e=e.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),e&&vr&&!vr.findCredential(e)&&(e=vr._normalizeAGOLorgDomain(e)),e}var $P;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})($P||($P={}));const FXe=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return $P},ensureMainOnlineDomain:M3e,fromCDNUrl:R3e,fromJSON:a_,itemIdFromResourceUrl:A3e,prefixAndFilenameFromResourceUrl:O3e,read:gB,toCDNUrl:Gne,toJSON:l_,write:xb},Symbol.toStringTag,{value:"Module"}));var _x;const kXe=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),UXe=new Set(["KML","GeoJson","CSV"]);let fr=_x=class extends kA(ay){static from(t){return s_(_x,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let r=t;return t==="Feature Service"||t==="Feature Collection"?r=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?r=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?r="Scene Layer":t==="Video Service"?r="Video Layer":t==="Scene Package"?r="Scene Layer Package":t==="Stream Service"?r="Feature Layer":t==="Geoprocessing Service"?r=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geoenrichment Service"?r="GeoEnrichment Service":t==="Geocoding Service"?r="Locator":t==="Microsoft Powerpoint"?r="Microsoft PowerPoint":t==="GeoJson"?r="GeoJSON":t==="Globe Service"?r="Globe Layer":t==="Vector Tile Service"?r="Tile Layer":t==="netCDF"?r="NetCDF":t==="Map Service"?r=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?r=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?r="Big Data File Share":t==="Compact Tile Package"?r="Tile Package (tpkx)":t==="Raster function template"?r="Raster Function Template":t==="OGCFeatureServer"?r="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?r="Instant App":t==="Insights Page"?r="Insights Report":t==="Excalibur Imagery Project"?r="Excalibur Project":t==="3DTiles Service"?r="3D tiles layer":t==="3DTiles Package"&&(r="3D tiles package"),r}readExtent(t){return t&&t.length?new br(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){var f;const t=((f=this.type)==null?void 0:f.toLowerCase())||"",e=this.typeKeywords||[],r="esri/images/portal/",i="16";let n,s=!1,o=!1,a=!1,l=!1,c=!1,u=!1,h=!1,p=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(s=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),u=e.includes("UtilityNetwork"),n=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":u?"utilitynetwork":s?"featureshosted":"features"):t==="map service"||t==="wms"||t==="wmts"?(c=e.includes("Spatiotemporal"),h=e.includes("Relational"),n=c||h?"mapimages":s||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages"):n=t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?e.includes("3DObject")?"3dobjecttileslayer":e.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?n="maps":t==="web scene"?n=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?n="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?n="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?n="mapsgray":t==="service definition"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?n="datafiles":t==="360 vr experience"?n="360vr":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?n="appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?n="addindesktop":t==="pdf"?n="pdf":t==="microsoft word"?n="word":t==="microsoft excel"?n="excel":t==="microsoft powerpoint"?n="ppt":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?n="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?n="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?n="layersgray":t==="scene package"?n="scenepackage":t==="3dtiles package"?n="3dtileslayerpackage":t==="3dtiles service"?n="3dtileslayer":t==="mobile scene package"?n="mobilescenepackage":t==="tile package"||t==="compact tile package"?n="tilepackage":t==="task file"?n="taskfile":t==="report template"?n="report-template":t==="statistical data collection"?n="statisticaldatacollection":t==="insights workbook"?n="workbook":t==="insights model"?n="insightsmodel":t==="insights page"?n="insightspage":t==="insights theme"?n="insightstheme":t==="hub initiative"?n="hubinitiative":t==="hub page"?n="hubpage":t==="hub site application"?n="hubsite":t==="hub event"?n="hubevent":t==="hub project"?n="hubproject":t==="relational database connection"?n="relationaldatabaseconnection":t==="big data file share"?n="datastorecollection":t==="image collection"?n="imagecollection":t==="desktop style"?n="desktopstyle":t==="style"?n="style":t==="dashboard"?n="dashboard":t==="raster function template"?n="rasterprocessingtemplate":t==="vector tile package"?n="vectortilepackage":t==="ortho mapping project"?n="orthomappingproject":t==="ortho mapping template"?n="orthomappingtemplate":t==="solution"?n="solutions":t==="geopackage"?n="geopackage":t==="deep learning package"?n="deeplearningpackage":t==="real time analytic"?n="realtimeanalytics":t==="big data analytic"?n="bigdataanalytics":t==="feed"?n="feed":t==="excalibur imagery project"?n="excaliburimageryproject":t==="notebook"?n="notebook":t==="storymap"?n="storymap":t==="survey123 add in"?n="survey123addin":t==="mission"?n="mission":t==="mission report"?n="missionreport":t==="mission template"?n="missiontemplate":t==="quickcapture project"?n="quickcaptureproject":t==="pro report"?n="proreport":t==="pro report template"?n="proreporttemplate":t==="urban model"?n="urbanmodel":t==="web experience"?n="experiencebuilder":t==="web experience template"?n="webexperiencetemplate":t==="experience builder widget"?n="experiencebuilderwidget":t==="experience builder widget package"?n="experiencebuilderwidgetpackage":t==="workflow"?n="workflow":t==="kernel gateway connection"?n="kernelgatewayconnection":t==="insights script"?n="insightsscript":t==="hub initiative template"?n="hubinitiativetemplate":t==="storymap theme"?n="storymaptheme":t==="knowledge graph"?n="knowledgegraph":t==="knowledge studio project"?n="knowledgestudio":t==="native application"?n="nativeapp":t==="native application installer"?n="nativeappinstaller":t==="web link chart"?n="linkchart":t==="knowledge graph web investigation"?n="investigation":t==="ogcfeatureserver"?n="features":t==="pro project"?n="proproject":t==="insights workbook package"?n="insightsworkbookpackage":t==="apache parquet"?n="apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?n="notebookcodesnippets":t==="suitability model"?n="suitabilitymodel":t==="esri classifier definition"?n="classifierdefinition":t==="esri classification schema"?n="classificationschema":t==="insights data engineering workbook"?n="dataengineeringworkbook":t==="insights data engineering model"?n="dataengineeringmodel":t==="deep learning studio project"?n="deeplearningproject":t==="discussion"?n="discussion":t==="allsource project"?n="allsourceproject":t==="api key"?n="apikey":t==="data pipeline"?n="datapipelines":t==="group layer"?(p=e.includes("Map"),n=p?"layergroup2d":"layergroup"):n=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":t==="csv"?"csv":t==="image"?"image":"maps",n?di(r+n+i+".png"):null}get isLayer(){return this.type!=null&&kXe.has(this.type)}get itemCdnUrl(){return Gne(this.itemUrl)}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var r;const t=this.itemUrl,e=this.thumbnail;return t&&e?((r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){var r,i,n;const t=(r=this.portal)==null?void 0:r.restUrl;if(!t)return null;const e=this.owner||((n=(i=this.portal)==null?void 0:i.user)==null?void 0:n.username);return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=Ho.getDefault()),r=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof Lj&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new Lj({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:ae(this.applicationProxies),avgRating:this.avgRating,categories:ae(this.categories),created:ae(this.created),culture:this.culture,description:this.description,extent:ae(this.extent),groupCategories:ae(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ae(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ae(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ae(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ae(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new _x({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){var r;const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=(r=t[i])==null?void 0:r.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new Lj(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},_x)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t==null?void 0:t.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?r.query.text=e:typeof e=="object"&&(r.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new B("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new B("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:r}=this;await e.signIn();const{copyResources:i,folder:n,tags:s,title:o}=t||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof n=="string"?n:n==null?void 0:n.id,includeResources:!!i,tags:s==null?void 0:s.join(","),title:o}},{itemId:l}=await e.request(`${r}/copy`,a);return new _x({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,r=t.filename,i={method:"post"};if(typeof e=="string")yy(e)?i.query={data:e}:i.query={url:Tu(e)},r!=null&&(i.query.filename=r);else{const n=new FormData;r!=null?n.append("file",e,r):n.append("file",e),i.body=n}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new B("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:r}=await re(()=>Promise.resolve().then(()=>P3),void 0);return r(this,t,e)}async addResource(t,e,r){const{addOrUpdateResources:i}=await re(()=>Promise.resolve().then(()=>P3),void 0);return t.portalItem=this,await i(this,[{resource:t,content:e,compress:r==null?void 0:r.compress,access:r==null?void 0:r.access}],"add",r),t}async removeResource(t,e){const{removeResource:r}=await re(()=>Promise.resolve().then(()=>P3),void 0);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new B("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await re(()=>Promise.resolve().then(()=>P3),void 0);return e(this,t)}resourceFromPath(t){return new DXe({portalItem:this,path:t})}toJSON(){var r,i;const t=this.extent,e={accessInformation:this.accessInformation,categories:ae(this.categories),created:(r=this.created)==null?void 0:r.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:(i=this.modified)==null?void 0:i.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ae(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ae(this.typeKeywords),url:this.url};return DEe(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new _x({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};d([m({type:["private","shared","org","public"]})],fr.prototype,"access",void 0),d([m()],fr.prototype,"accessInformation",void 0),d([m({type:String})],fr.prototype,"apiKey",void 0),d([m({json:{read:{source:"appProxies"}}})],fr.prototype,"applicationProxies",void 0),d([m()],fr.prototype,"avgRating",void 0),d([m()],fr.prototype,"categories",void 0),d([m({type:Date})],fr.prototype,"created",void 0),d([m()],fr.prototype,"culture",void 0),d([m()],fr.prototype,"description",void 0),d([m({readOnly:!0})],fr.prototype,"displayName",null),d([m({type:br})],fr.prototype,"extent",void 0),d([Xe("extent")],fr.prototype,"readExtent",null),d([m()],fr.prototype,"groupCategories",void 0),d([m({readOnly:!0})],fr.prototype,"iconUrl",null),d([m()],fr.prototype,"id",void 0),d([m({readOnly:!0})],fr.prototype,"isLayer",null),d([m({type:Boolean,readOnly:!0})],fr.prototype,"isOrgItem",void 0),d([m()],fr.prototype,"itemControl",void 0),d([m({readOnly:!0})],fr.prototype,"itemPageUrl",null),d([m({readOnly:!0})],fr.prototype,"itemUrl",null),d([m()],fr.prototype,"licenseInfo",void 0),d([m({type:Date})],fr.prototype,"modified",void 0),d([m()],fr.prototype,"name",void 0),d([m()],fr.prototype,"numComments",void 0),d([m()],fr.prototype,"numRatings",void 0),d([m()],fr.prototype,"numViews",void 0),d([m()],fr.prototype,"owner",void 0),d([m()],fr.prototype,"ownerFolder",void 0),d([m({type:Ho})],fr.prototype,"portal",void 0),d([m()],fr.prototype,"screenshots",void 0),d([m()],fr.prototype,"size",void 0),d([m()],fr.prototype,"snippet",void 0),d([m()],fr.prototype,"sourceJSON",void 0),d([m({type:String})],fr.prototype,"sourceUrl",void 0),d([m({type:String})],fr.prototype,"spatialReference",void 0),d([m()],fr.prototype,"tags",void 0),d([m()],fr.prototype,"thumbnail",void 0),d([m({readOnly:!0})],fr.prototype,"thumbnailUrl",null),d([m()],fr.prototype,"title",void 0),d([m()],fr.prototype,"type",void 0),d([m()],fr.prototype,"typeKeywords",void 0),d([m({type:String,json:{read(t,e){var r;if(UXe.has(e.type)){const i=(r=this.portal)==null?void 0:r.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],fr.prototype,"url",void 0),d([m({readOnly:!0})],fr.prototype,"userItemUrl",null),fr=_x=d([F("esri.portal.PortalItem")],fr);const nb=fr,$3e=Object.freeze(Object.defineProperty({__proto__:null,default:nb},Symbol.toStringTag,{value:"Module"})),Gde=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,zXe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function jde(t){return t in zXe}const XM=[],k3=new Map;function Hde(t){for(const e of k3.keys())I3e(t.pattern,e)&&k3.delete(e)}function VXe(t){return XM.includes(t)||(Hde(t),XM.unshift(t)),ri(()=>{const e=XM.indexOf(t);e>-1&&(XM.splice(e,1),Hde(t))})}async function jne(t){const e=Nh();k3.has(t)||k3.set(t,GXe(t,e));const r=k3.get(t);return r&&await jXe.add(r),r}function BXe(t){if(!Gde.test(t))return null;const e=Gde.exec(t);if(e===null)return null;const[,r,i]=e,n=r+(i?"-"+i.toUpperCase():"");return jde(n)?n:jde(r)?r:null}async function GXe(t,e){const r=[];for(const i of XM)if(I3e(i.pattern,t))try{return await i.fetchMessageBundle(t,e)}catch(n){r.push(n)}throw r.length?new B("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:r}):new B("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function I3e(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}Vne(()=>{k3.clear()});const jXe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=ma())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function HXe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,r=await jne("esri/t9n/basemaps");return r[t]||r[e]}const $Z={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return di("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return di("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return di("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return di("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return di("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return di("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return di("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return di("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return di("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return di("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return di("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return di("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return di("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return di("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return di("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return di("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return di("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return di("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return di("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return di("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return di("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return di("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return di("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return di("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return di("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return di("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return di("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},qXe=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let O1=class extends Pe{constructor(e){super(e),this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const e=Nh().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const r=AXe(e);return r==="pt"?"pt-BR":r&&qXe.has(r)?r:"global"}};d([m()],O1.prototype,"id",void 0),d([m()],O1.prototype,"language",void 0),d([m()],O1.prototype,"places",void 0),d([m()],O1.prototype,"serviceUrl",void 0),d([m()],O1.prototype,"worldview",void 0),O1=d([F("esri.support.BasemapStyle")],O1);const WXe=O1;function Pqt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function YXe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function k2(t){return(t==null?void 0:t.type)==="subtype-sublayer"}function fI(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function IP(t){return t!=null&&"type"in t&&t.type==="group"}const Aqt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function L3e(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function XXe(t){return t==="IntegratedMeshLayer"||t==="IntegratedMesh3DTilesLayer"}function BL(t){return t==="integrated-mesh"||t==="integrated-mesh-3dtiles"}function qde(t){return(t==null?void 0:t.type)==="voxel"}function Wde(t){return(t==null?void 0:t.type)==="imagery-tile"}function o6(t){return(t==null?void 0:t.parent)!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function _B(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function Oqt(t){var e;return((t==null?void 0:t.type)==="feature"||(t==null?void 0:t.type)==="subtype-group")&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function ZXe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const r=t.activeLayer.tileMatrixSets;if(r)return r}return null}async function D3e(t,e){const r=vr==null?void 0:vr.findServerInfo(t);if((r==null?void 0:r.currentVersion)!=null)return r.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const n=`${t.substring(0,i)}/rest/info`,s=e!=null?e.signal:null,{data:o}=await Vt(n,{query:{f:"json"},responseType:"json",signal:s});return(o==null?void 0:o.owningSystemUrl)||null}function JXe(t){if(!("capabilities"in t))return!1;switch(t.type){case"catalog":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function QXe(t){return JXe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function KXe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function eZe(t){return!!KXe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const tZe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),rZe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function iZe(t){return t.layerContainerType==="basemap"?tZe:t.layerContainerType==="operational-layers"?rZe:null}function nZe(t,e){if(e.restrictedWebMapWriting){const r=iZe(e);return r==null||r.has(t.type)&&!_B(t)}return!0}function sZe(t,e){var r;if(e)if(_B(t)){const i=eB("featureCollection.layers",e),n=(r=i==null?void 0:i[0])==null?void 0:r.layerDefinition;n&&Yde(t,n)}else t.type!=="group"&&Yde(t,e)}function Yde(t,e){"maxScale"in t&&(e.maxScale=rz(t.maxScale)??void 0),"minScale"in t&&(e.minScale=rz(t.minScale)??void 0)}function oZe(t,e){if(sZe(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=rz(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(_B(t)){const r=e.featureCollection;r&&(r.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function Xde(t,e,r){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return r!=null&&r.messages&&r.messages.push(new B("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(_B(t)&&!t.isTable)e=t.resourceInfo;else if(nZe(t,r)){const i={};return t.write(i,r)?i:null}return e!=null&&oZe(t,e=ae(e)),e}var ZM;let aZe=0;const lZe="esri.Basemap";let lh=ZM=class extends kA(ay){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+aZe++,this.baseLayers=new St,this.referenceLayers=new St;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&K.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.addHandles([this.baseLayers.on("after-add",i=>e(i.item)),this.referenceLayers.on("after-add",i=>e(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{K.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.toArray();for(const r of t)r.destroy();const e=this.referenceLayers.toArray();for(const r of e)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=Me(this.portalItem)}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",kT(t,this._get("baseLayers")))}_writeBaseLayers(t,e,r){const i=[];t&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(n=>{const s=Xde(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);s!=null&&i.push(s)}),this.referenceLayers.forEach(n=>{const s=Xde(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);s!=null&&(n.type!=="scene"&&(s.isReference=!0),i.push(s))})),e.baseMapLayers=i}set referenceLayers(t){this._set("referenceLayers",kT(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Lne(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>GU(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>GU(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new ZM({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){var r;return t=t||{},e!=null&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&((r=this.resourceInfo)!=null&&r.data.baseMapLayers)&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const n=ae(i);return n.url&&oy(n.url)&&(n.url=`https:${n.url}`),n.templateUrl&&oy(n.templateUrl)&&(n.templateUrl=`https:${n.templateUrl}`),n})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:r,style:i}=this;dt(t);const n=[];if(e){const s=e.context?e.context.url:null;if(n.push(this._loadLayersFromJSON(e.data,s,t)),e.data.id&&!e.data.title){const o=e.data.id;n.push(HXe(o).then(a=>{a&&this.read({title:a},e.context)}))}}else r?n.push(this._loadFromItem(r,t)):i&&n.push(this._loadFromStylesService(i,t));await Promise.all(n)}async _loadLayersFromJSON(t,e,r){var l,c;const i=(l=this.resourceInfo)==null?void 0:l.context,n=((c=this.portalItem)==null?void 0:c.portal)||(i==null?void 0:i.portal)||null,s=uZe[(i==null?void 0:i.origin)||""]??"web-map",{populateOperationalLayers:o}=await re(()=>import("./layersCreator-BH7lXUdS.js"),__vite__mapDeps([2,3,4])),a=[];if(dt(r),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const u={context:{...i,origin:s,url:e,portal:n,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},h=g=>s==="web-scene"&&g.layerType==="ArcGISSceneServiceLayer"||g.isReference,p=o(this.baseLayers,t.baseMapLayers.filter(g=>!h(g)),u);a.push(p);const f=o(this.referenceLayers,t.baseMapLayers.filter(h),u);a.push(f)}await Promise.allSettled(a)}async _loadFromItem(t,e){const r=await t.load(e),i=await r.fetchData("json",e),n=xs(t.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:cZe[t.type||""]??"web-map",portal:t.portal||Ho.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||Ho.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}async _loadFromStylesService(t,e){const r=`${t.serviceUrl}/${t.id}`,i=(await Vt(r,{query:{language:t.getLanguageParamValue(),places:t.places,worldview:t.worldview},signal:e==null?void 0:e.signal})).data,n=xs(r);return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:"web-map",url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}static fromId(t){const e=$Z[t];return e?e.itemId?new ZM({portalItem:{id:e.itemId,portal:{url:"https://www.arcgis.com"}}}):ZM.fromJSON(e,{origin:e.is3d?"web-scene":"web-map"}):null}};d([m({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,r,i){this._writeBaseLayers(t,e,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:St}},writer(t,e,r,i){this._writeBaseLayers(t,e,i)}}}}}})],lh.prototype,"baseLayers",null),d([m({type:String,json:{origins:{"web-scene":{write:!0}}}})],lh.prototype,"id",void 0),d([m({type:nb})],lh.prototype,"portalItem",void 0),d([m()],lh.prototype,"referenceLayers",null),d([m({readOnly:!0})],lh.prototype,"resourceInfo",void 0),d([m({type:Ve})],lh.prototype,"spatialReference",void 0),d([m({type:WXe})],lh.prototype,"style",void 0),d([m()],lh.prototype,"thumbnailUrl",void 0),d([m({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],lh.prototype,"title",void 0),d([nt("title")],lh.prototype,"writeTitle",null),lh=ZM=d([F(lZe)],lh);const cZe={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},uZe={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},mI=lh,hZe=Object.freeze(Object.defineProperty({__proto__:null,default:mI},Symbol.toStringTag,{value:"Module"})),yz={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function N3e(t){return!!yz[t]||!!yz[t.toLowerCase()]}function Hne(t){return yz[t]??yz[t.toLowerCase()]}function dZe(t){return[...Hne(t)]}function Dj(t,e,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?t+(e-t)*i:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function F3e(t,e,r,i=1){const n=(t%360+360)%360/360,s=r<=.5?r*(e+1):r+e-r*e,o=2*r-s;return[Math.round(255*Dj(o,s,n+1/3)),Math.round(255*Dj(o,s,n)),Math.round(255*Dj(o,s,n-1/3)),i]}function pZe(t){const e=t.length>5,r=e?8:4,i=(1<<r)-1,n=e?1:17,s=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return s&&(l=o&i,o>>=r,a[3]=n*l/255),l=o&i,o>>=r,a[2]=n*l,l=o&i,o>>=r,a[1]=n*l,l=o&i,o>>=r,a[0]=n*l,a}function C(){return[0,0,0]}function nn(t){return[t[0],t[1],t[2]]}function Ce(t,e,r){return[t,e,r]}function Ka(t,e=C()){const r=Math.min(3,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function fZe(t,e){return new Float64Array(t,e,3)}function k3e(){return C()}function U3e(){return Ce(1,1,1)}function z3e(){return Ce(1,0,0)}function V3e(){return Ce(0,1,0)}function qne(){return Ce(0,0,1)}const Yn=k3e(),Fg=U3e(),Wne=z3e(),Yne=V3e(),LP=qne();Object.freeze(Object.defineProperty({__proto__:null,ONES:Fg,UNIT_X:Wne,UNIT_Y:Yne,UNIT_Z:LP,ZEROS:Yn,clone:nn,create:C,createView:fZe,fromArray:Ka,fromValues:Ce,ones:U3e,unitX:z3e,unitY:V3e,unitZ:qne,zeros:k3e},Symbol.toStringTag,{value:"Module"}));let Xne=1e-6;function ml(){return Xne}function mZe(t){Xne=t}const oN=Math.random,gZe=Math.PI/180,yZe=180/Math.PI;function vB(t){return t*gZe}function _Ze(t){return t*yZe}function vZe(t,e){return Math.abs(t-e)<=Xne*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:oN,equals:vZe,getEpsilon:ml,setEpsilon:mZe,toDegree:_Ze,toRadian:vB},Symbol.toStringTag,{value:"Module"}));function Te(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function he(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function se(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function ge(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function _e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function bB(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function _z(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function bZe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function B3e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function DP(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function G3e(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function j3e(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function H3e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function wZe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function oe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function ho(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function Bi(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}function ca(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function nl(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function ua(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Zne(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function me(t,e){const r=e[0],i=e[1],n=e[2];let s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}function fe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function it(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2];return t[0]=n*l-s*a,t[1]=s*o-i*l,t[2]=i*a-n*o,t}function pi(t,e,r,i){const n=e[0],s=e[1],o=e[2];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t}function xZe(t,e,r,i,n,s){const o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),u=o*(3-2*s);return t[0]=e[0]*a+r[0]*l+i[0]*c+n[0]*u,t[1]=e[1]*a+r[1]*l+i[1]*c+n[1]*u,t[2]=e[2]*a+r[2]*l+i[2]*c+n[2]*u,t}function SZe(t,e,r,i,n,s){const o=1-s,a=o*o,l=s*s,c=a*o,u=3*s*a,h=3*l*o,p=l*s;return t[0]=e[0]*c+r[0]*u+i[0]*h+n[0]*p,t[1]=e[1]*c+r[1]*u+i[1]*h+n[1]*p,t[2]=e[2]*c+r[2]*u+i[2]*h+n[2]*p,t}function TZe(t,e){e=e||1;const r=oN,i=2*r()*Math.PI,n=2*r()-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*s,t[1]=Math.sin(i)*s,t[2]=n*e,t}function ze(t,e,r){const i=e[0],n=e[1],s=e[2];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12],t[1]=r[1]*i+r[5]*n+r[9]*s+r[13],t[2]=r[2]*i+r[6]*n+r[10]*s+r[14],t}function po(t,e,r){const i=e[0],n=e[1],s=e[2];return t[0]=i*r[0]+n*r[3]+s*r[6],t[1]=i*r[1]+n*r[4]+s*r[7],t[2]=i*r[2]+n*r[5]+s*r[8],t}function pu(t,e,r){const i=r[0],n=r[1],s=r[2],o=r[3],a=e[0],l=e[1],c=e[2],u=n*c-s*l,h=s*a-i*c,p=i*l-n*a,f=n*p-s*h,g=s*u-i*p,y=i*h-n*u,v=2*o;return t[0]=a+u*v+2*f,t[1]=l+h*v+2*g,t[2]=c+p*v+2*y,t}function EZe(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function CZe(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function PZe(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function q3e(t,e){me(Zde,t),me(Jde,e);const r=fe(Zde,Jde);return r>1?0:r<-1?Math.PI:Math.acos(r)}const Zde=C(),Jde=C();function AZe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function aa(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function HT(t,e){if(t===e)return!0;const r=t[0],i=t[1],n=t[2],s=e[0],o=e[1],a=e[2],l=ml();return Math.abs(r-s)<=l*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=l*Math.max(1,Math.abs(n),Math.abs(a))}function x_(t,e,r){const i=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2];let o=i*i+n*n+s*s;return o>0?(o=1/Math.sqrt(o),t[0]=i*o,t[1]=n*o,t[2]=s*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const rn=_e,OZe=bB,MZe=_z,B0=Bi,GL=ca,uu=Te,vz=nl,Qde=Object.freeze(Object.defineProperty({__proto__:null,abs:DP,add:ge,angle:q3e,bezier:SZe,ceil:bZe,copy:he,cross:it,direction:x_,dist:B0,distance:Bi,div:MZe,divide:_z,dot:fe,equals:HT,exactEquals:aa,floor:B3e,hermite:xZe,inverse:Zne,len:uu,length:Te,lerp:pi,max:H3e,min:j3e,mul:OZe,multiply:bB,negate:ua,normalize:me,random:TZe,rotateX:EZe,rotateY:CZe,rotateZ:PZe,round:wZe,scale:oe,scaleAndAdd:ho,set:se,sign:G3e,sqrDist:GL,sqrLen:vz,squaredDistance:ca,squaredLength:nl,str:AZe,sub:rn,subtract:_e,transformMat3:po,transformMat4:ze,transformQuat:pu},Symbol.toStringTag,{value:"Module"})),Kde=new Float32Array(1);function W3e(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function we(t,e,r){return Math.min(Math.max(t,e),r)}function jL(t){return(t&t-1)==0}function Mqt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function Rqt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Dt(t,e,r){return t+(e-t)*r}function $qt(t,e,r,i,n){return Dt(i,n,(t-e)/(r-e))}function Ut(t){return t*Math.PI/180}function ul(t){return 180*t/Math.PI}function IZ(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function _o(t){return Math.acos(we(t,-1,1))}function ap(t){return Math.asin(we(t,-1,1))}function sb(t,e,r=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=r}const bz=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function LZ(t){return bz.setFloat64(0,t),bz.getBigInt64(0)}function RZe(t){return bz.setBigInt64(0,t),bz.getFloat64(0)}const a6=BigInt("1000000"),$Ze=Y3e(1);function Y3e(t){const e=LZ(t=Math.abs(t)),r=RZe(e<=a6?a6:e-a6);return Math.abs(t-r)}function Iqt(t,e,r=$Ze){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(r!=null&&Y3e(Math.min(Math.abs(t),Math.abs(e)))<r)return Math.abs(t-e)<=r;const i=LZ(t),n=LZ(e);return i<0!=n<0?!1:!((i<n?n-i:i-n)>a6)}function IZe(t,e,r=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const i=Math.abs(t-e),n=Math.abs(t),s=Math.abs(e);if(t===0||e===0||n<1e-12&&s<1e-12){if(i>.01*r)return!1}else if(i/(n+s)>r)return!1;return!0}function LZe(t){return X3e(Math.max(-DZ,Math.min(t,DZ)))}function X3e(t){return Kde[0]=t,Kde[0]}function HL(t,e,r){const i=we((r-t)/(e-t),0,1);return i*i*(3-2*i)}function epe(t,e){const r=Te(t),i=ap(t[2]/r),n=Math.atan2(t[1]/r,t[0]/r);return se(e,r,i,n),e}function Lqt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],i=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(sb(e,1)&&sb(r,1)&&sb(i,1))}const DZ=X3e(34028234663852886e22);function D4(t){return we(oB(t),0,255)}function N4(t,e,r){return t=Number(t),isNaN(t)?r:t<e?e:t>r?r:t}function F4(t,e){const r=t.toString(16).padStart(2,"0");return e?r.substring(0,1):r}let l6=class Jo{static blendColors(e,r,i,n=new Jo){return n.r=Math.round(e.r+(r.r-e.r)*i),n.g=Math.round(e.g+(r.g-e.g)*i),n.b=Math.round(e.b+(r.b-e.b)*i),n.a=e.a+(r.a-e.a)*i,n._sanitize()}static fromRgb(e,r){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const n=i[2].split(/\s*,\s*/),s=i[1];if(s==="rgb"&&n.length===3||s==="rgba"&&n.length===4){const o=n[0];if(o.charAt(o.length-1)==="%"){const a=n.map(l=>2.56*parseFloat(l));return n.length===4&&(a[3]=parseFloat(n[3])),Jo.fromArray(a,r)}return Jo.fromArray(n.map(a=>parseFloat(a)),r)}if(s==="hsl"&&n.length===3||s==="hsla"&&n.length===4)return Jo.fromArray(F3e(parseFloat(n[0]),parseFloat(n[1])/100,parseFloat(n[2])/100,parseFloat(n[3])),r)}return null}static fromHex(e,r=new Jo){if(e[0]!=="#"||isNaN(+`0x${e.substring(1)}`))return null;switch(e.length){case 4:case 5:{const i=parseInt(e.substring(1,2),16),n=parseInt(e.substring(2,3),16),s=parseInt(e.substring(3,4),16),o=e.length===5?15:parseInt(e.substring(4),16);return Jo.fromArray([i+16*i,n+16*n,s+16*s,(o+16*o)/255],r)}case 7:case 9:{const i=parseInt(e.substring(1,3),16),n=parseInt(e.substring(3,5),16),s=parseInt(e.substring(5,7),16),o=e.length===7?255:parseInt(e.substring(7),16);return Jo.fromArray([i,n,s,o/255],r)}default:return null}}static fromArray(e,r=new Jo){return r._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(e,r){const i=N3e(e)?Hne(e):null;return i&&Jo.fromArray(i,r)||Jo.fromRgb(e,r)||Jo.fromHex(e,r)}static fromJSON(e){return e!=null?new Jo([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Jo.fromString(e,this):Array.isArray(e)?Jo.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Jo||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const r=(e==null?void 0:e.capitalize)??!1,i=(e==null?void 0:e.digits)??6,n=i===3||i===4,s=i===4||i===8,o=`#${F4(this.r,n)}${F4(this.g,n)}${F4(this.b,n)}${s?F4(Math.round(255*this.a),n):""}`;return r?o.toUpperCase():o}toCss(e=!1){const r=this.r+", "+this.g+", "+this.b;return e?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Jo.AlphaMode.ALWAYS){const r=D4(this.r),i=D4(this.g),n=D4(this.b);return e===Jo.AlphaMode.ALWAYS||this.a!==1?[r,i,n,D4(255*this.a)]:[r,i,n]}clone(){return new Jo(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(N4(this.r,0,255)),this.g=Math.round(N4(this.g,0,255)),this.b=Math.round(N4(this.b,0,255)),this.a=N4(this.a,0,1),this}_set(e,r,i,n){this.r=e,this.g=r,this.b=i,this.a=n}};l6.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(l6||(l6={}));const De=l6;function Dqt(t){}function DZe(t){return()=>t}function gt(t,e={}){const r=t instanceof Ii?t:new Ii(t,e),i={type:(e==null?void 0:e.ignoreUnknown)??1?r.apiValues:String,json:{type:r.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(i.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(i.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(i.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(i.nonNullable=e.nonNullable),m(i)}var NZ;let c6=NZ=class extends Se{constructor(t){super(t),this.type="none"}clone(){return new NZ({type:this.type})}};d([gt({none:"none",stayAbove:"stay-above"})],c6.prototype,"type",void 0),c6=NZ=d([F("esri.ground.NavigationConstraint")],c6);function Jne(t){const e=oB(100*(1-t));return Math.max(0,Math.min(e,100))}function NP(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var FZ;let Jy=FZ=class extends kA(ay){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new St;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&K.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.addHandles([this.layers.on("after-add",i=>e(i.item)),this.layers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{on(t)||K.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)Me(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",kT(t,this._get("layers")))}writeLayers(t,e,r,i){const n=[];t&&(i={...i,layerContainerType:"ground"},t.forEach(s=>{if("write"in s){const o={};DZe(s)().write(o,i)&&n.push(o)}else i!=null&&i.messages&&i.messages.push(new B("layer:unsupported",`Layers (${s.title}, ${s.id}) of type '${s.declaredClass}' cannot be persisted in the ground`,{layer:s}))})),e.layers=n}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Lne(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await re(()=>import("./ElevationQuery-B0sFXdjf.js"),__vite__mapDeps([]));dt(e);const i=new r,n=this.layers.filter(tpe).toArray();return i.queryAll(n,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await re(()=>import("./ElevationQuery-B0sFXdjf.js"),__vite__mapDeps([]));dt(e);const i=new r,n=this.layers.filter(tpe).toArray();return i.createSamplerAll(n,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:ae(this.surfaceColor),navigationConstraint:ae(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new FZ({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,r){const i=(e==null?void 0:e.origin)||"web-scene",n=(e==null?void 0:e.portal)||null,s=(e==null?void 0:e.url)||null,{populateOperationalLayers:o}=await re(()=>import("./layersCreator-BH7lXUdS.js"),__vite__mapDeps([2,3,4]));dt(r);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:i,url:s,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}await Promise.allSettled(a)}};function NZe(t){return t&&"createElevationSampler"in t}function tpe(t){return t.type==="elevation"||NZe(t)}d([m({json:{read:!1}})],Jy.prototype,"layers",null),d([nt("layers")],Jy.prototype,"writeLayers",null),d([m({readOnly:!0})],Jy.prototype,"resourceInfo",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Vi,read:{reader:NP,source:"transparency"},write:{writer:(t,e)=>{e.transparency=Jne(t)},target:"transparency"}}})],Jy.prototype,"opacity",void 0),d([m({type:De,json:{type:[Vi],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],Jy.prototype,"surfaceColor",void 0),d([m({type:c6,json:{write:!0}})],Jy.prototype,"navigationConstraint",void 0),Jy=FZ=d([F("esri.Ground")],Jy);const wz=Jy;let JE=class extends St{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(hCe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let r=0;for(const i of e)i!=null&&(r=this._processCollection(r,i));this.splice(r,this.length)}_createNewInstance(e){return new St(e)}_processCollection(e,r){if(!r)return e;const i=this.itemFilterFunction??(n=>!!n);for(const n of r)if(n){if(i(n)){const s=this.indexOf(n,e);s>=0?s!==e&&this.reorder(n,e):this.add(n,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(n);if(Array.isArray(s))for(const o of s)e=this._processCollection(e,o);else e=this._processCollection(e,s)}}return e}};d([m()],JE.prototype,"getCollections",void 0),d([m()],JE.prototype,"getChildrenFunction",void 0),d([m()],JE.prototype,"itemFilterFunction",void 0),JE=d([F("esri.core.CollectionFlattener")],JE);const FP=JE;function FZe(t){var e,r;return!(!(t&&typeof t=="object"&&"loaded"in t&&t.loaded&&((r=(e=QXe(t))==null?void 0:e.operations)!=null&&r.supportsEditing)&&"type"in t)||"editingEnabled"in t&&!eZe(t))}const kZe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,UZe="screenUtils.toPt: input not recognized!",Z3e=96;function bs(t){return t?t/72*Z3e:0}function hl(t){return t?72*t/Z3e:0}function gn(t){if(typeof t=="string"){const e=t.match(kZe);if(e){const r=Number(e[1]),i=e[3]&&e[3].toLowerCase(),n=t.charAt(0)==="-",s=i==="px"?hl(r):r;return n?-s:s}return console.warn(UZe),null}return t}function lp(t=0,e=0){return{x:t,y:e}}function Sn(t=0,e=0){return[t,e]}function J3e(t=0,e=0){return[t,e]}function Na(t=0,e=0,r=0){return[t,e,r]}function Fqt(t){return t}function kqt(t){return t}function Uqt(t){return t}function $f(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function wB(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function zZe(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function VZe(t,e,r,i,n,s,o,a,l,c,u,h,p,f,g,y){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=n,v[5]=s,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=u,v[11]=h,v[12]=p,v[13]=f,v[14]=g,v[15]=y,v}function BZe(t,e){return new Float32Array(t,e,16)}const GZe=wB();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:GZe,clone:zZe,create:wB,createView:BZe,fromValues:VZe},Symbol.toStringTag,{value:"Module"}));function cs(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function _y(t,e,r,i,n,s,o,a,l,c,u,h,p,f,g,y,v){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=h,t[11]=p,t[12]=f,t[13]=g,t[14]=y,t[15]=v,t}function cp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Bu(t,e){if(t===e){const r=e[1],i=e[2],n=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=n,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function zA(t,e){return us(t,e)||cp(t),t}function us(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],y=e[13],v=e[14],b=e[15],w=r*a-i*o,x=r*l-n*o,S=r*c-s*o,E=i*l-n*a,P=i*c-s*a,M=n*c-s*l,L=u*y-h*g,U=u*v-p*g,z=u*b-f*g,W=h*v-p*y,V=h*b-f*y,J=p*b-f*v;let Y=w*J-x*V+S*W+E*z-P*U+M*L;return Y?(Y=1/Y,t[0]=(a*J-l*V+c*W)*Y,t[1]=(n*V-i*J-s*W)*Y,t[2]=(y*M-v*P+b*E)*Y,t[3]=(p*P-h*M-f*E)*Y,t[4]=(l*z-o*J-c*U)*Y,t[5]=(r*J-n*z+s*U)*Y,t[6]=(v*S-g*M-b*x)*Y,t[7]=(u*M-p*S+f*x)*Y,t[8]=(o*V-a*z+c*L)*Y,t[9]=(i*z-r*V-s*L)*Y,t[10]=(g*P-y*S+b*w)*Y,t[11]=(h*S-u*P-f*w)*Y,t[12]=(a*U-o*W-l*L)*Y,t[13]=(r*W-i*U+n*L)*Y,t[14]=(y*x-g*E-v*w)*Y,t[15]=(u*E-h*x+p*w)*Y,t):null}function jZe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],y=e[13],v=e[14],b=e[15];return t[0]=a*(p*b-f*v)-h*(l*b-c*v)+y*(l*f-c*p),t[1]=-(i*(p*b-f*v)-h*(n*b-s*v)+y*(n*f-s*p)),t[2]=i*(l*b-c*v)-a*(n*b-s*v)+y*(n*c-s*l),t[3]=-(i*(l*f-c*p)-a*(n*f-s*p)+h*(n*c-s*l)),t[4]=-(o*(p*b-f*v)-u*(l*b-c*v)+g*(l*f-c*p)),t[5]=r*(p*b-f*v)-u*(n*b-s*v)+g*(n*f-s*p),t[6]=-(r*(l*b-c*v)-o*(n*b-s*v)+g*(n*c-s*l)),t[7]=r*(l*f-c*p)-o*(n*f-s*p)+u*(n*c-s*l),t[8]=o*(h*b-f*y)-u*(a*b-c*y)+g*(a*f-c*h),t[9]=-(r*(h*b-f*y)-u*(i*b-s*y)+g*(i*f-s*h)),t[10]=r*(a*b-c*y)-o*(i*b-s*y)+g*(i*c-s*a),t[11]=-(r*(a*f-c*h)-o*(i*f-s*h)+u*(i*c-s*a)),t[12]=-(o*(h*v-p*y)-u*(a*v-l*y)+g*(a*p-l*h)),t[13]=r*(h*v-p*y)-u*(i*v-n*y)+g*(i*p-n*h),t[14]=-(r*(a*v-l*y)-o*(i*v-n*y)+g*(i*l-n*a)),t[15]=r*(a*p-l*h)-o*(i*p-n*h)+u*(i*l-n*a),t}function HZe(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],p=t[11],f=t[12],g=t[13],y=t[14],v=t[15];return(e*o-r*s)*(h*v-p*y)-(e*a-i*s)*(u*v-p*g)+(e*l-n*s)*(u*y-h*g)+(r*a-i*o)*(c*v-p*f)-(r*l-n*o)*(c*y-h*f)+(i*l-n*a)*(c*g-u*f)}function Kr(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],f=e[10],g=e[11],y=e[12],v=e[13],b=e[14],w=e[15];let x=r[0],S=r[1],E=r[2],P=r[3];return t[0]=x*i+S*a+E*h+P*y,t[1]=x*n+S*l+E*p+P*v,t[2]=x*s+S*c+E*f+P*b,t[3]=x*o+S*u+E*g+P*w,x=r[4],S=r[5],E=r[6],P=r[7],t[4]=x*i+S*a+E*h+P*y,t[5]=x*n+S*l+E*p+P*v,t[6]=x*s+S*c+E*f+P*b,t[7]=x*o+S*u+E*g+P*w,x=r[8],S=r[9],E=r[10],P=r[11],t[8]=x*i+S*a+E*h+P*y,t[9]=x*n+S*l+E*p+P*v,t[10]=x*s+S*c+E*f+P*b,t[11]=x*o+S*u+E*g+P*w,x=r[12],S=r[13],E=r[14],P=r[15],t[12]=x*i+S*a+E*h+P*y,t[13]=x*n+S*l+E*p+P*v,t[14]=x*s+S*c+E*f+P*b,t[15]=x*o+S*u+E*g+P*w,t}function Fc(t,e,r){const i=r[0],n=r[1],s=r[2];if(e===t)t[12]=e[0]*i+e[4]*n+e[8]*s+e[12],t[13]=e[1]*i+e[5]*n+e[9]*s+e[13],t[14]=e[2]*i+e[6]*n+e[10]*s+e[14],t[15]=e[3]*i+e[7]*n+e[11]*s+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],h=e[5],p=e[6],f=e[7],g=e[8],y=e[9],v=e[10],b=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=h,t[6]=p,t[7]=f,t[8]=g,t[9]=y,t[10]=v,t[11]=b,t[12]=o*i+u*n+g*s+e[12],t[13]=a*i+h*n+y*s+e[13],t[14]=l*i+p*n+v*s+e[14],t[15]=c*i+f*n+b*s+e[15]}return t}function g2(t,e,r){const i=r[0],n=r[1],s=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ou(t,e,r,i){let n,s,o,a,l,c,u,h,p,f,g,y,v,b,w,x,S,E,P,M,L,U,z,W,V=i[0],J=i[1],Y=i[2],X=Math.sqrt(V*V+J*J+Y*Y);return X<ml()?null:(X=1/X,V*=X,J*=X,Y*=X,n=Math.sin(r),s=Math.cos(r),o=1-s,a=e[0],l=e[1],c=e[2],u=e[3],h=e[4],p=e[5],f=e[6],g=e[7],y=e[8],v=e[9],b=e[10],w=e[11],x=V*V*o+s,S=J*V*o+Y*n,E=Y*V*o-J*n,P=V*J*o-Y*n,M=J*J*o+s,L=Y*J*o+V*n,U=V*Y*o+J*n,z=J*Y*o-V*n,W=Y*Y*o+s,t[0]=a*x+h*S+y*E,t[1]=l*x+p*S+v*E,t[2]=c*x+f*S+b*E,t[3]=u*x+g*S+w*E,t[4]=a*P+h*M+y*L,t[5]=l*P+p*M+v*L,t[6]=c*P+f*M+b*L,t[7]=u*P+g*M+w*L,t[8]=a*U+h*z+y*W,t[9]=l*U+p*z+v*W,t[10]=c*U+f*z+b*W,t[11]=u*U+g*z+w*W,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function kP(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+c*i,t[5]=o*n+u*i,t[6]=a*n+h*i,t[7]=l*n+p*i,t[8]=c*n-s*i,t[9]=u*n-o*i,t[10]=h*n-a*i,t[11]=p*n-l*i,t}function xB(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-c*i,t[1]=o*n-u*i,t[2]=a*n-h*i,t[3]=l*n-p*i,t[8]=s*i+c*n,t[9]=o*i+u*n,t[10]=a*i+h*n,t[11]=l*i+p*n,t}function UP(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+c*i,t[1]=o*n+u*i,t[2]=a*n+h*i,t[3]=l*n+p*i,t[4]=c*n-s*i,t[5]=u*n-o*i,t[6]=h*n-a*i,t[7]=p*n-l*i,t}function aN(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function qZe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Gu(t,e,r){if(e===0)return cp(t);let i,n,s,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<ml()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(e),n=Math.cos(e),s=1-n,t[0]=o*o*s+n,t[1]=a*o*s+l*i,t[2]=l*o*s-a*i,t[3]=0,t[4]=o*a*s-l*i,t[5]=a*a*s+n,t[6]=l*a*s+o*i,t[7]=0,t[8]=o*l*s+a*i,t[9]=a*l*s-o*i,t[10]=l*l*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Q3e(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function WZe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function K3e(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ePe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=i+i,l=n+n,c=s+s,u=i*a,h=i*l,p=i*c,f=n*l,g=n*c,y=s*c,v=o*a,b=o*l,w=o*c;return t[0]=1-(f+y),t[1]=h+w,t[2]=p-b,t[3]=0,t[4]=h-w,t[5]=1-(u+y),t[6]=g+v,t[7]=0,t[8]=p+b,t[9]=g-v,t[10]=1-(u+f),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function YZe(t,e){const r=XZe,i=-e[0],n=-e[1],s=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=i*i+n*n+s*s+o*o;return h>0?(r[0]=2*(a*o+u*i+l*s-c*n)/h,r[1]=2*(l*o+u*n+c*i-a*s)/h,r[2]=2*(c*o+u*s+a*n-l*i)/h):(r[0]=2*(a*o+u*i+l*s-c*n),r[1]=2*(l*o+u*n+c*i-a*s),r[2]=2*(c*o+u*s+a*n-l*i)),ePe(t,e,r),t}const XZe=C();function zP(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function SB(t,e){const r=e[0],i=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(r*r+i*i+n*n),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function tPe(t,e){const r=e[0]+e[5]+e[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function rPe(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3],l=n+n,c=s+s,u=o+o,h=n*l,p=n*c,f=n*u,g=s*c,y=s*u,v=o*u,b=a*l,w=a*c,x=a*u,S=i[0],E=i[1],P=i[2];return t[0]=(1-(g+v))*S,t[1]=(p+x)*S,t[2]=(f-w)*S,t[3]=0,t[4]=(p-x)*E,t[5]=(1-(h+v))*E,t[6]=(y+b)*E,t[7]=0,t[8]=(f+w)*P,t[9]=(y-b)*P,t[10]=(1-(h+g))*P,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Qne(t,e,r,i,n){const s=e[0],o=e[1],a=e[2],l=e[3],c=s+s,u=o+o,h=a+a,p=s*c,f=s*u,g=s*h,y=o*u,v=o*h,b=a*h,w=l*c,x=l*u,S=l*h,E=i[0],P=i[1],M=i[2],L=n[0],U=n[1],z=n[2],W=(1-(y+b))*E,V=(f+S)*E,J=(g-x)*E,Y=(f-S)*P,X=(1-(p+b))*P,le=(v+w)*P,D=(g+x)*M,I=(v-w)*M,k=(1-(p+y))*M;return t[0]=W,t[1]=V,t[2]=J,t[3]=0,t[4]=Y,t[5]=X,t[6]=le,t[7]=0,t[8]=D,t[9]=I,t[10]=k,t[11]=0,t[12]=r[0]+L-(W*L+Y*U+D*z),t[13]=r[1]+U-(V*L+X*U+I*z),t[14]=r[2]+z-(J*L+le*U+k*z),t[15]=1,t}function ZZe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,a=i+i,l=n+n,c=r*o,u=i*o,h=i*a,p=n*o,f=n*a,g=n*l,y=s*o,v=s*a,b=s*l;return t[0]=1-h-g,t[1]=u+b,t[2]=p-v,t[3]=0,t[4]=u-b,t[5]=1-c-g,t[6]=f+y,t[7]=0,t[8]=p+v,t[9]=f-y,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function iPe(t,e,r,i,n,s,o){const a=1/(r-e),l=1/(n-i),c=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*l,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(n+i)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function JZe(t,e,r,i,n){const s=1/Math.tan(e/2);let o;return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(o=1/(i-n),t[10]=(n+i)*o,t[14]=2*n*i*o):(t[10]=-1,t[14]=-2*i),t}function QZe(t,e,r,i){const n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(n+s);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(n-s)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function nPe(t,e,r,i,n,s,o){const a=1/(e-r),l=1/(i-n),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(n+i)*l,t[14]=(o+s)*c,t[15]=1,t}function TB(t,e,r,i){const n=e[0],s=e[1],o=e[2];let a=n-r[0],l=s-r[1],c=o-r[2];const u=ml();if(Math.abs(a)<u&&Math.abs(l)<u&&Math.abs(c)<u)return void cp(t);let h=1/Math.sqrt(a*a+l*l+c*c);a*=h,l*=h,c*=h;const p=i[0],f=i[1],g=i[2];let y=f*c-g*l,v=g*a-p*c,b=p*l-f*a;h=Math.sqrt(y*y+v*v+b*b),h?(h=1/h,y*=h,v*=h,b*=h):(y=0,v=0,b=0);let w=l*b-c*v,x=c*y-a*b,S=a*v-l*y;h=Math.sqrt(w*w+x*x+S*S),h?(h=1/h,w*=h,x*=h,S*=h):(w=0,x=0,S=0),t[0]=y,t[1]=w,t[2]=a,t[3]=0,t[4]=v,t[5]=x,t[6]=l,t[7]=0,t[8]=b,t[9]=S,t[10]=c,t[11]=0,t[12]=-(y*n+v*s+b*o),t[13]=-(w*n+x*s+S*o),t[14]=-(a*n+l*s+c*o),t[15]=1}function sPe(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let u=n-r[0],h=s-r[1],p=o-r[2],f=u*u+h*h+p*p;f>0&&(f=1/Math.sqrt(f),u*=f,h*=f,p*=f);let g=l*p-c*h,y=c*u-a*p,v=a*h-l*u;return f=g*g+y*y+v*v,f>0&&(f=1/Math.sqrt(f),g*=f,y*=f,v*=f),t[0]=g,t[1]=y,t[2]=v,t[3]=0,t[4]=h*v-p*y,t[5]=p*g-u*v,t[6]=u*y-h*g,t[7]=0,t[8]=u,t[9]=h,t[10]=p,t[11]=0,t[12]=n,t[13]=s,t[14]=o,t[15]=1,t}function KZe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function eJe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function tJe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function oPe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function rJe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function iJe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function Kne(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function EB(t,e){if(t===e)return!0;const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],p=t[10],f=t[11],g=t[12],y=t[13],v=t[14],b=t[15],w=e[0],x=e[1],S=e[2],E=e[3],P=e[4],M=e[5],L=e[6],U=e[7],z=e[8],W=e[9],V=e[10],J=e[11],Y=e[12],X=e[13],le=e[14],D=e[15],I=ml();return Math.abs(r-w)<=I*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(i-x)<=I*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(n-S)<=I*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(s-E)<=I*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(o-P)<=I*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(a-M)<=I*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(l-L)<=I*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(c-U)<=I*Math.max(1,Math.abs(c),Math.abs(U))&&Math.abs(u-z)<=I*Math.max(1,Math.abs(u),Math.abs(z))&&Math.abs(h-W)<=I*Math.max(1,Math.abs(h),Math.abs(W))&&Math.abs(p-V)<=I*Math.max(1,Math.abs(p),Math.abs(V))&&Math.abs(f-J)<=I*Math.max(1,Math.abs(f),Math.abs(J))&&Math.abs(g-Y)<=I*Math.max(1,Math.abs(g),Math.abs(Y))&&Math.abs(y-X)<=I*Math.max(1,Math.abs(y),Math.abs(X))&&Math.abs(v-le)<=I*Math.max(1,Math.abs(v),Math.abs(le))&&Math.abs(b-D)<=I*Math.max(1,Math.abs(b),Math.abs(D))}function ese(t){const e=ml(),r=t[0],i=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return Math.abs(1-(r*r+s*s+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+u*u))<=e}function CB(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const nJe=Kr,sJe=oPe;Object.freeze(Object.defineProperty({__proto__:null,add:tJe,adjoint:jZe,copy:cs,determinant:HZe,equals:EB,exactEquals:Kne,frob:eJe,fromQuat:ZZe,fromQuat2:YZe,fromRotation:Gu,fromRotationTranslation:ePe,fromRotationTranslationScale:rPe,fromRotationTranslationScaleOrigin:Qne,fromScaling:qZe,fromTranslation:aN,fromXRotation:Q3e,fromYRotation:WZe,fromZRotation:K3e,frustum:iPe,getRotation:tPe,getScaling:SB,getTranslation:zP,hasIdentityRotation:CB,identity:cp,invert:us,invertOrIdentity:zA,isOrthoNormal:ese,lookAt:TB,mul:nJe,multiply:Kr,multiplyScalar:rJe,multiplyScalarAndAdd:iJe,ortho:nPe,perspective:JZe,perspectiveFromFieldOfView:QZe,rotate:Ou,rotateX:kP,rotateY:xB,rotateZ:UP,scale:g2,set:_y,str:KZe,sub:sJe,subtract:oPe,targetTo:sPe,translate:Fc,transpose:Bu},Symbol.toStringTag,{value:"Module"}));const oJe=(t,e)=>{const r=_y(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Bu(r,r)},aJe=(t,e)=>{const r=_y(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Bu(r,r)},lJe=(t,e)=>{const r=1-e,i=_y(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return Bu(i,i)},cJe=(t,e)=>{const r=Math.sin(e*Math.PI/180),i=Math.cos(e*Math.PI/180),n=_y(t,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return Bu(n,n)},uJe=(t,e)=>{const r=1-2*e,i=_y(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return Bu(i,i)},hJe=(t,e)=>{const r=_y(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Bu(r,r)},dJe=(t,e)=>{const r=1-e,i=_y(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return Bu(i,i)};let aPe=class lPe{constructor(e,r,i){this.strength=e,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(e,r,i){this.strength=fu(e.strength,r.strength,i),this.radius=fu(e.radius,r.radius,i),this.threshold=fu(e.threshold,r.threshold,i)}clone(){return new lPe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:gI(this.radius),strength:this.strength,threshold:this.threshold}}},cPe=class uPe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,r,i){this.radius=Math.round(fu(e.radius,r.radius,i))}clone(){return new uPe(this.radius)}toJSON(){return{type:"blur",radius:gI(this.radius)}}},kZ=class hPe{constructor(e,r){this.type=e,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.amount=fu(e.amount,r.amount,i),this._updateMatrix()}clone(){return new hPe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||wB();switch(this.type){case"brightness":this._colorMatrix=oJe(e,this.amount);break;case"contrast":this._colorMatrix=aJe(e,this.amount);break;case"grayscale":this._colorMatrix=lJe(e,this.amount);break;case"invert":this._colorMatrix=uJe(e,this.amount);break;case"saturate":this._colorMatrix=hJe(e,this.amount);break;case"sepia":this._colorMatrix=dJe(e,this.amount)}}},dPe=class pPe{constructor(e,r,i,n){this.offsetX=e,this.offsetY=r,this.blurRadius=i,this.color=n,this.type="drop-shadow"}interpolate(e,r,i){this.offsetX=fu(e.offsetX,r.offsetX,i),this.offsetY=fu(e.offsetY,r.offsetY,i),this.blurRadius=fu(e.blurRadius,r.blurRadius,i),this.color[0]=Math.round(fu(e.color[0],r.color[0],i)),this.color[1]=Math.round(fu(e.color[1],r.color[1],i)),this.color[2]=Math.round(fu(e.color[2],r.color[2],i)),this.color[3]=fu(e.color[3],r.color[3],i)}clone(){return new pPe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:gI(this.offsetX),yoffset:gI(this.offsetY),blurRadius:gI(this.blurRadius),color:e}}},fPe=class mPe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.angle=fu(e.angle,r.angle,i),this._updateMatrix()}clone(){return new mPe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||wB();this._colorMatrix=cJe(e,this.angle)}},gPe=class yPe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,r,i){this.amount=fu(e.amount,r.amount,i)}clone(){return new yPe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function fu(t,e,r){return t+(e-t)*r}function gI(t){return Math.round(1e3*hl(t))/1e3}function pJe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new kZ(t.type,0);case"saturate":case"brightness":case"contrast":return new kZ(t.type,1);case"opacity":return new gPe(1);case"hue-rotate":return new fPe(0);case"blur":return new cPe(0);case"drop-shadow":return new dPe(0,0,0,[...Hne("transparent")]);case"bloom":return new aPe(0,0,1)}}function fJe(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every((i,n)=>i.type===r[n].type)}function mJe(t,e){const r=t.length>e.length?t:e,i=t.length>e.length?e:t;for(let n=i.length;n<r.length;n++)i.push(pJe(r[n]))}function gJe(t){const e=t[0];return!!e&&"type"in e}const rpe=()=>K.getLogger("esri.support.basemapUtils");function yJe(){return{}}function _Je(t){for(const e in t){const r=t[e];Me(r),delete t[e]}}function vJe(t,e){let r;if(typeof t=="string"){const i=t in $Z,n=!i&&t.includes("/");if(!i&&!n){const s=Object.entries($Z).filter(([o,a])=>ai.apiKey&&!a.classic||!ai.apiKey&&(a.classic||a.is3d)).map(([o])=>`"${o}"`).sort().join(", ");return rpe().warn(`Unable to find basemap definition for: ${t}. Try one of these: ${s}`),null}e&&(r=e[t]),r||(r=i?mI.fromId(t):new mI({style:{id:t}}),e&&(e[t]=r))}else r=to(mI,t);return r!=null&&r.destroyed&&(rpe().warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function zqt(t,e){var r,i,n,s;return((i=(r=t.basemap)==null?void 0:r.referenceLayers)==null?void 0:i.some(o=>o.uid===e))||((s=(n=t.basemap)==null?void 0:n.baseLayers)==null?void 0:s.some(o=>o.uid===e))}function bJe(t){return new FP({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const r=[];return"tables"in e&&r.push(e.tables),"layers"in e&&r.push(e.layers),r},itemFilterFunction:e=>{const r=e.parent;return!!r&&"tables"in r&&r.tables.includes(e)}})}function Nj(t){for(const e of t.values())e==null||e.destroy();t.clear()}const ipe={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function wJe(t){let e=null;if(typeof t=="string")if(t in ipe){const r=ipe[t];e=new wz({resourceInfo:{data:{layers:[r]}}})}else K.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=to(wz,t);return e}function VP(t,e,r=!1){let{hasM:i,hasZ:n}=t;Array.isArray(e)?e.length!==4||i||n?e.length===3&&r&&!i?(n=!0,i=!1):e.length===3&&i&&n&&(i=!1,n=!1):(i=!0,n=!0):(n=!n&&e.hasZ&&(!i||e.hasM),i=!i&&e.hasM&&(!n||e.hasZ)),t.hasZ=n,t.hasM=i}var UZ;function npe(t){return(e,r)=>e==null?r:r==null?e:t(e,r)}function xJe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let M1=UZ=class extends w_{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){var n;if(!t&&!e)return{};const r={};Array.isArray(t)?(r.points=t,r.spatialReference=e):xJe(t)?r.spatialReference=t:(t.points&&(r.points=t.points),t.spatialReference&&(r.spatialReference=t.spatialReference),t.hasZ&&(r.hasZ=t.hasZ),t.hasM&&(r.hasM=t.hasM));const i=(n=r.points)==null?void 0:n[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new br,r=this.hasZ,i=this.hasM,n=r?3:2,s=t[0],o=npe(Math.min),a=npe(Math.max);let l,c,u,h,[p,f]=s,[g,y]=s;for(let v=0,b=t.length;v<b;v++){const w=t[v],[x,S]=w;if(p=o(p,x),f=o(f,S),g=a(g,x),y=a(y,S),r&&w.length>2){const E=w[2];l=o(l,E),u=a(u,E)}if(i&&w.length>n){const E=w[n];c=o(c,E),h=a(h,E)}}return e.xmin=p,e.ymin=f,e.xmax=g,e.ymax=y,e.spatialReference=this.spatialReference,r?(e.zmin=l,e.zmax=u):(e.zmin=void 0,e.zmax=void 0),i?(e.mmin=c,e.mmax=h):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=ae(this.points)}addPoint(t){return VP(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:ae(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new UZ(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],r={x:e[0],y:e[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=e[2],i=3),this.hasM&&(r.m=e[i]),new He(r)}removePoint(t){if(!this._validateInputs(t))return null;const e=new He(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(VP(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};d([m({readOnly:!0})],M1.prototype,"cache",null),d([m()],M1.prototype,"extent",null),d([m({type:[[Number]],json:{write:{isRequired:!0}}})],M1.prototype,"points",void 0),d([nt("points")],M1.prototype,"writePoints",null),M1=UZ=d([F("esri.geometry.Multipoint")],M1),M1.prototype.toJSON.isDefaultToJSON=!0;const VA=M1;function PB(t){const e=[];for(t.reset();t.nextPath();){const r=[];for(;t.nextPoint();)r.push([t.x,t.y]);e.push(r)}return t.reset(),e}function ob(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}var wn;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(wn||(wn={}));function AB(t,e){const r=e[0]-t[0],i=e[1]-t[1];if(t.length>2&&e.length>2){const n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}return Math.sqrt(r*r+i*i)}function _Pe(t,e,r){const i=t[0]+r*(e[0]-t[0]),n=t[1]+r*(e[1]-t[1]);return t.length>2&&e.length>2?[i,n,t[2]+r*(e[2]-t[2])]:[i,n]}function SJe(t,e,r,i){const[n,s]=e,[o,a]=r,[l,c]=i,u=l-o,h=c-a,p=u*u+h*h,f=(n-o)*u+(s-a)*h,g=Math.min(1,Math.max(0,f/p));return t[0]=o+u*g,t[1]=a+h*g,t}function TJe(t,e,r,i,n,s){let o=r,a=i,l=n-o,c=s-a;if(l!==0||c!==0){const u=((t-o)*l+(e-a)*c)/(l*l+c*c);u>1?(o=n,a=s):u>0&&(o+=l*u,a+=c*u)}return l=t-o,c=e-a,l*l+c*c}function vPe(t,e){return _Pe(t,e,.5)}function bPe(t){const e=t.length;let r=0;for(let i=0;i<e-1;++i)r+=AB(t[i],t[i+1]);return r}function wPe(t,e){if(e<=0)return t[0];const r=t.length;let i=0;for(let n=0;n<r-1;++n){const s=AB(t[n],t[n+1]);if(e-i<s){const o=(e-i)/s;return _Pe(t[n],t[n+1],o)}i+=s}return t[r-1]}function u6(t,e=wn.X,r=wn.Y){let i=0;const n=t.length;let s=t[0];for(let o=0;o<n-1;o++){const a=t[o+1];i+=(a[e]-s[e])*(a[r]+s[r]),s=a}return i>=0}function EJe(t){const e=t.length;return e>2&&ny(t[0],t[e-1])}function Vqt(t){if("rings"in t)for(const e of t.rings)EJe(e)||e.push(e[0].slice())}function Bqt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function xPe(t){return t?SPe(t.rings,t.hasZ??!1):null}function SPe(t,e){if(!(t!=null&&t.length))return null;const r=[],i=[],n=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let s=0,o=t.length;s<o;s++){const a=TPe(t[s],e,n);a&&i.push(a)}if(i.sort((s,o)=>{let a=s[2]-o[2];return a===0&&e&&(a=s[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],e&&(r[2]=i[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||e&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){const s=t[0]&&t[0].length?PJe(t[0],e):null;if(!s)return null;r[0]=s[0],r[1]=s[1],e&&s.length>2&&(r[2]=s[2])}return r}function TPe(t,e,r){let i=0,n=0,s=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,u=t.length&&e?t[0][2]:0;for(let p=0;p<t.length;p++){const f=t[p],g=t[(p+1)%t.length],[y,v,b]=f,w=y-l,x=v-c,[S,E,P]=g,M=S-l,L=E-c,U=w*L-M*x;if(o+=U,i+=(w+M)*U,n+=(x+L)*U,e&&f.length>2&&g.length>2){const z=b-u,W=P-u,V=w*W-M*z;s+=(z+W)*V,a+=V}y<r[0]&&(r[0]=y),y>r[1]&&(r[1]=y),v<r[2]&&(r[2]=v),v>r[3]&&(r[3]=v),e&&(b<r[4]&&(r[4]=b),b>r[5]&&(r[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const h=[i/(6*o)+l,n/(6*o)+c,o];return e&&(r[4]===r[5]||a===0?(h[3]=(r[4]+r[5])/2,h[4]=0):(h[3]=s/(6*a)+u,h[4]=a)),h}function CJe(t,e){let r=0,i=0,n=0;t.nextPoint();const s=t.pathSize?t.x:0,o=t.pathSize?t.y:0;for(let a=0;a<t.pathSize;a++){t.seekInPath(a);const l=[t.x,t.y];t.seekInPath((a+1)%t.pathSize);const c=[t.x,t.y],[u,h]=l,p=u-s,f=h-o,[g,y]=c,v=g-s,b=y-o,w=p*b-v*f;n+=w,r+=(p+v)*w,i+=(f+b)*w,u<e[0]&&(e[0]=u),u>e[1]&&(e[1]=u),h<e[2]&&(e[2]=h),h>e[3]&&(e[3]=h)}return n>0&&(n*=-1),n?(n*=.5,[r/(6*n)+s,i/(6*n)+o,n]):null}function PJe(t,e){const r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const u=t[l],h=t[l+1];if(u&&h){r[0]=u[0],r[1]=u[1],i[0]=h[0],i[1]=h[1],e&&u.length>2&&h.length>2&&(r[2]=u[2],i[2]=h[2]);const p=AB(r,i);if(p){n+=p;const f=vPe(u,h);s+=p*f[0],o+=p*f[1],e&&f.length>2&&(a+=p*f[2])}}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.length?t[0]:null}function AJe(t){const{hasZ:e,totalSize:r}=t;if(r===0)return null;const i=[],n=[],s=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=TPe(ob(t),t.hasZ,s);o&&n.push(o)}if(n.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),n.length&&(i[0]=n[0][0],i[1]=n[0][1],e&&(i[2]=n[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||e&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){t.reset(),t.nextPath();const o=t.pathSize?OJe(t):null;if(!o)return null;i[0]=o[0],i[1]=o[1],e&&o.length>2&&(i[2]=o[2])}return i}function OJe(t){const{hasZ:e}=t,r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,u=t.z;for(;t.nextPoint();){const h=t.x,p=t.y,f=t.z;r[0]=l,r[1]=c,i[0]=h,i[1]=p,e&&(r[2]=u,i[2]=f);const g=AB(r,i);if(g){n+=g;const y=vPe(r,i);s+=g*y[0],o+=g*y[1],e&&y.length>2&&(a+=g*y[2])}l=h,c=p,u=f}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const MJe=1e-6;function RJe(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<MJe){const n=AJe(t);return n?[n[0],n[1]]:null}const r=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const i=[t.x,t.y];for(t.reset();t.nextPath();)IJe(r,i,t);return r[0]*=1/e,r[1]*=1/e,r[0]+=i[0],r[1]+=i[1],r}const $Je=1/3;function IJe(t,e,r){if(!t||!r||r.pathSize<3)return null;r.nextPoint();const i=r.x,n=r.y;r.nextPoint();let s,o=r.x-i,a=r.y-n,l=0,c=0;for(;r.nextPoint();)l=r.x-i,c=r.y-n,s=.5*$Je*(l*a-c*o),t[0]+=s*(o+l),t[1]+=s*(a+c),o=l,a=c;const u=r.getCurrentRingArea(),h=[i,n];return h[0]-=e[0],h[1]-=e[1],h[0]*=u,h[1]*=u,t[0]+=h[0],t[1]+=h[1],t}function Ht(t=FJe){return[t[0],t[1],t[2],t[3]]}function Gqt(t){return[t[0],t[1],t[2],t[3]]}function c_(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function OB(t,e,r,i,n=Ht()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function EPe(t,e=Ht()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function MB(t,e){return new br({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function U3(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function ab(t,e,r){if(e!=null)if("length"in e)BZ(e)?(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[0]),r[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":r[0]=Math.min(t[0],e.xmin),r[1]=Math.min(t[1],e.ymin),r[2]=Math.max(t[2],e.xmax),r[3]=Math.max(t[3],e.ymax);break;case"point":r[0]=Math.min(t[0],e.x),r[1]=Math.min(t[1],e.y),r[2]=Math.max(t[2],e.x),r[3]=Math.max(t[3],e.y)}else c_(r,t)}function Fj(t,e,r=t){const i=e.length;let n=t[0],s=t[1],o=t[2],a=t[3];for(let l=0;l<i;l++){const c=e[l];n=Math.min(n,c[0]),s=Math.min(s,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=n,r[1]=s,r[2]=o,r[3]=a,r}function zZ(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function sl(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function Mc(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function jqt(t){return sl(t)*Mc(t)}function xz(t){return sl(t)>0&&Mc(t)>0}function tse(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function CPe(t,e){return RB(t,e[0],e[1])}function spe(t,e){const r=e[3],i=.5*(t[0]+t[2]),n=Math.abs(e[0]-i),s=.5*(t[2]-t[0]);if(n>r+s)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>r+a)return!1;if(n<s||l<a)return!0;const c=n-s,u=l-a;return c*c+u*u<=r*r}function Hqt(t,e,r){const i=t[0],n=t[1],s=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:u}=r,h=(v,b)=>(u-l)*v+(a-c)*b+(c*l-a*u)<0,p=h(i,o),f=h(s,o),g=h(s,n),y=h(i,n);return!(p===f&&f===g&&g===y&&y===p||a<i&&c<i||a>s&&c>s||l>o&&u>o||l<n&&u<n)}function qqt(t,e){return RB(t,e.x,e.y)}function RB(t,e,r){return e>=t[0]&&r>=t[1]&&e<=t[2]&&r<=t[3]}function LJe(t,e,r){return e[0]>=t[0]-r&&e[1]>=t[1]-r&&e[0]<=t[2]+r&&e[1]<=t[3]+r}function lN(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function ope(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function VZ(t,e,r){if(e==null)return c_(r,t);const i=e[0],n=e[1],s=e[2],o=e[3];return r[0]=we(t[0],i,s),r[1]=we(t[1],n,o),r[2]=we(t[2],i,s),r[3]=we(t[3],n,o),r}function DJe(t,e){const r=(t[0]+t[2])/2,i=(t[1]+t[3])/2,n=Math.max(Math.abs(e[0]-r)-sl(t)/2,0),s=Math.max(Math.abs(e[1]-i)-Mc(t)/2,0);return Math.sqrt(n*n+s*s)}function Sz(t,e,r,i=t){return i[0]=t[0]+e,i[1]=t[1]+r,i[2]=t[2]+e,i[3]=t[3]+r,i}function kc(t){return t?c_(t,GZ):Ht(GZ)}function BZ(t){return t!=null&&t.length===4}function NJe(t){return!(sl(t)!==0&&isFinite(t[0])||Mc(t)!==0&&isFinite(t[1]))}function hT(t,e){return BZ(t)&&BZ(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const Wqt=[-1/0,-1/0,1/0,1/0],GZ=[1/0,1/0,-1/0,-1/0],FJe=[0,0,0,0];function PPe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function APe(t){return t.points!==void 0}function OPe(t){return t.x!==void 0&&t.y!==void 0}function MPe(t){return t.paths!==void 0}function RPe(t){return t.rings!==void 0}function $Pe(t){function e(r,i){return r==null?i:i==null?r:t(r,i)}return e}const Dv=$Pe(Math.min),Nv=$Pe(Math.max);function kJe(t,e){return MPe(e)?BP(t,e.paths,!1,!1):RPe(e)?BP(t,e.rings,!1,!1):APe(e)?rse(t,e.points,!1,!1,!1,!1):PPe(e)?LPe(t,e):(OPe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function $B(t){let e,r,i,n;for(t.reset(),e=i=1/0,r=n=-1/0;t.nextPath();){const s=IPe(t);e=Math.min(s[0],e),i=Math.min(s[1],i),r=Math.max(s[2],r),n=Math.max(s[3],n)}return Ht([e,i,r,n])}function IPe(t){let e,r,i,n;for(e=i=1/0,r=n=-1/0;t.nextPoint();)e=Math.min(t.x,e),i=Math.min(t.y,i),r=Math.max(t.x,r),n=Math.max(t.y,n);return Ht([e,i,r,n])}function Yqt(t,e){return MPe(e)?BP(t,e.paths,!0,!1):RPe(e)?BP(t,e.rings,!0,!1):APe(e)?rse(t,e.points,!0,!1,!0,!1):PPe(e)?LPe(t,e,!0,!1,!0,!1):(OPe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function BP(t,e,r,i){const n=r?3:2;if(!e.length||!e[0].length)return null;let s,o,a,l,[c,u]=e[0][0],[h,p]=e[0][0];for(let f=0;f<e.length;f++){const g=e[f];for(let y=0;y<g.length;y++){const v=g[y],[b,w]=v;if(c=Dv(c,b),u=Dv(u,w),h=Nv(h,b),p=Nv(p,w),r&&v.length>2){const x=v[2];s=Dv(s,x),o=Nv(o,x)}if(i&&v.length>n){const x=v[n];a=Dv(s,x),l=Nv(o,x)}}}return r?i?(t[0]=c,t[1]=u,t[2]=s,t[3]=a,t[4]=h,t[5]=p,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=u,t[2]=s,t[3]=h,t[4]=p,t[5]=o,t.length=6,t):i?(t[0]=c,t[1]=u,t[2]=a,t[3]=h,t[4]=p,t[5]=l,t.length=6,t):(t[0]=c,t[1]=u,t[2]=h,t[3]=p,t.length=4,t)}function LPe(t,e,r,i,n,s){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let u=e.zmin,h=e.zmax,p=e.mmin,f=e.mmax;return n?(u=u||0,h=h||0,s?(p=p||0,f=f||0,t[0]=o,t[1]=l,t[2]=u,t[3]=p,t[4]=a,t[5]=c,t[6]=h,t[7]=f,t):(t[0]=o,t[1]=l,t[2]=u,t[3]=a,t[4]=c,t[5]=h,t)):s?(p=p||0,f=f||0,t[0]=o,t[1]=l,t[2]=p,t[3]=a,t[4]=c,t[5]=f,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function rse(t,e,r,i,n,s){const o=r?3:2,a=i&&s,l=r&&n;if(!e.length||!e[0].length)return null;let c,u,h,p,[f,g]=e[0],[y,v]=e[0];for(let b=0;b<e.length;b++){const w=e[b],[x,S]=w;if(f=Dv(f,x),g=Dv(g,S),y=Nv(y,x),v=Nv(v,S),l&&w.length>2){const E=w[2];c=Dv(c,E),u=Nv(u,E)}if(a&&w.length>o){const E=w[o];h=Dv(c,E),p=Nv(u,E)}}return n?(c=c||0,u=u||0,s?(h=h||0,p=p||0,t[0]=f,t[1]=g,t[2]=c,t[3]=h,t[4]=y,t[5]=v,t[6]=u,t[7]=p,t):(t[0]=f,t[1]=g,t[2]=c,t[3]=y,t[4]=v,t[5]=u,t)):s?(h=h||0,p=p||0,t[0]=f,t[1]=g,t[2]=h,t[3]=y,t[4]=v,t[5]=p,t):(t[0]=f,t[1]=g,t[2]=y,t[3]=v,t)}function UJe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function zJe(t){return t.points!==void 0}function VJe(t){return t.x!==void 0&&t.y!==void 0}function BJe(t){return t.paths!==void 0}function GJe(t){return t.rings!==void 0}const ise=[];function DPe(t,e,r,i){return{xmin:t,ymin:e,xmax:r,ymax:i}}function NPe(t,e,r,i,n,s){return{xmin:t,ymin:e,zmin:r,xmax:i,ymax:n,zmax:s}}function FPe(t,e,r,i,n,s){return{xmin:t,ymin:e,mmin:r,xmax:i,ymax:n,mmax:s}}function kPe(t,e,r,i,n,s,o,a){return{xmin:t,ymin:e,zmin:r,mmin:i,xmax:n,ymax:s,zmax:o,mmax:a}}function nse(t,e=!1,r=!1){return e?r?kPe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):NPe(t[0],t[1],t[2],t[3],t[4],t[5]):r?FPe(t[0],t[1],t[2],t[3],t[4],t[5]):DPe(t[0],t[1],t[2],t[3])}function Xqt(t){return t?UJe(t)?t:VJe(t)?HJe(t):GJe(t)?UPe(t):BJe(t)?zPe(t):zJe(t)?jJe(t):null:null}function jJe(t){const{hasZ:e,hasM:r,points:i}=t;return nse(rse(ise,i,e??!1,r??!1),e,r)}function HJe(t){const{x:e,y:r,z:i,m:n}=t,s=n!=null;return i!=null?s?kPe(e,r,i,n,e,r,i,n):NPe(e,r,i,e,r,i):s?FPe(e,r,n,e,r,n):DPe(e,r,e,r)}function UPe(t){const{hasZ:e,hasM:r,rings:i}=t,n=BP(ise,i,e??!1,r??!1);return n?nse(n,e,r):null}function zPe(t){const{hasZ:e,hasM:r,paths:i}=t,n=BP(ise,i,e??!1,r??!1);return n?nse(n,e,r):null}var h6;function ape(t){return!Array.isArray(t[0])}let Jm=h6=class extends w_{static fromExtent(t){const e=t.clone().normalize(),r=t.spatialReference;let i=!1,n=!1;for(const o of e)o.hasZ&&(i=!0),o.hasM&&(n=!0);const s={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(s.hasZ=!0),n&&(s.hasM=!0),new h6(s)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){var o,a;let r,i,n=null,s=null;return t&&!Array.isArray(t)?(n=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),r=t.hasZ,i=t.hasM):n=t,n=n||[],e=e||Ve.WGS84,n.length&&((o=n[0])==null?void 0:o[0])!=null&&typeof n[0][0]=="number"&&(n=[n]),s=(a=n[0])==null?void 0:a[0],s&&(r===void 0&&i===void 0?(r=s.length>2,i=s.length>3):r===void 0?r=i?s.length>3:s.length>2:i===void 0&&(i=r?s.length>3:s.length>2)),{rings:n,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=xPe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new He;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=UPe(this);if(!e)return null;const r=new br(e);return r.spatialReference=t,r}get isSelfIntersecting(){return TXe(this.rings)}writeRings(t,e){e.rings=ae(this.rings)}addRing(t){if(!t)return;const e=this.rings,r=e.length;if(ape(t)){const i=[];for(let n=0,s=t.length;n<s;n++)i[n]=t[n].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new h6;return t.spatialReference=this.spatialReference,t.rings=ae(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;if(e!=null!=(r!=null)||e!=null&&r!=null&&!e.equals(r)||this.rings.length!==t.rings.length)return!1;const i=([n,s,o,a],[l,c,u,h])=>n===l&&s===c&&(o==null&&u==null||o===u)&&(a==null&&h==null||a===h);for(let n=0;n<this.rings.length;n++){const s=this.rings[n],o=t.rings[n];if(!ny(s,o,i))return!1}return!0}contains(t){if(!t)return!1;const e=sN(t,this.spatialReference);return fXe(this,e??t)}isClockwise(t){let e;return e=ape(t)?t.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):t,u6(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.rings[t][e],i=this.hasZ,n=this.hasM;return i&&!n?new He(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new He(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new He(r[0],r[1],r[2],r[3],this.spatialReference):new He(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(VP(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t].splice(e,0,r),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new He(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],r=this.spatialReference,i=e.map(n=>new He(n,r));return this.notifyChange("rings"),i}setPoint(t,e,r){return this._validateInputs(t,e)?(VP(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t][e]=r,this.notifyChange("rings"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const i=this.rings[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],Jm.prototype,"cache",null),d([m({readOnly:!0})],Jm.prototype,"centroid",null),d([m({readOnly:!0})],Jm.prototype,"extent",null),d([m({readOnly:!0})],Jm.prototype,"isSelfIntersecting",null),d([m({type:[[[Number]]],json:{write:{isRequired:!0}}})],Jm.prototype,"rings",void 0),d([nt("rings")],Jm.prototype,"writeRings",null),Jm=h6=d([F("esri.geometry.Polygon")],Jm),Jm.prototype.toJSON.isDefaultToJSON=!0;const ku=Jm;var jZ;function qJe(t){return!Array.isArray(t[0])}let R1=jZ=class extends w_{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){var o,a;let r,i,n=null,s=null;return t&&!Array.isArray(t)?(n=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),r=t.hasZ,i=t.hasM):n=t,n=n||[],e=e||Ve.WGS84,n.length&&((o=n[0])==null?void 0:o[0])!=null&&typeof n[0][0]=="number"&&(n=[n]),s=(a=n[0])==null?void 0:a[0],s&&(r===void 0&&i===void 0?(r=s.length>2,i=!1):r===void 0?r=!i&&s.length>3:i===void 0&&(i=!r&&s.length>3)),{paths:n,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=zPe(this);if(!e)return null;const r=new br(e);return r.spatialReference=t,r}writePaths(t,e){e.paths=ae(this.paths)}addPath(t){if(!t)return;const e=this.paths,r=e.length;if(qJe(t)){const i=[];for(let n=0,s=t.length;n<s;n++)i[n]=t[n].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new jZ;return t.spatialReference=this.spatialReference,t.paths=ae(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.paths[t][e],i=this.hasZ,n=this.hasM;return i&&!n?new He(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new He(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new He(r[0],r[1],r[2],r[3],this.spatialReference):new He(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(VP(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t].splice(e,0,r),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],r=this.spatialReference,i=e.map(n=>new He(n,r));return this.notifyChange("paths"),i}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new He(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(t,e,r){return this._validateInputs(t,e)?(VP(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t][e]=r,this.notifyChange("paths"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const i=this.paths[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],R1.prototype,"cache",null),d([m({readOnly:!0})],R1.prototype,"extent",null),d([m({type:[[[Number]]],json:{write:{isRequired:!0}}})],R1.prototype,"paths",void 0),d([nt("paths")],R1.prototype,"writePaths",null),R1=jZ=d([F("esri.geometry.Polyline")],R1),R1.prototype.toJSON.isDefaultToJSON=!0;const Ff=R1,qL=tc()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Zqt=tc()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function If(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function dT(t){return t.points!==void 0}function GP(t){return t.x!==void 0&&t.y!==void 0}function Lf(t){return t.paths!==void 0}function ol(t){return t.rings!==void 0}function Sb(t){return t==null?null:t instanceof w_?t:GP(t)?He.fromJSON(t):Lf(t)?Ff.fromJSON(t):ol(t)?ku.fromJSON(t):dT(t)?VA.fromJSON(t):If(t)?br.fromJSON(t):null}function BA(t){return t?GP(t)?"esriGeometryPoint":Lf(t)?"esriGeometryPolyline":ol(t)?"esriGeometryPolygon":If(t)?"esriGeometryEnvelope":dT(t)?"esriGeometryMultipoint":null:null}const WJe={esriGeometryPoint:He,esriGeometryPolyline:Ff,esriGeometryPolygon:ku,esriGeometryEnvelope:br,esriGeometryMultipoint:VA};function YJe(t){return t&&WJe[t]||null}const cN={base:w_,key:"type",typeMap:{extent:br,multipoint:VA,point:He,polyline:Ff,polygon:ku}};sy(cN);let VPe=0;const IB=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+VPe++})}};return e=d([F("esri.core.Identifiable")],e),e},Jqt=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:VPe++})}};return e=d([F("esri.core.NumericIdentifiable")],e),e};let lpe=class extends IB(class{}){};lpe=d([F("esri.core.Identifiable")],lpe);async function XJe(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:r}=await re(()=>import("./portalLayers-lCPM5pHW.js").then(i=>i.p),__vite__mapDeps([3,4]));try{return await r(e)}catch(i){const n=e&&e.portalItem,s=(n==null?void 0:n.id)||"unset",o=n&&n.portal&&n.portal.url||ai.portalUrl;throw K.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+s+"')",i),i}}let ZJe=0,Co=class extends Xn.EventedMixin(IB(ay)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new br(-180,-90,180,90,Ve.WGS84),this.id=Date.now().toString(16)+"-layer-"+ZJe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ve.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const r=typeof e=="string"?{url:e}:e;return(await re(()=>import("./arcgisLayers-L3R0nDq5.js"),__vite__mapDeps([5,6,4]))).fromUrl(r)}static fromPortalItem(e){return XJe(e)}initialize(){this.when().catch(e=>{on(e)||K.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const e=this.parent;if(e){const r=this;"layers"in e&&e.layers.includes(r)?e.layers.remove(r):"tables"in e&&e.tables.includes(r)?e.tables.remove(r):"baseLayers"in e&&e.baseLayers.includes(r)?e.baseLayers.remove(r):"referenceLayers"in e&&e.referenceLayers.includes(r)&&e.referenceLayers.remove(r),this._set("parent",null)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return xs(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Vt(e,{query:{f:"json"},responseType:"json"})).data;throw new B("layer:no-attribution-data","Layer does not have attribution data")}};d([m({type:String})],Co.prototype,"attributionDataUrl",void 0),d([m({type:br})],Co.prototype,"fullExtent",void 0),d([m({readOnly:!0})],Co.prototype,"hasAttributionData",null),d([m({type:String,clonable:!1})],Co.prototype,"id",void 0),d([m({type:Boolean,nonNullable:!0})],Co.prototype,"legendEnabled",void 0),d([m({type:["show","hide","hide-children"]})],Co.prototype,"listMode",void 0),d([m({type:Number,range:{min:0,max:1},nonNullable:!0})],Co.prototype,"opacity",void 0),d([m({clonable:!1})],Co.prototype,"parent",void 0),d([m({readOnly:!0})],Co.prototype,"parsedUrl",null),d([m({type:Boolean,readOnly:!0})],Co.prototype,"persistenceEnabled",void 0),d([m({type:Boolean})],Co.prototype,"popupEnabled",void 0),d([m({type:Boolean})],Co.prototype,"attributionVisible",void 0),d([m({type:Ve})],Co.prototype,"spatialReference",void 0),d([m({type:String})],Co.prototype,"title",void 0),d([m({readOnly:!0,json:{read:!1}})],Co.prototype,"type",void 0),d([m()],Co.prototype,"url",void 0),d([m({type:Boolean,nonNullable:!0})],Co.prototype,"visible",void 0),Co=d([F("esri.layers.Layer")],Co);const LB=Co;function HZ(t,e,r){let i,n;if(t)for(let s=0,o=t.length;s<o;s++){if(i=t.at(s),(i==null?void 0:i[e])===r)return i;if((i==null?void 0:i.type)==="group"&&(n=HZ(i.layers,e,r),n))return n}}const JJe=t=>{let e=class extends t{constructor(...r){super(...r),this.layers=new St;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},n=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||K.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},s=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>n(o.item)),this.layers.on("after-remove",o=>s(o.item))])}destroy(){const r=this.layers.toArray();for(const i of r)i.destroy();this.layers.destroy()}set layers(r){this._set("layers",kT(r,this._get("layers")))}add(r,i){const n=this.layers;if(i=n.getNextIndex(i),r instanceof LB){const s=r;s.parent===this?this.reorder(s,i):n.add(s,i)}else Xu(r)?r.then(s=>{this.destroyed||this.add(s,i)}):K.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const n=this.layers;let s=n.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(n.add(o,s),s+=1):this.reorder(o,s)})}findLayerById(r){return HZ(this.layers,"id",r)}findLayerByUid(r){return HZ(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return d([m()],e.prototype,"layers",null),e=d([F("esri.support.LayersMixin")],e),e};function qZ(t,e,r){if(t)for(let i=0,n=t.length;i<n;i++){const s=t.at(i);if(s[e]===r)return s;if((s==null?void 0:s.type)==="group"){const o=qZ(s.tables,e,r);if(o)return o}}}const QJe=t=>{let e=class extends t{constructor(...r){super(...r),this.tables=new St,this.addHandles([this.tables.on("after-add",i=>{const n=i.item;n.parent&&n.parent!==this&&"tables"in n.parent&&n.parent.tables.remove(n),n.parent=this,n.type!=="feature"&&K.getLogger(this).error(`Layer 'title:${n.title}, id:${n.id}' of type '${n.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})])}destroy(){const r=this.tables.toArray();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",kT(r,this._get("tables")))}findTableById(r){return qZ(this.tables,"id",r)}findTableByUid(r){return qZ(this.tables,"uid",r)}};return d([m()],e.prototype,"tables",null),e=d([F("esri.support.TablesMixin")],e),e};let Hp=class extends QJe(JJe(Xn.EventedMixin(Pe))){constructor(e){super(e),this.allLayers=new FP({getCollections:()=>{var r,i,n;return[(r=this.basemap)==null?void 0:r.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(n=this.basemap)==null?void 0:n.referenceLayers]},getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=bJe(this),this.basemap=null,this.editableLayers=new FP({getCollections:()=>[this.allLayers],itemFilterFunction:FZe}),this.ground=new wz,this._basemapCache=yJe()}destroy(){_Je(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=Me(this.basemap),Me(this.ground),this._set("ground",null)}castBasemap(e){return vJe(e,this._basemapCache)}castGround(e){return wJe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};d([m({readOnly:!0,dependsOn:[]})],Hp.prototype,"allLayers",void 0),d([m({readOnly:!0})],Hp.prototype,"allTables",void 0),d([m({type:mI,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Hp.prototype,"basemap",void 0),d([Dr("basemap")],Hp.prototype,"castBasemap",null),d([m({readOnly:!0})],Hp.prototype,"editableLayers",void 0),d([m({type:wz,nonNullable:!0})],Hp.prototype,"ground",void 0),d([Dr("ground")],Hp.prototype,"castGround",null),d([m()],Hp.prototype,"undoRedo",void 0),Hp=d([F("esri.Map")],Hp);const BPe=Hp;function pe(t,e,r={}){return sse(t,e,r,GPe)}function up(t,e,r={}){return sse(t,e,r,jPe)}function sse(t,e,r={},i){let n=null;const s=r.once?(o,a)=>{i(o)&&(Pi(n),e(o,a))}:(o,a)=>{i(o)&&e(o,a)};if(n=Lqe(t,s,r.sync,r.equals),r.initial){const o=t();s(o,o)}return n}function jo(t,e,r,i={}){let n=null,s=null,o=null;function a(){var u;n&&s&&(s.remove(),(u=i.onListenerRemove)==null||u.call(i,n),n=null,s=null)}function l(u){i.once&&i.once&&Pi(o),r(u)}const c=pe(t,(u,h)=>{var p;a(),tB(u)&&(n=u,s=NA(u,e,l),(p=i.onListenerAdd)==null||p.call(i,u))},{sync:i.sync,initial:!0});return o=ri(()=>{c.remove(),a()}),o}function qT(t,e){return KJe(t,jPe,e)}function KJe(t,e,r){if(Ms(r))return Promise.reject(gr());const i=t();if(e!=null&&e(i))return Promise.resolve(i);let n=null;function s(){n=Pi(n)}return new Promise((o,a)=>{n=DT([la(r,()=>{s(),a(gr())}),sse(t,l=>{s(),o(l)},{sync:!1,once:!0},e??GPe)])})}function GPe(t){return!0}function jPe(t){return!!t}function eQe(t,e){const r=new St,i=jo(t,"after-splice",({added:n,start:s,deleteCount:o})=>{const a=r.splice(s,o);for(const l of a)l.remove();if(n!=null&&n.length){const l=n.map(e);r.addMany(l,s)}},{sync:!0,onListenerRemove:()=>r.drain(n=>n.remove()),onListenerAdd:n=>r.addMany(n.items.map(e))});return r.addHandles(i),r}function tWt(t,e){const r=new St,i=eQe(t,a=>b_(async l=>{const c=await e(a,l);if(Ms(l))throw c.remove(),gr();return c})),n=()=>null,s=async a=>{const l=await a.promise,c=i.indexOf(a);c<0||r.splice(c,1,l)};r.addMany(i.items.map(n));for(const a of i)IL(s(a));const o=i.on("after-splice",({added:a,start:l,deleteCount:c})=>{const u=r.splice(l,c);for(const h of u)h==null||h.remove();if(a!=null&&a.length){r.addMany(a.map(n),l);for(const h of a)IL(s(h))}});return r.addHandles([HEe(i),o]),r}const ei={sync:!0},mi={initial:!0},li={sync:!0,initial:!0};function gi(){return[1,0,0,0,1,0,0,0,1]}function HPe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function yI(t,e,r,i,n,s,o,a,l){return[t,e,r,i,n,s,o,a,l]}function tQe(t,e){return new Float64Array(t,e,9)}const y2=gi();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:y2,clone:HPe,create:gi,createView:tQe,fromValues:yI},Symbol.toStringTag,{value:"Module"}));function Gc(){return[0,0,0,1]}function rQe(t){return[t[0],t[1],t[2],t[3]]}function iQe(t,e,r,i){return[t,e,r,i]}function nQe(t,e){return new Float64Array(t,e,4)}const DB=Gc();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:DB,clone:rQe,create:Gc,createView:nQe,fromValues:iQe},Symbol.toStringTag,{value:"Module"}));function qd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function sQe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function pn(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function ose(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function qPe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function WPe(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function YPe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function oQe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function aQe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function lQe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function cQe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function uQe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function WT(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function hQe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function XPe(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(r*r+i*i+n*n+s*s)}function Tz(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return r*r+i*i+n*n+s*s}function ase(t){const e=t[0],r=t[1],i=t[2],n=t[3];return Math.sqrt(e*e+r*r+i*i+n*n)}function lse(t){const e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function dQe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function pQe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function ZPe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3];let o=r*r+i*i+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=n*o,t[3]=s*o),t}function JPe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function NB(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function fQe(t,e){const r=oN;let i,n,s,o,a,l;e=e||1;do i=2*r()-1,n=2*r()-1,a=i*i+n*n;while(a>=1);do s=2*r()-1,o=2*r()-1,l=s*s+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*i,t[1]=e*n,t[2]=e*s*c,t[3]=e*o*c,t}function Mu(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*o,t[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*o,t[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*o,t[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*o,t}function mQe(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2],c=r[3],u=c*i+a*s-l*n,h=c*n+l*i-o*s,p=c*s+o*n-a*i,f=-o*i-a*n-l*s;return t[0]=u*c+f*-o+h*-l-p*-a,t[1]=h*c+f*-a+p*-o-u*-l,t[2]=p*c+f*-l+u*-a-h*-o,t[3]=e[3],t}function gQe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function z3(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function YT(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=ml();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))}const yQe=qPe,_Qe=WPe,vQe=YPe,bQe=XPe,wQe=Tz,xQe=ase,SQe=lse,QPe=Object.freeze(Object.defineProperty({__proto__:null,add:ose,ceil:oQe,copy:qd,copyVec3:sQe,dist:bQe,distance:XPe,div:vQe,divide:YPe,dot:JPe,equals:YT,exactEquals:z3,floor:aQe,inverse:pQe,len:xQe,length:ase,lerp:NB,max:cQe,min:lQe,mul:_Qe,multiply:WPe,negate:dQe,normalize:ZPe,random:fQe,round:uQe,scale:WT,scaleAndAdd:hQe,set:pn,sqrDist:wQe,sqrLen:SQe,squaredDistance:Tz,squaredLength:lse,str:gQe,sub:yQe,subtract:qPe,transformMat4:Mu,transformQuat:mQe},Symbol.toStringTag,{value:"Module"}));function TQe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function jP(t,e,r){r*=.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function FB(t,e){const r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>ml()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function kB(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*u+o*a+n*c-s*l,t[1]=n*u+o*l+s*a-i*c,t[2]=s*u+o*c+i*l-n*a,t[3]=o*u-i*a-n*l-s*c,t}function EQe(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*a,t[1]=n*l+s*a,t[2]=s*l-n*a,t[3]=o*l-i*a,t}function CQe(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l-s*a,t[1]=n*l+o*a,t[2]=s*l+i*a,t[3]=o*l-n*a,t}function PQe(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*a,t[1]=n*l-i*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function AQe(t,e){const r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t}function d6(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3];let l,c,u,h,p,f=r[0],g=r[1],y=r[2],v=r[3];return c=n*f+s*g+o*y+a*v,c<0&&(c=-c,f=-f,g=-g,y=-y,v=-v),1-c>ml()?(l=Math.acos(c),u=Math.sin(l),h=Math.sin((1-i)*l)/u,p=Math.sin(i*l)/u):(h=1-i,p=i),t[0]=h*n+p*f,t[1]=h*s+p*g,t[2]=h*o+p*y,t[3]=h*a+p*v,t}function OQe(t){const e=oN,r=e(),i=e(),n=e(),s=Math.sqrt(1-r),o=Math.sqrt(r);return t[0]=s*Math.sin(2*Math.PI*i),t[1]=s*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*n),t[3]=o*Math.cos(2*Math.PI*n),t}function MQe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r*r+i*i+n*n+s*s,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-n*a,t[3]=s*a,t}function lb(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function KPe(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const s=(n+1)%3,o=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*o+o]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*s+o]-e[3*o+s])*i,t[s]=(e[3*s+n]+e[3*n+s])*i,t[o]=(e[3*o+n]+e[3*n+o])*i}return t}function RQe(t,e,r,i){const n=.5*Math.PI/180;e*=n,r*=n,i*=n;const s=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return t[0]=s*l*u-o*a*c,t[1]=o*a*u+s*l*c,t[2]=o*l*c-s*a*u,t[3]=o*l*u+s*a*c,t}function $Qe(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const IQe=qd,eAe=pn,LQe=ose,DQe=kB,NQe=WT,FQe=JPe,kQe=NB,tAe=ase,UQe=tAe,rAe=lse,zQe=rAe,cse=ZPe,VQe=z3,BQe=YT;function GQe(t,e,r){const i=fe(e,r);return i<-.999999?(it(Cm,jQe,e),uu(Cm)<1e-6&&it(Cm,HQe,e),me(Cm,Cm),jP(t,Cm,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(it(Cm,e,r),t[0]=Cm[0],t[1]=Cm[1],t[2]=Cm[2],t[3]=1+i,cse(t,t))}const Cm=C(),jQe=Ce(1,0,0),HQe=Ce(0,1,0);function qQe(t,e,r,i,n,s){return d6(cpe,e,n,s),d6(upe,r,i,s),d6(t,cpe,upe,2*s*(1-s)),t}const cpe=Gc(),upe=Gc();function WQe(t,e,r,i){const n=YQe;return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],cse(t,KPe(t,n))}const YQe=gi();Object.freeze(Object.defineProperty({__proto__:null,add:LQe,calculateW:AQe,conjugate:lb,copy:IQe,dot:FQe,equals:BQe,exactEquals:VQe,fromEuler:RQe,fromMat3:KPe,getAxisAngle:FB,identity:TQe,invert:MQe,len:UQe,length:tAe,lerp:kQe,mul:DQe,multiply:kB,normalize:cse,random:OQe,rotateX:EQe,rotateY:CQe,rotateZ:PQe,rotationTo:GQe,scale:NQe,set:eAe,setAxes:WQe,setAxisAngle:jP,slerp:d6,sqlerp:qQe,sqrLen:zQe,squaredLength:rAe,str:$Qe},Symbol.toStringTag,{value:"Module"}));function tr(){return[0,0,0,0]}function uN(t){return[t[0],t[1],t[2],t[3]]}function Xt(t,e,r,i){return[t,e,r,i]}function use(t,e=tr()){const r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function XQe(t,e){return new Float64Array(t,e,4)}function iAe(){return tr()}function nAe(){return Xt(1,1,1,1)}function sAe(){return Xt(1,0,0,0)}function oAe(){return Xt(0,1,0,0)}function aAe(){return Xt(0,0,1,0)}function lAe(){return Xt(0,0,0,1)}const Fh=iAe(),Bd=nAe(),ZQe=sAe(),JQe=oAe(),QQe=aAe(),KQe=lAe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Bd,UNIT_W:KQe,UNIT_X:ZQe,UNIT_Y:JQe,UNIT_Z:QQe,ZEROS:Fh,clone:uN,create:tr,createView:XQe,fromArray:use,fromValues:Xt,ones:nAe,unitW:lAe,unitX:sAe,unitY:oAe,unitZ:aAe,zeros:iAe},Symbol.toStringTag,{value:"Module"}));function vm(t=hAe){return[t[0],t[1],t[2],t[3]]}function p6(t,e,r=vm()){return he(r,t),r[3]=e,r}function hpe(t,e,r=tr()){return it(r,t,e),me(r,r),r[3]=-q3e(t,e),r}function cAe(t,e=vm()){const r=tPe(JM,t);return uAe(e,ul(FB(e,r))),e}function dpe(t,e,r=vm()){return jP(JM,t,WL(t)),jP(ppe,e,WL(e)),kB(JM,ppe,JM),uAe(r,ul(FB(r,JM)))}function eKe(t,e,r,i=vm()){return p6(Wne,t,k4),p6(Yne,e,fpe),p6(LP,r,mpe),dpe(k4,fpe,k4),dpe(k4,mpe,i),i}function tKe(t){return t[3]}function WL(t){return Ut(t[3])}function uAe(t,e){return t[3]=e,t}const hAe=[0,0,1,0],JM=Gc(),ppe=Gc();vm();const k4=vm(),fpe=vm(),mpe=vm();let $O=null,Ez=!0;function kj(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(Ez)try{return new ImageData(t,e)}catch{Ez=!1}return dAe(t,e,r)}function rKe(t,e,r,i){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(Ez)try{return new ImageData(t,e,r)}catch{Ez=!1}const n=dAe(e,r,i);return n.data.set(t,0),n}function iKe(){return $O||($O=document.createElement("canvas"),$O.width=1,$O.height=1),$O}function dAe(t,e,r){return r||(r=iKe()),r.getContext("2d").createImageData(t,e)}async function nKe(t,e){const r=window.URL.createObjectURL(t);try{const{data:i}=await Vt(r,{...e,responseType:"image"});return i}catch(i){throw on(i)?i:new B("invalid-image",`Could not fetch requested image at ${r}`)}finally{window.URL.revokeObjectURL(r)}}async function rWt(t,e){const{arrayBuffer:r,mediaType:i}=await sKe(t,e),n=i==="image/png";if(i==="image/gif"){const{isAnimatedGIF:s,parseGif:o}=await re(()=>import("./gif-DkoG5nkP.js"),__vite__mapDeps([]));if(s(r))return o(r,e)}if(n){const{isAnimatedPNG:s,parseApng:o}=await re(()=>import("./apng-BePJ6TEN.js"),__vite__mapDeps([]));if(s(r))return o(r,e)}return nKe(new Blob([r],{type:i}),e)}async function sKe(t,e){var n;const r=bb(t);if(r!=null&&r.isBase64)return{arrayBuffer:FCe(r.data),mediaType:r.mediaType};const i=await Vt(t,{responseType:"array-buffer",...e});return{arrayBuffer:i.data,mediaType:((n=i.getHeader)==null?void 0:n.call(i,"Content-Type"))??""}}var QE;const Uj=new WeakMap;let oKe=0,Qm=QE=class extends Se{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,i){if(t instanceof HTMLImageElement){const n={type:"image-element",src:l_(t.src,i),crossOrigin:t.crossOrigin};e[r]=n}else if(t instanceof HTMLCanvasElement){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),s={type:"canvas-element",imageData:this._encodeImageData(n)};e[r]=s}else if(t instanceof HTMLVideoElement){const n={type:"video-element",src:l_(t.src,i),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=n}else if(t instanceof ImageData){const n={type:"image-data",imageData:this._encodeImageData(t)};e[r]=n}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),i=e.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(Uj.has(this.data)||Uj.set(this.data,++oKe),e(Uj.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new QE(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return rKe(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new QE({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new QE({data:t}):s_(QE,t)}};d([m({type:String,json:{write:xb}})],Qm.prototype,"url",null),d([m({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),m()],Qm.prototype,"data",null),d([nt("data")],Qm.prototype,"writeData",null),d([Xe("data")],Qm.prototype,"readData",null),d([m({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Qm.prototype,"transparent",null),d([m({json:{write:!0}})],Qm.prototype,"wrap",void 0),d([m({readOnly:!0})],Qm.prototype,"contentHash",null),Qm=QE=d([F("esri.geometry.support.MeshTexture")],Qm);const _I=Qm,ds=t=>{let e=class extends t{clone(){var l;const r=$s(this);JD(r,"unable to clone instance of non-accessor class");const i=r.metadata,n=r.store,s={},o=new Map;for(const c in i){const u=i[c],h=n==null?void 0:n.originOf(c),p=u.clonable;if(u.readOnly||p===!1||h!==We.USER&&h!==We.DEFAULTS&&h!==We.WEB_MAP&&h!==We.WEB_SCENE)continue;const f=this[c];let g=null;g=typeof p=="function"?p(f):p==="reference"?f:qX(f),f!=null&&g==null||(h===We.DEFAULTS?o.set(c,g):s[c]=g)}const a=new(Object.getPrototypeOf(this)).constructor(s);if(o.size){const c=(l=$s(a))==null?void 0:l.store;if(c)for(const[u,h]of o)c.set(u,h,We.DEFAULTS)}return a}};return e=d([F("esri.core.Clonable")],e),e};let Tb=class extends ds(Pe){};Tb=d([F("esri.core.Clonable")],Tb);let KE=class extends ds(Se){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};d([m({type:[Number],nonNullable:!0,json:{write:!0}})],KE.prototype,"offset",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],KE.prototype,"rotation",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],KE.prototype,"scale",void 0),KE=d([F("esri.geometry.support.MeshTextureTransform")],KE);const V3=KE;var WZ;let qp=WZ=class extends Se{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new WZ(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}clonePropertiesWithDeduplication(t){var e,r,i,n;return{color:this.color!=null?this.color.clone():null,colorTexture:(e=this.colorTexture)==null?void 0:e.cloneWithDeduplication(t),normalTexture:(r=this.normalTexture)==null?void 0:r.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(i=this.colorTextureTransform)==null?void 0:i.clone(),normalTextureTransform:(n=this.normalTextureTransform)==null?void 0:n.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};d([m({type:De,json:{write:!0}})],qp.prototype,"color",void 0),d([m({type:_I,json:{write:!0}})],qp.prototype,"colorTexture",void 0),d([m({type:V3,json:{write:!0}})],qp.prototype,"colorTextureTransform",void 0),d([m({type:_I,json:{write:!0}})],qp.prototype,"normalTexture",void 0),d([m({type:V3,json:{write:!0}})],qp.prototype,"normalTextureTransform",void 0),d([m({nonNullable:!0,json:{write:!0}})],qp.prototype,"alphaMode",void 0),d([m({nonNullable:!0,json:{write:!0}})],qp.prototype,"alphaCutoff",void 0),d([m({nonNullable:!0,json:{write:!0}})],qp.prototype,"doubleSided",void 0),qp=WZ=d([F("esri.geometry.support.MeshMaterial")],qp);const hse=qp;var YZ;let ud=YZ=class extends hse{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new YZ(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){var e,r,i,n,s,o,a;return{...super.clonePropertiesWithDeduplication(t),emissiveColor:(e=this.emissiveColor)==null?void 0:e.clone(),emissiveTexture:(r=this.emissiveTexture)==null?void 0:r.cloneWithDeduplication(t),emissiveTextureTransform:(i=this.emissiveTextureTransform)==null?void 0:i.clone(),occlusionTexture:(n=this.occlusionTexture)==null?void 0:n.cloneWithDeduplication(t),occlusionTextureTransform:(s=this.occlusionTextureTransform)==null?void 0:s.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(o=this.metallicRoughnessTexture)==null?void 0:o.cloneWithDeduplication(t),metallicRoughnessTextureTransform:(a=this.metallicRoughnessTextureTransform)==null?void 0:a.clone()}}};d([m({type:De,json:{write:!0}})],ud.prototype,"emissiveColor",void 0),d([m({type:_I,json:{write:!0}})],ud.prototype,"emissiveTexture",void 0),d([m({type:V3,json:{write:!0}})],ud.prototype,"emissiveTextureTransform",void 0),d([m({type:_I,json:{write:!0}})],ud.prototype,"occlusionTexture",void 0),d([m({type:V3,json:{write:!0}})],ud.prototype,"occlusionTextureTransform",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],ud.prototype,"metallic",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],ud.prototype,"roughness",void 0),d([m({type:_I,json:{write:!0}})],ud.prototype,"metallicRoughnessTexture",void 0),d([m({type:V3,json:{write:!0}})],ud.prototype,"metallicRoughnessTextureTransform",void 0),ud=YZ=d([F("esri.geometry.support.MeshMaterialMetallicRoughness")],ud);const dse=ud;var f6;let zl=f6=class extends Se{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return eC(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},K.getLogger(this))}castPosition(t){return t&&t instanceof Float32Array&&K.getLogger(this).warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),eC(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},K.getLogger(this))}castUv(t){return eC(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},K.getLogger(this))}castNormal(t){return eC(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},K.getLogger(this))}castTangent(t){return eC(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},K.getLogger(this))}clone(){const t={position:ae(this.position),uv:ae(this.uv),normal:ae(this.normal),tangent:ae(this.tangent),color:ae(this.color)};return new f6(t)}clonePositional(){const t={position:ae(this.position),normal:ae(this.normal),tangent:ae(this.tangent),uv:this.uv,color:this.color};return new f6(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function zj(t,e,r,i){const{loggerTag:n,stride:s}=e;return t.length%s!=0?(i.error(n,`Invalid array length, expected a multiple of ${s}`),new r([])):t}function eC(t,e,r,i,n){if(!t)return t;if(t instanceof e)return zj(t,i,e,n);for(const s of r)if(t instanceof s)return zj(new e(t),i,e,n);if(Array.isArray(t))return zj(new e(t),i,e,n);{const s=r.map(o=>`'${o.name}'`);return n.error(`Failed to set property, expected one of ${s}, but got ${t.constructor.name}`),new e([])}}function IO(t,e,r){e[r]=aKe(t)}function aKe(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}d([m({json:{write:IO}})],zl.prototype,"color",void 0),d([Dr("color")],zl.prototype,"castColor",null),d([m({nonNullable:!0,json:{write:IO}})],zl.prototype,"position",void 0),d([Dr("position")],zl.prototype,"castPosition",null),d([m({json:{write:IO}})],zl.prototype,"uv",void 0),d([Dr("uv")],zl.prototype,"castUv",null),d([m({json:{write:IO}})],zl.prototype,"normal",void 0),d([Dr("normal")],zl.prototype,"castNormal",null),d([m({json:{write:IO}})],zl.prototype,"tangent",void 0),d([Dr("tangent")],zl.prototype,"castTangent",null),zl=f6=d([F("esri.geometry.support.MeshVertexAttributes")],zl);var QM;let Km=QM=class extends Se{static from(t){return s_(QM,t)}constructor(t){super(t),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return eC(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},K.getLogger(this))}castMaterial(t){return s_(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?dse:hse,t)}clone(){return new QM({faces:ae(this.faces),shading:this.shading,material:ae(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(t,e){const r={faces:ae(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new QM(r)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};d([m({json:{write:!0}})],Km.prototype,"faces",void 0),d([Dr("faces")],Km.prototype,"castFaces",null),d([m({type:hse,json:{write:!0}})],Km.prototype,"material",void 0),d([Dr("material")],Km.prototype,"castMaterial",null),d([m()],Km.prototype,"name",void 0),d([m({type:String,json:{write:!0}})],Km.prototype,"shading",void 0),d([m({type:Boolean})],Km.prototype,"trustSourceNormals",void 0),Km=QM=d([F("esri.geometry.support.MeshComponent")],Km);const Eb=Km,lKe="Mesh must be loaded before applying operations",cKe="Provided component is not part of the list of components",uKe="Expected polygon to be a Polygon instance",KM="Expected location to be a Point instance";let gpe=class extends B{constructor(){super("invalid-input:location",KM)}},eR=class extends ds(Se){constructor(e){super(e),this.type="georeferenced",this.origin=null}};d([gt({georeferenced:"georeferenced"},{readOnly:!0})],eR.prototype,"type",void 0),d([m({type:[Number],nonNullable:!1,json:{write:!0}})],eR.prototype,"origin",void 0),eR=d([F("esri.geometry.support.MeshGeoreferencedVertexSpace")],eR);const N0=eR;let tR=class extends ds(Se){constructor(e){super(e),this.type="local",this.origin=C()}};d([gt({local:"local"},{readOnly:!0})],tR.prototype,"type",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],tR.prototype,"origin",void 0),tR=d([F("esri.geometry.support.MeshLocalVertexSpace")],tR);const vI=tR;function xe(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function HP(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function pse(t,e,r,i,n,s,o,a,l,c,u,h,p,f,g,y){return[t,e,r,i,n,s,o,a,l,c,u,h,p,f,g,y]}function hKe(t,e){return new Float64Array(t,e,16)}const fn=xe();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:fn,clone:HP,create:xe,createView:hKe,fromValues:pse},Symbol.toStringTag,{value:"Module"}));var XZ;let eg=XZ=class extends Se{constructor(t){super(t),this.translation=C(),this.rotationAxis=Ka(hAe),this.rotationAngle=0,this.scale=Ce(1,1,1)}get rotation(){return p6(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=nn(t),this.rotationAngle=tKe(t)}get localMatrix(){const t=xe();return jP(ype,this.rotation,WL(this.rotation)),rPe(t,ype,this.translation,this.scale),t}get localMatrixInverse(){return us(xe(),this.localMatrix)}applyLocal(t,e){return ze(e,t,this.localMatrix)}applyLocalInverse(t,e){return ze(e,t,this.localMatrixInverse)}equals(t){return this===t||t!=null&&Kne(this.localMatrix,t.localMatrix)}clone(){const t={translation:nn(this.translation),rotationAxis:nn(this.rotationAxis),rotationAngle:this.rotationAngle,scale:nn(this.scale)};return new XZ(t)}};d([m({type:[Number],nonNullable:!0,json:{write:!0}})],eg.prototype,"translation",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],eg.prototype,"rotationAxis",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],eg.prototype,"rotationAngle",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],eg.prototype,"scale",void 0),d([m()],eg.prototype,"rotation",null),d([m()],eg.prototype,"localMatrix",null),d([m()],eg.prototype,"localMatrixInverse",null),eg=XZ=d([F("esri.geometry.support.MeshTransform")],eg);const ype=Gc(),XT=eg,fse=()=>K.getLogger("esri.views.3d.support.buffer.math");function dKe(t,e,r){am(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function am(t,e,r,i=3,n=i){if(t.length/i!==Math.ceil(e.length/n))return t;const s=t.length/i,o=r[0],a=r[1],l=r[2],c=r[4],u=r[5],h=r[6],p=r[8],f=r[9],g=r[10],y=r[12],v=r[13],b=r[14];let w=0,x=0;for(let S=0;S<s;S++){const E=e[w],P=e[w+1],M=e[w+2];t[x]=o*E+c*P+p*M+y,t[x+1]=a*E+u*P+f*M+v,t[x+2]=l*E+h*P+g*M+b,w+=n,x+=i}return t}function pAe(t,e,r){lm(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function lm(t,e,r,i=3,n=i){if(t.length/i!==Math.ceil(e.length/n))return void fse().error("source and destination buffers need to have the same number of elements");const s=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],p=r[6],f=r[7],g=r[8];let y=0,v=0;for(let b=0;b<s;b++){const w=e[y],x=e[y+1],S=e[y+2];t[v]=o*w+c*x+p*S,t[v+1]=a*w+u*x+f*S,t[v+2]=l*w+h*x+g*S,y+=n,v+=i}}function pKe(t,e,r){Cz(t.typedBuffer,e,r,t.typedBufferStride)}function Cz(t,e,r,i=3){const n=Math.min(t.length/i,e.count),s=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<n;c++)t[l]=r*s[a],t[l+1]=r*s[a+1],t[l+2]=r*s[a+2],a+=o,l+=i}function mse(t,e,r,i=3,n=i){const s=t.length/i;if(s!==Math.ceil(e.length/n))return t;let o=0,a=0;for(let l=0;l<s;l++)t[a]=e[o]+r[0],t[a+1]=e[o+1]+r[1],t[a+2]=e[o+2]+r[2],o+=n,a+=i;return t}function fKe(t,e){UB(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function UB(t,e,r=3,i=r){const n=Math.min(t.length/r,e.length/i);let s=0,o=0;for(let a=0;a<n;a++){const l=e[s],c=e[s+1],u=e[s+2],h=l*l+c*c+u*u;if(h>0){const p=1/Math.sqrt(h);t[o]=p*l,t[o+1]=p*c,t[o+2]=p*u}s+=i,o+=r}}function mKe(t,e,r){const i=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let u=0;u<i;u++)n[c]=o[l]>>r,n[c+1]=o[l+1]>>r,n[c+2]=o[l+2]>>r,l+=a,c+=s}Object.freeze(Object.defineProperty({__proto__:null,normalize:UB,normalizeView:fKe,scale:Cz,scaleView:pKe,shiftRight:mKe,transformMat3:lm,transformMat3View:pAe,transformMat4:am,transformMat4View:dKe,translate:mse},Symbol.toStringTag,{value:"Module"}));function _pe(){return K.getLogger("esri.geometry.Mesh")}function lWt(t){const{vertexSpace:e}=t;if(e.origin!=null)return t.clone();const{anchor:r}=t,i=r.clone(),n=new N0({origin:[i.x,i.y,i.z]}),s=t.cloneWithVertexSpace(n),{position:o}=s.vertexAttributes;return s.vertexAttributes.position=mse(new Float64Array(o.length),o,[-i.x,-i.y,-(i.z??0)]),s.vertexAttributesChanged(),s}function cm(t){return t.origin!=null}function fAe(t){return cm(t.vertexSpace)}function Pz(t,e){if(!cm(t))return null;const[r,i,n]=t.origin;return new He({x:r,y:i,z:n,spatialReference:e})}function gKe(t,e){const{x:r,y:i,z:n,spatialReference:s}=t,o=[r,i,n??0];if((e==null?void 0:e.geographic)!==void 0){if(yb(_pe(),"option: geographic",{replacement:"use vertexSpace option instead",version:"4.29",warnOnce:!0}),!(e!=null&&e.vertexSpace))return e!=null&&e.geographic?new vI({origin:o}):new N0({origin:o});_pe().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")}if(!(e!=null&&e.vertexSpace))return s.isGeographic||s.isWebMercator?new vI({origin:o}):new N0({origin:o});switch(e.vertexSpace){case"local":return new vI({origin:o});case"georeferenced":return new N0({origin:o});case"georeferenced-absolute":return new N0}}function vpe(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}function bpe(t,e){return t==="local"?new vI({origin:e}):new N0({origin:e})}var wpe={},cWt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof wpe<"u"?wpe:typeof self<"u"?self:{};function hN(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var xpe,Spe,Tpe,mAe={exports:{}};xpe=mAe,Spe=function(){function t(D,I,k){k=k||2;var j,q,Q,ie,ye,Ae,Ze,Et=I&&I.length,xt=Et?I[0]*k:D.length,Qe=e(D,0,xt,k,!0),Ke=[];if(!Qe||Qe.next===Qe.prev)return Ke;if(Et&&(Qe=l(D,I,Qe,k)),D.length>80*k){j=Q=D[0],q=ie=D[1];for(var Ge=k;Ge<xt;Ge+=k)(ye=D[Ge])<j&&(j=ye),(Ae=D[Ge+1])<q&&(q=Ae),ye>Q&&(Q=ye),Ae>ie&&(ie=Ae);Ze=(Ze=Math.max(Q-j,ie-q))!==0?1/Ze:0}return i(Qe,Ke,k,j,q,Ze),Ke}function e(D,I,k,j,q){var Q,ie;if(q===le(D,I,k,j)>0)for(Q=I;Q<k;Q+=j)ie=J(Q,D[Q],D[Q+1],ie);else for(Q=k-j;Q>=I;Q-=j)ie=J(Q,D[Q],D[Q+1],ie);if(ie&&E(ie,ie.next)){var ye=ie.next;Y(ie),ie=ye}return ie}function r(D,I){if(!D)return D;I||(I=D);var k,j=D;do if(k=!1,j.steiner||!E(j,j.next)&&S(j.prev,j,j.next)!==0)j=j.next;else{var q=j.prev;if(Y(j),(j=I=q)===j.next)break;k=!0}while(k||j!==I);return I}function i(D,I,k,j,q,Q,ie){if(D){!ie&&Q&&g(D,j,q,Q);for(var ye,Ae,Ze=D;D.prev!==D.next;)if(ye=D.prev,Ae=D.next,Q?s(D,j,q,Q):n(D))I.push(ye.i/k),I.push(D.i/k),I.push(Ae.i/k),Y(D),D=Ae.next,Ze=Ae.next;else if((D=Ae)===Ze){ie?ie===1?i(D=o(r(D),I,k),I,k,j,q,Q,2):ie===2&&a(D,I,k,j,q,Q):i(r(D),I,k,j,q,Q,1);break}}}function n(D){var I=D.prev,k=D,j=D.next;if(S(I,k,j)>=0)return!1;for(var q=D.next.next;q!==D.prev;){if(w(I.x,I.y,k.x,k.y,j.x,j.y,q.x,q.y)&&S(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function s(D,I,k,j){var q=D.prev,Q=D,ie=D.next;if(S(q,Q,ie)>=0)return!1;for(var ye=q.x<Q.x?q.x<ie.x?q.x:ie.x:Q.x<ie.x?Q.x:ie.x,Ae=q.y<Q.y?q.y<ie.y?q.y:ie.y:Q.y<ie.y?Q.y:ie.y,Ze=q.x>Q.x?q.x>ie.x?q.x:ie.x:Q.x>ie.x?Q.x:ie.x,Et=q.y>Q.y?q.y>ie.y?q.y:ie.y:Q.y>ie.y?Q.y:ie.y,xt=v(ye,Ae,I,k,j),Qe=v(Ze,Et,I,k,j),Ke=D.prevZ,Ge=D.nextZ;Ke&&Ke.z>=xt&&Ge&&Ge.z<=Qe;){if(Ke!==D.prev&&Ke!==D.next&&w(q.x,q.y,Q.x,Q.y,ie.x,ie.y,Ke.x,Ke.y)&&S(Ke.prev,Ke,Ke.next)>=0||(Ke=Ke.prevZ,Ge!==D.prev&&Ge!==D.next&&w(q.x,q.y,Q.x,Q.y,ie.x,ie.y,Ge.x,Ge.y)&&S(Ge.prev,Ge,Ge.next)>=0))return!1;Ge=Ge.nextZ}for(;Ke&&Ke.z>=xt;){if(Ke!==D.prev&&Ke!==D.next&&w(q.x,q.y,Q.x,Q.y,ie.x,ie.y,Ke.x,Ke.y)&&S(Ke.prev,Ke,Ke.next)>=0)return!1;Ke=Ke.prevZ}for(;Ge&&Ge.z<=Qe;){if(Ge!==D.prev&&Ge!==D.next&&w(q.x,q.y,Q.x,Q.y,ie.x,ie.y,Ge.x,Ge.y)&&S(Ge.prev,Ge,Ge.next)>=0)return!1;Ge=Ge.nextZ}return!0}function o(D,I,k){var j=D;do{var q=j.prev,Q=j.next.next;!E(q,Q)&&P(q,j,j.next,Q)&&z(q,Q)&&z(Q,q)&&(I.push(q.i/k),I.push(j.i/k),I.push(Q.i/k),Y(j),Y(j.next),j=D=Q),j=j.next}while(j!==D);return r(j)}function a(D,I,k,j,q,Q){var ie=D;do{for(var ye=ie.next.next;ye!==ie.prev;){if(ie.i!==ye.i&&x(ie,ye)){var Ae=V(ie,ye);return ie=r(ie,ie.next),Ae=r(Ae,Ae.next),i(ie,I,k,j,q,Q),void i(Ae,I,k,j,q,Q)}ye=ye.next}ie=ie.next}while(ie!==D)}function l(D,I,k,j){var q,Q,ie,ye=[];for(q=0,Q=I.length;q<Q;q++)(ie=e(D,I[q]*j,q<Q-1?I[q+1]*j:D.length,j,!1))===ie.next&&(ie.steiner=!0),ye.push(b(ie));for(ye.sort(c),q=0;q<ye.length;q++)k=r(k=h(ye[q],k),k.next);return k}function c(D,I){return D.x-I.x}function u(D){if(D.next.prev===D)return D;let I=D;for(;;){const k=I.next;if(k.prev===I||k===I||k===D)break;I=k}return I}function h(D,I){var k=p(D,I);if(!k)return I;var j=V(k,D),q=r(k,k.next);let Q=u(j);return r(Q,Q.next),q=u(q),u(I===k?q:I)}function p(D,I){var k,j=I,q=D.x,Q=D.y,ie=-1/0;do{if(Q<=j.y&&Q>=j.next.y&&j.next.y!==j.y){var ye=j.x+(Q-j.y)*(j.next.x-j.x)/(j.next.y-j.y);if(ye<=q&&ye>ie){if(ie=ye,ye===q){if(Q===j.y)return j;if(Q===j.next.y)return j.next}k=j.x<j.next.x?j:j.next}}j=j.next}while(j!==I);if(!k)return null;if(q===ie)return k;var Ae,Ze=k,Et=k.x,xt=k.y,Qe=1/0;j=k;do q>=j.x&&j.x>=Et&&q!==j.x&&w(Q<xt?q:ie,Q,Et,xt,Q<xt?ie:q,Q,j.x,j.y)&&(Ae=Math.abs(Q-j.y)/(q-j.x),z(j,D)&&(Ae<Qe||Ae===Qe&&(j.x>k.x||j.x===k.x&&f(k,j)))&&(k=j,Qe=Ae)),j=j.next;while(j!==Ze);return k}function f(D,I){return S(D.prev,D,I.prev)<0&&S(I.next,D,D.next)<0}function g(D,I,k,j){var q=D;do q.z===null&&(q.z=v(q.x,q.y,I,k,j)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==D);q.prevZ.nextZ=null,q.prevZ=null,y(q)}function y(D){var I,k,j,q,Q,ie,ye,Ae,Ze=1;do{for(k=D,D=null,Q=null,ie=0;k;){for(ie++,j=k,ye=0,I=0;I<Ze&&(ye++,j=j.nextZ);I++);for(Ae=Ze;ye>0||Ae>0&&j;)ye!==0&&(Ae===0||!j||k.z<=j.z)?(q=k,k=k.nextZ,ye--):(q=j,j=j.nextZ,Ae--),Q?Q.nextZ=q:D=q,q.prevZ=Q,Q=q;k=j}Q.nextZ=null,Ze*=2}while(ie>1);return D}function v(D,I,k,j,q){return(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D=32767*(D-k)*q)|D<<8))|D<<4))|D<<2))|D<<1))|(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I=32767*(I-j)*q)|I<<8))|I<<4))|I<<2))|I<<1))<<1}function b(D){var I=D,k=D;do(I.x<k.x||I.x===k.x&&I.y<k.y)&&(k=I),I=I.next;while(I!==D);return k}function w(D,I,k,j,q,Q,ie,ye){return(q-ie)*(I-ye)-(D-ie)*(Q-ye)>=0&&(D-ie)*(j-ye)-(k-ie)*(I-ye)>=0&&(k-ie)*(Q-ye)-(q-ie)*(j-ye)>=0}function x(D,I){return D.next.i!==I.i&&D.prev.i!==I.i&&!U(D,I)&&(z(D,I)&&z(I,D)&&W(D,I)&&(S(D.prev,D,I.prev)||S(D,I.prev,I))||E(D,I)&&S(D.prev,D,D.next)>0&&S(I.prev,I,I.next)>0)}function S(D,I,k){return(I.y-D.y)*(k.x-I.x)-(I.x-D.x)*(k.y-I.y)}function E(D,I){return D.x===I.x&&D.y===I.y}function P(D,I,k,j){var q=L(S(D,I,k)),Q=L(S(D,I,j)),ie=L(S(k,j,D)),ye=L(S(k,j,I));return q!==Q&&ie!==ye||!(q!==0||!M(D,k,I))||!(Q!==0||!M(D,j,I))||!(ie!==0||!M(k,D,j))||!(ye!==0||!M(k,I,j))}function M(D,I,k){return I.x<=Math.max(D.x,k.x)&&I.x>=Math.min(D.x,k.x)&&I.y<=Math.max(D.y,k.y)&&I.y>=Math.min(D.y,k.y)}function L(D){return D>0?1:D<0?-1:0}function U(D,I){var k=D;do{if(k.i!==D.i&&k.next.i!==D.i&&k.i!==I.i&&k.next.i!==I.i&&P(k,k.next,D,I))return!0;k=k.next}while(k!==D);return!1}function z(D,I){return S(D.prev,D,D.next)<0?S(D,I,D.next)>=0&&S(D,D.prev,I)>=0:S(D,I,D.prev)<0||S(D,D.next,I)<0}function W(D,I){var k=D,j=!1,q=(D.x+I.x)/2,Q=(D.y+I.y)/2;do k.y>Q!=k.next.y>Q&&k.next.y!==k.y&&q<(k.next.x-k.x)*(Q-k.y)/(k.next.y-k.y)+k.x&&(j=!j),k=k.next;while(k!==D);return j}function V(D,I){var k=new X(D.i,D.x,D.y),j=new X(I.i,I.x,I.y),q=D.next,Q=I.prev;return D.next=I,I.prev=D,k.next=q,q.prev=k,j.next=k,k.prev=j,Q.next=j,j.prev=Q,j}function J(D,I,k,j){var q=new X(D,I,k);return j?(q.next=j.next,q.prev=j,j.next.prev=q,j.next=q):(q.prev=q,q.next=q),q}function Y(D){D.next.prev=D.prev,D.prev.next=D.next,D.prevZ&&(D.prevZ.nextZ=D.nextZ),D.nextZ&&(D.nextZ.prevZ=D.prevZ)}function X(D,I,k){this.i=D,this.x=I,this.y=k,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function le(D,I,k,j){for(var q=0,Q=I,ie=k-j;Q<k;Q+=j)q+=(D[ie]-D[Q])*(D[Q+1]+D[ie+1]),ie=Q;return q}return t.deviation=function(D,I,k,j){var q=I&&I.length,Q=q?I[0]*k:D.length,ie=Math.abs(le(D,0,Q,k));if(q)for(var ye=0,Ae=I.length;ye<Ae;ye++){var Ze=I[ye]*k,Et=ye<Ae-1?I[ye+1]*k:D.length;ie-=Math.abs(le(D,Ze,Et,k))}var xt=0;for(ye=0;ye<j.length;ye+=3){var Qe=j[ye]*k,Ke=j[ye+1]*k,Ge=j[ye+2]*k;xt+=Math.abs((D[Qe]-D[Ge])*(D[Ke+1]-D[Qe+1])-(D[Qe]-D[Ke])*(D[Ge+1]-D[Qe+1]))}return ie===0&&xt===0?0:Math.abs((xt-ie)/ie)},t.flatten=function(D){for(var I=D[0][0].length,k={vertices:[],holes:[],dimensions:I},j=0,q=0;q<D.length;q++){for(var Q=0;Q<D[q].length;Q++)for(var ie=0;ie<I;ie++)k.vertices.push(D[q][Q][ie]);q>0&&(j+=D[q-1].length,k.holes.push(j))}return k},t},(Tpe=Spe())!==void 0&&(xpe.exports=Tpe);const qP=hN(mAe.exports);function Go(t,e=!1){return t<=Vu?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function gAe(t){return(np(t)?t.length:t.byteLength/8)<=Vu?Array.from(t):new Float64Array(t)}function Qd(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function yKe(t,e){for(let r=0;r<e.length;++r)t[r]=e[r];return t}function uWt(t){return Array.isArray(t)?new Float64Array(t):t}function Yg(t){if(np(t)){if(t.length<Vu)return t}else if(t.length<Vu)return Array.from(t);let e=!0,r=!0;return t.some((i,n)=>(e=e&&i===0,r=r&&i===n,!e&&!r)),e?ow(t.length):r?_2(t.length):np(t)||t.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?_Ke(t):t}function _Ke(t){let e=!0;for(const r of t){if(r>=65536)return np(t)?new Uint32Array(t):t;r>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function Az(t){return t<=Vu?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function vKe(t){return t<=Vu?new Array(t):new Uint32Array(t)}let U2=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const yAe=[0],Vj=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function _2(t){if(t===1)return yAe;if(t<Vu)return Array.from(new Uint16Array(Vj.buffer,0,t));if(t<Vj.length)return new Uint16Array(Vj.buffer,0,t);if(t>U2.length){const e=Math.max(2*U2.length,t);U2=new Uint32Array(e);for(let r=0;r<U2.length;r++)U2[r]=r}return new Uint32Array(U2.buffer,0,t)}let U4=new Uint8Array(65536);function ow(t){if(t===1)return yAe;if(t<Vu)return new Array(t).fill(0);if(t>U4.length){const e=Math.max(2*U4.length,t);U4=new Uint8Array(e)}return new Uint8Array(U4.buffer,0,t)}function ZZ(t,e,r){const i=Array.isArray(t),n=i?t.length/e:t.byteLength/(4*e),s=i?t:new Uint32Array(t,0,n*e),o=(r==null?void 0:r.minReduction)??0,a=(r==null?void 0:r.originalIndices)||null,l=a?a.length:0,c=(r==null?void 0:r.componentOffsets)||null;let u=0;if(c)for(let P=0;P<c.length-1;P++){const M=c[P+1]-c[P];M>u&&(u=M)}else u=n;const h=Math.floor(1.1*u)+1;(Pm==null||Pm.length<2*h)&&(Pm=new Uint32Array(W3e(2*h)));for(let P=0;P<2*h;P++)Pm[P]=0;let p=0;const f=!!c&&!!a,g=f?l:n;let y=Az(n);const v=new Uint32Array(l),b=1.96;let w=o!==0?Math.ceil(4*b*b/(o*o)*o*(1-o)):g,x=1,S=c?c[1]:g;for(let P=0;P<g;P++){if(P===w){const V=1-p/P;if(V+b*Math.sqrt(V*(1-V)/P)<o)return null;w*=2}if(P===S){for(let V=0;V<2*h;V++)Pm[V]=0;if(a)for(let V=c[x-1];V<c[x];V++)v[V]=y[a[V]];S=c[++x]}const M=f?a[P]:P,L=M*e,U=xKe(s,L,e);let z=U%h,W=p;for(;Pm[2*z+1]!==0;){if(Pm[2*z]===U){const V=Pm[2*z+1]-1;if(bKe(s,L,V*e,e)){W=y[V];break}}z++,z>=h&&(z-=h)}W===p&&(Pm[2*z]=U,Pm[2*z+1]=M+1,p++),y[M]=W}if(o!==0&&1-p/n<o)return null;if(f){for(let P=c[x-1];P<v.length;P++)v[P]=y[a[P]];y=Yg(v)}const E=i?new Array(p):new Uint32Array(p*e);p=0;for(let P=0;P<g;P++)y[P]===p&&(wKe(s,(f?a[P]:P)*e,E,p*e,e),p++);if(a&&!f){const P=new Uint32Array(l);for(let M=0;M<P.length;M++)P[M]=y[a[M]];y=Yg(P)}return{buffer:Array.isArray(E)?E:E.buffer,indices:y,uniqueCount:p}}function bKe(t,e,r,i){for(let n=0;n<i;n++)if(t[e+n]!==t[r+n])return!1;return!0}function wKe(t,e,r,i,n){for(let s=0;s<n;s++)r[i+s]=t[e+s]}function xKe(t,e,r){let i=0;for(let n=0;n<r;n++)i=t[e+n]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let Pm=null;function bI(t,e){return fe(t,e)/Te(t)}function zB(t,e){const r=fe(t,e)/(Te(t)*Te(e));return-_o(r)}function _Ae(t,e,r){me(z4,t),me(Bj,e);const i=fe(z4,Bj),n=_o(i),s=it(z4,z4,Bj);return fe(s,r)<0?2*Math.PI-n:n}const z4=C(),Bj=C();function Ye(){return[0,0]}function rR(t){return[t[0],t[1]]}function mr(t,e){return[t,e]}function vAe(t,e=Ye()){const r=Math.min(2,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function SKe(t,e){return new Float64Array(t,e,2)}function bAe(){return Ye()}function wAe(){return mr(1,1)}function xAe(){return mr(1,0)}function SAe(){return mr(0,1)}const u_=bAe(),VB=wAe(),TAe=xAe(),TKe=SAe();Object.freeze(Object.defineProperty({__proto__:null,ONES:VB,UNIT_X:TAe,UNIT_Y:TKe,ZEROS:u_,clone:rR,create:Ye,createView:SKe,fromArray:vAe,fromValues:mr,ones:wAe,unitX:xAe,unitY:SAe,zeros:bAe},Symbol.toStringTag,{value:"Module"}));let GA=class vx{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return this._itemsPtr===0&&EP(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new vx(Ye)}static createVec3f64(){return new vx(C)}static createVec4f64(){return new vx(tr)}static createMat3f64(){return new vx(gi)}static createMat4f64(){return new vx(xe)}static createQuatf64(){return new vx(Gc)}get test(){return{length:this._items.length}}};const hWt=GA.createVec2f64(),je=GA.createVec3f64(),gse=GA.createVec4f64();GA.createMat3f64();const yse=GA.createMat4f64(),EKe=GA.createQuatf64();function WP(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],r=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}function CKe(t,e){const r=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),i=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),n=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return se(t,r,i,n),t}function dWt(t,e,r){r=r||t;const i=fe(t,e);se(r,t[0]-i*e[0],t[1]-i*e[1],t[2]-i*e[2]),me(r,r)}function pWt(t,e,r){Math.abs(t[0])>Math.abs(t[1])?se(e,0,1,0):se(e,1,0,0),it(r,t,e),it(e,r,t),me(r,r),me(e,e)}function V4(t,e,r,i,n,s){const o=t+(e-t)*n;return o+(r+(i-r)*n-o)*s}function PKe(t,e,r,i=C()){const n=Te(t),s=Te(e),o=fe(t,e)/(n*s);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*n+r*s)/Math.sin(a),c=l/n*Math.sin((1-r)*a),u=l/s*Math.sin(r*a);return oe(jS,t,c),oe(HS,e,u),ge(i,jS,HS)}return pi(i,t,e,r)}function fWt(t,e,r,i=C(),n=C()){const s=Te(t),o=Te(e),a=fe(t,e)/(s*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(r*l),h=Math.sin((1-r)*l),p=(1-r)*s+r*o;{const f=p/c,g=f/o*u;oe(jS,t,f/s*h),oe(HS,e,g),ge(i,jS,HS)}{const f=1/s*(-Math.cos((1-r)*l)*l*p+h*(-s+o));oe(jS,t,f);const g=1/o*(Math.cos(r*l)*l*p+u*(-s+o));oe(HS,e,g),ge(n,jS,HS),oe(n,n,1/c)}return n}return pi(i,t,e,r),_e(n,e,t),me(n,n),n}function Oz(t,e,r){t=me(jS,t),e=me(HS,e);const i=_o(fe(t,e));if(r){const n=it(AKe,t,e);if(fe(n,r)<0)return-i}return i}function m6(t){const e=t.length;return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[e-1][0])return t[e-1][1];let i=1;for(;r>t[i][0];)i++;const n=t[i-1][0],s=t[i][0],o=(s-r)/(s-n);return o*t[i-1][1]+(1-o)*t[i][1]}}function mWt(t,e,r,i){_e(Epe,e,t),_e(Cpe,r,t),it(i,Epe,Cpe),me(i,i),i[3]=-fe(t,i)}function gWt(t,e){if(se(e,0,0,0),t.length>0){for(let r=0;r<t.length;++r)ge(e,e,t[r]);oe(e,e,1/t.length)}}const Epe=C(),Cpe=C(),AKe=C(),jS=C(),HS=C();function Yr(t=iR){return[t[0],t[1],t[2],t[3]]}function OKe(t=iR[0],e=iR[1],r=iR[2],i=iR[3]){return _se(t,e,r,i,gse.get())}function BB(t,e){return _se(e[0],e[1],e[2],e[3],t)}function yWt(t){return t}function _se(t,e,r,i,n=Yr()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function EAe(t,e,r){return he(r,t),r[3]=e,r}function dN(t,e,r){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function rl(t,e,r,i=Yr()){const n=r[0]-e[0],s=r[1]-e[1],o=r[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=s*c-o*l,h=o*a-n*c,p=n*l-s*a,f=u*u+h*h+p*p,g=Math.abs(f-1)>1e-5&&f>1e-12?1/Math.sqrt(f):1;return i[0]=u*g,i[1]=h*g,i[2]=p*g,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function vse(t,e,r,i=0,n=Math.floor(r*(1/3)),s=Math.floor(r*(2/3))){if(r<3)return!1;e(LO,i);let o=n,a=!1;for(;o<r-1&&!a;)e(z2,o),o++,a=!aa(LO,z2);if(!a)return!1;for(o=Math.max(o,s),a=!1;o<r&&!a;)e(vS,o),o++,_e(B4,LO,z2),me(B4,B4),_e(G4,z2,vS),me(G4,G4),a=!aa(LO,vS)&&!aa(z2,vS)&&Math.abs(fe(B4,G4))<RKe;return a?(rl(LO,z2,vS,t),!0):(i!==0||n!==1||s!==2)&&vse(t,e,r,0,1,2)}function MKe(t,e,r=!0){const i=e.length/3;return vse(t,(n,s)=>se(n,e[3*s+0],e[3*s+1],e[3*s+2]),r?i-1:i)}const RKe=.99619469809,LO=C(),z2=C(),vS=C(),B4=C(),G4=C();function JZ(t,e,r){return e!==t&&BB(t,e),t[3]=-fe(t,r),t}function QZ(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function YL(t,e,r,i){return it(vS,e,t),dN(r,vS,i)}function _Wt(t,e,r,i){return GB(t,e,_e(je.get(),r,e),FKe,i)}function v2(t,e,r){return e!=null&&GB(t,e.origin,e.direction,kKe,r)}function $Ke(t,e,r){return GB(t,e.origin,e.vector,Xg.NONE,r)}function IKe(t,e,r){return GB(t,e.origin,e.vector,Xg.CLAMP,r)}function CAe(t,e){return Ci(t,e)>=0}function LKe(t,e){const r=fe(t,e.ray.direction),i=-Ci(t,e.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const n=i/r;return r>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function DKe(t,e){const r=fe(t,e.ray.direction),i=-Ci(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const n=i/r;return r>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function NKe(t,e,r){const i=oe(je.get(),t,-t[3]),n=KZ(t,_e(je.get(),e,i),je.get());return ge(r,n,i),r}function KZ(t,e,r){const i=oe(je.get(),t,fe(t,e));return _e(r,e,i),r}function vWt(t,e){return Math.abs(Ci(t,e))}function Ci(t,e){return fe(t,e)+t[3]}function GB(t,e,r,i,n){const s=fe(t,r);if(s===0)return!1;let o=-(fe(t,e)+t[3])/s;return i&Xg.CLAMP&&(o=we(o,0,1)),!(!(i&Xg.INFINITE_MIN)&&o<0||!(i&Xg.INFINITE_MAX)&&o>1)&&(ge(n,e,oe(n,r,o)),!0)}const iR=[0,0,1,0];var Xg;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(Xg||(Xg={}));const FKe=Xg.INFINITE_MIN|Xg.INFINITE_MAX,kKe=Xg.INFINITE_MAX;let jA=class{constructor(e,r,i=r){this.data=e,this.size=r,this.stride=i}},tt=class extends jA{constructor(e,r,i,n=!1,s=i){super(e,i,s),this.indices=r,this.exclusive=n}};var Ln;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(Ln||(Ln={}));function UKe(t){if(t.length<Vu)return Array.from(t);if(np(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return JV(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}var $i,ZT,Hn,Cb,Lc,h_,xi,Ac,G0;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})($i||($i={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(ZT||(ZT={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(Hn||(Hn={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(Cb||(Cb={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Lc||(Lc={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(h_||(h_={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(xi||(xi={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(Ac||(Ac={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(G0||(G0={}));const Sl=tr();let zKe=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function _t(t,e){if(!t){e=e||"Assertion";const r=new Error(e).stack;throw new zKe(`${e} at ${r}`)}}function V2(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function Ppe(t,e,r,i){let n,s=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];s>o&&(n=s,s=o,o=n);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],u=(i[2]-t[2])/e[2];return c>u&&(n=c,c=u,u=n),!(s>u||c>o)&&(u<o&&(o=u),!(o<0))}function j4(t,e,r,i,n,s=Ye()){const o=(i[n]-r[n])*(e[0]-t[0])-(i[0]-r[0])*(e[n]-t[n]),a=(i[0]-r[0])*(t[n]-r[n])-(i[n]-r[n])*(t[0]-r[0]);if(o===0)return!1;const l=a/o;return s[0]=t[0]+l*(e[0]-t[0]),s[1]=t[n]+l*(e[n]-t[n]),!0}function Ape(t,e,r,i,n){Sl[0]=t[0],Sl[1]=t[1],Sl[2]=t[2],Sl[3]=1,Mu(Sl,Sl,e),n.length>2&&(n[2]=-Sl[2]),Mu(Sl,Sl,r),_t(Sl[3]!==0),n[0]=Sl[0]/Sl[3],n[1]=Sl[1]/Sl[3],n[2]=Sl[2]/Sl[3],n[0]=(.5*n[0]+.5)*i[2]+i[0],n[1]=(.5*n[1]+.5)*i[3]+i[1]}function VKe(t,e){return Math.log(t)/Math.log(e)}function BKe(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function PAe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}let AAe=class OAe{constructor(e,r,i){this.primitiveIndices=e,this._numIndexPerPrimitive=r,this.position=i,this._children=void 0,_t(e.length>=1),_t(i.size===3||i.size===4);const{data:n,size:s,indices:o}=i;_t(o.length%this._numIndexPerPrimitive==0),_t(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=s*o[this._numIndexPerPrimitive*e[0]];Aw.clear(),Aw.push(l);const c=Ce(n[l],n[l+1],n[l+2]),u=nn(c);for(let f=0;f<a;++f){const g=this._numIndexPerPrimitive*e[f];for(let y=0;y<this._numIndexPerPrimitive;++y){l=s*o[g+y],Aw.push(l);let v=n[l];c[0]=Math.min(v,c[0]),u[0]=Math.max(v,u[0]),v=n[l+1],c[1]=Math.min(v,c[1]),u[1]=Math.max(v,u[1]),v=n[l+2],c[2]=Math.min(v,c[2]),u[2]=Math.max(v,u[2])}}this.bbMin=c,this.bbMax=u;const h=pi(C(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let p=this.radius*this.radius;for(let f=0;f<Aw.length;++f){l=Aw.at(f);const g=n[l]-h[0],y=n[l+1]-h[1],v=n[l+2]-h[2],b=g*g+y*y+v*v;if(b<=p)continue;const w=Math.sqrt(b),x=.5*(w-this.radius);this.radius=this.radius+x,p=this.radius*this.radius;const S=x/w;h[0]+=g*S,h[1]+=y*S,h[2]+=v*S}this.center=h,Aw.clear()}getChildren(){if(this._children||ca(this.bbMin,this.bbMax)<=1)return this._children;const e=pi(C(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),n=new Array(8);for(let u=0;u<8;++u)n[u]=0;const{data:s,size:o,indices:a}=this.position;for(let u=0;u<r;++u){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[u];let f=o*a[p],g=s[f],y=s[f+1],v=s[f+2];for(let b=1;b<this._numIndexPerPrimitive;++b){f=o*a[p+b];const w=s[f],x=s[f+1],S=s[f+2];w<g&&(g=w),x<y&&(y=x),S<v&&(v=S)}g<e[0]&&(h|=1),y<e[1]&&(h|=2),v<e[2]&&(h|=4),i[u]=h,++n[h]}let l=0;for(let u=0;u<8;++u)n[u]>0&&++l;if(l<2)return;const c=new Array(8);for(let u=0;u<8;++u)c[u]=n[u]>0?new Uint32Array(n[u]):void 0;for(let u=0;u<8;++u)n[u]=0;for(let u=0;u<r;++u){const h=i[u];c[h][n[h]++]=this.primitiveIndices[u]}this._children=new Array;for(let u=0;u<8;++u)c[u]!==void 0&&this._children.push(new OAe(c[u],this._numIndexPerPrimitive,this.position));return this._children}static prune(){Aw.prune()}};const Aw=new jt({deallocator:null});let pN=class{constructor(){this.id=Dh()}},S_=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&EP(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Ope);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,Ope));e++)this._items.push(this._allocator())}};const Ope=1024;function bm(t){return t?{origin:nn(t.origin),vector:nn(t.vector)}:{origin:C(),vector:C()}}function GKe(t,e){const r=HKe.get();return r.origin=t,r.vector=e,r}function EWt(t,e=bm()){return jKe(t.origin,t.vector,e)}function jKe(t,e,r=bm()){return he(r.origin,t),he(r.vector,e),r}function pT(t,e,r=bm()){return he(r.origin,t),_e(r.vector,e,t),r}function bse(t,e){const r=_e(je.get(),e,t.origin),i=fe(t.vector,r),n=fe(t.vector,t.vector),s=we(i/n,0,1),o=_e(je.get(),oe(je.get(),t.vector,s),r);return fe(o,o)}function CWt(t,e,r){return eJ(t,e,0,1,r)}function PWt(t,e,r){return ge(r,t.origin,oe(r,t.vector,e))}function eJ(t,e,r,i,n){const{vector:s,origin:o}=t,a=_e(je.get(),e,o),l=fe(s,a)/nl(s);return oe(n,s,we(l,r,i)),ge(n,n,t.origin)}function AWt(t,e){if(RAe(t,GKe(e.origin,e.direction),!1,Mz)){const{tA:r,pB:i,distance2:n}=Mz;if(r>=0&&r<=1)return n;if(r<0)return ca(t.origin,i);if(r>1)return ca(ge(je.get(),t.origin,t.vector),i)}return null}function MAe(t,e,r){return!!RAe(t,e,!0,Mz)&&(he(r,Mz.pA),!0)}function RAe(t,e,r,i){const s=t.origin,o=ge(je.get(),s,t.vector),a=e.origin,l=ge(je.get(),a,e.vector),c=je.get(),u=je.get();if(c[0]=s[0]-a[0],c[1]=s[1]-a[1],c[2]=s[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const h=je.get();if(h[0]=o[0]-s[0],h[1]=o[1]-s[1],h[2]=o[2]-s[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],f=u[0]*h[0]+u[1]*h[1]+u[2]*h[2],g=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],y=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],v=(h[0]*h[0]+h[1]*h[1]+h[2]*h[2])*y-f*f;if(Math.abs(v)<1e-6)return!1;let b=(p*f-g*y)/v,w=(p+f*b)/y;r&&(b=we(b,0,1),w=we(w,0,1));const x=je.get(),S=je.get();return x[0]=s[0]+b*h[0],x[1]=s[1]+b*h[1],x[2]=s[2]+b*h[2],S[0]=a[0]+w*u[0],S[1]=a[1]+w*u[1],S[2]=a[2]+w*u[2],i.tA=b,i.tB=w,i.pA=x,i.pB=S,i.distance2=ca(x,S),!0}const Mz={tA:0,tB:0,pA:C(),pB:C(),distance2:0},HKe=new S_(()=>bm());function qKe(t){return t?{p0:nn(t.p0),p1:nn(t.p1),p2:nn(t.p2)}:{p0:C(),p1:C(),p2:C()}}function WKe(t,e,r){const i=e[0]-t[0],n=e[1]-t[1],s=r[0]-t[0],o=r[1]-t[1];return .5*Math.abs(i*o-n*s)}function YKe(t,e,r){return _e(Gj,e,t),_e(Mpe,r,t),.5*Te(it(Gj,Gj,Mpe))}new S_(bm);new S_(()=>qKe());const Gj=C(),Mpe=C();function XKe(t,e){if(!t)return!1;const{size:r,data:i,indices:n}=t;se(e,0,0,0),se(Pd,0,0,0);let s=0,o=0;for(let a=0;a<n.length-2;a+=3){const l=n[a]*r,c=n[a+1]*r,u=n[a+2]*r;se(Do,i[l],i[l+1],i[l+2]),se(A0,i[c],i[c+1],i[c+2]),se(H4,i[u],i[u+1],i[u+2]);const h=YKe(Do,A0,H4);h?(ge(Do,Do,A0),ge(Do,Do,H4),oe(Do,Do,1/3*h),ge(e,e,Do),s+=h):(ge(Pd,Pd,Do),ge(Pd,Pd,A0),ge(Pd,Pd,H4),o+=3)}return(o!==0||s!==0)&&(s!==0?(oe(e,e,1/s),!0):o!==0&&(oe(e,Pd,1/o),!0))}function ZKe(t,e){if(!t)return!1;const{size:r,data:i,indices:n}=t;se(e,0,0,0);let s=-1,o=0;for(let a=0;a<n.length;a++){const l=n[a]*r;s!==l&&(e[0]+=i[l],e[1]+=i[l+1],e[2]+=i[l+2],o++),s=l}return o>1&&oe(e,e,1/o),o>0}function JKe(t,e,r){if(!t)return!1;se(r,0,0,0),se(Pd,0,0,0);let i=0,n=0;const{size:s,data:o,indices:a}=t,l=a.length-1,c=l+(e?2:0);for(let u=0;u<c;u+=2){const h=u<l?u+1:0,p=a[u<l?u:l]*s,f=a[h]*s;Do[0]=o[p],Do[1]=o[p+1],Do[2]=o[p+2],A0[0]=o[f],A0[1]=o[f+1],A0[2]=o[f+2],oe(Do,ge(Do,Do,A0),.5);const g=B0(Do,A0);g>0?(ge(r,r,oe(Do,Do,g)),i+=g):i===0&&(ge(Pd,Pd,Do),n++)}return i!==0?(oe(r,r,1/i),!0):n!==0&&(oe(r,Pd,1/n),!0)}const Do=C(),A0=C(),H4=C(),Pd=C();let Rz=class{constructor(e){this.channel=e,this.id=Dh()}};var R;function QKe(t){return t===R.POSITION}(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",t.LENGTH="length",t.PREVPOSITION="prevPosition",t.NEXTPOSITION="nextPosition",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMAL2COMPRESSED="normal2Compressed",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(R||(R={}));function tJ(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function KKe(t,e){const r=t.length;for(let i=0;i<r;++i)KC[0]=t[i],e[i]=KC[0];return e}function eet(t,e){const r=t.length;for(let i=0;i<r;++i)KC[0]=t[i],KC[1]=t[i]-KC[0],e[i]=KC[1];return e}const KC=new Float32Array(2);function rJ(t,e){return t==null&&(t=[]),t.push(e),t}function iJ(t,e){if(t==null)return null;const r=t.filter(i=>i!==e);return r.length===0?null:r}function tet(t,e,r,i,n){q4[0]=t.get(e,0),q4[1]=t.get(e,1),q4[2]=t.get(e,2),tJ(q4,Ow,3),r.set(n,0,Ow[0]),i.set(n,0,Ow[1]),r.set(n,1,Ow[2]),i.set(n,1,Ow[3]),r.set(n,2,Ow[4]),i.set(n,2,Ow[5])}const q4=C(),Ow=new Float32Array(6);let Is=class $Ae extends pN{constructor(e,r,i=null,n=Ln.Mesh,s=null,o=-1){super(),this.material=e,this.mapPositions=i,this.type=n,this.objectAndLayerIdColor=s,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of r)this._attributes.set(a,{...l,indices:Yg(l.indices)}),a===R.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(e={}){const r=new $Ae(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((i,n)=>{i.exclusive=!1,r._attributes.set(n,i)}),r._boundingInfo=this._boundingInfo,r.transformation=e.transformation||this.transformation,r}get attributes(){return this._attributes}getMutableAttribute(e){let r=this._attributes.get(e);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:UKe(r.data)},this._attributes.set(e,r)),r}setAttributeData(e,r){const i=this._attributes.get(e);i&&this._attributes.set(e,{...i,exclusive:!0,data:r})}get indexCount(){const e=this._attributes.values().next().value.indices;return(e==null?void 0:e.length)??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Ln.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Ln.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&ze(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const r=this.attributes.get(R.POSITION);return XKe(r,e)}_computeAttachmentOriginLines(e){const r=this.attributes.get(R.POSITION);return JKe(r,ret(this.material.parameters,r),e)}_computeAttachmentOriginPoints(e){const r=this.attributes.get(R.POSITION);return ZKe(r,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(R.POSITION);if(!e||e.indices.length===0)return null;const r=this.type===Ln.Mesh?3:1;_t(e.indices.length%r==0,"Indexing error: "+e.indices.length+" not divisible by "+r);const i=_2(e.indices.length/r);return new AAe(i,r,e)}get transformation(){return this._transformation??fn}set transformation(e){this._transformation=e&&e!==fn?HP(e):null}addHighlight(){const e=new Rz(h_.Highlight);return this.highlights=rJ(this.highlights,e),e}removeHighlight(e){this.highlights=iJ(this.highlights,e)}};function ret(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}function iet(t,e,r,i){const n=(o=>!Array.isArray(o[0]))(e)?(o,a)=>e[3*o+a]:(o,a)=>e[o][a],s=i?fl(i)/zT(i):1;return vse(t,(o,a)=>se(o,n(a,0)*s,n(a,1)*s,n(a,2)),r)}function IAe(t,e,r){const i=iet(Rpe,t,e,r)?Rpe:[0,0,1];return Math.abs(i[2])>Math.cos(Ut(80))?wn.Z:Math.abs(i[1])>Math.abs(i[0])?wn.Y:wn.X}const Rpe=Yr();function net(t,e,r){const i=IAe(t,(e.length>0?e[0]:t.length/3)-1,r);if(i!==wn.Z){t=t.slice();for(let n=0;n<t.length;n+=3)t[n+i]=t[n+2]}return qP(t,e,3)}function $pe(t){const e=[[R.POSITION,new tt(t.attributeData.position,t.indices,3,!0)]],r=ow(t.indices.length);return t.attributeData.colorFeature!=null?e.push([R.COLORFEATUREATTRIBUTE,new tt([t.attributeData.colorFeature],r,1,!0)]):t.attributeData.color&&e.push([R.COLOR,new tt(t.attributeData.color,r,4,!0)]),t.attributeData.uvMapSpace&&e.push([R.UVMAPSPACE,new tt(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([R.BOUNDINGRECT,new tt(t.attributeData.boundingRect,t.indices,9,!0)]),new Is(t.material,e,t.mapPositions,Ln.Mesh,t.attributeData.objectAndLayerIdColor)}function Ipe(t,e=null){const r=[[R.POSITION,new tt(t.attributeData.position,t.indices,3,!0)],[R.UV0,new tt(t.attributeData.uv0,t.indices,2,!0)]];return new Is(t.material,r,t.mapPositions,Ln.Mesh,e)}function XL(t){switch(t.type){case"extent":if(t instanceof br)return ku.fromExtent(t);break;case"polygon":return t}return null}let jB=class{constructor(e,r,i){this.renderData=e,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}};function set(t){const e=fN(t.rings,t.hasZ,ly.CCW_IS_HOLE,t.spatialReference),r=new Array;let i=0,n=0;for(const a of e.polygons){const l=a.count,c=a.index,u=Qd(e.position,3*c,3*l),h=a.holeIndices.map(f=>f-c),p=Yg(qP(u,h,3));r.push({position:u,faces:p}),i+=u.length,n+=p.length}const s=oet(r,i,n),o=Array.isArray(s.position)?ZZ(s.position,3,{originalIndices:s.faces}):ZZ(s.position.buffer,6,{originalIndices:s.faces});return s.position=gAe(new Float64Array(o.buffer)),s.faces=o.indices,s}function oet(t,e,r){if(t.length===1)return t[0];const i=Go(e),n=new Array(r);let s=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)i[s++]=l.position[c];for(const c of l.faces)n[o++]=c+a;a=s/3}return{position:i,faces:Yg(n)}}function fN(t,e,r,i){const n=t.length,s=new Array(n),o=new Array(n),a=new Array(n);let l=0,c=0,u=0,h=0;for(let g=0;g<n;++g)h+=t[g].length;const p=Go(3*h);let f=0;for(let g=n-1;g>=0;g--){const y=t[g],v=r===ly.CCW_IS_HOLE&&aet(y,e,i);if(v&&n!==1)s[l++]=y;else{let b=y.length;for(let x=0;x<l;++x)b+=s[x].length;const w={index:f,pathLengths:new Array(l+1),count:b,holeIndices:new Array(l)};w.pathLengths[0]=y.length,y.length>0&&(a[u++]={index:f,count:y.length}),f=v?W4(y,y.length-1,-1,p,f,y.length,e):W4(y,0,1,p,f,y.length,e);for(let x=0;x<l;++x){const S=s[x];w.holeIndices[x]=f,w.pathLengths[x+1]=S.length,S.length>0&&(a[u++]={index:f,count:S.length}),f=W4(S,0,1,p,f,S.length,e)}l=0,w.count>0&&(o[c++]=w)}}for(let g=0;g<l;++g){const y=s[g];y.length>0&&(a[u++]={index:f,count:y.length}),f=W4(y,0,1,p,f,y.length,e)}return o.length=c,a.length=u,{position:p,polygons:o,outlines:a}}function W4(t,e,r,i,n,s,o){n*=3;for(let a=0;a<s;++a){const l=t[e];i[n++]=l[0],i[n++]=l[1],i[n++]=o?l[2]:0,e+=r}return n/3}function aet(t,e,r){if(e){const i=t.length-1,n=IAe(t,i,r);if(n===wn.X)return!u6(t,wn.Y,wn.Z);if(n===wn.Y)return!u6(t,wn.X,wn.Z)}return!u6(t,wn.X,wn.Y)}var ly;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(ly||(ly={}));function Ds(t=Tse){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function JT(t,e,r,i,n,s,o=Ds()){return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o}function RWt(t,e){const r=isFinite(t[2])||isFinite(t[5]);return new br(r?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function YP(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function cet(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function um(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function Ru(t,e,r=0,i=e.length/3){let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<i;u++)n=Math.min(n,e[r+3*u]),s=Math.min(s,e[r+3*u+1]),o=Math.min(o,e[r+3*u+2]),a=Math.max(a,e[r+3*u]),l=Math.max(l,e[r+3*u+1]),c=Math.max(c,e[r+3*u+2]);t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function jj(t,e,r){const i=e.length;let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(r)for(let u=0;u<i;u++){const h=e[u];n=Math.min(n,h[0]),s=Math.min(s,h[1]),o=Math.min(o,h[2]),a=Math.max(a,h[0]),l=Math.max(l,h[1]),c=Math.max(c,h[2])}else for(let u=0;u<i;u++){const h=e[u];n=Math.min(n,h[0]),s=Math.min(s,h[1]),a=Math.max(a,h[0]),l=Math.max(l,h[1])}t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function uet(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function b2(t){return t[0]>=t[3]?0:t[3]-t[0]}function w2(t){return t[1]>=t[4]?0:t[4]-t[1]}function aw(t){return t[2]>=t[5]?0:t[5]-t[2]}function LAe(t){const e=b2(t),r=aw(t),i=w2(t);return Math.sqrt(e*e+r*r+i*i)}function kf(t,e=[0,0,0]){return e[0]=t[0]+b2(t)/2,e[1]=t[1]+w2(t)/2,e[2]=t[2]+aw(t)/2,e}function Y4(t,e=[0,0,0]){return e[0]=b2(t),e[1]=w2(t),e[2]=aw(t),e}function wse(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function $Wt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function het(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function Uf(t,e){return e==null||het(t,e)}function DAe(t,e,r,i,n=t){return n[0]=t[0]+e,n[1]=t[1]+r,n[2]=t[2]+i,n[3]=t[3]+e,n[4]=t[4]+r,n[5]=t[5]+i,n}function IWt(t,e,r=t){const i=t[0]+b2(t)/2,n=t[1]+w2(t)/2,s=t[2]+aw(t)/2;return r[0]=i+(t[0]-i)*e,r[1]=n+(t[1]-n)*e,r[2]=s+(t[2]-s)*e,r[3]=i+(t[3]-i)*e,r[4]=n+(t[4]-n)*e,r[5]=s+(t[5]-s)*e,r}function NAe(t,e,r=t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r!==t&&(r[3]=t[3],r[4]=t[4],r[5]=t[5]),r}function FAe(t,e,r=t){return r[3]=e[0],r[4]=e[1],r[5]=e[2],r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),t}function HB(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function zi(t){return t?HB(t,Lpe):Ds(Lpe)}function xse(t,e){return e||(e=Ht()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function LWt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function det(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=Number.NEGATIVE_INFINITY,t[3]=i,t[4]=n,t[5]=Number.POSITIVE_INFINITY,t}function nJ(t){return t.length===6}function Sse(t){return b2(t)===0&&w2(t)===0&&aw(t)===0}function DWt(t,e,r){if(t==null||e==null)return t===e;if(!nJ(t)||!nJ(e))return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function pet(t,e,r,i,n,s){return JT(t,e,r,i,n,s,fet)}const NWt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Lpe=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Tse=[0,0,0,0,0,0],fet=Ds();function jh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function met(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Ese(t,e,r,i,n,s,o,a,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function Cse(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function hp(t,e){if(t===e){const r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function x2(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,p=-u*s+a*l,f=c*s-o*l;let g=r*h+i*p+n*f;return g?(g=1/g,t[0]=h*g,t[1]=(-u*i+n*c)*g,t[2]=(a*i-n*o)*g,t[3]=p*g,t[4]=(u*r-n*l)*g,t[5]=(-a*r+n*s)*g,t[6]=f*g,t[7]=(-c*r+i*l)*g,t[8]=(o*r-i*s)*g,t):null}function get(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=n*c-i*u,t[2]=i*a-n*o,t[3]=a*l-s*u,t[4]=r*u-n*l,t[5]=n*s-r*a,t[6]=s*c-o*l,t[7]=i*l-r*c,t[8]=r*o-i*s,t}function yet(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+r*(-c*n+o*a)+i*(l*n-s*a)}function XP(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=r[0],f=r[1],g=r[2],y=r[3],v=r[4],b=r[5],w=r[6],x=r[7],S=r[8];return t[0]=p*i+f*o+g*c,t[1]=p*n+f*a+g*u,t[2]=p*s+f*l+g*h,t[3]=y*i+v*o+b*c,t[4]=y*n+v*a+b*u,t[5]=y*s+v*l+b*h,t[6]=w*i+x*o+S*c,t[7]=w*n+x*a+S*u,t[8]=w*s+x*l+S*h,t}function $z(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=r[0],f=r[1];return t[0]=i,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=p*i+f*o+c,t[7]=p*n+f*a+u,t[8]=p*s+f*l+h,t}function Pse(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=Math.sin(r),f=Math.cos(r);return t[0]=f*i+p*o,t[1]=f*n+p*a,t[2]=f*s+p*l,t[3]=f*o-p*i,t[4]=f*a-p*n,t[5]=f*l-p*s,t[6]=c,t[7]=u,t[8]=h,t}function qB(t,e,r){const i=r[0],n=r[1],s=r[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=s*e[6],t[7]=s*e[7],t[8]=s*e[8],t}function _et(t,e,r){const i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t}function vet(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function bet(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function wet(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function xet(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function ZL(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,a=i+i,l=n+n,c=r*o,u=i*o,h=i*a,p=n*o,f=n*a,g=n*l,y=s*o,v=s*a,b=s*l;return t[0]=1-h-g,t[3]=u-b,t[6]=p+v,t[1]=u+b,t[4]=1-c-g,t[7]=f-y,t[2]=p-v,t[5]=f+y,t[8]=1-c-h,t}function kAe(t,e){const r=e[0],i=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10],h=u*o-a*c,p=-u*s+a*l,f=c*s-o*l,g=r*h+i*p+n*f;if(!g)return null;const y=1/g;return t[0]=h*y,t[1]=(-u*i+n*c)*y,t[2]=(a*i-n*o)*y,t[3]=p*y,t[4]=(u*r-n*l)*y,t[5]=(-a*r+n*s)*y,t[6]=f*y,t[7]=(-c*r+i*l)*y,t[8]=(o*r-i*s)*y,t}function d_(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],y=e[13],v=e[14],b=e[15],w=r*a-i*o,x=r*l-n*o,S=r*c-s*o,E=i*l-n*a,P=i*c-s*a,M=n*c-s*l,L=u*y-h*g,U=u*v-p*g,z=u*b-f*g,W=h*v-p*y,V=h*b-f*y,J=p*b-f*v;let Y=w*J-x*V+S*W+E*z-P*U+M*L;return Y?(Y=1/Y,t[0]=(a*J-l*V+c*W)*Y,t[1]=(l*z-o*J-c*U)*Y,t[2]=(o*V-a*z+c*L)*Y,t[3]=(n*V-i*J-s*W)*Y,t[4]=(r*J-n*z+s*U)*Y,t[5]=(i*z-r*V-s*L)*Y,t[6]=(y*M-v*P+b*E)*Y,t[7]=(v*S-g*M-b*x)*Y,t[8]=(g*P-y*S+b*w)*Y,t):null}function Tet(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Eet(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Cet(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function Pet(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function UAe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function Aet(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function Oet(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function Met(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Ret(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=e[0],p=e[1],f=e[2],g=e[3],y=e[4],v=e[5],b=e[6],w=e[7],x=e[8],S=ml();return Math.abs(r-h)<=S*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-p)<=S*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(n-f)<=S*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-g)<=S*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(o-y)<=S*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-b)<=S*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-w)<=S*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(u-x)<=S*Math.max(1,Math.abs(u),Math.abs(x))}function Ase(t){const e=ml(),r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return Math.abs(1-(r*r+s*s+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+u*u))<=e}const $et=XP,Iet=UAe;Object.freeze(Object.defineProperty({__proto__:null,add:Pet,adjoint:get,copy:met,determinant:yet,equals:Ret,exactEquals:Met,frob:Cet,fromMat2d:xet,fromMat4:jh,fromQuat:ZL,fromRotation:bet,fromScaling:wet,fromTranslation:vet,identity:Cse,invert:x2,isOrthoNormal:Ase,mul:$et,multiply:XP,multiplyScalar:Aet,multiplyScalarAndAdd:Oet,normalFromMat4:d_,normalFromMat4Legacy:kAe,projection:Tet,rotate:Pse,scale:qB,scaleByVec2:_et,set:Ese,str:Eet,sub:Iet,subtract:UAe,translate:$z,transpose:hp},Symbol.toStringTag,{value:"Module"}));const FWt=Math.PI/180,kWt=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,Y_=ni.radius,Ap=ni.eccentricitySquared,Let={a1:Y_*Ap,a2:Y_*Ap*Y_*Ap,a3:Y_*Ap*Ap/2,a4:Y_*Ap*Y_*Ap*2.5,a5:Y_*Ap+Y_*Ap*Ap/2,a6:1-Ap},UWt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:ni.radius,f:ni.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:o_.radius,f:o_.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Jf.radius,f:Jf.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Jf.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var ee;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(ee||(ee={}));const e3={[ee.WGS84]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:qi,[ee.WGS84_COMPARABLE_LON_LAT]:qi,[ee.SPHERICAL_ECEF]:WS,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:ZP,[ee.PLATE_CARREE]:Fv,[ee.WGS84]:qi,[ee.WGS84_ECEF]:Uv},[ee.CGCS2000]:{[ee.CGCS2000]:qi,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:qi,[ee.WGS84_COMPARABLE_LON_LAT]:qi,[ee.SPHERICAL_ECEF]:WS,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:Fv,[ee.WGS84]:null,[ee.WGS84_ECEF]:Uv},[ee.GCSMARS2000]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:qi,[ee.GCSMOON2000]:null,[ee.LON_LAT]:qi,[ee.WGS84_COMPARABLE_LON_LAT]:null,[ee.SPHERICAL_ECEF]:null,[ee.SPHERICAL_MARS_PCPF]:oJ,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:null,[ee.WGS84]:null,[ee.WGS84_ECEF]:null},[ee.GCSMOON2000]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:qi,[ee.LON_LAT]:qi,[ee.WGS84_COMPARABLE_LON_LAT]:null,[ee.SPHERICAL_ECEF]:null,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:sJ,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:null,[ee.WGS84]:null,[ee.WGS84_ECEF]:null},[ee.WEB_MERCATOR]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:B3,[ee.WGS84_COMPARABLE_LON_LAT]:B3,[ee.SPHERICAL_ECEF]:VAe,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:qi,[ee.PLATE_CARREE]:GAe,[ee.WGS84]:B3,[ee.WGS84_ECEF]:BAe},[ee.WGS84_ECEF]:{[ee.CGCS2000]:zv,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:zv,[ee.WGS84_COMPARABLE_LON_LAT]:zv,[ee.SPHERICAL_ECEF]:qAe,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:WAe,[ee.PLATE_CARREE]:Det,[ee.WGS84]:zv,[ee.WGS84_ECEF]:qi},[ee.SPHERICAL_ECEF]:{[ee.CGCS2000]:kv,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:kv,[ee.WGS84_COMPARABLE_LON_LAT]:kv,[ee.SPHERICAL_ECEF]:qi,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:jAe,[ee.PLATE_CARREE]:Net,[ee.WGS84]:kv,[ee.WGS84_ECEF]:HAe},[ee.SPHERICAL_MARS_PCPF]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:lJ,[ee.GCSMOON2000]:null,[ee.LON_LAT]:lJ,[ee.WGS84_COMPARABLE_LON_LAT]:null,[ee.SPHERICAL_ECEF]:null,[ee.SPHERICAL_MARS_PCPF]:qi,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:null,[ee.WGS84]:null,[ee.WGS84_ECEF]:null},[ee.SPHERICAL_MOON_PCPF]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:aJ,[ee.LON_LAT]:aJ,[ee.WGS84_COMPARABLE_LON_LAT]:null,[ee.SPHERICAL_ECEF]:null,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:qi,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:null,[ee.WGS84]:null,[ee.WGS84_ECEF]:null},[ee.UNKNOWN]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:null,[ee.WGS84_COMPARABLE_LON_LAT]:null,[ee.SPHERICAL_ECEF]:null,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:qi,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:null,[ee.WGS84]:null,[ee.WGS84_ECEF]:null},[ee.LON_LAT]:{[ee.CGCS2000]:qi,[ee.GCSMARS2000]:qi,[ee.GCSMOON2000]:qi,[ee.LON_LAT]:qi,[ee.WGS84_COMPARABLE_LON_LAT]:qi,[ee.SPHERICAL_ECEF]:WS,[ee.SPHERICAL_MARS_PCPF]:oJ,[ee.SPHERICAL_MOON_PCPF]:sJ,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:ZP,[ee.PLATE_CARREE]:Fv,[ee.WGS84]:qi,[ee.WGS84_ECEF]:Uv},[ee.WGS84_COMPARABLE_LON_LAT]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:qi,[ee.WGS84_COMPARABLE_LON_LAT]:qi,[ee.SPHERICAL_ECEF]:WS,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:Fv,[ee.WGS84]:qi,[ee.WGS84_ECEF]:Uv},[ee.PLATE_CARREE]:{[ee.CGCS2000]:qS,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:qS,[ee.WGS84_COMPARABLE_LON_LAT]:qS,[ee.SPHERICAL_ECEF]:Fet,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:ket,[ee.PLATE_CARREE]:qi,[ee.WGS84]:qS,[ee.WGS84_ECEF]:Uet}};function zAe(t){const e=JL(t,YAe);return e3[e][ee.WGS84_COMPARABLE_LON_LAT]}function Pb(t,e,r=$se()){return t==null||e==null?null:Vet(t,e,r).projector}function zWt(t,e){switch(Pb(t,e,WB)){case qi:return"copy3";case WS:return"wgs84ToSphericalECEF";case ZP:return"wgs84ToWebMercator";case Fv:return"wgs84ToPlateCarree";case Uv:return"wgs84ToWGS84ECEF";case B3:return"webMercatorToWGS84";case VAe:return"webMercatorToSphericalECEF";case BAe:return"webMercatorToWGS84ECEF";case GAe:return"webMercatorToPlateCarree";case zv:return"wgs84ECEFToWGS84";case qAe:return"wgs84ECEFToSphericalECEF";case WAe:return"wgs84ECEFToWebMercator";case kv:return"sphericalECEFToWGS84";case jAe:return"sphericalECEFToWebMercator";case lJ:return"sphericalMarsPCPFToMars2000";case aJ:return"sphericalMoonPCPFToMoon2000";case HAe:return"sphericalECEFToWGS84ECEF";case oJ:return"mars2000ToSphericalPCPF";case sJ:return"moon2000ToSphericalPCPF";default:return null}}function JL(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=fl(t,1)),pz(t)?e.spatialReferenceId=ee.SPHERICAL_ECEF:UL(t)?e.spatialReferenceId=ee.WGS84:UT(t)?e.spatialReferenceId=ee.WEB_MERCATOR:zL(t)?e.spatialReferenceId=ee.PLATE_CARREE:t.wkt===m3e.wkt?e.spatialReferenceId=ee.WGS84_ECEF:t.wkid===Vd.CGCS2000?e.spatialReferenceId=ee.CGCS2000:t.wkt===pB.wkt?e.spatialReferenceId=ee.SPHERICAL_MARS_PCPF:t.wkt===fB.wkt?e.spatialReferenceId=ee.SPHERICAL_MOON_PCPF:nw(t)?e.spatialReferenceId=ee.GCSMARS2000:sw(t)?e.spatialReferenceId=ee.GCSMOON2000:e.spatialReferenceId=ee.UNKNOWN):ee.UNKNOWN}function qi(t,e,r,i){t!==r&&(r[i++]=t[e++],r[i++]=t[e++],r[i]=t[e])}function B3(t,e,r,i){r[i]=QP*(t[e]/fT),r[i+1]=QP*(XAe-2*Math.atan(Math.exp(-t[e+1]/fT))),r[i+2]=t[e+2]}function VAe(t,e,r,i){const n=t[e]/fT,s=XAe-2*Math.atan(Math.exp(-t[e+1]/fT)),o=fT+t[e+2],a=Math.cos(s)*o;r[i]=Math.cos(n)*a,r[i+1]=Math.sin(n)*a,r[i+2]=Math.sin(s)*o}function BAe(t,e,r,i){B3(t,e,r,i),Uv(r,i,r,i)}function Ose(t,e,r,i,n){const s=.4999999*YB,o=we(JP*t[e+1],-s,s),a=Math.sin(o);r[i++]=JP*t[e]*n.radius,r[i++]=n.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=t[e+2]}function ZP(t,e,r,i){Ose(t,e,r,i,ni)}function Fv(t,e,r,i){r[i]=t[e]*Dpe,r[i+1]=t[e+1]*Dpe,r[i+2]=t[e+2]}function qS(t,e,r,i){r[i]=t[e]*Npe,r[i+1]=t[e+1]*Npe,r[i+2]=t[e+2]}function GAe(t,e,r,i){B3(t,e,r,i),Fv(r,i,r,i)}function Det(t,e,r,i){zv(t,e,r,i),Fv(r,i,r,i)}function Net(t,e,r,i){kv(t,e,r,i),Fv(r,i,r,i)}function Fet(t,e,r,i){qS(t,e,r,i),WS(r,i,r,i)}function ket(t,e,r,i){qS(t,e,r,i),ZP(r,i,r,i)}function Uet(t,e,r,i){qS(t,e,r,i),Uv(r,i,r,i)}function Mse(t,e,r,i,n){const s=n+t[e+2],o=JP*t[e+1],a=JP*t[e],l=Math.cos(o)*s;r[i]=Math.cos(a)*l,r[i+1]=Math.sin(a)*l,r[i+2]=Math.sin(o)*s}function sJ(t,e,r,i){Mse(t,e,r,i,o_.radius)}function oJ(t,e,r,i){Mse(t,e,r,i,Jf.radius)}function WS(t,e,r,i){Mse(t,e,r,i,ni.radius)}function Rse(t,e,r,i,n){const s=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(s*s+o*o+a*a),c=ap(a/(l===0?1:l)),u=Math.atan2(o,s);r[i++]=QP*u,r[i++]=QP*c,r[i]=l-n}function aJ(t,e,r,i){Rse(t,e,r,i,o_.radius)}function lJ(t,e,r,i){Rse(t,e,r,i,Jf.radius)}function kv(t,e,r,i){Rse(t,e,r,i,ni.radius)}function jAe(t,e,r,i){kv(t,e,r,i),ZP(r,i,r,i)}function HAe(t,e,r,i){kv(t,e,r,i),Uv(r,i,r,i)}function zet(t,e,r,i,n){const s=JP*t[e],o=JP*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),u=n.radius/Math.sqrt(1-n.eccentricitySquared*l*l);r[i++]=(u+a)*c*Math.cos(s),r[i++]=(u+a)*c*Math.sin(s),r[i++]=(u*(1-n.eccentricitySquared)+a)*l}function Uv(t,e,r,i){zet(t,e,r,i,ni)}function zv(t,e,r,i){const n=Let,s=t[e],o=t[e+1],a=t[e+2];let l,c,u,h,p,f,g,y,v,b,w,x,S,E,P,M,L,U,z,W,V;l=Math.abs(a),c=s*s+o*o,u=Math.sqrt(c),h=c+a*a,p=Math.sqrt(h),W=Math.atan2(o,s),f=a*a/h,g=c/h,E=n.a2/p,P=n.a3-n.a4/p,g>.3?(y=l/p*(1+g*(n.a1+E+f*P)/p),z=Math.asin(y),b=y*y,v=Math.sqrt(1-b)):(v=u/p*(1-f*(n.a5-E-g*P)/p),z=Math.acos(v),b=1-v*v,y=Math.sqrt(b)),w=1-ni.eccentricitySquared*b,x=ni.radius/Math.sqrt(w),S=n.a6*x,E=u-x*v,P=l-S*y,L=v*E+y*P,M=v*P-y*E,U=M/(S/w+L),z+=U,V=L+M*U/2,a<0&&(z=-z),r[i++]=QP*W,r[i++]=QP*z,r[i]=V}function qAe(t,e,r,i){zv(t,e,r,i),WS(r,i,r,i)}function WAe(t,e,r,i){zv(t,e,r,i),ZP(r,i,r,i)}function Vet(t,e,r){if(t==null||e==null||r.source.spatialReference===t&&r.dest.spatialReference===e)return r;const i=JL(t,r.source),n=JL(e,r.dest);return i===ee.UNKNOWN&&n===ee.UNKNOWN?yo(t,e)?r.projector=qi:r.projector=null:r.projector=e3[i][n],r}function $se(){return{source:{spatialReference:null,spatialReferenceId:ee.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:ee.UNKNOWN,metersPerUnit:1},projector:qi}}const YAe={spatialReference:null,spatialReferenceId:ee.UNKNOWN},Bet={spatialReference:null,spatialReferenceId:ee.UNKNOWN},WB=$se(),JP=Ut(1),QP=ul(1),YB=Math.PI,XAe=.5*YB,fT=ni.radius,Dpe=fT*YB/180,Npe=180/(fT*YB);function an(t,e,r,i,n,s,o=1){const a=Pb(e,n,WB);if(a==null)return!1;if(a===qi){if(t===i&&r===s)return!0;const c=r+3*o;for(let u=r,h=s;u<c;u++,h++)i[h]=t[u];return!0}const l=r+3*o;for(let c=r,u=s;c<l;c+=3,u+=3)a(t,c,i,u);return!0}const VWt=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:an},Symbol.toStringTag,{value:"Module"}));function Fpe(t,e,r,i,n,s){return X4[0]=t,X4[1]=e,X4[2]=r,an(X4,i,0,n,s,0,1)}const X4=C();let Z4=0,Hj=class cJ{static fromGE(e){const r=new cJ;return r._wkt=e.wkt,r._wkid=e.wkid,r._isInverse=e.isInverse,r}constructor(e){this.uid=Z4++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=Z4++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=Z4++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=Z4++}getInverse(){const e=new cJ;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},Iz=class nR{static cacheKey(e,r){var i,n,s,o,a,l;return[((i=e.wkid)==null?void 0:i.toString())??"-1",((n=e.wkt)==null?void 0:n.toString())??"",((s=e.wkt2)==null?void 0:s.toString())??"",((o=r.wkid)==null?void 0:o.toString())??"-1",((a=r.wkt)==null?void 0:a.toString())??"",((l=r.wkt2)==null?void 0:l.toString())??""].join()}static fromGE(e){const r=new nR;let i="";for(const n of e.steps){const s=Hj.fromGE(n);r.steps.push(s),i+=s.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e==null?void 0:e.steps)for(const r of e.steps)r instanceof Hj?this.steps.push(r):this.steps.push(new Hj({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const e=new nR;e.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const r of this.steps)e+=r.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,r,i){this._cachedProjection[nR.cacheKey(e,r)]=i}getCachedGeTransformation(e,r){let i="";for(const s of this.steps)i+=s.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const n=this._cachedProjection[nR.cacheKey(e,r)];return n===void 0?null:n}};function Ise(t,e,r){if(e==null||r==null||r.vcsWkid||yo(e,r)||wb(e)||wb(r))return null;const i=zT(e)/zT(r);if(i===1)return null;switch(t){case"point":case"esriGeometryPoint":return n=>Get(n,i);case"polyline":case"esriGeometryPolyline":return n=>Het(n,i);case"polygon":case"esriGeometryPolygon":return n=>jet(n,i);case"multipoint":case"esriGeometryMultipoint":return n=>qet(n,i);case"extent":case"esriGeometryEnvelope":return n=>Wet(n,i);default:return null}}function Get(t,e){(t==null?void 0:t.z)!=null&&(t.z*=e)}function jet(t,e){if(t)for(const r of t.rings)for(const i of r)i.length>2&&(i[2]*=e)}function Het(t,e){if(t)for(const r of t.paths)for(const i of r)i.length>2&&(i[2]*=e)}function qet(t,e){if(t)for(const r of t.points)r.length>2&&(r[2]*=e)}function Wet(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let Kf=null,Ab=null,wI=null,g6={};const Lse=new nN;function HA(){return!!Kf&&s3e()}function ZAe(){return!!HA()||(Ft(Lse),KP(),!1)}function tC(t,e){return!t||!e||ju(t,e)||ZAe()}function JAe(t,e){return!ju(t,e)&&!HA()}function KP(t){return wI==null&&(wI=Promise.all([o3e(),re(()=>import("./geometryEngineBase-Bc2ESXYb.js"),__vite__mapDeps([])).then(e=>e.g),re(()=>import("./hydrated-rTNDlpsd.js"),__vite__mapDeps([]))])),wI.then(([,e,{hydratedAdapter:r}])=>{dt(t),Ab=r,Kf=e.default,Kf._enableProjection(LYe),Lse.notify()})}function lw(t,e,r=null,i=null){return Array.isArray(t)?t.length===0?[]:uJ(Ab,t,t[0].spatialReference,e,r,i):uJ(Ab,[t],t.spatialReference,e,r,i)[0]}function uJ(t,e,r,i,n=null,s=null){if(r==null||i==null)return e;if(ju(r,i,n))return e.map(o=>xI(o,r,i));if(n==null&&pz(r))return e.map(o=>xI(o,r,Ve.WGS84)).map(o=>Ob(o,i));if(n==null&&pz(i))return e.map(o=>Ob(o,Ve.WGS84)).map(o=>xI(o,Ve.WGS84,i));if(n==null){const o=Iz.cacheKey(r,i);g6[o]!==void 0?n=g6[o]:((n=KAe(r,i,void 0))==null&&(n=new Iz),g6[o]=n)}if(Kf==null||t==null)throw new XB;return s!=null?Kf._project(t,e,r,i,n,s):Kf._project(t,e,r,i,n)}function Yet(t,e){const r=QAe([t],e);return r.pending!=null?{pending:r.pending,geometry:null}:r.geometries!=null?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function QAe(t,e){if(!HA()){for(const r of t)if(r!=null&&!yo(r.spatialReference,e)&&Ng(r.spatialReference)&&Ng(e)&&!ju(r.spatialReference,e))return Ft(Lse),{pending:KP(),geometries:null}}return{pending:null,geometries:t.map(r=>r==null?null:yo(r.spatialReference,e)?r:Ng(r.spatialReference)&&Ng(e)?Ob(r,e):null)}}function KAe(t,e,r=null){if(t==null||e==null)return null;if(Kf==null||Ab==null)throw new XB;const i=Kf._getTransformation(Ab,t,e,r,r==null?void 0:r.spatialReference);return i!==null?Iz.fromGE(i):null}function Xet(t,e,r=null){if(Kf==null||Ab==null)throw new XB;const i=Kf._getTransformationBySuitability(Ab,t,e,r,r==null?void 0:r.spatialReference);if(i!==null){const n=[];for(const s of i)n.push(Iz.fromGE(s));return n}return[]}let XB=class extends B{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function Zet(){Kf=null,Ab=null,wI=null,g6={}}const Jet={get loadPromise(){return wI}};function Ob(t,e){try{const r=lw(t,e);if(r==null)return null;"xmin"in t&&"xmin"in r&&(r.zmin=t.zmin,r.zmax=t.zmax);const i=Ise(r.type,t.spatialReference,e);return i!=null&&i(r),r}catch(r){if(!(r instanceof XB))throw r;return null}}async function Mb(t,e,r){const i=t.spatialReference;return i!=null&&e!=null&&await mN(i,e,null,r),Ob(t,e)}function ju(t,e,r){return!r&&(!!yo(t,e)||Ng(t)&&Ng(e)&&!!Pb(t,e,WB))}async function mN(t,e,r,i){if(HA())return YU(i);if(Array.isArray(t)){for(const{source:n,dest:s,geographicTransformation:o}of t)if(n&&s&&!ju(n,s,o))return KP(i)}else if(t&&e&&!ju(t,e,r))return KP(i);return YU(i)}function xI(t,e,r){return t?"x"in t?tOe(t,e,new He,r,0):"xmin"in t?oOe(t,e,new br,r,0):"rings"in t?sOe(t,e,new ku,r,0):"paths"in t?iOe(t,e,new Ff,r,0):"points"in t?rOe(t,e,new VA,r,0):null:null}function eOe(t,e,r=e.spatialReference,i=0){return r!=null&&t.spatialReference!=null&&tOe(t,t.spatialReference,e,r,i)!=null}function tOe(t,e,r,i,n){Bl[0]=t.x,Bl[1]=t.y;const s=t.z;return Bl[2]=s!==void 0?s:n,an(Bl,e,0,Bl,i,0,1)?(r.x=Bl[0],r.y=Bl[1],r.spatialReference=i,s!==void 0||wb(i)?(r.z=Bl[2],r.hasZ=!0):(r.z=void 0,r.hasZ=!1),t.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=t.m,r.hasM=!0),r):null}function Qet(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&rOe(t,t.spatialReference,e,r,i)!=null}function rOe(t,e,r,i,n){const{points:s,hasZ:o,hasM:a}=t,l=[],c=s.length,u=[];for(const p of s)u.push(p[0],p[1],o?p[2]:n);if(!an(u,e,0,u,i,0,c))return null;const h=o||wb(i);for(let p=0;p<c;++p){const f=3*p,g=u[f],y=u[f+1];h&&a?l.push([g,y,u[f+2],s[p][3]]):h?l.push([g,y,u[f+2]]):a?l.push([g,y,s[p][2]]):l.push([g,y])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function Ket(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&iOe(t,t.spatialReference,e,r,i)!=null}function iOe(t,e,r,i,n){const{paths:s,hasZ:o,hasM:a}=t,l=[];if(!aOe(s,o??!1,a??!1,e,l,i,n))return null;const c=o||wb(i);return r.paths=l,r.spatialReference=i,r.hasZ=c,r.hasM=a,r}function nOe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&sOe(t,t.spatialReference,e,r,i)!=null}function sOe(t,e,r,i,n){const{rings:s,hasZ:o,hasM:a}=t,l=[];if(!aOe(s,o??!1,a??!1,e,l,i,n))return null;const c=o||wb(i);return r.rings=l,r.spatialReference=i,r.hasZ=c,r.hasM=a,r}function ett(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&oOe(t,t.spatialReference,e,r,i)!=null}function oOe(t,e,r,i,n){const{xmin:s,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=t,h=c?t.zmin:n;if(!Fpe(s,o,h,e,Bl,i))return null;const p=c||wb(i);r.xmin=Bl[0],r.ymin=Bl[1],p&&(r.zmin=Bl[2]);const f=c?t.zmax:n;return Fpe(a,l,f,e,Bl,i)?(r.xmax=Bl[0],r.ymax=Bl[1],p&&(r.zmax=Bl[2]),u&&(r.mmin=t.mmin,r.mmax=t.mmax),r.spatialReference=i,r):null}function aOe(t,e,r,i,n,s,o=0){const a=new Array;for(const u of t)for(const h of u)a.push(h[0],h[1],e?h[2]:o);if(!an(a,i,0,a,s,0,a.length/3))return!1;let l=0;n.length=0;const c=e||wb(s);for(const u of t){const h=new Array;for(const p of u)c&&r?h.push([a[l++],a[l++],a[l++],p[3]]):c?h.push([a[l++],a[l++],a[l++]]):r?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);n.push(h)}return!0}function Rb(t){return t!=null&&zAe(t)!=null}const Bl=C(),GWt=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:Rb,canProjectWithoutEngine:ju,getTransformation:KAe,getTransformations:Xet,initializeProjection:mN,isLoaded:HA,isLoadedOrLoad:ZAe,isLoadedOrLoadFor:tC,load:KP,project:lw,projectExtent:ett,projectMany:uJ,projectMultipoint:Qet,projectOrLoad:Yet,projectOrLoadMany:QAe,projectPoint:eOe,projectPolygon:nOe,projectPolyline:Ket,projectWithZConversion:Mb,projectWithoutEngine:xI,requiresLoad:JAe,test:Jet,tryProjectWithZConversion:Ob,unload:Zet},Symbol.toStringTag,{value:"Module"})),ttt=new Ve(f3e),sR=new Ve(pB),oR=new Ve(fB),jWt=new Ve(m3e);function Kl(t){const e=kpe.get(t);if(e)return e;let r=ttt;if(t)if(t===sR)r=sR;else if(t===oR)r=oR;else{const i=t.wkid,n=t.latestWkid;if(i!=null||n!=null)OP(i)||OP(n)?r=sR:(MP(i)||MP(n))&&(r=oR);else{const s=t.wkt2??t.wkt;if(s){const o=s.toUpperCase();o===rtt?r=sR:o===itt&&(r=oR)}}}return kpe.set(t,r),r}const kpe=new Map,rtt=sR.wkt.toUpperCase(),itt=oR.wkt.toUpperCase();function lOe(t,e,r){const i=Math.sin(t),n=Math.cos(t),s=Math.sin(e),o=Math.cos(e),a=r;return a[0]=-i,a[4]=-s*n,a[8]=o*n,a[12]=0,a[1]=n,a[5]=-s*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function ntt(t,e,r){return lOe(t,e,r),Bu(r,r),r}function Ua(t,e,r,i){if(t==null||i==null)return!1;const n=JL(t,YAe),s=JL(i,Bet);if(n===s&&!Upe(s)&&(n!==ee.UNKNOWN||yo(t,i)))return aN(r,e),!0;if(Upe(s)){const o=e3[n][ee.LON_LAT],a=e3[ee.LON_LAT][s];return o!=null&&a!=null&&(o(e,0,X_,0),a(X_,0,Z_,0),lOe(J4*X_[0],J4*X_[1],r),r[12]=Z_[0],r[13]=Z_[1],r[14]=Z_[2],!0)}if((s===ee.WEB_MERCATOR||s===ee.PLATE_CARREE||s===ee.WGS84)&&(n===ee.WGS84||n===ee.CGCS2000&&s===ee.PLATE_CARREE||n===ee.SPHERICAL_ECEF||n===ee.WEB_MERCATOR)){const o=e3[n][ee.LON_LAT],a=e3[ee.LON_LAT][s];return o!=null&&a!=null&&(o(e,0,X_,0),a(X_,0,Z_,0),n===ee.SPHERICAL_ECEF?ntt(J4*X_[0],J4*X_[1],r):cp(r),r[12]=Z_[0],r[13]=Z_[1],r[14]=Z_[2],!0)}return!1}function Upe(t){return t===ee.SPHERICAL_ECEF||t===ee.SPHERICAL_MARS_PCPF||t===ee.SPHERICAL_MOON_PCPF}const J4=Ut(1),X_=C(),Z_=C();function cOe(t,e){return t.isGeographic||t.isWebMercator&&(e??!0)}function uOe(t,e){switch(t.type){case"georeferenced":return e.isGeographic;case"local":return e.isGeographic||e.isWebMercator}}function Dse(t,e,r,i){if(i!==void 0){yb(K.getLogger(t),"option: geographic",{replacement:"use mesh vertexSpace and spatial reference to control how operations are performed",version:"4.29",warnOnce:!0});const n=e.type==="local";if(!cm(e)||i===n)return r.isGeographic||r.isWebMercator&&i;K.getLogger(t).warnOnce(`Specifying the 'geographic' parameter (${i}) for a Mesh vertex space of type "${e.type}" is not supported. This parameter will be ignored.`)}return uOe(e,r)}let Nse=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;n===void 0&&(n=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<9;n++)r[n]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<9;n++)this.typedBuffer[i++]=r[n]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};Nse.ElementCount=9;let Fse=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;n===void 0&&(n=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<16;n++)r[n]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<16;n++)this.typedBuffer[i++]=r[n]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};Fse.ElementCount=16;let T_=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;n===void 0&&(n=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.stride=n,this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,r){this.typedBuffer[e*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}};T_.ElementCount=1;function vo(t,e){return t[0]=e[0],t[1]=e[1],t}function yr(t,e,r){return t[0]=e,t[1]=r,t}function vf(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Ag(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function hOe(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function dOe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function stt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function ott(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function att(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function ltt(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function ctt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Eu(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function utt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function $b(t,e){const r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function Lz(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function kse(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function pOe(t){const e=t[0],r=t[1];return e*e+r*r}function Use(t,e){return t[0]=-e[0],t[1]=-e[1],t}function htt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function QL(t,e){const r=e[0],i=e[1];let n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t}function js(t,e){return t[0]*e[0]+t[1]*e[1]}function dtt(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function Dd(t,e,r,i){const n=e[0],s=e[1];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t}function ptt(t,e){e=e||1;const r=2*oN()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function fOe(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t}function $1(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}function ftt(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t}function mtt(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}function gtt(t,e,r,i){const n=e[0]-r[0],s=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=n*a-s*o+r[0],t[1]=n*o+s*a+r[1],t}function ytt(t,e){const r=t[0],i=t[1],n=e[0],s=e[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=n*n+s*s;a>0&&(a=1/Math.sqrt(a));const l=(r*n+i*s)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function _tt(t){return"vec2("+t[0]+", "+t[1]+")"}function mOe(t,e){return t[0]===e[0]&&t[1]===e[1]}function gOe(t,e){const r=t[0],i=t[1],n=e[0],s=e[1],o=ml();return Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))}function vtt(t,e,r,i,n){let s=e[0]-r[0],o=e[1]-r[1];const a=(i[0]*s+i[1]*o)*(n-1);return s=i[0]*a,o=i[1]*a,t[0]=e[0]+s,t[1]=e[1]+o,t}const btt=kse,wtt=Ag,xtt=hOe,Stt=dOe,yOe=$b,Ttt=Lz,Ett=pOe;Object.freeze(Object.defineProperty({__proto__:null,add:vf,angle:ytt,ceil:stt,copy:vo,cross:dtt,dist:yOe,distance:$b,div:Stt,divide:dOe,dot:js,equals:gOe,exactEquals:mOe,floor:ott,inverse:htt,len:btt,length:kse,lerp:Dd,max:ltt,min:att,mul:xtt,multiply:hOe,negate:Use,normalize:QL,projectAndScale:vtt,random:ptt,rotate:gtt,round:ctt,scale:Eu,scaleAndAdd:utt,set:yr,sqrDist:Ttt,sqrLen:Ett,squaredDistance:Lz,squaredLength:pOe,str:_tt,sub:wtt,subtract:Ag,transformMat2:fOe,transformMat2d:$1,transformMat3:ftt,transformMat4:mtt},Symbol.toStringTag,{value:"Module"}));let E_=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;n===void 0&&(n=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,yr(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e]=r[1]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};E_.ElementCount=2;let C_=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;n===void 0&&(n=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,se(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e]=r[2]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,n){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=n}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};C_.ElementCount=3;let P_=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;n===void 0&&(n=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,pn(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e++]=r[2],this.typedBuffer[e]=r[3]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,n,s){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e++]=n,this.typedBuffer[e]=s}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};P_.ElementCount=4;let ZB=class _Oe extends T_{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}static fromTypedArray(e,r){return new _Oe(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ZB.ElementType="f32";let S2=class hJ extends E_{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(hJ,e,r)}static fromTypedArray(e,r){return new hJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};S2.ElementType="f32";let mo=class dJ extends C_{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(dJ,e,r)}static fromTypedArray(e,r){return new dJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};mo.ElementType="f32";let hm=class pJ extends P_{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(pJ,e,r)}static fromTypedArray(e,r){return new pJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};hm.ElementType="f32";let Ib=class fJ extends Nse{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(fJ,e,r)}static fromTypedArray(e,r){return new fJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Ib.ElementType="f32";let zse=class mJ extends Nse{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(mJ,e,r)}static fromTypedArray(e,r){return new mJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};zse.ElementType="f64";let Vse=class gJ extends Fse{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(gJ,e,r)}static fromTypedArray(e,r){return new gJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Vse.ElementType="f32";let KL=class yJ extends Fse{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(yJ,e,r)}static fromTypedArray(e,r){return new yJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};KL.ElementType="f64";let Bse=class _J extends T_{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(_J,e,r)}static fromTypedArray(e,r){return new _J(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Bse.ElementType="f64";let Gse=class vJ extends E_{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(vJ,e,r)}static fromTypedArray(e,r){return new vJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Gse.ElementType="f64";let dp=class bJ extends C_{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(bJ,e,r)}static fromTypedArray(e,r){return new bJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};dp.ElementType="f64";let JB=class wJ extends P_{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(wJ,e,r)}static fromTypedArray(e,r){return new wJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};JB.ElementType="f64";let eA=class xJ extends T_{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(xJ,e,r)}static fromTypedArray(e,r){return new xJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};eA.ElementType="u8";let QB=class SJ extends E_{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(SJ,e,r)}static fromTypedArray(e,r){return new SJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};QB.ElementType="u8";let KB=class TJ extends C_{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(TJ,e,r)}static fromTypedArray(e,r){return new TJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};KB.ElementType="u8";let dl=class EJ extends P_{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(EJ,e,r)}static fromTypedArray(e,r){return new EJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};dl.ElementType="u8";let e7=class CJ extends T_{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(CJ,e,r)}static fromTypedArray(e,r){return new CJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};e7.ElementType="u16";let jse=class PJ extends E_{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(PJ,e,r)}static fromTypedArray(e,r){return new PJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};jse.ElementType="u16";let t7=class AJ extends C_{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(AJ,e,r)}static fromTypedArray(e,r){return new AJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};t7.ElementType="u16";let gN=class OJ extends P_{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(OJ,e,r)}static fromTypedArray(e,r){return new OJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};gN.ElementType="u16";let r7=class MJ extends T_{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(MJ,e,r)}static fromTypedArray(e,r){return new MJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};r7.ElementType="u32";let Hse=class RJ extends E_{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(RJ,e,r)}static fromTypedArray(e,r){return new RJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Hse.ElementType="u32";let vOe=class $J extends C_{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer($J,e,r)}static fromTypedArray(e,r){return new $J(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};vOe.ElementType="u32";let bOe=class IJ extends P_{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(IJ,e,r)}static fromTypedArray(e,r){return new IJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};bOe.ElementType="u32";let qse=class LJ extends T_{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(LJ,e,r)}static fromTypedArray(e,r){return new LJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};qse.ElementType="i8";let i7=class DJ extends E_{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(DJ,e,r)}static fromTypedArray(e,r){return new DJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};i7.ElementType="i8";let wOe=class NJ extends C_{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(NJ,e,r)}static fromTypedArray(e,r){return new NJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};wOe.ElementType="i8";let xOe=class FJ extends P_{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(FJ,e,r)}static fromTypedArray(e,r){return new FJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};xOe.ElementType="i8";let SOe=class kJ extends T_{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(kJ,e,r)}static fromTypedArray(e,r){return new kJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};SOe.ElementType="i16";let yN=class UJ extends E_{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(UJ,e,r)}static fromTypedArray(e,r){return new UJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};yN.ElementType="i16";let TOe=class zJ extends C_{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(zJ,e,r)}static fromTypedArray(e,r){return new zJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};TOe.ElementType="i16";let EOe=class VJ extends P_{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(VJ,e,r)}static fromTypedArray(e,r){return new VJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};EOe.ElementType="i16";let COe=class BJ extends T_{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(BJ,e,r)}static fromTypedArray(e,r){return new BJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};COe.ElementType="i32";let POe=class GJ extends E_{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(GJ,e,r)}static fromTypedArray(e,r){return new GJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};POe.ElementType="i32";let AOe=class jJ extends C_{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(jJ,e,r)}static fromTypedArray(e,r){return new jJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};AOe.ElementType="i32";let OOe=class HJ extends P_{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(HJ,e,r)}static fromTypedArray(e,r){return new HJ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};OOe.ElementType="i32";const n7=()=>K.getLogger("esri.geometry.support.meshUtils.normalProjection");function s7(t,e,r,i,n){return l7(i)?(a7(j0.TO_PCPF,mo.fromTypedArray(t),dp.fromTypedArray(e),dp.fromTypedArray(r),i,mo.fromTypedArray(n)),n):(n7().error("Cannot convert spatial reference to PCPF"),n)}function Wse(t,e,r,i,n){return l7(i)?(a7(j0.FROM_PCPF,mo.fromTypedArray(t),dp.fromTypedArray(e),dp.fromTypedArray(r),i,mo.fromTypedArray(n)),n):(n7().error("Cannot convert to spatial reference from PCPF"),n)}function Yse(t,e,r){return an(t,e,0,r,Kl(e),0,t.length/3),r}function Xse(t,e,r){return an(t,Kl(r),0,e,r,0,t.length/3),e}function MOe(t,e,r){return d_(Io,r),lm(e,t,Io),Ase(Io)||UB(e,e),e}function ROe(t,e,r){if(d_(Io,r),lm(e,t,Io,4),Ase(Io)||UB(e,e,4),t!==e)for(let i=3;i<t.length;i+=4)e[i]=t[i];return e}function o7(t,e,r,i,n){if(!l7(i))return n7().error("Cannot convert spatial reference to PCPF"),n;a7(j0.TO_PCPF,mo.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),dp.fromTypedArray(e),dp.fromTypedArray(r),i,mo.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function Zse(t,e,r,i,n){if(!l7(i))return n7().error("Cannot convert to spatial reference from PCPF"),n;a7(j0.FROM_PCPF,mo.fromTypedArray(t,16),dp.fromTypedArray(e),dp.fromTypedArray(r),i,mo.fromTypedArray(n,16));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function a7(t,e,r,i,n,s){if(!e)return;const o=r.count,a=Kl(n);if($Oe(n))for(let l=0;l<o;l++)i.getVec(l,Q4),e.getVec(l,Am),Ua(a,Q4,K4,a),jh(Io,K4),t===j0.FROM_PCPF&&hp(Io,Io),po(Am,Am,Io),s.setVec(l,Am);else for(let l=0;l<o;l++){i.getVec(l,Q4),e.getVec(l,Am),Ua(a,Q4,K4,a),jh(Io,K4);const c=fz(r.get(l,1));let u=Math.cos(c);t===j0.TO_PCPF&&(u=1/u),Io[0]*=u,Io[1]*=u,Io[2]*=u,Io[3]*=u,Io[4]*=u,Io[5]*=u,t===j0.FROM_PCPF&&hp(Io,Io),po(Am,Am,Io),me(Am,Am),s.setVec(l,Am)}return s}function l7(t){return $Oe(t)||Ctt(t)}function $Oe(t){return t.isWGS84||h3e(t)||nw(t)||sw(t)}function Ctt(t){return t.isWebMercator}var j0;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(j0||(j0={}));const Q4=C(),Am=C(),K4=xe(),Io=gi();function Jse(t,e,r){return cOe(e.spatialReference,r==null?void 0:r.geographic)?c7(t,e,!1,r):Att(t,e,r)}function IOe(t,e=fn){const{position:r,normal:i,tangent:n}=t;return{position:am(new Float64Array(r.length),r,e),normal:i!=null?MOe(i,new Float32Array(i.length),e):null,tangent:n!=null?ROe(n,new Float32Array(n.length),e):null}}function LOe(t,e,r,i){const{position:n,normal:s,tangent:o}=t;if(!cm(e))return{position:n,normal:s,tangent:o};const a=Pz(e,i);return Jse(IOe(t,r==null?void 0:r.localMatrix),a,{geographic:e.type==="local"})}function DOe(t,e,r){const i=gKe(e,r),n=e.spatialReference,s=cm(i);if(!s)return{vertexAttributes:Jse(t,e,r),vertexSpace:i,transform:null};const{position:o,normal:a,tangent:l}=t,c=uOe(i,n);switch(i.type){case"georeferenced":return c?{vertexAttributes:c7(t,e,s,r),vertexSpace:i,transform:null}:{vertexAttributes:{position:o,normal:a,tangent:l},vertexSpace:i,transform:new XT};case"local":return{vertexAttributes:{position:o,normal:a,tangent:l},vertexSpace:i,transform:new XT}}}function qJ(t,e,r){return cOe(e.spatialReference,r==null?void 0:r.geographic)?Kse(t,e,r):NOe(t,e,r)}function Ptt(t,e,r,i,n){if(!cm(e))return qJ(t,i,n);const{spatialReference:s}=i,o=LOe(t,e,r,s);return i.equals(Pz(e,s))?NOe(o,i,n):qJ(o,i,n)}function Qse({positions:t,transform:e,vertexSpace:r,inSpatialReference:i,outSpatialReference:n,outPositions:s,localMode:o}){const a=r.origin??Yn,l=r.origin!=null?(e==null?void 0:e.localMatrix)??fn:fn;if(r.type==="georeferenced"){const p=s??Go(t.length);if(EB(l,fn)?yKe(p,t):am(p,t,l),!aa(a,Yn)){const[f,g,y]=a;for(let v=0;v<p.length;v+=3)p[v]+=f,p[v+1]+=g,p[v+2]+=y}return an(p,i,0,p,n,0,p.length/3),p}let c=i;const u=Kl(i);c=n.isWebMercator&&o||!ju(i,u)?c:u,Ua(i,a,YS,c),Kr(YS,YS,l);const h=s??Go(t.length);return am(h,t,YS),an(h,c,0,h,n,0,h.length/3),h}function Att(t,e,r){const i=new Float64Array(t.position.length),n=t.position,s=e.x,o=e.y,a=e.z??0,l=_N(r?r.unit:null,e.spatialReference);for(let c=0;c<n.length;c+=3)i[c]=n[c]*l+s,i[c+1]=n[c+1]*l+o,i[c+2]=n[c+2]*l+a;return{position:i,normal:t.normal,tangent:t.tangent}}function c7(t,e,r,i){const n=e.spatialReference,s=FOe(e,i,YS),o=new Float64Array(t.position.length),a=Ott(t.position,s,n,o),l=d_(kOe,s),c=Mtt(a,o,t.normal,l,n),u=Rtt(a,o,t.tangent,l,n);if(r){const{x:h,y:p,z:f}=e;mse(a,a,[-h,-p,-(f??0)])}return{position:a,normal:c,tangent:u}}function Ott(t,e,r,i){am(i,t,e);const n=new Float64Array(t.length);return Xse(i,n,r)}function Mtt(t,e,r,i,n){if(r==null)return null;const s=new Float32Array(r.length);return lm(s,r,i),Wse(s,t,e,n,s),s}function Rtt(t,e,r,i,n){if(r==null)return null;const s=new Float32Array(r.length);lm(s,r,i,4);for(let o=3;o<s.length;o+=4)s[o]=r[o];return Zse(s,t,e,n,s),s}function NOe(t,e,r){const i=new Float64Array(t.position.length),n=t.position,s=e.x,o=e.y,a=e.z??0,l=_N(r?r.unit:null,e.spatialReference);for(let c=0;c<n.length;c+=3)i[c]=(n[c]-s)/l,i[c+1]=(n[c+1]-o)/l,i[c+2]=(n[c+2]-a)/l;return{position:i,normal:t.normal,tangent:t.tangent}}function Kse(t,e,r){const i=e.spatialReference;FOe(e,r,YS);const n=us(Dtt,YS),s=new Float64Array(t.position.length),o=$tt(t.position,i,n,s),a=d_(kOe,n);return{position:o,normal:Itt(t.normal,t.position,s,i,a),tangent:Ltt(t.tangent,t.position,s,i,a)}}function FOe(t,e,r){Ua(t.spatialReference,[t.x,t.y,t.z??0],r,Kl(t.spatialReference));const i=_N(e?e.unit:null,t.spatialReference);return g2(r,r,[i,i,i]),r}function $tt(t,e,r,i){const n=Yse(t,e,i),s=new Float64Array(n.length);return am(s,n,r),s}function Itt(t,e,r,i,n){if(t==null)return null;const s=s7(t,e,r,i,new Float32Array(t.length));return lm(s,s,n),s}function Ltt(t,e,r,i,n){if(t==null)return null;const s=o7(t,e,r,i,new Float32Array(t.length));return lm(s,s,n,4),s}function _N(t,e){if(t==null)return 1;const r=TZ(e);return 1/Lo(r,"meters",t)}const YS=xe(),Dtt=xe(),kOe=gi(),JWt=Object.freeze(Object.defineProperty({__proto__:null,applyTransform:IOe,georeference:Jse,georeferenceApplyTransform:LOe,georeferenceByTransform:DOe,georeferenceGlobal:c7,getUnitScale:_N,project:Qse,ungeoreference:qJ,ungeoreferenceByTransform:Ptt,ungeoreferenceGlobal:Kse},Symbol.toStringTag,{value:"Module"}));function Ntt([t,e,r,i,n,s],o,a,l){zpe??(zpe=new Float64Array(24));const c=zpe;return c[0]=t,c[1]=e,c[2]=r,c[3]=t,c[4]=n,c[5]=r,c[6]=i,c[7]=n,c[8]=r,c[9]=i,c[10]=e,c[11]=r,c[12]=t,c[13]=e,c[14]=s,c[15]=t,c[16]=n,c[17]=s,c[18]=i,c[19]=n,c[20]=s,c[21]=i,c[22]=e,c[23]=s,Qse({positions:c,transform:o,vertexSpace:a,inSpatialReference:l,outSpatialReference:l,outPositions:c}),zOe(c,l)}let zpe=null;function UOe(t){if(t.length===0)return Tse;const e=Ds([Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY]);return Ru(e,t),e}function zOe(t,e){const[r,i,n,s,o,a]=UOe(t);return new br({xmin:r,ymin:i,zmin:n,xmax:s,ymax:o,zmax:a,spatialReference:e})}function Cn(t,e,r,i){if(ju(t.spatialReference,r)){e5[0]=t.x,e5[1]=t.y;const s=t.z;return e5[2]=s??i??0,an(e5,t.spatialReference,0,e,r,0,1)}const n=Ob(t,r);return!!n&&(e[0]=n==null?void 0:n.x,e[1]=n==null?void 0:n.y,e[2]=(n==null?void 0:n.z)??i??0,!0)}async function Dz(t,e,r,i,n){return await mN(t.spatialReference,r,null,n),Cn(t,e,r,i)}const e5=C(),eD="esri.geometry.support.meshUtils.centerAt";function Ftt(t,e,r){var a;if(!((a=t.vertexAttributes)!=null&&a.position))return;const{vertexSpace:i}=t,n=(r==null?void 0:r.origin)??t.anchor,s=r==null?void 0:r.geographic,o=Dse(eD,i,n.spatialReference,s);cm(i)?ktt(t,e,n):o?Utt(t,e,n):ztt(t,e,n)}function ktt(t,e,r){const{vertexSpace:i}=t;if(!cm(i))return;const n=BOe,s=VOe;if(!Cn(e,s,t.spatialReference))return void K.getLogger(eD).error(`Failed to project centerAt location (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`);if(!Cn(r,n,t.spatialReference)){const a=t.origin;n[0]=a.x,n[1]=a.y,n[2]=a.z,K.getLogger(eD).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}const o=_e(Btt,s,n);i.origin=ge(C(),i.origin,o)}function Utt(t,e,r){const i=Kse(t.vertexAttributes,r),{position:n,normal:s,tangent:o}=c7(i,e,!1);t.vertexAttributes.position=n,t.vertexAttributes.normal=s,t.vertexAttributes.tangent=o,t.vertexAttributesChanged()}function ztt(t,e,r){const i=BOe,n=VOe;if(Cn(e,n,t.spatialReference)){if(!Cn(r,i,t.spatialReference)){const s=t.origin;i[0]=s.x,i[1]=s.y,i[2]=s.z,K.getLogger(eD).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}Vtt(t.vertexAttributes.position,n,i),t.vertexAttributesChanged()}else K.getLogger(eD).error(`Failed to project centerAt location (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}function Vtt(t,e,r){if(t)for(let i=0;i<t.length;i+=3)for(let n=0;n<3;n++)t[i+n]+=e[n]-r[n]}const VOe=C(),BOe=C(),Btt=C();async function Gtt(t,e,r){const{source:i}=e,{loadGLTFMesh:n}=await ff(re(()=>import("./loadGLTFMesh-CQB71I8C.js"),__vite__mapDeps([])),r),s=await Htt(i,r);dt(r);const o=n(new He({x:0,y:0,z:0,spatialReference:t.spatialReference}),s.url,{resolveFile:jtt(s),signal:r==null?void 0:r.signal,expectedType:s.type});o.then(()=>s.dispose(),()=>s.dispose());const{vertexAttributes:a,components:l}=await o;t.vertexAttributes=a,t.components=l}function jtt(t){const e=uB(t.url);return r=>{const i=cB(r,e,e),n=i?i.replace(/^ *\.\//,""):null;return(n?t.files.get(n):null)??r}}async function Htt(t,e){if(Array.isArray(t)){if(!t.length)throw new B("mesh-load-external:missing-assets","There must be at least one file to load");return t[0]instanceof File?Wtt(t):Ytt(t,e)}return GOe(t)}async function qtt(t,e){const{parts:r,assetMimeType:i,assetName:n}=t;if(r.length===1)return new Nz(r[0].partUrl);const s=await t.toBlob(e);return dt(e),Nz.fromBlob(s,YOe(n,i))}function GOe(t){return Nz.fromBlob(t,YOe(t.name,t.type))}function Wtt(t){return qOe(t.map(e=>({name:e.name,mimeType:e.type,source:GOe(e)})))}async function Ytt(t,e){const r=await WU(t.map(async i=>{const n=await qtt(i);return dt(e),{name:i.assetName,mimeType:i.assetMimeType,source:n}}));if(Ms(e))throw r.forEach(i=>i.source.dispose()),gr();return qOe(r)}const jOe=/^model\/gltf\+json$/,HOe=/^model\/gltf-binary$/,WJ=/\.gltf$/i,Xtt=/\.glb$/i;function qOe(t){const e=new Map;let r,i=null;for(const{name:n,mimeType:s,source:o}of t)i===null&&(jOe.test(s)||WJ.test(n)?(i=o.url,r="gltf"):(HOe.test(s)||Xtt.test(n))&&(i=o.url,r="glb")),e.set(n,o.url),o.files.forEach((a,l)=>e.set(l,a));if(i==null)throw new B("mesh-load-external:missing-files","Missing files to load external mesh source");return new Nz(i,()=>t.forEach(({source:n})=>n.dispose()),e,r)}let Nz=class WOe{constructor(e,r=()=>{},i=new Map,n){this.url=e,this.dispose=r,this.files=i,this.type=n}static fromBlob(e,r){const i=URL.createObjectURL(e);return new WOe(i,()=>URL.revokeObjectURL(i),void 0,r)}};function YOe(t,e){return jOe.test(e)||WJ.test(t)?"gltf":HOe.test(e)||WJ.test(t)?"glb":void 0}const Ztt=[["binary","application/octet-stream","bin",""]];function Jtt(t,e){return ZOe(e.name,(t==null?void 0:t.supportedFormats)??[])!=null}function Qtt(t,e){if(!t)return!1;const r=XOe(e,t.supportedFormats??[]);return r!=null&&t.editFormats.includes(r)}function Fz(t,e){return toe(ert(t,e))}function kz(t,e){return toe(ZOe(t,e))}function QWt(t,e){return JOe(Ktt(t,e))}function XOe(t,e){return kz(t.name,e)??Fz(t.type,e)}function eoe(t){return[...Ztt,...t]}function Ktt(t,e){return eoe(e).find(r=>toe(r)===t)}function ert(t,e){const r=t.toLowerCase();return eoe(e).find(i=>JOe(i)===r)}function ZOe(t,e){const r=t.toLowerCase();return eoe(e).find(i=>trt(i).some(n=>r.endsWith(n)))}function toe(t){return t==null?void 0:t[0]}function JOe(t){return t==null?void 0:t[1].toLowerCase()}function trt(t){return(t==null?void 0:t[2].split(",").map(e=>e.toLowerCase()))??[]}function KWt(t){var e;return(e=t.tables)==null?void 0:e.find(r=>r.role==="assetMaps")}let QOe=class{constructor(e,r,i){this.assetName=e,this.assetMimeType=r,this.parts=i}equals(e){return this===e||this.assetName===e.assetName&&this.assetMimeType===e.assetMimeType&&ny(this.parts,e.parts,(r,i)=>r.equals(i))}isOnService(e){return this.parts.every(r=>r.isOnService(e))}makeHash(){let e="";for(const r of this.parts)e+=r.partHash;return e}async toBlob(e){const{parts:r}=this;if(r.length===1)return r[0].toBlob(e);const i=await Promise.all(r.map(n=>n.toBlob(e)));return dt(e),new Blob(i)}},tYt=class{constructor(e,r){this.partUrl=e,this.partHash=r}equals(e){return this===e||this.partUrl===e.partUrl&&this.partHash===e.partHash}isOnService(e){return this.partUrl.startsWith(`${e.path}/assets/`)}async toBlob(e){const{data:r}=await Vt(this.partUrl,{responseType:"blob"});return dt(e),r}};function Vpe(t){return rrt(t==null?void 0:t.source)}function Bpe(t){return Array.isArray(t)?t.every(e=>e instanceof QOe):!1}const Gpe=/^(model\/gltf\+json)|(model\/gltf-binary)$/,jpe=/\.(gltf|glb)/i;function rrt(t){return t?Array.isArray(t)?t.some(Hpe):Hpe(t):!1}function Hpe(t){if(t instanceof File){const{type:e,name:r}=t;return Gpe.test(e)||jpe.test(r)}return Gpe.test(t.assetMimeType)||jpe.test(t.assetName)}function irt(t,e){if(!t)return!1;const{source:r}=t;return srt(r,e)}function nrt(t,e){if(t===e)return!0;const{source:r}=t,{source:i}=e;if(r===i)return!0;if(Bpe(r)&&Bpe(i)){if(r.length!==i.length)return!1;const n=(a,l)=>a.assetName<l.assetName?-1:a.assetName>l.assetName?1:0,s=[...r].sort(n),o=[...i].sort(n);for(let a=0;a<s.length;++a)if(!s[a].equals(o[a]))return!1;return!0}return!1}function srt(t,e){if(Array.isArray(t)){const r=t;return r.length>0&&r.every(i=>qpe(i,e))}return qpe(t,e)}function qpe(t,e){return t instanceof QOe&&t.isOnService(e)}function iYt(t,e){return t instanceof File?XOe(t,e):Fz(t.assetMimeType,e)??kz(t.assetName,e)}function nYt(t){return Array.isArray(t)?t:[t]}function sYt(t){return!!t.original}let dv=class extends Tb{constructor(){super(),this.externalSources=new St,this._explicitDisplaySource=null,this.addHandles(jo(()=>this.externalSources,"after-remove",({item:e})=>{e===this._explicitDisplaySource&&(this._explicitDisplaySource=null)},{sync:!0,onListenerRemove:()=>this._explicitDisplaySource=null}))}get displaySource(){return this._explicitDisplaySource??this._implicitDisplaySource}set displaySource(e){if(e!=null&&!Vpe(e))throw new Error("Cannot use this source for display: it is not in a supported format.");this._explicitDisplaySource=e,e&&this.externalSources.every(r=>!nrt(r,e))&&this.externalSources.add(e)}clearSources(){this.externalSources.removeAll()}getExternalSourcesOnService(e){return this.externalSources.items.filter(r=>irt(r,e))}get _implicitDisplaySource(){return this.externalSources.find(Vpe)}};d([m()],dv.prototype,"externalSources",void 0),d([m()],dv.prototype,"displaySource",null),d([m()],dv.prototype,"_implicitDisplaySource",null),d([m()],dv.prototype,"_explicitDisplaySource",void 0),dv=d([F("esri.geometry.support.meshUtils.Metadata")],dv);function ort(){const{faceDescriptions:t,faceVertexOffsets:e,uvScales:r}=mrt,i=4*t.length,n=new Float64Array(3*i),s=new Float32Array(3*i),o=new Float32Array(2*i),a=new Uint32Array(2*t.length*3);let l=0,c=0,u=0,h=0;for(let p=0;p<t.length;p++){const f=t[p],g=l/3;for(const v of e)a[h++]=g+v;const y=f.corners;for(let v=0;v<4;v++){const b=y[v];let w=0;o[u++]=.25*r[v][0]+f.uvOrigin[0],o[u++]=f.uvOrigin[1]-.25*r[v][1];for(let x=0;x<3;x++)f.axis[x]!==0?(n[l++]=.5*f.axis[x],s[c++]=f.axis[x]):(n[l++]=.5*b[w++],s[c++]=0)}}return{position:n,normal:s,uv:o,faces:a}}function art(t,e){const r=t.components[0],i=r.faces,n=grt[e],s=6*n,o=new Array(6),a=new Array(i.length-6);let l=0,c=0;for(let u=0;u<i.length;u++)u>=s&&u<s+6?o[l++]=i[u]:a[c++]=i[u];if(t.vertexAttributes.uv!=null){const u=new Float32Array(t.vertexAttributes.uv),h=4*n*2,p=[0,1,1,1,1,0,0,0];for(let f=0;f<p.length;f++)u[h+f]=p[f];t.vertexAttributes.uv=u}return t.components=[new Eb({faces:o,material:r.material}),new Eb({faces:a})],t}function lrt(t=0){const e=Math.round(8*2**t),r=2*e,i=(e-1)*(r+1)+2*r,n=new Float64Array(3*i),s=new Float32Array(3*i),o=new Float32Array(2*i),a=new Uint32Array(3*((e-1)*r*2));let l=0,c=0,u=0,h=0;for(let p=0;p<=e;p++){const f=p/e*Math.PI+.5*Math.PI,g=Math.cos(f),y=Math.sin(f);No[2]=y;const v=p===0||p===e,b=v?r-1:r;for(let w=0;w<=b;w++){const x=w/b*2*Math.PI;No[0]=-Math.sin(x)*g,No[1]=Math.cos(x)*g;for(let S=0;S<3;S++)n[l]=.5*No[S],s[l]=No[S],++l;o[c++]=(w+(v?.5:0))/r,o[c++]=p/e,p!==0&&w!==r&&(p!==e&&(a[u++]=h,a[u++]=h+1,a[u++]=h-r),p!==1&&(a[u++]=h,a[u++]=h-r,a[u++]=h-r-1)),h++}}return{position:n,normal:s,uv:o,faces:a}}function crt(t=0){const r=Math.round(16*2**t),i=4*(r+1)+2*r,n=new Float64Array(3*i),s=new Float32Array(3*i),o=new Float32Array(2*i),a=new Uint32Array(3*(4*r));let l=0,c=0,u=0,h=0,p=0;for(let f=0;f<=5;f++){const g=f===0||f===5,y=f<=1||f>=4,v=f===2||f===4,b=g?r-1:r;for(let w=0;w<=b;w++){const x=w/b*2*Math.PI,S=g?0:.5;No[0]=S*Math.sin(x),No[1]=S*-Math.cos(x),No[2]=f<=2?.5:-.5;for(let E=0;E<3;E++)n[l++]=No[E],s[c++]=y?E===2?f<=1?1:-1:0:E===2?0:No[E]/S;o[u++]=(w+(g?.5:0))/r,o[u++]=f<=1?1*f/3:f<=3?1*(f-2)/3+1/3:1*(f-4)/3+2/3,v||f===0||w===r||(f!==5&&(a[h++]=p,a[h++]=p+1,a[h++]=p-r),f!==1&&(a[h++]=p,a[h++]=p-r,a[h++]=p-r-1)),p++}}return{position:n,normal:s,uv:o,faces:a}}function urt(t,e){const r=typeof e=="number"?e:e!=null?e.width:1,i=typeof e=="number"?e:e!=null?e.height:1;switch(t){case"up":case"down":return{width:r,depth:i};case"north":case"south":return{width:r,height:i};case"east":case"west":return{depth:r,height:i}}}function hrt(t){const e=DO.facingAxisOrderSwap[t],r=DO.position,i=DO.normal,n=new Float64Array(r.length),s=new Float32Array(i.length);let o=0;for(let a=0;a<4;a++){const l=o;for(let c=0;c<3;c++){const u=e[c],h=Math.abs(u)-1,p=u>=0?1:-1;n[o]=r[l+h]*p,s[o]=i[l+h]*p,o++}}return{position:n,normal:s,uv:new Float32Array(DO.uv),faces:new Uint32Array(DO.faces),isPlane:!0}}const B2=1,G2=2,j2=3,DO={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[j2,B2,G2],west:[-j2,-B2,G2],north:[-B2,j2,G2],south:[B2,-j2,G2],up:[B2,G2,j2],down:[B2,-G2,-j2]}};function t5(t,e,r){t.isPlane||drt(t),frt(t,prt(r==null?void 0:r.size,r==null?void 0:r.unit,e.spatialReference));const{vertexAttributes:i,vertexSpace:n,transform:s}=DOe(t,e,{vertexSpace:r==null?void 0:r.vertexSpace,geographic:r==null?void 0:r.geographic});return{vertexAttributes:new zl({...i,uv:t.uv}),vertexSpace:n,transform:s,components:[new Eb({faces:t.faces,material:(r==null?void 0:r.material)||null})],spatialReference:e.spatialReference}}function drt(t){for(let e=0;e<t.position.length;e+=3)t.position[e+2]+=.5}function prt(t,e,r){const i=_N(e,r);if(t==null&&i===1)return null;if(t==null)return[i,i,i];if(typeof t=="number"){const n=t*i;return[n,n,n]}return[t.width!=null?t.width*i:i,t.depth!=null?t.depth*i:i,t.height!=null?t.height*i:i]}function frt(t,e){if(e!=null){J_[0]=e[0],J_[4]=e[1],J_[8]=e[2];for(let r=0;r<t.position.length;r+=3){for(let i=0;i<3;i++)No[i]=t.position[r+i];po(No,No,J_);for(let i=0;i<3;i++)t.position[r+i]=No[i]}if(e[0]!==e[1]||e[1]!==e[2]){J_[0]=1/e[0],J_[4]=1/e[1],J_[8]=1/e[2];for(let r=0;r<t.normal.length;r+=3){for(let i=0;i<3;i++)No[i]=t.normal[r+i];po(No,No,J_),me(No,No);for(let i=0;i<3;i++)t.normal[r+i]=No[i]}}}}const mrt={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},grt={south:0,east:1,north:2,west:3,up:4,down:5},No=C(),J_=gi();function KOe(t,e,{vertexSpace:r,spatialReference:i}){if(r.type==="georeferenced"){const c=t;if(!Cn(e,c,i))return!1;const{origin:u}=r;return _e(t,c,u),!0}const n=Kl(i),s=t;if(!Cn(e,s,n))return!1;const{origin:o}=r,a=Wpe;if(!Ua(i,o,a,n))return!1;const l=us(Wpe,a);return l!=null&&(ze(t,s,l),!0)}const Wpe=xe(),roe="esri.geometry.support.meshUtils.rotate";function yrt(t,e,r){var l;if(!((l=t.vertexAttributes)!=null&&l.position)||e[3]===0)return;const{spatialReference:i,vertexSpace:n}=t,s=(r==null?void 0:r.origin)??t.anchor,o=r==null?void 0:r.geographic,a=Dse(roe,n,i,o);fAe(t)?_rt(t,e,s):a?vrt(t,e,s):brt(t,e,s)}function _rt(t,e,r){t.transform??(t.transform=new XT);const{vertexSpace:i,transform:n,spatialReference:s}=t,[o,a,l]=i.origin,c=new He({x:o,y:a,z:l,spatialReference:s}),u=t3;if(c.equals(r))se(u,0,0,0);else if(!KOe(u,r,t))return void K.getLogger(roe).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh (wkid:${s.wkid}) ${i.type} vertex space. Projection may be possible after calling projection.load().`);jP(Jpe,e,WL(e));const h=Qne(Ype,Jpe,Yn,Fg,u),{localMatrix:p}=n,f=Kr(Ype,h,p);n.scale=SB(C(),f),g2(f,f,Zne(t3,n.scale)),n.rotation=cAe(f),n.translation=zP(C(),f)}function vrt(t,e,r){const i=t.spatialReference,n=Kl(i),s=eMe;Cn(r,s,n)||Cn(t.origin,s,n);const o=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,c=new Float64Array(o.length),u=a!=null?new Float32Array(a.length):null,h=l!=null?new Float32Array(l.length):null;Ua(n,s,Uz,n),jh(Zpe,Uz);const p=Xpe;po(Xpe,e,Zpe),p[3]=e[3],Yse(o,i,c),a!=null&&u!=null&&s7(a,o,c,i,u),l!=null&&h!=null&&o7(l,o,c,i,h),G3(c,p,3,s),Xse(c,o,i),a!=null&&u!=null&&(G3(u,p,3),Wse(u,o,c,i,a)),l!=null&&h!=null&&(G3(h,p,4),Zse(h,o,c,i,l)),t.vertexAttributesChanged()}function brt(t,e,r){const i=eMe;if(!Cn(r,i,t.spatialReference)){const n=t.origin;i[0]=n.x,i[1]=n.y,i[2]=n.z,K.getLogger(roe).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}G3(t.vertexAttributes.position,e,3,i),G3(t.vertexAttributes.normal,e,3),G3(t.vertexAttributes.tangent,e,4),t.vertexAttributesChanged()}function G3(t,e,r,i=Yn){if(t!=null){Gu(Uz,WL(e),e);for(let n=0;n<t.length;n+=r){for(let s=0;s<3;s++)t3[s]=t[n+s]-i[s];ze(t3,t3,Uz);for(let s=0;s<3;s++)t[n+s]=t3[s]+i[s]}}}const t3=C(),Ype=xe(),Xpe=vm(),Uz=xe(),Zpe=gi(),eMe=C(),Jpe=Gc(),ioe="esri.geometry.support.meshUtils.scale";function wrt(t,e,r){var l;if(!((l=t.vertexAttributes)!=null&&l.position))return;const{vertexSpace:i,spatialReference:n}=t,s=(r==null?void 0:r.origin)??t.anchor,o=r==null?void 0:r.geographic,a=Dse(ioe,i,n,o);fAe(t)?xrt(t,e,s):a?Srt(t,e,s):Trt(t,e,s)}function xrt(t,e,r){t.transform??(t.transform=new XT);const{vertexSpace:i,transform:n,spatialReference:s}=t,[o,a,l]=i.origin,c=new He({x:o,y:a,z:l,spatialReference:s}),u=r3;if(c.equals(r))se(u,0,0,0);else if(!KOe(u,r,t))return void K.getLogger(ioe).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh (wkid:${s.wkid}) ${i.type} vertex space. Projection may be possible after calling projection.load().`);const h=se(Ert,e,e,e),p=Qne(Qpe,DB,Yn,h,u),{localMatrix:f}=n,g=Kr(Qpe,p,f);n.scale=SB(C(),g),g2(g,g,Zne(r3,n.scale)),n.rotation=cAe(g),n.translation=zP(C(),g)}function Srt(t,e,r){const i=t.spatialReference,n=Kl(i),s=rMe;Cn(r,s,n)||Cn(t.origin,s,n);const o=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,c=new Float64Array(o.length),u=a!=null?new Float32Array(a.length):null,h=l!=null?new Float32Array(l.length):null;Yse(o,i,c),a!=null&&u!=null&&s7(a,o,c,i,u),l!=null&&h!=null&&o7(l,o,c,i,h),tMe(c,e,s),Xse(c,o,i),a!=null&&u!=null&&Wse(u,o,c,i,a),l!=null&&h!=null&&Zse(h,o,c,i,l),t.vertexAttributesChanged()}function Trt(t,e,r){const i=rMe;if(!Cn(r,i,t.spatialReference)){const n=t.origin;i[0]=n.x,i[1]=n.y,i[2]=n.z,K.getLogger(ioe).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}tMe(t.vertexAttributes.position,e,i),t.vertexAttributesChanged()}function tMe(t,e,r=Yn){if(t)for(let i=0;i<t.length;i+=3){for(let n=0;n<3;n++)r3[n]=t[i+n]-r[n];oe(r3,r3,e);for(let n=0;n<3;n++)t[i+n]=r3[n]+r[n]}}const r3=C(),Ert=C(),Qpe=xe(),rMe=C();var hd;const iMe="esri.geometry.Mesh";function Om(){return K.getLogger(iMe)}const Crt={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:N0,local:vI}};let Rl=hd=class extends ay.LoadableMixin(hB(w_)){constructor(t){super(t),this.components=null,this.vertexSpace=new N0,this.transform=null,this.metadata=new dv,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new zl,this.type="mesh"}initialize(){(this.metadata.externalSources.length===0||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.addHandles(pe(()=>{var t;return{vertexAttributes:this.vertexAttributes,components:(t=this.components)==null?void 0:t.map(e=>e.clone())}},()=>this._clearSources(),{once:!0,sync:!0}))})}get hasExtent(){var t;return this.loaded?this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0):((t=this.metadata.displaySource)==null?void 0:t.extent)!=null}get _transformedExtent(){const{components:t,spatialReference:e,vertexAttributes:r,vertexSpace:i}=this,n=r.position;if(n.length===0||t&&t.length===0)return new br({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:e});if(cm(i)){const{_untransformedBounds:s,transform:o}=this;return Ntt(s,o,i,e)}return zOe(n,e)}get _untransformedBounds(){return UOe(this.vertexAttributes.position)}get anchor(){const t=Pz(this.vertexSpace,this.spatialReference);if(t!=null)return t;const{center:e,zmin:r}=this._transformedExtent;return new He({x:e.x,y:e.y,z:r,spatialReference:this.spatialReference})}get origin(){const t=Pz(this.vertexSpace,this.spatialReference);return t??this._transformedExtent.center}get extent(){var t,e;return this.loaded||((e=(t=this.metadata)==null?void 0:t.displaySource)==null?void 0:e.extent)==null?this._transformedExtent:this.metadata.displaySource.extent.clone()}addComponent(t){this._checkIfLoaded("addComponent()")&&(this.components||(this.components=[]),this.components.push(Eb.from(t)),this.notifyChange("components"))}removeComponent(t){if(this._checkIfLoaded("removeComponent()")){if(this.components){const e=this.components.indexOf(t);if(e!==-1)return this.components.splice(e,1),void this.notifyChange("components")}Om().error("removeComponent()",cKe)}}rotate(t,e,r,i){return eKe(t,e,r,Kpe),yrt(this,Kpe,i),this}offset(t,e,r){if(!this._checkIfLoaded("offset()"))return this;const{vertexSpace:i,vertexAttributes:n}=this,s=n==null?void 0:n.position;if(!s)return this;if(cm(i)){const[o,a,l]=i.origin;i.origin=Ce(o+t,a+e,l+r)}else{for(let o=0;o<s.length;o+=3)s[o]+=t,s[o+1]+=e,s[o+2]+=r;this.vertexAttributesChanged()}return this}scale(t,e){return this._checkIfLoaded("scale()")?(wrt(this,t,e),this):this}centerAt(t,e){return this._checkIfLoaded("centerAt()")?(Ftt(this,t,e),this):this}load(t){const{metadata:{displaySource:e}}=this;return e&&this.addResolvingPromise(Gtt(this,e,t)),Promise.resolve(this)}addExternalSources(t){this.metadata.externalSources.addMany(t)}updateDisplaySource(t){this.metadata.displaySource=t}clone(){return this.cloneWithVertexSpace(this.vertexSpace.clone())}cloneWithVertexSpace(t){var i;let e=null;if(this.components){const n=new Map,s=new Map;e=this.components.map(o=>o.cloneWithDeduplication(n,s))}const r={components:e,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),vertexSpace:t,transform:((i=this.transform)==null?void 0:i.clone())??null,metadata:this.metadata.clone()};return new hd(r)}cloneShallow(){return new hd({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(t){const e=re(()=>import("./gltfexport-COIuAb2s.js"),__vite__mapDeps([])),r=this.load(),i=await Promise.all([e,r]),{toBinaryGLTF:n}=i[0];return n(this,t)}get memoryUsage(){let t=0;if(t+=this.vertexAttributes.memoryUsage,this.components!=null)for(const e of this.components)t+=e.memoryUsage;return t}_clearSources(){this.metadata.clearSources()}_checkIfLoaded(t){return!!this.loaded||(Om().error(t,lKe),!1)}static createBox(t,e){if(!(t instanceof He))return Om().error(".createBox()",KM),null;const r=new hd(t5(ort(),t,e));return e!=null&&e.imageFace&&e.imageFace!=="all"?art(r,e.imageFace):r}static createSphere(t,e){return t instanceof He?new hd(t5(lrt((e==null?void 0:e.densificationFactor)||0),t,e)):(Om().error(".createSphere()",KM),null)}static createCylinder(t,e){return t instanceof He?new hd(t5(crt((e==null?void 0:e.densificationFactor)||0),t,e)):(Om().error(".createCylinder()",KM),null)}static createPlane(t,e){if(!(t instanceof He))return Om().error(".createPlane()",KM),null;const r=(e==null?void 0:e.facing)??"up",i=urt(r,e==null?void 0:e.size);return new hd(t5(hrt(r),t,{...e,size:i}))}static createFromPolygon(t,e){if(!(t instanceof ku))return Om().error(".createFromPolygon()",uKe),null;const r=set(t);return new hd({vertexAttributes:new zl({position:r.position}),components:[new Eb({faces:r.faces,shading:"flat",material:(e==null?void 0:e.material)??null})],spatialReference:t.spatialReference,vertexSpace:new N0})}static async createFromGLTF(t,e,r){if(!(t instanceof He)){const n=new gpe;throw Om().error(".createfromGLTF()",n.message),n}const{loadGLTFMesh:i}=await ff(re(()=>import("./loadGLTFMesh-CQB71I8C.js"),__vite__mapDeps([])),r);return new hd(await i(t,e,r))}static async createFromFiles(t,e,r){dne(Om(),"`Mesh.createFromFiles` is deprecated in favor of 'SceneLayer.convertMesh'",{replacement:"SceneLayer.convertMesh",version:"4.29"});const i=n=>Om().error(".createFromFiles()",n.message);if(!(t instanceof He)){const n=new gpe;throw i(n),n}if(!(r!=null&&r.layer))throw new B("invalid:no-layer","SceneLayer required for file to mesh conversion.");return r.layer.convertMesh(e,{location:t,...r})}static createWithExternalSource(t,e,r){var f;const i=(r==null?void 0:r.extent)??null,{x:n,y:s,z:o,spatialReference:a}=t,l=((f=r==null?void 0:r.transform)==null?void 0:f.clone())??new XT,c=Ce(n,s,o??0),u=bpe((r==null?void 0:r.vertexSpace)??vpe(a),c),h={source:e,extent:i},p=new dv;return p.externalSources.push(h),new hd({metadata:p,transform:l,vertexSpace:u,spatialReference:a})}static createIncomplete(t,e){var u;const{x:r,y:i,z:n,spatialReference:s}=t,o=((u=e==null?void 0:e.transform)==null?void 0:u.clone())??new XT,a=Ce(r,i,n??0),l=bpe((e==null?void 0:e.vertexSpace)??vpe(s),a),c=new hd({transform:o,vertexSpace:l,spatialReference:s});return c.addResolvingPromise(Promise.reject(new B("mesh-incomplete","Mesh resources are not complete"))),c}};d([m({type:[Eb],json:{write:!0}})],Rl.prototype,"components",void 0),d([m({nonNullable:!0,types:Crt,constructOnly:!0,json:{write:!0}})],Rl.prototype,"vertexSpace",void 0),d([m({type:XT,json:{write:!0}})],Rl.prototype,"transform",void 0),d([m({constructOnly:!0})],Rl.prototype,"metadata",void 0),d([m()],Rl.prototype,"hasExtent",null),d([m()],Rl.prototype,"_transformedExtent",null),d([m()],Rl.prototype,"_untransformedBounds",null),d([m()],Rl.prototype,"anchor",null),d([m()],Rl.prototype,"origin",null),d([m({readOnly:!0,json:{read:!1}})],Rl.prototype,"extent",null),d([m({readOnly:!0,json:{read:!1,write:!0,default:!0}})],Rl.prototype,"hasZ",void 0),d([m({readOnly:!0,json:{read:!1,write:!0,default:!1}})],Rl.prototype,"hasM",void 0),d([m({type:zl,nonNullable:!0,json:{write:!0}})],Rl.prototype,"vertexAttributes",void 0),Rl=hd=d([F(iMe)],Rl);const Kpe=vm(),u7=Rl;let bx=class extends Tb{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],bx.prototype,"row",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],bx.prototype,"column",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],bx.prototype,"rows",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],bx.prototype,"columns",void 0),bx=d([F("esri.CameraLayout")],bx);const nMe=bx;let Lb=class{constructor(e,r){this.min=e,this.max=r,this.range=r-e}ndiff(e,r=0){return Math.ceil((e-r)/this.range)*this.range+r}_normalize(e,r,i,n=0,s=!1){return(i-=n)<e?i+=this.ndiff(e-i):i>r&&(i-=this.ndiff(i-r)),s&&i===r&&(i=e),i+n}normalize(e,r=0,i=!1){return this._normalize(this.min,this.max,e,r,i)}clamp(e,r=0){return we(e-r,this.min,this.max)+r}monotonic(e,r,i){return e<r?r:r+this.ndiff(e-r,i)}minimalMonotonic(e,r,i){return this._normalize(e,e+this.range,r,i)}center(e,r,i){return r=this.monotonic(e,r,i),this.normalize((e+r)/2,i)}diff(e,r,i){return this.monotonic(e,r,i)-e}shortestSignedDiff(e,r){e=this.normalize(e);const i=(r=this.normalize(r))-e,n=r<e?this.minimalMonotonic(e,r)-e:r-this.minimalMonotonic(r,e);return Math.abs(i)<Math.abs(n)?i:n}contains(e,r,i){return r=this.minimalMonotonic(e,r),(i=this.minimalMonotonic(e,i))>e&&i<r}};function noe(t){for(const e in t){const r=t[e];r instanceof Function&&(t[e]=r.bind(t))}return t}const Prt=noe(new Lb(0,2*Math.PI)),Db=noe(new Lb(-Math.PI,Math.PI)),soe=noe(new Lb(0,360));let tg=class extends ds(Se){constructor(...e){super(...e),this.position=new He([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new nMe}normalizeCtorArgs(e,r,i,n){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return r!=null&&(s.heading=r),i!=null&&(s.tilt=i),n!=null&&(s.fov=n),s}return e}writePosition(e,r,i,n){const s=e.clone();s.x=Ld(e.x||0),s.y=Ld(e.y||0),s.z=e.hasZ?Ld(e.z||0):e.z,r[i]=s.write({},n)}readPosition(e,r){const i=new He;return i.read(e,r),i.x=Ld(i.x||0),i.y=Ld(i.y||0),i.z=i.hasZ?Ld(i.z||0):i.z,i}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};d([m({type:He,json:{write:{isRequired:!0}}})],tg.prototype,"position",void 0),d([nt("position")],tg.prototype,"writePosition",null),d([Xe("position")],tg.prototype,"readPosition",null),d([m({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Dr(t=>soe.normalize(Ld(t)))],tg.prototype,"heading",void 0),d([m({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Dr(t=>we(Ld(t),-180,180))],tg.prototype,"tilt",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],tg.prototype,"fov",void 0),d([m({type:nMe,nonNullable:!0,json:{read:!1,write:!1}})],tg.prototype,"layout",void 0),tg=d([F("esri.Camera")],tg);const Hh=tg;var YJ;let I1=YJ=class extends Se{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new YJ({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function qj(){return{enabled:!this.camera}}d([m({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:qj}}}}})],I1.prototype,"rotation",void 0),d([Dr("rotation")],I1.prototype,"castRotation",null),d([m({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:qj}}}}})],I1.prototype,"scale",void 0),d([m({types:cN,json:{read:Sb,write:!0,origins:{"web-scene":{read:Sb,write:{overridePolicy:qj}}}}})],I1.prototype,"targetGeometry",void 0),d([m({type:Hh,json:{write:!0}})],I1.prototype,"camera",void 0),I1=YJ=d([F("esri.Viewpoint")],I1);const dm=I1;function h7(t){return typeof t=="string"?document.getElementById(t):t??null}function sMe(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function efe(t,e){const r=e.parentNode;r&&r.insertBefore(t,e)}function tfe(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}let zz=class{constructor(e=r=>r.values().next().value){this._peeker=e,this._observable=new nN,this._items=new Set}get length(){return Ft(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Ft(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const r=this.length;return this._items.forEach(i=>{e(i)||this._items.delete(i)}),r!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Ft(this._observable),yield*this._items}};const oMe=new FinalizationRegistry(t=>{t.close()});function Art(t,e){oMe.register(t,e,e)}function Ort(t){oMe.unregister(t)}const aMe="worker:port-closed";var La;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(La||(La={}));let Mrt=0;function lMe(){return Mrt++}function Rrt(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function tD(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function ooe(t,e,r,i){if(e.type===La.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==La.INVOKE&&e.type!==La.RESPONSE)return void t.postMessage(e);let n;if(Rrt(r)?(n=rfe(r.transferList),e.data=r.result):(n=rfe(i),e.data=r),n){if(ne("ff")){for(const s of n)if("byteLength"in s&&s.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case La.INVOKE:throw o;case La.RESPONSE:return void ooe(t,{type:La.RESPONSE,jobId:e.jobId,error:tD(o)})}}}t.postMessage(e,n)}else t.postMessage(e)}function rD(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function rfe(t){if(!(t!=null&&t.length))return null;if(ne("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(r=>!$rt(r));return e.length?e:null}function $rt(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}async function Irt(t){try{return await t}catch(e){const r=(e==null?void 0:e.name)===aMe;if(!(on(e)||r))throw e;return}}function cMe(t,e,r){return new Proxy({},{get:(i,n,s)=>(...o)=>{let a,l;const c=o[o.length-1];Lrt(c)&&(a=c.signal,l=c.transferList,o.pop());const u=t.apply(e?`${e}.${n.toString()}`:n.toString(),o,{transferList:l,signal:a});return r!=null&&r.ignoreConnectionErrors?Irt(u):u}})}function Lrt(t){return typeof t=="object"&&!Array.isArray(t)&&t!=null&&("signal"in t||"transferList"in t||Object.keys(t).length===0)}const Drt={statsWorker:()=>re(()=>import("./statsWorker-DGhrTPTg.js"),__vite__mapDeps([7,8,9,10,11])),geometryEngineWorker:()=>re(()=>import("./geometryEngineWorker-B7j3hlk7.js"),__vite__mapDeps([12,13,14,15])),CSVSourceWorker:()=>re(()=>import("./CSVSourceWorker-COkaUuy_.js"),__vite__mapDeps([16,17,15,18,19,20,21,22,23,24,25,8,9,10,11,26,27,28])),EdgeProcessingWorker:()=>re(()=>import("./EdgeProcessingWorker-NKIPPMRd.js"),__vite__mapDeps([])),ElevationSamplerWorker:()=>re(()=>import("./ElevationSamplerWorker-DvmMRhvj.js"),__vite__mapDeps([29,20,21])),FeatureServiceSnappingSourceWorker:()=>re(()=>import("./FeatureServiceSnappingSourceWorker-CYbcLhwl.js"),__vite__mapDeps([30,18,19,20,21,22,23,24,15,25,8,9,10,11,26,31])),GeoJSONSourceWorker:()=>re(()=>import("./GeoJSONSourceWorker-Dahj6xJw.js"),__vite__mapDeps([32,18,19,20,21,22,23,24,15,25,8,9,10,11,26,33,17,28,34])),LercWorker:()=>re(()=>import("./LercWorker-BfJiWZbT.js"),__vite__mapDeps([])),MemorySourceWorker:()=>re(()=>import("./MemorySourceWorker-Bk2igzXP.js"),__vite__mapDeps([35,36,18,19,20,21,22,23,24,15,25,8,9,10,11,26,28,34,17])),PBFDecoderWorker:()=>re(()=>import("./PBFDecoderWorker-4B0H0g_e.js"),__vite__mapDeps([])),FeaturePipelineWorker:()=>re(()=>import("./FeaturePipelineWorker-vNMr227f.js"),__vite__mapDeps([37,38,39,40,41,22,23,24,15,25,8,9,10,11,26,21,42,33,17,28,34,43,44])),PointCloudWorker:()=>re(()=>import("./PointCloudWorker-k5FV1sls.js"),__vite__mapDeps([45,46,47])),RasterWorker:()=>re(()=>import("./RasterWorker-Bn5Bz5Cu.js"),__vite__mapDeps([48,49,50,51])),SceneLayerSnappingSourceWorker:()=>re(()=>import("./SceneLayerSnappingSourceWorker-Bdbyjvnc.js"),__vite__mapDeps([])),SceneLayerWorker:()=>re(()=>import("./SceneLayerWorker-BvHNKtwN.js").then(t=>t.S),__vite__mapDeps([52,53])),WFSSourceWorker:()=>re(()=>import("./WFSSourceWorker-c6MgkwXn.js"),__vite__mapDeps([54,18,19,20,21,22,23,24,15,25,8,9,10,11,26,33,17,34,55,56])),WorkerTileHandler:()=>re(()=>import("./WorkerTileHandler-CWJUz11B.js"),__vite__mapDeps([57,40,38,58])),Lyr3DWorker:()=>re(()=>import("./Lyr3DWorker-B8MMZ_Qj.js"),__vite__mapDeps([59,60,61]))},{CLOSE:ife,ABORT:nfe,INVOKE:sfe,RESPONSE:NO,OPEN_PORT:ofe,ON:Nrt}=La,Frt=2;let krt=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===La.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},Nb=class rC{static connect(e){const r=new MessageChannel;let i;i=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new rC(r.port1,{channel:r,client:i});return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=n),rC.clients.set(n,i),r.port2}static loadWorker(e){const r=Drt[e];return r?r():Promise.resolve(null)}constructor(e,r,i){this._port=e,this._jobQueue=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new krt(n=>this._onInvokeMessage(n)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:ife}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,r,i){return this.apply(e,[r],i)}apply(e,r,i){const n=i==null?void 0:i.signal,s=i==null?void 0:i.transferList;if(!this._port)return Promise.reject(new B(aMe,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:r}));const o=lMe();return new Promise((a,l)=>{if(Ms(n))return this._processWork(),void l(gr());const c=la(n,()=>{const h=this._outJobs.get(o);h&&(this._outJobs.delete(o),this._processWork(),Pi(h.abortHandle),this._post({type:nfe,jobId:o}),l(gr()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:sfe,jobId:o,methodName:e,abortable:n!=null},r,s)})}createInvokeProxy(e,r){return cMe(this,e,r)}on(e,r){const i=new MessageChannel;function n(s){r(s.data)}return this._port.postMessage({type:La.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",n),i.port1.start(),ri(()=>{i.port1.postMessage({type:La.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",n)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:ofe,port:e.port2}),e.port1}_processWork(){var o;if(this._outJobs.size>=Frt)return;const e=(o=this._jobQueue)==null?void 0:o.pop();if(!e)return;const{methodName:r,data:i,invokeOptions:n,resolver:s}=e;this.apply(r,i,n).then(a=>s.resolve(a)).catch(a=>s.reject(a))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Pi(e.abortHandle),e.reject(gr(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const r=rD(e);if(r)switch(r.type){case NO:this._onResponseMessage(r);break;case sfe:this._invokeQueue.push(r);break;case nfe:this._onAbortMessage(r);break;case ife:this._onCloseMessage();break;case ofe:this._onOpenPortMessage(r);break;case Nrt:this._onOnMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,n=r.get(i);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),r.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&rC.clients.get(this)===e&&e.destroy(),rC.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:r,jobId:i,data:n=[],abortable:s}=e,o=s?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[r];try{if(!u&&r&&r.includes(".")){const h=r.split(".");for(let p=0;p<h.length-1;p++)c=c[h[p]],u=c[h[p+1]]}if(typeof u!="function")throw new TypeError(`${r} is not a function`);n.push({client:this,signal:o?o.signal:null}),l=u.apply(c,n)}catch(h){return void this._post({type:NO,jobId:i,error:tD(h)})}Xu(l)?(a.set(i,{controller:o,promise:l}),l.then(h=>{a.has(i)&&(a.delete(i),this._post({type:NO,jobId:i},h))},h=>{a.has(i)&&(a.delete(i),on(h)||this._post({type:NO,jobId:i,error:tD(h||{message:`Error encountered at method ${r}`})}))})):this._post({type:NO,jobId:i},l)}_onOpenPortMessage(e){new rC(e.port,{client:this._client})}_onOnMessage(e){const{port:r}=e,i=this._client.on(e.eventType,s=>{r.postMessage(s)}),n=NA(e.port,"message",s=>{const o=rD(s);(o==null?void 0:o.type)===La.CLOSE&&(n.remove(),i.remove(),r.close())})}_onResponseMessage(e){const{jobId:r,error:i,data:n}=e,s=this._outJobs;if(!s.has(r))return;const o=s.get(r);s.delete(r),this._processWork(),Pi(o.abortHandle),i?o.reject(B.fromJSON(JSON.parse(i))):o.resolve(n)}_post(e,r,i){return ooe(this._port,e,r,i)}};Nb.kernelInfo={buildDate:YCe,fullVersion:Mne,revision:XCe},Nb.clients=new Map;let Urt=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new zz}destroy(){this.close()}get closed(){var e;return!((e=this._clients)!=null&&e.length)}open(e,r){return new Promise((i,n)=>{let s=!0;const o=a=>{dt(r.signal),s&&(s=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Xu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new Nb(c,r,this._ongoingJobsQueue),o(i),this._clients[a]),()=>(o(n),null)):(this._clients[a]=new Nb(l,r,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(e,r,i){const n=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const o=this._clientPromises[s];n[s]=o.then(a=>a==null?void 0:a.invoke(e,r,i))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(gr(`Worker closing, aborting job calling '${e.methodName}'`));for(const r of this._clientPromises)r.then(i=>i==null?void 0:i.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,Ort(this)}invoke(e,r,i){return this.apply(e,[r],i)}apply(e,r,i){const n=ma();this._ongoingJobsQueue.push({methodName:e,data:r,invokeOptions:i,resolver:n});for(let s=0;s<this._clientPromises.length;s++){const o=this._clients[s];o?o.jobAdded():this._clientPromises[s].then(a=>a==null?void 0:a.jobAdded())}return n.promise}createInvokeProxy(e){return cMe(this,e)}on(e,r){return Promise.all(this._clientPromises).then(()=>DT(this._clients.map(i=>i.on(e,r))))}openPorts(){return new Promise(e=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then(s=>{s&&(r[n]=s.openPort()),--i==0&&e(r)})})}get test(){return{numClients:this._clients.length}}};const zrt={async request(t,e){var o,a;const r=t.options,i=r.responseType;r.signal=e==null?void 0:e.signal,r.responseType=i==="native"||i==="native-request-init"?"native-request-init":i&&["blob","json","text"].includes(i)&&((o=BCe(t.url))!=null&&o.after)?i:"array-buffer";const n=await Vt(t.url,r),s={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch((a=n.requestOptions)==null?void 0:a.responseType){case"native-request-init":return delete s.data.signal,s;case"blob":s.data=await s.data.arrayBuffer();break;case"json":s.data=new TextEncoder().encode(JSON.stringify(s.data)).buffer;break;case"text":s.data=new TextEncoder().encode(s.data).buffer}return{result:s,transferList:[s.data]}}},afe=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class T2 extends Error{}class Vrt extends T2{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class Brt extends T2{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class Grt extends T2{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class i3 extends T2{}class uMe extends T2{constructor(e){super(`Invalid unit ${e}`)}}class bu extends T2{}class Q_ extends T2{constructor(){super("Zone is an abstract class")}}const lt="numeric",pm="short",kh="long",Vz={year:lt,month:lt,day:lt},hMe={year:lt,month:pm,day:lt},jrt={year:lt,month:pm,day:lt,weekday:pm},dMe={year:lt,month:kh,day:lt},pMe={year:lt,month:kh,day:lt,weekday:kh},fMe={hour:lt,minute:lt},mMe={hour:lt,minute:lt,second:lt},gMe={hour:lt,minute:lt,second:lt,timeZoneName:pm},yMe={hour:lt,minute:lt,second:lt,timeZoneName:kh},_Me={hour:lt,minute:lt,hourCycle:"h23"},vMe={hour:lt,minute:lt,second:lt,hourCycle:"h23"},bMe={hour:lt,minute:lt,second:lt,hourCycle:"h23",timeZoneName:pm},wMe={hour:lt,minute:lt,second:lt,hourCycle:"h23",timeZoneName:kh},xMe={year:lt,month:lt,day:lt,hour:lt,minute:lt},SMe={year:lt,month:lt,day:lt,hour:lt,minute:lt,second:lt},TMe={year:lt,month:pm,day:lt,hour:lt,minute:lt},EMe={year:lt,month:pm,day:lt,hour:lt,minute:lt,second:lt},Hrt={year:lt,month:pm,day:lt,weekday:pm,hour:lt,minute:lt},CMe={year:lt,month:kh,day:lt,hour:lt,minute:lt,timeZoneName:pm},PMe={year:lt,month:kh,day:lt,hour:lt,minute:lt,second:lt,timeZoneName:pm},AMe={year:lt,month:kh,day:lt,weekday:kh,hour:lt,minute:lt,timeZoneName:kh},OMe={year:lt,month:kh,day:lt,weekday:kh,hour:lt,minute:lt,second:lt,timeZoneName:kh};class qA{get type(){throw new Q_}get name(){throw new Q_}get ianaName(){return this.name}get isUniversal(){throw new Q_}offsetName(e,r){throw new Q_}formatOffset(e,r){throw new Q_}offset(e){throw new Q_}equals(e){throw new Q_}get isValid(){throw new Q_}}let Wj=null;class d7 extends qA{static get instance(){return Wj===null&&(Wj=new d7),Wj}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return kMe(e,r,i)}formatOffset(e,r){return SI(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let y6={};function qrt(t){return y6[t]||(y6[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),y6[t]}const Wrt={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function Yrt(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,n,s,o,a,l,c,u]=i;return[o,n,s,a,l,c,u]}function Xrt(t,e){const r=t.formatToParts(e),i=[];for(let n=0;n<r.length;n++){const{type:s,value:o}=r[n],a=Wrt[s];s==="era"?i[a]=o:Er(a)||(i[a]=parseInt(o,10))}return i}let r5={};class qh extends qA{static create(e){return r5[e]||(r5[e]=new qh(e)),r5[e]}static resetCache(){r5={},y6={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=qh.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return kMe(e,r,i,this.name)}formatOffset(e,r){return SI(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=qrt(this.name);let[n,s,o,a,l,c,u]=i.formatToParts?Xrt(i,r):Yrt(i,r);a==="BC"&&(n=-Math.abs(n)+1);const p=f7({year:n,month:s,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let f=+r;const g=f%1e3;return f-=g>=0?g:1e3+g,(p-f)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let lfe={};function Zrt(t,e={}){const r=JSON.stringify([t,e]);let i=lfe[r];return i||(i=new Intl.ListFormat(t,e),lfe[r]=i),i}let XJ={};function ZJ(t,e={}){const r=JSON.stringify([t,e]);let i=XJ[r];return i||(i=new Intl.DateTimeFormat(t,e),XJ[r]=i),i}let JJ={};function Jrt(t,e={}){const r=JSON.stringify([t,e]);let i=JJ[r];return i||(i=new Intl.NumberFormat(t,e),JJ[r]=i),i}let QJ={};function Qrt(t,e={}){const{base:r,...i}=e,n=JSON.stringify([t,i]);let s=QJ[n];return s||(s=new Intl.RelativeTimeFormat(t,e),QJ[n]=s),s}let aR=null;function Krt(){return aR||(aR=new Intl.DateTimeFormat().resolvedOptions().locale,aR)}let cfe={};function eit(t){let e=cfe[t];if(!e){const r=new Intl.Locale(t);e="getWeekInfo"in r?r.getWeekInfo():r.weekInfo,cfe[t]=e}return e}function tit(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const r=t.indexOf("-u-");if(r===-1)return[t];{let i,n;try{i=ZJ(t).resolvedOptions(),n=t}catch{const l=t.substring(0,r);i=ZJ(l).resolvedOptions(),n=l}const{numberingSystem:s,calendar:o}=i;return[n,s,o]}}function rit(t,e,r){return(r||e)&&(t.includes("-u-")||(t+="-u"),r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function iit(t){const e=[];for(let r=1;r<=12;r++){const i=ar.utc(2009,r,1);e.push(t(i))}return e}function nit(t){const e=[];for(let r=1;r<=7;r++){const i=ar.utc(2016,11,13+r);e.push(t(i))}return e}function i5(t,e,r,i){const n=t.listingMode();return n==="error"?null:n==="en"?r(e):i(e)}function sit(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class oit{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:n,floor:s,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=Jrt(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):uoe(e,3);return Fo(r,this.padTo)}}}class ait{constructor(e,r,i){this.opts=i,this.originalZone=void 0;let n;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&qh.create(a).valid?(n=a,this.dt=e):(n="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,n=e.zone.name):(n="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const s={...this.opts};s.timeZone=s.timeZone||n,this.dtf=ZJ(r,s)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(r=>{if(r.type==="timeZoneName"){const i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...r,value:i}}else return r}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class lit{constructor(e,r,i){this.opts={style:"long",...i},!r&&NMe()&&(this.rtf=Qrt(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):Ait(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}const cit={firstDay:1,minimalDays:4,weekend:[6,7]};class bn{static fromOpts(e){return bn.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,r,i,n,s=!1){const o=e||oo.defaultLocale,a=o||(s?"en-US":Krt()),l=r||oo.defaultNumberingSystem,c=i||oo.defaultOutputCalendar,u=KJ(n)||oo.defaultWeekSettings;return new bn(a,l,c,u,o)}static resetCache(){aR=null,XJ={},JJ={},QJ={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i,weekSettings:n}={}){return bn.create(e,r,i,n)}constructor(e,r,i,n,s){const[o,a,l]=tit(e);this.locale=o,this.numberingSystem=r||a||null,this.outputCalendar=i||l||null,this.weekSettings=n,this.intl=rit(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=sit(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:bn.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,KJ(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1){return i5(this,e,VMe,()=>{const i=r?{month:e,day:"numeric"}:{month:e},n=r?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=iit(s=>this.extract(s,i,"month"))),this.monthsCache[n][e]})}weekdays(e,r=!1){return i5(this,e,jMe,()=>{const i=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=r?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=nit(s=>this.extract(s,i,"weekday"))),this.weekdaysCache[n][e]})}meridiems(){return i5(this,void 0,()=>HMe,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[ar.utc(2016,11,13,9),ar.utc(2016,11,13,19)].map(r=>this.extract(r,e,"dayperiod"))}return this.meridiemCache})}eras(e){return i5(this,e,qMe,()=>{const r={era:e};return this.eraCache[e]||(this.eraCache[e]=[ar.utc(-40,1,1),ar.utc(2017,1,1)].map(i=>this.extract(i,r,"era"))),this.eraCache[e]})}extract(e,r,i){const n=this.dtFormatter(e,r),s=n.formatToParts(),o=s.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(e={}){return new oit(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new ait(e,this.intl,r)}relFormatter(e={}){return new lit(this.intl,this.isEnglish(),e)}listFormatter(e={}){return Zrt(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:FMe()?eit(this.locale):cit}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let Yj=null;class al extends qA{static get utcInstance(){return Yj===null&&(Yj=new al(0)),Yj}static instance(e){return e===0?al.utcInstance:new al(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new al(m7(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${SI(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${SI(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return SI(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class uit extends qA{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Cv(t,e){if(Er(t)||t===null)return e;if(t instanceof qA)return t;if(pit(t)){const r=t.toLowerCase();return r==="default"?e:r==="local"||r==="system"?d7.instance:r==="utc"||r==="gmt"?al.utcInstance:al.parseSpecifier(r)||qh.create(t)}else return mT(t)?al.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new uit(t)}let ufe=()=>Date.now(),hfe="system",dfe=null,pfe=null,ffe=null,mfe=60,gfe,yfe=null;class oo{static get now(){return ufe}static set now(e){ufe=e}static set defaultZone(e){hfe=e}static get defaultZone(){return Cv(hfe,d7.instance)}static get defaultLocale(){return dfe}static set defaultLocale(e){dfe=e}static get defaultNumberingSystem(){return pfe}static set defaultNumberingSystem(e){pfe=e}static get defaultOutputCalendar(){return ffe}static set defaultOutputCalendar(e){ffe=e}static get defaultWeekSettings(){return yfe}static set defaultWeekSettings(e){yfe=KJ(e)}static get twoDigitCutoffYear(){return mfe}static set twoDigitCutoffYear(e){mfe=e%100}static get throwOnInvalid(){return gfe}static set throwOnInvalid(e){gfe=e}static resetCaches(){bn.resetCache(),qh.resetCache()}}class zf{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const MMe=[0,31,59,90,120,151,181,212,243,273,304,334],RMe=[0,31,60,91,121,152,182,213,244,274,305,335];function Wd(t,e){return new zf("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function aoe(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const n=i.getUTCDay();return n===0?7:n}function $Me(t,e,r){return r+(vN(t)?RMe:MMe)[e-1]}function IMe(t,e){const r=vN(t)?RMe:MMe,i=r.findIndex(s=>s<e),n=e-r[i];return{month:i+1,day:n}}function loe(t,e){return(t-e+7)%7+1}function Bz(t,e=4,r=1){const{year:i,month:n,day:s}=t,o=$Me(i,n,s),a=loe(aoe(i,n,s),r);let l=Math.floor((o-a+14-e)/7),c;return l<1?(c=i-1,l=iD(c,e,r)):l>iD(i,e,r)?(c=i+1,l=1):c=i,{weekYear:c,weekNumber:l,weekday:a,...g7(t)}}function _fe(t,e=4,r=1){const{weekYear:i,weekNumber:n,weekday:s}=t,o=loe(aoe(i,1,e),r),a=j3(i);let l=n*7+s-o-7+e,c;l<1?(c=i-1,l+=j3(c)):l>a?(c=i+1,l-=j3(i)):c=i;const{month:u,day:h}=IMe(c,l);return{year:c,month:u,day:h,...g7(t)}}function Xj(t){const{year:e,month:r,day:i}=t,n=$Me(e,r,i);return{year:e,ordinal:n,...g7(t)}}function vfe(t){const{year:e,ordinal:r}=t,{month:i,day:n}=IMe(e,r);return{year:e,month:i,day:n,...g7(t)}}function bfe(t,e){if(!Er(t.localWeekday)||!Er(t.localWeekNumber)||!Er(t.localWeekYear)){if(!Er(t.weekday)||!Er(t.weekNumber)||!Er(t.weekYear))throw new i3("Cannot mix locale-based week fields with ISO-based week fields");return Er(t.localWeekday)||(t.weekday=t.localWeekday),Er(t.localWeekNumber)||(t.weekNumber=t.localWeekNumber),Er(t.localWeekYear)||(t.weekYear=t.localWeekYear),delete t.localWeekday,delete t.localWeekNumber,delete t.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function hit(t,e=4,r=1){const i=p7(t.weekYear),n=Yd(t.weekNumber,1,iD(t.weekYear,e,r)),s=Yd(t.weekday,1,7);return i?n?s?!1:Wd("weekday",t.weekday):Wd("week",t.weekNumber):Wd("weekYear",t.weekYear)}function dit(t){const e=p7(t.year),r=Yd(t.ordinal,1,j3(t.year));return e?r?!1:Wd("ordinal",t.ordinal):Wd("year",t.year)}function LMe(t){const e=p7(t.year),r=Yd(t.month,1,12),i=Yd(t.day,1,Gz(t.year,t.month));return e?r?i?!1:Wd("day",t.day):Wd("month",t.month):Wd("year",t.year)}function DMe(t){const{hour:e,minute:r,second:i,millisecond:n}=t,s=Yd(e,0,23)||e===24&&r===0&&i===0&&n===0,o=Yd(r,0,59),a=Yd(i,0,59),l=Yd(n,0,999);return s?o?a?l?!1:Wd("millisecond",n):Wd("second",i):Wd("minute",r):Wd("hour",e)}function Er(t){return typeof t>"u"}function mT(t){return typeof t=="number"}function p7(t){return typeof t=="number"&&t%1===0}function pit(t){return typeof t=="string"}function fit(t){return Object.prototype.toString.call(t)==="[object Date]"}function NMe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function FMe(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function mit(t){return Array.isArray(t)?t:[t]}function wfe(t,e,r){if(t.length!==0)return t.reduce((i,n)=>{const s=[e(n),n];return i&&r(i[0],s[0])===i[0]?i:s},null)[1]}function git(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function tA(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function KJ(t){if(t==null)return null;if(typeof t!="object")throw new bu("Week settings must be an object");if(!Yd(t.firstDay,1,7)||!Yd(t.minimalDays,1,7)||!Array.isArray(t.weekend)||t.weekend.some(e=>!Yd(e,1,7)))throw new bu("Invalid week settings");return{firstDay:t.firstDay,minimalDays:t.minimalDays,weekend:Array.from(t.weekend)}}function Yd(t,e,r){return p7(t)&&t>=e&&t<=r}function yit(t,e){return t-e*Math.floor(t/e)}function Fo(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function pv(t){if(!(Er(t)||t===null||t===""))return parseInt(t,10)}function Mw(t){if(!(Er(t)||t===null||t===""))return parseFloat(t)}function coe(t){if(!(Er(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function uoe(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function vN(t){return t%4===0&&(t%100!==0||t%400===0)}function j3(t){return vN(t)?366:365}function Gz(t,e){const r=yit(e-1,12)+1,i=t+(e-r)/12;return r===2?vN(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function f7(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function xfe(t,e,r){return-loe(aoe(t,1,e),r)+e-1}function iD(t,e=4,r=1){const i=xfe(t,e,r),n=xfe(t+1,e,r);return(j3(t)-i+n)/7}function eQ(t){return t>99?t:t>oo.twoDigitCutoffYear?1900+t:2e3+t}function kMe(t,e,r,i=null){const n=new Date(t),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(s.timeZone=i);const o={timeZoneName:e,...s},a=new Intl.DateTimeFormat(r,o).formatToParts(n).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function m7(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,n=r<0||Object.is(r,-0)?-i:i;return r*60+n}function UMe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new bu(`Invalid unit value ${t}`);return e}function jz(t,e){const r={};for(const i in t)if(tA(t,i)){const n=t[i];if(n==null)continue;r[e(i)]=UMe(n)}return r}function SI(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),n=t>=0?"+":"-";switch(e){case"short":return`${n}${Fo(r,2)}:${Fo(i,2)}`;case"narrow":return`${n}${r}${i>0?`:${i}`:""}`;case"techie":return`${n}${Fo(r,2)}${Fo(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function g7(t){return git(t,["hour","minute","second","millisecond"])}const _it=["January","February","March","April","May","June","July","August","September","October","November","December"],zMe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],vit=["J","F","M","A","M","J","J","A","S","O","N","D"];function VMe(t){switch(t){case"narrow":return[...vit];case"short":return[...zMe];case"long":return[..._it];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const BMe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],GMe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],bit=["M","T","W","T","F","S","S"];function jMe(t){switch(t){case"narrow":return[...bit];case"short":return[...GMe];case"long":return[...BMe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const HMe=["AM","PM"],wit=["Before Christ","Anno Domini"],xit=["BC","AD"],Sit=["B","A"];function qMe(t){switch(t){case"narrow":return[...Sit];case"short":return[...xit];case"long":return[...wit];default:return null}}function Tit(t){return HMe[t.hour<12?0:1]}function Eit(t,e){return jMe(e)[t.weekday-1]}function Cit(t,e){return VMe(e)[t.month-1]}function Pit(t,e){return qMe(e)[t.year<0?0:1]}function Ait(t,e,r="always",i=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&s){const h=t==="days";switch(e){case 1:return h?"tomorrow":`next ${n[t][0]}`;case-1:return h?"yesterday":`last ${n[t][0]}`;case 0:return h?"today":`this ${n[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=n[t],u=i?l?c[1]:c[2]||c[1]:l?n[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}function Sfe(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const Oit={D:Vz,DD:hMe,DDD:dMe,DDDD:pMe,t:fMe,tt:mMe,ttt:gMe,tttt:yMe,T:_Me,TT:vMe,TTT:bMe,TTTT:wMe,f:xMe,ff:TMe,fff:CMe,ffff:AMe,F:SMe,FF:EMe,FFF:PMe,FFFF:OMe};class Yl{static create(e,r={}){return new Yl(e,r)}static parseFormat(e){let r=null,i="",n=!1;const s=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(i.length>0&&s.push({literal:n||/^\s+$/.test(i),val:i}),r=null,i="",n=!n):n||a===r?i+=a:(i.length>0&&s.push({literal:/^\s+$/.test(i),val:i}),i=a,r=a)}return i.length>0&&s.push({literal:n||/^\s+$/.test(i),val:i}),s}static macroTokenToFormatOpts(e){return Oit[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}dtFormatter(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r})}formatDateTime(e,r){return this.dtFormatter(e,r).format()}formatDateTimeParts(e,r){return this.dtFormatter(e,r).formatToParts()}formatInterval(e,r){return this.dtFormatter(e.start,r).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,r){return this.dtFormatter(e,r).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return Fo(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",n=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",s=(f,g)=>this.loc.extract(e,f,g),o=f=>e.isOffsetFixed&&e.offset===0&&f.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,f.format):"",a=()=>i?Tit(e):s({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(f,g)=>i?Cit(e,f):s(g?{month:f}:{month:f,day:"numeric"},"month"),c=(f,g)=>i?Eit(e,f):s(g?{weekday:f}:{weekday:f,month:"long",day:"numeric"},"weekday"),u=f=>{const g=Yl.macroTokenToFormatOpts(f);return g?this.formatWithSystemDefault(e,g):f},h=f=>i?Pit(e,f):s({era:f},"era"),p=f=>{switch(f){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return n?s({day:"numeric"},"day"):this.num(e.day);case"dd":return n?s({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return n?s({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return n?s({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return n?s({month:"numeric"},"month"):this.num(e.month);case"MM":return n?s({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return n?s({year:"numeric"},"year"):this.num(e.year);case"yy":return n?s({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return n?s({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return n?s({year:"numeric"},"year"):this.num(e.year,6);case"G":return h("short");case"GG":return h("long");case"GGGGG":return h("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(f)}};return Sfe(Yl.parseFormat(r),p)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=l=>c=>{const u=i(c);return u?this.num(l.get(u),c.length):c},s=Yl.parseFormat(r),o=s.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=e.shiftTo(...o.map(i).filter(l=>l));return Sfe(s,n(a))}}const WMe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function WA(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function YA(...t){return e=>t.reduce(([r,i,n],s)=>{const[o,a,l]=s(e,n);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function XA(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const n=r.exec(t);if(n)return i(n)}return[null,null]}function YMe(...t){return(e,r)=>{const i={};let n;for(n=0;n<t.length;n++)i[t[n]]=pv(e[r+n]);return[i,null,r+n]}}const XMe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Mit=`(?:${XMe.source}?(?:\\[(${WMe.source})\\])?)?`,hoe=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,ZMe=RegExp(`${hoe.source}${Mit}`),doe=RegExp(`(?:T${ZMe.source})?`),Rit=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,$it=/(\d{4})-?W(\d\d)(?:-?(\d))?/,Iit=/(\d{4})-?(\d{3})/,Lit=YMe("weekYear","weekNumber","weekDay"),Dit=YMe("year","ordinal"),Nit=/(\d{4})-(\d\d)-(\d\d)/,JMe=RegExp(`${hoe.source} ?(?:${XMe.source}|(${WMe.source}))?`),Fit=RegExp(`(?: ${JMe.source})?`);function H3(t,e,r){const i=t[e];return Er(i)?r:pv(i)}function kit(t,e){return[{year:H3(t,e),month:H3(t,e+1,1),day:H3(t,e+2,1)},null,e+3]}function ZA(t,e){return[{hours:H3(t,e,0),minutes:H3(t,e+1,0),seconds:H3(t,e+2,0),milliseconds:coe(t[e+3])},null,e+4]}function bN(t,e){const r=!t[e]&&!t[e+1],i=m7(t[e+1],t[e+2]),n=r?null:al.instance(i);return[{},n,e+3]}function wN(t,e){const r=t[e]?qh.create(t[e]):null;return[{},r,e+1]}const Uit=RegExp(`^T?${hoe.source}$`),zit=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Vit(t){const[e,r,i,n,s,o,a,l,c]=t,u=e[0]==="-",h=l&&l[0]==="-",p=(f,g=!1)=>f!==void 0&&(g||f&&u)?-f:f;return[{years:p(Mw(r)),months:p(Mw(i)),weeks:p(Mw(n)),days:p(Mw(s)),hours:p(Mw(o)),minutes:p(Mw(a)),seconds:p(Mw(l),l==="-0"),milliseconds:p(coe(c),h)}]}const Bit={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function poe(t,e,r,i,n,s,o){const a={year:e.length===2?eQ(pv(e)):pv(e),month:zMe.indexOf(r)+1,day:pv(i),hour:pv(n),minute:pv(s)};return o&&(a.second=pv(o)),t&&(a.weekday=t.length>3?BMe.indexOf(t)+1:GMe.indexOf(t)+1),a}const Git=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function jit(t){const[,e,r,i,n,s,o,a,l,c,u,h]=t,p=poe(e,n,i,r,s,o,a);let f;return l?f=Bit[l]:c?f=0:f=m7(u,h),[p,new al(f)]}function Hit(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const qit=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Wit=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Yit=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Tfe(t){const[,e,r,i,n,s,o,a]=t;return[poe(e,n,i,r,s,o,a),al.utcInstance]}function Xit(t){const[,e,r,i,n,s,o,a]=t;return[poe(e,a,r,i,n,s,o),al.utcInstance]}const Zit=WA(Rit,doe),Jit=WA($it,doe),Qit=WA(Iit,doe),Kit=WA(ZMe),QMe=YA(kit,ZA,bN,wN),ent=YA(Lit,ZA,bN,wN),tnt=YA(Dit,ZA,bN,wN),rnt=YA(ZA,bN,wN);function int(t){return XA(t,[Zit,QMe],[Jit,ent],[Qit,tnt],[Kit,rnt])}function nnt(t){return XA(Hit(t),[Git,jit])}function snt(t){return XA(t,[qit,Tfe],[Wit,Tfe],[Yit,Xit])}function ont(t){return XA(t,[zit,Vit])}const ant=YA(ZA);function lnt(t){return XA(t,[Uit,ant])}const cnt=WA(Nit,Fit),unt=WA(JMe),hnt=YA(ZA,bN,wN);function dnt(t){return XA(t,[cnt,QMe],[unt,hnt])}const Efe="Invalid Duration",KMe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},pnt={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...KMe},Qh=146097/400,H2=146097/4800,fnt={years:{quarters:4,months:12,weeks:Qh/7,days:Qh,hours:Qh*24,minutes:Qh*24*60,seconds:Qh*24*60*60,milliseconds:Qh*24*60*60*1e3},quarters:{months:3,weeks:Qh/28,days:Qh/4,hours:Qh*24/4,minutes:Qh*24*60/4,seconds:Qh*24*60*60/4,milliseconds:Qh*24*60*60*1e3/4},months:{weeks:H2/7,days:H2,hours:H2*24,minutes:H2*24*60,seconds:H2*24*60*60,milliseconds:H2*24*60*60*1e3},...KMe},XS=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],mnt=XS.slice(0).reverse();function K_(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Oi(i)}function eRe(t,e){let r=e.milliseconds??0;for(const i of mnt.slice(1))e[i]&&(r+=e[i]*t[i].milliseconds);return r}function Cfe(t,e){const r=eRe(t,e)<0?-1:1;XS.reduceRight((i,n)=>{if(Er(e[n]))return i;if(i){const s=e[i]*r,o=t[n][i],a=Math.floor(s/o);e[n]+=a*r,e[i]-=a*o*r}return n},null),XS.reduce((i,n)=>{if(Er(e[n]))return i;if(i){const s=e[i]%1;e[i]-=s,e[n]+=s*t[i][n]}return n},null)}function gnt(t){const e={};for(const[r,i]of Object.entries(t))i!==0&&(e[r]=i);return e}class Oi{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;let i=r?fnt:pnt;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||bn.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,r){return Oi.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new bu(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Oi({values:jz(e,Oi.normalizeUnit),loc:bn.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(e){if(mT(e))return Oi.fromMillis(e);if(Oi.isDuration(e))return e;if(typeof e=="object")return Oi.fromObject(e);throw new bu(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=ont(e);return i?Oi.fromObject(i,r):Oi.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=lnt(e);return i?Oi.fromObject(i,r):Oi.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new bu("need to specify a reason the Duration is invalid");const i=e instanceof zf?e:new zf(e,r);if(oo.throwOnInvalid)throw new Grt(i);return new Oi({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new uMe(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?Yl.create(this.loc,i).formatDurationFromString(this,e):Efe}toHuman(e={}){if(!this.isValid)return Efe;const r=XS.map(i=>{const n=this.values[i];return Er(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(n)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=uoe(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();return r<0||r>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},ar.fromMillis(r,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?eRe(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=Oi.fromDurationLike(e),i={};for(const n of XS)(tA(r.values,n)||tA(this.values,n))&&(i[n]=r.get(n)+this.get(n));return K_(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=Oi.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=UMe(e(this.values[i],i));return K_(this,{values:r},!0)}get(e){return this[Oi.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...jz(e,Oi.normalizeUnit)};return K_(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i,matrix:n}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:r}),matrix:n,conversionAccuracy:i};return K_(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return Cfe(this.matrix,e),K_(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=gnt(this.normalize().shiftToAll().toObject());return K_(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>Oi.normalizeUnit(o));const r={},i={},n=this.toObject();let s;for(const o of XS)if(e.indexOf(o)>=0){s=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;mT(n[o])&&(a+=n[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3}else mT(n[o])&&(i[o]=n[o]);for(const o in i)i[o]!==0&&(r[s]+=o===s?i[o]:i[o]/this.matrix[s][o]);return Cfe(this.matrix,r),K_(this,{values:r},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return K_(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,n){return i===void 0||i===0?n===void 0||n===0:i===n}for(const i of XS)if(!r(this.values[i],e.values[i]))return!1;return!0}}const q2="Invalid Interval";function ynt(t,e){return!t||!t.isValid?Bs.invalid("missing or invalid start"):!e||!e.isValid?Bs.invalid("missing or invalid end"):e<t?Bs.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Bs{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new bu("need to specify a reason the Interval is invalid");const i=e instanceof zf?e:new zf(e,r);if(oo.throwOnInvalid)throw new Brt(i);return new Bs({invalid:i})}static fromDateTimes(e,r){const i=kO(e),n=kO(r),s=ynt(i,n);return s??new Bs({start:i,end:n})}static after(e,r){const i=Oi.fromDurationLike(r),n=kO(e);return Bs.fromDateTimes(n,n.plus(i))}static before(e,r){const i=Oi.fromDurationLike(r),n=kO(e);return Bs.fromDateTimes(n.minus(i),n)}static fromISO(e,r){const[i,n]=(e||"").split("/",2);if(i&&n){let s,o;try{s=ar.fromISO(i,r),o=s.isValid}catch{o=!1}let a,l;try{a=ar.fromISO(n,r),l=a.isValid}catch{l=!1}if(o&&l)return Bs.fromDateTimes(s,a);if(o){const c=Oi.fromISO(n,r);if(c.isValid)return Bs.after(s,c)}else if(l){const c=Oi.fromISO(i,r);if(c.isValid)return Bs.before(a,c)}}return Bs.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",r){if(!this.isValid)return NaN;const i=this.start.startOf(e,r);let n;return r!=null&&r.useLocaleWeeks?n=this.end.reconfigure({locale:i.locale}):n=this.end,n=n.startOf(e,r),Math.floor(n.diff(i,e).get(e))+(n.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?Bs.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(kO).filter(o=>this.contains(o)).sort((o,a)=>o.toMillis()-a.toMillis()),i=[];let{s:n}=this,s=0;for(;n<this.e;){const o=r[s]||this.e,a=+o>+this.e?this.e:o;i.push(Bs.fromDateTimes(n,a)),n=a,s+=1}return i}splitBy(e){const r=Oi.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,n=1,s;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*n));s=+a>+this.e?this.e:a,o.push(Bs.fromDateTimes(i,s)),i=s,n+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:Bs.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return Bs.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((n,s)=>n.s-s.s).reduce(([n,s],o)=>s?s.overlaps(o)||s.abutsStart(o)?[n,s.union(o)]:[n.concat([s]),o]:[n,o],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const n=[],s=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...s),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&n.push(Bs.fromDateTimes(r,l.time)),r=null);return Bs.merge(n)}difference(...e){return Bs.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:q2}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=Vz,r={}){return this.isValid?Yl.create(this.s.loc.clone(r),e).formatInterval(this):q2}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:q2}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:q2}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:q2}toFormat(e,{separator:r=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:q2}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):Oi.invalid(this.invalidReason)}mapEndpoints(e){return Bs.fromDateTimes(e(this.s),e(this.e))}}class n5{static hasDST(e=oo.defaultZone){const r=ar.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return qh.isValidZone(e)}static normalizeZone(e){return Cv(e,oo.defaultZone)}static getStartOfWeek({locale:e=null,locObj:r=null}={}){return(r||bn.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:r=null}={}){return(r||bn.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:r=null}={}){return(r||bn.create(e)).getWeekendDays().slice()}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||bn.create(r,i,s)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||bn.create(r,i,s)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null}={}){return(n||bn.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null}={}){return(n||bn.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return bn.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return bn.create(r,null,"gregory").eras(e)}static features(){return{relative:NMe(),localeWeek:FMe()}}}function Pfe(t,e){const r=n=>n.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(Oi.fromMillis(i).as("days"))}function _nt(t,e,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=Pfe(l,c);return(u-u%7)/7}],["days",Pfe]],n={},s=t;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,n[l]=c(t,e),a=s.plus(n),a>e?(n[l]--,t=s.plus(n),t>e&&(a=t,n[l]--,t=s.plus(n))):t=a);return[t,n,a,o]}function vnt(t,e,r,i){let[n,s,o,a]=_nt(t,e,r);const l=e-n,c=r.filter(h=>["hours","minutes","seconds","milliseconds"].indexOf(h)>=0);c.length===0&&(o<e&&(o=n.plus({[a]:1})),o!==n&&(s[a]=(s[a]||0)+l/(o-n)));const u=Oi.fromObject(s,i);return c.length>0?Oi.fromMillis(l,i).shiftTo(...c).plus(u):u}const foe={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},Afe={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},bnt=foe.hanidec.replace(/[\[|\]]/g,"").split("");function wnt(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search(foe.hanidec)!==-1)e+=bnt.indexOf(t[r]);else for(const n in Afe){const[s,o]=Afe[n];i>=s&&i<=o&&(e+=i-s)}}return parseInt(e,10)}else return e}function Op({numberingSystem:t},e=""){return new RegExp(`${foe[t||"latn"]}${e}`)}const xnt="missing Intl.DateTimeFormat.formatToParts support";function Hi(t,e=r=>r){return{regex:t,deser:([r])=>e(wnt(r))}}const Snt=" ",tRe=`[ ${Snt}]`,rRe=new RegExp(tRe,"g");function Tnt(t){return t.replace(/\./g,"\\.?").replace(rRe,tRe)}function Ofe(t){return t.replace(/\./g,"").replace(rRe," ").toLowerCase()}function Mp(t,e){return t===null?null:{regex:RegExp(t.map(Tnt).join("|")),deser:([r])=>t.findIndex(i=>Ofe(r)===Ofe(i))+e}}function Mfe(t,e){return{regex:t,deser:([,r,i])=>m7(r,i),groups:e}}function s5(t){return{regex:t,deser:([e])=>e}}function Ent(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Cnt(t,e){const r=Op(e),i=Op(e,"{2}"),n=Op(e,"{3}"),s=Op(e,"{4}"),o=Op(e,"{6}"),a=Op(e,"{1,2}"),l=Op(e,"{1,3}"),c=Op(e,"{1,6}"),u=Op(e,"{1,9}"),h=Op(e,"{2,4}"),p=Op(e,"{4,6}"),f=v=>({regex:RegExp(Ent(v.val)),deser:([b])=>b,literal:!0}),y=(v=>{if(t.literal)return f(v);switch(v.val){case"G":return Mp(e.eras("short"),0);case"GG":return Mp(e.eras("long"),0);case"y":return Hi(c);case"yy":return Hi(h,eQ);case"yyyy":return Hi(s);case"yyyyy":return Hi(p);case"yyyyyy":return Hi(o);case"M":return Hi(a);case"MM":return Hi(i);case"MMM":return Mp(e.months("short",!0),1);case"MMMM":return Mp(e.months("long",!0),1);case"L":return Hi(a);case"LL":return Hi(i);case"LLL":return Mp(e.months("short",!1),1);case"LLLL":return Mp(e.months("long",!1),1);case"d":return Hi(a);case"dd":return Hi(i);case"o":return Hi(l);case"ooo":return Hi(n);case"HH":return Hi(i);case"H":return Hi(a);case"hh":return Hi(i);case"h":return Hi(a);case"mm":return Hi(i);case"m":return Hi(a);case"q":return Hi(a);case"qq":return Hi(i);case"s":return Hi(a);case"ss":return Hi(i);case"S":return Hi(l);case"SSS":return Hi(n);case"u":return s5(u);case"uu":return s5(a);case"uuu":return Hi(r);case"a":return Mp(e.meridiems(),0);case"kkkk":return Hi(s);case"kk":return Hi(h,eQ);case"W":return Hi(a);case"WW":return Hi(i);case"E":case"c":return Hi(r);case"EEE":return Mp(e.weekdays("short",!1),1);case"EEEE":return Mp(e.weekdays("long",!1),1);case"ccc":return Mp(e.weekdays("short",!0),1);case"cccc":return Mp(e.weekdays("long",!0),1);case"Z":case"ZZ":return Mfe(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return Mfe(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return s5(/[a-z_+-/]{1,256}?/i);case" ":return s5(/[^\S\n\r]/);default:return f(v)}})(t)||{invalidReason:xnt};return y.token=t,y}const Pnt={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function Ant(t,e,r){const{type:i,value:n}=t;if(i==="literal"){const l=/^\s+$/.test(n);return{literal:!l,val:l?" ":n}}const s=e[i];let o=i;i==="hour"&&(e.hour12!=null?o=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?o="hour12":o="hour24":o=r.hour12?"hour12":"hour24");let a=Pnt[o];if(typeof a=="object"&&(a=a[s]),a)return{literal:!1,val:a}}function Ont(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function Mnt(t,e,r){const i=t.match(e);if(i){const n={};let s=1;for(const o in r)if(tA(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(n[a.token.val[0]]=a.deser(i.slice(s,s+l))),s+=l}return[i,n]}else return[i,{}]}function Rnt(t){const e=s=>{switch(s){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return Er(t.z)||(r=qh.create(t.z)),Er(t.Z)||(r||(r=new al(t.Z)),i=t.Z),Er(t.q)||(t.M=(t.q-1)*3+1),Er(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Er(t.u)||(t.S=coe(t.u)),[Object.keys(t).reduce((s,o)=>{const a=e(o);return a&&(s[a]=t[o]),s},{}),r,i]}let Zj=null;function $nt(){return Zj||(Zj=ar.fromMillis(1555555555555)),Zj}function Int(t,e){if(t.literal)return t;const r=Yl.macroTokenToFormatOpts(t.val),i=sRe(r,e);return i==null||i.includes(void 0)?t:i}function iRe(t,e){return Array.prototype.concat(...t.map(r=>Int(r,e)))}function nRe(t,e,r){const i=iRe(Yl.parseFormat(r),t),n=i.map(o=>Cnt(o,t)),s=n.find(o=>o.invalidReason);if(s)return{input:e,tokens:i,invalidReason:s.invalidReason};{const[o,a]=Ont(n),l=RegExp(o,"i"),[c,u]=Mnt(e,l,a),[h,p,f]=u?Rnt(u):[null,null,void 0];if(tA(u,"a")&&tA(u,"H"))throw new i3("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:u,result:h,zone:p,specificOffset:f}}}function Lnt(t,e,r){const{result:i,zone:n,specificOffset:s,invalidReason:o}=nRe(t,e,r);return[i,n,s,o]}function sRe(t,e){if(!t)return null;const i=Yl.create(e,t).dtFormatter($nt()),n=i.formatToParts(),s=i.resolvedOptions();return n.map(o=>Ant(o,t,s))}const Jj="Invalid DateTime",Rfe=864e13;function o5(t){return new zf("unsupported zone",`the zone "${t.name}" is not supported`)}function Qj(t){return t.weekData===null&&(t.weekData=Bz(t.c)),t.weekData}function Kj(t){return t.localWeekData===null&&(t.localWeekData=Bz(t.c,t.loc.getMinDaysInFirstWeek(),t.loc.getStartOfWeek())),t.localWeekData}function Rw(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new ar({...r,...e,old:r})}function oRe(t,e,r){let i=t-e*60*1e3;const n=r.offset(i);if(e===n)return[i,e];i-=(n-e)*60*1e3;const s=r.offset(i);return n===s?[i,n]:[t-Math.min(n,s)*60*1e3,Math.max(n,s)]}function a5(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function _6(t,e,r){return oRe(f7(t),e,r)}function $fe(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),n=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,s={...t.c,year:i,month:n,day:Math.min(t.c.day,Gz(i,n))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=Oi.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=f7(s);let[l,c]=oRe(a,r,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function FO(t,e,r,i,n,s){const{setZone:o,zone:a}=r;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=ar.fromObject(t,{...r,zone:l,specificOffset:s});return o?c:c.setZone(a)}else return ar.invalid(new zf("unparsable",`the input "${n}" can't be parsed as ${i}`))}function l5(t,e,r=!0){return t.isValid?Yl.create(bn.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function eH(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=Fo(t.c.year,r?6:4),e?(i+="-",i+=Fo(t.c.month),i+="-",i+=Fo(t.c.day)):(i+=Fo(t.c.month),i+=Fo(t.c.day)),i}function Ife(t,e,r,i,n,s){let o=Fo(t.c.hour);return e?(o+=":",o+=Fo(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!r)&&(o+=":")):o+=Fo(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!r)&&(o+=Fo(t.c.second),(t.c.millisecond!==0||!i)&&(o+=".",o+=Fo(t.c.millisecond,3))),n&&(t.isOffsetFixed&&t.offset===0&&!s?o+="Z":t.o<0?(o+="-",o+=Fo(Math.trunc(-t.o/60)),o+=":",o+=Fo(Math.trunc(-t.o%60))):(o+="+",o+=Fo(Math.trunc(t.o/60)),o+=":",o+=Fo(Math.trunc(t.o%60)))),s&&(o+="["+t.zone.ianaName+"]"),o}const aRe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},Dnt={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Nnt={ordinal:1,hour:0,minute:0,second:0,millisecond:0},lRe=["year","month","day","hour","minute","second","millisecond"],Fnt=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],knt=["year","ordinal","hour","minute","second","millisecond"];function Unt(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new uMe(t);return e}function Lfe(t){switch(t.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return Unt(t)}}function Dfe(t,e){const r=Cv(e.zone,oo.defaultZone),i=bn.fromObject(e),n=oo.now();let s,o;if(Er(t.year))s=n;else{for(const c of lRe)Er(t[c])&&(t[c]=aRe[c]);const a=LMe(t)||DMe(t);if(a)return ar.invalid(a);const l=r.offset(n);[s,o]=_6(t,l,r)}return new ar({ts:s,zone:r,loc:i,o})}function Nfe(t,e,r){const i=Er(r.round)?!0:r.round,n=(o,a)=>(o=uoe(o,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(o,a)),s=o=>r.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(r.unit)return n(s(r.unit),r.unit);for(const o of r.units){const a=s(o);if(Math.abs(a)>=1)return n(a,o)}return n(t>e?-0:0,r.units[r.units.length-1])}function Ffe(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class ar{constructor(e){const r=e.zone||oo.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new zf("invalid input"):null)||(r.isValid?null:o5(r));this.ts=Er(e.ts)?oo.now():e.ts;let n=null,s=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[n,s]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);n=a5(this.ts,a),i=Number.isNaN(n.year)?new zf("invalid input"):null,n=i?null:n,s=i?null:a}this._zone=r,this.loc=e.loc||bn.create(),this.invalid=i,this.weekData=null,this.localWeekData=null,this.c=n,this.o=s,this.isLuxonDateTime=!0}static now(){return new ar({})}static local(){const[e,r]=Ffe(arguments),[i,n,s,o,a,l,c]=r;return Dfe({year:i,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=Ffe(arguments),[i,n,s,o,a,l,c]=r;return e.zone=al.utcInstance,Dfe({year:i,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=fit(e)?e.valueOf():NaN;if(Number.isNaN(i))return ar.invalid("invalid input");const n=Cv(r.zone,oo.defaultZone);return n.isValid?new ar({ts:i,zone:n,loc:bn.fromObject(r)}):ar.invalid(o5(n))}static fromMillis(e,r={}){if(mT(e))return e<-Rfe||e>Rfe?ar.invalid("Timestamp out of range"):new ar({ts:e,zone:Cv(r.zone,oo.defaultZone),loc:bn.fromObject(r)});throw new bu(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(mT(e))return new ar({ts:e*1e3,zone:Cv(r.zone,oo.defaultZone),loc:bn.fromObject(r)});throw new bu("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=Cv(r.zone,oo.defaultZone);if(!i.isValid)return ar.invalid(o5(i));const n=bn.fromObject(r),s=jz(e,Lfe),{minDaysInFirstWeek:o,startOfWeek:a}=bfe(s,n),l=oo.now(),c=Er(r.specificOffset)?i.offset(l):r.specificOffset,u=!Er(s.ordinal),h=!Er(s.year),p=!Er(s.month)||!Er(s.day),f=h||p,g=s.weekYear||s.weekNumber;if((f||u)&&g)throw new i3("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(p&&u)throw new i3("Can't mix ordinal dates with month/day");const y=g||s.weekday&&!f;let v,b,w=a5(l,c);y?(v=Fnt,b=Dnt,w=Bz(w,o,a)):u?(v=knt,b=Nnt,w=Xj(w)):(v=lRe,b=aRe);let x=!1;for(const z of v){const W=s[z];Er(W)?x?s[z]=b[z]:s[z]=w[z]:x=!0}const S=y?hit(s,o,a):u?dit(s):LMe(s),E=S||DMe(s);if(E)return ar.invalid(E);const P=y?_fe(s,o,a):u?vfe(s):s,[M,L]=_6(P,c,i),U=new ar({ts:M,zone:i,o:L,loc:n});return s.weekday&&f&&e.weekday!==U.weekday?ar.invalid("mismatched weekday",`you can't specify both a weekday of ${s.weekday} and a date of ${U.toISO()}`):U}static fromISO(e,r={}){const[i,n]=int(e);return FO(i,n,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,n]=nnt(e);return FO(i,n,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,n]=snt(e);return FO(i,n,r,"HTTP",r)}static fromFormat(e,r,i={}){if(Er(e)||Er(r))throw new bu("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:s=null}=i,o=bn.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0}),[a,l,c,u]=Lnt(o,e,r);return u?ar.invalid(u):FO(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return ar.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,n]=dnt(e);return FO(i,n,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new bu("need to specify a reason the DateTime is invalid");const i=e instanceof zf?e:new zf(e,r);if(oo.throwOnInvalid)throw new Vrt(i);return new ar({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,r={}){const i=sRe(e,bn.fromObject(r));return i?i.map(n=>n?n.val:null).join(""):null}static expandFormat(e,r={}){return iRe(Yl.parseFormat(e),bn.fromObject(r)).map(n=>n.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Qj(this).weekYear:NaN}get weekNumber(){return this.isValid?Qj(this).weekNumber:NaN}get weekday(){return this.isValid?Qj(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?Kj(this).weekday:NaN}get localWeekNumber(){return this.isValid?Kj(this).weekNumber:NaN}get localWeekYear(){return this.isValid?Kj(this).weekYear:NaN}get ordinal(){return this.isValid?Xj(this.c).ordinal:NaN}get monthShort(){return this.isValid?n5.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?n5.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?n5.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?n5.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,r=6e4,i=f7(this.c),n=this.zone.offset(i-e),s=this.zone.offset(i+e),o=this.zone.offset(i-n*r),a=this.zone.offset(i-s*r);if(o===a)return[this];const l=i-o*r,c=i-a*r,u=a5(l,o),h=a5(c,a);return u.hour===h.hour&&u.minute===h.minute&&u.second===h.second&&u.millisecond===h.millisecond?[Rw(this,{ts:l}),Rw(this,{ts:c})]:[this]}get isInLeapYear(){return vN(this.year)}get daysInMonth(){return Gz(this.year,this.month)}get daysInYear(){return this.isValid?j3(this.year):NaN}get weeksInWeekYear(){return this.isValid?iD(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?iD(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:n}=Yl.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:n}}toUTC(e=0,r={}){return this.setZone(al.instance(e),r)}toLocal(){return this.setZone(oo.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=Cv(e,oo.defaultZone),e.equals(this.zone))return this;if(e.isValid){let n=this.ts;if(r||i){const s=e.offset(this.ts),o=this.toObject();[n]=_6(o,s,e)}return Rw(this,{ts:n,zone:e})}else return ar.invalid(o5(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const n=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return Rw(this,{loc:n})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=jz(e,Lfe),{minDaysInFirstWeek:i,startOfWeek:n}=bfe(r,this.loc),s=!Er(r.weekYear)||!Er(r.weekNumber)||!Er(r.weekday),o=!Er(r.ordinal),a=!Er(r.year),l=!Er(r.month)||!Er(r.day),c=a||l,u=r.weekYear||r.weekNumber;if((c||o)&&u)throw new i3("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&o)throw new i3("Can't mix ordinal dates with month/day");let h;s?h=_fe({...Bz(this.c,i,n),...r},i,n):Er(r.ordinal)?(h={...this.toObject(),...r},Er(r.day)&&(h.day=Math.min(Gz(h.year,h.month),h.day))):h=vfe({...Xj(this.c),...r});const[p,f]=_6(h,this.o,this.zone);return Rw(this,{ts:p,o:f})}plus(e){if(!this.isValid)return this;const r=Oi.fromDurationLike(e);return Rw(this,$fe(this,r))}minus(e){if(!this.isValid)return this;const r=Oi.fromDurationLike(e).negate();return Rw(this,$fe(this,r))}startOf(e,{useLocaleWeeks:r=!1}={}){if(!this.isValid)return this;const i={},n=Oi.normalizeUnit(e);switch(n){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(n==="weeks")if(r){const s=this.loc.getStartOfWeek(),{weekday:o}=this;o<s&&(i.weekNumber=this.weekNumber-1),i.weekday=s}else i.weekday=1;if(n==="quarters"){const s=Math.ceil(this.month/3);i.month=(s-1)*3+1}return this.set(i)}endOf(e,r){return this.isValid?this.plus({[e]:1}).startOf(e,r).minus(1):this}toFormat(e,r={}){return this.isValid?Yl.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):Jj}toLocaleString(e=Vz,r={}){return this.isValid?Yl.create(this.loc.clone(r),e).formatDateTime(this):Jj}toLocaleParts(e={}){return this.isValid?Yl.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:n=!0,extendedZone:s=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=eH(this,o);return a+="T",a+=Ife(this,o,r,i,n,s),a}toISODate({format:e="extended"}={}){return this.isValid?eH(this,e==="extended"):null}toISOWeekDate(){return l5(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:n=!1,extendedZone:s=!1,format:o="extended"}={}){return this.isValid?(n?"T":"")+Ife(this,o==="extended",r,e,i,s):null}toRFC2822(){return l5(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return l5(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?eH(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let n="HH:mm:ss.SSS";return(r||e)&&(i&&(n+=" "),r?n+="z":e&&(n+="ZZ")),l5(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():Jj}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return Oi.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...i},s=mit(r).map(Oi.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=vnt(a,l,s,n);return o?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff(ar.now(),e,r)}until(e){return this.isValid?Bs.fromDateTimes(this,e):this}hasSame(e,r,i){if(!this.isValid)return!1;const n=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(r,i)<=n&&n<=s.endOf(r,i)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||ar.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],s=e.unit;return Array.isArray(e.unit)&&(n=e.unit,s=void 0),Nfe(r,this.plus(i),{...e,numeric:"always",units:n,unit:s})}toRelativeCalendar(e={}){return this.isValid?Nfe(e.base||ar.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(ar.isDateTime))throw new bu("min requires all arguments be DateTimes");return wfe(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every(ar.isDateTime))throw new bu("max requires all arguments be DateTimes");return wfe(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:n=null,numberingSystem:s=null}=i,o=bn.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});return nRe(o,e,r)}static fromStringExplain(e,r,i={}){return ar.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return Vz}static get DATE_MED(){return hMe}static get DATE_MED_WITH_WEEKDAY(){return jrt}static get DATE_FULL(){return dMe}static get DATE_HUGE(){return pMe}static get TIME_SIMPLE(){return fMe}static get TIME_WITH_SECONDS(){return mMe}static get TIME_WITH_SHORT_OFFSET(){return gMe}static get TIME_WITH_LONG_OFFSET(){return yMe}static get TIME_24_SIMPLE(){return _Me}static get TIME_24_WITH_SECONDS(){return vMe}static get TIME_24_WITH_SHORT_OFFSET(){return bMe}static get TIME_24_WITH_LONG_OFFSET(){return wMe}static get DATETIME_SHORT(){return xMe}static get DATETIME_SHORT_WITH_SECONDS(){return SMe}static get DATETIME_MED(){return TMe}static get DATETIME_MED_WITH_SECONDS(){return EMe}static get DATETIME_MED_WITH_WEEKDAY(){return Hrt}static get DATETIME_FULL(){return CMe}static get DATETIME_FULL_WITH_SECONDS(){return PMe}static get DATETIME_HUGE(){return AMe}static get DATETIME_HUGE_WITH_SECONDS(){return OMe}}function kO(t){if(ar.isDateTime(t))return t;if(t&&t.valueOf&&mT(t.valueOf()))return ar.fromJSDate(t);if(t&&typeof t=="object")return ar.fromObject(t);throw new bu(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const cy="system",QT="unknown",Fb="UTC",znt=Intl.DateTimeFormat().resolvedOptions().timeZone,Vnt="shortOffset";function Bnt(t){return"timeZoneIANA"in t}function Gnt(t){return t.startsWith("UTC")}function jnt(t,e=!1){return{json:{read:{source:t,reader:(r,i)=>i[t]?v6(i[t]):null},write:!!e&&{allowNull:!0,writer(r,i){i[t]=r?Hnt(r):null}}}}}function v6(t,e=cy){return t?Bnt(t)?t.timeZoneIANA:qnt(t,e):e}function Hnt(t){return{timeZoneIANA:t}}function qnt(t,e=cy){if(!t||!afe.has(t.timeZone))return e;const r=afe.get(t.timeZone);return Gnt(t.timeZone)||t.respectsDaylightSaving?r:Wnt(r)}function Wnt(t){const e=ar.local().setZone(t),r=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${al.instance(-r).formatOffset(0,"narrow")}`}function pYt(t,e,r,i,n){if(e&&n==="date")return{timeZone:Fb,timeZoneName:void 0};const s=i.timeStyle||i.hour,o=r===QT;return{timeZone:o?n==="timestamp-offset"?void 0:t??Fb:r,timeZoneName:o&&s?Vnt:void 0}}const Ynt={year:void 0,month:void 0,day:void 0,weekday:void 0},Xnt={hour:void 0,minute:void 0,second:void 0},cRe={timeZone:Fb},Mm={year:"numeric",month:"numeric",day:"numeric"},UO={year:"numeric",month:"long",day:"numeric"},zO={year:"numeric",month:"short",day:"numeric"},VO={year:"numeric",month:"long",weekday:"long",day:"numeric"},fv={hour:"numeric",minute:"numeric"},wx={...fv,second:"numeric"},uRe={hourCycle:"h23"},BO={...fv,...uRe},GO={...wx,...uRe},hRe={"short-date":Mm,"short-date-short-time":{...Mm,...fv},"short-date-short-time-24":{...Mm,...BO},"short-date-long-time":{...Mm,...wx},"short-date-long-time-24":{...Mm,...GO},"short-date-le":Mm,"short-date-le-short-time":{...Mm,...fv},"short-date-le-short-time-24":{...Mm,...BO},"short-date-le-long-time":{...Mm,...wx},"short-date-le-long-time-24":{...Mm,...GO},"long-month-day-year":UO,"long-month-day-year-short-time":{...UO,...fv},"long-month-day-year-short-time-24":{...UO,...BO},"long-month-day-year-long-time":{...UO,...wx},"long-month-day-year-long-time-24":{...UO,...GO},"day-short-month-year":zO,"day-short-month-year-short-time":{...zO,...fv},"day-short-month-year-short-time-24":{...zO,...BO},"day-short-month-year-long-time":{...zO,...wx},"day-short-month-year-long-time-24":{...zO,...GO},"long-date":VO,"long-date-short-time":{...VO,...fv},"long-date-short-time-24":{...VO,...BO},"long-date-long-time":{...VO,...wx},"long-date-long-time-24":{...VO,...GO},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":fv,"long-time":wx},Znt=tc()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),dRe={ar:"ar-u-nu-latn-ca-gregory"};let tQ=new WeakMap;const y7=hRe["short-date-short-time"];function Jnt(t){let e=tQ.get(t);if(!e){const r=Nh(),i=dRe[r]||r,n=moe(t.timeZone??cy),s={...t,timeZone:n};e=new Intl.DateTimeFormat(i,s),tQ.set(t,e)}return e}function Qnt(t){return hRe[t]}function _7(t,e=y7){return Jnt(e).format(t)}function fYt(t,e=y7){return _7(new Date(t),{...e,...cRe,...Xnt})}function mYt(t,e=y7){return _7(new Date(`1970-01-01T${t}Z`),{...e,...cRe,...Ynt})}function gYt(t,e=y7){if(e.timeZone)return _7(new Date(t),e);const r=ar.fromISO(t,{setZone:!0}),i=Nh(),n=dRe[i]??i,s=r.offset===0?Fb:e.timeZone,o={...e,timeZone:s};return r.toLocaleString(o,{locale:n})}function moe(t){switch(t){case cy:return znt;case QT:return Fb;default:return t}}Vne(()=>{tQ=new WeakMap});const Knt={ar:"ar-u-nu-latn"};let b6=new WeakMap,pRe={};function est(t){const e=t||pRe;if(!b6.has(e)){const r=Nh(),i=Knt[Nh()]||r;b6.set(e,new Intl.NumberFormat(i,t))}return b6.get(e)}function yYt(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function tst(t,e){return Object.is(t,-0)&&(t=0),est(e).format(t)}Vne(()=>{b6=new WeakMap,pRe={}});async function rst(t,e,r,i){const n=e.exec(r);if(!n)throw new B("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${e}"`);const s=n[1]?`${n[1]}/`:"",o=n[2],a=BXe(i),l=`${s}${o}.json`,c=a?`${s}${o}_${a}.json`:l;let u;try{u=await kfe(t(c))}catch(h){if(c===l)throw new B("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:h});try{u=await kfe(t(l))}catch(p){throw new B("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p})}}return u}async function kfe(t){if(Ufe.fetchBundleAsset!=null)return Ufe.fetchBundleAsset(t);const e=await Vt(t,{responseType:"text"});return JSON.parse(e.data)}let ist=class{constructor({base:e="",pattern:r,location:i=new URL(window.location.href)}){let n;n=typeof i=="string"?s=>new URL(s,new URL(i,window.location.href)).href:i instanceof URL?s=>new URL(s,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=n,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,r){return rst(this.getAssetUrl,this.matcher,e,r)}};function nst(t){return new ist(t)}const Ufe={};VXe(nst({pattern:"esri/",location:di}));const sst={};function ost(t){var r;const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:((r=t.packages)==null?void 0:r.concat())||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=sst.baseUrl),e}let ast=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>e[r](...i)})}},w6=class{constructor(){this._dispatcher=new ast,this._workerPostMessage({type:La.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){EP(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,r,i){this._dispatcher.addEventListener(e,r,i)}removeEventListener(e,r,i){this._dispatcher.removeEventListener(e,r,i)}_workerPostMessage(e){EP(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const r=rD(e);if(r&&r.type===La.OPEN){const{modulePath:i,jobId:n}=r;let s=await Nb.loadWorker(i);s||(s=await re(()=>import(i),__vite__mapDeps([])));const o=Nb.connect(s);this._workerPostMessage({type:La.OPENED,jobId:n,data:o})}}};const rQ=()=>K.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:lst}=La,cst='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let c5,u5;const zfe="Failed to create Worker. Fallback to execute module in main thread";async function ust(){if(!ne("esri-workers"))return Vfe(new w6);if(!c5&&!u5)try{const e=cst.split('"{CONFIGURATION}"').join(`'${hst()}'`);c5=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){u5=e||{}}let t;if(c5)try{t=new Worker(c5,{name:"esri-worker-"+dst++})}catch{rQ().warn(zfe,u5),t=new w6}else rQ().warn(zfe,u5),t=new w6;return Vfe(t)}async function Vfe(t){return new Promise(e=>{function r(n){const s=rD(n);s&&s.type===lst&&(t.removeEventListener("message",r),t.removeEventListener("error",i),e(t))}function i(n){n.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",i),rQ().warn("Failed to create Worker. Fallback to execute module in main thread",n),(t=new w6).addEventListener("message",r),t.addEventListener("error",i)}t.addEventListener("message",r),t.addEventListener("error",i)})}function hst(){let t;if(ai.default!=null){const n={...ai};delete n.default,t=JSON.parse(JSON.stringify(n))}else t=JSON.parse(JSON.stringify(ai));t.assetsPath=Tu(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?Tu(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Nh(),t.has={"esri-csp-restrictions":ne("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ne("esri-2d-update-debug"),"esri-2d-log-updating":ne("esri-2d-log-updating"),"featurelayer-pbf":ne("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":ne("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":ne("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ne("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ne("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":ne("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":ne("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":ne("featurelayer-snapshot-enabled"),"esri-atomics":ne("esri-atomics"),"esri-shared-array-buffer":ne("esri-shared-array-buffer"),"esri-tiles-debug":ne("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ne("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ne("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=Tu(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Tu(t.workers.workerPath):t.workers.workerPath=Tu(di("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=ai.workers.loaderConfig,r=ost({baseUrl:e==null?void 0:e.baseUrl,locale:Nh(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:r,kernelInfo:{buildDate:YCe,fullVersion:Mne,revision:XCe}})}let dst=0;const{ABORT:Bfe,INVOKE:pst,OPEN:fst,OPENED:mst,RESPONSE:jO}=La;let gst=class fRe{static async create(e){const r=await ust();return new fRe(r,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",i=>{i.preventDefault(),K.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(e,r={}){const{signal:i}=r,n=lMe();return new Promise((s,o)=>{const a={resolve:s,reject:o,abortHandle:iB(i,()=>{this._outJobs.delete(n),this._post({type:Bfe,jobId:n})})};this._outJobs.set(n,a),this._post({type:fst,jobId:n,modulePath:e})})}_onMessage(e){const r=rD(e);if(r)switch(r.type){case mst:this._onOpenedMessage(r);break;case jO:this._onResponseMessage(r);break;case Bfe:this._onAbortMessage(r);break;case pst:this._onInvokeMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,n=r.get(i);n&&(n.controller&&n.controller.abort(),r.delete(i))}_onInvokeMessage(e){const{methodName:r,jobId:i,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs,l=zrt[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,n,{signal:o?o.signal:null})}catch(u){return void this._post({type:jO,jobId:i,error:tD(u)})}Xu(c)?(a.set(i,{controller:o,promise:c}),c.then(u=>{a.has(i)&&(a.delete(i),this._post({type:jO,jobId:i},u))},u=>{a.has(i)&&(a.delete(i),u||(u={message:"Error encountered at method"+r}),on(u)||this._post({type:jO,jobId:i,error:tD(u||{message:`Error encountered at method ${r}`})}))})):this._post({type:jO,jobId:i},c)}_onOpenedMessage(e){const{jobId:r,data:i}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),Pi(n.abortHandle),n.resolve(i))}_onResponseMessage(e){const{jobId:r,error:i,data:n}=e,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),Pi(s.abortHandle),i?s.reject(B.fromJSON(JSON.parse(i))):s.resolve(n))}_post(e,r,i){return ooe(this.worker,e,r,i)}};const Gfe=ne("host-browser")?Math.min(navigator.hardwareConcurrency-1,ne("workers-pool-size")):0;let ZS=ne("esri-mobile")?Math.min(Gfe,3):Gfe;ZS||(ZS=ne("safari")&&ne("mac")?7:2);let jfe=0;const x6=[];function yst(){mRe()}async function h5(t,e){const r=new Urt,{registryTarget:i,...n}=e;return await r.open(t,n),i&&Art(i,r),r}async function _st(t,e={}){if(typeof t!="string")throw new B("workers:undefined-module","modulePath is missing");let r=e.strategy||"distributed";if(ne("host-webworker")&&!ne("esri-workers")&&(r="local"),r==="local"){let i=await Nb.loadWorker(t);i||(i=await re(()=>import(t),__vite__mapDeps([]))),dt(e.signal);const n=e.client||i;return h5([Nb.connect(i)],{...e,client:n})}if(await mRe(),dt(e.signal),r==="dedicated"){const i=jfe++%ZS;return h5([await x6[i].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const i=Math.min(e.maxNumWorkers,ZS);if(i<ZS){const n=new Array(i);for(let s=0;s<i;++s){const o=jfe++%ZS;n[s]=x6[o].open(t,e)}return h5(n,e)}}return h5(x6.map(i=>i.open(t,e)),e)}let d5=null;async function mRe(){if(d5)return d5;new AbortController;const t=[];for(let e=0;e<ZS;e++){const r=gst.create(e).then(i=>(x6[e]=i,i));t.push(r)}return d5=Promise.all(t),d5}function gRe(t,e){const r=$s(t),i=$s(e),n=r.store,s=i.store,o=i.metadata;for(const a in o){const l=o[a],c=n.originOf(a),u=s.originOf(a);if(!l.readOnly&&u!==We.DEFAULTS)if(c===We.DEFAULTS)t.set(a,s.get(a));else{const h=n.get(a),p=s.get(a);h&&p&&p instanceof Pe&&h instanceof Pe&&h instanceof p.constructor&&gRe(h,p)}}}let TI=class extends St{constructor(e){super(e),this.addHandles([this.on("before-add",r=>{r.item==null&&r.preventDefault()}),this.on("after-add",r=>this._own(r.item)),this.on("after-remove",r=>this._release(r.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(St.ofType(this.itemType.Type))(e):new St(e)}};function Hz(t,e){return{type:t,cast:i3e,set(r){const i=kT(r,this._get(e),t);i.owner=this,this._set(e,i)}}}d([m()],TI.prototype,"owner",null),TI=d([F("esri.core.support.OwningCollection")],TI);var lR;const qz=tc()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),yRe=qz.jsonValues.slice();RL(yRe,"orthometric");const EI=tc()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Wp=lR=class extends Se{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,r){return qz.write(t,e,r)}readHeightModel(t,e,r){return qz.read(t)||(r!=null&&r.messages&&r.messages.push(vst(t,{context:r})),null)}readHeightUnit(t,e,r){return EI.read(t)||(r!=null&&r.messages&&r.messages.push(Hfe(t,{context:r})),null)}readHeightUnitService(t,e,r){return v3e(t)||EI.read(t)||(r!=null&&r.messages&&r.messages.push(Hfe(t,{context:r})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new lR({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const r=b3e(e);return new lR({heightModel:t.heightModel,heightUnit:r??void 0,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new lR;return e.read(t,{origin:"web-scene"}),e}};function Hfe(t,e){return new sp("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function vst(t,e){return new sp("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}d([m({type:qz.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:yRe,default:"ellipsoidal"}}}})],Wp.prototype,"heightModel",void 0),d([nt("web-scene","heightModel")],Wp.prototype,"writeHeightModel",null),d([Xe(["web-scene","service"],"heightModel")],Wp.prototype,"readHeightModel",null),d([m({type:EI.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:EI.jsonValues,write:EI.write}}}})],Wp.prototype,"heightUnit",void 0),d([Xe("web-scene","heightUnit")],Wp.prototype,"readHeightUnit",null),d([Xe("service","heightUnit")],Wp.prototype,"readHeightUnitService",null),d([m({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Wp.prototype,"vertCRS",void 0),d([Xe("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Wp.prototype,"readVertCRS",null),Wp=lR=d([F("esri.geometry.HeightModelInfo")],Wp);const JA=Wp;function v7(t,e,r,i){return t!=null&&(yo(e,i)?(c_(r,t),!0):(Wc[0]=t[0],Wc[1]=t[1],Wc[2]=0,!!an(Wc,e,0,Wc,i,0,1)&&(r[0]=Wc[0],r[1]=Wc[1],Wc[0]=t[2],Wc[1]=t[3],Wc[2]=0,!!an(Wc,e,0,Wc,i,0,1)&&(r[2]=Wc[0],r[3]=Wc[1],!0))))}const Wc=C();function fo(t){return t?qfe(nn(t.origin),nn(t.direction)):qfe(C(),C())}function qfe(t,e){return{origin:t,direction:e}}function xYt(t,e){return ny(t.origin,e.origin)&&ny(t.direction,e.direction)}function Wh(t,e){const r=xst.get();return r.origin=t,r.direction=e,r}function Wz(t,e=fo()){return vRe(t.origin,t.direction,e)}function _Re(t,e,r=fo()){return he(r.origin,t),_e(r.direction,e,t),r}function vRe(t,e,r=fo()){return he(r.origin,t),he(r.direction,e),r}function bst(t,e){const r=it(je.get(),me(je.get(),t.direction),_e(je.get(),e,t.origin));return fe(r,r)}function wst(t,e,r){const i=fe(t.direction,_e(r,e,t.origin));return ge(r,t.origin,oe(r,t.direction,i)),r}const xst=new S_(()=>fo()),tH=()=>K.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let Sst=class{constructor(){this.plane=Yr(),this.origin=C(),this.basis1=C(),this.basis2=C()}};const bRe=Sst;function A_(t=RRe){return{plane:Yr(t.plane),origin:nn(t.origin),basis1:nn(t.basis1),basis2:nn(t.basis2)}}function Tst(t,e,r){const i=Nst.get();return i.origin=t,i.basis1=e,i.basis2=r,i.plane=OKe(0,0,0,0),b7(i),i}function E2(t,e=A_()){return goe(t.origin,t.basis1,t.basis2,e)}function Est(t,e){he(e.origin,t.origin),he(e.basis1,t.basis1),he(e.basis2,t.basis2),BB(e.plane,t.plane)}function goe(t,e,r,i=A_()){return he(i.origin,t),he(i.basis1,e),he(i.basis2,r),b7(i),Lst(i,"fromValues()"),i}function b7(t){YL(t.basis2,t.basis1,t.origin,t.plane)}function wRe(t,e,r){t!==r&&E2(t,r);const i=oe(je.get(),p_(t),e);return ge(r.origin,r.origin,i),r.plane[3]-=e,r}function Cst(t,e,r){return xRe(e,r),wRe(r,boe(t,t.origin),r),r}function xRe(t,e=A_()){const r=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return se(e.origin,t[0]+r,t[1]+i,0),se(e.basis1,r,0,0),se(e.basis2,0,i,0),_se(0,0,1,0,e.plane),e}function yoe(t,e,r){return!!v2(t.plane,e,r)&&ORe(t,r)}function Pst(t,e,r){if(yoe(t,e,r))return r;const i=SRe(t,e,je.get());return ge(r,e.origin,oe(je.get(),e.direction,Bi(e.origin,i)/Te(e.direction))),r}function SRe(t,e,r){const i=Yz.get();MRe(t,e,i,Yz.get());let n=Number.POSITIVE_INFINITY;for(const s of xoe){const o=woe(t,s,w7.get()),a=je.get();if($Ke(i,o,a)){const l=x_(je.get(),e.origin,a),c=Math.abs(_o(fe(e.direction,l)));c<n&&(n=c,he(r,a))}}return n===Number.POSITIVE_INFINITY?TRe(t,e,r):r}function TRe(t,e,r){if(yoe(t,e,r))return r;const i=Yz.get(),n=Yz.get();MRe(t,e,i,n);let s=Number.POSITIVE_INFINITY;for(const o of xoe){const a=woe(t,o,w7.get()),l=je.get();if(IKe(i,a,l)){const c=bst(e,l);if(!CAe(n,l))continue;c<s&&(s=c,he(r,l))}}return _oe(t,e.origin)<s&&ERe(t,e.origin,r),r}function ERe(t,e,r){const i=NKe(t.plane,e,je.get()),n=eJ(Wfe(t,t.basis1),i,-1,1,je.get()),s=eJ(Wfe(t,t.basis2),i,-1,1,je.get());return _e(r,ge(je.get(),n,s),t.origin),r}function CRe(t,e,r){const{origin:i,basis1:n,basis2:s}=t,o=_e(je.get(),e,i),a=bI(n,o),l=bI(s,o),c=bI(p_(t),o);return se(r,a,l,c)}function _oe(t,e){const r=CRe(t,e,je.get()),{basis1:i,basis2:n}=t,s=Te(i),o=Te(n),a=Math.max(Math.abs(r[0])-s,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function Ast(t,e){return Math.sqrt(_oe(t,e))}function Ost(t,e){let r=Number.NEGATIVE_INFINITY;for(const i of xoe){const n=woe(t,i,w7.get()),s=bse(n,e);s>r&&(r=s)}return Math.sqrt(r)}function voe(t,e){return CAe(t.plane,e)&&ORe(t,e)}function Mst(t,e,r,i){return Ist(t,r,i)}function boe(t,e){const r=-t.plane[3];return bI(p_(t),e)-r}function Rst(t,e,r,i){const n=boe(t,e),s=oe(Dst,p_(t),r-n);return ge(i,e,s),i}function PRe(t,e){return aa(t.basis1,e.basis1)&&aa(t.basis2,e.basis2)&&aa(t.origin,e.origin)}function ARe(t,e,r){return t!==r&&E2(t,r),us(W2,e),Bu(W2,W2),ze(r.basis1,t.basis1,W2),ze(r.basis2,t.basis2,W2),ze(r.plane,t.plane,W2),ze(r.origin,t.origin,e),JZ(r.plane,r.plane,r.origin),r}function $st(t,e,r,i){return t!==i&&E2(t,i),Gu(rH,e,r),ze(i.basis1,t.basis1,rH),ze(i.basis2,t.basis2,rH),b7(i),i}function p_(t){return t.plane}function Ist(t,e,r){switch(e){case wn.X:he(r,t.basis1),me(r,r);break;case wn.Y:he(r,t.basis2),me(r,r);break;case wn.Z:he(r,p_(t))}return r}function ORe(t,e){const r=_e(je.get(),e,t.origin),i=nl(t.basis1),n=nl(t.basis2),s=fe(t.basis1,r),o=fe(t.basis2,r);return-s-i<0&&s-i<0&&-o-n<0&&o-n<0}function Wfe(t,e){const r=w7.get();return he(r.origin,t.origin),he(r.vector,e),r}function woe(t,e,r){const{basis1:i,basis2:n,origin:s}=t,o=oe(je.get(),i,e.origin[0]),a=oe(je.get(),n,e.origin[1]);ge(r.origin,o,a),ge(r.origin,r.origin,s);const l=oe(je.get(),i,e.direction[0]),c=oe(je.get(),n,e.direction[1]);return oe(r.vector,ge(l,l,c),2),r}function Lst(t,e){Math.abs(fe(t.basis1,t.basis2)/(Te(t.basis1)*Te(t.basis2)))>1e-6&&tH().warn(e,"Provided basis vectors are not perpendicular"),Math.abs(fe(t.basis1,p_(t)))>1e-6&&tH().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-fe(p_(t),t.origin)-t.plane[3])>1e-6&&tH().warn(e,"Plane offset is not consistent with plane origin")}function MRe(t,e,r,i){const n=p_(t);YL(n,e.direction,e.origin,r),YL(r,n,e.origin,i)}const RRe={plane:Yr(),origin:Ce(0,0,0),basis1:Ce(1,0,0),basis2:Ce(0,1,0)},Yz=new S_(Yr),w7=new S_(bm),Dst=C(),Nst=new S_(()=>A_()),xoe=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],W2=xe(),rH=xe(),Fst=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:bRe,altitudeAt:boe,axisAt:Mst,closestPoint:TRe,closestPointOnSilhouette:SRe,copy:E2,copyWithoutVerify:Est,create:A_,distance:Ast,distance2:_oe,distanceToSilhouette:Ost,elevate:wRe,equals:PRe,extrusionContainsPoint:voe,fromAABoundingRect:xRe,fromValues:goe,intersectRay:yoe,intersectRayClosestSilhouette:Pst,normal:p_,projectPoint:ERe,projectPointLocal:CRe,rotate:$st,setAltitudeAt:Rst,setExtent:Cst,transform:ARe,up:RRe,updateUnboundedPlane:b7,wrap:Tst},Symbol.toStringTag,{value:"Module"})),$Re=hs();function hs(){return tr()}const kst=YT,Ust=YT;function KT(t,e){return qd(e,t)}function IRe(t,e){return Xt(t[0],t[1],t[2],e)}function zst(t){return t}function Vst(t){t[0]=t[1]=t[2]=t[3]=0}function x7(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function H0(t){return t[3]}function Bst(t){return t}function LRe(t,e,r,i){return Xt(t,e,r,i)}function Gst(t,e,r){return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),r[3]=t[3]+e,r}function jst(t,e,r){return K.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t!==r&&KT(t,r),r}function cw(t,e,r){if(e==null||!DRe(t,e,Xz))return!1;let{t0:i,t1:n}=Xz;if((i<0||n<i&&n>0)&&(i=n),i<0)return!1;if(r){const{origin:s,direction:o}=e;r[0]=s[0]+o[0]*i,r[1]=s[1]+o[1]*i,r[2]=s[2]+o[2]*i}return!0}function Hst(t,e,r){const i=_Re(e,r);if(!DRe(t,i,Xz))return[];const{origin:n,direction:s}=i,{t0:o,t1:a}=Xz,l=c=>{const u=C();return ho(u,n,s,c),Soe(t,u,u)};return Math.abs(o-a)<ml()?[l(o)]:[l(o),l(a)]}const Xz={t0:0,t1:0};function DRe(t,e,r){const{origin:i,direction:n}=e,s=qst;s[0]=i[0]-t[0],s[1]=i[1]-t[1],s[2]=i[2]-t[2];const o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(o===0)return!1;const a=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=a*a-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return r.t0=(-a-c)/(2*o),r.t1=(-a+c)/(2*o),!0}const qst=C();function iQ(t,e){return cw(t,e,null)}function Wst(t,e,r){if(cw(t,e,r))return r;const i=QA(t,e,je.get());return ge(r,e.origin,oe(je.get(),e.direction,Bi(e.origin,i)/Te(e.direction))),r}function QA(t,e,r){const i=je.get(),n=yse.get();it(i,e.origin,e.direction);const s=H0(t);it(r,i,e.origin),oe(r,r,1/Te(r)*s);const o=FRe(t,e.origin),a=zB(e.origin,r);return Gu(n,a+o,i),ze(r,r,n),r}function Yst(t,e,r){return cw(t,e,r)?r:(wst(e,t,r),Soe(t,r,r))}function Soe(t,e,r){const i=_e(je.get(),e,t),n=oe(je.get(),i,t[3]/Te(i));return ge(r,n,t)}function NRe(t,e){const r=_e(je.get(),e,t),i=nl(r),n=t[3]*t[3];return Math.sqrt(Math.abs(i-n))}function FRe(t,e){const r=_e(je.get(),e,t),i=Te(r),n=H0(t),s=n+Math.abs(n-i);return _o(n/s)}const iH=C();function kRe(t,e,r,i){const n=_e(iH,e,t);switch(r){case wn.X:{const s=epe(n,iH)[2];return se(i,-Math.sin(s),Math.cos(s),0)}case wn.Y:{const s=epe(n,iH),o=s[1],a=s[2],l=Math.sin(o);return se(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case wn.Z:return me(i,n);default:return}}function URe(t,e){const r=_e(nQ,e,t);return Te(r)-t[3]}function Xst(t,e,r,i){const n=URe(t,e),s=kRe(t,e,wn.Z,nQ),o=oe(nQ,s,r-n);return ge(i,e,o)}function Zst(t,e){const r=ca(t,e),i=H0(t);return r<=i*i}function Jst(t,e,r=tr()){const i=Bi(t,e),n=t[3],s=e[3];return i+s<n?(qd(r,t),r):i+n<s?(qd(r,e),r):(pi(r,t,e,(i+s-n)/(2*i)),r[3]=(i+n+s)/2,r)}const nQ=C(),S7=hs(),Qst=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:$Re,altitudeAt:URe,angleToSilhouette:FRe,axisAt:kRe,clear:Vst,closestPoint:Yst,closestPointOnSilhouette:QA,containsPoint:Zst,copy:KT,create:hs,distanceToSilhouette:NRe,elevate:Gst,equals:Ust,exactEquals:kst,fromCenterAndRadius:IRe,fromRadius:x7,fromValues:LRe,getCenter:Bst,getRadius:H0,intersectLine:Hst,intersectRay:cw,intersectRayClosestSilhouette:Wst,intersectsRay:iQ,projectPoint:Soe,setAltitudeAt:Xst,setExtent:jst,tmpSphere:S7,union:Jst,wrap:zst},Symbol.toStringTag,{value:"Module"}));function Kst(t){const{value:e,operations:r}=t;return{operations:r,value:r.create(e)}}function eot(t,e,r){return t.operations.setExtent(t.value,e,r.value),r}function tot(t){return{operations:t,value:t.create()}}function zRe(t,e,r=tot(t)){return r.operations=t,t.copy(e,r.value),r}function rot(t){return zRe(Qst,LRe(0,0,0,zr(t).radius))}const Yfe=2**50;function iot(){return zRe(Fst,goe([0,0,0],[Yfe,0,0],[0,Yfe,0]))}function not(t,e,r){return t.operations.axisAt(t.value,e,wn.Z,r)}function sot(t,e,r,i){return t.operations.axisAt(t.value,e,r,i)}function oot(t,e,r){return t.operations.intersectRay(t.value,e,r)}function aot(t,e,r){return t.operations.intersectRayClosestSilhouette(t.value,e,r)}function lot(t,e){return t.operations.altitudeAt(t.value,e)}function VRe(t,e,r,i){return t.operations.setAltitudeAt(t.value,e,r,i)}function cot(t,e,r,i){return e!==i&&cs(i,e),se(Y2,i[12],i[13],i[14]),VRe(t,Y2,r,Y2),i[12]=Y2[0],i[13]=Y2[1],i[14]=Y2[2],i}function nH(t,e,r){return t.operations.elevate(t.value,e,r.value)}const Y2=C();function Xfe(t,e,r,i,n){return n[0]=fe(t,e),n[1]=fe(t,r),n[2]=fe(t,i),n}function sQ(t,e,r,i,n){he(r,t),he(p5,e),me(p5,p5),it(i,p5,r),it(n,i,r)}function uot(t,e){return t?Kl(e):e.isGeographic?Ve.PlateCarree:e}const p5=C(),Toe=96;function TYt(t,e){const r=e||t.extent,i=t.width,n=fl(r==null?void 0:r.spatialReference);return r&&i?r.width/i*n*kne*Toe:0}function hot(t,e){return t/(fl(e)*kne*Toe)}function dot(t){return t/(kne*Toe)}function EYt(t,e,r){return pot(t,e)&&fot(t,r)}function pot(t,e){return e===0||sb(t,e)||t<e}function fot(t,e){return e===0||sb(t,e)||t>e}let rA=class extends TI{constructor(e){super(e),this.addHandles(this.on("before-add",r=>{r.item!=null&&r.item.parent===this.owner&&(K.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),r.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};rA=d([F("esri.support.AnalysesCollection")],rA);const S6={widthBreakpoint:{getValue(t){const e=t.viewSize[0],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,r=e[0],i=e[1],n=this.values;return i>=r?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},sH={xsmall:544,small:768,medium:992,large:1200};function mot(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function oH(t,e){return e?S6[t].valueToClassName[e].split(" "):[]}const got=t=>{let e=class extends t{constructor(...r){super(...r),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=sH}initialize(){this.addHandles(pe(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),mi))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=mot(r);if(!i){const n=JSON.stringify(sH,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}r=i?r:sH,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=vu.acquire(),i=vu.acquire();let n,s=!1;for(n in S6){const o=this[n],a=S6[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(s=!0,this[n]=a,oH(n,o).forEach(l=>i.push(l)),oH(n,a).forEach(l=>r.push(l)))}s&&(this._applyClassNameChanges(r,i),vu.release(r),vu.release(i))}_applyClassNameChanges(r,i){const n=this.container;n&&(i.forEach(s=>n.classList.remove(s)),r.forEach(s=>n.classList.add(s)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in S6)oH(i,this[i]).forEach(n=>r.classList.remove(n))}};return d([m()],e.prototype,"breakpoints",null),d([m()],e.prototype,"orientation",void 0),d([m()],e.prototype,"widthBreakpoint",void 0),d([m()],e.prototype,"heightBreakpoint",void 0),e=d([F("esri.views.BreakpointsOwner")],e),e};let em=class extends Pe{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,r,i={}){return this._installWatch(e,r,i,pe)}addWhen(e,r,i={}){return this._installWatch(e,r,i,up)}addOnCollectionChange(e,r,{initial:i=!1,final:n=!1}={}){const s=++this._handleId;return this.addHandles([jo(e,"after-changes",this._createSyncUpdatingCallback(),ei),jo(e,"change",r,{onListenerAdd:i?o=>r({added:o.toArray(),removed:[]}):void 0,onListenerRemove:n?o=>r({added:[],removed:o.toArray()}):void 0})],s),ri(()=>this.removeHandles(s))}addPromise(e){if(e==null)return e;const r=++this._handleId;this.addHandles(ri(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(f5)||this._set("updating",!1))}),r),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this.removeHandles(r);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,r,i={},n){const s=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,s);const o=n(e,r,i);return this.addHandles(o,s),ri(()=>this.removeHandles(s))}_installSyncUpdatingWatch(e,r){const i=this._createSyncUpdatingCallback(),n=pe(e,i,{sync:!0,equals:()=>!1});return this.addHandles(n,r),n}_createSyncUpdatingCallback(){return()=>{this.removeHandles(f5),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(m2(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(f5))}),f5)}}};d([m({readOnly:!0})],em.prototype,"updating",void 0),em=d([F("esri.core.support.UpdatingHandles")],em);const f5=-42;/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var yot=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},bS={exports:{}},Ns={},nD={exports:{}},C2={};function BRe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function _ot(t,e,r){}function vot(t,e,r){}var bot=/javascript\s*\:/img;function wot(t,e){return bot.test(e)?"":e}C2.whiteList=BRe();C2.getDefaultWhiteList=BRe;C2.onAttr=_ot;C2.onIgnoreAttr=vot;C2.safeAttrValue=wot;var xot={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,n;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,n=t.length;i<n;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},HO=xot;function Sot(t,e){t=HO.trimRight(t),t[t.length-1]!==";"&&(t+=";");var r=t.length,i=!1,n=0,s=0,o="";function a(){if(!i){var u=HO.trim(t.slice(n,s)),h=u.indexOf(":");if(h!==-1){var p=HO.trim(u.slice(0,h)),f=HO.trim(u.slice(h+1));if(p){var g=e(n,o.length,p,f,u);g&&(o+=g+"; ")}}}n=s+1}for(;s<r;s++){var l=t[s];if(l==="/"&&t[s+1]==="*"){var c=t.indexOf("*/",s+2);if(c===-1)break;s=c+1,n=s+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return HO.trim(o)}var Tot=Sot,m5=C2,Eot=Tot;function Zfe(t){return t==null}function Cot(t){var e={};for(var r in t)e[r]=t[r];return e}function GRe(t){t=Cot(t||{}),t.whiteList=t.whiteList||m5.whiteList,t.onAttr=t.onAttr||m5.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||m5.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||m5.safeAttrValue,this.options=t}GRe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,n=r.onAttr,s=r.onIgnoreAttr,o=r.safeAttrValue,a=Eot(t,function(l,c,u,h,p){var f=i[u],g=!1;if(f===!0?g=f:typeof f=="function"?g=f(h):f instanceof RegExp&&(g=f.test(h)),g!==!0&&(g=!1),h=o(u,h),!!h){var y={position:c,sourcePosition:l,source:p,isWhite:g};if(g){var v=n(u,h,y);return Zfe(v)?u+":"+h:v}else{var v=s(u,h,y);if(!Zfe(v))return v}}});return a};var Pot=GRe;(function(t,e){var r=C2,i=Pot;function n(o,a){var l=new i(a);return l.process(o)}e=t.exports=n,e.FilterCSS=i;for(var s in r)e[s]=r[s]})(nD,nD.exports);var Eoe={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,n;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,n=t.length;i<n;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,r=e.exec(t);return r?r.index:-1}},Aot=nD.exports.FilterCSS,Oot=nD.exports.getDefaultWhiteList,Zz=Eoe;function jRe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var HRe=new Aot;function Mot(t,e,r){}function Rot(t,e,r){}function $ot(t,e,r){}function Iot(t,e,r){}function qRe(t){return t.replace(Dot,"&lt;").replace(Not,"&gt;")}function Lot(t,e,r,i){if(r=QRe(r),e==="href"||e==="src"){if(r=Zz.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(e==="background"){if(g5.lastIndex=0,g5.test(r))return""}else if(e==="style"){if(Jfe.lastIndex=0,Jfe.test(r)||(Qfe.lastIndex=0,Qfe.test(r)&&(g5.lastIndex=0,g5.test(r))))return"";i!==!1&&(i=i||HRe,r=i.process(r))}return r=KRe(r),r}var Dot=/</g,Not=/>/g,Fot=/"/g,kot=/&quot;/g,Uot=/&#([a-zA-Z0-9]*);?/gim,zot=/&colon;?/gim,Vot=/&newline;?/gim,g5=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,Jfe=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Qfe=/u\s*r\s*l\s*\(.*/gi;function WRe(t){return t.replace(Fot,"&quot;")}function YRe(t){return t.replace(kot,'"')}function XRe(t){return t.replace(Uot,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function ZRe(t){return t.replace(zot,":").replace(Vot," ")}function JRe(t){for(var e="",r=0,i=t.length;r<i;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return Zz.trim(e)}function QRe(t){return t=YRe(t),t=XRe(t),t=ZRe(t),t=JRe(t),t}function KRe(t){return t=WRe(t),t=qRe(t),t}function Bot(){return""}function Got(t,e){typeof e!="function"&&(e=function(){});var r=!Array.isArray(t);function i(o){return r?!0:Zz.indexOf(t,o)!==-1}var n=[],s=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return n.push([s!==!1?s:l.position,u]),s=!1,c}else return s||(s=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return Zz.forEach(n,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function jot(t){for(var e="",r=0;r<t.length;){var i=t.indexOf("<!--",r);if(i===-1){e+=t.slice(r);break}e+=t.slice(r,i);var n=t.indexOf("-->",i);if(n===-1)break;r=n+3}return e}function Hot(t){var e=t.split("");return e=e.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),e.join("")}Ns.whiteList=jRe();Ns.getDefaultWhiteList=jRe;Ns.onTag=Mot;Ns.onIgnoreTag=Rot;Ns.onTagAttr=$ot;Ns.onIgnoreTagAttr=Iot;Ns.safeAttrValue=Lot;Ns.escapeHtml=qRe;Ns.escapeQuote=WRe;Ns.unescapeQuote=YRe;Ns.escapeHtmlEntities=XRe;Ns.escapeDangerHtml5Entities=ZRe;Ns.clearNonPrintableCharacter=JRe;Ns.friendlyAttrValue=QRe;Ns.escapeAttrValue=KRe;Ns.onIgnoreTagStripAll=Bot;Ns.StripTagBody=Got;Ns.stripCommentTag=jot;Ns.stripBlankChar=Hot;Ns.cssFilter=HRe;Ns.getDefaultCSSWhiteList=Oot;var T7={},mv=Eoe;function qot(t){var e=mv.spaceIndex(t),r;return e===-1?r=t.slice(1,-1):r=t.slice(1,e+1),r=mv.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function Wot(t){return t.slice(0,2)==="</"}function Yot(t,e,r){var i="",n=0,s=!1,o=!1,a=0,l=t.length,c="",u="";e:for(a=0;a<l;a++){var h=t.charAt(a);if(s===!1){if(h==="<"){s=a;continue}}else if(o===!1){if(h==="<"){i+=r(t.slice(n,a)),s=a,n=a;continue}if(h===">"){i+=r(t.slice(n,s)),u=t.slice(s,a+1),c=qot(u),i+=e(s,i.length,c,u,Wot(u)),n=a+1,s=!1;continue}if(h==='"'||h==="'")for(var p=1,f=t.charAt(a-p);f.trim()===""||f==="=";){if(f==="="){o=h;continue e}f=t.charAt(a-++p)}}else if(h===o){o=!1;continue}}return n<t.length&&(i+=r(t.substr(n))),i}var Xot=/[^a-zA-Z0-9\\_:.-]/gim;function Zot(t,e){var r=0,i=0,n=[],s=!1,o=t.length;function a(p,f){if(p=mv.trim(p),p=p.replace(Xot,"").toLowerCase(),!(p.length<1)){var g=e(p,f||"");g&&n.push(g)}}for(var l=0;l<o;l++){var c=t.charAt(l),u,h;if(s===!1&&c==="="){s=t.slice(r,l),r=l+1,i=t.charAt(r)==='"'||t.charAt(r)==="'"?r:Qot(t,l+1);continue}if(s!==!1&&l===i){if(h=t.indexOf(c,l+1),h===-1)break;u=mv.trim(t.slice(i+1,h)),a(s,u),s=!1,l=h,r=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),s===!1)if(h=Jot(t,l),h===-1){u=mv.trim(t.slice(r,l)),a(u),s=!1,r=l+1;continue}else{l=h-1;continue}else if(h=Kot(t,l-1),h===-1){u=mv.trim(t.slice(r,l)),u=Kfe(u),a(s,u),s=!1,r=l+1;continue}else continue}return r<t.length&&(s===!1?a(t.slice(r)):a(s,Kfe(mv.trim(t.slice(r))))),mv.trim(n.join(" "))}function Jot(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="="?e:-1}}function Qot(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="'"||r==='"'?e:-1}}function Kot(t,e){for(;e>0;e--){var r=t[e];if(r!==" ")return r==="="?e:-1}}function eat(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function Kfe(t){return eat(t)?t.substr(1,t.length-2):t}T7.parseTag=Yot;T7.parseAttr=Zot;var tat=nD.exports.FilterCSS,mf=Ns,e$e=T7,rat=e$e.parseTag,iat=e$e.parseAttr,T6=Eoe;function y5(t){return t==null}function nat(t){var e=T6.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=T6.trim(t.slice(e+1,-1));var r=t[t.length-1]==="/";return r&&(t=T6.trim(t.slice(0,-1))),{html:t,closing:r}}function sat(t){var e={};for(var r in t)e[r]=t[r];return e}function oat(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map(function(i){return i.toLowerCase()}):e[r.toLowerCase()]=t[r];return e}function t$e(t){t=sat(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=mf.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=oat(t.whiteList||t.allowList):t.whiteList=mf.whiteList,t.onTag=t.onTag||mf.onTag,t.onTagAttr=t.onTagAttr||mf.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||mf.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||mf.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||mf.safeAttrValue,t.escapeHtml=t.escapeHtml||mf.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new tat(t.css))}t$e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,n=r.onTag,s=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,u=e.cssFilter;r.stripBlankChar&&(t=mf.stripBlankChar(t)),r.allowCommentTag||(t=mf.stripCommentTag(t));var h=!1;r.stripIgnoreTagBody&&(h=mf.StripTagBody(r.stripIgnoreTagBody,s),s=h.onIgnoreTag);var p=rat(t,function(f,g,y,v,b){var w={sourcePosition:f,position:g,isClosing:b,isWhite:Object.prototype.hasOwnProperty.call(i,y)},x=n(y,v,w);if(!y5(x))return x;if(w.isWhite){if(w.isClosing)return"</"+y+">";var S=nat(v),E=i[y],P=iat(S.html,function(M,L){var U=T6.indexOf(E,M)!==-1,z=o(y,M,L,U);return y5(z)?U?(L=l(y,M,L,u),L?M+'="'+L+'"':M):(z=a(y,M,L,U),y5(z)?void 0:z):z});return v="<"+y,P&&(v+=" "+P),S.closing&&(v+=" /"),v+=">",v}else return x=s(y,v,w),y5(x)?c(v):x},c);return h&&(p=h.remove(p)),p};var aat=t$e;(function(t,e){var r=Ns,i=T7,n=aat;function s(a,l){var c=new n(l);return c.process(a)}e=t.exports=s,e.filterXSS=s,e.FilterXSS=n,function(){for(var a in r)e[a]=r[a];for(var l in i)e[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(bS,bS.exports);var lat=function(){function t(e,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(s,o,a,l){return s==="a"&&o==="href"||(s==="img"||s==="source")&&o==="src"?i.sanitizeUrl(a):bS.exports.safeAttrValue(s,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var n;e&&!r?n=e:e&&r?(n=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(s){s==="whiteList"?n.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):n[s]=e[s]})):(n=Object.create(this.arcgisFilterOptions),n.whiteList=this.arcgisWhiteList),this.xssFilterOptions=n,this._xssFilter=new bS.exports.FilterXSS(n)}return t.prototype.sanitize=function(e,r){switch(r===void 0&&(r={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,r);default:return r.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,r){var i=(r??{}).isProtocolRequired,n=i===void 0?!0:i,s=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=s&&this.allowedProtocols.indexOf(s.toLowerCase())>-1;return o||a||l?bS.exports.escapeAttrValue(e):!s&&!n?bS.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,r,i,n){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,r,i,n):bS.exports.safeAttrValue(e,r,i,n)},t.prototype.validate=function(e,r){r===void 0&&(r={});var i=this.sanitize(e,r);return{isValid:e===i,sanitized:i}},t.prototype.encodeHTML=function(e){var r=this;return String(e).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},t.prototype.encodeAttrValue=function(e){var r=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(i,n){return r.test(i)?i:"&#x".concat(Number(e.charCodeAt(n)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var r={};return e.forEach(function(i){Object.keys(i).forEach(function(n){Array.isArray(i[n])&&Array.isArray(r[n])?r[n]=r[n].concat(i[n]):r[n]=i[n]})}),r},t.prototype._iterateOverObject=function(e,r){var i=this;r===void 0&&(r={});try{var n=!1,s=void 0;if(Array.isArray(e))s=e.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(n=!0,a.concat([c.sanitized]))},[]);else if(yot(e)){var o=Object.keys(e);s=o.reduce(function(a,l){var c=e[l],u=i.validate(c,r);return u.isValid?a[l]=c:(n=!0,a[l]=u.sanitized),a},{})}else return r.allowUndefined&&typeof e>"u"?void 0:null;return n?s:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const E7=new Map;function r$e(){E7.clear()}function cat(t){return E7.get(t)}function uat(t,e){E7.set(t,e)}function aH(t){E7.delete(t)}const hat=()=>K.getLogger("esri.widgets.support.widgetUtils");function dat(...t){const e=vu.acquire();for(let i=0;i<t.length;i++){const n=t[i],s=typeof n;if(s==="string")e.push(n);else if(Array.isArray(n))e.push.apply(e,n);else if(s==="object")for(const o in n)n[o]&&e.push(o)}const r=e.join(" ");return vu.release(e),r}(()=>{const t=new Map,e=new ResizeObserver(i=>{var n;r$e();for(const s of i)(n=t.get(s.target))==null||n(s)}),r=(i,n,s)=>(t.has(i)&&hat().error("Already observing element",i),t.set(i,n),e.observe(i,s),ri(()=>{e.unobserve(i),t.delete(i)}));return(i,n,s)=>{let o=null;return DT([pe(()=>typeof i=="function"?i():i,a=>{o==null||o.remove(),a&&(o=r(a,n,s))},li),ri(()=>o==null?void 0:o.remove())])}})();function pat(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function AYt(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function OYt(t){const e="data-node-ref";this[t.getAttribute(e)]=t}const fat=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],mat=fat.reduce((t,e)=>(t[e]=[],t),{}),gat=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],i$e=new lat({whiteList:mat,onTagAttr:(t,e,r)=>{const i=`${e}="${r}"`;if(gat.includes(e))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function yat(t){return t==="Enter"||t===" "}const n$e="http://www.w3.org/",C7=`${n$e}2000/svg`,s$e=`${n$e}1999/xlink`;let eme=[],Coe=(t,e)=>{let r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),e&&Object.keys(e).forEach(i=>{r[i]=e[i]}),r},Poe=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),o$e=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},_at=(t,e,r)=>{if(e.vnodeSelector!==""){for(let i=r;i<t.length;i++)if(Poe(t[i],e))return i}return-1},lH=(t,e,r,i)=>{let n=t[e];if(n.vnodeSelector==="")return;let s=n.properties;if(!(s&&(s.key===void 0?s.bind:s.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(Poe(a,n))throw new Error(`${r.vnodeSelector} had a ${n.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},vat=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},oQ=[],aQ=!1,a$e=t=>{(t.children||[]).forEach(a$e),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},tme=()=>{aQ=!1,oQ.forEach(a$e),oQ.length=0},rme=t=>{oQ.push(t),aQ||(aQ=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(tme,{timeout:16}):setTimeout(tme,16))},ime=t=>{let e=t.domNode;if(t.properties){let r=t.properties.exitAnimation;if(r)return e.style.pointerEvents="none",void r(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),rme(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),rme(t))},bat=(t,e,r)=>{if(!e)return;let i=r.eventHandlerInterceptor,n=Object.keys(e),s=n.length;for(let o=0;o<s;o++){let a=n[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")cQ(t,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let h=0;h<u;h++){let p=c[h];l[p]&&t.classList.add(p)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let h=0;h<u;h++){let p=c[h],f=l[p];f&&(o$e(f),r.styleApplyer(t,p,f))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,t,e)),a==="oninput"&&function(){let u=l;l=function(h){u.apply(this,[h]),h.target["oninput-value"]=h.target.value}}()),t[a]=l):r.namespace===C7?a==="href"?t.setAttributeNS(s$e,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=i$e.sanitize(l):lQ(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function lQ(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let Jz,wat=(t,e,r)=>{if(e)for(let i of e)n3(i,t,void 0,r)},l$e=(t,e,r)=>{wat(t,e.children,r),e.text&&(t.textContent=e.text),bat(t,e.properties,r),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,r,e.vnodeSelector,e.properties,e.children])},n3=(t,e,r,i)=>{let n,s=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")n=t.domNode=a.createTextNode(t.text),r!==void 0?e.insertBefore(n,r):e.appendChild(n);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(s-1),h=o.slice(s,l);u==="."?n.classList.add(h):u==="#"?n.id=h:(h==="svg"&&(i=Coe(i,{namespace:C7})),i.namespace!==void 0?n=t.domNode=a.createElementNS(i.namespace,h):(n=t.domNode=t.domNode||a.createElement(h),h==="input"&&t.properties&&t.properties.type!==void 0&&n.setAttribute("type",t.properties.type)),r!==void 0?e.insertBefore(n,r):n.parentNode!==e&&e.appendChild(n)),s=l+1}}l$e(n,t,i)}},cQ=(t,e,r)=>{e&&e.split(" ").forEach(i=>{i&&t.classList.toggle(i,r)})},xat=(t,e,r,i)=>{if(!r)return;let n=!1,s=Object.keys(r),o=s.length;for(let a=0;a<o;a++){let l=s[a],c=r[l],u=e[l];if(l==="class")u!==c&&(cQ(t,u,!1),cQ(t,c,!0));else if(l==="classes"){let h=t.classList,p=Object.keys(c),f=p.length;for(let g=0;g<f;g++){let y=p[g],v=!!c[y];v!==!!u[y]&&(n=!0,v?h.add(y):h.remove(y))}}else if(l==="styles"){let h=Object.keys(c),p=h.length;for(let f=0;f<p;f++){let g=h[f],y=c[g];y!==u[g]&&(n=!0,y?(o$e(y),i.styleApplyer(t,g,y)):i.styleApplyer(t,g,""))}}else if(c||typeof u!="string"||(c=""),l!=="value"||lQ(t)){if(c!==u){let h=typeof c;h==="function"&&i.eventHandlerInterceptor||(i.namespace===C7?l==="href"?t.setAttributeNS(s$e,l,c):t.setAttribute(l,c):h==="string"?l==="innerHTML"?t[l]=i$e.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):lQ(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),n=!0)}}else{let h=t[l];h!==c&&(t["oninput-value"]?h===t["oninput-value"]:c!==u)&&(t[l]=c,t["oninput-value"]=void 0),c!==u&&(n=!0)}}return n},Sat=(t,e,r,i,n)=>{if(r===i)return!1;i=i||eme;let s,o=(r=r||eme).length,a=i.length,l=0,c=0,u=!1;for(;c<a;){let h=l<o?r[l]:void 0,p=i[c];if(h!==void 0&&Poe(h,p))u=Jz(h,p,n)||u,l++;else{let f=_at(r,p,l+1);if(f>=0){for(s=l;s<f;s++)ime(r[s]),lH(r,s,t,"removed");u=Jz(r[f],p,n)||u,l=f+1}else n3(p,e,l<o?r[l].domNode:void 0,n),vat(p),lH(i,c,t,"added")}c++}if(o>l)for(s=l;s<o;s++)ime(r[s]),lH(r,s,t,"removed");return u};Jz=(t,e,r)=>{let i=t.domNode,n=!1;if(t===e)return!1;let s=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=i.ownerDocument.createTextNode(e.text);return i.parentNode.replaceChild(o,i),e.domNode=o,n=!0,n}e.domNode=i}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(r=Coe(r,{namespace:C7})),t.text!==e.text&&(s=!0,e.text===void 0?i.removeChild(i.firstChild):i.textContent=e.text),e.domNode=i,s=Sat(e,i,t.children,e.children,r)||s,s=xat(i,t.properties,e.properties,r)||s,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[i,r,e.vnodeSelector,e.properties,e.children]);return s&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(i,e.properties,t.properties),n};let qO=(t,e)=>({getLastRender:()=>t,update:r=>{if(t.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=t;t=r,Jz(i,r,e)},domNode:t.domNode});const Tat={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}};let iC=t=>Coe(Tat,t),Vv={create:(t,e)=>(e=iC(e),n3(t,document.createElement("div"),void 0,e),qO(t,e)),append:(t,e,r)=>(r=iC(r),n3(e,t,void 0,r),qO(e,r)),insertBefore:(t,e,r)=>(r=iC(r),n3(e,t.parentNode,t,r),qO(e,r)),merge:(t,e,r)=>(r=iC(r),e.domNode=t,l$e(t,e,r),qO(e,r)),replace:(t,e,r)=>(r=iC(r),n3(e,t.parentNode,t,r),t.parentNode.removeChild(t),qO(e,r))},c$e,Eat=(t,e)=>{let r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r};c$e=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let Cat=(t,e)=>{let r=t;return e.forEach(i=>{r=r&&r.children?c$e(r.children,n=>n.domNode===i):void 0}),r},Pat=(t,e,r)=>{let i=function(n){r("domEvent",n);let s=e(),o=Eat(n.currentTarget,s.domNode);o.reverse();let a,l=Cat(s.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${n.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",n),a};return(n,s,o,a)=>i},nme=t=>{let e,r,i=iC(t),n=i.performanceLogger,s=!0,o=!1,a=[],l=[],c=(h,p,f)=>{let g,y=()=>g;i.eventHandlerInterceptor=Pat(e,y,n),g=h(p,f(),i),a.push(g),l.push(f)},u=()=>{if(r=void 0,s){s=!1,n("renderStart",void 0);for(let h=0;h<a.length;h++){let p=l[h]();n("rendered",void 0),a[h].update(p),n("patched",void 0)}n("renderDone",void 0),s=!0}};return e={renderNow:u,scheduleRender:()=>{r||o||(r=requestAnimationFrame(u))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,s=!0,e.scheduleRender()},append:(h,p)=>{c(Vv.append,h,p)},insertBefore:(h,p)=>{c(Vv.insertBefore,h,p)},merge:(h,p)=>{c(Vv.merge,h,p)},replace:(h,p)=>{c(Vv.replace,h,p)},detach:h=>{for(let p=0;p<l.length;p++)if(l[p]===h)return l.splice(p,1),a.splice(p,1)[0];throw new Error("renderFunction was not found")}},e},L1=class extends Pe{constructor(){super(...arguments),this.items=new St,this._watchUpdatingTracking=new em,this._callbacks=new Map,this._projector=nme(),this._hiddenProjector=nme()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const i of r.added){const n=()=>i.render();this._callbacks.set(i,n),this._projector.append(this.surface,n)}for(const i of r.removed){const n=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(n.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const r=this._hiddenSurface,i=this._hiddenProjector;let n;const s=()=>(n=e.render(),n);i.append(r,s),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n!=null&&n.domNode){const a=n.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(s);r.firstChild;)r.removeChild(r.firstChild);return o}overlaps(e,r){const i=this.computeBoundingRect(e),n=this.computeBoundingRect(r);return Math.max(i.left,n.left)<=Math.min(i.right,n.right)&&Math.max(i.top,n.top)<=Math.min(i.bottom,n.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,r){const i=!!(r!=null&&r.disableDecorations);if(!this.items.some(s=>s.visible&&!(i&&s.isDecoration)))return;const n=e.getContext("2d");n.save(),n.font=this._fontString(),this.items.forEach(s=>{i&&s.isDecoration||(n.save(),s.renderCanvas(n),n.restore())}),n.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};d([m({readOnly:!0})],L1.prototype,"surface",void 0),d([m({readOnly:!0})],L1.prototype,"items",void 0),d([m({readOnly:!0})],L1.prototype,"needsRender",null),d([m({readOnly:!0})],L1.prototype,"_watchUpdatingTracking",void 0),d([m({readOnly:!0})],L1.prototype,"updating",null),L1=d([F("esri.views.overlay.ViewOverlay")],L1);const sme=L1,cH=[0,0];function Aat(t){const e=(t.ownerDocument||window.document).defaultView,r=t.getBoundingClientRect();return cH[0]=r.left+((e==null?void 0:e.pageXOffset)??0),cH[1]=r.top+((e==null?void 0:e.pageYOffset)??0),cH}function ome(t){t&&(sMe(t),t.parentNode&&t.parentNode.removeChild(t))}function Oat(t){const e=document.createElement("div");return t.appendChild(e),e}const WO=16,_5=750,Mat=512,Rat=2,$at=t=>{let e=class extends t{constructor(...r){super(...r),this._freqInfo={freq:WO,time:_5},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([pe(()=>this.cursor,i=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",i)}),pe(()=>this.navigating,i=>{const{surface:n}=this;n&&n.setAttribute("data-navigating",i.toString())})])}initialize(){const r=ne("mac"),i=async()=>{r&&(await qT(()=>this.ready),this.messagesCommon=await jne("esri/t9n/common").catch(()=>{}))};i(),this.addHandles([pe(()=>this.ui,(n,s)=>this._handleUIChange(n,s),mi),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused")),zne(i),pe(()=>[this.surface,this.messagesCommon],()=>{var n,s,o;r&&((o=this.surface)==null||o.setAttribute("aria-label",((s=(n=this.messagesCommon)==null?void 0:n.ariaLabels)==null?void 0:s.navigationMacVoiceOver)??""))})])}destroy(){this.destroyed||(this.ui=Me(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),n=h7(r);if(n||typeof r!="string"||K.getLogger(this).error("#container",`element with id '${r}' not found`),i===n)return;if(this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(ome(this.root),this._set("root",null)),this.userContent&&(tfe(this.userContent,i),ome(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const s=document.createElement("div");s.className="esri-view-user-storage",tfe(n,s),n.appendChild(s),this._set("userContent",s);const o=document.createElement("div");o.className="esri-view-root",n.insertBefore(o,n.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new sme;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(pe(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=FT({render:()=>{var u;return(u=this.overlay)==null?void 0:u.render()}}):this._overlayRenderTaskHandle=Pi(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",n),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}blur(){var r;(r=this.surface)==null||r.blur()}focus(){var r;(r=this.surface)==null||r.focus()}pageToContainer(r,i,n){const s=this.position;return r-=s?s[0]:0,i-=s?s[1]:0,n?(n[0]=r,n[1]=i):n=[r,i],n}containerToPage(r,i,n){const s=this.position;return r+=s?s[0]:0,i+=s?s[1]:0,n?(n[0]=r,n[1]=i):n=[r,i],n}_handleUIChange(r,i){this.removeHandles("ui"),i&&i!==r&&i.destroy(),r&&(r.view=this,this.addHandles(pe(()=>this.root,n=>{r.container=n?Oat(n):null},mi),"ui")),this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=WO,r.time=_5,this.addHandles([NA(window,"resize",()=>{r.freq=WO,r.time=_5}),FT({prepare:i=>{const n=this._measure(),s=this._freqInfo;if(s.time+=i.deltaTime,n&&(s.freq=WO,this._get("resizing")||this._set("resizing",!0)),s.time<s.freq)return;s.time=0;const o=this._position();s.freq=o||n?WO:Math.min(_5,s.freq*Rat),!n&&s.freq>=Mat&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,n=r?r.clientHeight:0;if(i===0||n===0)return this.suspended||this._set("suspended",!0),!1;const s=this.width,o=this.height;return i===s&&n===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:o,width:i,height:n}),!0)}_position(){const r=this.container,i=this.position,n=r&&Aat(r);return!!n&&(!i||n[0]!==i[0]||n[1]!==i[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return d([m()],e.prototype,"container",null),d([m({readOnly:!0})],e.prototype,"focused",null),d([m({readOnly:!0})],e.prototype,"height",void 0),d([m()],e.prototype,"messagesCommon",void 0),d([m({type:sme})],e.prototype,"overlay",void 0),d([m({readOnly:!0})],e.prototype,"position",void 0),d([m({readOnly:!0})],e.prototype,"resizing",void 0),d([m({readOnly:!0})],e.prototype,"root",void 0),d([m({value:null,readOnly:!0})],e.prototype,"size",null),d([m({readOnly:!0})],e.prototype,"surface",void 0),d([m({readOnly:!0})],e.prototype,"suspended",void 0),d([m()],e.prototype,"ui",void 0),d([m({readOnly:!0})],e.prototype,"userContent",void 0),d([m({readOnly:!0})],e.prototype,"width",void 0),d([m()],e.prototype,"widthBreakpoint",void 0),e=d([F("esri.views.DOMContainer")],e),e};function uw(t,e,r,i){return{x:t,y:e,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function ga(t,e,r,i,n){return!(e==null||i==null||t.length<2)&&(YO.x=t[0],YO.y=t[1],YO.z=t[2],YO.spatialReference=e,Cn(YO,r,i,n))}const YO=uw(0,0,0,Ve.WGS84);function uy(t,e,r){return!!ga(t,e,v5,r.spatialReference)&&(r.x=v5[0],r.y=v5[1],r.z=v5[2],!0)}async function u$e(t,e,r,i){return await mN(e,r.spatialReference,null,i),uy(t,e,r)}const v5=C();var Fe;function ame(t){return t==="global"?Fe.Global:Fe.Local}function uH(t){return t===Fe.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Fe||(Fe={}));var Yi,ha;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL",t[t.TILES3D=8]="TILES3D"})(Yi||(Yi={}));let Iat=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=ha.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(ha||(ha={}));let Lat=class{constructor(e,r,i){this.object=e,this.geometryId=r,this.triangleNr=i}},Dat=class extends Lat{constructor(e,r,i,n){super(e,r,i),this.center=n!=null?nn(n):null}},h$e=class{constructor(e){this.layerUid=e}},xN=class extends h$e{constructor(e,r){super(e),this.graphicUid=r}};function _p(t){return(t==null?void 0:t.dist)!=null}function lme(t){return(e,r,i)=>(pi(cme,e,r,i),!voe(t,cme))}function P7(t){return _p(t)&&t.intersector===Yi.OBJECT&&!!t.target}function A7(t){return _p(t)&&t.intersector===Yi.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const cme=C(),iA=1e-6,XO=C(),b5=C();function Nat(t,e){const{data:r,size:i}=t,n=r.length/i;if(n<=0)return;const s=new qat(t);hQ(XO,s.minProj,s.maxProj),cR(XO,XO,.5),Nd(b5,s.maxProj,s.minProj);const o=uQ(b5),a=new Wat;a.quality=o,n<14&&(t=new jA(new Float64Array(s.buffer,112,42),3));const l=C(),c=C(),u=C(),h=C(),p=C(),f=C(),g=C();switch(Fat(s,t,g,l,c,u,h,p,f,a)){case 1:return void pme(XO,b5,e);case 2:return void jat(t,h,e)}kat(t,g,l,c,u,h,p,f,a),d$e(t,a.b0,a.b1,a.b2,W3,Y3);const y=C();Nd(y,Y3,W3),a.quality=uQ(y),a.quality<o?p$e(a.b0,a.b1,a.b2,W3,Y3,y,e):pme(XO,b5,e)}function Fat(t,e,r,i,n,s,o,a,l,c){return Uat(t,i,n),dQ(i,n)<iA?1:(Nd(o,i,n),Aa(o,o),zat(e,i,o,s)<iA?2:(Nd(a,n,s),Aa(a,a),Nd(l,s,i),Aa(l,l),Fd(r,a,o),Aa(r,r),xx(e,r,o,a,l,c),0))}const ZO=C(),JO=C(),Kh=C(),ed=C(),td=C(),e1=C(),t1=C(),r1=C();function kat(t,e,r,i,n,s,o,a,l){Vat(t,e,r,ZO,JO),ZO[0]!==void 0&&(Nd(Kh,ZO,r),Aa(Kh,Kh),Nd(ed,ZO,i),Aa(ed,ed),Nd(td,ZO,n),Aa(td,td),Fd(e1,ed,s),Aa(e1,e1),Fd(t1,td,o),Aa(t1,t1),Fd(r1,Kh,a),Aa(r1,r1),xx(t,e1,s,ed,Kh,l),xx(t,t1,o,td,ed,l),xx(t,r1,a,Kh,td,l)),JO[0]!==void 0&&(Nd(Kh,JO,r),Aa(Kh,Kh),Nd(ed,JO,i),Aa(ed,ed),Nd(td,JO,n),Aa(td,td),Fd(e1,ed,s),Aa(e1,e1),Fd(t1,td,o),Aa(t1,t1),Fd(r1,Kh,a),Aa(r1,r1),xx(t,e1,s,ed,Kh,l),xx(t,t1,o,td,ed,l),xx(t,r1,a,Kh,td,l))}function Uat(t,e,r){let i=dQ(t.maxVert[0],t.minVert[0]),n=0;for(let s=1;s<7;++s){const o=dQ(t.maxVert[s],t.minVert[s]);o>i&&(i=o,n=s)}Ih(e,t.minVert[n]),Ih(r,t.maxVert[n])}const rd=[0,0,0];function zat(t,e,r,i){const{data:n,size:s}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<n.length;l+=s){rd[0]=n[l]-e[0],rd[1]=n[l+1]-e[1],rd[2]=n[l+2]-e[2];const c=r[0]*rd[0]+r[1]*rd[1]+r[2]*rd[2],u=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],h=rd[0]*rd[0]+rd[1]*rd[1]+rd[2]*rd[2]-c*c/u;h>o&&(o=h,a=l)}return Ih(i,n,a),o}const ao=Ye();function Vat(t,e,r,i,n){Gat(t,e,ao,n,i);const s=m$e(r,e);ao[1]-iA<=s&&(i[0]=void 0),ao[0]+iA>=s&&(n[0]=void 0)}const ume=C(),hme=C(),dme=C(),X2=C(),Z2=C(),w5=C();function xx(t,e,r,i,n,s){if(f$e(e)<iA)return;Fd(ume,r,e),Fd(hme,i,e),Fd(dme,n,e),q3(t,e,ao),Z2[1]=ao[0],X2[1]=ao[1],w5[1]=X2[1]-Z2[1];const o=[r,i,n],a=[ume,hme,dme];for(let l=0;l<3;++l){q3(t,o[l],ao),Z2[0]=ao[0],X2[0]=ao[1],q3(t,a[l],ao),Z2[2]=ao[0],X2[2]=ao[1],w5[0]=X2[0]-Z2[0],w5[2]=X2[2]-Z2[2];const c=uQ(w5);c<s.quality&&(Ih(s.b0,o[l]),Ih(s.b1,e),Ih(s.b2,a[l]),s.quality=c)}}const Bat=C();function q3(t,e,r){const{data:i,size:n}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<i.length;s+=n){const o=i[s]*e[0]+i[s+1]*e[1]+i[s+2]*e[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function Gat(t,e,r,i,n){const{data:s,size:o}=t;Ih(i,s),Ih(n,i),r[0]=m$e(Bat,e),r[1]=r[0];for(let a=o;a<s.length;a+=o){const l=s[a]*e[0]+s[a+1]*e[1]+s[a+2]*e[2];l<r[0]&&(r[0]=l,Ih(i,s,a)),l>r[1]&&(r[1]=l,Ih(n,s,a))}}function pme(t,e,r){r.center=t,r.halfSize=oe(e,e,.5),r.quaternion=DB}const Ry=C(),J2=C(),QO=C(),W3=C(),Y3=C(),fme=C();function jat(t,e,r){Ih(Ry,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Ry[0]=0:Math.abs(e[1])>Math.abs(e[2])?Ry[1]=0:Ry[2]=0,f$e(Ry)<iA&&(Ry[0]=Ry[1]=Ry[2]=1),Fd(J2,e,Ry),Aa(J2,J2),Fd(QO,e,J2),Aa(QO,QO),d$e(t,e,J2,QO,W3,Y3),Nd(fme,Y3,W3),p$e(e,J2,QO,W3,Y3,fme,r)}function d$e(t,e,r,i,n,s){q3(t,e,ao),n[0]=ao[0],s[0]=ao[1],q3(t,r,ao),n[1]=ao[0],s[1]=ao[1],q3(t,i,ao),n[2]=ao[0],s[2]=ao[1]}const $w=C(),KO=C(),x5=C(),Rm=yI(1,0,0,0,1,0,0,0,1),Hat=Gc();function p$e(t,e,r,i,n,s,o){Rm[0]=t[0],Rm[1]=t[1],Rm[2]=t[2],Rm[3]=e[0],Rm[4]=e[1],Rm[5]=e[2],Rm[6]=r[0],Rm[7]=r[1],Rm[8]=r[2],o.quaternion=Yat(Hat,Rm),hQ($w,i,n),cR($w,$w,.5),cR(KO,t,$w[0]),cR(x5,e,$w[1]),hQ(KO,KO,x5),cR(x5,r,$w[2]),o.center=ge(KO,KO,x5),o.halfSize=oe($w,s,.5)}const Qu=7;let qat=class{constructor(e){this.minVert=new Array(Qu),this.maxVert=new Array(Qu);const r=64*Qu;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,Qu),i+=8*Qu,this.maxProj=new Float64Array(this.buffer,i,Qu),i+=8*Qu;for(let l=0;l<Qu;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Qu;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Qu;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const n=new Array(Qu),s=new Array(Qu),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,n[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,s[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,n[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,s[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,n[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,s[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,n[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,s[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,n[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,s[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,n[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,s[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,n[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,s[6]=l)}for(let l=0;l<Qu;++l){let c=n[l];Ih(this.minVert[l],o,c),c=s[l],Ih(this.maxVert[l],o,c)}}},Wat=class{constructor(){this.b0=Ce(1,0,0),this.b1=Ce(0,1,0),this.b2=Ce(0,0,1),this.quality=0}};function uQ(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function hQ(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function Nd(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function cR(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function Ih(t,e,r=0){t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2]}function Fd(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2];t[0]=n*l-s*a,t[1]=s*o-i*l,t[2]=i*a-n*o}function Aa(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const i=1/Math.sqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function f$e(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function dQ(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function m$e(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Yat(t,e){const r=e[0]+e[4]+e[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const n=(i+1)%3,s=(i+2)%3;let o=Math.sqrt(e[3*i+i]-e[3*n+n]-e[3*s+s]+1);t[i]=.5*o,o=.5/o,t[3]=(e[3*n+s]-e[3*s+n])*o,t[n]=(e[3*n+i]+e[3*i+n])*o,t[s]=(e[3*s+i]+e[3*i+s])*o}return t}let Aoe=class E6{constructor(e=Yn,r=ilt,i=DB){this._data=[e[0],e[1],e[2],r[0],r[1],r[2],i[0],i[1],i[2],i[3]]}clone(){const e=new E6;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const r=new E6;return r._data=e.slice(),r}static fromJSON(e){return new E6(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return se(je.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,r,i){this._data[0]=e,this._data[1]=r,this._data[2]=i}get halfSize(){return se(je.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return eAe(EKe.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const r=hn,i=this._data;r[0]=i[6],r[1]=i[7],r[2]=i[8],r[3]=i[9];for(let n=0;n<8;++n){const s=e[n];s[0]=(1&n?-1:1)*i[3],s[1]=(2&n?-1:1)*i[4],s[2]=(4&n?-1:1)*i[5],pu(s,s,r),s[0]+=i[0],s[1]+=i[1],s[2]+=i[2]}}isVisible(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],r=this._data[4],i=this._data[5];return Math.sqrt(e*e+r*r+i*i)}intersectSphere(e){ur[0]=this._data[0]-e[0],ur[1]=this._data[1]-e[1],ur[2]=this._data[2]-e[2];const r=this.getQuaternion(O0);return lb(hn,r),pu(ur,ur,hn),DP(ur,ur),$y[0]=Math.min(ur[0],this._data[3]),$y[1]=Math.min(ur[1],this._data[4]),$y[2]=Math.min(ur[2],this._data[5]),GL($y,ur)<e[3]*e[3]}intersectSphereWithMBS(e,r=this.radius){const i=this._data;ur[0]=i[0]-e[0],ur[1]=i[1]-e[1],ur[2]=i[2]-e[2];const n=e[3],s=n+r;return!(vz(ur)>s*s)&&(hn[0]=-i[6],hn[1]=-i[7],hn[2]=-i[8],hn[3]=i[9],pu(ur,ur,hn),DP(ur,ur),$y[0]=Math.min(ur[0],i[3]),$y[1]=Math.min(ur[1],i[4]),$y[2]=Math.min(ur[2],i[5]),GL($y,ur)<n*n)}intersectPlane(e){const r=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],i=this.projectedRadius(e);return r>i?1:r<-i?-1:0}intersectRay(e,r,i=0){const n=this._data,s=hn;s[0]=-n[6],s[1]=-n[7],s[2]=-n[8],s[3]=n[9],ur[0]=e[0]-n[0],ur[1]=e[1]-n[1],ur[2]=e[2]-n[2];const o=pu(ur,ur,hn),a=pu($y,r,hn);let l=-1/0,c=1/0;const u=this.getHalfSize(X3);for(let h=0;h<3;h++){const p=o[h],f=a[h],g=u[h]+i;if(Math.abs(f)>1e-6){const y=(g-p)/f,v=(-g-p)/f;l=Math.max(l,Math.min(y,v)),c=Math.min(c,Math.max(y,v))}else if(p>g||p<-g)return!1}return l<=c}projectedArea(e,r,i,n){const s=this.getQuaternion(O0);lb(hn,s),ur[0]=e[0]-this._data[0],ur[1]=e[1]-this._data[1],ur[2]=e[2]-this._data[2],pu(ur,ur,hn);const o=this.getHalfSize(X3),a=ur[0]<-o[0]?-1:ur[0]>o[0]?1:0,l=ur[1]<-o[1]?-1:ur[1]>o[1]?1:0,c=ur[2]<-o[2]?-1:ur[2]>o[2]?1:0,u=Math.abs(a)+Math.abs(l)+Math.abs(c);if(u===0)return 1/0;const h=u===1?4:6,p=6*(a+3*l+9*c+13);ZL(nC,s),qB(nC,nC,o);const f=this.getCenter(Df);for(let v=0;v<h;v++){const b=Zat[p+v];se(ur,((1&b)<<1)-1,(2&b)-1,((4&b)>>1)-1),po(ur,ur,nC),ge(Iw,f,ur),Iw[3]=1,Mu(Iw,Iw,r);const w=1/Math.max(1e-6,Iw[3]);Rp[2*v]=Iw[0]*w,Rp[2*v+1]=Iw[1]*w}const g=2*h-2;let y=Rp[0]*(Rp[3]-Rp[g+1])+Rp[g]*(Rp[1]-Rp[g-1]);for(let v=2;v<g;v+=2)y+=Rp[v]*(Rp[v+3]-Rp[v-1]);return Math.abs(y)*i*n*.125}projectedRadius(e){const r=this.getQuaternion(O0);return lb(hn,r),pu(ur,e,hn),Math.abs(ur[0]*this._data[3])+Math.abs(ur[1]*this._data[4])+Math.abs(ur[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(e)}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(e)}toAaBoundingBox(e){const r=this.getQuaternion(O0),i=ZL(nC,r),n=this._data[3]*Math.abs(i[0])+this._data[4]*Math.abs(i[3])+this._data[5]*Math.abs(i[6]),s=this._data[3]*Math.abs(i[1])+this._data[4]*Math.abs(i[4])+this._data[5]*Math.abs(i[7]),o=this._data[3]*Math.abs(i[2])+this._data[4]*Math.abs(i[5])+this._data[5]*Math.abs(i[8]);e[0]=this._data[0]-n,e[1]=this._data[1]-s,e[2]=this._data[2]-o,e[3]=this._data[0]+n,e[4]=this._data[1]+s,e[5]=this._data[2]+o}transform(e,r,i,n=0,s=Kl(i),o=Kl(r),a=Pb(r,o)){if(i===s)r.isGeographic?elt(this,e,r,n,o):Kat(this,e,r,n,o,a);else if(r.isWGS84&&(i.isWebMercator||zL(i)))Jat(r,this,i,e,n);else if(r.isWebMercator&&zL(i))Qat(r,this,i,e,n);else{const l=this.getCenter(Df);l[2]+=n,an(l,r,0,l,i,0,1),e.center=l,this!==e&&(e.quaternion=this.getQuaternion(O0),e.halfSize=this.getHalfSize(X3))}}};const hn=Gc(),O0=Gc(),Xat=Gc(),ur=C(),$y=C(),Iw=tr();function g$e(t,e=new Aoe){return Nat(t,e),e}const Rp=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],Zat=(()=>{const t=new Int8Array(162);let e=0;const r=i=>{for(let n=0;n<i.length;n++)t[e+n]=i[n];e+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),t})();function y$e(t,e,r,i,n){const s=t.getQuaternion(O0);n.quaternion=s,lb(hn,s);const o=t.getCenter(Df),a=t.getHalfSize(X3);if(i===Fe.Global){pu(Ui,o,hn),DP(bf,Ui),j3e(eh,bf,a),rn(eh,bf,eh);const l=Te(eh);ge(eh,bf,a);const c=Te(eh);if(l<r)n.center=o,se(Ui,r,r,r),n.halfSize=ge(Ui,a,Ui);else{const u=c>0?1+e/c:1,h=l>0?1+r/l:1,p=(h+u)/2,f=(h-u)/2;oe(eh,bf,f),n.halfSize=ho(eh,eh,a,p),oe(eh,bf,p),ho(eh,eh,a,f),G3e(Ui,Ui),bB(Ui,eh,Ui);const g=t.getQuaternion(Xat);n.center=pu(Ui,Ui,g)}}else{n.center=ho(Ui,o,LP,(r+e)/2);const l=pu(Ui,LP,hn);DP(l,l),n.halfSize=ho(bf,a,l,(r-e)/2)}return n}function Jat(t,e,r,i,n){e.getCenter(Df),Df[2]+=n;const s=Kl(r);an(Df,t,0,Df,s,0,1),_$e(s,e,Df,r,i)}function Qat(t,e,r,i,n){e.getCenter(Df),Df[2]+=n,_$e(t,e,Df,r,i)}function _$e(t,e,r,i,n){const s=e.getQuaternion(O0),o=ZL(nC,s),a=e.getHalfSize(X3);for(let l=0;l<8;++l){for(let c=0;c<3;++c)Og[c]=a[c]*(l&1<<c?-1:1);for(let c=0;c<3;++c){let u=r[c];for(let h=0;h<3;++h)u+=Og[h]*o[3*h+c];C6[3*l+c]=u}}an(C6,t,0,C6,i,0,8),g$e(tlt,n)}function Kat(t,e,r,i,n=Kl(r),s=Pb(r,n)){t.getCorners(mme),t.getCenter(Og),Og[2]+=i,Ua(r,Og,Ku,n),e.setCenter(Ku[12],Ku[13],Ku[14]);const o=2*Math.sqrt(1+Ku[0]+Ku[5]+Ku[10]);hn[0]=(Ku[6]-Ku[9])/o,hn[1]=(Ku[8]-Ku[2])/o,hn[2]=(Ku[1]-Ku[4])/o,hn[3]=.25*o;const a=t.getQuaternion(O0);e.quaternion=kB(hn,hn,a),lb(hn,hn),se(bf,0,0,0);const l=e.getCenter(rlt);for(const c of mme)c[2]+=i,s(c,0,c,0),rn(Ui,c,l),pu(Ui,Ui,hn),DP(Ui,Ui),H3e(bf,bf,Ui);e.halfSize=bf}function elt(t,e,r,i,n=Kl(r)){const s=zr(r),o=1+Math.max(0,i)/(s.radius+t.centerZ);t.getCenter(Og),Og[2]+=i,an(Og,r,0,Og,n,0,1),e.center=Og;const a=t.getQuaternion(O0);e.quaternion=a,lb(hn,a),se(Ui,0,0,1),pu(Ui,Ui,hn);const l=t.getHalfSize(X3);se(Ui,l[0]*Math.abs(Ui[0]),l[1]*Math.abs(Ui[1]),l[2]*Math.abs(Ui[2])),oe(Ui,Ui,s.inverseFlattening),ge(Ui,l,Ui),e.halfSize=oe(Ui,Ui,o)}const C6=new Array(24),tlt=new jA(C6,3),Og=C(),Df=C(),rlt=C(),X3=C(),nC=gi(),Ku=xe(),mme=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Ui=C(),bf=C(),eh=C(),ilt=Ce(-1,-1,-1);let nlt=class{constructor(){this._transform=xe(),this._transformInverse=new S5({value:this._transform},us,xe),this._transformInverseTranspose=new S5(this._transformInverse,Bu,xe),this._transformTranspose=new S5({value:this._transform},Bu,xe),this._transformInverseRotation=new S5({value:this._transform},kAe,gi)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){cs(this._transform,e)}multiplyTransform(e){Kr(this._transform,this._transform,e)}set(e){cs(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,r){this.setTransformMatrix(e),this.multiplyTransform(r),this._invalidateLazyTransforms()}},S5=class{constructor(e,r,i){this._original=e,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},slt=class{constructor(e=0){this.offset=e,this.tmpVertex=C()}applyToVertex(e,r,i){const n=se(Ooe,e,r,i),s=ge(v$e,n,this.localOrigin),o=this.offset/Te(s);return ho(this.tmpVertex,n,s,o),this.tmpVertex}applyToAabb(e){const r=clt,i=ult,n=hlt;for(let l=0;l<3;++l)r[l]=e[0+l]+this.localOrigin[l],i[l]=e[3+l]+this.localOrigin[l],n[l]=r[l];const s=this.applyToVertex(r[0],r[1],r[2]);for(let l=0;l<3;++l)e[l]=s[l],e[l+3]=s[l];const o=l=>{const c=this.applyToVertex(l[0],l[1],l[2]);for(let u=0;u<3;++u)e[u]=Math.min(e[u],c[u]),e[u+3]=Math.max(e[u+3],c[u])};for(let l=1;l<8;++l){for(let c=0;c<3;++c)n[c]=l&1<<c?i[c]:r[c];o(n)}let a=0;for(let l=0;l<3;++l)r[l]*i[l]<0&&(a|=1<<l);if(a!==0&&a!==7){for(let l=0;l<8;++l)if(!(a&l)){for(let c=0;c<3;++c)n[c]=a&1<<c?0:l&1<<c?r[c]:i[c];o(n)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},olt=class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=C(),this._tmpMbs=hs(),this._tmpObb=new Aoe,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Te(e)}applyToVertex(e,r,i){const n=se(Ooe,e,r,i),s=se(v$e,e,r,i+this.componentLocalOriginLength),o=this._totalOffset/Te(s);return ho(this._tmpVertex,n,s,o),this._tmpVertex}applyToAabb(e){const r=this.componentLocalOriginLength,i=e[0],n=e[1],s=e[2]+r,o=e[3],a=e[4],l=e[5]+r,c=Math.abs(i),u=Math.abs(n),h=Math.abs(s),p=Math.abs(o),f=Math.abs(a),g=Math.abs(l),y=.5*(1+Math.sign(i*o))*Math.min(c,p),v=.5*(1+Math.sign(n*a))*Math.min(u,f),b=.5*(1+Math.sign(s*l))*Math.min(h,g),w=Math.max(c,p),x=Math.max(u,f),S=Math.max(h,g),E=Math.sqrt(y*y+v*v+b*b),P=Math.sign(c+i),M=Math.sign(u+n),L=Math.sign(h+s),U=Math.sign(p+o),z=Math.sign(f+a),W=Math.sign(g+l),V=this._totalOffset;if(E<V)return e[0]-=(1-P)*V,e[1]-=(1-M)*V,e[2]-=(1-L)*V,e[3]+=U*V,e[4]+=z*V,e[5]+=W*V,e;const J=V/Math.sqrt(w*w+x*x+S*S),Y=V/E,X=Y-J,le=-X;return e[0]+=i*(P*le+Y),e[1]+=n*(M*le+Y),e[2]+=s*(L*le+Y),e[3]+=o*(U*X+J),e[4]+=a*(z*X+J),e[5]+=l*(W*X+J),e}applyToMbs(e){const r=Te(e),i=this._totalOffset/r;return ho(this._tmpMbs,e,e,i),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/r,this._tmpMbs}applyToObb(e){return y$e(e,this._totalOffset,this._totalOffset,Fe.Global,this._tmpObb),this._tmpObb}},alt=class{constructor(e=0){this.offset=e,this.sphere=hs(),this.tmpVertex=C()}applyToVertex(e,r,i){const n=this.objectTransform.transform,s=se(Ooe,e,r,i),o=ze(s,s,n),a=this.offset/Te(o);ho(o,o,o,a);const l=this.objectTransform.inverse;return ze(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,r){const i=this.offset/Te(e);ho(e,e,e,i);const n=this.offset/Te(r);ho(r,r,r,n)}applyToAabb(e){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const r=Te(e),i=this.offset/r;return ho(this.sphere,e,e,i),this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}};const gme=new alt;function pQ(t){return t!=null?(gme.offset=t,gme):null}const yme=new olt;function _me(t){return t!=null?(yme.offset=t,yme):null}const vme=new slt;function llt(t){return t!=null?(vme.offset=t,vme):null}const kb="terrain",Ooe=C(),v$e=C(),clt=C(),ult=C(),hlt=C(),nA=1e-5;let dlt=class{constructor(e){this.options=new Iat,this._results=new plt,this.transform=new nlt,this.tolerance=nA,this.verticalOffset=null,this._ray=fo(),this._rayEnd=C(),this._rayBeginTransformed=C(),this._rayEndTransformed=C(),this.viewingMode=e??Fe.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,r,i){this.resetWithRay(_Re(e,r,this._ray),i)}resetWithRay(e,r){this.camera=r,e!==this._ray&&Wz(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Fe.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,ge(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,r,i,n,s){var a;this.point=r,this.filterPredicate=n,this.tolerance=i??nA;const o=pQ(this.verticalOffset);if(e&&e.length>0){const l=s?c=>{s(c)&&this.intersectObject(c)}:c=>{this.intersectObject(c)};for(const c of e){const u=(a=c.getSpatialQueryAccelerator)==null?void 0:a.call(c);u!=null?(o!=null?u.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,l,o):u.forEachAlongRay(this._ray.origin,this._ray.direction,l),this.options.selectionMode&&this.options.hud&&u.forEachDegenerateObject(l)):c.objects.forAll(h=>l(h))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.effectiveTransformation,n=pQ(this.verticalOffset);for(const s of r){if(!s.visible)continue;const{material:o,id:a}=s;this.transform.setAndInvalidateLazyTransforms(i,s.transformation),ze(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),ze(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;n!=null&&(n.objectTransform=this.transform),o.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,h,p,f,g)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const y=p?this._results.hud:this._results,v=p?b=>{const w=new Dat(e,a,h,g);b.set(Yi.HUD,w,c,u,fn,f)}:b=>b.set(Yi.OBJECT,{object:e,geometryId:a,triangleNr:h},c,u,l,f);if((y.min.drapedLayerOrder==null||f>=y.min.drapedLayerOrder)&&(y.min.dist==null||c<y.min.dist)&&v(y.min),this.options.store!==ha.MIN&&(y.max.drapedLayerOrder==null||f<y.max.drapedLayerOrder)&&(y.max.dist==null||c>y.max.dist)&&v(y.max),this.options.store===ha.ALL)if(p){const b=new fQ(this._ray);v(b),this._results.hud.all.push(b)}else{const b=new Z3(this._ray);v(b),this._results.all.push(b)}}})}}sortResults(e=this._results.all){e.sort((r,i)=>r.dist!==i.dist?(r.dist??0)-(i.dist??0):r.drapedLayerOrder!==i.drapedLayerOrder?bme(r.drapedLayerOrder,i.drapedLayerOrder):bme(r.drapedLayerGraphicOrder,i.drapedLayerGraphicOrder))}};function bme(t,e){return(e??-Number.MAX_VALUE)-(t??-Number.MAX_VALUE)}function pp(t){return new dlt(t)}let plt=class{constructor(){this.min=new Z3(fo()),this.max=new Z3(fo()),this.hud={min:new fQ(fo()),max:new fQ(fo()),all:new Array},this.ground=new Z3(fo()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},Z3=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(oe(T5,this.ray.direction,this.dist),Te(T5)):null}getIntersectionPoint(e){return!!_p(this)&&(oe(T5,this.ray.direction,this.dist),ge(e,this.ray.origin,T5),!0)}getTransformedNormal(e){return he(eM,this.normal),eM[3]=0,Mu(eM,eM,this.transformation),he(e,eM),me(e,e)}constructor(e){this.intersector=Yi.OBJECT,this.normal=C(),this.transformation=xe(),this._ray=fo(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Yi.OBJECT,Wz(e,this._ray)}set(e,r,i,n,s,o,a){this.intersector=e,this.dist=i,he(this.normal,n??LP),cs(this.transformation,s??fn),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){Wz(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,he(this.normal,e.normal),cs(this.transformation,e.transformation)}},fQ=class extends Z3{constructor(){super(...arguments),this.intersector=Yi.HUD}};function Moe(t){return new Z3(t)}const T5=C(),eM=tr();function b$e(t,e,r,i){return t.renderCoordsHelper.fromRenderCoords(e.eye,Qz,i)!=null&&CPe(r,Qz)}function O7(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function P2(t,e,r,i){const n=t.state.camera.clone();e&&r&&i&&(n.eye=e,n.center=r,n.up=i),flt(t,n.ray,i1)||he(i1,n.center);const s=t.state.constraints,o=s.minimumPoiDistance;if(ca(n.eye,i1)<o){const a=s.collision.enabled;he(Lw,n.viewForward),oe(Lw,Lw,o),a?n.eye=_e(Qz,i1,Lw):ge(i1,n.eye,Lw);const l=t.renderCoordsHelper,c=l.getAltitude(n.eye),u=s.collision.elevationMargin;a&&c<u&&(_e(Lw,i1,n.eye),n.eye=l.setAltitude(Qz,u,n.eye),ge(i1,n.eye,Lw))}return n.center=i1,n}function wme(t,e,r){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const i=O7(t,e),n=t.stateManager.constraintsManager.nearFarHeuristic,{far:s}=n.compute(e,r,t.renderDataExtent,i,glt),o=s*s;return ca(e,r)>o}function flt(t,e,r){let i=xme[t.viewingMode];i||(i=pp(t.state.viewingMode),i.options.backfacesTerrain=!t.state.isGlobal,i.options.invisibleTerrain=!0,xme[t.viewingMode]=i);const{isGlobal:n}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,i,r)||wme(t,e.origin,r))||!(!t.renderCoordsHelper.intersectManifold(e,0,r)||wme(t,e.origin,r))||!!n&&mlt(e,r,zr(t.spatialReference).radius)}function mlt(t,e,r){const i=fe(t.origin,t.origin)-r*r,n=i>0?Math.sqrt(i)/3:1;return oe(e,t.direction,n/Te(t.direction)),ge(e,e,t.origin),!0}const xme={},Qz=C(),i1=C(),Lw=C(),glt={near:0,far:0},ylt=C(),E5=C();function Roe(){return{direction:C(),up:C()}}function w$e(t,e,r,i,n){let s=me(ylt,t),o=fe(s,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(fe(e,i)),o<.99?(he(s,e),a&&oe(s,s,-1)):s=null);let l=0;if(s){oe(E5,i,fe(i,s)),_e(s,s,E5);const u=fe(s,n)/(Te(s)*Te(n));it(E5,s,n),l=(fe(E5,i)>0?1:-1)*ul(_o(u))}const c=ul(_o(-fe(i,t)/Te(t)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const x$e=Ce(0,1,0),S$e=Ce(0,0,1),tM=xe(),Iy=C(),Ly=C();function T$e(t,e,r,i=Roe()){const{direction:n,up:s}=i;return K3e(tM,-Ut(e)),kP(tM,tM,Ut(r)),ze(n,S$e,tM),oe(n,n,-1),ze(s,x$e,tM),i}function _lt(t,e,r,i){return w$e(e,r,i,S$e,x$e)}function vlt(t,e,r,i){const n=T$e(t,r,i),s=C();return oe(s,n.direction,-e),ge(s,s,t),{up:n.up,eye:s,heading:r,tilt:i}}function blt(t){return ul(t)}function wlt(t){return Ut(t)}function E$e(t,e,r,i,n){const s=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return Cn(e,Iy,s),Cn(e,Ly,s),Iy[0]-=r/2,Ly[0]+=r/2,Iy[1]-=i/2,Ly[1]+=i/2,ga(Iy,s,Iy,o),ga(Ly,s,Ly,o),n?(n.xmin=Iy[0],n.ymin=Iy[1],n.xmax=Ly[0],n.ymax=Ly[1],n.spatialReference=o):n=new br(Iy[0],Iy[1],Ly[0],Ly[1],o),n}const xlt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:_lt,eyeForCenterWithHeadingTilt:vlt,eyeTiltToLookAtTilt:wlt,headingTiltToDirectionUp:T$e,lookAtTiltToEyeTilt:blt,toExtent:E$e},Symbol.toStringTag,{value:"Module"}));function Sme(t,e,r){if(e.longitude==null||e.latitude==null||r.longitude==null||r.latitude==null)throw new Error("Invalid points: no lon/lat");return Slt(t,e.longitude,e.latitude,r.longitude,r.latitude)}function Slt(t,e,r,i,n){const s=Ut(r),o=Ut(n),a=s-o,l=Ut(e)-Ut(i),c=Math.sin(a/2),u=Math.sin(l/2),h=2*ap(Math.sqrt(c*c+Math.cos(s)*Math.cos(o)*u*u))*t;return Math.round(1e4*h)/1e4}function Tlt(t,e,r){const i=e.spatialReference,n=zr(i),s=new He(e.x,t.y,i),o=new He(r.x,t.y,i),a=new He(t.x,e.y,i),l=new He(t.x,r.y,i);return{lon:Sme(n.radius,s,o),lat:Sme(n.radius,a,l)}}function Elt(t,e,r){const i=e/r,n=Ut(t),s=Math.sin(i/2),o=Math.cos(n),a=2*ap(Math.sqrt(s*s/(o*o)));return ul(a)}function Clt(t,e){let r=t/15;return e||(r=Math.round(r)),r}function Tme(t,e){const r=t==null?void 0:t[0];if(r==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=Clt(r,!0);const i=e.hours%1;e.hours-=i,e.minutes=60*i;const n=e.minutes%1;return e.minutes-=n,e.seconds=Math.round(60*n),e}const C$e=Ce(0,0,1),P$e=me(C(),Ce(1,1,1)),Plt=new Lb(-180,180),rM=xe(),gv=C(),Q2=C();function A$e(t,e,r,i=Roe()){it(gv,t,C$e),fe(gv,gv)===0&&it(gv,t,P$e),Gu(rM,-Ut(e),t),Ou(rM,rM,-Ut(r),gv);const{up:n,direction:s}=i;return it(n,gv,t),me(n,n),ze(n,n,rM),me(s,t),ua(s,s),ze(s,s,rM),i}function Alt(t,e,r,i){const n=gv,s=Q2;return me(n,t),it(Q2,n,C$e),fe(Q2,Q2)===0&&it(Q2,n,P$e),it(s,Q2,n),w$e(e,r,i,n,s)}function Olt(t,e,r,i){const n={eye:C(),up:null,tilt:i,heading:r},s=gv;s[0]=t[0],s[1]=t[2],s[2]=-t[1];const o=e,a=Ut(r),l=Ut(i),c=Math.sin(a),u=Math.cos(a),h=Math.sin(l),p=Math.cos(l),f=Te(s);let g;if(Math.abs(l)<1e-8)g=o+f;else{const le=f/h,D=ap(o/le),I=Math.PI-l-D;g=le*Math.sin(I)}const y=p*o,v=o*o*(h*h),b=u*u*v,w=g-y,x=w*w,S=b*(b+x-s[1]*s[1]);if(S<0)return oe(n.eye,s,g/f),n.tilt=0,C5(n,t);const E=Math.sqrt(S),P=s[1]*w,M=b+x;let L;if(L=u>0?-E+P:E+P,Math.abs(M)<1e-8)return f<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=o):oe(n.eye,s,g/f),n.tilt=0,hH(n.eye),C5(n,t);n.eye[1]=L/M;const U=c*c*v,z=h*o,W=u*z*n.eye[1],V=n.eye[1]*n.eye[1],J=1-V,Y=Math.sqrt(J),X=b*V+U-2*W*Y*w+J*x;return Math.abs(X)<1e-8?(oe(n.eye,s,g/f),n.tilt=0,hH(n.eye),C5(n,t)):(n.eye[0]=(J*(g*s[0]-y*s[0])-z*Y*(s[0]*n.eye[1]*u+s[2]*c))/X,n.eye[2]=(J*(g*s[2]-y*s[2])-z*Y*(s[2]*n.eye[1]*u-s[0]*c))/X,oe(n.eye,n.eye,g),hH(n.eye),C5(n,t))}function hH(t){const e=t[1];t[1]=-t[2],t[2]=e}function C5(t,e){const r=A$e(e,t.heading,t.tilt);return t.up=r.up,t}function Mlt(t,e,r){const i=Te(e),n=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-t)),s=ap(r/(n/Math.sin(t)));return ul(t-s)}function Rlt(t,e,r){const i=Ut(t),n=Te(e);return ap(r/(n/Math.sin(i)))+i}function O$e(t,e,r,i,n){let s,o,a,l;const c=e.latitude,u=zr(t.spatialReference).radius,h=e.longitude,p=Elt(c,r,u)/2;s=h-p,o=h+p;const f=Ut(c),g=(1+Math.sin(f))/(1-Math.sin(f)),y=(g+1)*Math.tan(i/u/2),v=y*y;function b(x){const S=Math.PI/2;return(x=Prt.normalize(x,-S))>S&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(y+Math.sqrt(4*g+v))),l=a+i/u,a=b(a),l=b(l),l<a){const x=l;l=a,a=x}if(a=Math.max(ul(a),-90),l=Math.min(ul(l),90),o=Plt.monotonic(s,o),o-s>180){const x=(o-s-180)/2;s+=x,o-=x}const w=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:Ve.WGS84;return n?(n.xmin=s,n.ymin=a,n.xmax=o,n.ymax=l,n.spatialReference=w):n=new br(s,a,o,l,w),t.spatialReference&&t.spatialReference.isWebMercator&&ib(n,!1,n),n}const $lt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Alt,eyeForCenterWithHeadingTilt:Olt,eyeTiltToLookAtTilt:Rlt,headingTiltToDirectionUp:A$e,lookAtTiltToEyeTilt:Mlt,toExtent:O$e},Symbol.toStringTag,{value:"Module"}));function Kz(t){return t.type==="point"}let $oe=class{constructor(e,r=null,i=0){this.array=e,this.spatialReference=r,this.offset=i}};function M$e(t){return"array"in t}function kg(t,e,r="ground"){if(Kz(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,r);if(M$e(e)){let i=e.offset;return t.getElevation(e.array[i++],e.array[i++],e.array[i]||0,e.spatialReference??t.spatialReference,r)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,r)}function mQ(t,e){return t!=null&&(e==null||(e===Fe.Local?!t.isGeographic||t.isWGS84||t.wkid===Vd.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===Vd.CGCS2000||t.wkid===Vd.GCSMARS2000||t.wkid===Vd.GCSMARS2000_SPHERE||t.wkid===Vd.GCSMOON2000))}const R$e=()=>K.getLogger("esri.views.3d.support.cameraUtils"),$$e=39.37,I$e=96,gQ=1,Ilt=8,Llt=5,L$e=1,Eme=C(),Dlt={heading:0,tilt:0},CI=C(),Nlt=new Lb(-20037508342788905e-9,20037508342788905e-9),Flt=new Lb(-180,180);var Fa;function O_(t){return t.spatialReference??Ve.WGS84}function KA(t){return t.viewingMode==="global"?$lt:xlt}function klt(t,e,r,i,n){return KA(t).headingTiltToDirectionUp(e,r,i,n)}function _0(t,e){if(e==null)return null;const r=t.renderSpatialReference,i=KA(t).headingTiltToDirectionUp,n=C();if(!Cn(e.position,n,r))return null;const s=i(n,e.heading,e.tilt);oe(s.direction,s.direction,t.state.camera.distance),ge(s.direction,s.direction,n);const o=P2(t,n,s.direction,s.up);return o.fov=Ut(e.fov),o.row=e.layout.row,o.rows=e.layout.rows,o.column=e.layout.column,o.columns=e.layout.columns,o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(Fa||(Fa={}));const K2=C();function sA(t,e,r){const i=t.renderSpatialReference,n=R7(t,e.eye,e.viewForward,e.up,Dlt);let s=O_(t);return ga(e.eye,i,K2,s)||(s=Ve.WGS84,ga(e.eye,i,K2,s)),r==null?r=new Hh(new He(K2,s),n.heading,n.tilt,ul(e.fov)):(r.position.x=K2[0],r.position.y=K2[1],r.position.z=K2[2],r.position.spatialReference=s,r.heading=n.heading,r.tilt=n.tilt,r.fov=ul(e.fov)),r.layout.row=e.row,r.layout.rows=e.rows,r.layout.column=e.column,r.layout.columns=e.columns,r}function M7(t,e,r){const i=t.state.camera,n=i.width/2/i.pixelRatio;return t.renderCoordsHelper.viewingMode===Fe.Global&&r!=null&&(e*=Math.cos(Ut(r))),e/=t.renderCoordsHelper.unitInMeters,n/(I$e*$$e/e)/Math.tan(i.fovX/2)}function e2(t,e,r){const i=t.state.camera,n=e*Math.tan(i.fovX/2),s=i.width/2/i.pixelRatio;let o=I$e*$$e/(s/n);return t.renderCoordsHelper.viewingMode===Fe.Global&&r!=null&&(o/=Math.cos(Ut(r))),o*t.renderCoordsHelper.unitInMeters}async function D$e(t,e,r,i,n,s){return N$e(t,e,M7(t,r,e.latitude),i,n,s)}function Ult(t,e,r,i,n,s){return Z$e(t,Ioe(t,i.heading,i.tilt,e,r,n),i.fov,s)}async function N$e(t,e,r,i,n,s){const o=await k$e(t,i.heading,i.tilt,e,r,n,s);return dt(s),J$e(t,o,i.fov,s)}function R7(t,e,r,i,n){return KA(t).directionToHeadingTilt(e,r,i,n)}function F$e(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,CI,t.spatialReference)&&t.elevationProvider&&(kg(t.elevationProvider,CI)??0)>CI[2]-L$e)}async function zlt(t,e,r){if(F$e(t,e))return!0;const{elevationProvider:i,spatialReference:n,renderCoordsHelper:s}=t;if(i==null||!s.fromRenderCoords(e,CI,n))return!1;const[o,a,l]=CI,c=await i.queryElevation(o,a,l,n,"ground",r)??0;return dt(r),c>l-L$e}async function Vlt(t,e,r){const i=C();if(e==null)return he(i,t.state.camera.center);if(e instanceof He){const{renderSpatialReference:n,basemapTerrain:s,elevationProvider:o}=t,a=e.spatialReference;if(await Dz(e,i,n,0,{signal:r}),dt(r),e.z==null&&s!=null&&o!=null){const l=await o.queryElevation(e.x,e.y,e.z??0,a,"ground",r);dt(r),l!=null&&t.renderCoordsHelper.setAltitude(i,l)}return i}return he(i,e)}function Blt(t,e){const r=C();if(e==null)return he(r,t.state.camera.center);if(e instanceof He){if(!Cn(e,r,t.renderSpatialReference))return null;const{basemapTerrain:i,elevationProvider:n}=t;if(e.z==null&&i!=null&&n!=null){const s=kg(n,e);s!=null&&t.renderCoordsHelper.setAltitude(r,s)}return r}return he(r,e)}function Ioe(t,e,r,i,n,s){return U$e(t,e,r,i instanceof He?i:null,Blt(t,i),n,s)}async function k$e(t,e,r,i,n,s,o){const a=i instanceof He?i:null,l=await Vlt(t,i,o);return dt(o),z$e(t,e,r,a,l,n,s,o)}function U$e(t,e,r,i,n,s,o){if(n==null||!i&&(i=new He({spatialReference:O_(t)}),!uy(n,t.renderSpatialReference,i)))return null;const a=V$e(t,e,r,n,s,o);if(B$e(t,r,o)&&F$e(t,a.eye)){const{tilt:l,mode:c}=G$e(t,r,n,s);return U$e(t,e,l,i,n,s,c)}return j$e(a,n)}async function z$e(t,e,r,i,n,s,o,a){i||(i=new He({spatialReference:O_(t)}),await u$e(n,t.renderSpatialReference,i,{signal:a})||(i=null)),dt(a);const l=V$e(t,e,r,n,s,o);if(B$e(t,r,o)&&await zlt(t,l.eye,a)){dt(a);const{tilt:c,mode:u}=G$e(t,r,n,s);return z$e(t,e,c,i,n,s,u,a)}return j$e(l,n)}function V$e(t,e,r,i,n,s){const o=jlt(t,e,r,i,n=Math.max(n,t.state.constraints.minimumPoiDistance),s);return(0,KA(t).eyeForCenterWithHeadingTilt)(i,n,o.heading,o.tilt)}function B$e(t,e,r){const i=t.map.ground.navigationConstraint;return r===Fa.ADJUST&&t.viewingMode==="global"&&e>0&&(i==null||i.type==="stay-above")}function G$e(t,e,r,i){const n=X$e(t,r,i,qlt(t,i,e,r));return{tilt:n,mode:e-n<1?Fa.LOCKED:Fa.ADJUST}}function j$e(t,e){return{...t,center:nn(e)}}function H$e(t,e){const{state:r,spatialReference:i}=t,n=e.spatialReference;return r.isGlobal&&mQ(n,Fe.Global)||r.isLocal&&i.equals(n)}function q$e(t,e){let r,i,n;if(t.state.isGlobal){const u=new He(e.xmin,e.ymin,e.spatialReference),h=new He(e.xmax,e.ymax,e.spatialReference),p=e.spatialReference.isGeographic?Flt:Nlt;r=new He({x:p.center(u.x,h.x),y:(h.y+u.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const f=zr(e.spatialReference),g=Tlt(r,u,h);i=g.lon,n=g.lat,p.diff(u.x,h.x)>p.range/2&&(i+=f.halfCircumference),i=Math.min(i,f.halfCircumference),n=Math.min(n,f.halfCircumference)}else{const u=t.renderSpatialReference??e.spatialReference;u.equals(e.spatialReference)||(e=lw(e,u)),i=e.xmax-e.xmin,n=e.ymax-e.ymin;const h=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;r=new He({x:e.xmin+.5*i,y:e.ymin+.5*n,z:h,spatialReference:u})}const s=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,o=t.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:r,distance:Math.max(.5*i*a,.5*n*l,.5*s*c)/gQ}}async function W$e(t,e,r,i,n,s){const o=H$e(t,e)?e:await Mb(e,t.spatialReference,{signal:s});dt(s);const{center:a,distance:l}=q$e(t,o),c=await k$e(t,r,i,a,l,n,s);return dt(s),J$e(t,c,t.camera.fov,s)}function P6(t,e,r,i,n,s){let o;try{o=H$e(t,e)?e:lw(e,t.spatialReference)}catch{return null}const{center:a,distance:l}=q$e(t,o),c=Ioe(t,r,i,a,l,n);return c==null?null:Z$e(t,c,t.camera.fov,s)}function Y$e(t,e,r){const i=t.renderSpatialReference,n=new He({spatialReference:O_(t)});if(!uy(r,i,n))return null;const s=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=B0(e.eye,r),l=2*a*s*gQ,c=2*a*o*gQ;return t.viewingMode==="global"?O$e(t,n,l,c):E$e(t,n,l,c)}function Glt(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>Ilt)return!0;const n=t.renderSpatialReference,s=O_(t),o=new He({spatialReference:s});if(!uy(e,n,o))return!1;const a=new He({spatialReference:s});if(!uy(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n,a))return!1;const l=Math.tan(.5*t.state.camera.fov)*i;return a.distance(o)/l>Llt}function jlt(t,e,r,i,n,s){let o=0;return s===Fa.ADJUST&&Glt(t,i,n)?(e=0,o=Hlt(t,n,r,i)):o=Loe(t,i,n,r),o=t.state.constraints.clampTilt(n,o),{heading:e,tilt:r=X$e(t,i,n,o)}}const e9=.7;function Hlt(t,e,r,i){const n=Loe(t,i,e,r);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);s.max=Math.min(s.max,.5*Math.PI);const o=s.min*(1-e9)+s.max*e9;return Math.min(n,o)}function qlt(t,e,r,i){let n=Loe(t,i,e,r);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);return n=Math.min(n,.5*Math.PI),s.min*(1-e9)+n*e9}function X$e(t,e,r,i){return KA(t).lookAtTiltToEyeTilt(i,e,r)}function Loe(t,e,r,i){return KA(t).eyeTiltToLookAtTilt(i,e,r)}function Z$e(t,e,r,i){if(e==null)return null;const n=t.renderSpatialReference,s=new He({spatialReference:O_(t)});return uy(e.eye,n,s)?(i??(i=new Hh),i.position=s,i.heading=e.heading,i.tilt=e.tilt,i.fov=r,i):null}async function J$e(t,e,r,i){const n=t.renderSpatialReference,s=new He({spatialReference:O_(t)});return await u$e(e.eye,n,s,{signal:i}),dt(i),new Hh(s,e.heading,e.tilt,r)}function Wlt(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(e);R$e().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function Q$e(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(e);R$e().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function K$e(t,e){return ga(e.center,t.renderSpatialReference,Eme,Ve.WGS84),e2(t,e.distance,Eme[1])}const Doe=()=>K.getLogger("esri.layers.support.ElevationSampler");let eIe=class{queryElevation(e){return tIe(e.clone(),this)}on(){return ri()}projectIfRequired(e,r){return rIe(e,r)}},Ylt=class extends eIe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){super(),this.tile=e,this.noDataValue=i;const n=e.tile.extent;this.extent=MB(n,r.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=n;const s=fl(r.spatialReference),o=r.lodAt(e.tile.level).resolution*s;this.demResolution={min:o,max:o}}contains(e){const r=this.projectIfRequired(e,this.spatialReference);return r!=null&&this.containsAt(r.x,r.y)}containsAt(e,r){return RB(this._aaExtent,e,r)}elevationAt(e,r){if(!this.containsAt(e,r)){const i=this.extent,n=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return Doe().warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${n})`),this.noDataValue}return this.tile.sample(e,r)??this.noDataValue}},ZYt=class extends eIe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){let n;super(),typeof r=="number"?(this.noDataValue=r,n=null):(n=r,this.noDataValue=i),this.samplers=n?e.map(o=>new Ylt(o,n,this.noDataValue)):e;const s=this.samplers[0];if(s){this.extent=s.extent.clone();const{min:o,max:a}=s.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=MB(Ht(),n.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,r){let i,n=!1;for(const s of this.samplers)if(s.containsAt(e,r)&&(n=!0,i=s.elevationAt(e,r),i!==s.noDataValue))return i;return i??(n||Doe().warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler`),this.noDataValue)}};function tIe(t,e){const r=rIe(t,e.spatialReference);if(!r)return null;switch(t.type){case"point":Xlt(t,r,e);break;case"polyline":Zlt(t,r,e);break;case"multipoint":Jlt(t,r,e)}return t}function rIe(t,e){if(t==null)return null;const r=t.spatialReference;if(r.equals(e))return t;const i=sN(t,e);return i||Doe().error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),i}function Xlt(t,e,r){t.z=r.elevationAt(e.x,e.y)}function Zlt(t,e,r){Mg.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n],o=e.paths[n];for(let a=0;a<s.length;a++){const l=s[a],c=o[a];Mg.x=c[0],Mg.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(Mg.x,Mg.y)}}t.hasZ=!0}function Jlt(t,e,r){Mg.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let n=0;n<t.points.length;n++){const s=t.points[n],o=e.points[n];Mg.x=o[0],Mg.y=o[1],i&&(s[3]=s[2]),s[2]=r.elevationAt(Mg.x,Mg.y)}t.hasZ=!0}const Mg=new He;var yQ;let rg=yQ=class extends Se{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new yQ({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],rg.prototype,"cols",void 0),d([m({type:Vi,json:{write:!0}})],rg.prototype,"level",void 0),d([m({type:String,json:{write:!0}})],rg.prototype,"levelValue",void 0),d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],rg.prototype,"origin",void 0),d([m({type:Number,json:{write:!0}})],rg.prototype,"resolution",void 0),d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],rg.prototype,"rows",void 0),d([m({type:Number,json:{write:!0}})],rg.prototype,"scale",void 0),rg=yQ=d([F("esri.layers.support.LOD")],rg);const Af=rg;let iIe=class{constructor(e,r,i,n,s=void 0){this.id=e,this.level=r,this.row=i,this.col=n,this.extent=s}};var D1;const Cme=new Ii({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Ha=D1=class extends Se{static create(t={}){const{resolutionFactor:e=1,scales:r,size:i=256,spatialReference:n=Ve.WebMercator,numLODs:s=24}=t;if(!Ng(n)){const h=[];if(r)for(let p=0;p<r.length;p++){const f=r[p];h.push(new Af({level:p,scale:f,resolution:f}))}else{let p=5e-4;for(let f=s-1;f>=0;f--)h.unshift(new Af({level:f,scale:p,resolution:p})),p*=2}return new D1({dpi:96,lods:h,origin:new He(0,0,n),size:[i,i],spatialReference:n})}const o=Qf(n),a=t.origin?new He({x:t.origin.x,y:t.origin.y,spatialReference:n}):new He(o?{x:o.origin[0],y:o.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),l=96,c=1/(fl(n)*39.37*l),u=[];if(r)for(let h=0;h<r.length;h++){const p=r[h],f=p*c;u.push(new Af({level:h,scale:p,resolution:f}))}else{let h=Nne(n)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const p=Math.ceil(s/e);u.push(new Af({level:0,scale:h,resolution:h*c}));for(let f=1;f<p;f++){const g=h/2**e,y=g*c;u.push(new Af({level:f,scale:g,resolution:y})),h=g}}return new D1({dpi:l,lods:u,origin:a,size:[i,i],spatialReference:n})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const r=Qf(t);return t.isWrappable&&!!r&&Math.abs(r.origin[0]-e.x)<=r.dx}return!1}readOrigin(t,e){return He.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,r=0;const i=[],n=this._levelToLOD={};t&&(e=-1/0,r=1/0,t.forEach(s=>{i.push(s.scale),e=s.scale>e?s.scale:e,r=s.scale<r?s.scale:r,n[s.level]=s})),this._set("scales",i),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const r=Math.floor(t),i=r+1;return e[r]/(e[r]/e[i])**(t-r)}scaleToZoom(t){const e=this.scales,r=e.length-1;let i=0;for(;i<r;i++){const n=e[i],s=e[i+1];if(n<=t)return i;if(s===t)return i+1;if(n>t&&s<t)return i+Math.log(n/t)/Math.log(n/s)}return i}snapScale(t,e=.95){const r=this.scaleToZoom(t);return r%Math.floor(r)>=e?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(t,e,r,i){const n=this.lodAt(t);if(!n)return null;let s,o;if(typeof e=="number")s=e,o=r;else if(yo(e.spatialReference,this.spatialReference))s=e.x,o=e.y,i=r;else{const c=sN(e,this.spatialReference);if(c==null)return null;s=c.x,o=c.y,i=r}const a=n.resolution*this.size[0],l=n.resolution*this.size[1];return i||(i=new iIe(null,0,0,0,Ht())),i.level=t,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((s-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(t,e=D1.ExtrapolateOptions.NONE){let r=this.lodAt(t.level);if(!r&&e===D1.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(r=o)}if(!r)return;const i=t.level-r.level,n=r.resolution*this.size[0]/2**i,s=r.resolution*this.size[1]/2**i;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=Ht()),t.extent[0]=this.origin.x+t.col*n,t.extent[1]=this.origin.y-(t.row+1)*s,t.extent[2]=t.extent[0]+n,t.extent[3]=t.extent[1]+s}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const r=this.lodAt(e.level);if(r==null)return null;const{resolution:i}=r,n=i*this.size[0],s=i*this.size[1];return t[0]=this.origin.x+e.col*n,t[1]=this.origin.y-(e.row+1)*s,t[2]=t[0]+n,t[3]=t[1]+s,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return D1.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const r=[],i=this.lods.length;for(let n=0;n<i;n++){const s=this.lods[n],o=s.resolution*e;r.push(new Af({level:s.level,scale:s.scale,resolution:o}))}return new D1({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let r=0;r<t.length;r++){const i=t[r];this._upsampleLevels[i.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/i.resolution:0},e=i}}};d([m({type:Number,json:{write:!0}})],Ha.prototype,"compressionQuality",void 0),d([m({type:Number,json:{write:!0}})],Ha.prototype,"dpi",void 0),d([m({type:String,json:{read:Cme.read,write:Cme.write,origins:{"web-scene":{read:!1,write:!1}}}})],Ha.prototype,"format",void 0),d([m({readOnly:!0})],Ha.prototype,"isWrappable",null),d([m({type:He,json:{write:!0}})],Ha.prototype,"origin",void 0),d([Xe("origin")],Ha.prototype,"readOrigin",null),d([m({type:[Af],value:null,json:{write:!0}})],Ha.prototype,"lods",null),d([m({readOnly:!0})],Ha.prototype,"scales",void 0),d([m({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Ha.prototype,"size",void 0),d([Xe("size",["rows","cols"])],Ha.prototype,"readSize",null),d([nt("size",{cols:{type:Vi},rows:{type:Vi}})],Ha.prototype,"writeSize",null),d([m({type:Ve,json:{write:!0}})],Ha.prototype,"spatialReference",void 0),Ha=D1=d([F("esri.layers.support.TileInfo")],Ha),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Ha||(Ha={}));const J3=Ha,Qlt=12;let wu=class mc{constructor(e){const r=mc.checkUnsupported(e);if(r!=null)throw r;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=Rb(this.spatialReference)||nw(this.spatialReference)||sw(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const n=i.lods.reduce((c,u,h)=>(u.level<c.min&&(c.min=u.level,c.minIndex=h),c.max=Math.max(c.max,u.level),c),{min:1/0,minIndex:0,max:-1/0}),s=i.lods[n.minIndex],o=2**s.level;let a=s.resolution*o,l=s.scale*o;this.levels=new Array(n.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new mc(this.toTileInfo())}toTileInfo(){return new J3({dpi:this.dpi,origin:new He({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,r)=>new Af({level:r,scale:e.scale,resolution:e.resolution}))})}getExtent(e,r,i,n){const s=this.levels[e],o=s.tileSize[0],a=s.tileSize[1];n[0]=this.origin[0]+i*o,n[2]=this.origin[0]+(i+1)*o,n[3]=this.origin[1]-r*a,n[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(e,r){this._isWebMercator?(r[0]=kde(e[0]),r[1]=fz(e[1]),r[2]=kde(e[2]),r[3]=fz(e[3])):this._isGCS&&(r[0]=Ut(e[0]),r[1]=Ut(e[1]),r[2]=Ut(e[2]),r[3]=Ut(e[3]))}getExtentGeometry(e,r,i,n=new br){return this.getExtent(e,r,i,$m),n.spatialReference=this.spatialReference,n.xmin=$m[0],n.ymin=$m[1],n.xmax=$m[2],n.ymax=$m[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(e){if(e==null)return!1;let r=!1;for(;this.levels.length<=e;){const i=this.levels[this.levels.length-1],n=i.resolution/2;this.levels.push({resolution:n,scale:i.scale/2,tileSize:[n*this.pixelSize,n*this.pixelSize]}),r=!0}return r}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const r=this.levels[0].scale;return e>=r?0:Math.log(r/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof mc)){if(mc.checkUnsupported(e))return!1;e=new mc(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[r].resolution;let n=.5*i;return!sb(e.origin[0],this.origin[0],n)||!sb(e.origin[1],this.origin[1],n)?!1:(n=.5*i/2**r/this.pixelSize*Qlt,sb(i,e.levels[r].resolution,n))}rootTilesInExtent(e,r=null,i=1/0){const n=new Array,s=this.levels[0].tileSize;if(e==null||s[0]===0||s[1]===0)return n;mc.computeRowColExtent(e,s,this.origin,$m);let o=$m[1],a=$m[3],l=$m[0],c=$m[2];const u=c-l,h=a-o;if(u*h>i){const p=Math.floor(Math.sqrt(i));h>p&&(o=o+Math.floor(.5*h)-Math.floor(.5*p),a=o+p),u>p&&(l=l+Math.floor(.5*u)-Math.floor(.5*p),c=l+p)}for(let p=o;p<a;p++)for(let f=l;f<c;f++)n.push([0,p,f]);return r!=null&&(r[0]=this.origin[0]+l*s[0],r[1]=this.origin[1]-a*s[1],r[2]=this.origin[0]+c*s[0],r[3]=this.origin[1]-o*s[1]),n}static computeRowColExtent(e,r,i,n){const s=.001*(e[2]-e[0]+(e[3]-e[1]));n[0]=Math.max(0,Math.floor((e[0]+s-i[0])/r[0])),n[2]=Math.max(0,Math.ceil((e[2]-s-i[0])/r[0])),n[1]=Math.max(0,Math.floor((i[1]-e[3]+s)/r[1])),n[3]=Math.max(0,Math.ceil((i[1]-e[1]-s)/r[1]))}static isPowerOfTwo(e){const r=e.lods,i=r[0].resolution*2**r[0].level;return!r.some(n=>!IZe(n.resolution,i/2**n.level))}static hasGapInLevels(e){const r=e.lods.map(i=>i.level);r.sort((i,n)=>i-n);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(e){const r=e.size[1];return r===e.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(e){const r=e.origin;return e.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new B("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?Noe():e.lods.length<1?new B("tilingscheme:generic","Tiling scheme must have at least one level"):mc.isPowerOfTwo(e)?mc.hasGapInLevels(e)?new B("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):mc.tileSizeSupported(e)?mc.hasOriginPerLODs(e)?new B("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new B("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new B("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,r){const i=e[2]-e[0],n=e[3]-e[1],s=fl(r),o=1.2*Math.max(i,n),a=256,l=96,c=.0254,u=new mc(new J3({size:[a,a],origin:new He({x:e[0]-.5*(o-i),y:e[3]+.5*(o-n)}),lods:[new Af({level:0,resolution:o/a,scale:1/(a/l*c/(o*s))})],spatialReference:r}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const r=new mc(mc.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(e),r}static makeGCSWithTileSize(e,r=256,i=16){const n=256/r,s=new mc(new J3({size:[r,r],origin:new He({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Af({level:0,resolution:.703125*n,scale:295497598570834e-6*n})]}));return s.ensureMaxLod(i),s}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function Noe(){return new B("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}wu.WebMercatorAuxiliarySphereTileInfo=new J3({size:[256,256],origin:new He({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ve.WebMercator}),spatialReference:Ve.WebMercator,lods:[new Af({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),wu.WebMercatorAuxiliarySphere=wu.makeWebMercatorAuxiliarySphere(19);const $m=Ht(),s3=64,uR=512,Klt=2.5,sD=LZe(DZ/10),nIe=2,sIe=Ht();wu.WebMercatorAuxiliarySphere.getExtent(0,0,0,sIe);const ect=Ht([-180,-90,180,90]),tct="Cannot extend surface to encompass all layers because it would result in too many root tiles.",rct="Surface extent is too large for tile resolution at level 0.",ict=3;let nct=ict;function _Q(t){return t<4?3:nct}const Hs=4;let N1=class extends Xn.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=sD}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if((e==null?void 0:e.extent)==null||e.spatialReference==null)return null;const r=MB(e.extent,e.spatialReference);return r.zmin=e.visibleElevationBounds.min,r.zmax=e.visibleElevationBounds.max,r}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??Ve.WGS84}elevationAt(e,r){var i;if(this.extent==null||!Ul(this.extent,e,r)){const n=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return K.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${n})`),this.noDataValue}return((i=this.view.elevationProvider)==null?void 0:i.getElevation(e,r,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return tIe(e.clone(),this)}};d([m({readOnly:!0})],N1.prototype,"demResolution",void 0),d([m({readOnly:!0})],N1.prototype,"extent",null),d([m({readOnly:!0})],N1.prototype,"noDataValue",void 0),d([m()],N1.prototype,"spatialReference",null),d([m({constructOnly:!0})],N1.prototype,"view",void 0),N1=d([F("esri.views.support.GroundViewElevationSampler")],N1);const sct=N1;let Qy=class extends Pe{constructor(e){super(e),this.view=null,this.layerViews=new St}initialize(){this.addHandles(up(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new sct({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?Y$e(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>pe(()=>e.updating,()=>this._updateUpdating(),ei)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};d([m({readOnly:!0})],Qy.prototype,"elevationSampler",null),d([m({readOnly:!0})],Qy.prototype,"extent",null),d([m({type:Boolean,readOnly:!0})],Qy.prototype,"updating",null),d([m({constructOnly:!0})],Qy.prototype,"view",void 0),d([m({type:St,readOnly:!0})],Qy.prototype,"layerViews",void 0),d([m({readOnly:!0})],Qy.prototype,"suspended",null),Qy=d([F("esri.views.GroundView")],Qy);const oct=Qy;let f_=class{constructor(e,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in e){const n=e[i],s=new rCe(n,void 0,void 0,2,2);this._properties[i]={pool:s,acquired:[]}}this._afterDispatchHandle=fCe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const r=this._properties[e];for(const i of r.acquired)yde(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(e){const r=this._owner._get(e),i=this._properties[e];let n=i.pool.acquire();for(i.acquired.push(n);n===r;)i.acquired.push(n),n=i.pool.acquire();return n}_release(){for(const e in this._properties){const r=this._properties[e];let i=0;for(const n of r.acquired)yde(n)?r.acquired[i++]=n:r.pool.release(n);r.acquired.length=i}}};const act=ne("mac")?"Meta":"Ctrl",lct=new Set(["Alt","Ctrl","Meta","Shift","Primary"]),cct=t=>lct.has(t);let uct=class{constructor(e,r=[]){this.eventType=e,this.keyModifiers=r}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=e.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}};const Pme=()=>K.getLogger("esri.views.input.InputHandler");let va=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const r=this._incoming[e];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?Pme().error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(r=>this._handleEvent(r)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,r,i){let n;typeof r=="function"?(i=r,n=[]):n=r||[];const s=typeof e=="string"?new uct(e,n):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const h=this._incoming[u.match.eventType];if(h){const p=h.indexOf(u);h.splice(p,1),o(),this._manager&&this._manager.updateDependencies()}},l=new hct(s,i,{onPause:a,onRemove:a,onResume:u=>{const h=this._incoming[u.match.eventType];h&&!h.includes(u)&&(h.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[s.eventType];return c||(c=[],this._incoming[s.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const r=new dct(e,{onEmit:(i,n,s,o)=>{var a;(a=this._manager)==null||a.emit(i.eventType,n,s,o)},onRemove:i=>{var n;delete this._outgoing[i.eventType],(n=this._manager)==null||n.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!0)}stopCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Pme().error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var i;const r=this._incoming[e.type];if(r){for(const n of r)if(n.match.matches(e)&&((i=n.callback)==null||i.call(n,e),e.shouldStopPropagation()))break}}},hct=class{constructor(e,r,i){this.match=e,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},dct=class{constructor(e,r){this.eventType=e,this._removed=!1,this._handler=r}emit(e,r,i){this._removed||this._handler.onEmit(this,e,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},pct=class extends va{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(e){const r=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:n}=e;r===this._value&&this._x===i&&this._y===n||(this._value=r,this._x=i,this._y=n,this._onChange(r,i,n))}},fct=class{constructor(e,r){this._observable=new nN,this._value=e,this._equalityFunction=r}get value(){return Ft(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function Zg(t,e=UEe){return new fct(t,e)}let mct=class extends va{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=Zg(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},dd=class extends Pe{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=act,this._latestPointerType="mouse",this._propertiesPool=new f_({latestPointerLocation:_ct},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const r of e)this.uninstallHandlers(r);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,r,i=cb.INTERNAL){if(this._nameToGroup[e])return void K.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(r.length===0)return void K.getLogger(this).error("Can't register a group of zero handlers");const n={name:e,handlers:r.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=n;for(let s=n.handlers.length-1;s>=0;s--){const o=n.handlers[s];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,u,h)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,h,u)},setPointerCapture:(a,l)=>{this._setPointerCapture(n,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const r=this._nameToGroup[e];r?(r.handlers.forEach(i=>{var n;i.removed=!0,(n=i.uninstallCallback)==null||n.call(i)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):K.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers&&this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,r=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const n=this._handlers[i];n.priorityIndex=i,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const n=this._handlersPriority[i];n.priorityIndex=i;let s=n.handler.hasSideEffects;if(!s){for(const o of n.handler.outgoingEventTypes)if(e.has(o)){s=!0;break}}if(s)for(const o of n.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)cct(a)||r.add(a)}n.active=s}this._sourceEvents=e,this._keyModifiers=r,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,r,i){this._latestPointerType=e;const n=this._get("latestPointerLocation");if(n==null||n.x!==r||n.y!==i){const s=this._propertiesPool.get("latestPointerLocation");s.x=r,s.y=i,this._set("latestPointerLocation",s)}}_onEventReceived(e,r){if(e==="pointer-capture-lost"){const s=r;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,r);const i=this.test.timestamp!=null?this.test.timestamp:r.native?r.native.timestamp:void 0,n=r.native?r.native.cancelable:void 0;this._emitInputEventFromSource(e,r,i,n)}_updateKeyModifiers(e,r){if(!r)return;let i=!1;const n=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},s=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(n(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(n(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=r.key;this._keyModifiers.has(a)&&s(a,e==="key-down")}const o=r.native;s("Alt",!(!o||!o.altKey)),s("Ctrl",!(!o||!o.ctrlKey)),s("Shift",!(!o||!o.shiftKey)),s("Meta",!(!o||!o.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new pct((e,r,i)=>this._setLatestPointer(e,r,i)),this._multiTouchHandler=new mct,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],cb.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,cb.INTERNAL)}_setPointerCapture(e,r,i,n){const s=e.name+"-"+r.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),n?(o.add(s),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(s)&&(o.delete(s),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,r,i,n){this._emitInputEvent(0,e,r,i,n)}_emitInputEvent(e,r,i,n,s,o){const a=n!==void 0?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=s!==void 0&&s,c={event:new gct(r,i,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new zz,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var r,i,n;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:s,priorityIndex:o}=e.events.pop(),a=(r=s.data)==null?void 0:r.eventId;if(!(a!=null&&this._stoppedPropagationEventIds.has(a)))for(e.currentHandler=this._handlersPriority[o];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!s.shouldStopPropagation()&&((n=(i=e.currentHandler).eventCallback)==null||n.call(i,s)),s.shouldStopPropagation()){a!=null&&this._stoppedPropagationEventIds.add(a);break}if(s.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:s,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const r=new zz;r.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)r.push(i.events.pop());i.events=r,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,r){if(e.handler.hasSideEffects!==r.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==r.groupPriority)return e.groupPriority>r.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const n of r.handler.incomingEventMatches){if(i.eventType!==n.eventType)continue;const s=i.keyModifiers.filter(o=>n.keyModifiers.includes(o));if(s.length===i.keyModifiers.length!=(s.length===n.keyModifiers.length))return i.keyModifiers.length>n.keyModifiers.length?-1:1}return e.priorityIndex>r.priorityIndex?-1:1}_sortHandlersPriority(e){const r=[];for(const i of e){let n=0;for(;n<r.length&&this._compareHandlerPriority(i,r[n])>=0;)n++;r.splice(n,0,i)}return r}get debug(){const e=r=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},r(),this._setPointerCapture=i};return{injectEvent:(r,i)=>{e(()=>{this._onEventReceived(r,i)})},disablePointerCapture:e}}};d([m({readOnly:!0})],dd.prototype,"hasPendingInputs",null),d([m({constructOnly:!0})],dd.prototype,"eventSource",void 0),d([m({constructOnly:!0})],dd.prototype,"recognizers",void 0),d([m()],dd.prototype,"_latestPointerType",void 0),d([m()],dd.prototype,"latestPointerType",null),d([m()],dd.prototype,"multiTouchActive",null),d([m({readOnly:!0})],dd.prototype,"latestPointerLocation",void 0),d([m()],dd.prototype,"_paused",void 0),d([m({readOnly:!0})],dd.prototype,"updating",null),dd=d([F("esri.views.input.InputManager")],dd);let gct=class{constructor(e,r,i,n,s){this.type=e,this.data=r,this.timestamp=i,this.modifiers=n,this.cancelable=s,this._propagationState=yv.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=yv.STOPPED}shouldStopPropagation(){return(this._propagationState&yv.STOPPED)!=0}async(e){this._propagationState|=yv.PAUSED;const r=(i,n)=>{this._propagationState&=~yv.PAUSED;const s=this._resumeCallback;if(this._resumeCallback=null,s&&s(),n)throw i;return i};return(typeof e=="function"?e():e).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&yv.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var yv;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(yv||(yv={}));const cb={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let yct=class{};const _ct=yct;function Im(t){return t!=null&&"open"in t&&"declaredClass"in t}function Ame(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const vct=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([pe(()=>[this.ui,this.popup],([r,i],n)=>{const s="popup",o="manual";if(n){const[a,l]=n;a&&Im(l)&&(l.view=null,Ame(l)&&a.remove(l,s))}r&&Im(i)&&(i.view=this,Ame(i)&&r.add(i,{key:s,position:o,internal:!0}))},mi),this.on("click",r=>{this.popup&&this.popupEnabled&&(r.pointerType!=="mouse"||r.button===0)&&(!Im(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(Im(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup(),Im(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)})))},cb.WIDGET)]),qT(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{re(()=>import("./Popup-CsWJrj0c.js"),__vite__mapDeps([62,1,63,64,9,65,66,67,68,69,70,71,72,73,74,75,76,77,78]))})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){if(Im(this.popup))return this.popup.open(r);try{if(await this.setupPopup(),!this.popup)return void K.getLogger(this).error(new B("view:null-popup","Popup is null and can't be opened"));this.popup.open(r)}catch{}}closePopup(){var r;(r=this._popupSetupTask)==null||r.abort(),Im(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,i){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(r,i),i)}async setupPopup(){var r;if((r=this._popupSetupTask)==null||r.abort(),this.popup&&!Im(this.popup))return this._popupSetupTask=b_(async i=>{const{default:n}=await re(()=>import("./Popup-CsWJrj0c.js"),__vite__mapDeps([62,1,63,64,9,65,66,67,68,69,70,71,72,73,74,75,76,77,78]));if(dt(i),!this.popup||Im(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new n(s)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:r,hits:i},n){const s=[],o=[];let a=!1;const l=aqe(n,ne("popup-view-fetch-timeout")??wct),c=p=>{const f=new bct(p);return o.push(f),s.push(f.promise),f},u=p=>{const f=o.at(-1);return f&&f.layerView===p&&!a?f:c(p)};for(const p of i)"graphic"in p?(u(p.layerView).graphics.push(p.graphic),a=!1):(s.push(p.layerView.fetchPopupFeaturesAtLocation(p.mapPoint,l)),a=!0);o.map(p=>p.resolve(l));const h=WU(s).then(p=>p.filter(f=>!!f).flat());return{pendingFeatures:s,allGraphicsPromise:h,location:r}}async _getPopupHits(r,i){const{hits:n,location:s}=await this.popupHitTest(r);dt(i);const o=[];for(const a of n)if("graphic"in a){if(this._isValidPopupGraphic(a.graphic,i)){const l=this._isValidPopupGraphicsLayerView(a.layerView)?a.layerView:void 0;o.push({graphic:a.graphic,layerView:l})}}else this._isValidPopupLocationLayerView(a.layerView)&&o.push({mapPoint:a.mapPoint,layerView:a.layerView});return{hits:o,location:s}}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(i!=null&&i.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(r){return!r||(!("layer"in r)||!r.suspended)&&"fetchPopupFeaturesFromGraphics"in r}_isValidPopupLocationLayerView(r){return(!("layer"in r)||!r.suspended)&&"fetchPopupFeaturesAtLocation"in r}};return d([m({cast(r){return!r||Im(r)||typeof r=="object"&&(r.open=i=>(yb(K.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(i)),r.close=()=>(yb(K.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),r}})],e.prototype,"popup",void 0),d([m()],e.prototype,"popupEnabled",void 0),e=d([F("esri.views.PopupView")],e),e};let bct=class{constructor(e){this.layerView=e,this._resolver=ma(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:r,graphics:i,_resolver:n}=this;if(!r)return n.resolve(i),n.promise;let s;return r.fetchPopupFeaturesFromGraphics(i,e).catch(o=>(s=o,null)).then(o=>{o?n.resolve(o):n.reject(s)}),n.promise}};const wct=5e3,Ome={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function gT(t,e,r,i=cy){const n=new qh(moe(i)),s=ar.fromJSDate(t,{zone:n}),o=r==="decades"||r==="centuries"?"year":oIe(r);return r==="decades"&&(e*=10),r==="centuries"&&(e*=100),s.plus({[o]:e}).toJSDate()}function Mme(t,e,r=cy){const i=new qh(moe(r)),n=ar.fromJSDate(t,{zone:i});if(e==="decades"||e==="centuries"){const o=n.startOf("year"),{year:a}=o,l=a-a%(e==="decades"?10:100);return o.set({year:l}).toJSDate()}const s=oIe(e);return n.startOf(s).toJSDate()}function xct(t,e,r){return t===0?0:t*Ome[e]/Ome[r]}function pXt(t,e){return t&&e?t.intersection(e):t||e}function oIe(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var Yp;let _h=Yp=class extends Se{static get allTime(){return Rme}static get empty(){return Sct}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=(t==null?void 0:t.getTime())??null}get isAllTime(){return this.equals(Yp.allTime)}get isEmpty(){return this.equals(Yp.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=(t==null?void 0:t.getTime())??null}clone(){return new Yp({end:this.end,start:this.start})}equals(t){var s,o,a,l;if(!t)return!1;const e=((s=this.start)==null?void 0:s.getTime())??this.start,r=((o=this.end)==null?void 0:o.getTime())??this.end,i=((a=t.start)==null?void 0:a.getTime())??t.start,n=((l=t.end)==null?void 0:l.getTime())??t.end;return e===i&&r===n}expandTo(t,e=cy){if(this.isEmpty||this.isAllTime)return this.clone();let r=this.start;r&&(r=Mme(r,t,e));let i=this.end;if(i){const n=Mme(i,t,e);i=i.getTime()===n.getTime()?n:gT(n,1,t,e)}return new Yp({start:r,end:i})}intersection(t){var a,l,c,u;if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return Yp.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=((a=this.start)==null?void 0:a.getTime())??-1/0,r=((l=this.end)==null?void 0:l.getTime())??1/0,i=((c=t.start)==null?void 0:c.getTime())??-1/0,n=((u=t.end)==null?void 0:u.getTime())??1/0;let s,o;if(i>=e&&i<=r?s=i:e>=i&&e<=n&&(s=e),r>=i&&r<=n?o=r:n>=e&&n<=r&&(o=n),s!=null&&o!=null&&!isNaN(s)&&!isNaN(o)){const h=new Yp;return h.start=s===-1/0?null:new Date(s),h.end=o===1/0?null:new Date(o),h}return Yp.empty}offset(t,e,r=cy){if(this.isEmpty||this.isAllTime)return this.clone();const i=new Yp,{start:n,end:s}=this;return n!=null&&(i.start=gT(n,t,e,r)),s!=null&&(i.end=gT(s,t,e,r)),i}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return Rme.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,r=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new Yp({start:e,end:r})}};d([m({type:Date,json:{write:{allowNull:!0}}})],_h.prototype,"end",void 0),d([Xe("end")],_h.prototype,"readEnd",null),d([nt("end")],_h.prototype,"writeEnd",null),d([m({readOnly:!0,json:{read:!1}})],_h.prototype,"isAllTime",null),d([m({readOnly:!0,json:{read:!1}})],_h.prototype,"isEmpty",null),d([m({type:Date,json:{write:{allowNull:!0}}})],_h.prototype,"start",void 0),d([Xe("start")],_h.prototype,"readStart",null),d([nt("start")],_h.prototype,"writeStart",null),_h=Yp=d([F("esri.TimeExtent")],_h);const Rme=new _h,Sct=new _h({start:void 0,end:void 0}),hw=_h;async function Foe(t,e){const{WhereClause:r}=await re(()=>import("./WhereClause-CCygtHvR.js").then(i=>i.W),__vite__mapDeps([23,24]));return r.create(t,e)}function Tct(t,e){return t!=null&&t!==""?e!=null&&e!==""?`(${t}) AND (${e})`:t:e}function fXt(t){return typeof t=="number"}function koe(t){return typeof t=="string"||t instanceof String}const Ect="yyyy-MM-dd",Cct="TT";var PI;(function(t){t.HM="HH:mm",t.HMS="HH:mm:ss",t.HMS_MS="HH:mm:ss.SSS"})(PI||(PI={}));const Pct=[PI.HMS_MS,PI.HMS,PI.HM,Cct];function $me(t){if(!t||!koe(t))return null;const e=ar.fromFormat(t,Ect);return e.isValid?e:null}function Ime(t){return t&&koe(t)?RHe(Pct,e=>{const r=ar.fromFormat(t,e);return r.isValid?r:null})??null:null}function Lme(t){if(!t||!koe(t))return null;const e=ar.fromISO(t);return e.isValid?e:null}var oA;(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(oA||(oA={}));const Act=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function Oct(t){return t!=null&&Act.has(t.type)}function aIe(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function lIe(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function cIe(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function Mct(t,e){const r=t==null?void 0:t.domain;if(!r)return null;switch(r.type){case"range":{const{min:i,max:n}=uIe(t);if(i!=null&&+e<i||n!=null&&+e>n)return oA.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(r.codedValues==null||r.codedValues.every(i=>i==null||i.code!==e))return oA.INVALID_CODED_VALUE}return null}function uIe(t,e){const r=e??(t==null?void 0:t.domain);if(!r||r.type!=="range")return;const i="range"in r?r.range[0]:r.minValue,n="range"in r?r.range[1]:r.maxValue,s=Oct(t);return aIe(t)||cIe(t)||lIe(t)?{...Rct(t,n,i),isInteger:s}:{min:i!=null&&typeof i=="number"?i:null,max:n!=null&&typeof n=="number"?n:null,rawMin:i,rawMax:n,isInteger:s}}function Rct(t,e,r){var i,n,s,o,a,l;return aIe(t)?{min:(i=$me(r))==null?void 0:i.toMillis(),max:(n=$me(e))==null?void 0:n.toMillis(),rawMin:r,rawMax:e}:cIe(t)?{min:(s=Ime(r))==null?void 0:s.toMillis(),max:(o=Ime(e))==null?void 0:o.toMillis(),rawMin:r,rawMax:e}:lIe(t)?{min:(a=Lme(r))==null?void 0:a.toMillis(),max:(l=Lme(e))==null?void 0:l.toMillis(),rawMin:r,rawMax:e}:{max:null,min:null}}const $ct=()=>K.getLogger("esri.support.arcadeOnDemand");let dH;function Ub(){return dH||(dH=(async()=>{const t=await re(()=>import("./arcadeUtils-BhCpkzPt.js").then(e=>e.aK),__vite__mapDeps([79,24,80,27,81]));return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),dH}const Ict=(t,e,r)=>Uoe.create(t,e,r,null,["$feature","$view"],[]),hIe=(t,e,r)=>Uoe.create(t,e,r,null,["$feature","$view"],[]),Lct=(t,e,r,i)=>Uoe.create(t,e,r,i,["$feature","$view"],[]);let Uoe=class dIe{constructor(e,r,i,n,s,o,a){this.services=null,this.script=e,this.evaluate=n;const l=Array.isArray(o)?o:o==null?void 0:o.fields;this.fields=l??[],this._syntaxTree=i,this._arcade=r,this._arcadeFeature=s,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,r,i,n,s,o){const{arcade:a,Feature:l,Dictionary:c}=await Ub(),u=Ve.fromJSON(r);let h;try{h=a.parseScript(e,o)}catch(L){return $ct().error(new B("arcade-bad-expression","Failed to parse arcade script",{script:e,error:L})),null}const p=s.reduce((L,U)=>({...L,[U]:null}),{});let f=null;n!=null&&(f=new c(n),f.immutable=!0,p.$config=null);const g=a.scriptUsesGeometryEngine(h),y=g&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(h)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(h),w=b&&a.enableAsyncSupport(),x={vars:p,spatialReference:u,useAsync:!!w};await Promise.all([y,v,w]);const S=new Set;await a.loadDependentModules(S,h,null,b,g);const E=new c;E.immutable=!1,E.setField("scale",0);const P=a.compileScript(h,x),M=(L,U)=>{var W;const z=(W=L.$view)==null?void 0:W.timeZone;return"$view"in L&&L.$view&&(E.setField("scale",typeof L.$view=="object"&&"scale"in L.$view?L.$view.scale:void 0),L.$view=E),f&&(L.$config=f),P({vars:L,spatialReference:u,services:U,timeZone:z})};return new dIe(e,a,h,M,new l,i,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const Dct=/^([0-9_])/,Nct=/[^a-z0-9_\u0080-\uffff]+/gi;function Fct(t){return t==null?null:t.trim().replaceAll(Nct,"_").replace(Dct,"F$1")||null}const kct=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],Uct=["field","normalizationField"];function Dme(t,e){if(t!=null&&e!=null){for(const r of Array.isArray(t)?t:[t])if(Nme(kct,r,e),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)Nme(Uct,i,e)}}function Nme(t,e,r){if(t)for(const i of t){const n=eB(i,e),s=n&&typeof n!="function"&&r.get(n);s&&f2(i,s.name,e)}}function Fme(t,e){var r;if(t!=null&&((r=e==null?void 0:e.fields)!=null&&r.length))if("startField"in t){const i=e.get(t.startField),n=e.get(t.endField);t.startField=(i==null?void 0:i.name)??null,t.endField=(n==null?void 0:n.name)??null}else{const i=e.get(t.startTimeField),n=e.get(t.endTimeField);t.startTimeField=(i==null?void 0:i.name)??null,t.endTimeField=(n==null?void 0:n.name)??null}}const pH=new Set;function $7(t,e){return t&&e?(pH.clear(),oD(pH,t,e),Array.from(pH).sort()):[]}function oD(t,e,r){var i;if(r)if((i=e==null?void 0:e.fields)!=null&&i.length)if(r.includes("*"))for(const{name:n}of e.fields)t.add(n);else for(const n of r)Uh(t,e,n);else{if(r.includes("*"))return t.clear(),void t.add("*");for(const n of r)n!=null&&t.add(n)}}function Uh(t,e,r){if(typeof r=="string")if(e){const i=e.get(r);i&&t.add(i.name)}else t.add(r)}function zct(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(r=>r.name):e}async function Uc(t,e,r){var s;if(!r)return;const{arcadeUtils:i}=await Ub(),n=i.extractFieldNames(r,(s=e==null?void 0:e.fields)==null?void 0:s.map(o=>o.name));for(const o of n)Uh(t,e,o)}async function pIe(t,e,r){if(r&&r!=="1=1"){const i=await Foe(r,e);if(!i.isStandardized)throw new B("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});oD(t,e,i.fieldNames)}}function Vct({displayField:t,fields:e}){return t||(e!=null&&e.length?fH(e,"name-or-title")||fH(e,"unique-identifier")||fH(e,"type-or-category")||Bct(e):null)}function Bct(t){for(const e of t){if(!(e!=null&&e.name))continue;const r=e.name.toLowerCase();if(r.includes("name")||r.includes("title"))return e.name}return null}function fH(t,e){for(const r of t)if(r!=null&&r.valueType&&r.valueType===e)return r.name;return null}async function mXt(t,e){var i;if(!e)return;const r=(i=e.elevationInfo)==null?void 0:i.featureExpressionInfo;return r?r.collectRequiredFields(t,e.fieldsIndex):void 0}function Gct(t,e,r){r.onStatisticExpression?Uc(t,e,r.onStatisticExpression.expression):t.add(r.onStatisticField)}async function gXt(t,e,r){if(!e||!r||!("fields"in r))return;const i=[],n=r.popupTemplate;i.push(jct(t,e,n)),r.fields&&i.push(...r.fields.map(async s=>Gct(t,e.fieldsIndex,s))),await Promise.all(i)}async function jct(t,e,r){const i=[];r!=null&&r.expressionInfos&&i.push(...r.expressionInfos.map(s=>Uc(t,e.fieldsIndex,s.expression)));const n=r==null?void 0:r.content;if(Array.isArray(n))for(const s of n)s.type==="expression"&&s.expressionInfo&&i.push(Uc(t,e.fieldsIndex,s.expressionInfo.expression));await Promise.all(i)}async function yXt(t,e,r){e&&(e.timeInfo&&(r!=null&&r.timeExtent)&&oD(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&oD(t,e.fieldsIndex,[e.floorInfo.floorField]),(r==null?void 0:r.where)!=null&&await pIe(t,e.fieldsIndex,r.where))}async function _Xt(t,e,r){e&&r&&await Promise.all(r.map(i=>Hct(t,e,i)))}async function Hct(t,e,r){e&&r&&(r.valueExpression?await Uc(t,e.fieldsIndex,r.valueExpression):r.field&&Uh(t,e.fieldsIndex,r.field))}function qct(t){return t?$7(t.fieldsIndex,fIe(t)):[]}function Wct(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?$7(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const Yct=new Set(["oid","global-id","guid"]),Xct=new Set(["oid","global-id"]),Zct=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function Jct(t){const e=new Set;mIe(t).forEach(i=>e.add(i)),Wct(t).forEach(i=>e.add(i.toLowerCase()));const r=t&&"infoFor3D"in t?t.infoFor3D:void 0;return r&&(Object.values(r.assetMapFieldRoles).forEach(i=>e.add(i.toLowerCase())),Object.values(r.transformFieldRoles).forEach(i=>e.add(i.toLowerCase()))),Array.from(e)}function fIe(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:r,creatorField:i,editDateField:n,editorField:s}=e;return[r,i,n,s].filter(Boolean)}function mIe(t){return fIe(t).map(e=>e.toLowerCase())}function Qct(t,e){var r;return t.editable&&!Yct.has(t.type)&&!mIe(e).includes(((r=t.name)==null?void 0:r.toLowerCase())??"")}function Kct(t,e){var i;const r=((i=t.name)==null?void 0:i.toLowerCase())??"";return!((e==null?void 0:e.objectIdField)!=null&&r===e.objectIdField.toLowerCase()||(e==null?void 0:e.globalIdField)!=null&&r===e.globalIdField.toLowerCase()||Jct(e).includes(r)||Xct.has(t.type)||Zct.some(n=>n.test(r)))}async function vXt(t,e){const{labelingInfo:r,fieldsIndex:i}=e;r!=null&&r.length&&await Promise.all(r.map(n=>eut(t,i,n)))}async function eut(t,e,r){if(!r)return;const i=r.getLabelExpression(),n=r.where;if(i.type==="arcade")await Uc(t,e,i.expression);else{const s=i.expression.match(/{[^}]*}/g);s&&s.forEach(o=>{Uh(t,e,o.slice(1,-1))})}await pIe(t,e,n)}function tut(t){const e=t.defaultValue;return e!==void 0&&_Ie(t,e)?e:t.nullable?null:void 0}function bXt(t){const e=typeof t=="string"?{type:t}:t;return put(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function gIe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function rut(t){return t===null||gIe(t)}function iut(t){return t===null||Number.isInteger(t)}function yIe(t){return t!=null&&typeof t=="string"}function nut(t){return t===null||yIe(t)}function sut(){return!0}function _Ie(t,e){let r;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":r=t.nullable?iut:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=t.nullable?rut:gIe;break;case"string":case"esriFieldTypeString":r=t.nullable?nut:yIe;break;default:r=sut}return arguments.length===1?r:r(e)}const out=["integer","small-integer","big-integer"],aut=["single","double"],lut=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],cut=["esriFieldTypeSingle","esriFieldTypeDouble"],uut=new Set([...out,...lut]),hut=new Set([...aut,...cut]),dut=lCe(uut,hut);function zoe(t){return t!=null&&dut.has(t.type)}function put(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function vIe(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function wXt(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function xXt(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function fut(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function kme(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function Ume(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function SXt(t,e){return mut(t,e)===null}var t9,r9;function TXt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function mut(t,e){return t==null||t.nullable&&e===null?null:zoe(t)&&!gut(t.type,Number(e))?t9.OUT_OF_RANGE:_Ie(t,e)?t.domain?Mct(t,e):null:r9.INVALID_TYPE}function gut(t,e){const r=typeof t=="string"?bIe(t):t;if(!r)return!1;const i=r.min,n=r.max;return r.isInteger?Number.isInteger(e)&&e>=i&&e<=n:e>=i&&e<=n}function bIe(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return yut;case"esriFieldTypeInteger":case"integer":return _ut;case"esriFieldTypeBigInteger":case"big-integer":return vut;case"esriFieldTypeSingle":case"single":return but;case"esriFieldTypeDouble":case"double":return wut}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(t9||(t9={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(r9||(r9={}));const yut={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},_ut={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},vut={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},but={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},wut={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function EXt(t,e,r){switch(t){case oA.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case oA.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case r9.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case t9.OUT_OF_RANGE:{const{min:i,max:n}=bIe(e.type);return`Value ${r} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${i} to ${n}`}}}function CXt(t,e){return!xut(t,e,null)}function xut(t,e,r){if(!(e!=null&&e.attributes)||!t){if(r!=null)for(const s of t??[])r.add(s);return!0}const i=new Set(Object.keys(e.attributes));let n=!1;for(const s of t)if(!i.has(s)){if(n=!0,r==null)break;r.add(s)}return n}function Sut(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let A6=class extends Se{constructor(e){super(e),this.type=null}};d([m({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],A6.prototype,"type",void 0),A6=d([F("esri.popup.content.Content")],A6);const dw=A6;var vQ;let Sx=vQ=class extends dw{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new vQ({description:this.description,displayType:this.displayType,title:this.title})}};d([m({type:String,json:{write:!0}})],Sx.prototype,"description",void 0),d([m({type:["auto","preview","list"],json:{write:!0}})],Sx.prototype,"displayType",void 0),d([m({type:String,json:{write:!0}})],Sx.prototype,"title",void 0),d([m({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],Sx.prototype,"type",void 0),Sx=vQ=d([F("esri.popup.content.AttachmentsContent")],Sx);const aD=Sx;var bQ;let Tx=bQ=class extends dw{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new bQ({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ae(this.outFields):null})}};d([m()],Tx.prototype,"creator",void 0),d([m()],Tx.prototype,"destroyer",void 0),d([m()],Tx.prototype,"outFields",void 0),d([m({type:["custom"],readOnly:!0})],Tx.prototype,"type",void 0),Tx=bQ=d([F("esri.popup.content.CustomContent")],Tx);const Tut=Tx;var wQ;let sC=wQ=class extends Se{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new wQ({title:this.title,expression:this.expression})}};d([m({type:String,json:{write:!0}})],sC.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],sC.prototype,"expression",void 0),d([m({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],sC.prototype,"returnType",void 0),sC=wQ=d([F("esri.popup.ElementExpressionInfo")],sC);const Eut=sC;var xQ;let hR=xQ=class extends dw{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new xQ({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};d([m({type:Eut,json:{write:!0}})],hR.prototype,"expressionInfo",void 0),d([m({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],hR.prototype,"type",void 0),hR=xQ=d([F("esri.popup.content.ExpressionContent")],hR);const Voe=hR;let oC=class extends ds(Se){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};d([gt(Znt)],oC.prototype,"dateFormat",void 0),d([m({type:Boolean,json:{write:!0}})],oC.prototype,"digitSeparator",void 0),d([m({type:Vi,json:{write:!0}})],oC.prototype,"places",void 0),oC=d([F("esri.popup.support.FieldInfoFormat")],oC);const O6=oC;var SQ;let Xp=SQ=class extends Se{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new SQ({fieldName:this.fieldName,format:this.format?ae(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};d([m({type:String,json:{write:!0}})],Xp.prototype,"fieldName",void 0),d([m({type:O6,json:{write:!0}})],Xp.prototype,"format",void 0),d([m({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],Xp.prototype,"isEditable",void 0),d([m({type:String,json:{write:!0}})],Xp.prototype,"label",void 0),d([gt(new Ii({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Xp.prototype,"stringFieldOption",void 0),d([m({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Xp.prototype,"statisticType",void 0),d([m({type:String,json:{write:!0}})],Xp.prototype,"tooltip",void 0),d([m({type:Boolean,json:{write:!0}})],Xp.prototype,"visible",void 0),Xp=SQ=d([F("esri.popup.FieldInfo")],Xp);const Boe=Xp;var TQ;let Ky=TQ=class extends dw{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new TQ(ae({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};d([m({type:Object,json:{write:!0}})],Ky.prototype,"attributes",void 0),d([m({type:String,json:{write:!0}})],Ky.prototype,"description",void 0),d([m({type:[Boe]})],Ky.prototype,"fieldInfos",void 0),d([nt("fieldInfos")],Ky.prototype,"writeFieldInfos",null),d([m({type:String,json:{write:!0}})],Ky.prototype,"title",void 0),d([m({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Ky.prototype,"type",void 0),Ky=TQ=d([F("esri.popup.content.FieldsContent")],Ky);const lD=Ky;let Ex=class extends Se{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};d([m({type:String,json:{write:!0}})],Ex.prototype,"altText",void 0),d([m({type:String,json:{write:!0}})],Ex.prototype,"caption",void 0),d([m({type:String,json:{write:!0}})],Ex.prototype,"title",void 0),d([m({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Ex.prototype,"type",void 0),Ex=d([F("esri.popup.content.mixins.MediaInfo")],Ex);const Goe=Ex;var EQ;let Cx=EQ=class extends Pe{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new EQ({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};d([m()],Cx.prototype,"color",void 0),d([m()],Cx.prototype,"fieldName",void 0),d([m()],Cx.prototype,"tooltip",void 0),d([m()],Cx.prototype,"value",void 0),Cx=EQ=d([F("esri.popup.content.support.ChartMediaInfoValueSeries")],Cx);const Cut=Cx;var CQ;let F1=CQ=class extends Se{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new CQ({colors:ae(this.colors),fields:ae(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};d([m({type:[De],json:{type:[[Vi]],write:!0}})],F1.prototype,"colors",void 0),d([m({type:[String],json:{write:!0}})],F1.prototype,"fields",void 0),d([m({type:String,json:{write:!0}})],F1.prototype,"normalizeField",void 0),d([m({type:[Cut],json:{read:!1}})],F1.prototype,"series",void 0),d([m({type:String,json:{write:!0}})],F1.prototype,"tooltipField",void 0),F1=CQ=d([F("esri.popup.content.support.ChartMediaInfoValue")],F1);const Put=F1;let dR=class extends Goe{constructor(e){super(e),this.type=null,this.value=null}};d([m({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],dR.prototype,"type",void 0),d([m({type:Put,json:{write:!0}})],dR.prototype,"value",void 0),dR=d([F("esri.popup.content.mixins.ChartMediaInfo")],dR);const I7=dR,L7=tc()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var PQ;let M6=PQ=class extends I7{constructor(t){super(t),this.type="bar-chart"}clone(){return new PQ({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:L7.write}})],M6.prototype,"type",void 0),M6=PQ=d([F("esri.popup.content.BarChartMediaInfo")],M6);const wIe=M6;var AQ;let R6=AQ=class extends I7{constructor(t){super(t),this.type="column-chart"}clone(){return new AQ({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:L7.write}})],R6.prototype,"type",void 0),R6=AQ=d([F("esri.popup.content.ColumnChartMediaInfo")],R6);const xIe=R6;var OQ;let pR=OQ=class extends Se{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new OQ({linkURL:this.linkURL,sourceURL:this.sourceURL})}};d([m({type:String,json:{write:!0}})],pR.prototype,"linkURL",void 0),d([m({type:String,json:{write:!0}})],pR.prototype,"sourceURL",void 0),pR=OQ=d([F("esri.popup.content.support.ImageMediaInfoValue")],pR);const Aut=pR;var MQ;let aC=MQ=class extends Goe{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new MQ({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};d([m({type:Number,json:{write:!0}})],aC.prototype,"refreshInterval",void 0),d([m({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],aC.prototype,"type",void 0),d([m({type:Aut,json:{write:!0}})],aC.prototype,"value",void 0),aC=MQ=d([F("esri.popup.content.ImageMediaInfo")],aC);const SIe=aC;var RQ;let $6=RQ=class extends I7{constructor(t){super(t),this.type="line-chart"}clone(){return new RQ({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:L7.write}})],$6.prototype,"type",void 0),$6=RQ=d([F("esri.popup.content.LineChartMediaInfo")],$6);const TIe=$6;var $Q;let I6=$Q=class extends I7{constructor(t){super(t),this.type="pie-chart"}clone(){return new $Q({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:L7.write}})],I6.prototype,"type",void 0),I6=$Q=d([F("esri.popup.content.PieChartMediaInfo")],I6);const EIe=I6,CIe={base:Goe,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":wIe,"column-chart":xIe,"line-chart":TIe,"pie-chart":EIe,image:SIe}};var IQ;let Zp=IQ=class extends dw{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?SIe.fromJSON(e):e.type==="barchart"?wIe.fromJSON(e):e.type==="columnchart"?xIe.fromJSON(e):e.type==="linechart"?TIe.fromJSON(e):e.type==="piechart"?EIe.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new IQ(ae({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};d([m()],Zp.prototype,"activeMediaInfoIndex",void 0),d([m({type:Object,json:{write:!0}})],Zp.prototype,"attributes",void 0),d([m({type:String,json:{write:!0}})],Zp.prototype,"description",void 0),d([m({types:[CIe]})],Zp.prototype,"mediaInfos",void 0),d([Xe("mediaInfos")],Zp.prototype,"readMediaInfos",null),d([nt("mediaInfos")],Zp.prototype,"writeMediaInfos",null),d([m({type:String,json:{write:!0}})],Zp.prototype,"title",void 0),d([m({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Zp.prototype,"type",void 0),Zp=IQ=d([F("esri.popup.content.MediaContent")],Zp);const i9=Zp;var LQ;let fR=LQ=class extends Se{constructor(t){super(t),this.field=null,this.order=null}clone(){return new LQ({field:this.field,order:this.order})}};d([m({type:String,json:{write:!0}})],fR.prototype,"field",void 0),d([m({type:["asc","desc"],json:{write:!0}})],fR.prototype,"order",void 0),fR=LQ=d([F("esri.popup.support.RelatedRecordsInfoFieldOrder")],fR);const PIe=fR;let ig=class extends ds(dw){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};d([m({type:String,json:{write:!0}})],ig.prototype,"description",void 0),d([m({type:Number,json:{type:Vi,write:!0}})],ig.prototype,"displayCount",void 0),d([m({type:["list"],json:{write:!0}})],ig.prototype,"displayType",void 0),d([m({type:[PIe],json:{write:!0}})],ig.prototype,"orderByFields",void 0),d([m({type:Number,json:{type:Vi,write:!0}})],ig.prototype,"relationshipId",void 0),d([m({type:String,json:{write:!0}})],ig.prototype,"title",void 0),d([m({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],ig.prototype,"type",void 0),ig=d([F("esri.popup.content.RelationshipContent")],ig);const n9=ig;var DQ;let mR=DQ=class extends dw{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new DQ({text:this.text})}};d([m({type:String,json:{write:!0}})],mR.prototype,"text",void 0),d([m({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],mR.prototype,"type",void 0),mR=DQ=d([F("esri.popup.content.TextContent")],mR);const s9=mR,Out={base:null,key:"type",typeMap:{attachment:aD,media:i9,text:s9,expression:Voe,field:lD,relationship:n9}};var NQ;let Px=NQ=class extends Se{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new NQ({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};d([m({type:String,json:{write:!0}})],Px.prototype,"name",void 0),d([m({type:String,json:{write:!0}})],Px.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],Px.prototype,"expression",void 0),d([m({type:["string","number"],json:{write:!0}})],Px.prototype,"returnType",void 0),Px=NQ=d([F("esri.popup.ExpressionInfo")],Px);const Mut=Px;var FQ;let gR=FQ=class extends Se{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new FQ({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};d([m({type:Boolean,json:{write:!0}})],gR.prototype,"returnTopmostRaster",void 0),d([m({type:Boolean,json:{write:!0}})],gR.prototype,"showNoDataRecords",void 0),gR=FQ=d([F("esri.popup.LayerOptions")],gR);const Rut=gR;var kQ;let yR=kQ=class extends Se{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new kQ({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ae(this.orderByFields):null})}};d([m({type:Boolean,json:{write:!0}})],yR.prototype,"showRelatedRecords",void 0),d([m({type:[PIe],json:{write:!0}})],yR.prototype,"orderByFields",void 0),yR=kQ=d([F("esri.popup.RelatedRecordsInfo")],yR);const $ut=yR;var UQ;let pd=UQ=class extends IB(Pe){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new UQ({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};d([m()],pd.prototype,"active",void 0),d([m()],pd.prototype,"className",void 0),d([m()],pd.prototype,"disabled",void 0),d([m()],pd.prototype,"icon",void 0),d([m()],pd.prototype,"id",void 0),d([m()],pd.prototype,"indicator",void 0),d([m()],pd.prototype,"title",void 0),d([m()],pd.prototype,"type",void 0),d([m()],pd.prototype,"visible",void 0),pd=UQ=d([F("esri.support.actions.ActionBase")],pd);const joe=pd;var zQ;let L6=zQ=class extends joe{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new zQ({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};d([m()],L6.prototype,"image",void 0),L6=zQ=d([F("esri.support.Action.ActionButton")],L6);const Iut=L6;var VQ;let _R=VQ=class extends joe{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new VQ({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};d([m()],_R.prototype,"image",void 0),d([m()],_R.prototype,"value",void 0),_R=VQ=d([F("esri.support.Action.ActionToggle")],_R);const Lut=_R,iM="relationships/",zme="expression/",Dut=St.ofType({key:"type",defaultKeyValue:"button",base:joe,typeMap:{button:Iut,toggle:Lut}}),Nut={base:dw,key:"type",typeMap:{media:i9,custom:Tut,text:s9,attachments:aD,fields:lD,expression:Voe,relationship:n9}},Fut=new Set(["attachments","fields","media","text","expression","relationship"]);let Qo=class extends ds(Se){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>sy(Nut,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Xu(e)?e:(K.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,r){const{popupElements:i}=r;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,i):this._readPopupInfo(r)}writeContent(e,r,i,n){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(s=>Fut.has(s.type)).map(s=>s==null?void 0:s.toJSON(n)),r.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(r):s.type==="media"?this._writeMediaContent(s,r):s.type==="text"?this._writeTextContent(s,r):s.type==="relationship"&&this._writeRelationshipContent(s,r)})):r.description=e}writeFieldInfos(e,r,i,n){const{content:s}=this,o=Array.isArray(s)?s:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var u;return(u=c.fieldInfos)==null?void 0:u.length});r.fieldInfos=e.filter(Boolean).map(c=>{const u=c.toJSON(n);return l&&(u.visible=!1),u})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,r)}writeLayerOptions(e,r,i,n){r[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(n)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...i,...this._getContentExpressionInfos(this.content,i)]),oD(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=ae(e.fieldInfos);Array.isArray(r.fieldInfos)?i.forEach(n=>{const s=r.fieldInfos.find(o=>o.fieldName.toLowerCase()===n.fieldName.toLowerCase());s?s.visible=!0:r.fieldInfos.push(n)}):r.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){var s,o;const i=((s=e.orderByFields)==null?void 0:s.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],n=[...((o=r.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...i];r.relatedRecordsInfo={showRelatedRecords:!0,...(n==null?void 0:n.length)&&{orderByFields:n}}}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=ae(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...i]:r.mediaInfos=i}_readPopupInfoElements(e,r,i){const n={description:!1,mediaInfos:!1};return i.map(s=>s.type==="media"?(s.mediaInfos||!r||n.mediaInfos||(s.mediaInfos=r,n.mediaInfos=!0),i9.fromJSON(s)):s.type==="text"?(s.text||!e||n.description||(s.text=e,n.description=!0),s9.fromJSON(s)):s.type==="attachments"?aD.fromJSON(s):s.type==="fields"?lD.fromJSON(s):s.type==="expression"?Voe.fromJSON(s):s.type==="relationship"?n9.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:r,order:i}=e;if(!(r!=null&&r.startsWith(iM)))return null;const n=r.replace(iM,"").split("/");if(n.length!==2)return null;const s=parseInt(n[0],10),o=n[1];return typeof s=="number"&&o?n9.fromJSON({relationshipId:s,orderByFields:[{field:o,order:i}]}):null}_toFieldOrderJSON(e,r){const{order:i,field:n}=e;return{field:`${iM}${r}/${n}`,order:i}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:i,relatedRecordsInfo:n={showRelatedRecords:!1}}){const s=[];e?s.push(new s9({text:e})):s.push(new lD),Array.isArray(r)&&r.length&&s.push(i9.fromJSON({mediaInfos:r})),i&&s.push(aD.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=n;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&s.push(c)}),s.length?s:e}_getContentElementFields(e){const r=e==null?void 0:e.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((n,s)=>[...n,...this._getMediaInfoFields(s)],[])]}return r==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:r,title:i,value:n}=e,s=n||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:u}=s,h=[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(c),...this._extractFieldNames(u),...o??[]];return a&&h.push(a),l&&h.push(l),h}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((i,n)=>[...i,...n.type==="expression"&&n.expressionInfo?[n.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,i)=>[...r,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,r,i){i&&await Promise.all(i.map(n=>Uc(e,r,n.expression)))}_getFieldInfoFields(e){return e?e.filter(r=>r.visible===void 0||!!r.visible).map(r=>r.fieldName).filter(r=>!r.startsWith(iM)&&!r.startsWith(zme)):[]}_getActionsFields(e){return e?e.toArray().reduce((r,i)=>[...r,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:r,title:i,type:n}=e,s=n==="button"||n==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const r=/{[^}]*}/g,i=e.match(r);if(!i)return[];const n=/\{(\w+):.+\}/,s=i.filter(o=>!(o.indexOf(`{${iM}`)===0||o.indexOf(`{${zme}`)===0)).map(o=>o.replace(n,"{$1}"));return s?s.map(o=>o.slice(1,-1)):[]}};d([m({type:Dut})],Qo.prototype,"actions",void 0),d([m()],Qo.prototype,"content",void 0),d([Dr("content")],Qo.prototype,"castContent",null),d([Xe("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],Qo.prototype,"readContent",null),d([nt("content",{popupElements:{type:St.ofType(Out)},showAttachments:{type:Boolean},mediaInfos:{type:St.ofType(CIe)},description:{type:String},relatedRecordsInfo:{type:$ut}})],Qo.prototype,"writeContent",null),d([m({type:[Mut],json:{write:!0}})],Qo.prototype,"expressionInfos",void 0),d([m({type:[Boe]})],Qo.prototype,"fieldInfos",void 0),d([nt("fieldInfos")],Qo.prototype,"writeFieldInfos",null),d([m({type:Rut})],Qo.prototype,"layerOptions",void 0),d([nt("layerOptions")],Qo.prototype,"writeLayerOptions",null),d([m({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Qo.prototype,"lastEditInfoEnabled",void 0),d([m()],Qo.prototype,"outFields",void 0),d([m()],Qo.prototype,"overwriteActions",void 0),d([m()],Qo.prototype,"returnGeometry",void 0),d([m({json:{type:String}})],Qo.prototype,"title",void 0),d([nt("title")],Qo.prototype,"writeTitle",null),Qo=d([F("esri.PopupTemplate")],Qo);const D7=Qo,Vme=new Ii({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let kut=0,lC=class extends Se{constructor(e){super(e),this.id="sym"+kut++,this.type=null,this.color=new De([0,0,0,1])}readColor(e){return(e==null?void 0:e[0])!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,r){}hash(){return JSON.stringify(this.toJSON())}clone(){}};d([m({type:Vme.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Vme.write}}})],lC.prototype,"type",void 0),d([m({type:De,json:{write:{allowNull:!0}}})],lC.prototype,"color",void 0),d([Xe("color")],lC.prototype,"readColor",null),lC=d([F("esri.symbols.Symbol")],lC);const Zu=lC;var BQ;let k1=BQ=class extends Zu{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){var r;if(((r=this.data)==null?void 0:r.type)==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const n=i.map(s=>{const o=s.valueExpressionInfo;return o?Uc(t,e,o.expression):null});await Promise.all(n)}}}clone(){return new BQ({data:ae(this.data)})}hash(){return hne(JSON.stringify(this.data)).toString()}};d([m({json:{write:!1}})],k1.prototype,"color",void 0),d([m({json:{write:!0}})],k1.prototype,"data",void 0),d([Xe("data",["symbol"])],k1.prototype,"readData",null),d([nt("data",{})],k1.prototype,"writeData",null),d([gt({CIMSymbolReference:"cim"},{readOnly:!0})],k1.prototype,"type",void 0),k1=BQ=d([F("esri.symbols.CIMSymbol")],k1);const SN=k1;let cC=class extends Se{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,r,i){e||(r[i]=e)}};d([m({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],cC.prototype,"enabled",void 0),d([nt("enabled")],cC.prototype,"writeEnabled",null),d([m({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],cC.prototype,"type",void 0),cC=d([F("esri.symbols.Symbol3DLayer")],cC);const vy=cC;function Uut(t,e){const r=e.transparency!=null?NP(e.transparency):1,i=e.color;return i&&Array.isArray(i)?new De([i[0]||0,i[1]||0,i[2]||0,r]):null}function zut(t,e){e.color=t.toJSON().slice(0,3);const r=Jne(t.a);r!==0&&(e.transparency=r)}const M_={type:De,json:{type:[Vi],default:null,read:{source:["color","transparency"],reader:Uut},write:{target:{color:{type:[Vi]},transparency:{type:Vi}},writer:zut}}},hy={type:Number,cast:gn,json:{write:!0}};let Ax=class extends Se{constructor(e){super(e),this.color=new De([0,0,0,1]),this.extensionLength=0,this.size=hl(1)}clone(){}cloneProperties(){return{color:ae(this.color),size:this.size,extensionLength:this.extensionLength}}};d([m({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Ax.prototype,"type",void 0),d([m(M_)],Ax.prototype,"color",void 0),d([m({...hy,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],Ax.prototype,"extensionLength",void 0),d([m(hy)],Ax.prototype,"size",void 0),Ax=d([F("esri.symbols.edges.Edges3D")],Ax);const Hoe=Ax;var GQ;let D6=GQ=class extends Hoe{constructor(t){super(t),this.type="sketch"}clone(){return new GQ(this.cloneProperties())}};d([gt({sketch:"sketch"},{readOnly:!0})],D6.prototype,"type",void 0),D6=GQ=d([F("esri.symbols.edges.SketchEdges3D")],D6);const Vut=D6;var jQ;let N6=jQ=class extends Hoe{constructor(t){super(t),this.type="solid"}clone(){return new jQ(this.cloneProperties())}};d([gt({solid:"solid"},{readOnly:!0})],N6.prototype,"type",void 0),N6=jQ=d([F("esri.symbols.support.SolidEdges3D")],N6);const But=N6,AIe={types:{key:"type",base:Hoe,typeMap:{solid:But,sketch:Vut}},json:{write:!0}};var HQ;let zh=HQ=class extends Se{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new HQ(t)}};d([m(M_)],zh.prototype,"color",void 0),zh=HQ=d([F("esri.symbols.support.Symbol3DMaterial")],zh);var qQ;let U1=qQ=class extends vy{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new qQ({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};d([gt({Extrude:"extrude"},{readOnly:!0})],U1.prototype,"type",void 0),d([m({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],U1.prototype,"size",void 0),d([m({type:zh,json:{write:!0}})],U1.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],U1.prototype,"castShadows",void 0),d([m(AIe)],U1.prototype,"edges",void 0),U1=qQ=d([F("esri.symbols.ExtrudeSymbol3DLayer")],U1);const OIe=U1;let vR=class extends Zu{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};d([gt({esriSLS:"simple-line"},{readOnly:!0})],vR.prototype,"type",void 0),d([m({type:Number,cast:gn,json:{write:!0}})],vR.prototype,"width",void 0),vR=d([F("esri.symbols.LineSymbol")],vR);const Gut=vR,jut=["begin","end","begin-end"],MIe=["arrow","circle","square","diamond","cross","x"];var WQ;let ng=WQ=class extends Se{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,r,i){e[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return(t==null?void 0:t[0])!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,r,i){(i==null?void 0:i.origin)==="web-map"||(e[r]=t)}clone(){return new WQ({color:ae(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};d([m({type:["begin","end","begin-end"],json:{write:!0}})],ng.prototype,"placement",void 0),d([gt({"line-marker":"line-marker"},{readOnly:!0}),m({json:{origins:{"web-map":{write:!1}}}})],ng.prototype,"type",void 0),d([m({type:MIe})],ng.prototype,"style",void 0),d([nt("style")],ng.prototype,"writeStyle",null),d([m({type:De,value:null,json:{write:{allowNull:!0}}})],ng.prototype,"color",null),d([Xe("color")],ng.prototype,"readColor",null),d([nt("color")],ng.prototype,"writeColor",null),ng=WQ=d([F("esri.symbols.LineSymbolMarker")],ng);const Hut=ng;var YQ;const mH=new Ii({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let e0=YQ=class extends Gut{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,r,i,n,s){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),r!=null&&(o.width=gn(r)),i!=null&&(o.cap=i),n!=null&&(o.join=n),s!=null&&(o.miterLimit=gn(s)),o}clone(){var t;return new YQ({color:ae(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};d([gt({esriSLS:"simple-line"},{readOnly:!0})],e0.prototype,"type",void 0),d([m({type:mH.apiValues,json:{read:mH.read,write:mH.write}})],e0.prototype,"style",void 0),d([m({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null?void 0:r.origin)==null})}}})],e0.prototype,"cap",void 0),d([m({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null?void 0:r.origin)==null})}}})],e0.prototype,"join",void 0),d([m({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":Hut}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],e0.prototype,"marker",void 0),d([m({type:Number,json:{read:!1,write:!1}})],e0.prototype,"miterLimit",void 0),e0=YQ=d([F("esri.symbols.SimpleLineSymbol")],e0);const vp=e0;let bR=class extends Zu{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};d([m({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":vp}},json:{default:null,write:!0}})],bR.prototype,"outline",void 0),d([m({type:["simple-fill","picture-fill"],readOnly:!0})],bR.prototype,"type",void 0),bR=d([F("esri.symbols.FillSymbol")],bR);const RIe=bR;let F6=class extends Se{constructor(e){super(e)}clone(){}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],F6.prototype,"type",void 0),F6=d([F("esri.symbols.patterns.LinePattern3D")],F6);const $Ie=F6,qut=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var XQ;const Wut=tc()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let wR=XQ=class extends $Ie{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new XQ(t)}};d([m({type:["style"]})],wR.prototype,"type",void 0),d([gt(Wut),m({type:qut})],wR.prototype,"style",void 0),wR=XQ=d([F("esri.symbols.patterns.LineStylePattern3D")],wR);const qoe=wR;let k6=class extends Se{constructor(e){super(e)}clone(){}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],k6.prototype,"type",void 0),k6=d([F("esri.symbols.patterns.Pattern3D")],k6);const IIe=k6,Yut=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var ZQ;let xR=ZQ=class extends IIe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new ZQ(t)}};d([m({type:["style"]})],xR.prototype,"type",void 0),d([m({type:Yut,json:{read:!0,write:!0}})],xR.prototype,"style",void 0),xR=ZQ=d([F("esri.symbols.patterns.StylePattern3D")],xR);const LIe=xR,Xut={types:{key:"type",base:IIe,typeMap:{style:LIe}},json:{write:!0}},DIe={types:{key:"type",base:$Ie,typeMap:{style:qoe}},json:{write:!0}},AI=new De("white");new De("black");const Zut=new De([255,255,255,0]);function Jut(t){return t.r===0&&t.g===0&&t.b===0}var JQ;let OI=JQ=class extends zh{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new JQ(t)}};d([gt({multiply:"multiply",replace:"replace",tint:"tint"})],OI.prototype,"colorMixMode",void 0),OI=JQ=d([F("esri.symbols.support.Symbol3DFillMaterial")],OI);function gH(t,{isPrimitive:e,width:r,depth:i,height:n}){const s=e?10:1;if(r==null&&n==null&&i==null)return[s*t[0],s*t[1],s*t[2]];const o=Ce(r,i,n);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const Qut=JT(-.5,-.5,-.5,.5,.5,.5),Kut=JT(-.5,-.5,0,.5,.5,1),eht=JT(-.5,-.5,0,.5,.5,.5);function tht(t){switch(t){case"sphere":case"cube":case"diamond":return Qut;case"cylinder":case"cone":case"inverted-cone":return Kut;case"tetrahedron":return eht;default:return}}const Woe=["butt","square","round"],rht=[...Woe,"none"],NIe=["miter","bevel","round"];var QQ;let Ox=QQ=class extends Se{constructor(t){super(t),this.color=new De([0,0,0,1]),this.size=hl(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new QQ(t)}};d([m(M_)],Ox.prototype,"color",void 0),d([m(hy)],Ox.prototype,"size",void 0),d([m(DIe)],Ox.prototype,"pattern",void 0),d([m({type:Woe,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],Ox.prototype,"patternCap",void 0),Ox=QQ=d([F("esri.symbols.support.Symbol3DOutline")],Ox);var U6;let t0=U6=class extends vy{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new U6(t)}static fromSimpleFillSymbol(t){var i,n,s;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new qoe({style:t.outline.style}):null,r={size:((i=t.outline)==null?void 0:i.width)??0,color:(((n=t.outline)==null?void 0:n.color)??AI).clone(),pattern:e};return e&&((s=t.outline)!=null&&s.cap)&&(r.patternCap=t.outline.cap),new U6({material:new OI({color:(t.color??Zut).clone()}),pattern:t.style&&t.style!=="solid"?new LIe({style:t.style}):null,outline:r})}};d([gt({Fill:"fill"},{readOnly:!0})],t0.prototype,"type",void 0),d([m({type:OI,json:{write:!0}})],t0.prototype,"material",void 0),d([m(Xut)],t0.prototype,"pattern",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],t0.prototype,"castShadows",void 0),d([m({type:Ox,json:{write:!0}})],t0.prototype,"outline",void 0),d([m(AIe)],t0.prototype,"edges",void 0),t0=U6=d([F("esri.symbols.FillSymbol3DLayer")],t0);const TN=t0,iht=["none","underline","line-through"],nht=["normal","italic","oblique"],sht=["normal","lighter","bold","bolder"],FIe={type:Number,cast:t=>{const e=Ld(t);return e===0?1:we(e,.1,4)},nonNullable:!0},oht=["left","right","center"],aht=["baseline","top","middle","bottom"],kIe={type:oht,nonNullable:!0},UIe={type:aht,nonNullable:!0},lht=8;var KQ;let r0=KQ=class extends Se{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return gn(t)}clone(){return new KQ({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};d([m({type:iht,json:{default:"none",write:!0}})],r0.prototype,"decoration",void 0),d([m({type:String,json:{write:!0}})],r0.prototype,"family",void 0),d([m({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.textSymbol3D})}}})],r0.prototype,"size",void 0),d([Dr("size")],r0.prototype,"castSize",null),d([m({type:nht,json:{default:"normal",write:!0}})],r0.prototype,"style",void 0),d([m({type:sht,json:{default:"normal",write:!0}})],r0.prototype,"weight",void 0),r0=KQ=d([F("esri.symbols.Font")],r0);const EN=r0;var eK;const cht=tc()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Mx=eK=class extends Se{constructor(t){super(t)}readHref(t,e,r){return t?a_(t,r):e.dataURI}writeHref(t,e,r,i){t&&(yy(t)?e.dataURI=t:(e.href=l_(t,i),Fu(e.href)&&(e.href=Xf(e.href))))}clone(){return new eK({href:this.href,primitive:this.primitive})}};d([m({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Mx.prototype,"href",void 0),d([Xe("href")],Mx.prototype,"readHref",null),d([nt("href",{href:{type:String},dataURI:{type:String}})],Mx.prototype,"writeHref",null),d([gt(cht)],Mx.prototype,"primitive",void 0),Mx=eK=d([F("esri.symbols.support.IconSymbol3DLayerResource")],Mx);const uht="circle";var tK;let JS=tK=class extends Pe{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new tK({x:this.x,y:this.y})}};d([m({type:Number})],JS.prototype,"x",void 0),d([m({type:Number})],JS.prototype,"y",void 0),JS=tK=d([F("esri.symbols.support.Symbol3DAnchorPosition2D")],JS);var rK;let SR=rK=class extends Se{constructor(t){super(t),this.color=new De([0,0,0,1]),this.size=hl(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new rK(t)}};d([m(M_)],SR.prototype,"color",void 0),d([m(hy)],SR.prototype,"size",void 0),SR=rK=d([F("esri.symbols.support.Symbol3DIconOutline")],SR);var uC;const zIe="esri.symbols.IconSymbol3DLayer";let sg=uC=class extends vy{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new uC({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||AI,r=Bme(t),i=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||AI).clone()}:null;return new uC({size:t.size,resource:{primitive:dht(t.style)},material:{color:e},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(t){const e=!t.color||Jut(t.color)?AI:t.color,r=Bme(t);return new uC({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(t){return new uC({resource:{href:GCe({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function Bme(t){const e="width"in t?t.width:t.size,r="height"in t?t.height:t.size,i=Gme(t.xoffset),n=Gme(t.yoffset);return(i||n)&&e&&r?{x:-i/e,y:n/r}:null}function Gme(t){return isFinite(t)?t:0}d([m({type:zh,json:{write:!0}})],sg.prototype,"material",void 0),d([m({type:Mx,json:{write:!0}})],sg.prototype,"resource",void 0),d([gt({Icon:"icon"},{readOnly:!0})],sg.prototype,"type",void 0),d([m(hy)],sg.prototype,"size",void 0),d([gt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),m({json:{default:"center"}})],sg.prototype,"anchor",void 0),d([m({type:JS,json:{type:[Number],read:{reader:t=>new JS({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],sg.prototype,"anchorPosition",void 0),d([m({type:SR,json:{write:!0}})],sg.prototype,"outline",void 0),sg=uC=d([F(zIe)],sg);const hht={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function dht(t){return hht[t]||(K.getLogger(zIe).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const Bv=sg;let Rx=class extends ds(Se){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Rx.prototype,"type",void 0),d([m({type:jut,json:{default:"begin-end",write:!0}})],Rx.prototype,"placement",void 0),d([m({type:MIe,json:{default:"arrow",write:!0}})],Rx.prototype,"style",void 0),d([m({type:De,json:{type:[Vi],default:null,write:!0}})],Rx.prototype,"color",void 0),Rx=d([F("esri.symbols.LineStyleMarker3D")],Rx);const iK=Rx;var z6;let og=z6=class extends vy{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=hl(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new z6(t)}static fromSimpleLineSymbol(t){var r;const e={enabled:!0,size:t.width??hl(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new qoe({style:t.style}):null,material:new zh({color:(t.color||AI).clone()}),marker:t.marker?new iK({placement:t.marker.placement,style:t.marker.style,color:((r=t.marker.color)==null?void 0:r.clone())??null}):null};return new z6(e)}};d([m({type:zh,json:{write:!0}})],og.prototype,"material",void 0),d([gt({Line:"line"},{readOnly:!0})],og.prototype,"type",void 0),d([m({type:NIe,json:{write:!0,default:"miter"}})],og.prototype,"join",void 0),d([m({type:Woe,json:{write:!0,default:"butt"}})],og.prototype,"cap",void 0),d([m(hy)],og.prototype,"size",void 0),d([m(DIe)],og.prototype,"pattern",void 0),d([m({types:{key:"type",base:iK,typeMap:{style:iK}},json:{write:!0}})],og.prototype,"marker",void 0),og=z6=d([F("esri.symbols.LineSymbol3DLayer")],og);const CN=og;var nK;const pht=tc()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let TR=nK=class extends Se{clone(){return new nK({href:this.href,primitive:this.primitive})}};d([m({type:String,json:{read:gB,write:xb}})],TR.prototype,"href",void 0),d([gt(pht)],TR.prototype,"primitive",void 0),TR=nK=d([F("esri.symbols.support.ObjectSymbol3DLayerResource")],TR);const VIe="sphere";var sK;let wS=sK=class extends Pe{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new sK({x:this.x,y:this.y,z:this.z})}};d([m({type:Number})],wS.prototype,"x",void 0),d([m({type:Number})],wS.prototype,"y",void 0),d([m({type:Number})],wS.prototype,"z",void 0),wS=sK=d([F("esri.symbols.support.Symbol3DAnchorPosition3D")],wS);var oK;let $l=oK=class extends vy{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){var t,e,r;return new oK({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:(t=this.anchorPosition)==null?void 0:t.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:((e=this.material)==null?void 0:e.clone())??null,castShadows:this.castShadows,resource:(r=this.resource)==null?void 0:r.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};d([m({type:zh,json:{write:!0}})],$l.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],$l.prototype,"castShadows",void 0),d([m({type:TR,json:{write:!0}})],$l.prototype,"resource",void 0),d([gt({Object:"object"},{readOnly:!0})],$l.prototype,"type",void 0),d([m({type:Number,json:{write:!0}})],$l.prototype,"width",void 0),d([m({type:Number,json:{write:!0}})],$l.prototype,"height",void 0),d([m({type:Number,json:{write:!0}})],$l.prototype,"depth",void 0),d([gt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),m({json:{default:"origin"}})],$l.prototype,"anchor",void 0),d([m({type:wS,json:{type:[Number],read:{reader:t=>new wS({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],$l.prototype,"anchorPosition",void 0),d([m({type:Number,json:{write:!0}})],$l.prototype,"heading",void 0),d([m({type:Number,json:{write:!0}})],$l.prototype,"tilt",void 0),d([m({type:Number,json:{write:!0}})],$l.prototype,"roll",void 0),d([m({readOnly:!0})],$l.prototype,"isPrimitive",null),$l=oK=d([F("esri.symbols.ObjectSymbol3DLayer")],$l);const Yoe=$l;var aK;let gc=aK=class extends vy{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new aK({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};d([m({type:zh,json:{write:!0}})],gc.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],gc.prototype,"castShadows",void 0),d([gt({Path:"path"},{readOnly:!0})],gc.prototype,"type",void 0),d([m({type:["circle","quad"],json:{write:!0,default:"circle"}})],gc.prototype,"profile",void 0),d([m({type:NIe,json:{write:!0,default:"miter"}})],gc.prototype,"join",void 0),d([m({type:rht,json:{write:!0,default:"butt"}})],gc.prototype,"cap",void 0),d([m({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],gc.prototype,"width",void 0),d([Xe("width",["width","size","height"])],gc.prototype,"readWidth",null),d([m({type:Number,json:{write:!0}})],gc.prototype,"height",void 0),d([Xe("height",["height","size","width"])],gc.prototype,"readHeight",null),d([m({type:["center","bottom","top"],json:{write:!0,default:"center"}})],gc.prototype,"anchor",void 0),d([m({type:["heading","all"],json:{write:!0,default:"all"}})],gc.prototype,"profileRotation",void 0),gc=aK=d([F("esri.symbols.PathSymbol3DLayer")],gc);const Xoe=gc;var lK;let o3=lK=class extends Se{constructor(){super(...arguments),this.color=new De([0,0,0,1]),this.size=0}clone(){const t={color:ae(this.color),size:this.size};return new lK(t)}};d([m(M_)],o3.prototype,"color",void 0),d([m(hy)],o3.prototype,"size",void 0),o3=lK=d([F("esri.symbols.support.Symbol3DHalo")],o3);let MI=class extends ds(Se){constructor(e){super(e),this.color=null}};d([m(M_)],MI.prototype,"color",void 0),MI=d([F("esri.symbols.support.Symbol3DTextBackground")],MI);var V6;let eu=V6=class extends vy{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,r,i){const n={...i,textSymbol3D:!0};e.font=t.write({},n),delete e.font.size}get size(){var t;return this._userSize!=null?this._userSize:((t=this.font)==null?void 0:t.size)!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new V6({enabled:this.enabled,font:this.font&&ae(this.font),halo:this.halo&&ae(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ae(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new V6({font:t.font!=null?t.font.clone():new EN,halo:fht(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new zh({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new MI({color:t.backgroundColor.clone()}):null})}};function fht(t,e){return t&&e!=null&&e>0?new o3({color:ae(t),size:e}):null}d([m({type:EN,json:{write:!0}})],eu.prototype,"font",null),d([nt("font")],eu.prototype,"writeFont",null),d([m({type:o3,json:{write:!0}})],eu.prototype,"halo",void 0),d([m({...kIe,json:{default:"center",write:!0}})],eu.prototype,"horizontalAlignment",void 0),d([m({...FIe,json:{default:1,write:!0}})],eu.prototype,"lineHeight",void 0),d([m({type:zh,json:{write:!0}})],eu.prototype,"material",void 0),d([m({type:MI,json:{write:!0}})],eu.prototype,"background",void 0),d([m(hy)],eu.prototype,"size",null),d([m({type:String,json:{write:!0}})],eu.prototype,"text",void 0),d([gt({Text:"text"},{readOnly:!0})],eu.prototype,"type",void 0),d([m({...UIe,json:{default:"baseline",write:!0}})],eu.prototype,"verticalAlignment",void 0),eu=V6=d([F("esri.symbols.TextSymbol3DLayer")],eu);const A2=eu;var cK;let z1=cK=class extends vy{constructor(t){super(t),this.color=uK.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new cK({color:ae(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};d([m({type:De,nonNullable:!0,json:{type:[Vi],write:(t,e,r)=>e[r]=t.toArray(De.AlphaMode.UNLESS_OPAQUE),default:()=>uK.clone(),defaultEquals:t=>t.toCss(!0)===uK.toCss(!0)}})],z1.prototype,"color",void 0),d([gt({Water:"water"},{readOnly:!0})],z1.prototype,"type",void 0),d([m({type:["small","medium","large"],json:{write:!0,default:"medium"}})],z1.prototype,"waterbodySize",void 0),d([m({type:Number,json:{write:!0,default:null}})],z1.prototype,"waveDirection",void 0),d([m({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],z1.prototype,"waveStrength",void 0),z1=cK=d([F("esri.symbols.WaterSymbol3DLayer")],z1);const uK=new De([0,119,190]),BIe=z1;var hK;let $x=hK=class extends Pe{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new hK({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};d([m({type:String})],$x.prototype,"name",void 0),d([m({type:String})],$x.prototype,"styleUrl",void 0),d([m({type:String})],$x.prototype,"styleName",void 0),d([m({type:Ho})],$x.prototype,"portal",void 0),$x=hK=d([F("esri.symbols.support.StyleOrigin")],$x);const cD=$x;var dK;let yT=dK=class extends Pe{constructor(){super(...arguments),this.url=""}clone(){return new dK({url:this.url})}};d([m({type:String})],yT.prototype,"url",void 0),yT=dK=d([F("esri.symbols.support.Thumbnail")],yT);const GIe={icon:Bv,object:Yoe,line:CN,path:Xoe,fill:TN,extrude:OIe,text:A2,water:BIe},mht=St.ofType({base:vy,key:"type",typeMap:GIe,errorContext:"symbol-layer"});let ag=class extends Zu{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const r=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,i=r==null?void 0:r.type,n=i||St;this._set("symbolLayers",new n)}get color(){return null}set color(e){this.constructed&&K.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){kT(e,this._get("symbolLayers"))}readStyleOrigin(e,r,i){if(e.styleUrl&&e.name){const n=a_(e.styleUrl,i);return new cD({styleUrl:n,name:e.name})}if(e.styleName&&e.name)return new cD({portal:(i==null?void 0:i.portal)||Ho.getDefault(),styleName:e.styleName,name:e.name});i!=null&&i.messages&&i.messages.push(new sp("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,r,i,n){if(e.styleUrl&&e.name){let s=l_(e.styleUrl,n);Fu(s)&&(s=Xf(s)),r.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&(n!=null&&n.portal)&&!VCe(e.portal.restUrl,n.portal.restUrl)?n!=null&&n.messages&&n.messages.push(new sp("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):r.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof vy||e&&GIe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};d([m({json:{read:!1,write:!1}})],ag.prototype,"color",null),d([m({type:mht,nonNullable:!0,json:{write:!0}}),Dr(i3e)],ag.prototype,"symbolLayers",null),d([m({type:cD})],ag.prototype,"styleOrigin",void 0),d([Xe("styleOrigin")],ag.prototype,"readStyleOrigin",null),d([nt("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],ag.prototype,"writeStyleOrigin",null),d([m({type:yT,json:{read:!1}})],ag.prototype,"thumbnail",void 0),d([m({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],ag.prototype,"type",void 0),ag=d([F("esri.symbols.Symbol3D")],ag);const eO=ag;let ER=class extends Se{constructor(e){super(e),this.visible=!0}clone(){}};d([m({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],ER.prototype,"type",void 0),d([m({readOnly:!0})],ER.prototype,"visible",void 0),ER=d([F("esri.symbols.callouts.Callout3D")],ER);const jIe=ER;var pK;let B6=pK=class extends Se{constructor(t){super(t),this.color=new De("white")}clone(){return new pK({color:ae(this.color)})}};d([m(M_)],B6.prototype,"color",void 0),B6=pK=d([F("esri.symbols.callouts.LineCallout3DBorder")],B6);const ght=B6;var fK;let V1=fK=class extends jIe{constructor(t){super(t),this.type="line",this.color=new De([0,0,0,1]),this.size=hl(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new fK({color:ae(this.color),size:this.size,border:ae(this.border)})}};d([gt({line:"line"})],V1.prototype,"type",void 0),d([m(M_)],V1.prototype,"color",void 0),d([m(hy)],V1.prototype,"size",void 0),d([m({type:ght,json:{write:!0}})],V1.prototype,"border",void 0),d([m({readOnly:!0})],V1.prototype,"visible",null),V1=fK=d([F("esri.symbols.callouts.LineCallout3D")],V1);const HIe=V1;function Zoe(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function qIe(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!Zoe(t)}function Joe(t){return t.type==="point-3d"||t.type==="label-3d"}function WIe(t){return t.horizontalAlignment==="center"}const YIe={types:{key:"type",base:jIe,typeMap:{line:HIe}},json:{write:!0}};var mK;let hC=mK=class extends Se{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new mK({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};d([m(hy)],hC.prototype,"screenLength",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0,default:0}})],hC.prototype,"minWorldLength",void 0),d([m({type:Number,json:{write:!0}})],hC.prototype,"maxWorldLength",void 0),hC=mK=d([F("esri.symbols.support.Symbol3DVerticalOffset")],hC);const Qoe=hC;var G6;const XIe=St.ofType({base:null,key:"type",typeMap:{text:A2}});let B1=G6=class extends eO{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new XIe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return qIe(this)}hasVisibleVerticalOffset(){return Zoe(this)}clone(){return new G6({styleOrigin:ae(this.styleOrigin),symbolLayers:ae(this.symbolLayers),thumbnail:ae(this.thumbnail),callout:ae(this.callout),verticalOffset:ae(this.verticalOffset)})}static fromTextSymbol(t){return new G6({symbolLayers:new St([A2.fromTextSymbol(t)])})}};d([m({type:Qoe,json:{write:!0}})],B1.prototype,"verticalOffset",void 0),d([m(YIe)],B1.prototype,"callout",void 0),d([m({json:{read:!1,write:!1}})],B1.prototype,"styleOrigin",void 0),d([m({type:XIe})],B1.prototype,"symbolLayers",void 0),d([gt({LabelSymbol3D:"label-3d"},{readOnly:!0})],B1.prototype,"type",void 0),B1=G6=d([F("esri.symbols.LabelSymbol3D")],B1);const N7=B1;var j6;const ZIe=St.ofType({base:null,key:"type",typeMap:{line:CN,path:Xoe}}),yht=St.ofType({base:null,key:"type",typeMap:{line:CN,path:Xoe}});let CR=j6=class extends eO{constructor(t){super(t),this.symbolLayers=new ZIe,this.type="line-3d"}clone(){return new j6({styleOrigin:ae(this.styleOrigin),symbolLayers:ae(this.symbolLayers),thumbnail:ae(this.thumbnail)})}static fromSimpleLineSymbol(t){return new j6({symbolLayers:new St([CN.fromSimpleLineSymbol(t)])})}};d([m({type:ZIe,json:{type:yht}})],CR.prototype,"symbolLayers",void 0),d([gt({LineSymbol3D:"line-3d"},{readOnly:!0})],CR.prototype,"type",void 0),CR=j6=d([F("esri.symbols.LineSymbol3D")],CR);const F7=CR;let G1=class extends Zu{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};d([m({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],G1.prototype,"angle",void 0),d([m({type:["simple-marker","picture-marker"],readOnly:!0})],G1.prototype,"type",void 0),d([m({type:Number,cast:gn,json:{write:!0}})],G1.prototype,"xoffset",void 0),d([m({type:Number,cast:gn,json:{write:!0}})],G1.prototype,"yoffset",void 0),d([m({type:Number,cast:t=>t==="auto"?t:gn(t),json:{write:!0}})],G1.prototype,"size",void 0),G1=d([F("esri.symbols.MarkerSymbol")],G1);const JIe=G1;var H6;const QIe=St.ofType({base:null,key:"type",typeMap:{fill:TN}});let PR=H6=class extends eO{constructor(t){super(t),this.symbolLayers=new QIe,this.type="mesh-3d"}clone(){return new H6({styleOrigin:ae(this.styleOrigin),symbolLayers:ae(this.symbolLayers),thumbnail:ae(this.thumbnail)})}static fromSimpleFillSymbol(t){return new H6({symbolLayers:new St([TN.fromSimpleFillSymbol(t)])})}};d([m({type:QIe})],PR.prototype,"symbolLayers",void 0),d([gt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],PR.prototype,"type",void 0),PR=H6=d([F("esri.symbols.MeshSymbol3D")],PR);const k7=PR;function _ht(t,e,r){return e.imageData?GCe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):KIe(e.url,r)}function KIe(t,e){if(!Fu(t)){const r=bht(e);if(r)return Nc(r,"images",t)}return a_(t,e)}function vht(t,e,r,i){if(yy(t)){const n=bb(t);if(!n)return;e.contentType=n.mediaType,e.imageData=n.data,r&&r.imageData===e.imageData&&r.url&&xb(r.url,e,"url",i)}else xb(t,e,"url",i)}const eLe={json:{read:{source:["imageData","url"],reader:_ht},write:{writer(t,e,r,i){vht(t,e,this.source,i)}}}},tLe={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,r){const i={};return e.imageData&&(i.imageData=e.imageData),e.contentType&&(i.contentType=e.contentType),e.url&&(i.url=KIe(e.url,r)),i}}}};function bht(t){var n,s;if(!t)return null;const{origin:e,layer:r}=t;if(e!=="service"&&e!=="portal-item")return null;const i=r==null?void 0:r.type;return i==="feature"||i==="stream"?(n=r.parsedUrl)==null?void 0:n.path:i==="map-image"||i==="tile"?(s=t.url)==null?void 0:s.path:null}var gK;let fd=gK=class extends RIe{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const n={};return t&&(n.url=t),e&&(n.outline=e),r!=null&&(n.width=gn(r)),i!=null&&(n.height=gn(i)),n}clone(){const t=new gK({color:ae(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",ae(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};d([gt({esriPFS:"picture-fill"},{readOnly:!0})],fd.prototype,"type",void 0),d([m(eLe)],fd.prototype,"url",void 0),d([m({type:Number,json:{write:!0}})],fd.prototype,"xscale",void 0),d([m({type:Number,json:{write:!0}})],fd.prototype,"yscale",void 0),d([m({type:Number,cast:gn,json:{write:!0}})],fd.prototype,"width",void 0),d([m({type:Number,cast:gn,json:{write:!0}})],fd.prototype,"height",void 0),d([m({type:Number,cast:gn,json:{write:!0}})],fd.prototype,"xoffset",void 0),d([m({type:Number,cast:gn,json:{write:!0}})],fd.prototype,"yoffset",void 0),d([m(tLe)],fd.prototype,"source",void 0),fd=gK=d([F("esri.symbols.PictureFillSymbol")],fd);const rLe=fd;var yK;let Jp=yK=class extends JIe{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const i={};return t&&(i.url=t),e!=null&&(i.width=gn(e)),r!=null&&(i.height=gn(r)),i}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new yK({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",ae(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};d([m({json:{write:!1}})],Jp.prototype,"color",void 0),d([gt({esriPMS:"picture-marker"},{readOnly:!0})],Jp.prototype,"type",void 0),d([m(eLe)],Jp.prototype,"url",void 0),d([m(tLe)],Jp.prototype,"source",void 0),d([m({type:Number,cast:gn,json:{write:!0}})],Jp.prototype,"height",void 0),d([Xe("height",["height","size"])],Jp.prototype,"readHeight",null),d([m({type:Number,cast:gn,json:{write:!0}})],Jp.prototype,"width",void 0),d([m({json:{write:!1}})],Jp.prototype,"size",void 0),Jp=yK=d([F("esri.symbols.PictureMarkerSymbol")],Jp);const U7=Jp;var Ix;const iLe=St.ofType({base:null,key:"type",typeMap:{icon:Bv,object:Yoe,text:A2}});let Lx=Ix=class extends eO{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new iLe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return qIe(this)}hasVisibleVerticalOffset(){return Zoe(this)}clone(){return new Ix({verticalOffset:ae(this.verticalOffset),callout:ae(this.callout),styleOrigin:ae(this.styleOrigin),symbolLayers:ae(this.symbolLayers),thumbnail:ae(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new Ix({symbolLayers:new St([Bv.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new Ix({symbolLayers:new St([Bv.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){var i,n;if(((n=(i=t.data)==null?void 0:i.symbol)==null?void 0:n.type)!=="CIMPointSymbol")return null;const r=t.data.symbol;return new Ix(r!=null&&r.callout?{symbolLayers:new St([Bv.fromCIMSymbol(t)]),callout:new HIe({size:.5,color:new De([0,0,0])}),verticalOffset:new Qoe({screenLength:40})}:{symbolLayers:new St([Bv.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new Ix({symbolLayers:new St([A2.fromTextSymbol(t)])})}};d([m({type:Qoe,json:{write:!0}})],Lx.prototype,"verticalOffset",void 0),d([m(YIe)],Lx.prototype,"callout",void 0),d([m({type:iLe,json:{origins:{"web-scene":{write:!0}}}})],Lx.prototype,"symbolLayers",void 0),d([gt({PointSymbol3D:"point-3d"},{readOnly:!0})],Lx.prototype,"type",void 0),Lx=Ix=d([F("esri.symbols.PointSymbol3D")],Lx);const Gv=Lx;var AR;const nLe=St.ofType({base:null,key:"type",typeMap:{extrude:OIe,fill:TN,icon:Bv,line:CN,object:Yoe,text:A2,water:BIe}});let OR=AR=class extends eO{constructor(t){super(t),this.symbolLayers=new nLe,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&yb(K.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&yb(K.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(jo(()=>this.symbolLayers,"after-add",({item:e})=>t(e),ei))}clone(){return new AR({styleOrigin:ae(this.styleOrigin),symbolLayers:ae(this.symbolLayers),thumbnail:ae(this.thumbnail)})}static fromJSON(t){var r;const e=new AR;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const i=e.symbolLayers.at(0),n=e.symbolLayers.at(1);!n.enabled||(r=t.symbolLayers)!=null&&r[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:n.size,color:n.material!=null?n.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new AR({symbolLayers:new St([TN.fromSimpleFillSymbol(t)])})}};d([m({type:nLe,json:{write:!0}})],OR.prototype,"symbolLayers",void 0),d([gt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],OR.prototype,"type",void 0),OR=AR=d([F("esri.symbols.PolygonSymbol3D")],OR);const PN=OR;var _K;const yH=new Ii({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Dx=_K=class extends RIe{constructor(...t){super(...t),this.color=new De([0,0,0,.25]),this.outline=new vp,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.style=t),e&&(i.outline=e),r&&(i.color=r),i}clone(){return new _K({color:ae(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};d([m()],Dx.prototype,"color",void 0),d([m()],Dx.prototype,"outline",void 0),d([gt({esriSFS:"simple-fill"},{readOnly:!0})],Dx.prototype,"type",void 0),d([m({type:yH.apiValues,json:{read:yH.read,write:yH.write}})],Dx.prototype,"style",void 0),Dx=_K=d([F("esri.symbols.SimpleFillSymbol")],Dx);const O2=Dx;var vK;const _H=new Ii({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let lg=vK=class extends JIe{constructor(...t){super(...t),this.color=new De([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new vp}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string")return t;const n={};return t&&(n.style=t),e!=null&&(n.size=gn(e)),r&&(n.outline=r),i&&(n.color=i),n}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new vK({angle:this.angle,color:ae(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};d([m()],lg.prototype,"color",void 0),d([nt("color")],lg.prototype,"writeColor",null),d([gt({esriSMS:"simple-marker"},{readOnly:!0})],lg.prototype,"type",void 0),d([m()],lg.prototype,"size",void 0),d([m({type:_H.apiValues,json:{read:_H.read,write:_H.write}})],lg.prototype,"style",void 0),d([m({type:String,json:{write:!0}})],lg.prototype,"path",null),d([m({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":vp}},json:{default:null,write:!0}})],lg.prototype,"outline",void 0),lg=vK=d([F("esri.symbols.SimpleMarkerSymbol")],lg);const pw=lg;var bK;let Qn=bK=class extends Zu{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new EN,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.text=t),e&&(i.font=e),r&&(i.color=r),i}writeLineWidth(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}castLineWidth(t){return gn(t)}writeLineHeight(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}clone(){return new bK({angle:this.angle,backgroundColor:ae(this.backgroundColor),borderLineColor:ae(this.borderLineColor),borderLineSize:this.borderLineSize,color:ae(this.color),font:this.font&&this.font.clone(),haloColor:ae(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t,e,r;return`${(t=this.backgroundColor)==null?void 0:t.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(e=this.color)==null?void 0:e.hash()}.${this.font&&this.font.hash()}.${(r=this.haloColor)==null?void 0:r.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};d([m({type:De,json:{write:!0}})],Qn.prototype,"backgroundColor",void 0),d([m({type:De,json:{write:!0}})],Qn.prototype,"borderLineColor",void 0),d([m({type:Number,json:{write:!0},cast:gn})],Qn.prototype,"borderLineSize",void 0),d([m({type:EN,json:{write:!0}})],Qn.prototype,"font",void 0),d([m({...kIe,json:{write:!0}})],Qn.prototype,"horizontalAlignment",void 0),d([m({type:Boolean,json:{write:!0}})],Qn.prototype,"kerning",void 0),d([m({type:De,json:{write:!0}})],Qn.prototype,"haloColor",void 0),d([m({type:Number,cast:gn,json:{write:!0}})],Qn.prototype,"haloSize",void 0),d([m({type:Boolean,json:{write:!0}})],Qn.prototype,"rightToLeft",void 0),d([m({type:Boolean,json:{write:!0}})],Qn.prototype,"rotated",void 0),d([m({type:String,json:{write:!0}})],Qn.prototype,"text",void 0),d([gt({esriTS:"text"},{readOnly:!0})],Qn.prototype,"type",void 0),d([m({...UIe,json:{write:!0}})],Qn.prototype,"verticalAlignment",void 0),d([m({type:Number,cast:gn,json:{write:!0}})],Qn.prototype,"xoffset",void 0),d([m({type:Number,cast:gn,json:{write:!0}})],Qn.prototype,"yoffset",void 0),d([m({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Qn.prototype,"angle",void 0),d([m({type:Number,json:{write:!0}})],Qn.prototype,"width",void 0),d([m({type:Number})],Qn.prototype,"lineWidth",void 0),d([nt("lineWidth")],Qn.prototype,"writeLineWidth",null),d([Dr("lineWidth")],Qn.prototype,"castLineWidth",null),d([m(FIe)],Qn.prototype,"lineHeight",void 0),d([nt("lineHeight")],Qn.prototype,"writeLineHeight",null),Qn=bK=d([F("esri.symbols.TextSymbol")],Qn);const tO=Qn;var wK;let Qp=wK=class extends Zu{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:Ho.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new wK({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const r=e!=null?e.cache:null,i=r?this._fetchCacheKey:null;if(r!=null){const a=i&&r.get(i);if(a)return a.clone()}const{resolveWebStyleSymbol:n}=await re(()=>Promise.resolve().then(()=>BAt),void 0);dt(e);const s=n(this,{portal:this.portal},t,e);s.catch(a=>{K.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await s;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(r!=null&&r.set(i,o.clone()),o):null}};d([m({json:{write:!1}})],Qp.prototype,"color",void 0),d([m({type:String,json:{write:!0}})],Qp.prototype,"styleName",void 0),d([m({type:Ho,json:{write:!1}})],Qp.prototype,"portal",void 0),d([m({type:String,json:{read:gB,write:xb}})],Qp.prototype,"styleUrl",void 0),d([m({type:yT,json:{read:!1}})],Qp.prototype,"thumbnail",void 0),d([m({type:String,json:{write:!0}})],Qp.prototype,"name",void 0),d([gt({styleSymbolReference:"web-style"},{readOnly:!0})],Qp.prototype,"type",void 0),d([m()],Qp.prototype,"_fetchCacheKey",null),Qp=wK=d([F("esri.symbols.WebStyleSymbol")],Qp);const M2=Qp;function z7(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function zb(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const Q3={base:Zu,key:"type",typeMap:{"simple-fill":O2,"picture-fill":rLe,"picture-marker":U7,"simple-line":vp,"simple-marker":pw,text:tO,"label-3d":N7,"line-3d":F7,"mesh-3d":k7,"point-3d":Gv,"polygon-3d":PN,"web-style":M2,cim:SN},errorContext:"symbol"},HXt={base:Zu,key:"type",typeMap:{"picture-marker":U7,"simple-marker":pw,text:tO,"web-style":M2,cim:SN},errorContext:"symbol"},wht=FA({types:Q3}),sLe={base:Zu,key:"type",typeMap:{"simple-fill":O2,"picture-fill":rLe,"picture-marker":U7,"simple-line":vp,"simple-marker":pw,text:tO,"line-3d":F7,"mesh-3d":k7,"point-3d":Gv,"polygon-3d":PN,"web-style":M2,cim:SN},errorContext:"symbol"},xht={base:Zu,key:"type",typeMap:{text:tO,"label-3d":N7},errorContext:"symbol"},jme={base:Zu,key:"type",typeMap:{"line-3d":F7,"mesh-3d":k7,"point-3d":Gv,"polygon-3d":PN,"web-style":M2,cim:SN},errorContext:"symbol"},Sht={base:Zu,key:"type",typeMap:{"label-3d":N7},errorContext:"symbol"},oLe=sy(Q3);var xK;function Tht(t){if(!t)return null;const e={};for(const r in t){const i=Sb(t[r]);i&&(e[r]=i)}return Object.keys(e).length!==0?e:null}function Eht(t){if(t==null)return null;const e={};for(const r in t){const i=t[r];i&&(e[r]=i.toJSON())}return Object.keys(e).length!==0?e:null}let yc=xK=class extends ds(Se){constructor(...t){super(...t),this.isAggregate=!1,this.layer=null,this.origin=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Dh(),configurable:!0})}normalizeCtorArgs(t,e,r,i){return t&&!t.declaredClass?t:{geometry:t,symbol:e,attributes:r,popupTemplate:i}}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new xK({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;const e=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const r of[e,this.sourceLayer,this.layer])if(r){if("popupTemplate"in r&&r.popupTemplate)return r.popupTemplate;if(t&&"defaultPopupTemplate"in r&&r.defaultPopupTemplate!=null)return r.defaultPopupTemplate}return null}getAttribute(t){var e;return(e=this.attributes)==null?void 0:e[t]}setAttribute(t,e){if(this.attributes){const r=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",r,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){var t;return{aggregateGeometries:Eht(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:iz(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:((t=this.popupTemplate)==null?void 0:t.toJSON())??null}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if((e==null?void 0:e.type)==="mesh"){const r={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",r,r,t.action)}}_notifyLayer(t,e,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:t,oldValue:e,newValue:r};t==="origin-transform"&&(n.action=i),t==="attributes"&&(n.attributeName=i),this.layer.graphicChanged(n)}};d([m({value:null,json:{read:Tht}})],yc.prototype,"aggregateGeometries",null),d([m({value:null})],yc.prototype,"attributes",null),d([m({value:null,types:cN,json:{read:Sb}})],yc.prototype,"geometry",null),d([m({type:Boolean})],yc.prototype,"isAggregate",void 0),d([m({clonable:"reference"})],yc.prototype,"layer",void 0),d([m({clonable:"reference"})],yc.prototype,"origin",void 0),d([m({type:D7})],yc.prototype,"popupTemplate",void 0),d([m({clonable:"reference"})],yc.prototype,"sourceLayer",void 0),d([m({value:null,types:Q3})],yc.prototype,"symbol",null),d([m({type:Boolean,value:!0})],yc.prototype,"visible",null),yc=xK=d([F("esri.Graphic")],yc),function(t){t.generateUID=Dh}(yc||(yc={}));const Hu=yc;let _T=class extends TI{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};d([t3e({Type:Hu,ensureType:to(Hu)})],_T.prototype,"itemType",void 0),_T=d([F("esri.support.GraphicsCollection")],_T);let j1=class extends Pe{constructor(e){super(e),this.view=null,this.baseLayerViews=new St,this.referenceLayerViews=new St,this._loadingHandle=pe(()=>{var r,i;return(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap},r=>{r&&r.load().catch(()=>{})},mi)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var r,i;if(this.view&&this.view.suspended)return!1;const e=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(n=>n.updating)||this.referenceLayerViews.some(n=>n.updating))}};d([m({constructOnly:!0})],j1.prototype,"view",void 0),d([m({readOnly:!0})],j1.prototype,"baseLayerViews",void 0),d([m({readOnly:!0})],j1.prototype,"referenceLayerViews",void 0),d([m({readOnly:!0})],j1.prototype,"suspended",null),d([m({type:Boolean,readOnly:!0})],j1.prototype,"updating",null),j1=d([F("esri.views.BasemapView")],j1);function Cht(t){return"tryRecycleWith"in t}let Pht=class{constructor(e,r,i){this.layer=e,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=ma(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,la(this._controller.signal,()=>{const n=new B("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(n)})}tryRecycle(e){if(!this.done||!this.layerView||!Cht(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let n=0;n<e.length;n++){const s=e[n];if(s.type!==r)continue;const o=this.layerView.tryRecycleWith(s,{signal:i});if(o){e.splice(n,1),this.layer=s;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(dt(this._controller.signal),s.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),s.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>la(this._controller.signal,()=>u(gr())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:r,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var n,s;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:i}=this;this._map=i.map;try{let o,a;if(await r.load({signal:e}),r.prefetchResources&&await r.prefetchResources({signal:e}),Oht(r))o=await r.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new B("layer:view-not-supported","No layerview implementation was found");const u=await this.layerViewImporter.importLayerView(r);dt(e),o="default"in u?new u.default({layer:r,view:i}):new u({layer:r,view:i})}const l=()=>{a=Pi(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=la(e,l),dt(e);try{await o.when()}catch(u){throw l(),u}if(!((s=(n=this._map)==null?void 0:n.allLayers)==null?void 0:s.includes(r)))return l(),void this._deferred.reject(new B("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=o,r.emit("layerview-create",{view:i,layerView:o}),i.emit("layerview-create",{layer:r,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){r.emit("layerview-create-error",{view:i,error:o}),i.emit("layerview-create-error",{layer:r,error:o}),this.done=!0,this._deferred.reject(new B("layerview:create-error","layerview creation failed",{layer:r,error:o}))}}},md=class extends Pe{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new em,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const r=(i=this.view.map)==null?void 0:i.allLayers;if(r)for(const n of r)this.layerViewImporter.hasLayerViewModule(n)&&this.layerViewImporter.importLayerView(n)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=ma(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(m2(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,u;if(this.destroyed)return;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,n=[],s=this.view.ready,o=h=>{if(h!=null){for(const p of h)if(p){i.add(p);const f=this._layerLayerViewInfoMap.get(p);f&&s?f.start():f||this._recyclingInfoMap.has(p)||n.push(p),"layers"in p&&p.layers&&o(p.layers)}}};for(const h of this._rootCollectionNames)o(Yf(this,h));for(const[h,p]of this._layerLayerViewInfoMap)if(!i.has(h)){this._layerLayerViewInfoMap.delete(p.layer);const f=p.tryRecycle(n);f?(this.notifyChange("updating"),this._recyclingInfoMap.set(p.layer,p),f.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),this._layerLayerViewInfoMap.set(p.layer,p),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),p.destroy(),this._reschedule()})):p.destroy()}for(const[h,p]of this._recyclingInfoMap)i.has(h)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),p.destroy());for(const h of n)this._createLayerView(h);this._refreshCollections();const a=[(l=r==null?void 0:r.ground)==null?void 0:l.layers,(c=r==null?void 0:r.basemap)==null?void 0:c.baseLayers,(u=r==null?void 0:r.basemap)==null?void 0:u.referenceLayers,r==null?void 0:r.layers].filter(h=>!!h);i.forEach(h=>"layers"in h&&a.push(h.layers)),this.addHandles(a.map(h=>this._watchUpdatingTracking.addOnCollectionChange(()=>h,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([jo(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),pe(()=>{const e=this.view,r=e==null?void 0:e.map;return[r==null?void 0:r.basemap,r==null?void 0:r.ground,r==null?void 0:r.layers,e==null?void 0:e.ready]},()=>this._reschedule(),li)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),Nj(this._recyclingInfoMap),Nj(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(gr()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Hd(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){this.destroyed||(Nj(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new B("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(Yf(this,e),Yf(this,r),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let n=0;for(const s of e){const o=this._layerLayerViewInfoMap.get(s);if(!(o!=null&&o.layerView))continue;const a=o.layerView;a.layer=s,a.parent=i,r.at(n)!==a&&r.splice(n,0,a),s.layers&&this._populateLayerViewsOwners(s.layers,a.layerViews,a),n+=1}n<r.length&&r.splice(n,r.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new Pht(e,this.view,this.layerViewImporter);r.promise.then(()=>this._refreshCollections(),i=>{i&&(on(i)||i.name==="cancelled:layerview-create")||K.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};d([m()],md.prototype,"_workPromise",void 0),d([m({readOnly:!0})],md.prototype,"_watchUpdatingTracking",void 0),d([m({readOnly:!0})],md.prototype,"_layersToLayerViews",null),d([m({readOnly:!0})],md.prototype,"_rootCollectionNames",null),d([m()],md.prototype,"layerViewImporter",void 0),d([m()],md.prototype,"supportsGround",void 0),d([m({readOnly:!0})],md.prototype,"updating",null),d([m({readOnly:!0})],md.prototype,"updatingRemaining",null),d([m({constructOnly:!0})],md.prototype,"view",void 0),md=d([F("esri.views.LayerViewManager")],md);const Aht=md;function Oht(t){return"createLayerView"in t&&t.createLayerView!=null}let ch=class extends Pe{constructor(e){super(e),this.factor=1.5,this.offset=lp(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};d([m({type:Number})],ch.prototype,"factor",void 0),d([m({nonNullable:!0})],ch.prototype,"offset",void 0),d([m()],ch.prototype,"position",void 0),d([m({type:Number,range:{min:0}})],ch.prototype,"size",void 0),d([m()],ch.prototype,"maskUrl",void 0),d([m()],ch.prototype,"maskEnabled",void 0),d([m()],ch.prototype,"overlayUrl",void 0),d([m()],ch.prototype,"overlayEnabled",void 0),d([m({readOnly:!0})],ch.prototype,"version",null),d([m({type:Boolean})],ch.prototype,"visible",void 0),ch=d([F("esri.views.Magnifier")],ch);const aLe=ch;let q6=class{constructor(e){this._observable=new nN,this._map=new Map(e)}get size(){return Ft(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const r=this._map.delete(e);return r&&this._observable.notify(),r}entries(){return Ft(this._observable),this._map.entries()}forEach(e,r){Ft(this._observable),this._map.forEach((i,n)=>e.call(r,i,n,this),r)}get(e){return Ft(this._observable),this._map.get(e)}has(e){return Ft(this._observable),this._map.has(e)}keys(){return Ft(this._observable),this._map.keys()}set(e,r){return this._map.set(e,r),this._observable.notify(),this}values(){return Ft(this._observable),this._map.values()}[Symbol.iterator](){return Ft(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}};var SK;let MR=SK=class extends Se{constructor(t){super(t),this.name=null,this.code=null}clone(){return new SK({name:this.name,code:this.code})}};d([m({type:String,json:{write:!0}})],MR.prototype,"name",void 0),d([m({type:[String,Number],json:{write:!0}})],MR.prototype,"code",void 0),MR=SK=d([F("esri.layers.support.CodedValue")],MR);const Mht=new Ii({inherited:"inherited",codedValue:"coded-value",range:"range"});let RR=class extends Se{constructor(e){super(e),this.name=null,this.type=null}};d([m({type:String,json:{write:!0}})],RR.prototype,"name",void 0),d([gt(Mht)],RR.prototype,"type",void 0),RR=d([F("esri.layers.support.Domain")],RR);const V7=RR;var TK;let $R=TK=class extends V7{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const r=String(t);this.codedValues.some(i=>(String(i.code)===r&&(e=i.name),!!e))}return e}clone(){return new TK({codedValues:ae(this.codedValues),name:this.name})}};d([m({type:[MR],json:{write:!0}})],$R.prototype,"codedValues",void 0),d([gt({codedValue:"coded-value"})],$R.prototype,"type",void 0),$R=TK=d([F("esri.layers.support.CodedValueDomain")],$R);const lLe=$R;var EK;let W6=EK=class extends V7{constructor(t){super(t),this.type="inherited"}clone(){return new EK}};d([gt({inherited:"inherited"})],W6.prototype,"type",void 0),W6=EK=d([F("esri.layers.support.InheritedDomain")],W6);const cLe=W6;var CK;let dC=CK=class extends V7{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new CK({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};d([m({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var r;return(r=e.range)==null?void 0:r[1]}},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,r){e[r]=[this.minValue||0,t]}}}})],dC.prototype,"maxValue",void 0),d([m({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var r;return(r=e.range)==null?void 0:r[0]}},write:{target:"range",writer(t,e,r){e[r]=[t,this.maxValue||0]}}}})],dC.prototype,"minValue",void 0),d([gt({range:"range"})],dC.prototype,"type",void 0),dC=CK=d([F("esri.layers.support.RangeDomain")],dC);const uLe=dC,Rht={key:"type",base:V7,typeMap:{range:uLe,"coded-value":lLe,inherited:cLe}};function hLe(t){if(!(t!=null&&t.type))return null;switch(t.type){case"range":return uLe.fromJSON(t);case"codedValue":return lLe.fromJSON(t);case"inherited":return cLe.fromJSON(t)}return null}const $ht=new Ii({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var PK;const Iht=new Ii({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Il=PK=class extends Se{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return(r==null?void 0:r.value)??null}readValueType(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?Iht.fromJSON(r.fieldValueType):null}clone(){var t;return new PK({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:((t=this.domain)==null?void 0:t.clone())??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};d([m({type:String,json:{write:!0}})],Il.prototype,"alias",void 0),d([m({type:[String,Number],json:{write:{allowNull:!0}}})],Il.prototype,"defaultValue",void 0),d([m()],Il.prototype,"description",void 0),d([Xe("description")],Il.prototype,"readDescription",null),d([m({types:Rht,json:{read:{reader:hLe},write:!0}})],Il.prototype,"domain",void 0),d([m({type:Boolean,json:{write:!0}})],Il.prototype,"editable",void 0),d([m({type:Vi,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],Il.prototype,"length",void 0),d([m({type:String,json:{write:!0}})],Il.prototype,"name",void 0),d([m({type:Boolean,json:{write:!0}})],Il.prototype,"nullable",void 0),d([gt($ht)],Il.prototype,"type",void 0),d([m()],Il.prototype,"valueType",void 0),d([Xe("valueType",["description"])],Il.prototype,"readValueType",null),d([m({type:Boolean,json:{read:!1}})],Il.prototype,"visible",void 0),Il=PK=d([F("esri.layers.support.Field")],Il);const AN=Il;var AK;let M0=AK=class extends Se{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new AK({mapLayerId:t,gdbVersion:e})}};d([gt({mapLayer:"map-layer"})],M0.prototype,"type",void 0),d([m({type:Vi,json:{write:!0}})],M0.prototype,"mapLayerId",void 0),d([m({type:String,json:{write:!0}})],M0.prototype,"gdbVersion",void 0),M0=AK=d([F("esri.layers.support.source.MapLayerSource")],M0);var OK;let i0=OK=class extends Se{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:r,spatialReference:i,geometryType:n}=this,s={workspaceId:t,query:e,oidFields:r,spatialReference:(i==null?void 0:i.clone())??void 0,geometryType:n};return new OK(s)}};d([gt({queryTable:"query-table"})],i0.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],i0.prototype,"workspaceId",void 0),d([m({type:String,json:{write:!0}})],i0.prototype,"query",void 0),d([m({type:String,json:{write:!0}})],i0.prototype,"oidFields",void 0),d([m({type:Ve,json:{write:!0}})],i0.prototype,"spatialReference",void 0),d([gt(qL)],i0.prototype,"geometryType",void 0),i0=OK=d([F("esri.layers.support.source.QueryTableDataSource")],i0);var MK;let pC=MK=class extends Se{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new MK({workspaceId:t,dataSourceName:e})}};d([gt({raster:"raster"})],pC.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],pC.prototype,"dataSourceName",void 0),d([m({type:String,json:{write:!0}})],pC.prototype,"workspaceId",void 0),pC=MK=d([F("esri.layers.support.source.RasterDataSource")],pC);var RK;let Nx=RK=class extends Se{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:r}=this;return new RK({workspaceId:t,gdbVersion:e,dataSourceName:r})}};d([gt({table:"table"})],Nx.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],Nx.prototype,"workspaceId",void 0),d([m({type:String,json:{write:!0}})],Nx.prototype,"gdbVersion",void 0),d([m({type:String,json:{write:!0}})],Nx.prototype,"dataSourceName",void 0),Nx=RK=d([F("esri.layers.support.source.TableDataSource")],Nx);var $K,IK;const Lht=tc()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let uh=$K=class extends Se{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,r){return Hme()(t,e,r)}castLeftTableSource(t){return sy(LK(),t)}readRightTableSource(t,e,r){return Hme()(t,e,r)}castRightTableSource(t){return sy(LK(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:r,rightTableSource:i,joinType:n}=this,s={leftTableKey:t,rightTableKey:e,leftTableSource:(r==null?void 0:r.clone())??void 0,rightTableSource:(i==null?void 0:i.clone())??void 0,joinType:n};return new $K(s)}};d([gt({joinTable:"join-table"})],uh.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],uh.prototype,"leftTableKey",void 0),d([m({type:String,json:{write:!0}})],uh.prototype,"rightTableKey",void 0),d([m({json:{write:!0}})],uh.prototype,"leftTableSource",void 0),d([Xe("leftTableSource")],uh.prototype,"readLeftTableSource",null),d([Dr("leftTableSource")],uh.prototype,"castLeftTableSource",null),d([m({json:{write:!0}})],uh.prototype,"rightTableSource",void 0),d([Xe("rightTableSource")],uh.prototype,"readRightTableSource",null),d([Dr("rightTableSource")],uh.prototype,"castRightTableSource",null),d([gt(Lht)],uh.prototype,"joinType",void 0),uh=$K=d([F("esri.layers.support.source.JoinTableDataSource")],uh);let vH=null;function Hme(){return vH||(vH=FA({types:LK()})),vH}let bH=null;function LK(){return bH||(bH={key:"type",base:null,typeMap:{"data-layer":mu,"map-layer":M0}}),bH}const Dht={key:"type",base:null,typeMap:{"join-table":uh,"query-table":i0,raster:pC,table:Nx}};let mu=IK=class extends Se{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new IK({fields:t,dataSource:e})}};d([gt({dataLayer:"data-layer"})],mu.prototype,"type",void 0),d([m({type:[AN],json:{write:!0}})],mu.prototype,"fields",void 0),d([m({types:Dht,json:{write:!0}})],mu.prototype,"dataSource",void 0),mu=IK=d([F("esri.layers.support.source.DataLayerSource")],mu),mu.from=to(mu);let Fx=class extends ds(Se){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};d([m({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],Fx.prototype,"onFields",void 0),d([m({type:String,json:{write:!0}})],Fx.prototype,"operator",void 0),d([m({type:String,json:{write:!0}})],Fx.prototype,"searchTerm",void 0),d([m({type:String,json:{write:!0}})],Fx.prototype,"searchType",void 0),Fx=d([F("esri.rest.support.FullTextSearch")],Fx);const Nht=Fx;var DK;const qme=new Ii({upperLeft:"upper-left",lowerLeft:"lower-left"});let kx=DK=class extends Se{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new DK(ae({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};d([m({type:br,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],kx.prototype,"extent",void 0),d([m({type:["view","edit"],json:{write:!0}})],kx.prototype,"mode",void 0),d([m({type:String,json:{read:qme.read,write:qme.write}})],kx.prototype,"originPosition",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],kx.prototype,"tolerance",void 0),kx=DK=d([F("esri.rest.support.QuantizationParameters")],kx);const Fht=kx,kht=new Ii({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var NK;const Wme=new Ii({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Kp=NK=class extends Se{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=ae(t))}clone(){return new NK({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:ae(this.statisticParameters)})}};d([m({type:Number,json:{write:!0}})],Kp.prototype,"maxPointCount",void 0),d([m({type:Number,json:{write:!0}})],Kp.prototype,"maxRecordCount",void 0),d([m({type:Number,json:{write:!0}})],Kp.prototype,"maxVertexCount",void 0),d([m({type:String,json:{write:!0}})],Kp.prototype,"onStatisticField",void 0),d([m({type:String,json:{write:!0}})],Kp.prototype,"outStatisticFieldName",void 0),d([m({type:String,json:{read:{source:"statisticType",reader:Wme.read},write:{target:"statisticType",writer:Wme.write}}})],Kp.prototype,"statisticType",void 0),d([m({type:Object})],Kp.prototype,"statisticParameters",void 0),d([nt("statisticParameters")],Kp.prototype,"writeStatisticParameters",null),Kp=NK=d([F("esri.rest.support.StatisticDefinition")],Kp);const Uht=Kp;var Y6;const zht=new Ii({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let kt=Y6=class extends Se{static from(t){return s_(Y6,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const r={};for(const i in t){const n=t[i];Array.isArray(n)?r[i]=n.map(s=>s instanceof Date?s.getTime():s):n instanceof Date?r[i]=n.getTime():r[i]=n}e.parameterValues=r}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new Y6(ae({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};kt.MAX_MAX_RECORD_COUNT_FACTOR=5,d([m({json:{write:!0}})],kt.prototype,"aggregateIds",void 0),d([m({type:Boolean,json:{write:!0}})],kt.prototype,"cacheHint",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],kt.prototype,"compactGeometryEnabled",void 0),d([m({json:{write:!0}})],kt.prototype,"datumTransformation",void 0),d([Dr("datumTransformation")],kt.prototype,"castDatumTransformation",null),d([m({type:Boolean,json:{default:!1,write:!0}})],kt.prototype,"defaultSpatialReferenceEnabled",void 0),d([m({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],kt.prototype,"distance",void 0),d([m({type:mu,json:{write:!0}})],kt.prototype,"dynamicDataSource",void 0),d([m({type:String,json:{write:!0}})],kt.prototype,"formatOf3DObjects",void 0),d([m({type:[Nht],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],kt.prototype,"fullText",void 0),d([m({type:String,json:{write:!0}})],kt.prototype,"gdbVersion",void 0),d([m({types:cN,json:{read:Sb,write:!0}})],kt.prototype,"geometry",void 0),d([m({type:Number,json:{write:!0}})],kt.prototype,"geometryPrecision",void 0),d([m({type:[String],json:{write:!0}})],kt.prototype,"groupByFieldsForStatistics",void 0),d([m({type:String,json:{write:!0}})],kt.prototype,"having",void 0),d([m({type:Date})],kt.prototype,"historicMoment",void 0),d([nt("historicMoment")],kt.prototype,"writeHistoricMoment",null),d([m({type:Number,json:{write:!0}})],kt.prototype,"maxAllowableOffset",void 0),d([m({type:Number,cast:t=>t<1?1:t>kt.MAX_MAX_RECORD_COUNT_FACTOR?kt.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],kt.prototype,"maxRecordCountFactor",void 0),d([m({type:["xyFootprint"],json:{write:!0}})],kt.prototype,"multipatchOption",void 0),d([m({type:Number,json:{read:{source:"resultRecordCount"}}})],kt.prototype,"num",void 0),d([m({json:{write:!0}})],kt.prototype,"objectIds",void 0),d([m({type:[String],json:{write:!0}})],kt.prototype,"orderByFields",void 0),d([m({type:[String],json:{write:!0}})],kt.prototype,"outFields",void 0),d([m({type:Ve,json:{name:"outSR",write:!0}})],kt.prototype,"outSpatialReference",void 0),d([m({type:[Uht],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],kt.prototype,"outStatistics",void 0),d([m({json:{write:!0}})],kt.prototype,"parameterValues",void 0),d([nt("parameterValues")],kt.prototype,"writeParameterValues",null),d([m({type:He,json:{write:!0}})],kt.prototype,"pixelSize",void 0),d([m({type:Fht,json:{write:!0}})],kt.prototype,"quantizationParameters",void 0),d([m({type:[Object],json:{write:!0}})],kt.prototype,"rangeValues",void 0),d([m({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],kt.prototype,"relationParameter",void 0),d([m({type:String,json:{write:!0}})],kt.prototype,"resultType",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],kt.prototype,"returnCentroid",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],kt.prototype,"returnDistinctValues",void 0),d([m({type:Boolean,json:{default:!0,write:!0}})],kt.prototype,"returnExceededLimitFeatures",void 0),d([m({type:Boolean,json:{write:!0}})],kt.prototype,"returnGeometry",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],kt.prototype,"returnQueryGeometry",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],kt.prototype,"returnM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],kt.prototype,"returnZ",void 0),d([m({type:Ve,json:{write:!0}})],kt.prototype,"sourceSpatialReference",void 0),d([gt(kht,{ignoreUnknown:!1,name:"spatialRel"})],kt.prototype,"spatialRelationship",void 0),d([m({type:Number,json:{read:{source:"resultOffset"}}})],kt.prototype,"start",void 0),d([nt("start"),nt("num")],kt.prototype,"writeStart",null),d([m({type:String,json:{write:!0}})],kt.prototype,"sqlFormat",void 0),d([m({type:String,json:{write:!0}})],kt.prototype,"text",void 0),d([m({type:hw,json:{write:!0}})],kt.prototype,"timeExtent",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],kt.prototype,"timeReferenceUnknownClient",void 0),d([gt(zht,{ignoreUnknown:!1}),m({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],kt.prototype,"units",void 0),d([m({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],kt.prototype,"where",void 0),d([nt("where")],kt.prototype,"writeWhere",null),kt=Y6=d([F("esri.rest.support.Query")],kt);const ec=kt;let n0=class extends Xn.EventedAccessor{constructor(e){super(e),this._selectionMap=new q6,this._trashCan=[],this._layerEditHandles=new St,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([pe(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),jo(()=>this.sources,"change",r=>{const i=this._selectionMap;for(const n of r.removed)i.delete(n);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new St;this.view.when().then(()=>{this.view.map.allLayers.flatten(r=>"sublayers"in r&&r.sublayers?r.sublayers:null).forEach(r=>{(P5(r)&&!YXe(r)||k2(r))&&e.add(r)}),this._set("sources",e)})}destroy(){this._layerEditHandles.drain(Pi)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[r,i]=e;return{layer:r,selection:[...i.selection]}})}get count(){let e=0;for(const r of this._selectionMap.values())e+=r.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._get("sources")}set sources(e){this._set("sources",e)}async getSelectedFeatures(e,r={},i="layerView"){const{view:n,selections:s}=this,o=(e!==void 0?s.filter(a=>e.includes(a.layer)):s).filter(a=>a.selection.length>0).map(async a=>{const{layer:l,selection:c}=a,u=k2(l)?l.parent:l;if(u==null||!Yme(u))return null;if(i==="layer")return Xme(u,c,r);const h=await n.whenLayerView(u);return Xme(h,c,r)});return(await Promise.all(o)).filter(a=>a!==null)}updateSelection(e){const r=new Map;for(const[s,o]of this._selectionMap)r.set(s,[...o.selection]);let i=!1;const n=e.current.concat(e.added);for(const s of n){const o=s.sourceLayer,a=s.getObjectId();if(this.sources.includes(o)&&(P5(o)||k2(o))&&a!==null){const l=rN(r,o,()=>[]);l.includes(a)||(l.push(a),i=!0)}}for(const s of e.removed){const o=s.sourceLayer,a=s.getObjectId();if(this.sources.includes(o)&&(P5(o)||k2(o))&&a!==null){const l=r.get(o),c=l==null?void 0:l.indexOf(a);c!==void 0&&c>=0&&(l==null||l.splice(c,1),i=!0)}}if(i){const{_selectionMap:s,_trashCan:o}=this,a=[];for(const[l,c]of r){const u=s.get(l);u!==void 0&&o.push(u),s.set(l,{selection:c}),a.push({layer:l,selection:c,...jX(u!==void 0?u.selection:[],c)})}this._onSelectionChange(a)}}setSelection(e,r){this._setSelection(e,r)}getSelection(e){const r=this._selectionMap.get(e);return r==null?void 0:r.selection}appendToSelection(e,r){const i=this._selectionMap.get(e),n=i!==void 0?[...i.selection]:[];for(const s of r)n.includes(s)||n.push(s);this._setSelection(e,n)}removeFromSelection(e,r){const i=this._selectionMap.get(e);if(!i)return;const n=[];for(const s of i.selection)r.includes(s)||n.push(s);this._setSelection(e,n)}toggleInSelection(e,r){const i=this._selectionMap.get(e);if(!i||i.selection.length===0)return void this._setSelection(e,r);const n=new Set(i.selection),s=new Set(r),o=bqe(n,s);this._setSelection(e,Array.from(o))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const r=[];for(const[i,n]of this._selectionMap.entries())r.push({layer:i,added:[],removed:[...n.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(r)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){var o;if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;){const a=this._trashCan.pop();(o=a==null?void 0:a.highlightHandle)==null||o.remove()}const{sources:e,view:r,_selectionMap:i,showHighlight:n}=this,s=this._vizTaskId;for(const a of e){const l=i.get(a),c=k2(a)?a.parent:a;c!=null&&Yme(c)&&r.whenLayerView(c).then(u=>{var h;(h=l==null?void 0:l.highlightHandle)==null||h.remove(),l!==void 0&&n&&s===this._vizTaskId&&"highlight"in u&&typeof u.highlight=="function"&&l.selection.length>0&&(l.highlightHandle=u.highlight(l.selection,"selection"))})}}_refreshListeners(){this._layerEditHandles.drain(Pi);for(const e of this.sources){const r=k2(e)?e.parent:e;if(r!=null&&P5(r)){const i=r.on("edits",n=>{this._handleEditChanges(n,e)});this._layerEditHandles.push(i)}}}_handleEditChanges(e,r){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(r)){const i=e.deletedFeatures.filter(n=>n.error==null).map(n=>n.objectId).filter(rw);this.removeFromSelection(r,i)}}_setSelection(e,r){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const i=this._selectionMap.get(e);if(i===void 0||!Bht(i,{selection:r})){i!==void 0&&this._trashCan.push(i),this._selectionMap.set(e,{selection:[...r]});const n={layer:e,selection:[...r],...jX(i!==void 0?i.selection:[],r)};this._onSelectionChange([n])}}};d([m({readOnly:!0,nonNullable:!0})],n0.prototype,"selections",null),d([m({readOnly:!0,nonNullable:!0})],n0.prototype,"count",null),d([m({constructOnly:!0,nonNullable:!0})],n0.prototype,"view",void 0),d([m({readOnly:!0,nonNullable:!0})],n0.prototype,"hasSelection",null),d([m()],n0.prototype,"showHighlight",void 0),d([m()],n0.prototype,"sources",null),n0=d([F("esri.views.SelectionManager")],n0);const P5=t=>t.createQuery!==void 0&&t.on!==void 0,Vht=t=>t.layer!==void 0,Yme=t=>(t==null?void 0:t.when)!==void 0,Bht=(t,e)=>{if(t==null&&e==null)return!0;if(t!=null&&e==null||t==null&&e!=null)return!1;if(t!=null&&e!=null&&t.selection!=null&&e.selection!=null){const r=[...t.selection],i=[...e.selection];if(r.length!==i.length)return!1;r.sort(),i.sort();for(let n=0;n<r.length;n++)if(r[n]!==i[n])return!1}return!0},Xme=async(t,e,r={})=>{let i;if(Vht(t)){const n=t;i=n===void 0?null:await n.queryFeatures(new ec({...r,objectIds:e})).then(s=>({data:s,layer:t.layer}))}else{const n=t;i=n===void 0?null:await n.queryFeatures(new ec({...r,objectIds:e})).then(s=>({data:s,layer:n}))}return i},Ght=n0;let IR=class extends ds(Pe){constructor(e){super(e),this.accentColor=new De([255,127,0]),this.textColor=new De([255,255,255])}};d([m({type:De,nonNullable:!0})],IR.prototype,"accentColor",void 0),d([m({type:De,nonNullable:!0})],IR.prototype,"textColor",void 0),IR=d([F("esri.views.Theme")],IR);const FK=IR;var Zme;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(Zme||(Zme={}));const dLe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],pLe={};function fLe(t){return!!pLe[t]}function jht(t){for(const e of t)if(!fLe(e))return!1;return!0}dLe.forEach(t=>{pLe[t]=!0});let Hht=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:r,priority:i},n)=>{var s;return(s=this.inputManager)==null?void 0:s.installHandlers(n,[r],i)})}disconnect(){this.inputManager&&this._handlers.forEach((e,r)=>{var i;return(i=this.inputManager)==null?void 0:i.uninstallHandlers(r)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,r,i,n){const s=Array.isArray(e)?e:e.split(",");if(!jht(s))return s.some(fLe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:n=i,n=n??cb.DEFAULT;const l=this._createUniqueGroupName(),c=new qht(this.view,s,a,o);this._handlers.set(l,{handler:c,priority:n});for(const u of s){const h=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,h+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],n),ri(()=>this._removeHandler(l,s))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,r){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of r){const n=this._handlerCounts.get(i);n===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):n===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,n-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},qht=class extends va{constructor(e,r,i,n){super(!0),this._latestDragStart=void 0,this.view=e;for(const s of r)switch(s){case"click":this.registerIncoming("click",i,o=>n(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>n(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>n(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>n(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>n(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&n(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>n(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>n(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>n(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>n(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>n(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>n(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>n(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>n(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>n(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{n(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{n(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{n(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:u,screenPoint:lp(s,o),mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:u,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:h}=e;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:h}=e;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(s,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,r){return this.view.toMap(lp(e,r),{exclude:[]})}_wrapDrag(e){const r=e.data,{x:i,y:n}=r.center,{action:s,pointerType:o,button:a}=r;if(s==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:u,timestamp:h}=e,p={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return s==="end"&&(this._latestDragStart=void 0),{type:"drag",action:s,x:i,y:n,origin:p,pointerType:o,button:a,buttons:c,radius:r.radius,angle:ul(r.angle),native:l,timestamp:h,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:r,repeat:i,native:n}=e.data,{cancelable:s,timestamp:o}=e;return{type:"key-down",key:r,repeat:i,native:n,timestamp:o,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:r,native:i}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-up",key:r,native:i,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,r){const{x:i,y:n,button:s,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,u=a.pointerType,{cancelable:h,timestamp:p}=e;return{type:r,x:i,y:n,pointerId:c,pointerType:u,button:s,buttons:o,native:a,timestamp:p,eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:r,y:i,buttons:n,native:s,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,u=e.data.action,h={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:p,timestamp:f}=e;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:n,action:u,origin:h,native:s,timestamp:f,eventId:o,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:r,data:i,timestamp:n}=e,{x:s,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:s,y:o,deltaY:a,native:l,timestamp:n,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:r,state:i,device:n}=e.data,{cancelable:s,timestamp:o}=e,{buttons:a,axes:l}=i;return{type:"gamepad",device:n,timestamp:o,action:r,buttons:a,axes:l,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var uD,Jme,Qme;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(uD||(uD={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(Jme||(Jme={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(Qme||(Qme={}));function Wht(t){return[t.on("before-add",e=>{const r=e.item;if(r==null||t.includes(r))return K.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();r.onAdd()}),t.on("after-remove",e=>{const r=e.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function kK(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(uD.USER)&&t.getEditableFlag(uD.MANAGER)}function cg(t){return lp(t.x,t.y)}function nZt(t){return Sn(t.x,t.y)}function mLe(t,e){var i;const r=(i=t instanceof HTMLElement?t:t.surface)==null?void 0:i.getBoundingClientRect();return r?lp(e.clientX-r.left,e.clientY-r.top):lp(0,0)}function Kme(t,e){return e instanceof Event?mLe(t,e):cg(e)}function ege(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let Yht=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,r){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":tge(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!rge(e))break;const n=cg(e),s=this._intersect(n,e.pointerType,r.forEachTool);if(s==null)break;const o=s.manipulator,a=s.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._releaseManipulatorBeforeDragging(o,e,r),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:n,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&r.activeTool==null&&(this._revertToNullActiveTool=!0,r.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:n}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,r);break;case"pointer-drag":{if(!rge(e))break;const n=this._grabbedManipulators.get(e.pointerId),s=n==null?void 0:n.manipulator,o=n==null?void 0:n.tool;if(s==null||o==null)break;const a=cg(e);a.x=we(a.x,0,r.view.width),a.y=we(a.y,0,r.view.height);const l=n.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,c?s.events.emit("drag",{action:"update",start:l,screenPoint:a}):s.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:s,start:l}));break;case"end":s.dragging=!1,c&&s.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,r)}i();break}case"immediate-click":{const n=cg(e),s=this._intersect(n,e.pointerType,r.forEachTool);if(Xht(e)||r.forEachTool(c=>{if((s==null||s.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:h})=>{h.selected&&(h.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),s==null)break;const{manipulator:o,tool:a}=s;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i}),wH(o,i);break}case"click":{const n=cg(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=s==null?void 0:s.manipulator;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const n=cg(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i}),wH(o,i);break}case"immediate-double-click":{const n=cg(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i}),wH(o,i);break}}this._onFocusChange(r.forEachTool)}_releaseManipulatorBeforeDragging(e,r,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:cg(r)}),this._grabbedManipulators.forEach(({manipulator:n},s)=>{n===e&&this._grabbedManipulators.delete(s)}),this._afterManipulatorRelease(i.setActiveTool)}_handlePointerEnd(e,r){var n;const i=(n=this._grabbedManipulators.get(e.pointerId))==null?void 0:n.manipulator;i!=null&&i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:cg(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(r.setActiveTool))}_cursorFromMap(e){let r=null;return Hd(e,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:n})=>{r.add(n)}),this._hoveredManipulators.forEach(({tool:n})=>{i.add(n)}),e(n=>{n.hasGrabbedManipulators=r.has(n),n.hasHoveredManipulators=i.has(n);const s=this._grabbedManipulators.values(),o=OHe(s,({tool:a})=>a===n);n.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:r,setActiveTool:i},n=!0,s){const o=(a,l)=>a===e&&(s==null||s===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),n&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorRelease(i),this._onFocusChange(r)}_intersect(e,r,i){let n=null;return i(s=>{if(s.manipulators==null||!kK(s))return!1;const o=s.manipulators.intersect(e,r);return o!=null&&(n={tool:s,manipulator:o},!0)}),n}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(lp(r.x,r.y),i,r.pointerType,e)})}handleHoverEvent(e,r){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!tge(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(cg(e),e.pointerId,e.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(e,r,i,n){var a;let s=this._intersect(e,i,n);const o=(a=this._hoveredManipulators.get(r))==null?void 0:a.manipulator;s==null||s.manipulator.interactive||(s=null),s!=null&&o===s.manipulator||(o!=null&&(o.hovering=!1),s!=null?(s.manipulator.hovering=!0,this._hoveredManipulators.set(r,s)):this._hoveredManipulators.delete(r),this._onFocusChange(n))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function tge(t){return t==="mouse"}function rge(t){return t.pointerType!=="mouse"||t.button===0}function Xht(t){return!!t.native.shiftKey}function wH(t,e){t!=null&&t.consumesClicks&&e()}const ige="attached",xH="tools",nge=1e3;let ug=class extends Pe{constructor(e){super(e),this._updatingHandles=new em,this._clock=tN,this._manipulatorState=new Yht,this.tools=new St,this.cursor=null,this._interacting=!1,this._interactingTimeout=nge,this._interactingTimeoutHandle=null,this._forEachTool=r=>{for(const i of this.tools.items)if(r(i))return}}initialize(){this.addHandles([this.view.on(dLe,e=>{this._handleInputEvent(e)},cb.TOOL),...Wht(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void K.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const r=this.activeTool;this._set("activeTool",e),r!=null&&r.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const n=kK(i);this.activeTool!=null&&n||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!n)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=Pi(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){var e;this.view.type==="3d"?this.addHandles([pe(()=>{const{state:r}=this.view;return"camera"in r&&r.camera},()=>this._forEachManipulator(r=>r.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",r=>this._forEachManipulator(i=>i.onElevationChange(r)))],ige):this.addHandles(pe(()=>this.view.extent,()=>this._forEachManipulator(r=>r.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(ige),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(r=>{r.manipulators&&r.manipulators.forEach(({manipulator:i})=>e(i,r))})}_handleInputEvent(e){let r=!1;const i={...e,stopPropagation:()=>{r=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(n=>{!r&&n.visible&&n.handleInputEvent(i)}),!r&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),r||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(xH),this._forEachTool(e=>{if(e instanceof Pe){const r=pe(()=>[e.cursor,e.visible,e.editable],()=>{kK(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(r,xH)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",r=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,r.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],xH)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var r;(r=e.setEditableFlag)==null||r.call(e,uD.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(r=>!(r.cursor==null||!r.visible)&&(e=r.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(r=>(e==null||r!==e)&&!r.created&&r.removeIncompleteOnCancel).forEach(r=>{this.tools.remove(r)})}get test(){const e=this;return{setClock:r=>this._clock=r,set interactingTimeoutEnabled(r){e._interactingTimeout=r?nge:0},get interactingTimeoutEnabled(){return e._interactingTimeout!==0}}}};d([m({constructOnly:!0,nonNullable:!0})],ug.prototype,"view",void 0),d([m({value:null})],ug.prototype,"activeTool",null),d([m({readOnly:!0,type:St})],ug.prototype,"tools",void 0),d([m({readOnly:!0})],ug.prototype,"cursor",void 0),d([m({readOnly:!0})],ug.prototype,"updating",null),d([m()],ug.prototype,"_interacting",void 0),d([m({readOnly:!0})],ug.prototype,"interacting",null),ug=d([F("esri.views.ToolViewManager")],ug);let fC=class extends Pe{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Zht.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Jht[this.deviceType]}};d([m({nonNullable:!0,readOnly:!0})],fC.prototype,"nativeIndex",void 0),d([m({type:String,readOnly:!0})],fC.prototype,"deviceType",null),d([m({type:Number,readOnly:!0})],fC.prototype,"axisThreshold",null),fC=d([F("esri.views.input.gamepad.GamepadInputDevice")],fC);const Zht=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Jht={standard:.15,spacemouse:.025,unknown:0},Koe=fC;let LR=class extends Pe{constructor(...e){super(...e),this.devices=new St,this.enabledFocusMode="document"}};d([m({type:St.ofType(Koe),readOnly:!0})],LR.prototype,"devices",void 0),d([m({type:["document","view","none"]})],LR.prototype,"enabledFocusMode",void 0),LR=d([F("esri.views.input.gamepad.GamepadSettings")],LR);const Qht=LR;let X6=class extends Pe{constructor(){super(...arguments),this.gamepad=new Qht}};d([m({readOnly:!0})],X6.prototype,"gamepad",void 0),X6=d([F("esri.views.input.Input")],X6);const Kht=X6;let H1=class extends Pe{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};d([m({type:Boolean,nonNullable:!0})],H1.prototype,"enabled",void 0),d([m({type:Koe})],H1.prototype,"device",void 0),d([m({type:["pan","zoom"],nonNullable:!0})],H1.prototype,"mode",void 0),d([m({type:["forward-down","forward-up"],nonNullable:!0})],H1.prototype,"tiltDirection",void 0),d([m({type:Number,nonNullable:!0})],H1.prototype,"velocityFactor",void 0),H1=d([F("esri.views.navigation.gamepad.GamepadSettings")],H1);const gLe=H1;let Ux=class extends Pe{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new gLe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};d([m({type:Boolean})],Ux.prototype,"browserTouchPanEnabled",void 0),d([m({type:gLe,nonNullable:!0})],Ux.prototype,"gamepad",void 0),d([m({type:Boolean})],Ux.prototype,"momentumEnabled",void 0),d([m({type:Boolean})],Ux.prototype,"mouseWheelZoomEnabled",void 0),Ux=d([F("esri.views.navigation.Navigation")],Ux);const yLe=Ux,_Le={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer"},vLe=Object.values(_Le),bLe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${vLe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),edt=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${vLe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),tdt=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function rdt(t){return!!bLe.test(t)}function fm(t){if(t==null)return null;const e=xs(t),r=(e==null?void 0:e.path.match(bLe))||(e==null?void 0:e.path.match(edt));if(!r)return null;const[,i,n,s,o]=r,a=n.indexOf("/");return{title:eae(a!==-1?n.slice(a+1):n),serverType:_Le[s.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function idt(t){const e=xs(t).path.match(tdt);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function eae(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function ndt(t,e){const r=[];if(t){const i=fm(t);i!=null&&i.title&&r.push(i.title)}if(e){const i=eae(e);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function o9(t){if(!t)return!1;const e=".arcgis.com/",r="//services",i="//tiles",n="//features",s=(t=t.toLowerCase()).includes(e),o=t.includes(r)||t.includes(i)||t.includes(n);return s&&o}function sdt(t,e){return t&&jCe(qCe(t,e))}function odt(t){let{url:e}=t;if(!e)return{url:e};e=qCe(e,t.logger);const r=xs(e),i=fm(r.path);let n;if(i!=null)i.sublayer!=null&&t.layer.layerId==null&&(n=i.sublayer),e=i.url.path;else if(t.nonStandardUrlAllowed){const s=idt(r.path);s!=null&&(e=s.serviceUrl,n=s.sublayerId)}return{url:jCe(e),layerId:n}}function adt(t,e,r,i,n){xb(e,i,"url",n),i.url&&t.layerId!=null&&(i.url=Nc(i.url,r,t.layerId.toString()))}function dZt(t){if(!t)return!1;const e=t.toLowerCase(),r=e.includes("/services/"),i=e.includes("/mapserver/wmsserver"),n=e.includes("/imageserver/wmsserver"),s=e.includes("/wmsserver");return r&&(i||n||s)}function pZt(t,e,r){const i=wLe(t),n=e,s=ldt(i,n,r);if(i){const o=JA.deriveUnitFromSR(i,t.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new B("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new B("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!cdt(t)||s===hu.Unsupported)return new B("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(s){case hu.Units:{const o=(i==null?void 0:i.heightUnit)||"unknown",a=(n==null?void 0:n.heightUnit)||"unknown",l=new B("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new B("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}case hu.HeightModel:{const o=(i==null?void 0:i.heightModel)||"unknown",a=(n==null?void 0:n.heightModel)||"unknown",l=new B("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new B("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}case hu.CRS:{const o=(i==null?void 0:i.vertCRS)||"unknown",a=(n==null?void 0:n.vertCRS)||"unknown",l=new B("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new B("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}}return null}function ldt(t,e,r){if(!sge(t)||!sge(e))return hu.Unsupported;if(t==null||e==null)return hu.Ok;if(!r&&t.heightUnit!==e.heightUnit)return hu.Units;if(t.heightModel!==e.heightModel)return hu.HeightModel;switch(t.heightModel){case"gravity-related-height":return hu.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?hu.Ok:hu.CRS;default:return hu.Unsupported}}var hu;function sge(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function cdt(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!TLe(t)}function wLe(t){var i;if(t.type==="integrated-mesh-3dtiles")return null;const e=t.url?fm(t.url):void 0;return!(((i=t.spatialReference)==null?void 0:i.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&xLe(t)&&t.heightModelInfo?t.heightModelInfo:TLe(t)?JA.deriveUnitFromSR(hdt,t.spatialReference):null}function xLe(t){return"heightModelInfo"in t}function SLe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"catalog":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function TLe(t){return SLe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):ELe(t)}function udt(t){return t.layers!=null||ELe(t)||SLe(t)||xLe(t)}function ELe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(hu||(hu={}));const hdt=new JA({heightModel:"gravity-related-height"});let UK,SH=null;async function ddt(t){SH||(SH=re(()=>Promise.resolve().then(()=>H$t),void 0).then(e=>UK=e)),await SH,dt(t)}async function CLe(t,e,r,i){if(!t)return null;const n=t.spatialReference;return HA()||ju(n,e)?lw(t,e):UK?UK.projectGeometry(t,e,r,i):(await Promise.race([ddt(i),KP(i)]),CLe(t,e,r,i))}let cn=class extends Pe{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Ql(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,n,s,o;const e=(i=this.map)==null?void 0:i.call(this),r=[];return this.priorityCollection!=null&&r.push(this.priorityCollection),r.push({parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),r}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;let i=null;for(const s of e){const o=this._getSupportedSpatialReferences(s);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);a!=null&&(i=a)}if(i!=null&&i.length===1)break}if(r&&(i==null||i.length!==1))return{updating:!0};const n=this._pickSpatialReferenceCandidate(i);return{spatialReference:n!=null?n.spatialReference:null,viewingMode:n!=null?n.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,n,s,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:r}=this._collectLayers([{parent:(n=(i=this.map)==null?void 0:i.call(this))==null?void 0:n.basemap,layers:(a=(o=(s=this.map)==null?void 0:s.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const u=e[0].tileInfo;return{tileInfo:u&&u.spatialReference.equals(this.spatialReference)?u:null,updating:!1}}return{updating:r}}get _heightModelInfoTask(){var i,n,s;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))!=null&&i.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;for(const o of e)if(udt(o)){const a=wLe(o);if(a)return{heightModelInfo:a,vcsWkid:(n=o.spatialReference)==null?void 0:n.vcsWkid,latestVcsWkid:(s=o.spatialReference)==null?void 0:s.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,r=e.updating,i=[];for(const n of e.layers){const s="fullExtents"in n&&n.fullExtents||(n.fullExtent!=null?[n.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:s[0],a=s.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const l of s)i.push({extent:l,layer:n})}return{candidates:i,updating:r}}get _extentTask(){const{candidates:e,updating:r}=this._extentCandidatesTask;if(r)return{updating:r};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),n=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&n.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=Ql(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:n.clone(),task:b_(async s=>{try{const o=await CLe(i.extent,n,"portalItem"in i.layer?i.layer.portalItem:void 0,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(Ms(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,r){if(e==null)return r;const i=[],n=(s,o)=>s!=null?o!=null?s===o&&s:s:o;for(const s of e)for(const o of r){if(!s.spatialReference.equals(o.spatialReference))continue;const a=n(s.viewingMode,o.viewingMode);if(a!==!1){i.push({spatialReference:s.spatialReference,viewingMode:a});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const r=this.defaultSpatialReference;return e==null||e.length<1?r!=null?{spatialReference:r,viewingMode:null}:null:(r!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(r))&&(e=e.filter(({spatialReference:i})=>i.equals(r))),e.length>1&&e.some(({viewingMode:i})=>i!==Fe.Local)&&(e=e.filter(({viewingMode:i})=>i!==Fe.Local)),e[0])}_getSupportedSpatialReferences(e){const r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(r.length===0)return[];const i=[];for(const n of r){const s=this.getSpatialReferenceSupport({spatialReference:n,layer:e});if(s!=null){const o=s.constraints!=null?s.constraints:[{spatialReference:n,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const r=this.spatialReference;return e.find(({extent:i})=>r.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const r=new pdt;for(const n of e)if(this._collectCollection(n,r),r.preloading===this.sourcePreloadCount)break;return{layers:r.layers,updating:r.updating}}_collectCollection(e,r){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return r.updating=!0,void++r.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":r.updating=!0,++r.preloading;break;case"loaded":r.updating||r.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},r)}if(r.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(r=>{on(r)||console.log(r)}),"loading"):e.loadStatus:"loaded"}};d([m()],cn.prototype,"required",void 0),d([m({constructOnly:!0})],cn.prototype,"map",void 0),d([m({constructOnly:!0})],cn.prototype,"getSpatialReferenceSupport",void 0),d([m()],cn.prototype,"defaultSpatialReference",void 0),d([m()],cn.prototype,"userSpatialReference",void 0),d([m()],cn.prototype,"sourcePreloadCount",void 0),d([m()],cn.prototype,"priorityCollection",void 0),d([m()],cn.prototype,"requiresExtentInSpatialReference",void 0),d([m()],cn.prototype,"suspended",void 0),d([m({readOnly:!0})],cn.prototype,"ready",null),d([m({readOnly:!0})],cn.prototype,"heightModelInfoReady",null),d([m({readOnly:!0})],cn.prototype,"spatialReference",null),d([m({readOnly:!0})],cn.prototype,"extent",null),d([m({readOnly:!0})],cn.prototype,"heightModelInfo",null),d([m({readOnly:!0})],cn.prototype,"vcsWkid",null),d([m({readOnly:!0})],cn.prototype,"latestVcsWkid",null),d([m({readOnly:!0})],cn.prototype,"viewingMode",null),d([m({readOnly:!0})],cn.prototype,"tileInfo",null),d([m({readOnly:!0})],cn.prototype,"mapCollections",null),d([m({readOnly:!0})],cn.prototype,"_allLayers",null),d([m({readOnly:!0})],cn.prototype,"_spatialReferenceTask",null),d([m({readOnly:!0})],cn.prototype,"_tileInfoTask",null),d([m({readOnly:!0})],cn.prototype,"_heightModelInfoTask",null),d([m({readOnly:!0})],cn.prototype,"_extentCandidatesTask",null),d([m()],cn.prototype,"_extentTask",null),d([m()],cn.prototype,"_projectExtentTask",void 0),cn=d([F("esri.views.support.DefaultsFromMap")],cn);let pdt=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var DR;let Rt=DR=class extends Xn.EventedMixin(hB(Pe)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new iw,this.updatingHandles=new em,this.allLayerViews=new FP({getCollections:()=>{var e,r,i;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:mdt}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new _T,this.analyses=new rA,this.typeSpecificPreconditionsReady=!0,this.layerViews=new St,this.magnifier=new aLe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Kht,this.navigation=new yLe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new Hht(this),this.persistableViewModels=new St,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(pe(()=>this.preconditionsReady,e=>{var i,n;const r=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,DR.views.add(this)):(this._lockedSpatialReference=null,DR.views.remove(this)),this.notifyChange("spatialReference"),!e&&r)(i=this.toolViewManager)==null||i.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(n=this.layerViewManager)==null||n.clear(),this._teardown();else if(e&&!r){try{this._startup()}catch(s){return void queueMicrotask(()=>{console.error("View._startup failed",s),this.fatalError=new B("startup-error",null,s)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},ei))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,qT(()=>this.ready)))),this.basemapView=new j1({view:this}),this.layerViewManager=new Aht({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new ug({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new Ght({view:this}),this.addHandles([pe(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},li),pe(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},ei),pe(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},li)])}_setupSpatialReferenceLogger(){let t=null;this.addHandles([pe(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(e&&!this.spatialReference&&r){if(t!=null)return;const n=ri(()=>t=Ql(t));t=b_(async s=>{try{await LL(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{t=null}K.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(n,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(DR.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Me(this.graphics),this.analyses=Me(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Me(this.analysisViewManager),this.toolViewManager=Me(this.toolViewManager),this.layerViewManager=Me(this.layerViewManager),this.selectionManager=Me(this.selectionManager),this.basemapView=Me(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(r=>r.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=Me(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return K.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new cn({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||ay.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(K.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),ay.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get spatialReference(){var e,r;const t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(t&&((r=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&r.heightModelInfo)){const i=t.clone();return i.vcsWkid=this.defaultsFromMap.vcsWkid,i.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,i}return t}set spatialReference(t){const e=!yo(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??cy}set timeZone(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),r=new Set(Intl.supportedValuesOf("timeZone").map(i=>i.toLowerCase()));this._userTimeZone=t,t===cy||t===QT||e.has(t.toLowerCase())||r.has(t.toLowerCase())||K.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){var t;return((t=this.toolViewManager)==null?void 0:t.cursor)??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new FK}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}getDefaultTimeZone(){return null}importLayerView(t){throw new B("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&K.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(up(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Rt.views=new St,d([m()],Rt.prototype,"_userSpatialReference",void 0),d([m()],Rt.prototype,"activeTool",null),d([m({readOnly:!0})],Rt.prototype,"allLayerViews",void 0),d([m()],Rt.prototype,"groundView",void 0),d([m()],Rt.prototype,"animation",null),d([m()],Rt.prototype,"basemapView",void 0),d([m()],Rt.prototype,"center",null),d([m({readOnly:!0})],Rt.prototype,"_defaultsFromMapSettings",null),d([m()],Rt.prototype,"defaultsFromMap",null),d([m()],Rt.prototype,"fatalError",void 0),d([m({type:br})],Rt.prototype,"extent",null),d([m(Hz(_T,"graphics"))],Rt.prototype,"graphics",void 0),d([m(Hz(rA,"analyses"))],Rt.prototype,"analyses",void 0),d([m({readOnly:!0,type:JA})],Rt.prototype,"heightModelInfo",null),d([m({readOnly:!0})],Rt.prototype,"interacting",null),d([m({readOnly:!0})],Rt.prototype,"navigating",null),d([m({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Rt.prototype,"preconditionsReady",null),d([m({readOnly:!0})],Rt.prototype,"typeSpecificPreconditionsReady",void 0),d([m({type:St,readOnly:!0})],Rt.prototype,"layerViews",void 0),d([m()],Rt.prototype,"resolution",null),d([m({type:aLe})],Rt.prototype,"magnifier",void 0),d([m({value:null,type:BPe})],Rt.prototype,"map",null),d([m()],Rt.prototype,"padding",void 0),d([m({readOnly:!0})],Rt.prototype,"ready",void 0),d([m({type:Ve})],Rt.prototype,"spatialReference",null),d([m()],Rt.prototype,"spatialReferenceWarningDelay",void 0),d([m()],Rt.prototype,"stationary",null),d([m({readOnly:!0})],Rt.prototype,"supportsGround",void 0),d([m({type:hw})],Rt.prototype,"timeExtent",void 0),d([m({type:String,nonNullable:!0})],Rt.prototype,"timeZone",null),d([m()],Rt.prototype,"tools",null),d([m()],Rt.prototype,"toolViewManager",void 0),d([m({readOnly:!0})],Rt.prototype,"type",void 0),d([m({type:Number})],Rt.prototype,"scale",void 0),d([m({readOnly:!0})],Rt.prototype,"updating",void 0),d([m({readOnly:!0})],Rt.prototype,"initialExtentRequired",void 0),d([m({readOnly:!0})],Rt.prototype,"initialExtent",null),d([m()],Rt.prototype,"cursor",null),d([m({readOnly:!0})],Rt.prototype,"input",void 0),d([m({type:yLe,nonNullable:!0})],Rt.prototype,"navigation",void 0),d([m()],Rt.prototype,"layerViewManager",void 0),d([m()],Rt.prototype,"analysisViewManager",void 0),d([m()],Rt.prototype,"selectionManager",void 0),d([m()],Rt.prototype,"width",void 0),d([m()],Rt.prototype,"height",void 0),d([m({readOnly:!0})],Rt.prototype,"resizing",void 0),d([m({value:null,readOnly:!0})],Rt.prototype,"size",null),d([m({readOnly:!0})],Rt.prototype,"suspended",void 0),d([m({readOnly:!0})],Rt.prototype,"viewEvents",void 0),d([m({readOnly:!0})],Rt.prototype,"persistableViewModels",void 0),d([m()],Rt.prototype,"_isValid",void 0),d([m()],Rt.prototype,"_readyCycleForced",void 0),d([m()],Rt.prototype,"_lockedSpatialReference",void 0),d([m()],Rt.prototype,"_userTimeZone",void 0),d([m()],Rt.prototype,"_lockedTimeZone",void 0),d([m({type:FK})],Rt.prototype,"theme",void 0),d([m({readOnly:!0,type:FK})],Rt.prototype,"effectiveTheme",null),Rt=DR=d([F("esri.views.View")],Rt);const fdt=Rt;function mdt(t){return t.layerViews}let q1=class extends lz{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=ma(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new B("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,r){r||(r=Xu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",r)}};d([m({readOnly:!0})],q1.prototype,"done",null),d([m({readOnly:!0,type:String})],q1.prototype,"state",void 0),d([m()],q1.prototype,"target",void 0),q1=d([F("esri.views.ViewAnimation")],q1),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(q1||(q1={}));const aA=q1,nM=()=>re(()=>import("./TileLayerView3D-Cuoj_acH.js"),__vite__mapDeps([82,83,84,85,86,87,88,89])),oge=()=>re(()=>import("./ElevationLayerView3D-Byc7DiTi.js"),__vite__mapDeps([90,83,84,85])),age={"base-dynamic":()=>re(()=>import("./BaseDynamicLayerView3D-C6ousWPY.js"),__vite__mapDeps([91,92,83,93,94,85,86])),"base-elevation":oge,"base-tile":nM,"bing-maps":nM,"building-scene":()=>re(()=>import("./BuildingSceneLayerView3D-CYVqfQJG.js"),__vite__mapDeps([95,96,97,66,67,68,69,70,71,72,73,74,75,76,65,77,23,24,98,99,100,101,53,78,102,103,104,105,106,107,81,108,26,20,21,88,22,15,25,8,9,10,11,18,19,93,83,109,85,86,110,52,111,112])),csv:()=>re(()=>import("./CSVLayerView3D-BO7zTaHF.js"),__vite__mapDeps([113,104,105,106,107,81,108,26,20,21,71,88,22,23,24,15,25,8,9,10,11,18,19,93,83,109,70,85,86])),dimension:()=>re(()=>import("./DimensionLayerView3D-BqE3VcNn.js"),__vite__mapDeps([114,83,85])),elevation:oge,feature:()=>re(()=>import("./FeatureLayerView3D-B3Pq8C8n.js"),__vite__mapDeps([103,104,105,106,107,81,108,26,20,21,71,88,22,23,24,15,25,8,9,10,11,18,19,93,83,109,70,85,86])),geojson:()=>re(()=>import("./GeoJSONLayerView3D-BHn35LDG.js"),__vite__mapDeps([115,104,105,106,107,81,108,26,20,21,71,88,22,23,24,15,25,8,9,10,11,18,19,93,83,109,70,85,86])),graphics:()=>re(()=>import("./GraphicsLayerView3D-B3BtgfG1.js"),__vite__mapDeps([116,83,107,117,108,26,20,21,93,85])),group:()=>re(()=>import("./GroupLayerView-8FTgp5nh.js"),__vite__mapDeps([118,85])),imagery:()=>re(()=>import("./ImageryLayerView3D-DGw2hUfu.js"),__vite__mapDeps([119,92,83,93,94,85,86])),"integrated-mesh":()=>re(()=>import("./IntegratedMeshLayerView3D-DwdLHlBx.js"),__vite__mapDeps([120,98,99,100,101,53,78,102,103,104,105,106,107,81,108,26,20,21,71,88,22,23,24,15,25,8,9,10,11,18,19,93,83,109,70,85,86,110,52])),"integrated-mesh-3dtiles":()=>re(()=>import("./IntegratedMesh3DTilesLayerView3D-cQ0lWynC.js"),__vite__mapDeps([121,99,100,60,83,85])),"line-of-sight":()=>re(()=>import("./LineOfSightLayerView3D-BOoyqcV_.js"),__vite__mapDeps([122,83,85])),"map-image":()=>re(()=>import("./MapImageLayerView3D-BWFF9hx0.js"),__vite__mapDeps([123,92,83,93,94,85,86,124,88,87,89])),media:()=>re(()=>import("./MediaLayerView3D-DywLOphR.js"),__vite__mapDeps([125,126,127,83,94,85])),"ogc-feature":()=>re(()=>import("./OGCFeatureLayerView3D-Bi9oWcUK.js"),__vite__mapDeps([128,104,105,106,107,81,108,26,20,21,71,88,22,23,24,15,25,8,9,10,11,18,19,93,83,109,70,85,86])),"open-street-map":nM,"oriented-imagery":()=>re(()=>import("./FeatureLayerView3D-B3Pq8C8n.js"),__vite__mapDeps([103,104,105,106,107,81,108,26,20,21,71,88,22,23,24,15,25,8,9,10,11,18,19,93,83,109,70,85,86])),"point-cloud":()=>re(()=>import("./PointCloudLayerView3D-CzYyKux8.js"),__vite__mapDeps([129,83,46,47,130,85])),voxel:()=>re(()=>import("./VoxelLayerView3D-VAK_WjGf.js"),__vite__mapDeps([131,83,130,85])),route:()=>re(()=>import("./RouteLayerView3D-Di3KC2Vj.js"),__vite__mapDeps([132,133,83,117,108,26,20,21,93,109,85])),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?re(()=>import("./SceneLayerView3D-CLR1nuY1.js"),__vite__mapDeps([134,78,23,24,71,88,98,99,100,101,53,102,103,104,105,106,107,81,108,26,20,21,22,15,25,8,9,10,11,18,19,93,83,109,70,85,86,110,52,135,112,111,130])):re(()=>import("./SceneLayerGraphicsView3D-CO5MdUX0.js"),__vite__mapDeps([136,101,100,53,78,102,103,104,105,106,107,81,108,26,20,21,71,88,22,23,24,15,25,8,9,10,11,18,19,93,83,109,70,85,86,135,112,130])),stream:()=>re(()=>import("./StreamLayerView3D-BeQ_NWIm.js"),__vite__mapDeps([137,43,44,109,105,106,107,81,108,26,20,21,71,88,22,23,24,15,25,8,9,10,11,18,19,93,83,85])),tile:nM,"imagery-tile":()=>re(()=>import("./ImageryTileLayerView3D-B9Bdx6Q8.js"),__vite__mapDeps([138,51,83,84,85,86,89])),"vector-tile":()=>re(()=>import("./VectorTileLayerView3D-BtKhFpsN.js"),__vite__mapDeps([139,40,39,140,58,83,84,85])),wcs:()=>re(()=>import("./ImageryTileLayerView3D-B9Bdx6Q8.js"),__vite__mapDeps([138,51,83,84,85,86,89])),"web-tile":nM,wfs:()=>re(()=>import("./WFSLayerView3D-CDjNjXYk.js"),__vite__mapDeps([141,104,105,106,107,81,108,26,20,21,71,88,22,23,24,15,25,8,9,10,11,18,19,93,83,109,70,85,86])),wms:()=>re(()=>import("./WMSLayerView3D-OH3OJvS9.js"),__vite__mapDeps([142,92,83,93,94,85,86,143])),wmts:()=>re(()=>import("./WMTSLayerView3D-K3fA-7xr.js"),__vite__mapDeps([144,83,84,85,86])),catalog:null,"catalog-dynamic-group":null,"catalog-footprint":null,"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function gdt(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new B(`${r}:view-not-supported`,`${e} is not supported in 3D`)}const lge={hasLayerViewModule:t=>age[t.type]!=null,importLayerView:t=>{const e=age[t.type];if(e==null)throw gdt(t);return e(t)}},cge="analyses-owner-handles";var a3,xS;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(a3||(a3={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(xS||(xS={}));let zx=class extends Pe{constructor(e){super(e),this._allAnalysisViews=new St,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=uge(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(gr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(gr()),this._attachedToViewResolver=uge()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const r=this._items.get(e);if(r==null||r.state.list===xS.REMOVED)throw new B("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return r.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),cge)}_disconnectOwners(){this.removeHandles(cge),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const n of e)this._addAnalysis(n);const r=e.on("after-add",n=>this._addAnalysis(n.item)),i=e.on("after-remove",n=>this._removeAnalysis(n.item));return ri(()=>{r.remove(),i.remove();for(const n of e)this._removeAnalysis(n)})}_addAnalysis(e){const r=this._items.get(e);if(r==null){const i={state:{view:a3.PENDING,list:xS.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=b_(n=>this._createAnalysisViewPromise(i,n))}else r.state.list=xS.ADDED}_removeAnalysis(e){const r=this._items.get(e);r!=null?(r.state.list=xS.REMOVED,this._scheduleUpdate()):K.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=m2(()=>this._update()))}_update(){this._scheduledUpdateHandle=Pi(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===xS.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case a3.PENDING:e.createAnalysisViewTask=Ql(e.createAnalysisViewTask);break;case a3.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Me(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,r){const i=e.analysis,n=i.type,s=this._analysisModules[n];if(this._creatingViewCount+=1,s.module==null)try{s.module=await this._loadAnalysisModule(n)}catch(a){throw this._creatingViewCount-=1,a}if(Ms(r))throw this._creatingViewCount-=1,gr("AnalysisView creation aborted");const o=new s.module.default({analysis:i,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(Ms(r))throw this._creatingViewCount-=1,o.destroy(),gr("AnalysisView creation aborted");return e.view=o,e.state.view=a3.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return re(()=>import("./AreaMeasurementAnalysisView3D-Dv1Q6qhQ.js"),__vite__mapDeps([145,146,147,63,148,149,14,150,151]));case"dimension":return re(()=>import("./DimensionAnalysisView3D-B9qmUWKj.js").then(r=>r.D),__vite__mapDeps([152,148,153,147,63,149,14,150,154,155,156,94,140,157,151,71,88,106]));case"direct-line-measurement":return re(()=>import("./DirectLineMeasurementAnalysisView3D-CAfnQAKl.js"),__vite__mapDeps([158,146,147,63,148,149,14,150,154]));case"line-of-sight":return re(()=>import("./LineOfSightAnalysisView3D-CiBwBwIs.js"),__vite__mapDeps([159,148,160,155,157]));case"slice":return re(()=>import("./SliceAnalysisView3D-Cq_uKhUj.js"),__vite__mapDeps([161,148,97,66,67,68,69,70,71,72,73,74,75,76,65,77,155,156,94]))}}};function uge(){const t=ma();return t.promise.catch(()=>{}),t}d([m()],zx.prototype,"updating",null),d([m({constructOnly:!0})],zx.prototype,"view",void 0),d([m()],zx.prototype,"_allAnalysisViews",void 0),d([m()],zx.prototype,"_creatingViewCount",void 0),zx=d([F("esri.views.3d.analysis.AnalysisViewManager3D")],zx);const ydt=zx;let s0=class extends Pe{constructor(e){super(e),this.collision=new NR,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Fe.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Fe.Local?this._set("altitude",e):K.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?we(e,this.altitude.min,this.altitude.max):e}clampTilt(e,r){if(!this.tilt)return r;const i=this.tilt(e);return we(r,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Fe.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(r,i=TH)=>(i.min=Oa.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?m6([[4e3,Oa.max],[1e4,Ut(88)],[6e6,Ut(88)]]):()=>Oa.max;return(r,i=TH)=>(i.min=Oa.min,i.max=e(r),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?m6([[4e3,Oa.max],[5e4,Ut(88)],[6e6,Ut(88)],[2e7,Oa.min]]):m6([[3e5,Oa.max],[3e6,Ut(88)],[6e6,Ut(88)],[2e7,Oa.min]]);return(r,i=TH)=>(i.min=Oa.min,i.max=e(r),i)}};function _dt(t){return{min:-2e5,max:4*t.radius}}d([m()],s0.prototype,"altitude",null),d([m({readOnly:!0})],s0.prototype,"collision",void 0),d([m()],s0.prototype,"distance",void 0),d([m({readOnly:!0})],s0.prototype,"minimumPoiDistance",void 0),d([m()],s0.prototype,"tilt",void 0),d([m({constructOnly:!0})],s0.prototype,"mode",void 0),s0=d([F("esri.views.3d.state.Constraints")],s0);const hge=_dt(ni),Oa={min:Ut(.5),max:Ut(179.5)},TH={min:0,max:0};let NR=class extends Pe{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};d([m({type:Boolean})],NR.prototype,"enabled",void 0),d([m({type:Number})],NR.prototype,"elevationMargin",void 0),NR=d([F("esri.views.3d.state.Constraints.CollisionConstraint")],NR);let l3=class extends Tb{constructor(){super(...arguments),this.min=hge.min,this.max=hge.max}};d([m({type:Number})],l3.prototype,"min",void 0),d([m({type:Number})],l3.prototype,"max",void 0),l3=d([F("esri.views.3d.constraints.AltitudeConstraint")],l3);let v0=class extends Tb{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,r){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==r&&this._set("far",r))}};d([m({type:Number,value:1e-8})],v0.prototype,"near",null),d([Dr("near")],v0.prototype,"castNear",null),d([m({type:Number,value:1e-8})],v0.prototype,"far",null),d([Dr("far")],v0.prototype,"castFar",null),d([m({type:["auto","manual"]})],v0.prototype,"mode",void 0),v0=d([F("esri.views.3d.constraints.ClipDistanceConstraint")],v0);const zK={min:ul(Oa.min),max:ul(Oa.max)};let SS=class extends Tb{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return we(e,zK.min,zK.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};d([m({type:["auto","manual"]})],SS.prototype,"mode",void 0),d([m({type:Number,value:zK.max})],SS.prototype,"max",null),d([Dr("max")],SS.prototype,"castMax",null),SS=d([F("esri.views.3d.constraints.TiltConstraint")],SS);let TS=class extends Tb{constructor(){super(...arguments),this.tilt=new SS,this.altitude=new l3,this.clipDistance=new v0}};d([m({type:SS})],TS.prototype,"tilt",void 0),d([m({type:l3})],TS.prototype,"altitude",void 0),d([m({type:v0})],TS.prototype,"clipDistance",void 0),TS=d([F("esri.views.3d.constraints.Constraints")],TS);var VK;let gd=VK=class extends Se{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,r){e[r]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,r){t&&(e[r]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new VK(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};d([m({readOnly:!0,type:["sun"],json:{write:!0}})],gd.prototype,"type",void 0),d([m({type:Date,json:{type:Number,write:{target:"datetime"}}})],gd.prototype,"date",void 0),d([Xe("date",["datetime"])],gd.prototype,"readDate",null),d([nt("date")],gd.prototype,"writeDate",null),d([m({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],gd.prototype,"directShadowsEnabled",void 0),d([Xe("directShadowsEnabled",["directShadows"])],gd.prototype,"readDirectShadowsEnabled",null),d([nt("directShadowsEnabled")],gd.prototype,"writedirectShadowsEnabled",null),d([m({type:Number,json:{write:!0}})],gd.prototype,"displayUTCOffset",void 0),d([nt("displayUTCOffset")],gd.prototype,"writeDisplayUTCOffset",null),gd=VK=d([F("esri.webscene.SunLighting")],gd);const hD=gd;var mC;let hg=mC=class extends Xn.EventedMixin(hD){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),r=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get ambientOcclusionEnabled(){return L0(K.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){L0(K.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return L0(K.getLogger(this),"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){L0(K.getLogger(this),"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new mC(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const r=mC.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let i=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const n=mC.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==n&&(A5.target=this,A5.timezoneOffset=n,this.emit("timezone-will-change",A5),A5.target=null),t!=null)return isNaN(t.getTime())||i!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new mC({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([m({type:Boolean})],hg.prototype,"cameraTrackingEnabled",void 0),d([m({type:Boolean})],hg.prototype,"ambientOcclusionEnabled",null),d([m({type:Boolean})],hg.prototype,"waterReflectionEnabled",null),d([m({type:Date})],hg.prototype,"defaultDate",null),d([m({type:Date})],hg.prototype,"date",null),hg=mC=d([F("esri.views.3d.environment.SunLighting")],hg),function(t){function e({hours:r,minutes:i,seconds:n}){return Math.round(r+i/60+n/3600)}t.calculateTimezoneOffset=e}(hg||(hg={}));const A5={target:null,timezoneOffset:0},Vx=hg;var BK;let FR=BK=class extends Se{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new BK(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};d([m({readOnly:!0,type:["virtual"],json:{write:!0}})],FR.prototype,"type",void 0),d([m({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],FR.prototype,"directShadowsEnabled",void 0),FR=BK=d([F("esri.webscene.VirtualLighting")],FR);const B7=FR;var Z6;let gC=Z6=class extends Xn.EventedMixin(B7){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return L0(K.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){L0(K.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return L0(K.getLogger(this),"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){L0(K.getLogger(this),"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new Z6({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new Z6(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([m({type:Boolean})],gC.prototype,"ambientOcclusionEnabled",null),d([m({type:Boolean})],gC.prototype,"waterReflectionEnabled",null),d([m({type:Boolean})],gC.prototype,"cameraTrackingEnabled",void 0),gC=Z6=d([F("esri.views.3d.environment.VirtualLighting")],gC);const kR=gC,vdt={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Vx,virtual:kR}};var GK;let RI=GK=class extends Pe{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new GK({quality:this.quality})}};d([m({type:["low","high"],value:"low"})],RI.prototype,"quality",null),RI=GK=d([F("esri.views.3d.environment.SceneViewAtmosphere")],RI);var jK;let UR=jK=class extends Se{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new jK({cloudCover:this.cloudCover})}};d([gt({sunny:"sunny"})],UR.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],UR.prototype,"cloudCover",void 0),UR=jK=d([F("esri.views.3d.environment.SunnyWeather")],UR);const HK=UR;var qK;let zR=qK=class extends Se{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new qK({cloudCover:this.cloudCover})}};d([gt({cloudy:"cloudy"})],zR.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],zR.prototype,"cloudCover",void 0),zR=qK=d([F("esri.views.3d.environment.CloudyWeather")],zR);const bdt=zR;var WK;let VR=WK=class extends Se{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new WK({fogStrength:this.fogStrength})}};d([gt({foggy:"foggy"})],VR.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],VR.prototype,"fogStrength",void 0),VR=WK=d([F("esri.views.3d.environment.FoggyWeather")],VR);const wdt=VR;var YK;let yC=YK=class extends Se{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new YK({cloudCover:this.cloudCover,precipitation:this.precipitation})}};d([gt({rainy:"rainy"})],yC.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],yC.prototype,"cloudCover",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],yC.prototype,"precipitation",void 0),yC=YK=d([F("esri.views.3d.environment.RainyWeather")],yC);const xdt=yC;var XK;let Bx=XK=class extends Se{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new XK({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};d([gt({snowy:"snowy"})],Bx.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Bx.prototype,"cloudCover",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Bx.prototype,"precipitation",void 0),d([m({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],Bx.prototype,"snowCover",void 0),Bx=XK=d([F("esri.views.3d.environment.SnowyWeather")],Bx);const Sdt=Bx,PLe={key:"type",base:HK,typeMap:{sunny:HK,cloudy:bdt,rainy:xdt,snowy:Sdt,foggy:wdt}},Tdt=Object.keys(PLe.typeMap);function Edt(t,e){return!!Tdt.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const E0=1e4,Cdt=1e5,Pdt={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:hD,virtual:B7}};let J6=class extends Se{constructor(e){super(e)}clone(){}};d([m({readOnly:!0,json:{read:!1}})],J6.prototype,"type",void 0),J6=d([F("esri.webscene.background.Background")],J6);const ALe=J6;var ZK;const Adt={...M_,nonNullable:!0};let BR=ZK=class extends ALe{constructor(t){super(t),this.type="color",this.color=new De([0,0,0,1])}clone(){return new ZK(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};d([gt({color:"color"},{readOnly:!0})],BR.prototype,"type",void 0),d([m(Adt)],BR.prototype,"color",void 0),BR=ZK=d([F("esri.webscene.background.ColorBackground")],BR);const OLe=BR,dge={base:ALe,key:"type",typeMap:{color:OLe}};function Odt(t){return(e,r,i)=>{if(!e)return e;for(const n in t.typeMap)if(e.type===n){const s=new t.typeMap[n];return s.read(e,i),s}}}const Mdt={types:dge,json:{read:Odt(dge),write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.isPresentation})}}};var JK;const pge=(t,e,r)=>({enabled:!r||!r.isPresentation});let W1=JK=class extends Se{constructor(t){super(t),this.lighting=new hD,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){Edt(t==null?void 0:t.type,K.getLogger(this))&&this._set("weather",t)}clone(){return new JK(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?B7.prototype.clone.call(this.lighting):hD.prototype.clone.call(this.lighting),background:ae(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};d([m({types:Pdt,nonNullable:!0,json:{write:!0}})],W1.prototype,"lighting",void 0),d([m(Mdt)],W1.prototype,"background",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:pge}}})],W1.prototype,"atmosphereEnabled",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:pge}}})],W1.prototype,"starsEnabled",void 0),d([m({types:PLe,nonNullable:!0,json:{write:!0},value:new HK})],W1.prototype,"weather",null),W1=JK=d([F("esri.webscene.Environment")],W1);const MLe=W1;var GR;let _C=GR=class extends MLe{constructor(t){super(t),this.atmosphere=new RI,this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}destroy(){this.atmosphere.destroy()}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new GR({...e,lighting:e.lighting?e.lighting.type==="virtual"?kR.fromWebsceneLighting(e.lighting):Vx.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const e=this._convertLighting(t);return e!==t&&this.addHandles(HEe(e)),e}_convertLighting(t){var e,r;return t?t instanceof Vx||t instanceof kR?t:t instanceof hD?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new Vx({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof B7?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new kR({...t.cloneConstructProperties(),...(r=this.lighting)==null?void 0:r.cloneNonPersistentConstructProperties()}):sy(vdt,t):new Vx}clone(){return new GR({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ae(this.background)})}cloneWithWebsceneEnvironment(t){return new GR({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ae(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):Vx.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):kR.fromWebsceneLighting(t.lighting);default:return t.lighting,Vx.fromWebsceneLighting(t.lighting)}}};d([m({type:RI,json:{read:!1},nonNullable:!0})],_C.prototype,"atmosphere",void 0),d([m({nonNullable:!0})],_C.prototype,"lighting",void 0),d([Dr("lighting")],_C.prototype,"castLighting",null),_C=GR=d([F("esri.views.3d.environment.SceneViewEnvironment")],_C);const vC=_C;function Rdt(t,e,r){if(e==null)return!1;const i=zAe(e);return i!=null&&(i(t,0,sM,0),r!==sM&&(r[0]=sM[0],r[1]=sM[1],r.length>2&&(r[2]=sM[2])),!0)}const sM=C();function $dt(t,e){O5[0]=t.x,O5[1]=t.y;const r=t.z;return O5[2]=r!==void 0?r:0,Rdt(O5,t.spatialReference,e)}const O5=C();var Ya;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(Ya||(Ya={}));function RLe(t){return"r"in t&&"g"in t&&"b"in t}function $Le(t){return"h"in t&&"s"in t&&"v"in t}function ILe(t){return"l"in t&&"a"in t&&"b"in t}function LLe(t){return"l"in t&&"c"in t&&"h"in t}function Idt(t){return"x"in t&&"y"in t&&"z"in t}const Ldt=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],Ddt=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function DLe(t,e){const r=[];let i,n;if(t[0].length!==e.length)throw new Error("dimensions do not match");const s=t.length,o=t[0].length;let a=0;for(i=0;i<s;i++){for(a=0,n=0;n<o;n++)a+=t[i][n]*e[n];r.push(a)}return r}function NLe(t){const e=[t.r/255,t.g/255,t.b/255].map(i=>i<=.04045?i/12.92:((i+.055)/1.055)**2.4),r=DLe(Ldt,e);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function tae(t){const e=DLe(Ddt,[t.x/100,t.y/100,t.z/100]).map(r=>{const i=r<=.0031308?12.92*r:1.055*r**.4166666666666667-.055;return Math.min(1,Math.max(i,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function FLe(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(r=>r>.008856451679035631?r**.3333333333333333:7.787037037037035*r+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function kLe(t){const e=t.l,r=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(i=>i>6/29?i**3:3*(6/29)**2*(i-4/29));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function Ndt(t){const e=t.l,r=t.a,i=t.b,n=Math.sqrt(r*r+i*i);let s=Math.atan2(i,r);return s=s>0?s:s+2*Math.PI,{l:e,c:n,h:s}}function Fdt(t){const e=t.l,r=t.c,i=t.h;return{l:e,a:r*Math.cos(i),b:r*Math.sin(i)}}function kdt(t){return FLe(NLe(t))}function Udt(t){return tae(kLe(t))}function zdt(t){return Ndt(FLe(NLe(t)))}function Vdt(t){return tae(kLe(Fdt(t)))}function Bdt(t){const e=t.r,r=t.g,i=t.b,n=Math.max(e,r,i),s=n-Math.min(e,r,i);let o=n,a=s===0?0:n===e?(r-i)/s%6:n===r?(i-e)/s+2:(e-r)/s+4,l=s===0?0:s/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function Gdt(t){const e=(t.h+360)%360/60,r=t.s/100,i=t.v/100*255,n=i*r,s=n*(1-Math.abs(e%2-1));let o;switch(Math.floor(e)){case 0:o={r:n,g:s,b:0};break;case 1:o={r:s,g:n,b:0};break;case 2:o={r:0,g:n,b:s};break;case 3:o={r:0,g:s,b:n};break;case 4:o={r:s,g:0,b:n};break;case 5:case 6:o={r:n,g:0,b:s};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+i-n),o.g=Math.round(o.g+i-n),o.b=Math.round(o.b+i-n),o}function rae(t){return RLe(t)?t:LLe(t)?Vdt(t):ILe(t)?Udt(t):Idt(t)?tae(t):$Le(t)?Gdt(t):t}function EZt(t){return $Le(t)?t:Bdt(rae(t))}function CZt(t){return ILe(t)?t:kdt(rae(t))}function PZt(t){return LLe(t)?t:zdt(rae(t))}function jdt(t){let{r:e,g:r,b:i,a:n}=t;return n<1&&(e=Math.round(n*e+255*(1-n)),r=Math.round(n*r+255*(1-n)),i=Math.round(n*i+255*(1-n))),new De({r:e,g:r,b:i})}function Hdt(t,e){const{r,g:i,b:n}=e!=null&&e.ignoreAlpha?t:jdt(t);return .2126*r+.7152*i+.0722*n}var QK;function AZt(t,e=QK.High){return Hdt(t,{ignoreAlpha:!0})>e?new De([0,0,0,t.a]):new De([255,255,255,t.a])}function OZt(t,e){const r=t.clone();return r.a*=e,r}function dD(t){return De.toUnitRGBA(t)}function MZt(t,e){return t===e||t!=null&&e!=null&&YT(t,e)}function RZt(t){return Xt(t[0],t[1],t[2],t.length>3?t[3]:1)}function $Zt(t,e){const r=De.toUnitRGBA(t);return r[3]*=e,r}(function(t){t[t.Low=160]="Low",t[t.High=225]="High"})(QK||(QK={}));function iae(t){return we((t-1e5)/9e5,0,1)}const KK=1e4,qdt=.085,_v=1e5;let Wdt=class{};const Li=Wdt;function T(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}(function(t){function e(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}t.int=e,t.float=r})(T||(T={}));var mn;function Jg(t,e){switch(e.textureCoordinateType){case mn.Default:return t.attributes.add(R.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case mn.Compressed:return t.attributes.add(R.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(T`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case mn.Atlas:return t.attributes.add(R.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(R.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case mn.None:return void t.vertex.code.add(T`void forwardTextureCoordinates() {}`);case mn.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(mn||(mn={}));function bp(t){t.code.add(T`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function dy(t){t.include(bp),t.code.add(T`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
return linearDepthFromRGBA(texelFetch(depthTexture, iuv, 0), nearFar);
}`)}function ULe(t){t.code.add(T`float linearizeDepth(float depth, vec2 nearFar) {
float depthNdc = depth * 2.0 - 1.0;
return (2.0 * nearFar[0] * nearFar[1]) / (depthNdc * (nearFar[1] - nearFar[0]) - (nearFar[1] + nearFar[0]));
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return linearizeDepth(depth, nearFar);
}`)}function G7(t){t.fragment.code.add(T`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var kr;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(kr||(kr={}));let Pn=class{constructor(e,r,i,n,s=null){if(this.name=e,this.type=r,this.arraySize=s,this.bind={[kr.Pass]:null,[kr.Draw]:null},n)switch(i){case kr.Pass:this.bind[kr.Pass]=n;break;case kr.Draw:this.bind[kr.Draw]=n}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},zt=class extends Pn{constructor(e,r){super(e,"vec3",kr.Pass,(i,n,s)=>i.setUniform3fv(e,r(n,s)))}};function R_(t){t.uniforms.add(new zt("mainLightDirection",(e,r)=>r.lighting.mainLight.direction))}function by(t){t.uniforms.add(new zt("mainLightIntensity",(e,r)=>r.lighting.mainLight.intensity))}function a9(t){R_(t.fragment),by(t.fragment),t.fragment.code.add(T`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let ci=class extends Pn{constructor(e,r){super(e,"vec2",kr.Pass,(i,n,s)=>i.setUniform2fv(e,r(n,s)))}},Or=class extends Pn{constructor(e,r){super(e,"vec4",kr.Pass,(i,n,s)=>i.setUniform4fv(e,r(n,s)))}},Ie=class extends Pn{constructor(e,r){super(e,"float",kr.Pass,(i,n,s)=>i.setUniform1f(e,r(n,s)))}},_n=class extends Pn{constructor(e,r){super(e,"mat4",kr.Pass,(i,n,s)=>i.setUniformMatrix4fv(e,r(n,s)))}};const zLe=()=>K.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let VLe=class{constructor(){this._includedModules=new Map}include(e,r){if(this._includedModules.has(e)){const i=this._includedModules.get(e);if(i!==r){zLe().error("Shader module included multiple times with different configuration.");const n=new Set;for(const s of Object.keys(i))i[s]!==e[s]&&n.add(s);for(const s of Object.keys(e))i[s]!==e[s]&&n.add(s);n.forEach(s=>console.error(`  ${s}: current ${i[s]} new ${e[s]}`))}}else this._includedModules.set(e,r),e(this.builder,r)}},Fr=class extends VLe{constructor(){super(...arguments),this.vertex=new fge,this.fragment=new fge,this.attributes=new Zdt,this.varyings=new Jdt,this.extensions=new eee,this.constants=new BLe,this.outputs=new ree}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),n=this.varyings.generateSource(e),s=e==="vertex"?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l=e==="vertex"?Kdt:Qdt,c=this.constants.generateSource().concat(s.constants.generateSource()),u=this.outputs.generateSource(e);return`#version 300 es
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${n.join(`
`)}

${u.join(`
`)}

${a.join(`
`)}`}generateBindPass(e){const r=new Map;this.vertex.uniforms.entries.forEach(s=>{const o=s.bind[kr.Pass];o&&r.set(s.name,o)}),this.fragment.uniforms.entries.forEach(s=>{const o=s.bind[kr.Pass];o&&r.set(s.name,o)});const i=Array.from(r.values()),n=i.length;return(s,o)=>{for(let a=0;a<n;++a)i[a](e,s,o)}}generateBindDraw(e){const r=new Map;this.vertex.uniforms.entries.forEach(s=>{const o=s.bind[kr.Draw];o&&r.set(s.name,o)}),this.fragment.uniforms.entries.forEach(s=>{const o=s.bind[kr.Draw];o&&r.set(s.name,o)});const i=Array.from(r.values()),n=i.length;return(s,o,a)=>{for(let l=0;l<n;++l)i[l](e,s,o,a)}}},Ydt=class{constructor(){this._entries=new Map}add(...e){for(const r of e)this._add(r)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new B(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else zLe().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},Xdt=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},fge=class extends VLe{constructor(){super(...arguments),this.uniforms=new Ydt,this.code=new Xdt,this.constants=new BLe}get builder(){return this}},Zdt=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(e){return e==="fragment"?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}},Jdt=class{constructor(){this._entries=new Map}add(e,r){this._entries.has(e)&&_t(this._entries.get(e)===r),this._entries.set(e,r)}generateSource(e){const r=new Array;return this._entries.forEach((i,n)=>r.push(e==="vertex"?`out ${i} ${n};`:`in ${i} ${n};`)),r}},eee=class tee{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const r=e==="vertex"?tee.ALLOWLIST_VERTEX:tee.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}};eee.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],eee.ALLOWLIST_VERTEX=[];let ree=class iee{constructor(){this._entries=new Map}add(e,r,i=0){const n=this._entries.get(i);n?_t(n.name===e&&n.type===r,`Fragment shader output location ${i} occupied`):this._entries.set(i,{name:e,type:r})}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:iee.DEFAULT_NAME,type:iee.DEFAULT_TYPE});const r=new Array;return this._entries.forEach((i,n)=>r.push(`layout(location = ${n}) out ${i.type} ${i.name};`)),r}};ree.DEFAULT_TYPE="vec4",ree.DEFAULT_NAME="fragColor";let BLe=class ks{constructor(){this._entries=new Set}add(e,r,i){let n="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":n=ks._numberToFloatStr(i);break;case"int":n=ks._numberToIntStr(i);break;case"bool":n=i.toString();break;case"vec2":n=`vec2(${ks._numberToFloatStr(i[0])},                            ${ks._numberToFloatStr(i[1])})`;break;case"vec3":n=`vec3(${ks._numberToFloatStr(i[0])},                            ${ks._numberToFloatStr(i[1])},                            ${ks._numberToFloatStr(i[2])})`;break;case"vec4":n=`vec4(${ks._numberToFloatStr(i[0])},                            ${ks._numberToFloatStr(i[1])},                            ${ks._numberToFloatStr(i[2])},                            ${ks._numberToFloatStr(i[3])})`;break;case"ivec2":n=`ivec2(${ks._numberToIntStr(i[0])},                             ${ks._numberToIntStr(i[1])})`;break;case"ivec3":n=`ivec3(${ks._numberToIntStr(i[0])},                             ${ks._numberToIntStr(i[1])},                             ${ks._numberToIntStr(i[2])})`;break;case"ivec4":n=`ivec4(${ks._numberToIntStr(i[0])},                             ${ks._numberToIntStr(i[1])},                             ${ks._numberToIntStr(i[2])},                             ${ks._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${r}(${Array.prototype.map.call(i,s=>ks._numberToFloatStr(s)).join(", ")})`}return this._entries.add(`const ${r} ${e} = ${n};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const Qdt=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,Kdt=`precision highp float;
precision highp sampler2D;`;let ft=class extends Pn{constructor(e,r){super(e,"sampler2D",kr.Pass,(i,n,s)=>i.bindTexture(e,r(n,s)))}};const K3=Ce(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),EH=3,CH=Ce(EH*parseFloat(65e-8.toFixed(6)),EH*parseFloat(1881e-9.toFixed(6)),EH*parseFloat(85e-9.toFixed(6))),ept=3996e-9,tpt=Ce(parseFloat(Number(K3[0]+CH[0]).toFixed(6)),parseFloat(Number(K3[1]+CH[1]).toFixed(6)),parseFloat(Number(K3[2]+CH[2]).toFixed(6)));function GLe(t){const e=new Fr;e.attributes.add(R.POSITION,"vec2"),e.include(Jg,{textureCoordinateType:mn.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add(new _n("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new _n("inverseViewMatrix",(n,s)=>zA(rpt,s.camera.viewMatrix))),r.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new zt("backgroundColor",n=>n.backgroundColor),new ci("radii",n=>n.radii),new zt("cameraPosition",(n,s)=>s.camera.eye),new Or("heightParameters",n=>n.heightParameters),new Ie("innerFadeDistance",n=>n.innerFadeDistance),new Ie("altitudeFade",n=>n.altitudeFade),new ft("depthTexture",n=>n.depthTexture),new Ie("hazeStrength",n=>n.hazeStrength)),i.constants.add("betaRayleigh","vec3",K3),i.constants.add("betaCombined","vec3",tpt),i.constants.add("betaMie","float",ept),i.constants.add("scaleHeight","float",qdt*_v),R_(i),e.include(G7),t.haze&&(i.include(dy),i.uniforms.add(new ci("nearFar",(n,s)=>s.camera.nearFar))),i.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(T`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(T`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(T`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?T`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":T`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":T`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?T`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:T`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":T`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?T`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?T`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?T`cameraSpaceRay *= -textureBilinear(vuv0);`:T`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:T`${t.reduced?"":T`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?T`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:T`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":T`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const rpt=xe(),ipt=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:K3,build:GLe},Symbol.toStringTag,{value:"Module"}));let Vr=class{constructor(e,r){this._module=e,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var Mi,dr,Ee,py,Tt,Vf,lA,et,si,vn,Kt,nr,In,Ot,at,Ks,Ia,Lr,Ph,Ja;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Mi||(Mi={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(dr||(dr={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Ee||(Ee={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(py||(py={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(Tt||(Tt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Vf||(Vf={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(lA||(lA={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(et||(et={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(si||(si={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(vn||(vn={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Kt||(Kt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(nr||(nr={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(In||(In={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Ot||(Ot={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(at||(at={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Ks||(Ks={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Ia||(Ia={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(Lr||(Lr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Ph||(Ph={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Ja||(Ja={}));const PH=33984;var ss,Vl,nee;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.TransformFeedback=7]="TransformFeedback",t[t.Sync=8]="Sync",t[t.UNCOUNTED=9]="UNCOUNTED",t[t.LinesOfCode=9]="LinesOfCode",t[t.Uniform=10]="Uniform",t[t.COUNT=11]="COUNT"})(ss||(ss={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Vl||(Vl={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK"}(nee||(nee={}));const cA=33306;var Bn,mge,gge,yge,l9,see,_ge;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(Bn||(Bn={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(mge||(mge={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(gge||(gge={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(yge||(yge={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(l9||(l9={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(see||(see={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(_ge||(_ge={}));let Zr=class{constructor(e,r,i){this.release=i,this.initializeConfiguration(e,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}destroy(){this._program=wt(this._program),this._pipeline=this._configuration=null}reload(e){wt(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return dr.TRIANGLES}getPipeline(e,r,i){return this._pipeline}initializeConfiguration(e,r){}};const Nr=new Map([[R.POSITION,0],[R.NORMAL,1],[R.NORMALCOMPRESSED,1],[R.UV0,2],[R.COLOR,3],[R.COLORFEATUREATTRIBUTE,3],[R.SIZE,4],[R.TANGENT,4],[R.CENTEROFFSETANDDISTANCE,5],[R.SYMBOLCOLOR,5],[R.FEATUREATTRIBUTE,6],[R.INSTANCEFEATUREATTRIBUTE,6],[R.INSTANCECOLOR,7],[R.OBJECTANDLAYERIDCOLOR,7],[R.INSTANCEOBJECTANDLAYERIDCOLOR,7],[R.INSTANCEMODEL,8],[R.INSTANCEMODELNORMAL,12],[R.INSTANCEMODELORIGINHI,11],[R.INSTANCEMODELORIGINLO,15]]),npt=()=>K.getLogger("esri.views.webgl.checkWebGLError");function spt(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const c9=!!ne("enable-feature:webgl-debug");function wf(){return c9}function oee(){return c9}function Rg(t){if(wf()){const e=t.getError();if(e){const r=spt(t,e),i=new Error().stack;npt().error(new B("webgl-error","WebGL error occurred",{message:r,stack:i}))}}}let Br=class{constructor(e,r,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new jt({deallocator:null}),this._glProgram=e.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBindPass(this),this.bindDraw=r.generateBindDraw(this),this._fragmentUniforms=wf()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,r){this._glProgram.setUniform1i(e,r?1:0)}setUniform1i(e,r){this._glProgram.setUniform1i(e,r)}setUniform1f(e,r){this._glProgram.setUniform1f(e,r)}setUniform2fv(e,r){this._glProgram.setUniform2fv(e,r)}setUniform3fv(e,r){this._glProgram.setUniform3fv(e,r)}setUniform4fv(e,r){this._glProgram.setUniform4fv(e,r)}setUniformMatrix3fv(e,r){this._glProgram.setUniformMatrix3fv(e,r)}setUniformMatrix4fv(e,r){this._glProgram.setUniformMatrix4fv(e,r)}setUniform1fv(e,r){this._glProgram.setUniform1fv(e,r)}setUniform1iv(e,r){this._glProgram.setUniform1iv(e,r)}setUniform2iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform3iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform4iv(e,r){this._glProgram.setUniform4iv(e,r)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,r){if((r==null?void 0:r.glName)==null){const n=this._textures.get(e);return n&&(this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(e)),null}let i=this._textures.get(e);return i==null?(i=this._allocTextureUnit(r),this._textures.set(e,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){var e;this._context.useProgram(this),this._textures.forEach((r,i)=>{this._context.bindTexture(r.texture,r.unit),this.setUniform1i(i,r.unit)}),(e=this._fragmentUniforms)==null||e.forEach(r=>{r.type!=="sampler2D"&&r.type!=="samplerCube"||this._textures.has(r.name)||console.error(`Texture sampler ${r.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};function qu(t,e,r=py.ADD,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function ya(t,e,r,i,n=py.ADD,s=py.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:n,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const nae={face:Vf.BACK,mode:lA.CCW},jLe={face:Vf.FRONT,mode:lA.CCW},j7=t=>t===$i.Back?nae:t===$i.Front?jLe:null,Wu={zNear:0,zFar:1},rr={r:!0,g:!0,b:!0,a:!0};function opt(t){return mpt.intern(t)}function apt(t){return gpt.intern(t)}function lpt(t){return ypt.intern(t)}function cpt(t){return _pt.intern(t)}function upt(t){return vpt.intern(t)}function hpt(t){return bpt.intern(t)}function dpt(t){return wpt.intern(t)}function ppt(t){return xpt.intern(t)}function fpt(t){return Spt.intern(t)}function Bt(t){return Tpt.intern(t)}let wy=class{constructor(e,r){this._makeKey=e,this._makeRef=r,this._interns=new Map}intern(e){if(!e)return null;const r=this._makeKey(e),i=this._interns;return i.has(r)||i.set(r,this._makeRef(e)),i.get(r)??null}};function xy(t){return"["+t.join(",")+"]"}const mpt=new wy(HLe,t=>({__tag:"Blending",...t}));function HLe(t){return t?xy([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const gpt=new wy(qLe,t=>({__tag:"Culling",...t}));function qLe(t){return t?xy([t.face,t.mode]):null}const ypt=new wy(WLe,t=>({__tag:"PolygonOffset",...t}));function WLe(t){return t?xy([t.factor,t.units]):null}const _pt=new wy(YLe,t=>({__tag:"DepthTest",...t}));function YLe(t){return t?xy([t.func]):null}const vpt=new wy(XLe,t=>({__tag:"StencilTest",...t}));function XLe(t){return t?xy([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const bpt=new wy(ZLe,t=>({__tag:"DepthWrite",...t}));function ZLe(t){return t?xy([t.zNear,t.zFar]):null}const wpt=new wy(JLe,t=>({__tag:"ColorWrite",...t}));function JLe(t){return t?xy([t.r,t.g,t.b,t.a]):null}const xpt=new wy(QLe,t=>({__tag:"StencilWrite",...t}));function QLe(t){return t?xy([t.mask]):null}const Spt=new wy(KLe,t=>({__tag:"DrawBuffers",...t}));function KLe(t){return t?xy(t.buffers):null}const Tpt=new wy(Ept,t=>({blending:opt(t.blending),culling:apt(t.culling),polygonOffset:lpt(t.polygonOffset),depthTest:cpt(t.depthTest),stencilTest:upt(t.stencilTest),depthWrite:hpt(t.depthWrite),colorWrite:dpt(t.colorWrite),stencilWrite:ppt(t.stencilWrite),drawBuffers:fpt(t.drawBuffers)}));function Ept(t){return t?xy([HLe(t.blending),qLe(t.culling),WLe(t.polygonOffset),YLe(t.depthTest),XLe(t.stencilTest),ZLe(t.depthWrite),JLe(t.colorWrite),QLe(t.stencilWrite),KLe(t.drawBuffers)]):null}let Cpt=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,r,i,n){return(i||e!==r)&&(n(e),this._pipelineInvalid=!0),e}},Ppt=class extends Li{constructor(){super(...arguments),this.heightParameters=tr(),this.radii=Ye(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=Ye(),this.backgroundColor=C()}},jR=class eDe extends Zr{initializeProgram(e){return new Br(e.rctx,eDe.shader.get().build(this.configuration),Nr)}initializePipeline(){return this.configuration.reduced?Bt({blending:qu(Ee.ONE,Ee.ZERO),depthTest:{func:si.ALWAYS},colorWrite:rr}):this.configuration.haze?Bt({blending:ya(Ee.ONE,Ee.ZERO,Ee.ONE_MINUS_SRC_COLOR,Ee.ONE),colorWrite:rr}):Bt({blending:qu(Ee.SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:si.LEQUAL},colorWrite:rr})}};jR.shader=new Vr(ipt,()=>re(()=>Promise.resolve().then(()=>gjt),void 0));let jc=class extends Li{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,r={key:this.key};for(const i of e)r[i]=this[i];return r}};function H(t={}){return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),t.constValue!=null)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,n=t.count||2,s=Math.ceil(Math.log2(n)),o=e._parameterBits??[0];let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<s)-1<<l;o[a]+=s,Object.defineProperty(e,r,{get(){return this[i]},set(u){if(this[i]!==u&&(this[i]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof u)}})}}}let u9=class extends jc{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};d([H()],u9.prototype,"haze",void 0),d([H()],u9.prototype,"reduced",void 0);var tn,Ra;(function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"})(tn||(tn={})),function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(Ra||(Ra={}));let da=class{constructor(e,r,i,n,s,o=!1,a=0){this.name=e,this.count=r,this.type=i,this.offset=n,this.stride=s,this.normalized=o,this.divisor=a}};new da(R.POSITION,3,et.FLOAT,0,12);new da(R.POSITION,3,et.FLOAT,0,20),new da(R.UV0,2,et.FLOAT,12,20);new da(R.POSITION,3,et.FLOAT,0,32),new da(R.NORMAL,3,et.FLOAT,12,32),new da(R.UV0,2,et.FLOAT,24,32);new da(R.POSITION,3,et.FLOAT,0,16),new da(R.COLOR,4,et.UNSIGNED_BYTE,12,16);const sae=[new da(R.POSITION,2,et.FLOAT,0,8)],ON=[new da(R.POSITION,2,et.FLOAT,0,16),new da(R.UV0,2,et.FLOAT,8,16)];function Apt(t){switch(t){case et.BYTE:case et.UNSIGNED_BYTE:return 1;case et.SHORT:case et.UNSIGNED_SHORT:return 2;case et.FLOAT:case et.INT:case et.UNSIGNED_INT:return 4}}function tDe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function q0(t,e){return t.vertexBuffers[e].usedMemory/Opt(t.layout[e])}function Opt(t){return t[0].stride}function oae(t,e,r,i,n=0){var o;const s=t.gl;t.bindBuffer(r);for(const a of i){const l=e.get(a.name);if(l===void 0){console.warn(`There is no location for vertex attribute '${a.name}' defined.`);continue}const c=n*a.stride;if(a.count<=4)s.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),s.enableVertexAttribArray(l),a.divisor>0&&t.gl.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let u=0;u<3;u++)s.vertexAttribPointer(l+u,3,a.type,a.normalized,a.stride,a.offset+12*u+c),s.enableVertexAttribArray(l+u),a.divisor>0&&t.gl.vertexAttribDivisor(l+u,a.divisor);else if(a.count===16)for(let u=0;u<4;u++)s.vertexAttribPointer(l+u,4,a.type,a.normalized,a.stride,a.offset+16*u+c),s.enableVertexAttribArray(l+u),a.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(l+u,a.divisor));else console.error("Unsupported vertex attribute element count: "+a.count);if(wf()){const u=tDe(t),h=Apt(a.type),p=a.offset,f=Math.round(h/p)!==h/p?`. Offset not a multiple of stride. DataType requires ${h} bytes, but descriptor has an offset of ${p}`:"";u&&console.error(`Unable to bind vertex attribute "${a.name}" with baseInstanceOffset ${c}${f}:`,u,a)}}}function rDe(t,e,r,i){var s,o,a;const n=t.gl;t.bindBuffer(r);for(const l of i){const c=e.get(l.name);if(l.count<=4)n.disableVertexAttribArray(c),l.divisor&&l.divisor>0&&((s=t.gl)==null||s.vertexAttribDivisor(c,0));else if(l.count===9)for(let u=0;u<3;u++)n.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(c+u,0));else if(l.count===16)for(let u=0;u<4;u++)n.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&((a=t.gl)==null||a.vertexAttribDivisor(c+u,0));else console.error("Unsupported vertex attribute element count: "+l.count)}t.unbindBuffer(Tt.ARRAY_BUFFER)}function aae(t){switch(t){case Ot.ALPHA:case Ot.LUMINANCE:case Ot.RED:case Ot.RED_INTEGER:case at.R8:case at.R8I:case at.R8UI:case at.R8_SNORM:case Ia.STENCIL_INDEX8:return 1;case Ot.LUMINANCE_ALPHA:case Ot.RG:case Ot.RG_INTEGER:case at.RGBA4:case at.R16F:case at.R16I:case at.R16UI:case at.RG8:case at.RG8I:case at.RG8UI:case at.RG8_SNORM:case at.RGB565:case at.RGB5_A1:case Ia.DEPTH_COMPONENT16:return 2;case Ot.DEPTH_COMPONENT:case Ot.RGB:case Ot.RGB_INTEGER:case at.RGB8:case at.RGB8I:case at.RGB8UI:case at.RGB8_SNORM:case at.SRGB8:case Ia.DEPTH_COMPONENT24:return 3;case Ot.DEPTH_STENCIL:case Ot.DEPTH24_STENCIL8:case Ot.RGBA:case Ot.RGBA_INTEGER:case at.RGBA8:case at.R32F:case at.R11F_G11F_B10F:case at.RG16F:case at.R32I:case at.R32UI:case at.RG16I:case at.RG16UI:case at.RGBA8I:case at.RGBA8UI:case at.RGBA8_SNORM:case at.SRGB8_ALPHA8:case at.RGB9_E5:case at.RGB10_A2UI:case at.RGB10_A2:case Ia.DEPTH_STENCIL:case Ia.DEPTH_COMPONENT32F:case Ia.DEPTH24_STENCIL8:return 4;case Ia.DEPTH32F_STENCIL8:return 5;case at.RGB16F:case at.RGB16I:case at.RGB16UI:return 6;case at.RG32F:case at.RG32I:case at.RG32UI:case at.RGBA16F:case at.RGBA16I:case at.RGBA16UI:return 8;case at.RGB32F:case at.RGB32I:case at.RGB32UI:return 12;case at.RGBA32F:case at.RGBA32I:case at.RGBA32UI:return 16;case Bn.COMPRESSED_RGB_S3TC_DXT1_EXT:case Bn.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case Bn.COMPRESSED_RGBA_S3TC_DXT3_EXT:case Bn.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case Bn.COMPRESSED_R11_EAC:case Bn.COMPRESSED_SIGNED_R11_EAC:case Bn.COMPRESSED_RGB8_ETC2:case Bn.COMPRESSED_SRGB8_ETC2:case Bn.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case Bn.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case Bn.COMPRESSED_RG11_EAC:case Bn.COMPRESSED_SIGNED_RG11_EAC:case Bn.COMPRESSED_RGBA8_ETC2_EAC:case Bn.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const M5=()=>K.getLogger("esri.views.webgl.VertexArrayObject");let fp=class{constructor(e,r,i,n,s=null){this._context=e,this._locations=r,this._layout=i,this._buffers=n,this._indexBuffer=s,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,r)=>e+this._buffers[r].usedMemory,this._indexBuffer!=null?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*LEe}dispose(){var e;if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const r in this._buffers)(e=this._buffers[r])==null||e.dispose(),delete this._buffers[r];this._indexBuffer=wt(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&M5().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(ss.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,r=e.createVertexArray();e.bindVertexArray(r),this._bindLayout(),e.bindVertexArray(null),this._glName=r,this._context.instanceCounter.increment(ss.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:r,_indexBuffer:i}=this;e||M5().error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const s in e){const o=e[s];o||M5().error("Vertex buffer is uninitialized!");const a=r[s];a||M5().error("Vertex element descriptor is empty!"),oae(this._context,this._locations,o,a)}i!=null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}},wm=class extends fp{};const n1=()=>K.getLogger("esri.views.webgl.BufferObject");let ti=class Gx{static createIndex(e,r,i){return new Gx(e,Tt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(e,r,i){return new Gx(e,Tt.ARRAY_BUFFER,r,i)}static createUniform(e,r,i){return new Gx(e,Tt.UNIFORM_BUFFER,r,i)}static createPixelPack(e,r=Lr.STREAM_READ,i){const n=new Gx(e,Tt.PIXEL_PACK_BUFFER,r);return i&&n.setSize(i),n}static createPixelUnpack(e,r=Lr.STREAM_DRAW,i){return new Gx(e,Tt.PIXEL_UNPACK_BUFFER,r,i)}static createTransformFeedback(e,r=Lr.STATIC_DRAW,i){const n=new Gx(e,Tt.TRANSFORM_FEEDBACK_BUFFER,r);return n.setSize(i),n}constructor(e,r,i,n){this._context=e,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(ss.BufferObject,this),this._glName=this._context.gl.createBuffer(),Rg(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===Tt.ELEMENT_ARRAY_BUFFER?this._indexType===et.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Tt.ELEMENT_ARRAY_BUFFER||this.bufferType===Tt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(ss.BufferObject,this),this._context=null):this._glName&&n1().warn("Leaked WebGL buffer object")}setSize(e,r=null){if(e<=0&&n1().error("Buffer size needs to be positive!"),this.bufferType===Tt.ELEMENT_ARRAY_BUFFER&&r!=null)switch(this._indexType=r,r){case et.UNSIGNED_SHORT:e*=2;break;case et.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let r=e.byteLength;this.bufferType===Tt.ELEMENT_ARRAY_BUFFER&&(JV(e)&&(r/=2,this._indexType=et.UNSIGNED_SHORT),KV(e)&&(r/=4,this._indexType=et.UNSIGNED_INT)),this._setBufferData(r,e)}_setBufferData(e,r=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;r!=null?n.bufferData(this.bufferType,r,this.usage):n.bufferData(this.bufferType,e,this.usage),Rg(n),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,r,i,n){if(!e)return;(r<0||r*e.BYTES_PER_ELEMENT>=this.usedMemory)&&n1().error("offset is out of range!"),i>=n&&n1().error("end must be bigger than start!"),(r+(n-i))*e.BYTES_PER_ELEMENT>this.usedMemory&&n1().error("An attempt to write beyond the end of the buffer!");const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,e,i,n-i),Rg(o),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,r=0,i,n){if(i<0||n<0)return void n1().error("Problem getting subdata: offset and length were less than zero!");const s=Mpt(e)?e.BYTES_PER_ELEMENT:1;if(s*((i??0)+(n??0))>e.byteLength)return void n1().error("Problem getting subdata: offset and length exceeded destination size!");r+s*(n??0)>this.usedMemory&&n1().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===Tt.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,Tt.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(Tt.TRANSFORM_FEEDBACK_BUFFER,r,e,i,n),this._context.unbindBuffer(Tt.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,Tt.COPY_READ_BUFFER),o.getBufferSubData(Tt.COPY_READ_BUFFER,r,e,i,n),this._context.unbindBuffer(Tt.COPY_READ_BUFFER))}async getSubDataAsync(e,r=0,i,n){await this._context.clientWaitAsync(),this.getSubData(e,r,i,n)}};function Mpt(t){return cHe(t)}var Vb;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(Vb||(Vb={}));let ui=class{constructor(e=0,r=e){this.width=e,this.height=r,this.target=In.TEXTURE_2D,this.pixelFormat=Ot.RGBA,this.dataType=Ks.UNSIGNED_BYTE,this.samplingMode=Kt.LINEAR,this.wrapMode=nr.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function Rpt(t){return t.width<=0||t.height<=0?0:Math.round(t.width*t.height*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:aae(t.internalFormat)))}let $pt=class iDe extends ui{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case at.R16F:case at.R16I:case at.R16UI:case at.R32F:case at.R32I:case at.R32UI:case at.R8_SNORM:case at.R8:case at.R8I:case at.R8UI:this.pixelFormat=Ot.RED}}static validate(e,r){return new iDe(e,r)}};const vge=4;let Mr=class yd{constructor(e,r=null,i=null){if(this.type=Vb.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const n=$pt.validate(e,r);if(!n)throw new B("Texture descriptor invalid");this._descriptor=n}this._descriptor.target===In.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return Rpt(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(ss.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new B("Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===In.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let r=In.TEXTURE_CUBE_MAP_POSITIVE_X;r<=In.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(e,r)}setData(e){this._setData(e)}_setData(e,r){var c;if(!((c=this._descriptor.context)!=null&&c.gl))return;const i=this._descriptor.context.gl;Rg(i),this._glName||(this._glName=i.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(ss.Texture,this)),e===void 0&&(e=null);const n=this._descriptor,s=r??n.target,o=oM(s);e===null&&(n.width=n.width||vge,n.height=n.height||vge,o&&(n.depth=n.depth??1));const a=this._descriptor.context.bindTexture(this,yd.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(yd.TEXTURE_UNIT_FOR_UPDATES),AH(n),this._configurePixelStorage(),Rg(i);const l=this._deriveInternalFormat();if(xge(e)){let u="width"in e?e.width:e.codedWidth,h="height"in e?e.height:e.codedHeight;const p=1;e instanceof HTMLVideoElement&&(u=e.videoWidth,h=e.videoHeight),n.width&&n.height,o&&n.depth,n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,u,h,p),this._texImage(s,0,l,u,h,p,e),Rg(i),n.hasMipmap&&this.generateMipmap(),n.width||(n.width=u),n.height||(n.height=h),o&&!n.depth&&(n.depth=p)}else{const{width:u,height:h,depth:p}=n;if(u==null||h==null)throw new B("Width and height must be specified!");if(o&&p==null)throw new B("Depth must be specified!");if(n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,u,h,p),Q6(e)){const f=e.levels,g=Sge(s,u,h,p),y=Math.min(g-1,f.length-1);i.texParameteri(n.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,y);const v=l;if(!Dpt(v))throw new B("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((b,w,x,S)=>{const E=f[Math.min(b,f.length-1)];this._compressedTexImage(s,b,v,w,x,S,E)},y)}else this._texImage(s,0,l,u,h,p,e),Rg(i),n.hasMipmap&&this.generateMipmap()}bge(i,this._descriptor),wge(i,this._descriptor),Ipt(this._descriptor.context,this._descriptor),Rg(i),this._descriptor.context.bindTexture(a,yd.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,r,i,n,s,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor,c=this._deriveInternalFormat(),{context:u,pixelFormat:h,dataType:p,target:f,isImmutable:g}=l;if(g&&!this._wasImmutablyAllocated)throw new B("Cannot update immutable texture before allocation!");const y=u.bindTexture(this,yd.TEXTURE_UNIT_FOR_UPDATES,!0);(r<0||i<0||n>l.width||s>l.height||r+n>l.width||i+s>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=u;a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,a),xge(o)?v.texSubImage2D(f,e,r,i,n,s,h,p,o):Q6(o)?v.compressedTexSubImage2D(f,e,r,i,n,s,c,o.levels[e]):v.texSubImage2D(f,e,r,i,n,s,h,p,o),a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,0),u.bindTexture(y,yd.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,n,s,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,u=this._deriveInternalFormat(),{context:h,pixelFormat:p,dataType:f,isImmutable:g,target:y}=c;if(g&&!this._wasImmutablyAllocated)throw new B("Cannot update immutable texture before allocation!");oM(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=h.bindTexture(this,yd.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(yd.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||n<0||s>c.width||o>c.height||a>c.depth||r+s>c.width||i+o>c.height||n+a>c.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:b}=h;if(Q6(l))l=l.levels[e],b.compressedTexSubImage3D(y,e,r,i,n,s,o,a,u,l);else{const w=l;b.texSubImage3D(y,e,r,i,n,s,o,a,p,f,w)}h.bindTexture(v,yd.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new B("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,AH(e)}e.samplingMode===Kt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=Kt.LINEAR_MIPMAP_NEAREST):e.samplingMode===Kt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=Kt.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,yd.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(yd.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(r,yd.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,AH(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor,r=e.context.gl;this._samplingModeDirty&&(bge(r,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(wge(r,e),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===Ot.DEPTH_STENCIL&&(this._descriptor.internalFormat=Ot.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case Ks.FLOAT:switch(this._descriptor.pixelFormat){case Ot.RGBA:return this._descriptor.internalFormat=at.RGBA32F;case Ot.RGB:return this._descriptor.internalFormat=at.RGB32F;default:throw new B("Unable to derive format")}case Ks.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case Ot.RGBA:return this._descriptor.internalFormat=at.RGBA8;case Ot.RGB:return this._descriptor.internalFormat=at.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===Ot.DEPTH_STENCIL?Ot.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:n}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0)}_texStorage(e,r,i,n,s,o){const{gl:a}=this._descriptor.context;if(!Lpt(r))throw new B("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?Sge(e,n,s,o):1;if(oM(e)){if(o==null)throw new B("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,n,s,o)}else a.texStorage2D(e,l,r,n,s);this._wasImmutablyAllocated=!0}_texImage(e,r,i,n,s,o,a){const l=this._descriptor.context.gl,c=oM(e),{isImmutable:u,pixelFormat:h,dataType:p}=this._descriptor;if(u){if(a!=null){const f=a;if(c){if(o==null)throw new B("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,r,0,0,0,n,s,o,h,p,f)}else l.texSubImage2D(e,r,0,0,n,s,h,p,f)}}else{const f=a;if(c){if(o==null)throw new B("Missing depth dimension for 3D texture upload");l.texImage3D(e,r,i,n,s,o,0,h,p,f)}else l.texImage2D(e,r,i,n,s,0,h,p,f)}}_compressedTexImage(e,r,i,n,s,o,a){const l=this._descriptor.context.gl,c=oM(e);if(this._descriptor.isImmutable){if(a!=null)if(c){if(o==null)throw new B("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,r,0,0,0,n,s,o,i,a)}else l.compressedTexSubImage2D(e,r,0,0,n,s,i,a)}else if(c){if(o==null)throw new B("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,r,i,n,s,o,0,a)}else l.compressedTexImage2D(e,r,i,n,s,0,a)}_forEachMipmapLevel(e,r=1/0){let{width:i,height:n,depth:s,hasMipmap:o,target:a}=this._descriptor;const l=a===In.TEXTURE_3D;if(i==null||n==null||l&&s==null)throw new B("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,i,n,s),o&&(i!==1||n!==1||l&&s!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),n=Math.max(1,n>>1),l&&(s=Math.max(1,s>>1))}};function AH(t){(t.width!=null&&t.width<0||t.height!=null&&t.height<0||t.depth!=null&&t.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function bge(t,e){let r=e.samplingMode,i=e.samplingMode;r===Kt.LINEAR_MIPMAP_NEAREST||r===Kt.LINEAR_MIPMAP_LINEAR?(r=Kt.LINEAR,e.hasMipmap||(i=Kt.LINEAR)):r!==Kt.NEAREST_MIPMAP_NEAREST&&r!==Kt.NEAREST_MIPMAP_LINEAR||(r=Kt.NEAREST,e.hasMipmap||(i=Kt.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}function wge(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function Ipt(t,e){const r=t.capabilities.textureFilterAnisotropic;r&&t.gl.texParameterf(e.target,r.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function Lpt(t){return t in at}function Dpt(t){return t in Bn}function Q6(t){return t!=null&&"type"in t&&t.type==="compressed"}function Npt(t){return t!=null&&"byteLength"in t}function xge(t){return t!=null&&!Q6(t)&&!Npt(t)}function oM(t){return t===In.TEXTURE_3D||t===In.TEXTURE_2D_ARRAY}function Sge(t,e,r,i=1){let n=Math.max(e,r);return t===In.TEXTURE_3D&&(n=Math.max(n,i)),Math.round(Math.log(n)/Math.LN2)+1}Mr.TEXTURE_UNIT_FOR_UPDATES=0;function Sy(t,e=sae,r=Nr,i=-1,n=1){let s=null;return e===ON?s=new Float32Array([i,i,0,0,n,i,1,0,i,n,0,1,n,n,1,1]):s=new Float32Array([i,i,n,i,i,n,n,n]),new wm(t,r,{geometry:e},{geometry:ti.createVertex(t,Lr.STATIC_DRAW,s)})}const Fpt=4;function nDe(t){const e=new ui(Fpt);return e.samplingMode=Kt.NEAREST,new Mr(t,e)}const h9=16;function vT(t){return Math.ceil(t/h9)*h9}function kpt(t){return Math.floor(t/h9)*h9}function Upt(t,e){let s=t.width*t.height;if(s<4096)return t instanceof ImageData?sDe(t):t;let o=t.width,a=t.height;do o=Math.ceil(o/2),a=Math.ceil(a/2),s=o*a;while(s>1048576||e!=null&&(o>e||a>e));return lae(t,o,a)}function zpt(t,e){const r=Math.max(t.width,t.height);if(r<=e)return t;const i=e/r;return lae(t,Math.round(t.width*i),Math.round(t.height*i))}function lae(t,e,r){if(t instanceof ImageData)return lae(sDe(t),e,r);const i=document.createElement("canvas");return i.width=e,i.height=r,i.getContext("2d").drawImage(t,0,0,i.width,i.height),i}function sDe(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const r=e.getContext("2d");if(r==null)throw new B("Failed to create 2d context from HTMLCanvasElement");return r.putImageData(t,0,0),e}function gl(t,e=!0){t.attributes.add(R.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(T`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?T`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let cae=class extends Li{};function oDe(t){const e=new Fr;e.include(gl),e.fragment.uniforms.add(new ft("colorTexture",i=>i.color),new ft("depthTexture",i=>i.depth));const r=t.haze;return e.fragment.code.add(T`
    void main() {
      ${r?T`vec4`:T`float`} depthSample = texture(depthTexture, uv) ${r?"":T`.r`};
      if (depthSample ${r?T`== vec4(0)`:T`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `),e}const Vpt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:cae,build:oDe},Symbol.toStringTag,{value:"Module"}));let aDe=class lDe extends Zr{initializeProgram(e){return new Br(e.rctx,lDe.shader.get().build(this.configuration),Nr)}initializePipeline(){return this.configuration.haze?Bt({blending:ya(Ee.ONE,Ee.ZERO,Ee.ONE_MINUS_SRC_COLOR,Ee.ONE),depthTest:{func:si.ALWAYS},colorWrite:rr}):Bt({blending:qu(Ee.SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:si.ALWAYS},colorWrite:rr})}};aDe.shader=new Vr(Vpt,()=>re(()=>Promise.resolve().then(()=>yjt),void 0));let Tge=class{constructor(e,r){this._view=e,this._context=r,this.type=Ya.Realistic,this._handles=new iw,this._compositingPassParameters=new cae,this._atmosphereConfiguration=new u9,this._passParameters=new Ppt,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=ni.radius,this._fadeHaze=0,this._updateRadius(ni.radius);const i=this._context.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([pe(()=>{var s,o;return(o=(s=this._view)==null?void 0:s.basemapTerrain)==null?void 0:o.rootTileElevationBounds},()=>{var s;return(s=this._view)!=null&&s.basemapTerrain?this._updateRootTileElevationBounds():null}),pe(()=>{var s,o;return(o=(s=this._view)==null?void 0:s.basemapTerrain)==null?void 0:o.visibleElevationBounds},()=>{var s;return(s=this._view)!=null&&s.basemapTerrain?this._updateVisibleElevationBounds():null}),pe(()=>{var s;return(s=this._view)==null?void 0:s.environment.background},s=>{const o=s instanceof OLe?dD(s.color):Fh;se(this._passParameters.backgroundColor,o[0]*o[3],o[1]*o[3],o[2]*o[3])},li)]);const n=new u9;n.haze=!1,this._atmosphereTechnique=this._context.techniqueRepository.acquire(jR,n),n.haze=!0,this._atmosphereHazeTechnique=this._context.techniqueRepository.acquire(jR,n),n.reduced=!0,n.haze=!1,this._atmosphereReducedTechnique=this._context.techniqueRepository.acquire(jR,n),n.haze=!0,this._atmosphereHazeReducedTechnique=this._context.techniqueRepository.acquire(jR,n),this._vao=Sy(i,ON)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,r){this._render(e,r?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,r,!1)}renderHaze(e,r,i){var n;this._fadeHaze=r,this._render(e,i?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,(n=e.bindParameters.linearDepth)==null?void 0:n.getTexture(),i,!0)}_render(e,r,i,n,s){if(i==null)return;const o=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=i;const a=e.rctx.bindTechnique(r,e.bindParameters,this._passParameters);if(n)o.renderDepthDetached(()=>this._renderCommon(a,e));else{const l=e.rctx.getViewport(),c=Te(e.bindParameters.camera.eye)-ni.radius;let u;if(c<_v){const y=Math.min(1,Math.max(0,c/_v));u=s?Dt(.4,.5,y):Dt(.2,.3,y)}else{const y=Math.min(1,Math.max(0,(c-_v)/(15*_v)));u=s?Dt(.5,1,y):Dt(.3,.6,y)}const h=vT(Math.round(u*e.bindParameters.camera.fullViewport[2])),p=vT(Math.round(u*e.bindParameters.camera.fullViewport[3]));e.rctx.setViewport(0,0,h,p);const f=o.renderToCachedFBO(null,"chapman",()=>this._renderCommon(a,e),[0,0,0,1],tn.RGBA,null,h,p);e.rctx.setViewport(l.x,l.y,l.width,l.height),this._compositingPassParameters.color=f.getTexture(),this._compositingPassParameters.depth=i,this._atmosphereConfiguration.haze=s;const g=this._context.techniqueRepository.acquire(aDe,this._atmosphereConfiguration);e.rctx.bindTechnique(g,e.bindParameters,this._compositingPassParameters),o.renderDepthDetached(()=>e.rctx.screen.draw()),g.release(),f.release()}}_renderCommon(e,r){this._vao!=null&&(r.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(dr.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=ni.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(ni.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,yr(this._passParameters.radii,e,e+_v),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-KK)*KK)}_update(e){if(!e)return;const r=nl(e.eye),i=Math.sqrt(r),n=r-this._passParameters.radii[1]*this._passParameters.radii[1],s=we((i-this._passParameters.radii[0])/_v,0,1);pn(this._passParameters.heightParameters,i,r,n,s),this._passParameters.altitudeFade=iae(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Dt(Dt(.6,1,HL(9500,10500,i-ni.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function cDe(t){t.fragment.code.add(T`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function uae(t,e){switch(t.include(Jg,e),e.textureCoordinateType){case mn.Default:case mn.Compressed:return void t.fragment.code.add(T`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case mn.Atlas:return t.include(cDe),void t.fragment.code.add(T`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case mn.None:case mn.COUNT:return}}let Vh=class extends Pn{constructor(e,r){super(e,"vec3",kr.Draw,(i,n,s,o)=>i.setUniform3fv(e,r(n,s,o)))}},Kd=class extends Pn{constructor(e,r){super(e,"sampler2D",kr.Draw,(i,n,s)=>i.bindTexture(e,r(n,s)))}},fw=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,r){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(e){return Cb.LOADED}},hae=class extends fw{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRepository,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=lr(this._texture),this._textureNormal=lr(this._textureNormal),this._textureEmissive=lr(this._textureEmissive),this._textureOcclusion=lr(this._textureOcclusion),this._textureMetallicRoughness=lr(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?Cb.LOADED:Cb.LOADING}get textureBindParameters(){return new uDe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=lr(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(e==null)return void r(null);const i=this._textureRepository.acquire(e);if(Xu(i))return++this._numLoading,void i.then(n=>{if(this._disposed)return lr(n),void r(null);r(n)}).finally(()=>--this._numLoading);r(i)}},uDe=class extends Li{constructor(e=null,r=null,i=null,n=null,s=null,o,a){super(),this.texture=e,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=n,this.textureMetallicRoughness=s,this.scale=o,this.normalTextureTransformMatrix=a}};var ht;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Simplified=5]="Simplified",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(ht||(ht={}));function dae(t,e){const r=t.fragment,i=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===ht.Normal&&i&&t.include(uae,e),e.pbrMode!==ht.Schematic)if(e.pbrMode!==ht.Disabled){if(e.pbrMode===ht.Normal){r.code.add(T`vec3 mrr;
vec3 emission;
float occlusion;`);const n=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(r.uniforms.add(n===kr.Pass?new ft("texMetallicRoughness",s=>s.textureMetallicRoughness):new Kd("texMetallicRoughness",s=>s.textureMetallicRoughness)),r.code.add(T`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(r.uniforms.add(n===kr.Pass?new ft("texEmission",s=>s.textureEmissive):new Kd("texEmission",s=>s.textureEmissive)),r.code.add(T`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(r.uniforms.add(n===kr.Pass?new ft("texOcclusion",s=>s.textureOcclusion):new Kd("texOcclusion",s=>s.textureOcclusion)),r.code.add(T`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(T`float getBakedOcclusion() { return 1.0; }`),n===kr.Pass?r.uniforms.add(new zt("emissionFactor",s=>s.emissiveFactor),new zt("mrrFactors",s=>s.mrrFactors)):r.uniforms.add(new Vh("emissionFactor",s=>s.emissiveFactor),new Vh("mrrFactors",s=>s.mrrFactors)),r.code.add(T`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?T`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?T`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?T`applyEmission(${e.hasEmissiveTextureTransform?T`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?T`applyOcclusion(${e.hasOcclusionTextureTransform?T`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else r.code.add(T`float getBakedOcclusion() { return 1.0; }`);else r.code.add(T`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function pae(t,e){const r=t.fragment,i=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new zt("lightingAmbientSH0",(n,s)=>se(Ege,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0]))),r.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add(new Or("lightingAmbientSH_R",(n,s)=>pn(Dy,s.lighting.sh.r[0],s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3])),new Or("lightingAmbientSH_G",(n,s)=>pn(Dy,s.lighting.sh.g[0],s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3])),new Or("lightingAmbientSH_B",(n,s)=>pn(Dy,s.lighting.sh.b[0],s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3]))),r.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add(new zt("lightingAmbientSH0",(n,s)=>se(Ege,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0])),new Or("lightingAmbientSH_R1",(n,s)=>pn(Dy,s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3],s.lighting.sh.r[4])),new Or("lightingAmbientSH_G1",(n,s)=>pn(Dy,s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3],s.lighting.sh.g[4])),new Or("lightingAmbientSH_B1",(n,s)=>pn(Dy,s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3],s.lighting.sh.b[4])),new Or("lightingAmbientSH_R2",(n,s)=>pn(Dy,s.lighting.sh.r[5],s.lighting.sh.r[6],s.lighting.sh.r[7],s.lighting.sh.r[8])),new Or("lightingAmbientSH_G2",(n,s)=>pn(Dy,s.lighting.sh.g[5],s.lighting.sh.g[6],s.lighting.sh.g[7],s.lighting.sh.g[8])),new Or("lightingAmbientSH_B2",(n,s)=>pn(Dy,s.lighting.sh.b[5],s.lighting.sh.b[6],s.lighting.sh.b[7],s.lighting.sh.b[8]))),r.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==ht.Normal&&e.pbrMode!==ht.Schematic||r.code.add(T`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Ege=C(),Dy=tr();function MN(t){t.vertex.code.add(T`const float PI = 3.141592653589793;`),t.fragment.code.add(T`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var Ug,t2;function Bpt(t){return(t==null?void 0:t.cubeMap)!=null}function Gpt(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FADING=1]="FADING",t[t.FINISHED=2]="FINISHED"})(Ug||(Ug={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(t2||(t2={}));var Xr;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Xr||(Xr={}));let jpt=class{constructor(){this.readChannels=t2.RG,this.renderingStage=Ug.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=C(),this.parallax=new Cge,this.parallaxNew=new Cge,this.pointOnGround=C(),this.fadeMode=ki.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const r=this.parallax,i=Te(e.eye);if(r.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(i*i-ni.radius*ni.radius,0))/i,hpe(Pge,r.anchorPointClouds,eE),Ou(r.transform,fn,eE[3],eE),this.fadeMode===ki.CROSS_FADE){const n=this.parallaxNew;hpe(Pge,n.anchorPointClouds,eE),Ou(n.transform,fn,eE[3],eE)}}updateFading(e,r,i,n){this.isFading&&this._advanceFading(i,n),this._evaluateFading(e,r,i)}_evaluateFading(e,r,i){const n=e.relativeElevation,s=this._calculateDistanceToAnchorPoint(e);if((n>1.7*E0||n<-E0||s>Xpt)&&this.opacity>0)this._setFade(ki.HIDE,i);else if(!this.isFading){if((n>E0||n<-.35*E0||s>Ypt)&&this.opacity>0)this._setFade(ki.FADE_OUT,i);else if(n<=E0&&n>=-.35*E0&&r===Xr.IDLE&&Gpt(this.data)){if(this.opacity===0)return void this._setFade(ki.FADE_IN,i);(s>Wpt||this.renderingStage===Ug.FADING)&&this._setFade(ki.CROSS_FADE,i)}}}_advanceFading(e,r){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,r)}_advanceFadingFactorAndOpacity(e,r){if(this.fadeFactor<1)return this.fadeFactor=r?we((e-this.startTime)/(qpt*r),0,1):1,this.fadeMode===ki.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===ki.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===ki.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===ki.FADE_OUT&&(this.opacity=0),this.fadeMode===ki.FADE_IN&&(this.opacity=1),this.fadeMode===ki.CROSS_FADE&&(this.opacity=1),this.fadeMode=ki.NONE}_switchReadChannels(){const e=this.fadeMode===ki.CROSS_FADE&&this.fadeFactor===1,r=this.fadeMode===ki.FADE_IN&&this.fadeFactor===0;this.renderingStage===Ug.FADING&&(e||r)&&(this.readChannels=1-this.readChannels,this.renderingStage=Ug.FINISHED)}_calculateDistanceToAnchorPoint(e){return me(this.pointOnGround,e.eye),oe(this.pointOnGround,this.pointOnGround,ni.radius),Te(_e(Hpt,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===ki.CROSS_FADE&&(this.fadeFactor===0&&he(this.parallaxNew.anchorPointClouds,this.pointOnGround),this.fadeFactor===1&&he(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===ki.FADE_IN&&this.fadeFactor===0&&he(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,r){switch(e){case ki.HIDE:this.opacity=0;break;case ki.FADE_OUT:this.opacity=1;break;case ki.FADE_IN:this.opacity=0;break;case ki.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=r}get isFading(){return this.fadeMode===ki.FADE_OUT||this.fadeMode===ki.FADE_IN||this.fadeMode===ki.CROSS_FADE}};var ki;(function(t){t[t.NONE=0]="NONE",t[t.HIDE=1]="HIDE",t[t.FADE_OUT=2]="FADE_OUT",t[t.FADE_IN=3]="FADE_IN",t[t.CROSS_FADE=4]="CROSS_FADE"})(ki||(ki={}));let Cge=class{constructor(){this.anchorPointClouds=C(),this.radiusCurvatureCorrectionFactor=0,this.transform=xe()}};const Pge=Ce(0,0,1),eE=vm(),Hpt=C(),qpt=1.25,Wpt=34e3,Ypt=64e3,Xpt=2e5;let Qg=class extends Pn{constructor(e,r){super(e,"bool",kr.Pass,(i,n,s)=>i.setUniform1b(e,r(n,s)))}},Zpt=class extends Pn{constructor(e,r){super(e,"samplerCube",kr.Pass,(i,n,s)=>i.bindTexture(e,r(n,s)))}};function hDe(t){const e=t.fragment;e.uniforms.add(new _n("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new _n("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new zt("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new zt("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new Ie("cloudsHeight",()=>Cdt),new Ie("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Ie("totalFadeInOut",(r,i)=>1-i.cloudsFade.opacity),new Ie("crossFadeAnchorFactor",(r,i)=>we(i.cloudsFade.fadeFactor,0,1)),new Zpt("cubeMap",(r,i)=>{var n,s;return((s=(n=i.cloudsFade.data)==null?void 0:n.cubeMap)==null?void 0:s.colorTexture)??null}),new Qg("crossFade",(r,i)=>i.cloudsFade.fadeMode===ki.CROSS_FADE),new Qg("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===t2.RG),new Qg("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===Ug.FADING)),e.constants.add("planetRadius","float",ni.radius),e.code.add(T`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(T`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(T`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),R_(e),by(e),e.code.add(T`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(T`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(T`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(T`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(T`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function Ty(t){t.code.add(T`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function dDe(){const t=new Fr,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(R.POSITION,"vec2"),r.add("worldRay","vec3"),i.uniforms.add(new _n("inverseProjectionMatrix",(s,o)=>o.camera.inverseProjectionMatrix),new _n("inverseViewMatrix",(s,o)=>zA(Jpt,o.camera.viewMatrix))),i.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),n.include(Ty),n.include(bp),t.include(pae,{pbrMode:ht.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(MN),t.include(G7),t.include(a9),t.include(hDe),n.uniforms.add(new zt("cameraPosition",(s,o)=>o.camera.eye)),n.code.add(T`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const Jpt=xe(),Qpt=Object.freeze(Object.defineProperty({__proto__:null,build:dDe},Symbol.toStringTag,{value:"Module"}));let pDe=class fDe extends Zr{constructor(e){super(e,new jc,()=>this.destroy())}initializeProgram(e){return new Br(e.rctx,fDe.shader.get().build(),Nr)}initializePipeline(){return Bt({blending:ya(Ee.ONE,Ee.ZERO,Ee.SRC_ALPHA,Ee.ONE),depthTest:{func:si.LEQUAL},colorWrite:rr})}};pDe.shader=new Vr(Qpt,()=>re(()=>Promise.resolve().then(()=>_jt),void 0));let jx=class extends Pe{constructor(e){super(e),this._technique=new pDe(e),this._vao=Sy(e.rctx)}destroy(){this._technique=lr(this._technique),this._vao=wt(this._vao)}render(e){if(!this._technique.compiled)return void this.requestRender();const r=e.bindParameters.cloudsFade;if(this._vao==null||r.data==null)return;const i=e.rctx.bindTechnique(this._technique,e.bindParameters,Kpt);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(dr.TRIANGLE_STRIP,0,4)}};d([m({constructOnly:!0})],jx.prototype,"rctx",void 0),d([m({constructOnly:!0})],jx.prototype,"viewingMode",void 0),d([m({constructOnly:!0})],jx.prototype,"planetRadius",void 0),d([m({constructOnly:!0})],jx.prototype,"requestRender",void 0),jx=d([F("esri.views.3d.environment.CloudsComposition")],jx);const Kpt=new Li;function xu(){return new Float32Array(3)}function aee(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function wi(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function eft(t,e){return new Float32Array(t,e,3)}function fae(){return xu()}function mDe(){return wi(1,1,1)}function gDe(){return wi(1,0,0)}function yDe(){return wi(0,1,0)}function _De(){return wi(0,0,1)}const tft=fae(),rft=mDe(),ift=gDe(),nft=yDe(),sft=_De();Object.freeze(Object.defineProperty({__proto__:null,ONES:rft,UNIT_X:ift,UNIT_Y:nft,UNIT_Z:sft,ZEROS:tft,clone:aee,create:xu,createView:eft,fromValues:wi,ones:mDe,unitX:gDe,unitY:yDe,unitZ:_De,zeros:fae},Symbol.toStringTag,{value:"Module"}));var Rc;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(Rc||(Rc={}));let K6=class extends jc{constructor(){super(...arguments),this.steps=Rc.SIXTEEN,this.writeTextureChannels=t2.RG}};d([H({count:Rc.COUNT})],K6.prototype,"steps",void 0),d([H({constValue:ne("esri-mobile")?1024:2048})],K6.prototype,"cubeMapSize",void 0),d([H()],K6.prototype,"writeTextureChannels",void 0);let HR=class{constructor(e,r,i,n,s,o,a,l,c=.5){this.coverage=e,this.density=r,this.absorption=i,this.cloudSize=n,this.detailSize=s,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const Age=new HR([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Rc.SIXTEEN),qa={sunny:Age,cloudy:new HR([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Rc.TWOHUNDRED,.6),rainy:new HR([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Rc.TWOHUNDRED,.4),snowy:new HR([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Rc.HUNDRED,.65),foggy:new HR([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Rc.SIXTEEN),default:Age},Md=ne("esri-mobile")?64:128,oft=Md/128,hf=Math.ceil(Math.sqrt(Md)),ub=(Md+2)*hf,aft=1e5,OH=128,lft=ub/1560;let Zh=class extends Pn{constructor(e,r){super(e,"mat3",kr.Pass,(i,n,s)=>i.setUniformMatrix3fv(e,r(n,s)))}},mae=class extends Li{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=qa.default.raymarchingSteps,this.weatherTile=Ye(),this.viewMatrix=gi()}};function vDe(t){const e=new Fr;e.include(gl,!1);const r=e.fragment;return r.uniforms.add(new Ie("cloudRadius",i=>i.cloudRadius),new Ie("power",i=>Dt(35,120,i.absorption)),new Ie("sigmaE",i=>1+i.absorption),new Ie("density",i=>Dt(0,.3,i.density)),new Ie("cloudSize",i=>Dt(0,.02,Math.max(.01,1-i.cloudSize))),new Ie("detailSize",i=>Dt(0,.2,Math.max(.01,1-i.detailSize))),new Ie("smoothness",i=>Dt(0,.5,1-i.smoothness)),new Ie("cloudHeight",i=>Dt(0,1500,i.cloudHeight)),new Ie("coverage",i=>i.coverage),new Zh("view",i=>i.viewMatrix),new ft("cloudShapeTexture",i=>i.noiseTexture!=null?i.noiseTexture.textureAtlas:null),new ci("cloudVariables",i=>yr(cft,i.coverage,i.absorption))),r.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),r.code.add(T`
    const int STEPS = ${t.steps===Rc.SIXTEEN?T`16`:t.steps===Rc.HUNDRED?T`100`:T`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(T`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${T.float(ub)};
      const float dataWidth = ${T.float(ub)};
      const float tileRows = ${T.float(hf)};
      const vec3 atlasDimensions = vec3(${T.float(Md)}, ${T.float(Md)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${T.float(oft)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${T.float(lft)} * p) / ${T.float(ub)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),r.code.add(T`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(T`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(T`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(T`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(T`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const cft=Ye(),uft=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:mae,build:vDe},Symbol.toStringTag,{value:"Module"}));let bDe=class wDe extends Zr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Br(e.rctx,wDe.shader.get().build(this.configuration),Nr)}initializePipeline(){return Bt({blending:qu(Ee.CONSTANT_COLOR,Ee.ONE_MINUS_CONSTANT_COLOR,py.ADD,this.configuration.writeTextureChannels===t2.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:si.LEQUAL},colorWrite:rr})}};bDe.shader=new Vr(uft,()=>re(()=>Promise.resolve().then(()=>vjt),void 0));var Ah;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(Ah||(Ah={}));let lee=class extends jc{constructor(){super(...arguments),this.mode=Ah.Full}};d([H({count:Ah.COUNT})],lee.prototype,"mode",void 0);let gae=class extends Li{constructor(){super(...arguments),this.weatherTile=mr(0,0)}};function xDe(t){const e=new Fr;return e.include(gl,!1),e.fragment.code.add(T`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===Ah.Full&&e.fragment.code.add(T`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${T.float(hf)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${T.float(8)});

      float worley0 = worley(p, ${T.float(2)} * 2.0);
      float worley1 = worley(p, ${T.float(2)} * 8.0);
      float worley2 = worley(p, ${T.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${T.float(2)});
      float worley1 = worley(p, ${T.float(2)} * 2.0);
      float worley2 = worley(p, ${T.float(2)} * 4.0);
      float worley3 = worley(p, ${T.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new ci("weatherTile",r=>r.weatherTile)),e.fragment.code.add(T`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${T.float(OH)});

      // Get global coordinates of p
      p += weatherTile * ${T.float(OH)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${T.float(aft)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(T`void main() {`),t.mode===Ah.Full&&e.fragment.code.add(T`
        float padWidth = 1.0;
        float paddedSize = ${T.float(Md)} + 2.0 * padWidth;
        float tileCount = ${T.float(hf)} * ${T.float(hf)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${T.float(Md)};
          }

          if (startPadY) {
            pixel.y += ${T.float(Md)};
          }

          if (endPadX) {
            pixel.x -= ${T.float(Md)};
          }

          if (endPadY) {
            pixel.y -= ${T.float(Md)};
          }

          uv = vec2(pixel.xy / ${T.float(Md)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${T.float(Md)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${T.float(hf)} * ${T.float(hf)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${T.float(hf)} * ${T.float(hf)});
        p = p_;
        p.z /= (${T.float(hf)} * ${T.float(hf)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(T`
      vec2 mapUV = ${T.float(OH)} * (gl_FragCoord.xy / ${T.float(ub)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===Ah.Full?T`fragColor.ba = vec2(0.0, map);`:T`fragColor = vec4(map);`};
    }
  `),e}const hft=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:gae,build:xDe},Symbol.toStringTag,{value:"Module"}));let cee=class SDe extends Zr{initializeProgram(e){return new Br(e.rctx,SDe.shader.get().build(this.configuration),Nr)}initializePipeline(){return Bt({blending:this.configuration.mode===Ah.Full?qu(Ee.ONE,Ee.ZERO):ya(Ee.ZERO,Ee.ONE,Ee.ONE,Ee.ZERO),depthTest:{func:si.ALWAYS},colorWrite:rr})}};cee.shader=new Vr(hft,()=>re(()=>Promise.resolve().then(()=>bjt),void 0));let TDe=class{constructor(e,r,i=r){this.internalFormat=e,this.width=r,this.height=i,this.multisampled=!1,this.samples=1}};function dft(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*aae(t.internalFormat)}let EDe=class{constructor(e,r){this._context=e,this._descriptor=r,this.type=Vb.RenderBuffer,this._context.instanceCounter.increment(ss.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:n,height:s,internalFormat:o,multisampled:a}=r;a?i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,n,s):i.renderbufferStorage(i.RENDERBUFFER,o,n,s)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,r=this._context.parameters.maxSamples;return e?Math.min(e,r):r}get usedMemory(){return dft(this._descriptor)}resize(e,r){const i=this._descriptor;if(i.width===e&&i.height===r)return;i.width=e,i.height=r;const n=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):n.renderbufferStorage(n.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(ss.Renderbuffer,this),this._context=null)}};const pft=()=>K.getLogger("esri.views.webgl.FramebufferObject");let xm=class qR{constructor(e,r,i=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(ss.FramebufferObject,this);const n=e8(r)?r:new Mr(this._context,r);if(this._colorAttachments.set(Vl.COLOR_ATTACHMENT0,n),this._validateTextureDescriptor(n.descriptor),this._validateColorAttachmentPoint(Vl.COLOR_ATTACHMENT0),i!=null)if(mft(i))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=e8(i)?i:new Mr(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const s=fft(i)?i:new EDe(this._context,i);this._depthStencilBuffer=s,this._validateRenderBufferDescriptor(s.descriptor)}}dispose(){var r,i;if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((n,s)=>{var o;return(o=this.detachColorTexture(s))==null?void 0:o.dispose()}),(r=this.detachDepthStencilBuffer())==null||r.dispose(),(i=this.detachDepthStencilTexture())==null||i.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(ss.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(Vl.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var r;const e=this._colorAttachments.get(Vl.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.width)??0}get height(){var r;const e=this._colorAttachments.get(Vl.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.height)??0}get usedMemory(){var e;return[...this._colorAttachments].reduce((r,[i,n])=>r+n.usedMemory,((e=this.depthStencil)==null?void 0:e.usedMemory)??0)}getColorTexture(e){const r=this._colorAttachments.get(e);return r&&e8(r)?r:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,r=Vl.COLOR_ATTACHMENT0){var n;if(!e)return;this._validateColorAttachmentPoint(r);const i=e.descriptor;this._validateTextureDescriptor(i),(n=this.detachColorTexture(r))==null||n.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,r)),this._colorAttachments.set(r,e)}detachColorTexture(e=Vl.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(e);if(r){if(this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(i)}return this._colorAttachments.delete(e),r}}setColorTextureTarget(e,r=Vl.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);i&&this._framebufferTexture2D(i.glName,r,e)}attachDepthStencil(e){if(e)switch(e.type){case Vb.Texture:return this._attachDepthStencilTexture(e);case Vb.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){var i;if(e==null)return;const r=e.descriptor;r.pixelFormat!==Ot.DEPTH_STENCIL&&r.pixelFormat!==Ot.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==Ks.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,cA)),(i=this._depthStencilTexture)==null||i.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,cA)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const r=e.descriptor;if(this._validateRenderBufferDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,n=this._getGLAttachmentPoint(r);i.framebufferRenderbuffer(Ja.FRAMEBUFFER,n,i.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(Ja.FRAMEBUFFER,i,r.RENDERBUFFER,null)}return this._depthStencilBuffer=null,e}copyToTexture(e,r,i,n,s,o,a){(e<0||r<0||s<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==In.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||e+i>this.width||r+n>this.height||s+i>l.width||o+n>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,u=c.bindTexture(a,Mr.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Mr.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(In.TEXTURE_2D,0,s,o,e,r,i,n),c.bindTexture(u,Mr.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,r,i,n,s,o,a){(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,r,i,n,s,o,a)}async readPixelsAsync(e,r,i,n,s,o,a){const{gl:l}=this._context,c=ti.createPixelPack(this._context,Lr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,r,i,n,s,o,0),this._context.unbindBuffer(Tt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,r){var n,s;if(this.width===e&&this.height===r)return;const i={width:e,height:r};QS(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(o=>o.resize(i.width,i.height)),(n=this._depthStencilTexture)==null||n.resize(i.width,i.height),this._initialized&&(QS(i,this._context.parameters.maxRenderbufferSize),(s=this._depthStencilBuffer)==null||s.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=Ja.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(e,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=r.createFramebuffer();if(r.bindFramebuffer(e,i),this._colorAttachments.forEach((n,s)=>this._framebufferTexture2D(n.glName,s,Oge(n),e)),this._depthStencilBuffer){const n=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);r.framebufferRenderbuffer(e,n,r.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,Oge(this._depthStencilTexture),e);wf()&&r.checkFramebufferStatus(e)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(e,r=Vl.COLOR_ATTACHMENT0,i=In.TEXTURE_2D,n=Ja.FRAMEBUFFER,s=0){this._context.gl.framebufferTexture2D(n,r,i,e,s)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const r=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(Ja.FRAMEBUFFER,r,e.RENDERBUFFER,null)}this._depthStencilBuffer=wt(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=wt(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==In.TEXTURE_2D&&e.target!==In.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),QS(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){QS(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case Ia.DEPTH_COMPONENT16:case Ia.DEPTH_COMPONENT24:case Ia.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case Ia.DEPTH24_STENCIL8:case Ia.DEPTH32F_STENCIL8:case Ia.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case Ia.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(qR._MAX_COLOR_ATTACHMENTS===-1){const{gl:i}=this._context;qR._MAX_COLOR_ATTACHMENTS=i.getParameter(i.MAX_COLOR_ATTACHMENTS)}const r=e-Vl.COLOR_ATTACHMENT0;r+1>qR._MAX_COLOR_ATTACHMENTS&&K.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${qR._MAX_COLOR_ATTACHMENTS} color attachments`)}};function e8(t){return t!=null&&"type"in t&&t.type===Vb.Texture}function fft(t){return t!=null&&"type"in t&&t.type===Vb.RenderBuffer}function mft(t){return e8(t)||t!=null&&"pixelFormat"in t}function QS(t,e){const r=Math.max(t.width,t.height);if(r>e){pft().warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const i=e/r;return t.width=Math.round(t.width*i),t.height=Math.round(t.height*i),!1}return!0}function Oge(t){return t.descriptor.target===In.TEXTURE_CUBE_MAP?In.TEXTURE_CUBE_MAP_POSITIVE_X:In.TEXTURE_2D}xm._MAX_COLOR_ATTACHMENTS=-1;let WR=class extends Pe{constructor(e){super(e),this._needsRender=!0,this._passParameters=new gae,this._fbo=new xm(e.context.renderContext.rctx,new ui(ub)),this._vao=Sy(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(Ah.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(Ah.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(vo(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=lr(this._fullTechniqueCached),this._weatherMapTechniqueCached=lr(this._weatherMapTechniqueCached),this._fbo=wt(this._fbo),this._vao=wt(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new lee;e.mode=Ah.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(cee,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new lee;e.mode=Ah.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(cee,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._fbo==null)return null;const r=e===Ah.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,n=i.getViewport();i.setViewport(0,0,ub,ub),i.bindFramebuffer(this._fbo);const s=i.bindTechnique(r,null,this._passParameters);return i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(n.x,n.y,n.width,n.height),this._needsRender=!1,this._fbo.colorTexture}};d([m({constructOnly:!0})],WR.prototype,"context",void 0),d([m({readOnly:!0})],WR.prototype,"_techniqueRepository",null),WR=d([F("esri.views.3d.environment.NoiseTextureAtlas")],WR);var cu;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(cu||(cu={}));function CDe(t){t.include(dy),t.uniforms.add(new ft("geometryDepthTexture",(e,r)=>{var i;return(i=r.multipassGeometry.linearDepth)==null?void 0:i.getTexture()}),new ci("nearFar",(e,r)=>r.camera.nearFar)),t.code.add(T`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let gft=class{};function Yu(t,e){if(!e.multipassEnabled)return;t.fragment.include(dy),t.fragment.uniforms.add(new ft("terrainDepthTexture",(i,n)=>{var s;return(s=n.multipassTerrain.linearDepth)==null?void 0:s.getTexture()}),new ci("nearFar",(i,n)=>n.camera.nearFar));const r=e.occlusionPass;t.fragment.code.add(T`
   ${r?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      vec4 data = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);
      float linearDepth = linearDepthFromRGBA(data, nearFar);
      ${r?T`return fragmentDepth < linearDepth && data != vec4(0.0, 0.0, 0.0, 1.0);`:T`
          if(fragmentDepth ${e.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}let yft=class{constructor(){this.cullAboveGround=!1}};function H7(t){return t?{ray:fo(t.ray),c0:t.c0,c1:t.c1}:{ray:fo(),c0:0,c1:Number.MAX_VALUE}}function _ft(t,e=H7()){return Wz(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function vft(t,e,r=H7()){const i=Te(t.vector);return vRe(t.origin,e,r.ray),r.c0=0,r.c1=i,r}function OJt(t,e){return PDe(t,t.c0,e)}function MJt(t,e){return PDe(t,t.c1,e)}function PDe(t,e,r){return ge(r,t.ray.origin,oe(r,t.ray.direction,e))}new S_(()=>H7());function pD(t){return t?[Yr(t[0]),Yr(t[1]),Yr(t[2]),Yr(t[3]),Yr(t[4]),Yr(t[5])]:[Yr(),Yr(),Yr(),Yr(),Yr(),Yr()]}function ADe(){return[C(),C(),C(),C(),C(),C(),C(),C()]}function d9(t,e){for(let r=0;r<rO;r++)BB(t[r],e[r]);return t}function ODe(t,e,r,i=Eft){const n=Kr(yse.get(),e,t);us(n,n);for(let s=0;s<Sft;++s){const o=Mu(gse.get(),Tft[s],n);se(i[s],o[0]/o[3],o[1]/o[3],o[2]/o[3])}MDe(r,i)}function MDe(t,e){rl(e[ut.FAR_BOTTOM_LEFT],e[ut.NEAR_BOTTOM_LEFT],e[ut.NEAR_TOP_LEFT],t[fi.LEFT]),rl(e[ut.NEAR_BOTTOM_RIGHT],e[ut.FAR_BOTTOM_RIGHT],e[ut.FAR_TOP_RIGHT],t[fi.RIGHT]),rl(e[ut.FAR_BOTTOM_LEFT],e[ut.FAR_BOTTOM_RIGHT],e[ut.NEAR_BOTTOM_RIGHT],t[fi.BOTTOM]),rl(e[ut.NEAR_TOP_LEFT],e[ut.NEAR_TOP_RIGHT],e[ut.FAR_TOP_RIGHT],t[fi.TOP]),rl(e[ut.NEAR_BOTTOM_LEFT],e[ut.NEAR_BOTTOM_RIGHT],e[ut.NEAR_TOP_RIGHT],t[fi.NEAR]),rl(e[ut.FAR_BOTTOM_RIGHT],e[ut.FAR_BOTTOM_LEFT],e[ut.FAR_TOP_LEFT],t[fi.FAR])}function jv(t,e){for(let r=0;r<rO;r++){const i=t[r];if(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=e[3])return!1}return!0}function bft(t,e){return $De(t,_ft(e,IDe.get()))}function RJt(t,e){for(let r=0;r<rO;r++){const i=t[r];if(!DKe(i,e))return!1}return!0}function wft(t,e,r){return $De(t,vft(e,r,IDe.get()))}function RDe(t,e){for(let r=0;r<rO;r++)if(Ci(t[r],e)>0)return!1;return!0}function $De(t,e){for(let r=0;r<rO;r++)if(!LKe(t[r],e))return!1;return!0}var fi,ut;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(fi||(fi={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(ut||(ut={}));const xft={bottom:[ut.FAR_BOTTOM_RIGHT,ut.NEAR_BOTTOM_RIGHT,ut.NEAR_BOTTOM_LEFT,ut.FAR_BOTTOM_LEFT],near:[ut.NEAR_BOTTOM_LEFT,ut.NEAR_BOTTOM_RIGHT,ut.NEAR_TOP_RIGHT,ut.NEAR_TOP_LEFT],far:[ut.FAR_BOTTOM_RIGHT,ut.FAR_BOTTOM_LEFT,ut.FAR_TOP_LEFT,ut.FAR_TOP_RIGHT],right:[ut.NEAR_BOTTOM_RIGHT,ut.FAR_BOTTOM_RIGHT,ut.FAR_TOP_RIGHT,ut.NEAR_TOP_RIGHT],left:[ut.FAR_BOTTOM_LEFT,ut.NEAR_BOTTOM_LEFT,ut.NEAR_TOP_LEFT,ut.FAR_TOP_LEFT],top:[ut.FAR_TOP_LEFT,ut.NEAR_TOP_LEFT,ut.NEAR_TOP_RIGHT,ut.FAR_TOP_RIGHT]},rO=6,Sft=8,Tft=[Xt(-1,-1,-1,1),Xt(1,-1,-1,1),Xt(1,1,-1,1),Xt(-1,1,-1,1),Xt(-1,-1,1,1),Xt(1,-1,1,1),Xt(1,1,1,1),Xt(-1,1,1,1)],IDe=new S_(H7),Eft=ADe();function Cft(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function Pft(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function Aft(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function Oft(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}var uee;let st=uee=class extends Pe{constructor(t){super(t),this._ray=fo(),this._viewport=Xt(0,0,1,1),this._padding=Xt(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=mr(1,1e3),this._viewDirty=!0,this._viewMatrix=xe(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=xe(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=xe(),this._frustumDirty=!0,this._frustum=pD(),this._fullViewport=tr(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=C(),this._up=C(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return _e(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){cs(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),se(C(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),se(C(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),se(C(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=WT(tr(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&YT(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=WT(tr(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&YT(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[or.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[or.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[or.RIGHT]+this._padding[or.LEFT]}set fullWidth(t){this.width=t-(this._padding[or.RIGHT]+this._padding[or.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[or.TOP]+this._padding[or.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[or.TOP]+this._padding[or.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[or.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[or.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){z3(this._padding,t)||(this._viewport[0]+=t[or.LEFT]-this._padding[or.LEFT],this._viewport[1]+=t[or.BOTTOM]-this._padding[or.BOTTOM],this._viewport[2]-=t[or.RIGHT]+t[or.LEFT]-(this._padding[or.RIGHT]+this._padding[or.LEFT]),this._viewport[3]-=t[or.TOP]+t[or.BOTTOM]-(this._padding[or.TOP]+this._padding[or.BOTTOM]),qd(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Kr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,r=this.near*Math.tan(this.fovY/2)*2,i=r*this._aspect,n=r/this.rows,s=i/this.columns,o=-i/2+this.column*s,a=o+s,l=-r/2+this.row*n,c=l+n,u=iPe(xe(),o*(1+2*this._padding[or.LEFT]/t),a*(1+2*this._padding[or.RIGHT]/t),l*(1+2*this._padding[or.BOTTOM]/e),c*(1+2*this._padding[or.TOP]/e),this.near,this.far),h=this._get("projectionMatrix");return h&&EB(h,u)?h:u}get inverseProjectionMatrix(){return us(xe(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||xe()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Aft(this._fov,this.width,this.height)}set fovX(t){this._fov=Cft(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Oft(this._fov,this.width,this.height)}set fovY(t){this._fov=Pft(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Bi(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(us(this._viewInverseTransposeMatrix,this.viewMatrix),Bu(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){he(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,qd(this._viewport,t.viewport),this.notifyChange("_viewport"),qd(this._padding,t.padding),this.notifyChange("_padding"),vo(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(cs(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(d9(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(cs(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),qd(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new uee().copyFrom(this)}equals(t){return aa(this.eye,t.eye)&&aa(this.center,t.center)&&aa(this.up,t.up)&&z3(this._viewport,t.viewport)&&z3(this._padding,t.padding)&&mOe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||Tz(t.screenPadding,this.screenPadding)>=e||Tz(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;rn(Va,t.eye,t.center),rn(MH,this.eye,this.center);const r=fe(Va,MH),i=vz(Va),n=vz(MH),s=5e-4;return r*r>=(1-1e-10)*i*n&&GL(t.eye,this.eye)<Math.max(i,n)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(bI(this.viewForward,_e(Va,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Sn()){return t[0]=(this.padding[or.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[or.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,r=.5){return t[0]=this.padding[or.LEFT]+this.width*e,t[1]=this.padding[or.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const e=this.viewport,r=this.padding;t.setViewport(e[0]-r[3],e[1]-r[2],e[2]+r[1]+r[3],e[3]+r[0]+r[2])}applyProjection(t,e){t!==$r&&he($r,t),$r[3]=1,Mu($r,$r,this.projectionMatrix);const r=Math.abs($r[3]);oe($r,$r,1/r);const i=this.fullViewport;e[0]=Dt(0,i[0]+i[2],.5+.5*$r[0]),e[1]=Dt(0,i[1]+i[3],.5+.5*$r[1]),e[2]=.5*($r[2]+1),e[3]=r}unapplyProjection(t,e){const r=this.fullViewport;$r[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],$r[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],$r[2]=(2*t[2]-1)*t[3],$r[3]=t[3],this.inverseProjectionMatrix!=null&&(Mu($r,$r,this.inverseProjectionMatrix),e[0]=$r[0],e[1]=$r[1],e[2]=$r[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,RH),this.renderToScreen(RH,e),e}projectToRenderScreen(t,e){if($r[0]=t[0],$r[1]=t[1],$r[2]=t[2],$r[3]=1,Mu($r,$r,this.viewProjectionMatrix),$r[3]===0)return null;const r=$r;oe(r,r,1/Math.abs($r[3]));const i=this.fullViewport,n=Dt(0,i[0]+i[2],.5+.5*r[0]),s=Dt(0,i[1]+i[3],.5+.5*r[1]);return"x"in e?(e.x=n,e.y=s):(e[0]=n,e[1]=s,e.length>2&&(e[2]=.5*(r[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,RH),e)}unprojectFromRenderScreen(t,e){if(Kr(R5,this.projectionMatrix,this.viewMatrix),!us(R5,R5))return null;const r=this.fullViewport;return $r[0]=2*(t[0]-r[0])/r[2]-1,$r[1]=2*(t[1]-r[1])/r[3]-1,$r[2]=2*t[2]-1,$r[3]=1,Mu($r,$r,R5),$r[3]===0?null:(e[0]=$r[0]/$r[3],e[1]=$r[1]/$r[3],e[2]=$r[2]/$r[3],e)}constrainWindowSize(t,e,r,i){const n=t*this.pixelRatio,s=e*this.pixelRatio,o=Math.max(n-r/2,0),a=Math.max(this.fullHeight-s-i/2,0),l=-Math.min(n-r/2,0),c=-Math.min(this.fullHeight-s-i/2,0),u=r-l- -Math.min(this.fullWidth-n-r/2,0),h=i-c- -Math.min(s-i/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(h)]}computeUp(t){t===Fe.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const r=t[0]*this.pixelRatio,i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=r,e[1]=i,e}renderToScreen(t,e){const r=t[0]/this.pixelRatio,i=(this.fullHeight-t[1])/this.pixelRatio;e[0]=r,e[1]=i}_computeUpGlobal(){_e(Va,this.center,this.eye);const t=Te(this.center);t<1?(se(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(fe(Va,this.center))>.9999*Te(Va)*t||(it(this._up,Va,this.center),it(this._up,this._up,Va),me(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){x_(Va,this.eye,this.center),Math.abs(Va[2])<=.9999&&(oe(Va,Va,Va[2]),se(this._up,-Va[0],-Va[1],1-Va[2]),me(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,r=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?aa(t,e)||(he(e,t),this._markViewDirty(),r.length&&this.notifyChange(r)):K.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(ODe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(TB(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};d([m()],st.prototype,"_viewport",void 0),d([m()],st.prototype,"_padding",void 0),d([m()],st.prototype,"_fov",void 0),d([m()],st.prototype,"_nearFar",void 0),d([m()],st.prototype,"_viewDirty",void 0),d([m()],st.prototype,"_viewMatrix",void 0),d([m()],st.prototype,"_pixelRatio",void 0),d([m()],st.prototype,"pixelRatio",null),d([m()],st.prototype,"row",void 0),d([m()],st.prototype,"column",void 0),d([m()],st.prototype,"_rows",void 0),d([m()],st.prototype,"rows",null),d([m()],st.prototype,"_columns",void 0),d([m()],st.prototype,"columns",null),d([m()],st.prototype,"eye",null),d([m()],st.prototype,"center",null),d([m()],st.prototype,"_center",void 0),d([m()],st.prototype,"up",null),d([m()],st.prototype,"_up",void 0),d([m({readOnly:!0})],st.prototype,"viewForward",null),d([m({readOnly:!0})],st.prototype,"viewUp",null),d([m({readOnly:!0})],st.prototype,"viewRight",null),d([m({readOnly:!0})],st.prototype,"nearFar",null),d([m()],st.prototype,"near",null),d([m()],st.prototype,"far",null),d([m()],st.prototype,"viewport",null),d([m({readOnly:!0})],st.prototype,"screenViewport",null),d([m({readOnly:!0})],st.prototype,"screenPadding",null),d([m()],st.prototype,"x",null),d([m()],st.prototype,"y",null),d([m()],st.prototype,"width",null),d([m()],st.prototype,"height",null),d([m()],st.prototype,"fullWidth",null),d([m()],st.prototype,"fullHeight",null),d([m({readOnly:!0})],st.prototype,"_aspect",null),d([m()],st.prototype,"padding",null),d([m({readOnly:!0})],st.prototype,"projectionMatrix",null),d([m({readOnly:!0})],st.prototype,"inverseProjectionMatrix",null),d([m()],st.prototype,"fov",null),d([m()],st.prototype,"fovX",null),d([m()],st.prototype,"fovY",null),st=uee=d([F("esri.views.3d.webgl-engine.lib.Camera")],st);const $r=tr(),R5=xe(),Va=C(),MH=C(),RH=Na();var or;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(or||(or={}));var de;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH",t[t.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH",t[t.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",t[t.ANTIALIASING=12]="ANTIALIASING",t[t.COMPOSITE=13]="COMPOSITE",t[t.BLIT=14]="BLIT",t[t.SSAO=15]="SSAO",t[t.HIGHLIGHT=16]="HIGHLIGHT",t[t.SHADOW_HIGHLIGHT=17]="SHADOW_HIGHLIGHT",t[t.ENVIRONMENT_OPAQUE=18]="ENVIRONMENT_OPAQUE",t[t.ENVIRONMENT_TRANSPARENT=19]="ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=20]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=21]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=22]="HUD_MATERIAL",t[t.LABEL_MATERIAL=23]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=24]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=25]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=26]="DRAPED_MATERIAL",t[t.DRAPED_WATER=27]="DRAPED_WATER",t[t.VOXEL=28]="VOXEL",t[t.MAX_SLOTS=29]="MAX_SLOTS"})(de||(de={}));var vt;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(vt||(vt={}));let yae=class{constructor(e=C()){this.intensity=e}},LDe=class{constructor(e=C(),r=Ce(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},p9=class{constructor(e=C(),r=Ce(.57735,.57735,.57735),i=!0,n=1,s=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=n,this.environmentStrength=s}},DDe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function Mft(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e[i];return r}function $H(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e;return r}function eP(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]+e[i];return r}function NDe(t){return(t+1)*(t+1)}function Rft(t){return we(Math.floor(Math.sqrt(t)-1),0,2)}function FDe(t,e,r){const i=t[0],n=t[1],s=t[2],o=r||[];return o.length=NDe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*s,o[3]=.4886025119*n),e>=2&&(o[4]=1.09254843059*i*n,o[5]=1.09254843059*n*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*i*s,o[8]=.54627421529*(i*i-n*n)),o}function $ft(t,e){const r=NDe(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let n=0;n<r;n++)i.r[n]=i.g[n]=i.b[n]=0;return i}function Ift(t,e){const r=Rft(e.r.length);for(const i of t)ua(hee,i.direction),FDe(hee,r,R0),Mft(R0,t8),$H(R0,i.intensity[0],tE),eP(e.r,tE),$H(R0,i.intensity[1],tE),eP(e.g,tE),$H(R0,i.intensity[2],tE),eP(e.b,tE);return e}function Lft(t,e){FDe(hee,0,R0);for(const r of t)e.r[0]+=R0[0]*t8[0]*r.intensity[0]*4*Math.PI,e.g[0]+=R0[0]*t8[0]*r.intensity[1]*4*Math.PI,e.b[0]+=R0[0]*t8[0]*r.intensity[2]*4*Math.PI;return e}function Dft(t,e,r,i){$ft(e,i),se(r.intensity,0,0,0);let n=!1;const s=Nft,o=Fft,a=kft;s.length=0,o.length=0,a.length=0;for(const l of t)l instanceof p9&&!n?(he(r.direction,l.direction),he(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,n=!0):l instanceof p9||l instanceof LDe?s.push(l):l instanceof yae?o.push(l):l instanceof DDe&&a.push(l);Ift(s,i),Lft(o,i);for(const l of a)eP(i.r,l.r),eP(i.g,l.g),eP(i.b,l.b)}const Nft=[],Fft=[],kft=[],R0=[0],tE=[0],hee=C(),t8=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Mge=class{constructor(){this.color=C(),this.intensity=1}},Uft=class{constructor(){this.direction=C(),this.ambient=new Mge,this.diffuse=new Mge}};const kDe=.4;let IH=class{constructor(){this._shOrder=2,this._legacy=new Uft,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new DDe,this._mainLight=new p9(C(),Ce(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){Dft(e,this._shOrder,this._mainLight,this._sphericalHarmonics),he(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,oe(this._legacy.diffuse.color,this._mainLight.intensity,r),he($5,this._legacy.diffuse.color),oe($5,$5,kDe*this.globalFactor),ge(this._legacy.ambient.color,this._legacy.ambient.color,$5)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),he(this._mainLight.direction,e.mainLight.direction),he(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,r,i){if(pi(this._mainLight.intensity,e.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=Dt(e.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=Dt(e.mainLight.specularStrength,r.mainLight.specularStrength,i),he(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=Dt(e.globalFactor,r.globalFactor,i),this.noonFactor=Dt(e.noonFactor,r.noonFactor,i),e.sh.r.length===r.sh.r.length)for(let n=0;n<r.sh.r.length;n++)this._sphericalHarmonics.r[n]=Dt(e.sh.r[n],r.sh.r[n],i),this._sphericalHarmonics.g[n]=Dt(e.sh.g[n],r.sh.g[n],i),this._sphericalHarmonics.b[n]=Dt(e.sh.b[n],r.sh.b[n],i);else for(let n=0;n<r.sh.r.length;n++)this._sphericalHarmonics.r[n]=r.sh.r[n],this._sphericalHarmonics.g[n]=r.sh.g[n],this._sphericalHarmonics.b[n]=r.sh.b[n]}};const $5=C();let q7=class{constructor(e,r){this.shadowMap=e,this.slicePlane=r,this.slot=de.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=vt.NONE,this.alignPixelEnabled=!1,this.decorations=Ac.ON,this.overlayStretch=1,this._camera=new st,this._inverseViewport=Ye(),this.oldLighting=new IH,this.newLighting=new IH,this._fadedLighting=new IH,this._lighting=this.newLighting,this.ssr=new zft,this.multipassEnabled=!1,this.multipassTerrain=new yft,this.multipassGeometry=new gft,this.hudRenderStyle=cu.Occluded,this.cloudsFade=new jpt}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:r,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,e),this._lighting=this._fadedLighting)}},zft=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=xe()}};const pa=Symbol("Yield");let Vft=class{constructor(){this._tasks=new Array,this._runningTasks=Zg(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(this.length===0)return pa;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,r,i){return++this._runningTasks.value,new Promise((n,s)=>this._tasks.push(new Rge(n,s,e,r,i))).finally(()=>--this._runningTasks.value)}unshift(e,r,i){return++this._runningTasks.value,new Promise((n,s)=>this._tasks.unshift(new Rge(n,s,e,r,i))).finally(()=>--this._runningTasks.value)}_process(e){var i;if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const n=Ms(r.signal);if(n&&!r.abortCallback)r.reject(gr());else{const s=n?(i=r.abortCallback)==null?void 0:i.call(r,gr()):r.callback(e);Xu(s)?s.then(r.resolve,r.reject):r.resolve(s)}}catch(n){r.reject(n)}return!0}cancelAll(){const e=gr();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(e);r.resolve(i)}else r.reject(e);this._tasks.length=0}},Rge=class{constructor(e,r,i,n=void 0,s=void 0){this.resolve=e,this.reject=r,this.callback=i,this.signal=n,this.abortCallback=s}},YR=class extends Pe{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};d([m()],YR.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),d([m()],YR.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),YR=d([F("esri.views.support.DebugFlags")],YR);const Bft=new YR;function Gft(){return new f9.Scheduler}var Ct;(function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"})(Ct||(Ct={}));const Sg=0,$ge=new Map([[Ct.RESOURCE_CONTROLLER_IMMEDIATE,Sg],[Ct.RESOURCE_CONTROLLER,4],[Ct.SLIDE,Sg],[Ct.STREAM_DATA_LOADER,Sg],[Ct.ELEVATION_QUERY,Sg],[Ct.TERRAIN_SURFACE,1],[Ct.SURFACE_GEOMETRY_UPDATES,1],[Ct.LOD_RENDERER,2],[Ct.GRAPHICS_CORE,2],[Ct.I3S_CONTROLLER,2],[Ct.POINT_CLOUD_LAYER,2],[Ct.FEATURE_TILE_FETCHER,2],[Ct.OVERLAY,4],[Ct.STAGE,4],[Ct.GRAPHICS_DECONFLICTOR,4],[Ct.FILTER_VISIBILITY,4],[Ct.SCALE_VISIBILITY,4],[Ct.FRUSTUM_VISIBILITY,4],[Ct.CLOUDS_GENERATOR,4],[Ct.POINT_OF_INTEREST_FREQUENT,6],[Ct.POINT_OF_INTEREST_INFREQUENT,30],[Ct.LABELER,8],[Ct.FEATURE_QUERY_ENGINE,8],[Ct.FEATURE_TILE_TREE,16],[Ct.FEATURE_TILE_TREE_ACTIVE,Sg],[Ct.ELEVATION_ALIGNMENT,12],[Ct.ELEVATION_ALIGNMENT_SCENE,14],[Ct.TEXT_TEXTURE_ATLAS,12],[Ct.TEXTURE_UNLOAD,12],[Ct.LINE_OF_SIGHT_TOOL,16],[Ct.LINE_OF_SIGHT_TOOL_INTERACTIVE,Sg],[Ct.SNAPPING,Sg],[Ct.SHADOW_ACCUMULATOR,30]]);function Ige(t){return $ge.has(t)?$ge.get(t):typeof t=="number"?t:1}const Lge=6.5,Dge=1,jft=30,Nge=1e3/30,Fge=100,kge=.9;var f9,Dw;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(s=>s.needsUpdate)}constructor(){this._updating=Zg(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new D0("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=Xr.INTERACTING,this._tasks=new jt,this._runQueue=new jt,this._load=0,this._idleStateCallbacks=new jt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=pe(()=>Bft.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,mi);for(const o of Object.keys(Ct))this.performanceInfo.tasks.set(Ct[o],new D0(Ct[o]));const s=this;this._test={FRAME_SAFETY_BUDGET:Lge,INTERACTING_BUDGET:Nge,IDLE_BUDGET:Fge,get availableBudget(){return s._budget.budget},usedBudget:0,getBudget:()=>s._budget,setBudget:o=>s._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),Pi(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(s){this._updatingChanged(),s&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(s,o){const a=new r(this,s,o);return this._tasks.push(a),this._updatingChanged(),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new D0(s)),a}registerIdleStateCallbacks(s,o){const a={idleBegin:s,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Xr.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Xr.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==Xr.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(s){this._test.usedBudget=0,++this._frameNumber;let o=Lge,a=s.frameDuration,l=Dge;switch(this.state){case Xr.IDLE:o=0,a=Math.max(Fge,s.frameDuration),l=jft;break;case Xr.INTERACTING:a=Math.max(Nge,s.frameDuration);case Xr.ANIMATING:}return a=a-s.elapsedFrameTime-o,this.state!==Xr.IDLE&&a<Dge&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Xr.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case Xr.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s),this._updatingChanged()}_updateTask(s){this._tasks.forAll(o=>{o.name===s&&o.setPriority(s)})}_getState(s){if(this._runQueue.some(a=>a.name===s))return Dw.SCHEDULED;let o=Dw.IDLE;return this._tasks.forAll(a=>{a.name===s&&a.needsUpdate&&(a.schedulePriority<=1?o=Dw.READY:o!==Dw.READY&&(o=Dw.WAITING))}),o}_getRuntime(s){let o=0;return this._tasks.forAll(a=>{a.name===s&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&s.set(a.name,(s.get(a.name)||0)+1)}),s.size===0)return null;let o="";return s.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*kge+s*(1-kge)}_schedule(){for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===Sg&&s.needsUpdate&&!this._runQueue.includes(s)&&s.blockFrame!==this._frameNumber&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Sg&&a.blockFrame!==this._frameNumber&&(s=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!s)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===pa&&(a.blockFrame=this._frameNumber)}catch(c){K.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c),a.blockFrame=this._frameNumber}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,Ct.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(Ct))this._frameTaskTimes.set(Ct[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(s)}get test(){return this._test}}t.Scheduler=e;class r{get task(){return this._task.value}get updating(){return this._queue.running}constructor(s,o,a){this._scheduler=s,this.name=o,this.blockFrame=0,this.runtime=0,this._queue=new Vft,this._handles=new iw,this._basePriority=Ige(o),this.schedulePriority=this._basePriority,this._task=Zg(a??this._queue),this._handles.add(up(()=>this.task.running,l=>s.taskRunningChanged(l)))}remove(){this.processQueue(Xl),this._scheduler.removeTask(this),this.schedule=uA.schedule,this.reschedule=uA.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){if(this.name===s)return;this.name=s;const o=Ige(s);this._basePriority!==Sg&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,o,a){return this._queue.push(s,o,a)}reschedule(s,o,a){return this._queue.unshift(s,o,a)}processQueue(s){return this._queue.runTask(s)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Xr.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(s){return!this.done&&(s()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(s){this._enabled=s}reset(s,o){this._begin=this.now(),this._budget=s,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i})(f9||(f9={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(Dw||(Dw={}));const Xl=(()=>{const t=new f9.Budget;return t.enabled=!1,t})();let Hft=class{remove(){}processQueue(){}schedule(e,r,i){try{if(Ms(r)){const n=gr();return i?Promise.resolve(i(n)):Promise.reject(n)}return QX(e(Xl))}catch(n){return Promise.reject(n)}}reschedule(e,r,i){return this.schedule(e,r,i)}};const uA=new Hft;let _c=class extends Pe{constructor(e){super(e),this._techniques=new Array,this._techniqueConfiguration=new K6,this._bindParameters=new q7(null,null),this._passParameters=new mae,this._weatherTile=Ye(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Dt(qa.default.coverage[0],qa.default.coverage[1],.5),this.density=Dt(qa.default.density[0],qa.default.density[1],.5),this.absorption=Dt(qa.default.absorption[0],qa.default.absorption[1],.5),this.cloudSize=Dt(qa.default.cloudSize[0],qa.default.cloudSize[1],.5),this.detailSize=Dt(qa.default.detailSize[0],qa.default.detailSize[1],.5),this.smoothness=Dt(qa.default.smoothness[0],qa.default.smoothness[1],.5),this.cloudHeight=Dt(qa.default.cloudHeight[0],qa.default.cloudHeight[1],.5),this.raymarchingSteps=qa.default.raymarchingSteps,this._viewMatrix=xe(),this._dirty=!1,this.running=!1,this._vao=Sy(e.context.renderContext.rctx)}_getTechnique(e){const r=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=r===t2.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=r,this._techniqueConfiguration.steps=e,this._techniques[i]=new bDe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){const e=this.view.camera.position.latitude,r=this.view.camera.position.longitude;if(e==null||r==null)return;yr(this._weatherTile,(e+90)/180,(r+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let n=0,s=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),n=31*o.getUTCMonth()+o.getUTCDate(),s=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+n)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+s%100)%(4*this._weatherTileCount),gOe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=zr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this.addHandles([this.view.resourceController.scheduler.registerTask(Ct.CLOUDS_GENERATOR,this),pe(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),mi)])}destroy(){this._techniques.forEach(e=>lr(e)),this._frameBufferCube=wt(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Me(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Rc.SIXTEEN:return 1;case Rc.HUNDRED:return 4;case Rc.COUNT:case Rc.TWOHUNDRED:return 8}}get usedMemory(){var e,r,i;return(((e=this._frameBufferCube)==null?void 0:e.usedMemory)??0)+(((i=(r=this._passParameters.noiseTexture)==null?void 0:r.textureAtlas)==null?void 0:i.usedMemory)??0)}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new WR({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const r=new ui(e);r.target=In.TEXTURE_CUBE_MAP,r.wrapMode=nr.CLAMP_TO_EDGE,this._frameBufferCube=new xm(this.context.renderContext.rctx,r)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=wt(this._frameBufferCube)}applyPreset(e,r){const i=e.median,n=s=>{const o=Dt(s[0],s[1],i);return r<.5?Dt(s[0],o,2*r):Dt(o,s[1],2*(r-.5))};this.coverage=n(e.coverage),this.density=n(e.density),this.absorption=n(e.absorption),this.cloudSize=n(e.cloudSize),this.detailSize=n(e.detailSize),this.smoothness=n(e.smoothness),this.cloudHeight=n(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),vo(this._passParameters.weatherTile,this._weatherTile));const r=this._getTechnique(this._passParameters.raymarchingSteps);if(!r.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===ki.CROSS_FADE||!this._ensureNoiseTexture())return pa;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Ug.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=qft[this._faceIndex],n=Wft[this._faceIndex];sPe(this._viewMatrix,Yft,i,n),jh(this._passParameters.viewMatrix,this._viewMatrix);const s=this.context.renderContext.rctx,o=s.bindTechnique(r,this._bindParameters,this._passParameters);s.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao);const a=s.getViewport(),l=r.configuration.cubeMapSize,c=l/this._tilesPerFace,u=this._tileIndex*c;s.setViewport(0,u,l,c);const h=this._ensureFrameBufferCube(l);s.bindFramebuffer(h);const p=In.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return h.setColorTextureTarget(p),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4),s.gl.flush(),s.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Ug.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),pa}};d([m({constructOnly:!0})],_c.prototype,"context",void 0),d([m({constructOnly:!0})],_c.prototype,"view",void 0),d([m({constructOnly:!0})],_c.prototype,"requestRender",void 0),d([m()],_c.prototype,"coverage",void 0),d([m()],_c.prototype,"density",void 0),d([m()],_c.prototype,"absorption",void 0),d([m()],_c.prototype,"cloudSize",void 0),d([m()],_c.prototype,"detailSize",void 0),d([m()],_c.prototype,"smoothness",void 0),d([m()],_c.prototype,"cloudHeight",void 0),d([m()],_c.prototype,"raymarchingSteps",void 0),d([m()],_c.prototype,"running",void 0),_c=d([F("esri.views.3d.environment.CloudsGenerator")],_c);const qft=[wi(1,0,0),wi(-1,0,0),wi(0,1,0),wi(0,-1,0),wi(0,0,1)],Wft=[wi(0,1,0),wi(0,1,0),wi(0,0,-1),wi(0,0,1),wi(0,1,0)],Yft=fae();let _ae=class extends Li{constructor(){super(...arguments),this.fogColor=C(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function UDe(){const t=new Fr;t.attributes.add(R.POSITION,"vec2"),t.include(Jg,{textureCoordinateType:mn.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new _n("inverseProjectionMatrix",(i,n)=>n.camera.inverseProjectionMatrix),new _n("inverseViewMatrix",(i,n)=>zA(Xft,n.camera.viewMatrix))),e.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Ie("atmosphereC",i=>i.atmosphereC),new zt("cameraPosition",(i,n)=>n.camera.eye),new ci("nearFar",(i,n)=>n.camera.nearFar),new ft("depthTexture",i=>i.depthTexture),new Ie("fogStrength",i=>i.fogStrength),new Ie("fogAmount",i=>i.fogAmount),new zt("fogColor",i=>i.fogColor)),t.include(G7),r.include(dy),r.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(T`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(T`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const Xft=xe(),Zft=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:_ae,build:UDe},Symbol.toStringTag,{value:"Module"}));let zDe=class VDe extends Zr{constructor(e){super(e,new jc,()=>this.destroy())}initializeProgram(e){return new Br(e.rctx,VDe.shader.get().build(),Nr)}initializePipeline(){return Bt({blending:ya(Ee.SRC_ALPHA,Ee.ZERO,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE),colorWrite:rr})}};zDe.shader=new Vr(Zft,()=>re(()=>Promise.resolve().then(()=>wjt),void 0));const Jft=.95,Qft=1;let Hx=class extends Pe{constructor(e){super(e),this._passParameters=new _ae;const r=e.context.renderContext.rctx;this._vao=Sy(r,ON),this._technique=new zDe(e);const i=zr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+_v}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,r){if(this._update(e,r),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const n=e.offscreenRenderingHelper;n.renderDepthDetached(()=>{this._passParameters.depthTexture=n.depthTexture;const s=e.rctx.bindTechnique(i,e.bindParameters,this._passParameters);this._renderFog(s,e)})}_renderFog(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(dr.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;me(Uge,i.eye);const n=Math.max(0,fe(Uge,e.bindParameters.lighting.mainLight.direction)),s=r.color;oe(zge,s,.1),pi(this._passParameters.fogColor,zge,s,n);const o=Te(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-HL(Jft*E0,Qft*E0,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};d([m({constructOnly:!0})],Hx.prototype,"context",void 0),d([m({constructOnly:!0})],Hx.prototype,"view",void 0),d([m({constructOnly:!0})],Hx.prototype,"rctx",void 0),d([m({constructOnly:!0})],Hx.prototype,"viewingMode",void 0),Hx=d([F("esri.views.3d.environment.Fog")],Hx);let Kft=class{constructor(){this.color=C(),this.strength=0,this.amount=0}};const Uge=C(),zge=C();var G;function emt(t){return tP(t)||t===G.Depth||t===G.LinearDepth||t===G.Normal||t===G.ObjectAndLayerIdColor}function tP(t){return t===G.Shadow||t===G.ShadowHighlight||t===G.ShadowExcludeHighlight}function $I(t){return dee(t)||t===G.Normal}function bT(t){return t===G.Highlight||t===G.ObjectAndLayerIdColor}function BDe(t){return t===G.Color||bT(t)}function W0(t){return t===G.Color||t===G.Alpha}function LH(t){return W0(t)||t===G.ObjectAndLayerIdColor}function tmt(t){return W0(t)||t===G.Highlight}function Vge(t){return tmt(t)||t===G.LinearDepth}function r8(t){return W0(t)||bT(t)}function dee(t){return r8(t)||t===G.LinearDepth}(function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Depth=2]="Depth",t[t.Normal=3]="Normal",t[t.Shadow=4]="Shadow",t[t.ShadowHighlight=5]="ShadowHighlight",t[t.ShadowExcludeHighlight=6]="ShadowExcludeHighlight",t[t.Highlight=7]="Highlight",t[t.Alpha=8]="Alpha",t[t.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor",t[t.CompositeColor=10]="CompositeColor",t[t.COUNT=11]="COUNT"})(G||(G={}));function vae({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(T`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(T`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let GDe=class extends Pn{constructor(e,r){super(e,"mat4",kr.Draw,(i,n,s)=>i.setUniformMatrix4fv(e,r(n,s)))}};function mm(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Yn):t.uniforms.add(new Vh("cameraPosition",(r,i)=>se(jDe,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function Uu(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new _n("proj",(i,n)=>n.camera.projectionMatrix),new GDe("view",(i,n)=>Fc(Bge,n.camera.viewMatrix,i.origin)),new Vh("localOrigin",i=>i.origin));const r=i=>se(jDe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new _n("proj",(i,n)=>n.camera.projectionMatrix),new _n("view",(i,n)=>Fc(Bge,n.camera.viewMatrix,r(n))),new zt("localOrigin",(i,n)=>r(n)))}const Bge=xe(),jDe=C();function hA(t){t.uniforms.add(new _n("viewNormal",(e,r)=>r.camera.viewInverseTransposeMatrix))}function iO(t){t.uniforms.add(new Ie("pixelRatio",(e,r)=>r.camera.pixelRatio/r.overlayStretch))}let pee=class extends jc{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};d([H()],pee.prototype,"instancedDoublePrecision",void 0),d([H()],pee.prototype,"hasModelTransformation",void 0);const Gge=gi();function HDe(t,e){const r=e.hasModelTransformation,i=e.instancedDoublePrecision;r&&(t.vertex.uniforms.add(new _n("model",s=>s.modelTransformation??fn)),t.vertex.uniforms.add(new Zh("normalLocalOriginFromModel",s=>(d_(Gge,s.modelTransformation??fn),Gge)))),e.instanced&&i&&(t.attributes.add(R.INSTANCEMODELORIGINHI,"vec3"),t.attributes.add(R.INSTANCEMODELORIGINLO,"vec3"),t.attributes.add(R.INSTANCEMODEL,"mat3"),t.attributes.add(R.INSTANCEMODELNORMAL,"mat3"));const n=t.vertex;i&&(n.include(vae,e),n.uniforms.add(new Vh("viewOriginHi",(s,o)=>KKe(se(I5,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),I5)),new Vh("viewOriginLo",(s,o)=>eet(se(I5,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),I5)))),n.code.add(T`
    vec3 getVertexInLocalOriginSpace() {
      return ${r?i?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":i?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${i?T`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),n.code.add(T`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${r?i?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":i?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),e.output===G.Normal&&(hA(n),n.code.add(T`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${r?i?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":i?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),e.hasVertexTangents&&n.code.add(T`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${r?i?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":i?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const I5=C();let Zl=class extends pee{};d([H({constValue:!0})],Zl.prototype,"hasSliceHighlight",void 0),d([H({constValue:!1})],Zl.prototype,"hasSliceInVertexProgram",void 0),d([H({constValue:kr.Pass})],Zl.prototype,"pbrTextureBindType",void 0);var fy;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(fy||(fy={}));let bae=class extends Zl{constructor(){super(...arguments),this.geometry=fy.Cone}};d([H({count:fy.COUNT})],bae.prototype,"geometry",void 0);function RN(t){t.attributes.add(R.POSITION,"vec3"),t.vertex.code.add(T`vec3 positionModel() { return position; }`)}let m9=class extends Pn{constructor(e,r){super(e,"mat3",kr.Draw,(i,n,s)=>i.setUniformMatrix3fv(e,r(n,s)))}};function rP(t,e){t.include(RN);const r=t.vertex;r.include(vae,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add(new zt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new zt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Zh("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new _n("transformProjFromView",i=>i.transformProjFromView),new m9("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Vh("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Vh("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)),r.code.add(T`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(T`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?T`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:T`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new zt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(T`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(T`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let qDe=class extends Li{constructor(){super(...arguments),this.transformWorldFromViewTH=C(),this.transformWorldFromViewTL=C(),this.transformViewFromCameraRelativeRS=gi(),this.transformProjFromView=xe()}},WDe=class extends Li{constructor(){super(...arguments),this.transformWorldFromModelRS=gi(),this.transformWorldFromModelTH=C(),this.transformWorldFromModelTL=C()}};function Bb(t){t.varyings.add("linearDepth","float")}function r2(t){t.vertex.uniforms.add(new ci("nearFar",(e,r)=>r.camera.nearFar))}function W7(t){t.vertex.code.add(T`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function nO(t,e){const{vertex:r}=t;switch(e.output){case G.Color:if(e.receiveShadows)return Bb(t),void r.code.add(T`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case G.LinearDepth:case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:return t.include(rP,e),Bb(t),r2(t),W7(t),void r.code.add(T`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(T`void forwardLinearDepth() {}`)}function $c(t){W7(t),t.vertex.code.add(T`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(T`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let Y7=class extends Li{constructor(){super(...arguments),this.texV=Ye(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new wae}},wae=class{constructor(){this.center=C(),this.v1=C(),this.v2=C()}};function YDe(t){const e=new Fr,{vertex:r,fragment:i}=e;if(R_(r),t.geometry===fy.Underground)e.attributes.add(R.POSITION,"vec2"),e.varyings.add("color","vec4"),r.uniforms.add(new zt("cameraPosition",(n,s)=>s.camera.eye),new Ie("undergroundFadeAlpha",n=>n.undergroundFadeAlpha)),r.code.add(T`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(T`void main() {
fragColor = color;
}`);else{e.include($c,t),e.attributes.add(R.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const n=t.geometry===fy.Cylinder;r.uniforms.add(new _n("proj",(a,l)=>l.camera.projectionMatrix),new _n("view",(a,l)=>l.camera.viewMatrix)),n||(e.varyings.add("innerFactor","float"),r.uniforms.add(new zt("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new zt("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new zt("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new ci("texV",a=>a.texV)),r.uniforms.add(new Ie("innerScale",a=>a.innerScale)));const s=6.2831853,o=1/128;r.code.add(T`
		void main(void) {
      ${n?T`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:T`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${T.float(s*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${T.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new ft("tex",a=>a.texture)),n||i.uniforms.add(new Ie("altitudeFade",a=>a.altitudeFade)),i.code.add(T`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${n?T`fragColor = atmosphereColor;`:T`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const rmt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:wae,SimpleAtmospherePassParameters:Y7,build:YDe},Symbol.toStringTag,{value:"Module"}));let g9=class XDe extends Zr{initializeProgram(e){return new Br(e.rctx,XDe.shader.get().build(this.configuration),Nr)}initializePipeline(){return this.configuration.geometry===fy.Cylinder?Bt({blending:ya(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),culling:nae,depthTest:{func:si.LEQUAL},colorWrite:rr}):Bt({blending:ya(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:si.LEQUAL},colorWrite:rr})}};g9.shader=new Vr(rmt,()=>re(()=>Promise.resolve().then(()=>xjt),void 0));const imt=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Ju(t,e=0){const r=t.stride;return Array.from(t.fields.keys()).map(i=>{const n=t.fields.get(i),s=n.constructor.ElementCount,o=nmt(n.constructor.ElementType),a=n.offset,l=!(!n.optional||!n.optional.glNormalized);return new da(i,s,o,a,r,l,e)})}function nmt(t){const e=smt[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const smt={u8:et.UNSIGNED_BYTE,u16:et.UNSIGNED_SHORT,u32:et.UNSIGNED_INT,i8:et.BYTE,i16:et.SHORT,i32:et.INT,f32:et.FLOAT};function jge(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let Hge=class ZDe{constructor(e,r){this.layout=e,this.buffer=typeof r=="number"?new ArrayBuffer(r*e.stride):r;for(const i of e.fields.keys()){const n=e.fields.get(i);this[i]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,r){const i=this[e];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(e,r){return new ZDe(this.layout,this.buffer.slice(e*this.stride,r*this.stride))}copyFrom(e,r=0,i=0,n=e.count){const s=this.stride;if(s%4==0){const o=new Uint32Array(e.buffer,r*s,n*s/4);new Uint32Array(this.buffer,i*s,n*s/4).set(o)}else{const o=new Uint8Array(e.buffer,r*s,n*s);new Uint8Array(this.buffer,i*s,n*s).set(o)}return this}get usedMemory(){return this.byteLength}dispose(){}},JDe=class QDe{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(r=>this._fields.set(r[0],{...r[1],constructor:lmt(r[1].constructor)})))}vec2f(e,r){return this._appendField(e,S2,r),this}vec2f64(e,r){return this._appendField(e,Gse,r),this}vec3f(e,r){return this._appendField(e,mo,r),this}vec3f64(e,r){return this._appendField(e,dp,r),this}vec4f(e,r){return this._appendField(e,hm,r),this}vec4f64(e,r){return this._appendField(e,JB,r),this}mat3f(e,r){return this._appendField(e,Ib,r),this}mat3f64(e,r){return this._appendField(e,zse,r),this}mat4f(e,r){return this._appendField(e,Vse,r),this}mat4f64(e,r){return this._appendField(e,KL,r),this}vec4u8(e,r){return this._appendField(e,dl,r),this}f32(e,r){return this._appendField(e,ZB,r),this}f64(e,r){return this._appendField(e,Bse,r),this}u8(e,r){return this._appendField(e,eA,r),this}u16(e,r){return this._appendField(e,e7,r),this}i8(e,r){return this._appendField(e,qse,r),this}vec2i8(e,r){return this._appendField(e,i7,r),this}vec2i16(e,r){return this._appendField(e,yN,r),this}vec2u8(e,r){return this._appendField(e,QB,r),this}vec4u16(e,r){return this._appendField(e,gN,r),this}u32(e,r){return this._appendField(e,r7,r),this}_appendField(e,r,i){if(this._fields.has(e))return void _t(!1,`${e} already added to vertex buffer layout`);const n=r.ElementCount*jge(r.ElementType),s=this._stride;this._stride+=n,this._fields.set(e,{size:n,constructor:r,offset:s,optional:i})}createBuffer(e){return new Hge(this,e)}createView(e){return new Hge(this,e)}clone(){const e=new QDe;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((r,i)=>e._fields.set(i,r)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(r=>e=Math.max(e,jge(r.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function ln(){return new JDe}let omt=class{constructor(e){this.fields=new Array,e.fields.forEach((r,i)=>{const n={...r,constructor:KDe(r.constructor)};this.fields.push([i,n])}),this.stride=e.stride}};const amt=[ZB,S2,mo,hm,Ib,Vse,Bse,Gse,dp,JB,zse,KL,eA,QB,KB,dl,e7,jse,t7,gN,r7,Hse,vOe,bOe,qse,i7,wOe,xOe,SOe,yN,TOe,EOe,COe,POe,AOe,OOe];function KDe(t){return`${t.ElementType}_${t.ElementCount}`}function lmt(t){return eNe.get(t)}const eNe=new Map;amt.forEach(t=>eNe.set(KDe(t),t));function Tn(t,e=!1){return t<=Vu?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function sQt(t){return np(t)?t.length<Vu?t:new Float32Array(t):t.length<Vu?Array.from(t):t}function qge(t){return(np(t)?t.length:t.byteLength/8)<=Vu?Array.from(t):new Float32Array(t)}function y9(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}var fee;(function(t){function e(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function r(o,a){const l=o[a],c=o[a+1],u=o[a+2],h=1/Math.sqrt(l*l+c*c+u*u);o[a]*=h,o[a+1]*=h,o[a+2]*=h}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function n(o,a,l,c,u,h=a){(u=u||o)[h]=o[a]+l[c],u[h+1]=o[a+1]+l[c+1],u[h+2]=o[a+2]+l[c+2]}function s(o,a,l,c,u,h=a){(u=u||o)[h]=o[a]-l[c],u[h+1]=o[a+1]-l[c+1],u[h+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=r,t.scale=i,t.add=n,t.subtract=s})(fee||(fee={}));const rE=fee,DH=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],cmt=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],umt=[0,0,1,0,1,1,0,1],hmt=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],tNe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)tNe[6*t+e]=t;const qx=new Array(36);for(let t=0;t<6;t++)qx[6*t]=0,qx[6*t+1]=1,qx[6*t+2]=2,qx[6*t+3]=2,qx[6*t+4]=3,qx[6*t+5]=0;function dmt(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=DH[i][0]*e[0],r[3*i+1]=DH[i][1]*e[1],r[3*i+2]=DH[i][2]*e[2];return new Is(t,[[R.POSITION,new tt(r,hmt,3,!0)],[R.NORMAL,new tt(cmt,tNe,3)],[R.UV0,new tt(umt,qx,2)]])}const NH=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],pmt=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],fmt=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],mmt=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function gmt(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=NH[i][0]*e[0],r[3*i+1]=NH[i][1]*e[1],r[3*i+2]=NH[i][2]*e[2];return new Is(t,[[R.POSITION,new tt(r,fmt,3,!0)],[R.NORMAL,new tt(pmt,mmt,3)]])}const i8=wi(-.5,0,-.5),n8=wi(.5,0,-.5),s8=wi(0,0,.5),o8=wi(0,.5,0),iE=xu(),nE=xu(),iP=xu(),nP=xu(),sP=xu();_e(iE,i8,o8),_e(nE,i8,n8),it(iP,iE,nE),me(iP,iP),_e(iE,n8,o8),_e(nE,n8,s8),it(nP,iE,nE),me(nP,nP),_e(iE,s8,o8),_e(nE,s8,i8),it(sP,iE,nE),me(sP,sP);const FH=[i8,n8,s8,o8],ymt=[0,-1,0,iP[0],iP[1],iP[2],nP[0],nP[1],nP[2],sP[0],sP[1],sP[2]],_mt=[0,1,2,3,1,0,3,2,1,3,0,2],vmt=[0,0,0,1,1,1,2,2,2,3,3,3];function bmt(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=FH[i][0]*e[0],r[3*i+1]=FH[i][1]*e[1],r[3*i+2]=FH[i][2]*e[2];return new Is(t,[[R.POSITION,new tt(r,_mt,3,!0)],[R.NORMAL,new tt(ymt,vmt,3)]])}function oQt(t,e,r,i,n={uv:!0}){const s=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),u=Math.max(2,Math.floor(i)),h=(c+1)*(u+1),p=Tn(3*h),f=Tn(3*h),g=Tn(2*h),y=[];let v=0;for(let x=0;x<=u;x++){const S=[],E=x/u,P=a+E*l,M=Math.cos(P);for(let L=0;L<=c;L++){const U=L/c,z=s+U*o,W=Math.cos(z)*M,V=Math.sin(P),J=-Math.sin(z)*M;p[3*v]=W*e,p[3*v+1]=V*e,p[3*v+2]=J*e,f[3*v]=W,f[3*v+1]=V,f[3*v+2]=J,g[2*v]=U,g[2*v+1]=E,S.push(v),++v}y.push(S)}const b=new Array;for(let x=0;x<u;x++)for(let S=0;S<c;S++){const E=y[x][S],P=y[x][S+1],M=y[x+1][S+1],L=y[x+1][S];x===0?(b.push(E),b.push(M),b.push(L)):x===u-1?(b.push(E),b.push(P),b.push(M)):(b.push(E),b.push(P),b.push(M),b.push(M),b.push(L),b.push(E))}const w=[[R.POSITION,new tt(p,b,3,!0)],[R.NORMAL,new tt(f,b,3,!0)]];return n.uv&&w.push([R.UV0,new tt(g,b,2,!0)]),n.offset&&(w[0][0]=R.OFFSET,w.push([R.POSITION,new tt(Float64Array.from(n.offset),ow(b.length),3,!0)])),new Is(t,w)}function wmt(t,e,r,i){const n=rNe(e,r,i);return new Is(t,n)}function rNe(t,e,r){const i=t;let n,s;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const c=i*(1+Math.sqrt(5))/2;n=[-i,c,0,i,c,0,-i,-c,0,i,-c,0,0,-i,c,0,i,c,0,-i,-c,0,i,-c,c,0,-i,c,0,i,-c,0,-i,-c,0,i],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<n.length;c+=3)rE.scale(n,c,t/rE.length(n,c));let o={};function a(c,u){c>u&&([c,u]=[u,c]);const h=c.toString()+"."+u.toString();if(o[h])return o[h];let p=n.length;return n.length+=3,rE.add(n,3*c,n,3*u,n,p),rE.scale(n,p,t/rE.length(n,p)),p/=3,o[h]=p,p}for(let c=0;c<e;c++){const u=s.length,h=new Array(4*u);for(let p=0;p<u;p+=3){const f=s[p],g=s[p+1],y=s[p+2],v=a(f,g),b=a(g,y),w=a(y,f),x=4*p;h[x]=f,h[x+1]=v,h[x+2]=w,h[x+3]=g,h[x+4]=b,h[x+5]=v,h[x+6]=y,h[x+7]=w,h[x+8]=b,h[x+9]=v,h[x+10]=b,h[x+11]=w}s=h,o={}}const l=qge(n);for(let c=0;c<l.length;c+=3)rE.normalize(l,c);return[[R.POSITION,new tt(qge(n),s,3,!0)],[R.NORMAL,new tt(l,s,3,!0)]]}function mee(t,e,r,i,n,s,o,a,l=null){const c=r?nn(r):C(),u=e?nn(e):Ce(0,0,1);o??(o=Ye());const h=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],p=n!=null&&n.length===2?n:[1,1],f=ow(1),g=[[R.POSITION,new tt(c,f,3,!0)],[R.NORMAL,new tt(u,f,3,!0)],[R.UV0,new tt(o,f,o.length)],[R.COLOR,new tt(h,f,4,!0)],[R.SIZE,new tt(p,f,2)]];if(s!=null&&(s=[s[0],s[1],s[2],s[3]],g.push([R.CENTEROFFSETANDDISTANCE,new tt(s,f,4)])),a){const y=[a[0],a[1],a[2],a[3]];g.push([R.FEATUREATTRIBUTE,new tt(y,f,4)])}return new Is(t,g,null,Ln.Point,l)}const xmt=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function aQt(t,e=xmt){const r=new Array(12);for(let c=0;c<4;c++)for(let u=0;u<3;u++)r[3*c+u]=e[c][u];const i=[0,1,2,2,3,0],n=[0,0,1],s=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[R.POSITION,new tt(r,i,3,!0)],[R.NORMAL,new tt(n,s,3,!0)],[R.UV0,new tt(o,i,2,!0)],[R.COLOR,new tt(a,s,4,!0)]];return new Is(t,l)}function Wge(t,e,r,i,n,s=!0,o=!0){let a=0;const l=r,c=e;let u=wi(0,a,0),h=wi(0,a+c,0),p=wi(0,-1,0),f=wi(0,1,0);n&&(a=c,h=wi(0,0,0),u=wi(0,a,0),p=wi(0,1,0),f=wi(0,-1,0));const g=[h,u],y=[p,f],v=i+2,b=Math.sqrt(c*c+l*l);if(n)for(let M=i-1;M>=0;M--){const L=M*(2*Math.PI/i),U=wi(Math.cos(L)*l,a,Math.sin(L)*l);g.push(U);const z=wi(c*Math.cos(L)/b,-l/b,c*Math.sin(L)/b);y.push(z)}else for(let M=0;M<i;M++){const L=M*(2*Math.PI/i),U=wi(Math.cos(L)*l,a,Math.sin(L)*l);g.push(U);const z=wi(c*Math.cos(L)/b,l/b,c*Math.sin(L)/b);y.push(z)}const w=new Array,x=new Array;if(s){for(let M=3;M<g.length;M++)w.push(1),w.push(M-1),w.push(M),x.push(0),x.push(0),x.push(0);w.push(g.length-1),w.push(2),w.push(1),x.push(0),x.push(0),x.push(0)}if(o){for(let M=3;M<g.length;M++)w.push(M),w.push(M-1),w.push(0),x.push(M),x.push(M-1),x.push(1);w.push(0),w.push(2),w.push(g.length-1),x.push(1),x.push(2),x.push(y.length-1)}const S=Tn(3*v);for(let M=0;M<v;M++)S[3*M]=g[M][0],S[3*M+1]=g[M][1],S[3*M+2]=g[M][2];const E=Tn(3*v);for(let M=0;M<v;M++)E[3*M]=y[M][0],E[3*M+1]=y[M][1],E[3*M+2]=y[M][2];const P=[[R.POSITION,new tt(S,w,3,!0)],[R.NORMAL,new tt(E,x,3,!0)]];return new Is(t,P)}function Smt(t,e,r,i,n,s,o){const a=n?aee(n):wi(1,0,0),l=s?aee(s):wi(0,0,0);o??(o=!0);const c=xu();me(c,a);const u=xu();oe(u,c,Math.abs(e));const h=xu();oe(h,u,-.5),ge(h,h,l);const p=wi(0,1,0);Math.abs(1-fe(c,p))<.2&&se(p,0,0,1);const f=xu();it(f,c,p),me(f,f),it(p,f,c);const g=2*i+(o?2:0),y=i+(o?2:0),v=Tn(3*g),b=Tn(3*y),w=Tn(2*g),x=new Array(3*i*(o?4:2)),S=new Array(3*i*(o?4:2));o&&(v[3*(g-2)]=h[0],v[3*(g-2)+1]=h[1],v[3*(g-2)+2]=h[2],w[2*(g-2)]=0,w[2*(g-2)+1]=0,v[3*(g-1)]=v[3*(g-2)]+u[0],v[3*(g-1)+1]=v[3*(g-2)+1]+u[1],v[3*(g-1)+2]=v[3*(g-2)+2]+u[2],w[2*(g-1)]=1,w[2*(g-1)+1]=1,b[3*(y-2)]=-c[0],b[3*(y-2)+1]=-c[1],b[3*(y-2)+2]=-c[2],b[3*(y-1)]=c[0],b[3*(y-1)+1]=c[1],b[3*(y-1)+2]=c[2]);const E=(z,W,V)=>{x[z]=W,S[z]=V};let P=0;const M=xu(),L=xu();for(let z=0;z<i;z++){const W=z*(2*Math.PI/i);oe(M,p,Math.sin(W)),oe(L,f,Math.cos(W)),ge(M,M,L),b[3*z]=M[0],b[3*z+1]=M[1],b[3*z+2]=M[2],oe(M,M,r),ge(M,M,h),v[3*z]=M[0],v[3*z+1]=M[1],v[3*z+2]=M[2],w[2*z]=z/i,w[2*z+1]=0,v[3*(z+i)]=v[3*z]+u[0],v[3*(z+i)+1]=v[3*z+1]+u[1],v[3*(z+i)+2]=v[3*z+2]+u[2],w[2*(z+i)]=z/i,w[2*z+1]=1;const V=(z+1)%i;E(P++,z,z),E(P++,z+i,z),E(P++,V,V),E(P++,V,V),E(P++,z+i,z),E(P++,V+i,V)}if(o){for(let z=0;z<i;z++){const W=(z+1)%i;E(P++,g-2,y-2),E(P++,z,y-2),E(P++,W,y-2)}for(let z=0;z<i;z++){const W=(z+1)%i;E(P++,z+i,y-1),E(P++,g-1,y-1),E(P++,W+i,y-1)}}const U=[[R.POSITION,new tt(v,x,3,!0)],[R.NORMAL,new tt(b,S,3,!0)],[R.UV0,new tt(w,x,2,!0)]];return new Is(t,U)}function lQt(t,e,r,i,n,s,o=wi(0,0,0)){const a=e.length,l=Tn(r.length*a*3+(6*i.length||0)),c=Tn(r.length*a*3+(i?6:0)),u=new Array,h=new Array;let p=0,f=0;const g=C(),y=C(),v=C(),b=C(),w=C(),x=C(),S=C(),E=C(),P=C(),M=C(),L=C(),U=C(),z=C(),W=Yr();se(P,0,1,0),_e(y,r[1],r[0]),me(y,y),s?(ge(E,r[0],o),me(v,E)):se(v,0,0,1),_9(y,v,P,P,w,v,Yge),he(b,v),he(U,w);for(let I=0;I<i.length;I++)oe(x,w,i[I][0]),oe(E,v,i[I][2]),ge(x,x,E),ge(x,x,r[0]),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2];c[f++]=-y[0],c[f++]=-y[1],c[f++]=-y[2];for(let I=0;I<n.length;I++)u.push(n[I][0]>0?n[I][0]:-n[I][0]-1+i.length),u.push(n[I][1]>0?n[I][1]:-n[I][1]-1+i.length),u.push(n[I][2]>0?n[I][2]:-n[I][2]-1+i.length),h.push(0),h.push(0),h.push(0);let V=i.length;const J=i.length-1;for(let I=0;I<r.length;I++){let k=!1;I>0&&(he(g,y),I<r.length-1?(_e(y,r[I+1],r[I]),me(y,y)):k=!0,ge(M,g,y),me(M,M),ge(L,r[I-1],b),dN(r[I],M,W),v2(W,Wh(L,g),E)?(_e(E,E,r[I]),me(v,E),it(w,M,v),me(w,w)):_9(M,b,U,P,w,v,Yge),he(b,v),he(U,w)),s&&(ge(E,r[I],o),me(z,E));for(let j=0;j<a;j++)if(oe(x,w,e[j][0]),oe(E,v,e[j][1]),ge(x,x,E),me(S,x),c[f++]=S[0],c[f++]=S[1],c[f++]=S[2],ge(x,x,r[I]),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2],!k){const q=(j+1)%a;u.push(V+j),u.push(V+a+j),u.push(V+q),u.push(V+q),u.push(V+a+j),u.push(V+a+q);for(let Q=0;Q<6;Q++){const ie=u.length-6;h.push(u[ie+Q]-J)}}V+=a}const Y=r[r.length-1];for(let I=0;I<i.length;I++)oe(x,w,i[I][0]),oe(E,v,i[I][1]),ge(x,x,E),ge(x,x,Y),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2];const X=f/3;c[f++]=y[0],c[f++]=y[1],c[f++]=y[2];const le=V-a;for(let I=0;I<n.length;I++)u.push(n[I][0]>=0?V+n[I][0]:-n[I][0]-1+le),u.push(n[I][2]>=0?V+n[I][2]:-n[I][2]-1+le),u.push(n[I][1]>=0?V+n[I][1]:-n[I][1]-1+le),h.push(X),h.push(X),h.push(X);const D=[[R.POSITION,new tt(l,u,3,!0)],[R.NORMAL,new tt(c,h,3,!0)]];return new Is(t,D)}function cQt(t,e,r,i){_t(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),_t(e[0].length===3,"createPolylineGeometry(): malformed vertex"),_t(r==null||r.length===e.length,"createPolylineGeometry: need same number of points and normals"),_t(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const n=Go(3*e.length),s=new Array(2*(e.length-1));let o=0,a=0;for(let c=0;c<e.length;c++){for(let u=0;u<3;u++)n[o++]=e[c][u];c>0&&(s[a++]=c-1,s[a++]=c)}const l=[[R.POSITION,new tt(n,s,3,!0)]];if(r){const c=Tn(3*r.length);let u=0;for(let h=0;h<e.length;h++)for(let p=0;p<3;p++)c[u++]=r[h][p];l.push([R.NORMAL,new tt(c,s,3,!0)])}return i&&l.push([R.COLOR,new tt(i,_2(i.length/4),4)]),new Is(t,l,null,Ln.Line)}function Tmt(t,e=t){const r=t.attributes,i=r.get(R.POSITION).data,n=r.get(R.NORMAL).data;if(n){const s=e.getMutableAttribute(R.NORMAL).data;for(let o=0;o<n.length;o+=3){const a=n[o+1];s[o+1]=-n[o+2],s[o+2]=a}}if(i){const s=e.getMutableAttribute(R.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];s[o+1]=-i[o+2],s[o+2]=a}}}function kH(t,e,r,i,n){return!(Math.abs(fe(e,t))>n)&&(it(r,t,e),me(r,r),it(i,r,t),me(i,i),!0)}function _9(t,e,r,i,n,s,o){return kH(t,e,n,s,o)||kH(t,r,n,s,o)||kH(t,i,n,s,o)}const Yge=.99619469809;let Emt=class{constructor(e,r){this.type=Ya.Local,this._configuration=new bae,this._passParameters=new Y7,this._configuration.geometry=fy.Cylinder,this._technique=r.techniqueRepository.acquire(g9,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=q0(this._vao,"geometry");const n=new ui;n.wrapMode=nr.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Mr(i,n,imt)}destroy(){this._passParameters.texture=wt(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const r=e.rctx,i=r.bindTechnique(this._technique,e.bindParameters,this._passParameters);Cmt(Xge,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",Xge),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(dr.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const r=rNe(1,2,!1),{data:i,indices:n}=r[0][1],s=Zge.createBuffer(n.length),o=s.position;for(let a=0;a<n.length;++a){const l=3*n[a%3==0?a+2:a%3==2?a-2:a];o.set(a,0,i[l]),o.set(a,1,i[l+1]),o.set(a,2,i[l+2])}return new wm(e,Nr,{geometry:Ju(Zge)},{geometry:ti.createVertex(e,Lr.STATIC_DRAW,s.buffer)})}};function Cmt(t,e){cs(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const Xge=xe(),Zge=ln().vec3f(R.POSITION),Pmt=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),L5=128,Jge=-KK,Qge=0,UH=50,Amt=()=>1-511/512,Omt=m6([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let Mmt=class{constructor(e,r){this.view=e,this.type=Ya.Mars,this._passParameters=new Y7,this._vaoCount=0,this._texV1=1;const i=zr(e.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+Jge)/this._planetRadius,this._middleRimFactor=(this._planetRadius+Qge)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=Qge/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const n=r.renderContext.rctx;this._cameraChangeHandle=pe(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>r.requestRender(),li),this._vao=this._createRibbon(n),this._vaoCount=q0(this._vao,"geometry"),this._fadeVao=Sy(n),this._fadeVaoCount=q0(this._fadeVao,"geometry");const s=new ui;s.wrapMode=nr.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Mr(n,s,Pmt);const o=new bae;o.geometry=fy.Cone,this._coneTechnique=this._techniqueRepository.acquire(g9,o),o.geometry=fy.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(g9,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=wt(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const r=e.bindParameters.camera;this._update(r);const i=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,e.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(dr.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,e.bindParameters,this._passParameters),i.bindVAO(this._fadeVao),i.drawArrays(dr.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const r=C(),i=this._planetRadius,n=Te(e.eye),s=n-i;if(s<0){const f=Math.min(-s/5e3,1);this._passParameters.undergroundFadeAlpha=f}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(UH,s),a=i+Jge;this._passParameters.innerScale=Rmt(i+o,i,a)-1,this._passParameters.altitudeFade=iae(s),oe(r,e.eye,(i+UH)/n),Kge(r,e.center,e.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,r,e.up,this._passParameters.silhouette),c=Amt(),u=Omt(s);let h=this._texV0+c*this._texVScale,p=this._texV0+l*u*this._texVScale;if(s>UH){Kge(e.eye,e.center,e.up,i,this._passParameters.silhouette);const f=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),g=we((f-1.5)/(l-1.5),0,1);h=this._texV0+g*c*this._texVScale,p=this._texV0+Dt(this._texV1,l*u,g)*this._texVScale}yr(this._passParameters.texV,h,p)}_createRibbon(e){const r=Tn(3+3*L5*3),i=new Uint32Array(3*L5*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<L5;o++){const a=9*o+3;r[a]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===L5-1?1:l+3,u=15*o;i[u]=l,i[u+1]=l+1,i[u+2]=c+1,i[u+3]=c+1,i[u+4]=c,i[u+5]=l,i[u+6]=l+1,i[u+7]=l+2,i[u+8]=c+2,i[u+9]=c+2,i[u+10]=c+1,i[u+11]=l+1,i[u+12]=l,i[u+13]=c,i[u+14]=0}const n=eye.createBuffer(i.length),s=n.position;for(let o=0;o<i.length;++o){const a=3*i[o];s.set(o,0,r[a]),s.set(o,1,r[a+1]),s.set(o,2,r[a+2])}return new wm(e,Nr,{geometry:Ju(eye)},{geometry:ti.createVertex(e,Lr.STATIC_DRAW,n.buffer)})}_computeScreenRimWidth(e,r,i,n){return ge(sE,n.center,n.v2),oe(D5,sE,this._outerRimFactor),TB(zH,r,sE,i),Ape(sE,zH,e.projectionMatrix,e.viewport,sE),Ape(D5,zH,e.projectionMatrix,e.viewport,D5),Bi(sE,D5)/e.height}};function Kge(t,e,r,i,n){const s=Te(t),o=i*Math.sqrt(s*s-i*i)/s,a=Math.sqrt(i*i-o*o),l=n.v1,c=n.v2;return oe(n.center,t,a/s),it(l,t,e),nl(l)<1&&it(l,t,r),oe(l,l,o/Te(l)),it(c,l,t),oe(c,c,o/Te(c)),o}const zH=xe(),sE=C(),D5=C();function Rmt(t,e,r){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-r*r)+e*r)}const eye=ln().vec3f(R.POSITION);var m_;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(m_||(m_={}));let gee=class extends jc{constructor(){super(...arguments),this.type=m_.Rain}};d([H({count:m_.COUNT})],gee.prototype,"type",void 0);function iNe(t){const e=new Fr;return e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new zt("cameraPosition",(r,i)=>i.camera.eye)),e.vertex.uniforms.add(new zt("offset",(r,i)=>$mt(r,i))),e.vertex.uniforms.add(new Ie("width",r=>r.width)),e.vertex.uniforms.add(new _n("proj",(r,i)=>i.camera.projectionMatrix)),e.vertex.uniforms.add(new _n("view",(r,i)=>i.camera.viewMatrix)),e.vertex.uniforms.add(new Ie("time",r=>r.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(T`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===m_.Rain?T`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:T`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new Ie("opacity",r=>r.opacity),new zt("particleColor",(r,i)=>Imt(i,t))),e.fragment.code.add(T`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===m_.Rain?T`d = 0.35 * smoothstep(0.5, 0.0, d);`:T`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function $mt(t,e){const r=e.camera.eye,i=.5*t.width,n=1/t.width,s=B3e(yee,se(yee,(r[0]+i)*n,(r[1]+i)*n,(r[2]+i)*n));return rn(s,r,oe(s,s,t.width))}function Imt(t,e){const r=e.type===m_.Rain?Dmt:Lmt,i=oe(yee,r,Nmt),n=t.camera.eye;me(tye,n);const s=Math.max(0,fe(tye,t.lighting.mainLight.direction));return pi(i,i,r,s)}const yee=C(),tye=C(),Lmt=Ce(1,1,1),Dmt=Ce(.85,.85,.85),Nmt=.7,Fmt=Object.freeze(Object.defineProperty({__proto__:null,build:iNe},Symbol.toStringTag,{value:"Module"}));let kmt=class extends Li{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},_ee=class nNe extends Zr{initializeProgram(e){return new Br(e.rctx,nNe.shader.get().build(this.configuration),a8)}initializePipeline(){return Bt({blending:ya(Ee.ONE,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:si.LEQUAL},colorWrite:rr})}};_ee.shader=new Vr(Fmt,()=>re(()=>Promise.resolve().then(()=>Sjt),void 0));const a8=new Map([[R.POSITION,0],[R.INSTANCEFEATUREATTRIBUTE,1]]);let sNe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:r}){return r!=null?this._time!==r&&(this._time=r,!0):(this._time=this._time+e,e!==0)}},Umt=class{constructor(e,r){this.deltaTime=e,this.fixedTime=r}},Wx=class extends Pe{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new kmt,this._animation=new sNe,this._updatingTracking=new em,this._passParameters.time=0,this._passParameters.radius=zr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=lr(this._snowTechniqueCached),this._rainTechniqueCached=lr(this._rainTechniqueCached),this._vao=wt(this._vao),this._instanceIdBuffer=wt(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new gee;e.type=m_.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(_ee,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new gee;e.type=m_.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(_ee,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,r,i){const n=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!n.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),n==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=e.bindParameters.cloudsFade.opacity),this._passParameters.opacity<=0))return;const o=.35;r=r<.5?Dt(0,o,2*r):Dt(o,1,2*(r-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*mne(this._animation.time)%1e5;const a=s.bindTechnique(n,e.bindParameters,this._passParameters);s.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),oae(s,a8,this._instanceIdBuffer,rye,0),s.drawArraysInstanced(dr.TRIANGLES,0,3,this._numParticles*r),rDe(s,a8,this._instanceIdBuffer,rye)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const r=[];for(let i=0;i<this._numParticles;i++)r.push(i);return ti.createVertex(e,Lr.STATIC_DRAW,new Float32Array(r))}_createVertexArrayObject(e){const r=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new wm(e,a8,{geometry:Ju(zmt)},{geometry:ti.createVertex(e,Lr.STATIC_DRAW,r)})}};d([m({constructOnly:!0})],Wx.prototype,"context",void 0),d([m({constructOnly:!0})],Wx.prototype,"view",void 0),d([m({readOnly:!0})],Wx.prototype,"updating",null),d([m()],Wx.prototype,"_updatingTracking",void 0),Wx=d([F("esri.views.3d.environment.Precipitation")],Wx);const zmt=ln().vec3f(R.POSITION),rye=Ju(ln().f32(R.INSTANCEFEATUREATTRIBUTE),1);function oNe(){const t=new Fr;return t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.COLOR,"vec4"),t.attributes.add(R.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new _n("transform",(e,r)=>Vmt(e,r)),new Or("viewport",(e,r)=>r.camera.fullViewport),new Ie("pixelRatio",(e,r)=>r.camera.pixelRatio)),t.vertex.code.add(T`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(T`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function Vmt(t,e){return cs(s1,e.camera.projectionMatrix),s1[10]=24e-8-1,s1[11]=-1,s1[14]=(24e-8-2)*e.camera.near,Kr(s1,s1,e.camera.viewMatrix),Kr(s1,s1,t.modelMatrix)}const s1=xe(),Bmt=Object.freeze(Object.defineProperty({__proto__:null,build:oNe},Symbol.toStringTag,{value:"Module"}));let Gmt=class extends Li{constructor(){super(...arguments),this.modelMatrix=xe()}},aNe=class lNe extends Zr{constructor(e){super(e,new jc,()=>this.destroy())}initializeProgram(e){return new Br(e.rctx,lNe.shader.get().build(),Nr)}initializePipeline(){return Bt({blending:ya(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:si.LEQUAL},colorWrite:rr})}};aNe.shader=new Vr(Bmt,()=>re(()=>Promise.resolve().then(()=>Tjt),void 0));let Y1=class extends Pe{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._passParameters=new Gmt,this._updatingTracking=new em}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Ql(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=lr(this._technique),this._vao=wt(this._vao),Nw=null}render(e){const{rctx:r}=e;if(this._ensureResources(r),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const i=r.bindTechnique(this._technique,e.bindParameters,this._passParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(dr.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||Nw==null)return;this._technique=new aNe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Nw.byteLength/iye;const r=new Float32Array(Nw,0,2*this._numPoints),i=new Uint8Array(Nw,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,r,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,n=>this._update(n),mi)}_computeDayDuration(e){const r=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+r-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const r=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),n=cs(this._passParameters.modelMatrix,qmt);UP(n,n,-i*Math.PI),Kr(n,Hmt,n),UP(n,n,-r*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,r,i,n){const s=nye.createBuffer(n),o=s.position,a=s.color,l=s.size;for(let c=0;c<n;c++){const u=r[2*c],h=r[2*c+1];o.set(c,0,-Math.cos(u)*Math.sin(h)),o.set(c,1,-Math.sin(u)*Math.sin(h)),o.set(c,2,-Math.cos(h));const p=this._unpackUint8Attributes(i[c]),f=this._hexToRGB(jmt[p[1]]);a.set(c,0,255*f[0]),a.set(c,1,255*f[1]),a.set(c,2,255*f[2]),a.set(c,3,255),l.set(c,p[0])}return new wm(e,Nr,{geometry:Ju(nye)},{geometry:ti.createVertex(e,Lr.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(Nw!=null)return null;const e=b_(async r=>{const{data:i}=await $Ye("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:r});this._verifyStarData(i),Nw=i});return e.promise.catch(r=>{on(r)||K.getLogger(this).error(r)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new B("stars:no-data-received","Failed to create stars because star catalogue is missing");const r=e.byteLength/iye;if(r%1!=0||r>5e4||r<5e3)throw new B("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};d([m({constructOnly:!0})],Y1.prototype,"view",void 0),d([m({constructOnly:!0})],Y1.prototype,"requestRender",void 0),d([m({readOnly:!0})],Y1.prototype,"updating",null),d([m()],Y1.prototype,"_loadDataTask",void 0),d([m()],Y1.prototype,"_updatingTracking",void 0),Y1=d([F("esri.views.3d.environment.Stars")],Y1);const jmt=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],Hmt=pse(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),qmt=pse(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),iye=9,nye=ln().vec3f(R.POSITION).vec4u8(R.COLOR).f32(R.SIZE);let Nw=null;const X7={required:[]},cNe={required:[G.LinearDepth]},uNe={required:[G.CompositeColor]},hNe={required:[G.Highlight]},Wmt={required:[G.Depth,G.Normal]};let Z7=class extends Pe{consumes(){return X7}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(e){return!1}},R2=class extends Z7{},dNe=class extends Z7{constructor(){super(...arguments),this.drapedPriority=0}},Ymt=class extends Z7{},Xmt=class extends Z7{};function vee(t){return"prepareTechnique"in t}function sye(t){return"prepareTechniques"in t}var oP;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(oP||(oP={}));var XR;let xa=XR=class extends R2{constructor(t){super(t),this.produces=new Map([[de.ENVIRONMENT_OPAQUE,()=>!(this._atmosphere===null&&this._stars===null)],[de.ENVIRONMENT_TRANSPARENT,()=>this._atmosphere!==null]]),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new VH,this._newWeatherParameters=new VH,this._fadedWeatherParameters=new VH,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){var t;this.removeHandles(),this.uninitializeRenderContext(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:Ya.None}consumes(){return this._atmosphereType===Ya.Realistic?cNe:X7}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Te(this.view.state.camera.eye)-zr(this.view.spatialReference).radius<=E0}get usedMemory(){var t;return((t=this._clouds)==null?void 0:t.usedMemory)??0}get _stars(){var i;const t=this.view,e=((i=t.environment)==null?void 0:i.starsEnabled)??!1,r=this._get("_stars");return e&&this._context!=null?r??new Y1({view:t,requestRender:()=>this._setNeedsRender()}):(Me(r),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Me(t),null;const e=this.view,r=this._context;return t!=null&&t.context===r?t:(Me(t),new Wx({context:r,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Me(t),null;if(t!=null)return t;const e=this.view,r=this._context;return Me(t),new _c({context:r,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Me(t),null;const e=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=zr(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===i?t:(Me(t),new jx({rctx:r,viewingMode:e,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Me(t),null;if(t!=null)return t;const e=this.view,r=this._context,i=this._context.renderContext.rctx,n=this.view.state.viewingMode;return new Hx({context:r,view:e,rctx:i,viewingMode:n})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([pe(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),li),pe(()=>this._stars,e),pe(()=>this._precipitation,e),pe(()=>this._clouds,()=>this._updateWeather(),mi),pe(()=>this._fog,()=>this._updateFogHaze(),mi),pe(()=>this.view.state.mode,()=>{this._setNeedsRender()},ei),pe(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},li)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Me(this._atmosphere),this._set("_stars",Me(this._stars)),this._set("_precipitation",Me(this._precipitation)),this._set("_clouds",Me(this._clouds)),this._set("_cloudsComposition",Me(this._cloudsComposition)),this._set("_fog",Me(this._fog))}prepareRender(t){var e;t.bindParameters.cloudsFade.data=Bpt(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&((e=t.bindParameters.cloudsFade.data)==null?void 0:e.cubeMap)!=null&&(this._updateWeatherFading(t.bindParameters,t.time),t.bindParameters.cloudsFade.renderingStage===Ug.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}renderNode(t){var e,r,i,n,s,o,a;switch(t.bindParameters.slot){case de.ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,(i=(r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer)==null?void 0:i.fullResolutionAtmosphere),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),t.bindParameters.cloudsFade.isFading&&this._context!=null&&((n=t.bindParameters.cloudsFade.data)==null?void 0:n.cubeMap)!=null&&this._context.requestRender());break;case de.ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,(a=(o=(s=this.view)==null?void 0:s._stage)==null?void 0:o.renderer)==null?void 0:a.fullResolutionAtmosphere),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation)){const l=this.view.environment.weather;l.type!=="rainy"&&l.type!=="snowy"||this._precipitation.render(t,l.precipitation,l.type)}}}updateLightSources(t,e,r,i){if(this._context!=null){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=e,n.bindParameters.newLighting.globalFactor=r,n.bindParameters.newLighting.set(t),i===oP.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t,e){t.cloudsFade.updateFading(t.camera,this.view.state.mode,e,this.view.qualitySettings.fadeDuration),t.cloudsFade.updateParallax(t.camera),t.weatherFading&&(this._updateLighting(t),this._updateFogAtmoshpere(t))}_updateLighting(t){t.cloudsFade.fadeMode!==ki.CROSS_FADE&&t.cloudsFade.fadeMode!==ki.FADE_IN?t.fadeLighting(0):t.fadeLighting(t.cloudsFade.fadeFactor)}_updateFogAtmoshpere(t){t.cloudsFade.fadeMode!==ki.CROSS_FADE&&t.cloudsFade.fadeMode!==ki.FADE_IN?this._fadeWeather(0):this._fadeWeather(t.cloudsFade.fadeFactor)}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:r}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(r,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(qa[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=Dt(3e-5,.005,t.weatherAdjustment**3),he(this._newWeatherParameters.fog.color,oye),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Dt(4e-6,2e-4,(t.effect??0)**3),he(this._newWeatherParameters.fog.color,Zmt),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Dt(4e-6,2e-4,(t.effect??0)**3),he(this._newWeatherParameters.fog.color,oye),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==Ya.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=Me(this._atmosphere);const r=this._getAtmosphereClass(e);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=Me(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case Ya.Realistic:return Tge;case Ya.Local:return Emt;case Ya.Mars:return Mmt;default:case Ya.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:r}=t;return!e||sw(this.view.spatialReference)?Ya.None:r===Fe.Local?Ya.Local:this._context!=null&&Tge.isSupported(this._context)&&kL(this.view.spatialReference)?Ya.Realistic:nw(this.view.spatialReference)?Ya.Mars:Ya.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{aye=XR.prototype._getAtmosphereClass,XR.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{XR.prototype._getAtmosphereClass=aye}}}};d([m({constructOnly:!0})],xa.prototype,"view",void 0),d([m({readOnly:!0})],xa.prototype,"atmosphere",null),d([m({readOnly:!0})],xa.prototype,"_atmosphereType",null),d([m({type:Boolean,readOnly:!0})],xa.prototype,"updating",null),d([m({readOnly:!0})],xa.prototype,"weatherVisible",null),d([m()],xa.prototype,"_context",void 0),d([m()],xa.prototype,"_atmosphere",void 0),d([m({readOnly:!0})],xa.prototype,"_stars",null),d([m({readOnly:!0})],xa.prototype,"_precipitation",null),d([m({readOnly:!0})],xa.prototype,"_clouds",null),d([m({readOnly:!0})],xa.prototype,"_cloudsComposition",null),d([m({readOnly:!0})],xa.prototype,"_fog",null),d([m({readOnly:!0})],xa.prototype,"weatherEnabled",null),d([m({readOnly:!0})],xa.prototype,"_precipitationEnabled",null),d([m({readOnly:!0})],xa.prototype,"_weatherUpdateParameters",null),xa=XR=d([F("esri.views.3d.environment.EnvironmentRenderer")],xa);let VH=class{constructor(){this.fog=new Kft,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,he(this.fog.color,e.fog.color)}lerp(e,r,i){this.fog.amount=Dt(e.fog.amount,r.fog.amount,i),this.hazeAmount=Dt(e.hazeAmount,r.hazeAmount,i),this.fog.strength=Dt(e.fog.strength,r.fog.strength,i),pi(this.fog.color,e.fog.color,r.fog.color,i)}};const Zmt=Ce(.5,.5,.5),oye=Ce(1.5,1.5,1.5);let aye;var lye,cye,uye,pNe={exports:{}};lye=pNe,cye=function(){var t=Math.PI,e=Math.sin,r=Math.cos,i=Math.tan,n=Math.asin,s=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,u=2451545,h={dec:0,ra:0};function p(D){return D.valueOf()/l-.5+c}function f(D){return new Date((D+.5-c)*l)}function g(D){return p(D)-u}var y=23.4397*a;function v(D,I){return s(e(D)*r(y)-i(I)*e(y),r(D))}function b(D,I){return n(e(I)*r(y)+r(I)*e(y)*e(D))}function w(D,I,k){return s(e(D),r(D)*e(I)-i(k)*r(I))}function x(D,I,k){return n(e(I)*e(k)+r(I)*r(k)*r(D))}function S(D,I){return a*(280.16+360.9856235*D)-I}function E(D){return a*(357.5291+.98560028*D)}function P(D){return a*(1.9148*e(D)+.02*e(2*D)+3e-4*e(3*D))}function M(D,I){return D+I+102.9372*a+t}function L(D,I){var k=E(D),j=M(k,P(k));return I||(I={dec:0,ra:0}),I.dec=b(j,0),I.ra=v(j,0),I}var U={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(D,I,k,j){var q=a*-k,Q=a*I,ie=g(D),ye=L(ie,h),Ae=S(ie,q)-ye.ra;return j||(j={azimuth:0,altitude:0}),j.azimuth=w(Ae,Q,ye.dec),j.altitude=x(Ae,Q,ye.dec),j}},z=[[-.83,"sunrise","sunset"]];U.addTime=function(D,I,k){z.push([D,I,k])};var W=9e-4;function V(D,I){return Math.round(D-W-I/(2*t))}function J(D,I,k){return W+(D+I)/(2*t)+k}function Y(D,I,k){return u+D+.0053*e(I)-.0069*e(2*k)}function X(D,I,k){return o((e(D)-e(I)*e(k))/(r(I)*r(k)))}function le(D){var I=a*(134.963+13.064993*D),k=a*(93.272+13.22935*D),j=a*(218.316+13.176396*D)+6.289*a*e(I),q=5.128*a*e(k),Q=385001-20905*r(I);return{ra:v(j,q),dec:b(j,q),dist:Q}}return U.getTimes=function(D,I,k){var j=a*-k,q=a*I,Q=V(g(D),j),ie=J(0,j,Q),ye=E(ie),Ae=P(ye),Ze=M(ye,Ae),Et=b(Ze,0),xt=Y(ie,ye,Ze);function Qe(Re){return Y(J(X(Re,q,Et),j,Q),ye,Ze)}function Ke(Re){var qe=(e(Re)-e(q)*e(Et))/(r(q)*r(Et));return qe<-1?U.PolarException.MIDNIGHT_SUN:qe>1?U.PolarException.POLAR_NIGHT:U.PolarException.NORMAL}var Ge,Jt,Rr,Gi,Be,wr={solarNoon:f(xt),nadir:f(xt-.5),polarException:U.PolarException.NORMAL};for(Ge=0,Jt=z.length;Ge<Jt;Ge+=1)Be=xt-((Gi=Qe((Rr=z[Ge])[0]*a))-xt),wr[Rr[1]]=f(Be),wr[Rr[2]]=f(Gi);return wr.polarException=Ke(z[0][0]*a),wr},U.getMoonPosition=function(D,I,k){var j=a*-k,q=a*I,Q=g(D),ie=le(Q),ye=S(Q,j)-ie.ra,Ae=x(ye,q,ie.dec);return Ae+=.017*a/i(Ae+10.26*a/(Ae+5.1*a)),{azimuth:w(ye,q,ie.dec),altitude:Ae,distance:ie.dist}},U.getMoonFraction=function(D){var I=g(D),k=L(I),j=le(I),q=149598e3,Q=o(e(k.dec)*e(j.dec)+r(k.dec)*r(j.dec)*r(k.ra-j.ra)),ie=s(q*e(Q),j.dist-q*r(Q));return(1+r(ie))/2},U},(uye=cye())!==void 0&&(lye.exports=uye);const i2=hN(pNe.exports),jl={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let N5=class{constructor(e,r){this.direct=e,this.ambient=r}};function Jmt(t,e,r,i,n,s){se(s.ambient.color,1,1,1),s.ambient.intensity=jl.global.ambient,se(s.direct.color,1,1,1),s.direct.intensity=jl.global.direct;const o=e[2],a=we((Math.abs(o)-jl.local.altitude)/(jl.global.altitude-jl.local.altitude),0,1);let l;if(s.globalFactor=a,t!=null&&(l=i2.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=ngt(t,l,i);else{const u=gNe(i);c={direct:{intensity:jl.local.directAtNoon*u.direct,color:Ce(1,1,1)},ambient:{intensity:jl.local.ambientAtNoon*u.ambient,color:Ce(1,1,1)},timeOfDay:"early afternoon"}}pi(s.ambient.color,c.ambient.color,s.ambient.color,a),s.ambient.intensity=Dt(c.ambient.intensity,s.ambient.intensity,a),pi(s.direct.color,c.direct.color,s.direct.color,a),s.direct.intensity=Dt(c.direct.intensity,s.direct.intensity,a),s.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,s.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}s.noonFactor=t!=null?igt(t,l):1,t!=null?Qmt(t,e,r,s.direct.directionToLightSource):fNe(n,r,s.direct.directionToLightSource)}function fNe(t,e,r){e===Fe.Global?me(HH,t.eye):se(HH,0,0,1),oe(qH,t.viewForward,-1);const i=Oz(qH,HH),n=Math.max(i-2*WH,0),s=.85*n/(n+1),o=Math.max(WH,i-WH-s);Gu(wye,-o,t.viewRight),ze(r,qH,wye),ge(r,r,oe(sgt,t.viewRight,ogt)),me(r,r)}function Qmt(t,e,r,i){const n=rgt,s=cp(tgt);if(r===Fe.Global)i2.getPosition(t,0,0,n),se(i,0,0,-1),kP(s,s,-n.azimuth),xB(s,s,-n.altitude),ze(i,i,s);else{const o=jl.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=we(c,0,1),c<1?(i2.getPosition(t,e[1],e[0],n),n.azimuth=(1-c)*n.azimuth+c*a.azimuth,n.altitude=(1-c)*n.altitude+c*a.altitude):(n.azimuth=a.azimuth,n.altitude=a.altitude),se(i,0,-1,0),UP(s,s,-n.azimuth),kP(s,s,-n.altitude),ze(i,i,s)}}function Kmt(t,e){if(e===Fe.Global)return!0;const r=jl.planarDirection;return Math.abs(t)<r.localAltitude}const egt=Ce(.5773502691896258,-.5773502691896258,.5773502691896258);let mNe=class{constructor(){this.ambient={color:Ce(1,1,1),intensity:.55},this.direct={color:Ce(1,1,1),intensity:.55,directionToLightSource:nn(egt)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const tgt=xe(),rgt={azimuth:0,altitude:0};function igt(t,e){const r=t.valueOf();let i,n;e.polarException===i2.PolarException.MIDNIGHT_SUN?(i=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=i+432e6):e.polarException===i2.PolarException.POLAR_NIGHT?(i=r-2,n=r-1):(i=e.sunrise.valueOf(),n=e.sunset.valueOf());const s=i+(n-i)/2;return 1-we(Math.abs(r-s)/432e5,0,1)}function gNe(t){switch(t){case"disabled":case"sunny":case"cloudy":return new N5(1,1);case"rainy":return new N5(.4,1.2);case"snowy":return new N5(.5,1.3);case"foggy":return new N5(.2,1.6)}}function hye(t,e){const r=(t[0]+t[1]+t[2])/3;t[0]+=(r-t[0])*e,t[1]+=(r-t[1])*e,t[2]+=(r-t[2])*e}const BH=Ce(.01,.01,.01),bee=Ce(1,.6,.5),wee=Ce(1,.98,.98),dye=Ce(1,1,1),GH=Ce(.8,.8,1),xee=Ce(.8,.8,1),See=Ce(.98,.98,1),pye=Ce(1,1,1),jH=mr(.01,jl.local.ambientAtNight),Tee=mr(jl.local.directAtTwilight,jl.local.ambientAtTwilight),Eee=mr(.9*jl.local.directAtNoon,jl.local.ambientAtNoon),fye=mr(jl.local.directAtNoon,jl.local.ambientAtNoon),mye=Eee,gye=wee,yye=See,_ye=Tee,vye=bee,bye=xee;function ngt(t,e,r){const i=t.valueOf();let n,s;e.polarException===i2.PolarException.MIDNIGHT_SUN?(n=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=n+432e6):e.polarException===i2.PolarException.POLAR_NIGHT?(n=i-2,s=i-1):(n=e.sunrise.valueOf(),s=e.sunset.valueOf());const o=s-n,a=n+o/2,l=o/4,c=a-l,u=a+l,h=.06*o,p=n-h/2,f=n+h/2,g=s-h/2,y=s+h/2,v=Ye(),b=C(),w=C();let x="";if(i<p||i>y)vo(v,jH),he(b,BH),he(w,GH),x="night";else if(i<f){const P=(i-p)/(f-p);Dd(v,jH,Tee,P),pi(b,BH,bee,P),pi(w,GH,xee,P),x="sun rising"}else if(i<c){const P=(i-f)/(c-f);Dd(v,Tee,Eee,P),pi(b,bee,wee,P),pi(w,xee,See,P),x="early morning"}else if(i<a){const P=(i-c)/(a-c);Dd(v,Eee,fye,P),pi(b,wee,dye,P),pi(w,See,pye,P),x="late morning"}else if(i<u){const P=(i-a)/(u-a);Dd(v,fye,mye,P),pi(b,dye,gye,P),pi(w,pye,yye,P),x="early afternoon"}else if(i<g){const P=(i-u)/(g-u);Dd(v,mye,_ye,P),pi(b,gye,vye,P),pi(w,yye,bye,P),x="late afternoon"}else if(i<y){const P=(i-g)/(y-g);Dd(v,_ye,jH,P),pi(b,vye,BH,P),pi(w,bye,GH,P),x="sun setting"}let S=0;switch(r){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(hye(b,S),hye(w,S));const E=gNe(r);return{direct:{intensity:v[0]*E.direct,color:b},ambient:{intensity:v[1]*E.ambient,color:w},timeOfDay:x}}const wye=xe(),HH=C(),qH=C(),sgt=C(),WH=.25,ogt=.2;let ef=class extends Xn.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandlesKey="viewHandles",this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new p9,this._ambientLight=new yae,this._moonLight=new LDe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,r,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(r=this._view)==null?void 0:r.state)==null?void 0:i.viewingMode)===Fe.Global&&kL(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new xa({view:e});const r=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this.addHandles([pe(()=>e.environment.lighting,n=>this._updateLightingHandler(n),ei),pe(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,n=>this._lightingDateHandler(n),ei),pe(()=>e.stationary,()=>this._interactingStationaryHandler()),pe(()=>e.environment.lighting.directShadowsEnabled,r,ei),pe(()=>e.qualitySettings.ambientOcclusion,r,ei),pe(()=>e.qualitySettings.reflections,r,ei),pe(()=>e.spatialReference,()=>this._resetReferencePosition(!0),ei),pe(()=>e.environment.weather.type,()=>this._updateLighting(null,oP.Faded),ei),pe(()=>this.weatherEnabled,()=>this._updateLighting(null,oP.Faded),ei),pe(()=>e.viewingMode,()=>this._resetReferencePosition(!0),li),pe(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,n=>this._updateCameraTracking(n),li),pe(()=>e.state.camera,i,li),pe(()=>this.disableQueries,i)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=Me(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const r=this._view.environment.lighting;(r==null?void 0:r.type)!=="virtual"&&(r.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const r=this._view.environment.lighting;if((r==null?void 0:r.type)!=="virtual"){if(e){if(!r.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!Rb(i)){const n=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(n))return void this._requestReferencePositionUpdate(n)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const n=Tme(this._referencePosWGS84Comparable,xye);n!=null&&(r.autoUpdate(null,n),this._trackingEnabled&&(r.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const r=this._view;if(!r.ready)return;const i=r.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,r){const i=kL(this._view.spatialReference);if(i&&!Rb(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const n=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=C()),i?$dt(n,this._referencePosWGS84Comparable):se(this._referencePosWGS84Comparable,n.longitude??0,n.latitude??0,n.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,r)||this._updateLighting(r),!0}_cameraHandlerServerSide(e){const r=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(r))&&this._requestReferencePositionUpdate(r,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(r.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,r=oP.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const n=this._referencePosWGS84Comparable,s=n?agt:lgt,o=this.weatherVisible?i.environment.weather.type:"disabled";n!=null?Jmt(e,n,i.state.viewingMode,o,i.state.camera,s):i.environment.lighting.type==="virtual"&&fNe(i.state.camera,i.state.viewingMode,s.direct.directionToLightSource);const a=this._mainLight,l=s.direct;oe(a.intensity,l.color,l.intensity*Math.PI),he(a.direction,l.directionToLightSource),a.specularStrength=s.specularStrength,a.environmentStrength=s.environmentStrength;const c=this._ambientLight;oe(c.intensity,s.ambient.color,s.ambient.intensity);const u=this._moonLight;pi(u.intensity,ugt,hgt,s.globalFactor);const h=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));oe(u.intensity,u.intensity,h),he(u.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,u],s.noonFactor,s.globalFactor,r),this._updateRenderParameters()}_autoUpdateTimezone(e,r=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const i=cgt;i.setTime((r||this._view.environment.lighting.date).getTime());const n=Tme(e,xye);if(n==null)return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===n.hours&&s.minutes===n.minutes&&s.seconds===n.seconds)return!1}else s=n;const o=i.getUTCHours()-(n.hours-s.hours),a=i.getUTCMinutes()-(n.minutes-s.minutes),l=i.getUTCSeconds()-(n.seconds-s.seconds);return i.setUTCHours(o),i.setUTCMinutes(a),i.setUTCSeconds(l),!r&&this._view.environment.lighting.autoUpdate(i,n)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=this._referencePosWGS84Comparable==null||Kmt(this._referencePosWGS84Comparable[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,r=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!r,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=LL(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const s=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),n=this._referencePosUpdateTimer=LL(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===n&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const r=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(r[0])&&!isNaN(r[1])){const i=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=r[0],this._referencePosWGS84Comparable[1]=r[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[r[0],r[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let r=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(r*=this._view.mapCoordsHelper.unitInMeters),r>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(r){e._referencePointUpdateInterval=r},set referencePointUpdateDistThreshold(r){e._referencePointUpdateDistThreshold=r},set referencePosUpdateTimer(r){e._referencePosUpdateTimer=r},set referencePointUpdateDelay(r){e._referencePointUpdateDelay=r},set disableWeather(r){e._disableWeather=r}}}};d([m({type:Boolean,readOnly:!0})],ef.prototype,"updating",null),d([m()],ef.prototype,"disableQueries",void 0),d([m()],ef.prototype,"_disableWeather",void 0),d([m()],ef.prototype,"weatherEnabled",null),d([m()],ef.prototype,"weatherVisible",null),d([m()],ef.prototype,"referencePositionWGS84Comparable",null),d([m()],ef.prototype,"_renderer",void 0),d([m()],ef.prototype,"_referencePosWGS84Comparable",void 0),ef=d([F("esri.views.3d.environment.SceneViewEnvironmentManager")],ef);const agt=new mNe,lgt=new mNe,cgt=new Date,xye={hours:0,minutes:0,seconds:0},ugt=Ce(.22,.22,.33),hgt=Ce(.22,.22,.22);var Xi;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Xi||(Xi={}));var cr;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(cr||(cr={}));var my;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(my||(my={}));let wp=class{constructor(e=Xi.ALL,r=cr.NONE,i=0,n=null,s=null,o=my.TUMBLE){this.selection=e,this.interactionType=r,this.interactionFactor=i,this.interactionStartCamera=n,this.interactionDirection=s,this.tiltMode=o}};function fD(t,e){return(t&e)!=0}function v9(t,e,r,i,n,s){t!==0&&(r?(s.min=Math.min(s.min,e),s.max=Math.max(s.max,e)):i!=null?(s.min-=Math.max(0,(e-s.min)*(1-i)),s.max+=Math.max(0,(e-s.max)*(1-i))):n&&(s.min-=Math.max(0,e-s.min-n),s.max+=Math.max(0,e-s.max-n)))}const $2=new wp(Xi.NONE);function yNe(t,e,r,i){return e=e||t.viewForward,he(i,e),oe(i,i,Math.sign(fe(e,r))),i}function dgt(t,e,r,i){return ygt(t,e,r,mgt(i,e,r,!0))}function pgt(t,e,r,i){const n=fe(r,_e(t,i,e));return ge(t,e,oe(t,r,n))}const fgt={dir:C(),len:0,clip:Ye()};function mgt(t,e,r,i){const n=fgt;return t?(r&&i&&(n.len=Bi(e,r)),he(n.dir,t)):i?(n.len=Bi(e,r),_e(n.dir,r,e),oe(n.dir,n.dir,1/n.len)):(_e(n.dir,r,e),me(n.dir,n.dir)),n}function ggt(t,e,r){const i=fe(t,r.dir),n=-Ci(t,e);if(n<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return n>0;if((n<0||i<0)&&!(n<0&&i<0))return!0;const s=n/i;return i>0?s<r.clip[1]&&(r.clip[1]=s):s>r.clip[0]&&(r.clip[0]=s),r.clip[0]<=r.clip[1]}function ygt(t,e,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let n=0;n<t.length;n++)if(!ggt(t[n],e,i))return!1;return!0}function _gt(t,e,r=$2){const i=xae(t,e,r);if(i===0)return!1;const n=t.renderCoordsHelper,s=n.getAltitude(e.eye)+i,o=yNe(e,r.interactionDirection,wgt(t,e,Math.sign(i),Egt),Tgt),a=he(Cgt,e.viewForward),l=n.intersectInfiniteManifold(Wh(e.eye,o),s,YH);return e.eye=l??n.setAltitude(YH,s,e.eye),e.center=pgt(YH,e.eye,a,e.center),!0}function xae(t,e,r=$2){if(!vgt(t,r)||!t.state.constraints.altitude)return 0;const i=xgt(t.state.constraints.altitude,Sgt);bgt(t,r,i);const n=t.renderCoordsHelper.getAltitude(e.eye),s=we(n,i.min,i.max)-n;return Math.abs(s)<=1e-6?0:s}function vgt(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(e.interactionType!==cr.TUMBLE||!fD(e.selection,Xi.TILT))}function bgt(t,e,r){const i=e.interactionType;if(i===cr.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===cr.TUMBLE||i===cr.ZOOM,c=xae(t,o),u=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);r.min=n,r.max=s,v9(c,u,l,a,.05*u,r)}function wgt(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),oe(i,i,r),i}function xgt(t,e){return e.min=t.min,e.max=t.max,e}const Sgt={min:0,max:0},Tgt=C(),Egt=C(),Cgt=C(),YH=C();function Sae(t,e,r=$2){if(!t.state.isLocal)return 0;const i=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;F5.min=0,F5.max=i,Agt(t,r,F5);const n=Tae(t,e),s=F5.max-n;return s>=-1e-6?0:s}function Pgt(t,e,r=$2){const i=Sae(t,e,r);if(i===0)return!1;const n=t.pointsOfInterest.surfaceOrigin;if(!n.renderLocation)return!1;const s=Tae(t,e)+i,o=he(Mgt,e.eye),a=yNe(e,r.interactionDirection,Ogt(e,n.renderLocation,Igt),$gt);if(!cw(IRe(n.renderLocation,s),Wh(e.eye,a),k5))return!1;e.eye=k5;const l=_e(Rgt,e.eye,o);e.center=ge(k5,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),u=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,k5);return u!=null&&(e.center=u),!0}function Agt(t,e,r){const i=e.interactionType;if(i===cr.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===cr.ZOOM||i===cr.PAN,c=Sae(t,o),u=c===0?0:Tae(t,o);r.min=n,r.max=s,v9(c,u,l,a,.05*u,r)}function Tae(t,e){const r=t.pointsOfInterest.surfaceOrigin;return r.renderLocation?Bi(e.eye,r.renderLocation):0}function Ogt(t,e,r){return x_(r,t.eye,e)}const F5={min:0,max:0},Mgt=C(),Rgt=C(),$gt=C(),Igt=C(),k5=C();function sO(t,e,r=Xd.EYE){const i=t.state.constraints;if(!i.collision.enabled)return!1;const n=O7(t,e.eye),s=t.renderCoordsHelper.getAltitude(e.eye),o=n+i.collision.elevationMargin;if(s>=o)return!1;const a=Te(e.eye);if(_e(U5,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(Lgt,o,e.eye),r===Xd.EYE_AND_CENTER)e.center=ge(U5,e.eye,U5);else if(r===Xd.EYE_AND_CENTER_SCALE){const l=(a-s+o)/a;e.center=oe(U5,e.center,l)}return!0}var Xd;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Xd||(Xd={}));const U5=C(),Lgt=C();function Gb(t,e,r){t.worldUpAtPosition(e,Sye),_e(XH,r,e);const i=Te(XH);return i===0?0:_o(fe(XH,Sye)/i)}const Sye=C(),XH=C();function _Ne(t,e,r,i=!0){aM.eyeCenterDistance=0,aM.requiresTwoSteps=!1;const n=Eae(t,e,r,$2,aM);if(n===0)return!1;switch(Gu(z5,-n,e.viewRight),r.tiltMode){case my.LOOK_AROUND:ze(o1,e.viewForward,z5),oe(o1,o1,aM.eyeCenterDistance),e.center=ge(Pv,e.eye,o1);break;case my.TUMBLE:_e(o1,e.center,e.eye),ze(o1,o1,z5),e.eye=_e(Pv,e.center,o1);break;default:r.tiltMode}return e.up=ze(Pv,e.up,z5),!aM.requiresTwoSteps||!i||_Ne(t,e,r,!1)}function Eae(t,e,r,i=$2,n){if(!t.state.constraints.tilt)return 0;const s=e.distance,o=t.state.constraints.tilt(s,jgt);return Ggt(t,r,o),i.interactionType===cr.TUMBLE&&fD(i.selection,Xi.ALTITUDE)&&vNe(t,i.interactionStartCamera,o),r.tiltMode===my.LOOK_AROUND||i.tiltMode===my.LOOK_AROUND?Ngt(t,e,o,n):Dgt(t,e,o)}function Dgt(t,e,r){const i=Gb(t.renderCoordsHelper,e.center,e.eye),n=i-we(i,r.min,r.max);return mD(n)?n:0}function Ngt(t,e,r,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return kgt(t,e,r,i);case"local":return Fgt(t,e,r,i)}}function Fgt(t,e,r,i){const n=Gb(t.renderCoordsHelper,e.center,e.eye),s=we(n,r.min,r.max),o=n-s;if(!mD(o))return 0;if(i){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(s);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=e.distance}return o}function kgt(t,e,r,i){const n=Ugt(t,e,Hgt),s=we(n.tiltAtCenter,r.min,r.max);if(!mD(n.tiltAtCenter-s))return 0;let o,a;return n.centerIsOnSurface?(o=zgt(n),a=Vgt(n,o)):(o=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=Bgt(n,o)),i&&(i.eyeCenterDistance=Cee(n,o)),a}function Ugt(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=i+zr(t.spatialReference).radius,s=t.renderCoordsHelper.intersectManifold(e.ray,i,Pv);return r.eyeCenterDistance=e.distance,r.centerIsOnSurface=!1,s!=null?(r.eyeCenterDistance=Bi(e.eye,s),r.tiltAtCenter=Gb(t.renderCoordsHelper,s,e.eye),r.centerIsOnSurface=!0):t.state.isLocal?r.tiltAtCenter=Gb(t.renderCoordsHelper,e.center,e.eye):(QA(x7(S7,n),e.ray,Pv),r.eyeCenterDistance=Bi(e.eye,Pv),r.tiltAtCenter=_o(-fe(e.viewForward,me(Pv,Pv)))),r.radius=n,r.eyeRadius=Te(e.eye),r.constraints=t.state.constraints,r}function mD(t){return Math.abs(t)>1e-9}function zgt(t){const{constraints:e,eyeCenterDistance:r,tiltAtCenter:i}=t;let n=i,s=e.clampTilt(r,i);const o=Cee(t,s);if(e.clampTilt(o,i)===s)return s;let a=0;for(;a<10&&mD(s-n);){const l=(n+s)/2,c=Cee(t,l);mD(e.clampTilt(c,l)-l)?n=l:s=l,a++}return s}function Cee(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const r=Math.PI-we(e,0,Math.PI),i=ap(t.radius/t.eyeRadius*Math.sin(r)),n=Math.PI-r-i,s=Math.sin(n)/Math.sin(r);if(t.eyeRadius<t.radius&&s>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*t.eyeRadius}return s*t.eyeRadius}function Vgt(t,e){const r=ap(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),i=ap(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?r-i:i-r}function Bgt(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function Ggt(t,e,r){if(e.interactionType===cr.NONE)return;const{interactionStartCamera:i,interactionFactor:n}=e;if(!i)return;const{min:s,max:o}=r,a=Eae(t,i,$2,e),l=a===0?0:Gb(t.renderCoordsHelper,i.center,i.eye);r.min=s,r.max=o,e.interactionType===cr.TUMBLE?(fD(e.selection,Xi.ALTITUDE)&&vNe(t,i,r),v9(a,l,!0,n,Tye,r)):v9(a,l,!1,n,Tye,r)}function vNe(t,e,r){const i=t.state.constraints;if(t.state.isLocal||!i.altitude||!e)return;const n=nl(e.center),s=Math.sqrt(n),o=e.distance,a=zr(t.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,u=(l*l-o*o-n)/(-2*s*o),h=(c*c-o*o-n)/(-2*s*o);r.min=Math.max(r.min,Math.min(Math.PI-_o(h),r.max)),r.max=Math.min(r.max,Math.PI-_o(u))}const o1=C(),z5=xe(),Pv=C(),Tye=Ut(5),jgt={min:0,max:0},Hgt={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},aM={eyeCenterDistance:0,requiresTwoSteps:!1},qgt=t=>t,J7=t=>t*t,Cae=t=>1-J7(1-t),Wgt=t=>t<.5?J7(2*t)/2:(Cae(2*(t-.5))+1)/2,Pae=t=>t*t*t,bNe=t=>1-Pae(1-t),wNe=t=>t<.5?Pae(2*t)/2:(bNe(2*(t-.5))+1)/2,Aae=t=>t*t*t*t,xNe=t=>1-Aae(1-t),Ygt=t=>t<.5?Aae(2*t)/2:(xNe(2*(t-.5))+1)/2,Oae=t=>t*t*t*t*t,SNe=t=>1-Oae(1-t),Xgt=t=>t<.5?Oae(2*t)/2:(SNe(2*(t-.5))+1)/2,Mae=t=>1-Math.cos(t*Math.PI/2),TNe=t=>1-Mae(1-t),Zgt=t=>t<.5?Mae(2*t)/2:(TNe(2*(t-.5))+1)/2,Rae=t=>2**(10*(t-1)),$N=t=>1-Rae(1-t),Jgt=t=>t<.5?Rae(2*t)/2:($N(2*(t-.5))+1)/2,$ae=t=>-(Math.sqrt(1-t*t)-1),ENe=t=>1-$ae(1-t),Qgt=t=>t<.5?$ae(2*t)/2:(ENe(2*(t-.5))+1)/2;function xp(t){const e=2*(t-Math.sqrt((t-1)*t)),r=e/2/t;return i=>i<r?t*i*i:e*i-e+1}function Sp(t,e){return(r,i)=>r<e?e*t(r/e,i):1-t((1-r)/(1-e),i)*(1-e)}const Kgt=Sp(xp(1),1),eyt=Sp(xp(1),0),CNe=Sp(xp(1),.5),tyt=Sp(xp(2),1),ryt=Sp(xp(2),0),iyt=Sp(xp(2),.5),nyt=Sp(xp(3),1),syt=Sp(xp(3),0),oyt=Sp(xp(3),.5),ayt=Sp(xp(4),1),lyt=Sp(xp(4),0),cyt=Sp(xp(4),.5),uyt={linear:qgt,"in-quad":J7,"out-quad":Cae,"in-out-quad":Wgt,"in-coast-quad":Kgt,"out-coast-quad":eyt,"in-out-coast-quad":CNe,"in-cubic":Pae,"out-cubic":bNe,"in-out-cubic":wNe,"in-coast-cubic":tyt,"out-coast-cubic":ryt,"in-out-coast-cubic":iyt,"in-quart":Aae,"out-quart":xNe,"in-out-quart":Ygt,"in-coast-quart":nyt,"out-coast-quart":syt,"in-out-coast-quart":oyt,"in-quint":Oae,"out-quint":SNe,"in-out-quint":Xgt,"in-coast-quint":ayt,"out-coast-quint":lyt,"in-out-coast-quint":cyt,"in-sine":Mae,"out-sine":TNe,"in-out-sine":Zgt,"in-expo":Rae,"out-expo":$N,"in-out-expo":Jgt,"in-circ":$ae,"out-circ":ENe,"in-out-circ":Qgt};function os(t,e,r=fyt,i=e){i!==e&&i.copyFrom(e),i.computeUp(t.state.viewingMode);let n=!1;for(let a=0;a<myt;a++){let l=0;for(const c of pyt)if(fD(r.selection,c.type)){const u=Math.abs(c.error(t,i,r));c.apply(t,i,r)&&(n=!0,l+=u)}if(l===0)break}const s=fD(r.selection,Xi.COLLISION),o=hyt(r.interactionType,t);return s&&sO(t,i,o)&&(n=!0),n&&i.computeUp(t.state.viewingMode),n}function hyt(t,e){switch(t){case cr.PAN:return Xd.EYE_AND_CENTER;case cr.ASCEND:return e.state.isGlobal?Xd.EYE_AND_CENTER_SCALE:Xd.EYE_AND_CENTER;default:return Xd.EYE}}function Of(t){const e=Math.min(1,t/150);return wNe(e)}function dyt(t,e,r){return Eae(t,e,r)*e.distance}const pyt=[{type:Xi.TILT,error:dyt,apply:_Ne},{type:Xi.ALTITUDE,error:xae,apply:_gt},{type:Xi.DISTANCE,error:Sae,apply:Pgt}],fyt=new wp,myt=5;let Eye=class{constructor(e){this.viewingMode=e,this.center=C(),this.pitch=0,this.yaw=0,this.distance=0,this.direction=nn(Cye),this.fov=55,this.size=1}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Fe.Global){const s=(Te(this.center)+Te(e.center))/2;r.pan=Oz(this.center,e.center)*s}else r.pan=Bi(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const n=Math.abs(e.pitch-this.pitch);return r.rotate=Math.max(i,n),r.sourceZoom=this.distance,r.targetZoom=e.distance,r}interpolate(e,r,i){this.viewingMode===Fe.Global?PKe(e.center,r.center,i.pan,this.center):pi(this.center,e.center,r.center,i.pan),this.distance=isFinite(r.distance)?Dt(e.distance,r.distance,i.zoom):e.distance,this.pitch=Dt(e.pitch,r.pitch,i.rotate);let n=e.yaw;const s=r.yaw;Math.abs(s-n)>=Math.PI&&(n+=2*(n<s?1:-1)*Math.PI),this.yaw=Dt(n,s,i.rotate)}copyFrom(e){he(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,he(this.direction,e.direction),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const r=this._lookAtOrientation(e.center,Pye);he(this.center,e.center),_e(wa,e.center,e.eye),po(wa,wa,r),po(l1,e.up,r),this.distance=Te(wa),this.distance!==0&&(wa[0]/=this.distance,wa[1]/=this.distance,wa[2]/=this.distance),this.pitch=this._eyeUpToPitch(wa),this.yaw=gyt(wa,l1),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const r=this._lookAtOrientation(this.center,Pye);hp(r,r),this._axisAngleVec3(l8,this.pitch-Math.PI/2,Cye,wa),this._axisAngleVec3(ES,this.yaw,wa,wa),this._axisAngleVec3(l8,this.pitch-Math.PI/2,ES,l1),this._axisAngleVec3(ES,this.yaw,l1,l1),oe(wa,wa,this.distance),po(wa,wa,r),po(l1,l1,r),e.center=this.center,e.eye=_e(wa,this.center,wa),e.up=l1}_axisAngleVec3(e,r,i,n){const s=Math.cos(r),o=Math.sin(r);return oe(th,i,s),it(lu,e,i),oe(lu,lu,o),oe(a1,e,(1-s)*fe(e,i)),ge(n,ge(n,th,lu),a1)}_lookAtOrientation(e,r=gi()){return this._upAtLookAt(e,a1),it(th,this.direction,a1),me(th,th),th[0]===0&&th[1]===0&&th[2]===0&&he(th,l8),it(lu,a1,th),me(lu,lu),r[0]=th[0],r[1]=lu[0],r[2]=a1[0],r[3]=th[1],r[4]=lu[1],r[5]=a1[1],r[6]=th[2],r[7]=lu[2],r[8]=a1[2],r}_upAtLookAt(e,r){return this.viewingMode===Fe.Local?he(r,ES):me(r,e)}_eyeUpToPitch(e){return Math.PI-Oz(ES,e)}};function gyt(t,e){const r=yyt;return Math.abs(e[2])<.5?(he(r,e),t[2]>0&&oe(r,r,-1)):he(r,t),it(lu,r,ES),me(lu,lu),Oz(l8,lu,ES)}const th=C(),lu=C(),a1=C(),wa=C(),l1=C(),yyt=C(),ES=LP,Cye=Yne,l8=Wne,Pye=gi(),b9={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let _yt=class PNe{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:b9.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new PNe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,r,i){this.source!==e&&this.source.copyFrom(e),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:b9.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const r=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},vyt=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,r)=>e+r.time,0)}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,n=0;const s=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,r),s.hasPan&&!isNaN(r.pan)&&isFinite(s.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/s.compared.pan:r.pan=1,s.hasRotate&&!isNaN(r.rotate)&&isFinite(s.compared.rotate)?r.rotate=(n+l.compared.rotate*r.rotate)/s.compared.rotate:r.rotate=1,s.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,u=this.segments[0].definition.compared.sourceZoom,h=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-u)/(h-u)}else r.zoom=1;return r}e-=a.time,i+=l.compared.pan,n+=l.compared.rotate}}segmentInterpolateComponentsAt(e,r,i){return e.interpolateComponentsAt(r,i)}},ZH=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,r=e.compared,i=r.sourceZoom,n=r.targetZoom;this._zoomSign=i>n?1:-1,this._panPixelsAtSource=r.pan*e.source.pixelsPerPanAtZoom(i);const s=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(n))/2;this._rotatePixels=r.rotate*s}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:n,hasRotate:s}=this.definition;let o=0,a=0;i&&(n&&(o=(r/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(a=this._zoomSign*(Math.log(e/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&n&&s){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&n){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&s){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(n&&s){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else n?this._panPixelFlow=l:i?this._zoomPixelFlow=l:s&&(this._rotatePixelFlow=l);this._time=s?this.rotateTime:i?this.zoomTime:n?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=e*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-e-r)/(i-r)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*e*this._time)-1))/(r*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),n=this._interpolateComponentsPan(e),s=this._interpolateComponentsRotate(e);return r?(r.zoom=i,r.pan=n,r.rotate=s):r={zoom:i,pan:n,rotate:s},r}};function byt(t,e,r){const i=e-t.compared.sourceZoom,n=t.halfWindowPanAtZoom(i);return-t.halfWindowSize*(r.ascensionFactor*Math.LN2*t.compared.pan+n)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*n)}function wyt(t,e,r){const i=1/e,n=Math.log(t.compared.sourceZoom*i),s=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*i*s*o*l*c-t.halfWindowSize*n*s*o*l+t.halfWindowSize*n*s*o*c/(a*a)}function xyt(t,e,r){const i=e-t.compared.sourceZoom,n=1/i,s=1/e,o=Math.log(t.compared.sourceZoom*s),a=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(i))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a+2*n*o+2*s-2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Syt(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function Tyt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Eyt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Cyt(t,e,r){return-t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function Pyt(t,e,r){return t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function Ayt(t,e,r){return-2*t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function Oyt(t,e,r){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function Myt(t,e,r){const i=Math.log(e/t.compared.targetZoom),n=1/t.desiredPixelFlow,s=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*i*n*s*a+t.halfWindowSize*i*n*s*l/(o*o)+t.halfWindowSize*n*s*a*l/e}function Ryt(t,e,r){const i=e-t.compared.targetZoom,n=1/i,s=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+r.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a-2*n*o+2*s+2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function $yt(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function Iyt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Lyt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Dyt(t){const e=Math.LN2*t.compared.pan,r=t.compared.sourceZoom-t.compared.targetZoom,i=t.halfWindowPanAtZoom(r),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*i);return t.compared.sourceZoom<=t.compared.targetZoom?n*(e-i):n*(e+i)}function Nyt(t,e){let r=Fyt(t,e);const i={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},n=i.ascensionFactor===0,s=i.descensionFactor===0,o=n?Syt:byt,a=n?Tyt:wyt,l=n?Eyt:xyt,c=s?$yt:Oyt,u=s?Iyt:Myt,h=s?Lyt:Ryt,p=S=>o(t,S,i)+Cyt(t,S,i)+c(t,S,i),f=S=>a(t,S,i)+Pyt(t,S,i)+u(t,S,i),g=S=>l(t,S,i)+Ayt(t,S,i)+h(t,S,i);let y=p(r);const v=Dyt(t);let b;const w=e.maximumIterations||20,x=e.maximumDistance!=null?e.maximumDistance:1/0;for(b=0;b<w;b++){const E=(f(r)+1e-6)/g(r);if(isNaN(E)||r>=x&&E<0){if(!isFinite(x))return null;r=x,y=p(r);break}if(r-=E,r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;const P=p(r);if(Math.abs(P-y)/y<=.005)break;y=P}return y>v*(1-.3)||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r}function Fyt(t,e){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom),i=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return i<r?e.maximumDistance!=null?r+(e.maximumDistance-r)/2:1.5*r:e.maximumDistance?Math.min(e.maximumDistance,i):i}let kyt=class extends vyt{constructor(e,r){super(),this._preallocSegments=[new ZH,new ZH,new ZH],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,r)}update(e,r){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;r!=null&&r.apex&&(i=Nyt(e,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r==null?void 0:r.apex)}segmentInterpolateComponentsAt(e,r,i){return i=e.interpolateComponentsAt(r,i),e===this._ascensionSegment?i.zoom=Cae(i.zoom):e===this._descensionSegment&&(i.zoom=J7(i.zoom)),i}_updateWithApex(e,r){const[i,n,s]=this._preallocSegments,o=(r==null?void 0:r.ascensionFactor)??.5,a=Math.min(1-o,(r==null?void 0:r.ascensionFactor)!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=e,n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*l,n.definition.compared.rotate=this.definition.compared.rotate*l,n.update(),this.segments.push(n)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=e,s.definition.compared.pan=this.definition.compared.pan*a,s.definition.compared.rotate=this.definition.compared.rotate*a,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const Uyt={zoom:0,pan:0,rotate:0};let zyt=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new _yt(e),this.path=new kyt}update(e,r,i){this.definition.update(e,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(sCe(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?CNe:$N)}cameraAt(e,r){r=r||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,Uyt);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(e){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-r)/(i-r)}_applyTimeSettings(e,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?e=r.duration:r.speedFactor!=null&&(e=e/i);const n=r.minDuration!=null?r.minDuration:b9.minDuration/i,s=r.maxDuration!=null?r.maxDuration:b9.maxDuration/i;return Math.min(Math.max(n,e),s)}},Vyt=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new zyt(()=>new Eye(e)),this._current=new Eye(e)}update(e,r,i){const{source:n,target:s}=this._animation.definition,o=_e(Byt,r.center,e.center),a=Te(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),he(n.direction,o),he(s.direction,o),n.copyFromRenderCamera(e),s.copyFromRenderCamera(r),this._current.copyFrom(n),this._animation.update(n,s,i),this.currentTime=0,e.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(e,r){return this._animation.cameraAt(e,this._current),r=r||new st,this._current.copyToRenderCamera(r),r}step(e,r){return this.finished||(this.currentTime=this.currentTime+sCe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}};const Byt=C();var dn;(function(t){t[t.Ready=0]="Ready",t[t.Rejected=1]="Rejected",t[t.Running=2]="Running",t[t.Stopped=3]="Stopped",t[t.Finished=4]="Finished"})(dn||(dn={}));let C0=class extends Pe{constructor(e){super(e),this.state=dn.Ready}get active(){return this.state===dn.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=dn.Stopped,!0)}finishController(){this.state=dn.Finished}get steppingFinished(){return!1}};d([m({constructOnly:!0})],C0.prototype,"view",void 0),d([m({readOnly:!0})],C0.prototype,"active",null),d([m()],C0.prototype,"state",void 0),d([m({readOnly:!0})],C0.prototype,"isInteractive",null),C0=d([F("esri.views.3d.state.controllers.CameraController")],C0);let gD=class extends C0{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(gr()),this._asyncResult=null),this.state===dn.Finished||this.state===dn.Stopped?(JD(e),this.state===dn.Finished?e.resolve():e.reject(gr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=dn.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==dn.Ready&&this.state!==dn.Running||(this.viewAnimation.state===aA.State.FINISHED?this.finish():this.viewAnimation.state===aA.State.STOPPED&&(this.state=dn.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===dn.Finished?this.viewAnimation.finish():this.state===dn.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===dn.Finished?this._asyncResult.resolve():this._asyncResult.reject(gr()))}finish(){this.finishController()}};gD=d([F("esri.views.3d.state.controllers.AnimationController")],gD);let F0=class extends gD{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new Vyt(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new aA}get isInteractive(){return this.mode==="interaction"}begin(e,r){this._hasTarget=!0;const i=this.animationSettings(r);V5.copyFrom(this.view.state.camera);const n=pp(this.view.state.viewingMode);this.intersectionHelper.intersectRay(V5.ray,n,Aye)&&(V5.center=Aye),this.animation.update(V5,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,r){this._hasTarget&&this.animation.step(e,r)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?uyt[e.easing]:e.easing}}};d([m({constructOnly:!0})],F0.prototype,"mode",void 0),d([m({readOnly:!0})],F0.prototype,"isInteractive",null),F0=d([F("esri.views.3d.state.controllers.PointToPointAnimationController")],F0);const V5=new st,Aye=C();function Q7(t=jyt){return[t[0],t[1],t[2],t[3]]}function yD(t,e){return Gyt(t[0],t[1],t[2],e,gse.get())}function Gyt(t,e,r,i,n=Q7()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function Iae(t,e,r){return it(r,t,e),me(r,r),r[3]=zB(t,e),r}const jyt=[0,0,1,0];function kQt(t,e,r=fo()){return Lae(t,$f(e),r),me(r.direction,r.direction),r}function Lae(t,e,r){return Hyt(t,t.screenToRender(e,je.get()),r)}function Hyt(t,e,r){const i=vo(je.get(),e);if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;const n=vo(je.get(),e);n[2]=1;const s=t.unprojectFromRenderScreen(n,je.get());return s==null?null:(_e(r.direction,s,r.origin),r)}function oO(t,e,r){return Dae(t,t.screenToRender(e,je.get()),r)}function Dae(t,e,r){he(r.origin,t.eye);const i=se(je.get(),e[0],e[1],1),n=t.unprojectFromRenderScreen(i,je.get());return n==null?null:(_e(r.direction,n,r.origin),r)}function Nae(t,e,r,i){const n=oO(e,r,qyt);return cw(t,n,i)}const qyt=fo();var dA;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(dA||(dA={}));const ANe=30,w9=[1,3e8],K7=80,ONe=8,MNe=200,RNe=1508e5,$Ne=5,INe=50,Wyt=5,Yyt=10,JH=90,I2={exclude:new Set([kb])};function wT(t,e,r){return r[0]=e[0]/(t.fullWidth/t.pixelRatio),r[1]=e[1]/(t.fullHeight/t.pixelRatio),r}function Pee(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function jb(t,e,r){const i=Gu(yse.get(),r[3],r);i==null||Kne(i,fn)||(_e(bi,t.eye,e),ze(bi,bi,i),t.eye=ge(bi,bi,e),_e(bi,t.center,e),ze(bi,bi,i),t.center=ge(bi,bi,e),t.up=ze(bi,t.up,i))}function Xyt(t,e,r,i){return v2(t,Lae(e,r,Uae),i)}function Aee(t,e,r,i){return v2(t,oO(e,r,Uae),i)}function Fae(t,e,r,i){const n=je.get();let s=1-r;_e(n,e,t.eye);const o=Te(n);let a=o*(1-s);s>=0&&a<i&&(a=i,s=-(a-o)/o),Math.abs(o-a)<1e-6||(oe(n,n,s),t.eye=ge(bi,t.eye,n),t.center=pi(bi,t.center,e,s))}function LNe(t,e,r){e.getScreenCenter(Oye),Nae(t,e,Oye,bi)&&(e.center=bi);const i=e.distance,n=i*r;if(Math.abs(i-n)<1e-6)return;const s=oe(je.get(),e.viewForward,n);e.eye=_e(bi,e.center,s)}const Oye=Sn();function QH(t,e){se(e,0,0,0);for(const r of t)ge(e,e,r);oe(e,e,1/t.length)}function c8(t,e,r,i){return Math.sin(t/Te(e))*(r+i.radius)}function Mye(t,e,r,i){return c8(Math.PI/2,e,r,i)+(t-Math.PI/2)}var Bo;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(Bo||(Bo={}));const Rye={Elevation:3e4,Angle:Ut(16)},B5={Pole:.95,Angle:Ut(18),Tilt:45},DNe=Ut(80);function NNe(t,e,r,i,n,s){const o=C(),a=hs();let l=!0,c=!0;return t.intersectScreen(r,o,s)?a[3]=Te(o):(c=!1,e.aboveGround&&n!==dA.Ellipsoid?a[3]=Math.max(Te(e.center),.9*i.radius):a[3]=Te(e.eye)-e.relativeElevation,n===dA.Silhouette?_D(a,e,r,o):l=Nae(a,e,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function eG(t,e,r){return Te(t.eye)-r.radius>Rye.Elevation?Bo.Horizontal:(oO(t,e,Uye),-Math.sign(t.relativeElevation)*(.5*Math.PI+zB(t.eye,Uye.direction))<Rye.Angle?Bo.Vertical:Bo.Horizontal)}function FNe(t,e,r){_e(KH,r,e),t.eye=_e(bi,t.eye,KH),t.center=_e(bi,t.center,KH)}const KH=C();function _D(t,e,r,i){const n=oO(e,r,Uae);return n!=null&&(QA(t,n,G5),cw(t,n,i)?!(ca(G5,n.origin)<ca(i,n.origin))||(he(i,G5),!1):(_e(oE,e.eye,e.center),me(oE,oE),EAe(oE,-fe(me(oE,oE),G5),$ye),v2($ye,n,i),!1))}const G5=C(),oE=C(),$ye=Yr();function kNe(t,e,r,i,n,s){let o=0;if(it(T9,t,e),_e(W5,t,e),Te(t)<=n||!i.aboveGround){it(r,W5,i.eye);const a=fe(t,e)/(Te(t)*Te(e));if(a<.9999)o=_o(a);else{const c=Te(it(C(),t,e))/(Te(t)*Te(e));o=ap(c)}const l=Math.cos(we(Db.normalize(Ut(s)),0,DNe));o=-o-Math.max(0,Te(e)-n)/(l*n)}else _e(Iye,i.eye,i.center),it(r,W5,Iye),o=-Te(W5)/n;return me(r,r),oe(r,r,Te(T9)),o}const Iye=C();function Lye(t,e,r,i){let n,s;const o=Math.cos(we(Db.normalize(Ut(i)),0,DNe));return n=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):_o(e/r),s=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):_o(t/r),(s-n)*r}function Zyt(t,e,r,i,n,s,o,a,l,c){const u=Lye(t[2],e[2],s[3],a),h=l?Lye(t[0],e[0],s[3],180):e[0]-t[0],p=Math.sin(o)*h-Math.cos(o)*u,f=Math.cos(o)*h+Math.sin(o)*u;me(bi,n);const g=l?p/Math.sqrt(Math.abs(s[3]**2-fe(r,bi)**2)):p/s[3],y=f/Math.sqrt(Math.abs(s[3]**2-fe(r,i)**2));yr(c,g,y)}function UNe(t,e,r,i,n,s,o,a,l,c){it(T9,t,e),sQ(s.up,s.eye,j5,H5,q5),sQ([0,0,1],s.eye,Y0,hb,GNe),he(r,hb),he(i,Y0),me(r,r),oe(r,r,Te(T9)),Xfe(t,me(H5,H5),me(q5,q5),me(j5,j5),Dye),Xfe(e,H5,q5,j5,Nye),Zyt(Dye,Nye,t,Y0,hb,o,a,l,c,n)}function Jyt(t,e,r,i,n,s,o){Gu(x9,n,i),Gu(S9,o,s),Kr(c3,x9,S9),_e(e,t,r),ze(e,e,c3),ge(e,e,r)}function zNe(t,e,r,i,n,s){Gu(x9,i,r),Gu(S9,s,n),Kr(c3,x9,S9),_e(bi,t.eye,e),ze(bi,bi,c3),t.eye=ge(bi,bi,e),_e(bi,t.center,e),ze(bi,bi,c3),t.center=ge(bi,bi,e),_e(bi,t.up,e),ze(bi,bi,c3),t.up=ge(bi,bi,e)}function kae(t,e,r,i,n,s){return(Math.abs(i)>Math.PI-B5.Angle||Math.abs(i)<B5.Angle)&&(Math.abs(t[2])<r*B5.Pole||Math.abs(e)>r)&&s.aboveGround&&n<B5.Tilt}function VNe(t,e,r,i,n,s){if(s)Iae(r,i,Fye),jb(e,t,Fye);else{const o=kNe(r,i,kye,e,t[3],n);jb(e,t,yD(kye,o))}}function BNe(t,e,r,i,n,s,o){const a=o?20:1,l=1e-12;let c,u;he(Fw,i),Y5.copyFrom(e);for(let h=0;h<a&&ca(r,Fw)>l&&(c=ca(r,Fw),UNe(r,Fw,hb,Y0,lM,Y5,t,n,s,o),zNe(Y5,t,Y0,lM[1],hb,lM[0]),Jyt(Fw,Fw,t,Y0,lM[1],hb,lM[0]),u=ca(r,Fw),u<c||h===0);h++)e.copyFrom(Y5)}function Qyt(t,e,r,i,n,s,o){kae(r,fe(e.up,r),t[3],-Db.normalize(Ut(n)),s,e)?BNe(t,e,r,i,-Db.normalize(Ut(n)),s,o):VNe(t,e,r,i,s,o)}function Kyt(t,e,r,i,n,s){const{eye:o}=t;sQ([0,0,1],o,Y0,hb,GNe);const a=e.translation[0]*r.pan,l=n.mode==="zoom"?0:e.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-fe(t.center,Y0)**2/Te(t.center)**2)),.5),u=(Math.sin(s)*l+Math.cos(s)*a)/c,h=-Math.cos(s)*l+Math.sin(s)*a;switch(Ou(i.pan.matrix,i.pan.matrix,u,Y0),i.pan.enabled=!0,n.mode){case"pan":Ou(i.pan.matrix,i.pan.matrix,h,hb),i.pan.enabled=!0;break;case"zoom":i.zoom=-e.translation[1]*r.zoom}}function e0t(t,e,r,i,n){const{eye:s,viewRight:o}=t,a=it(je.get(),o,s),l=e.translation[0]*r.pan;switch(l!==0&&(Ou(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),n.mode){case"pan":{const c=e.translation[1]*r.pan;c!==0&&(Ou(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-e.translation[1]*r.zoom}}function t0t(t,e,r,i,n,s,o,a,l){kae(t.center,fe(t.up,t.center),Te(t.center),-Db.normalize(Ut(s)),o,e)?Kyt(e,r,i,a,l,-Db.normalize(Ut(n))):e0t(e,r,i,a,l)}const Y0=C(),hb=C(),GNe=C(),j5=C(),H5=C(),q5=C(),Dye=C(),Nye=C(),lM=Ye(),Fye=Q7(),x9=xe(),S9=xe(),c3=xe(),Fw=C(),bi=C(),W5=C(),Y5=new st,T9=C(),kye=C(),Uae={origin:C(),direction:C()},Uye={origin:C(),direction:C()},zye=.6,eq=4,r0t=60;let E9=class extends F0{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new st,this._tmpViewDir=C(),this._tmpRayDir={origin:C(),direction:C()},this._targetOnSphere=C(),this._tmpCenter=C(),this._beginCamera=new st,this._constraintOptions=new wp(Xi.ALL_EXCEPT_COLLISION,cr.ZOOM,null,this._beginCamera),this._sphere=hs()}initialize(){this._intersector=pp(this.view.state.viewingMode)}zoomStep(e,r){if(!this.active)return;const i=this.view.state;this.animation.finished?this._beginCamera.copyFrom(i.camera):this.animation.cameraAt(1,this._beginCamera);let n=!1,s=!1;this.intersectionHelper.intersectScreen(r,this._zoomLocation,this.view.map.ground.opacity===0?I2:{})&&(n=e>0,s=!0),this._tmpCamera.copyFrom(i.camera),n?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:he(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,r,s),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:$N}}_updateCamera(e,r,i,n,s){const o=zr(this.view.spatialReference),a=eG(e,n,o),l=Math.abs(this.view.camera.position.z);me(Z5,e.eye),oe(Z5,Z5,-1),oO(e,n,this._tmpRayDir),me(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=we(Math.min(ONe,1/Math.abs(fe(Z5,this._tmpRayDir.direction)))*l,MNe,RNe);if(a===Bo.Horizontal){let u=zye**r;this._sphere[3]=Te(i),_e(this._tmpViewDir,e.center,e.eye);const h=Math.min(Te(this._tmpViewDir),c);let p=h*u;if(u<=1&&p<eq&&(p=eq,u=p/h),Math.abs(h-p)<1e-6)return;const f=Te(e.center);if(this._sphere[3]!==f){const g=this._sphere[3]+u*(f-this._sphere[3]);e.center=oe(X5,e.center,g/f)}oe(this._tmpViewDir,this._tmpViewDir,-u),e.eye=ge(X5,e.center,this._tmpViewDir),os(this.view,e,this._constraintOptions),ca(i,e.center)>1e-12&&Nae(this._sphere,e,n,this._targetOnSphere)&&Qyt(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let u=zye**Math.abs(r);const h=r>0?1:-1;_e(this._tmpViewDir,i,e.eye);const p=Te(this._tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,n[0],n[1],this.view.state.camera,r0t);let g=f??c;g=s&&r>0?Math.min(g,p):g,oe(this._tmpRayDir.direction,this._tmpRayDir.direction,g),ge(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let y=g*u;const v=Math.max(eq,1.01*e.nearFar[0]);if(r>0&&y<v&&(y=v,u=y/g),Math.abs(g-y)<1e-6)return;oe(this._tmpRayDir.direction,this._tmpRayDir.direction,h*(1-u)),e.eye=ge(X5,e.eye,this._tmpRayDir.direction),e.center=ge(X5,e.center,this._tmpRayDir.direction)}sO(this.view,e)}};E9=d([F("esri.views.3d.state.controllers.global.ZoomStepController")],E9);const X5=C(),Z5=C();let u8,h8=null;const aP=new Map;async function zQt(t){h8==null&&(u8==null&&(u8=re(()=>import("./VoxelWasmPerSceneView-B3WzGIkO.js"),__vite__mapDeps([]))),h8=await u8);const e=t.view;let r=aP.get(e);return r||(r=new h8.default({view:e}),aP.set(e,r)),r.addVoxelLayer(t)}function vD(t){return aP.get(t)}function VQt(t){const e=t.view,r=aP.get(e);r&&r.removeVoxelLayer(t)<1&&(aP.delete(e),aP.size===0&&(u8=null,h8=null))}const i0t=.6,n0t=4,s0t=60;let C9=class extends F0{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new st,this._tmpRayDir=C(),this._tmpCenter=C(),this._beginCamera=new st,this._constraintOptions=new wp(Xi.ALL,cr.ZOOM,null,this._beginCamera)}zoomStep(e,r){if(!this.active)return;const i=this.view.state;this.animation.finished?this._beginCamera.copyFrom(i.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(i.camera);const n=pp(this.view.state.viewingMode);let s=!1;e>0?(s=this.intersectionHelper.intersectScreenFreePointFallback(r,this._zoomLocation,this.view.map.ground.opacity===0?I2:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:he(this._zoomLocation,this._tmpCamera.center);const o=i0t**e;let a=this.view._stage.renderView.getMinimalDepthForArea(vD(this.view),r[0],r[1],this.view.state.camera,s0t);_e(J5,this._tmpCamera.eye,this._zoomLocation),me(J5,J5);const l=we(Math.min(ONe,1/Math.abs(fe(o0t,J5)))*Math.abs(this.view.camera.position.z),MNe,RNe);if(a=a??l,a){const c=C();_e(c,this._zoomLocation,this._tmpCamera.eye),(a<Te(c)||!s)&&(me(c,c),ge(this._zoomLocation,this._tmpCamera.eye,oe(c,c,a)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:$N}}_updateCamera(e,r,i){_e(this._tmpRayDir,i,e.eye);const n=Te(this._tmpRayDir);let s=n*r;const o=r<=1,a=Math.max(n0t,1.01*e.nearFar[0]);s!==0&&(o&&s<a&&(s=a,r=s/n),Math.abs(n-s)<1e-6||(oe(this._tmpRayDir,this._tmpRayDir,r),e.eye=_e(Vye,i,this._tmpRayDir),e.center=pi(Vye,e.center,i,1-r),os(this.view,e,this._constraintOptions)))}};C9=d([F("esri.views.3d.state.controllers.local.ZoomStepController")],C9);const Vye=C(),o0t=Ce(0,0,1),J5=C();function a0t(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function zae(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let l0t=class extends va{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(e){const r=e.data;if(a0t(r,"primary")){const i=this._view.state.isGlobal?new E9({view:this._view,mode:"animation"}):new C9({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),Sn(r.x,r.y)),e.stopPropagation()}}};function c0t(t,e,r){return t===Fe.Global?new h0t(r):new u0t(e,r)}let u0t=class{constructor(e,r){this._elevationProvider=e,this._referenceEllipsoid=zr(r),this._unitInMeters=fl(r,this._referenceEllipsoid.metersPerDegree)}compute(e,r,i,n,s){var x;s||(s={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-n,c=(x=this._elevationProvider)==null?void 0:x.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(i=i??new br({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},h=Math.max(u.x,u.y,u.z);_e(kw,r,e),aE[0]=kw[0]>0?i.xmax:i.xmin,aE[1]=kw[1]>0?i.ymax:i.ymin,aE[2]=kw[2]>0?h/2:-h/2,_e(aE,aE,e),me(kw,kw);const p=1.1*fe(aE,kw)*this._unitInMeters,f=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),y=g*f0t*this._unitInMeters,v=g*m0t*this._unitInMeters,b=we((o-v)/(y-v),0,1)**3,w=Math.min(Dt(f,p,b),f)*Math.max(Math.log(Math.abs(l)),1);return jNe(Math.min(w,Math.max(34064e4,h))/this._unitInMeters,d0t,this._unitInMeters,s)}},h0t=class{constructor(e){this._referenceEllipsoid=zr(e)}compute(e,r,i,n,s){s||(s={near:0,far:0});const o=Te(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,n),c=Math.abs(a-n),u=Math.max(c,Math.abs(a)),h=Math.sqrt(u*(u+2*l)),p=o+this._referenceEllipsoid.radius;return jNe(1.2*Dt(h,p,iae(u)),we(2e4-(Math.log(u)-7.983)/9.011*19e3,1e3,2e4),1,s)}};function jNe(t,e,r,i){const n=p0t/r;return t/e>n?(i.far=t,i.near=i.far/e):(i.near=n,i.far=i.near*e),i}const d0t=2e4,p0t=2,f0t=.001,m0t=1e-4,aE=C(),kw=C();let d8=class extends Pe{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const r=this.view.state.camera;e.spatialReference!=null&&b$e(this.view,r,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>sO(this.view,e,Xd.EYE_AND_CENTER))}};d([m({constructOnly:!0})],d8.prototype,"view",void 0),d8=d([F("esri.views.3d.state.ElevationCollisionConstraint")],d8);let ZR=class extends Pe{constructor(e){super(e),this.nearFarHeuristic=c0t(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([pe(()=>{var e,r,i,n;return[(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.near,(n=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:n.far]},()=>this._clipDistanceNearFarChanged()),pe(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),pe(()=>this.view.renderDataExtent,()=>this._updateNearFar(),ei),pe(()=>{var e,r,i,n;return[(r=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:r.min,(n=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:n.max]},()=>this._updateAltitude(),ei),pe(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.max},()=>this._updateTiltMax(),ei),pe(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.mode},()=>this._updateTilt(),ei),pe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),ei),pe(()=>{var e,r,i,n,s,o;return[(i=(r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.navigationConstraint)==null?void 0:i.type,(o=(s=(n=this.view.state)==null?void 0:n.constraints)==null?void 0:s.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),ei)]),this.view.state.isLocal&&this.addHandles(pe(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),mi)),this._updateNearFar(),this.view.state.viewingMode!==Fe.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new d8({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var r;const e=(r=this.view.constraints)==null?void 0:r.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const r=this.view.constraints&&this.view.constraints.clipDistance;(r?r.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,r):this._updateCameraNearFarAuto(e,r)}_updateCameraNearFarAuto(e,r){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,O7(this.view,e.eye),e),r&&r.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,r){r&&(e.near=r.near,e.far=r.far)}_updateCollision(){var n,s,o;const e=(o=(s=(n=this.view.map)==null?void 0:n.ground)==null?void 0:s.navigationConstraint)==null?void 0:o.type,r=!e||e==="stay-above",i=this.view.state.constraints.collision;if(r!==i.enabled){i.enabled=r,r&&this._reapplyConstraints(Xi.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Fe.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(Ut(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const r=this.view.state.constraints;if(r.tilt){const i=r.tilt(this.view.state.camera.distance).max;e.autoUpdate(ul(i))}}_updateLocalSurfaceDistance(e){if(e==null)return;let r=Math.max(e.width,e.height);if(r<=0)return;e.zmax!=null&&e.zmin!=null&&(r=Math.max(r,e.zmax-e.zmin));const i=this.view.state,n=3*r/Math.atan(i.camera.fov/2);n!==i.constraints.distance&&(i.constraints.distance=n)}_reapplyConstraints(e=Xi.ALL){this.view.state.updateCamera(r=>os(this.view,r,new wp(e,cr.NONE,null)))}};d([m({constructOnly:!0})],ZR.prototype,"view",void 0),d([m({readOnly:!0})],ZR.prototype,"surfaceCollisionConstraint",void 0),ZR=d([F("esri.views.3d.state.ConstraintsManager")],ZR);let Av=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=pD(),this._points=ADe(),this.lines=new Array(12),this._origin=C(),this._direction=C(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:C(),endpoint:null}}update(e){ODe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),he(this._origin,e.eye),he(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)he(this._points[r],e[r]);MDe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return jv(this.frustum,e)}intersectsRay(e){return bft(this.frustum,e)}intersectsLineSegment(e,r){return wft(this.frustum,e,r)}intersectsPoint(e){return RDe(this.frustum,e)}_updateLines(){const e=this._points;for(let r=0;r<4;r++){const i=r+4;tq(this.lines[r],e[r],e[i]),tq(this.lines[r+4],e[r],r===3?e[0]:e[r+1]),tq(this.lines[r+8],e[i],r===3?e[4]:e[i+1])}}};function tq(t,e,r){t.origin=e,t.endpoint=r,x_(t.direction,e,r)}Av.planePointIndices=xft,Av.nearFarLineIndices=[[ut.NEAR_BOTTOM_LEFT,ut.FAR_BOTTOM_LEFT],[ut.NEAR_BOTTOM_RIGHT,ut.FAR_BOTTOM_RIGHT],[ut.NEAR_TOP_RIGHT,ut.FAR_TOP_RIGHT],[ut.NEAR_TOP_LEFT,ut.FAR_TOP_LEFT]];let II=class extends C0{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=dn.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||b$e(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),sO(this.view,e,Xd.EYE_AND_CENTER)||this.constraintEnabled||(this.state=dn.Stopped)})}};d([m({constructOnly:!0})],II.prototype,"desiredCamera",null),II=d([F("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],II);const g0t=.66;function HNe(t){return 360-soe.normalize(t)}function tG(t){return soe.normalize(360-t)}function y0t(t,e,r){const i=e.camera;if(i!=null)return v0t(i,O_(t));const{targetGeometry:n}=e;if(n==null)return null;const{camera:s,mode:o}=qNe(t,e.rotation,r);if(n.type==="point")return w0t(t,e,n,s,o);const a=n.extent;return a==null?null:P6(t,a,s.heading,s.tilt,o)}async function _0t(t,e,r,i){const n=e.camera;if(n!=null)return b0t(n,O_(t),i);const{targetGeometry:s}=e;if(s==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=qNe(t,e.rotation,r);if(s.type==="point")return x0t(t,e,s,o,a,i);const l=s.extent;if(l==null)throw new Error("Target geometry has no extent!");return W$e(t,l,o.heading,o.tilt,a,i)}function v0t(t,e){const r=t.position;let i;try{i=Ob(r,e)}catch{return null}if(!i)return null;const n=t.clone();return n.position=i.clone(),n}async function b0t(t,e,r){const i=t.position,n=await Mb(i,e,{signal:r});dt(r);const s=t.clone();return s.position=n.clone(),s}function qNe(t,e,r){const i=sA(t,t.state.camera);let n=Fa.ADJUST;return e!=null&&(i.heading=HNe(e),n=Fa.LOCKED),r!=null&&(i.tilt=r),{camera:i,mode:n}}function w0t(t,e,r,i,n){const s=t.spatialReference;let o;try{o=Ob(r.clone(),s)}catch{return null}if(!o)return null;const a=e.scale!=null?M7(t,e.scale,o.latitude):t.state.camera.distance;return Ult(t,o,a,i,n)}async function x0t(t,e,r,i,n,s){const o=t.spatialReference,a=await Mb(r.clone(),o,{signal:s});dt(s);const l=e.scale!=null?M7(t,e.scale,a.latitude):t.state.camera.distance;return N$e(t,a,l,i,n,s)}function S0t(t,e,r=null){return r==null&&(r=new dm),Gae(t,null,e.clone(),r)}async function T0t(t,e,r){const i=L0t(t,e);if(!i)throw new B("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new Hh({fov:t.camera.fov}),s=new dm({camera:n});if(i.target instanceof dm)return Uw(await P0t(t,i.target,i,r,s));if(i.target instanceof Hh)return Uw(await YNe(t,i.target,r,s));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof br){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return Uw(o||c?await A9(t,i,i.target.center,n,r,s):await R0t(t,i,i.target,n,r,s))}const a={boundingBox:zi(),hasZ:!1,screenSpaceObjects:[]},l=o?E0t(t,i):void 0;if(await WNe(t,i.target,l,a,r),isFinite(a.boundingBox[0])){let c;if(kf(a.boundingBox,jn),wh.x=jn[0],wh.y=jn[1],wh.z=jn[2],wh.spatialReference=t.spatialReference,isFinite(wh.z)&&a.hasZ?c=Sse(a.boundingBox):(wh.z=void 0,c=NJe(xse(a.boundingBox,N0t))),o||c)return Uw(await A9(t,i,wh,n,r,s));const u=D0t(t,a.screenSpaceObjects);return Uw(await I0t(t,i,wh,a.boundingBox,u,n,r,s))}return i.position?Uw(await O0t(t,i,n,s,r)):Uw(await M0t(t,i,n,r,s))}function Vae(t,e){return e.scale==null&&e.zoom!=null?Q$e(t,e.zoom):e.scale}function E0t(t,e){const r=Vae(t,e);return r?dot(r):void 0}function Bae(t,e){let r=!1;return e.heading!=null?(t.heading=e.heading,r=!0):e.rotation!=null&&(t.heading=HNe(e.rotation),r=!0),e.tilt!=null&&(t.tilt=e.tilt,r=!0),e.fov!=null&&(t.fov=e.fov),r}function Gae(t,e,r,i){const n=t.spatialReference||Ve.WGS84;if((e=e??_0(t,r))==null)return i;const s=new He({spatialReference:n});return uy(e.center,t.renderSpatialReference,s)&&(i.targetGeometry=s,i.scale=K$e(t,e),i.rotation=tG(r.heading),i.camera=r),i}async function P9(t,e,r,i){var h;const n=()=>new B("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw n();e.type==="mesh"&&(e=e.extent);const s=e.spatialReference,o=t.spatialReference,a=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let p;switch(e.type){case"point":p=e;break;case"multipoint":case"polyline":p=(h=e.extent)==null?void 0:h.center;break;case"extent":p=e.center;break;case"polygon":p=e.centroid}p!=null&&a!=null&&t.elevationProvider!=null?(p=await Mb(p,a,{signal:i}),jn[2]=kg(t.elevationProvider,p)??0):jn[2]=0}const l=F0t[e.type],c=new Array;if(l(e,e.hasZ?p=>{c.push([p[0],p[1],p[2]])}:p=>{c.push([p[0],p[1]])},jn),c.length===0)throw n();const u=await Mb(new VA({spatialReference:s,hasZ:e.hasZ,hasM:!1,points:c}),o,{signal:i});if(e.hasZ&&(r.hasZ=!0),e.hasZ)for(const[p,f,g]of u.points)jn[0]=p,jn[1]=f,jn[2]=g,um(r.boundingBox,jn);else for(const[p,f]of u.points)jn[0]=p,jn[1]=f,um(r.boundingBox,jn)}async function C0t(t,e,r,i,n){const s=await op(t.whenViewForGraphic(e));if(s.ok===!1||s.value==null||!("whenGraphicBounds"in s.value))return void await P9(t,e.geometry,i,n);const o=s.value,a=await op(o.whenGraphicBounds(e,{minDemResolution:r}));if(a.ok===!1||!a.value)return void await P9(t,e.geometry,i,n);const{screenSpaceObjects:l,boundingBox:c}=a.value;YP(i.boundingBox,c),l&&l.forEach(u=>{i.screenSpaceObjects.push(u)}),isFinite(c[2])&&(i.hasZ=!0)}async function WNe(t,e,r,i,n){var s;if(Array.isArray(e)&&e.length===2){const o=e[0],a=e[1];if(typeof o=="number"&&typeof a=="number")return wh.x=o,wh.y=a,wh.z=void 0,wh.spatialReference=(s=t.spatialReference)!=null&&s.isGeographic?t.spatialReference:Ve.WGS84,void await P9(t,wh,i,n)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(o=>WNe(t,o,r,i,n))):e instanceof w_?await P9(t,e,i,n):e instanceof Hu&&await C0t(t,e,r,i,n)}async function P0t(t,e,r,i,n){if(e.camera!=null)return YNe(t,e.camera,i,n);n.scale=e.scale,n.rotation=e.rotation,n.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,n.camera=null,r.heading!=null?n.rotation=tG(r.heading):r.rotation!=null&&(n.rotation=r.rotation);const s=Vae(t,r);return s!=null&&(n.scale=s),n.camera=await _0t(t,n,r.tilt,i),n}async function YNe(t,e,r,i){const n=t.spatialReference,s=await Mb(e.position,n,{signal:r});return(e=e.clone()).fov=t.camera.fov,e.position=s,Gae(t,null,e,i)}async function A0t(t,e,r,i,n,s,o){const a=t.renderSpatialReference;return await Dz(e,rq,a,0,{signal:o}),await Dz(r,K5,a,0,{signal:o}),s.targetGeometry=new He(e),n.position=new He(r),_e(O9,rq,K5),R7(t,K5,O9,i.up,n),s.scale=e2(t,Bi(K5,rq),s.targetGeometry.latitude),s.rotation=tG(n.heading),s.camera=n,s}async function A9(t,e,r,i,n,s){if(r==null)throw new B("createfromcenter","invalid point");s.targetGeometry=r.clone();const o=P2(t);if(e.position)return A0t(t,s.targetGeometry,e.position,o,i,s,n);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=oe(jn,o.viewForward,-l);o.eye=ge(jn,o.center,c),s.scale=e2(t,l,r.latitude)}sA(t,o,i);const a=Bae(i,e)?Fa.LOCKED:Fa.ADJUST;if(!e.zoomFactor){const l=Vae(t,e);if(l==null){const{renderSpatialReference:c}=t;await Dz(r,jn,c,0,{signal:n}),RDe(o.frustum,jn)?s.scale=e2(t,Bi(o.eye,jn),r.latitude):s.scale=K$e(t,o)}else s.scale=l;s.camera=await D$e(t,s.targetGeometry,s.scale,i,a,n)}return s}async function O0t(t,e,r,i,n){const s=P2(t);he(O9,s.viewForward),R7(t,s.eye,O9,s.up,iq);const o=t.spatialReference,{position:a}=e;if(a){const l=await Mb(a,o,{signal:n});r.position=l}else r.position=new He;return r.heading=e.heading!=null?e.heading:iq.heading,r.tilt=e.tilt!=null?e.tilt:iq.tilt,Gae(t,null,r,i)}async function M0t(t,e,r,i,n){const s=P2(t),{spatialReference:o,renderSpatialReference:a}=t,l=new He({spatialReference:o});return uy(s.center,a,l)?A9(t,e,l,r,i,n):A9(t,e,null,r,i,n)}async function R0t(t,e,r,i,n,s){s.targetGeometry=r.clone();const o=P2(t);sA(t,o,i);const a=Bae(i,e)?Fa.LOCKED:Fa.ADJUST;return s.camera=await W$e(t,r,i.heading,i.tilt,a,n),s}function $0t(t,e,r,i,n){let s=0;r.z!=null?s=r.z:t.basemapTerrain&&t.elevationProvider&&(s=kg(t.elevationProvider,r)),se(jn,r.x,r.y,s),Ua(t.spatialReference,jn,Bye,t.renderSpatialReference),jh(Q5,Bye),hp(Q5,Q5),zi(cM);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const y=o[g];let v=i[y[2]];isFinite(v)||(v=s),se(jn,i[y[0]],i[y[1]],v),ga(jn,t.spatialReference,jn,t.renderSpatialReference),um(cM,po(jn,jn,Q5))}const a=b2(cM),l=aw(cM),c=w2(cM),u=1/Math.tan(e.fovX/2),h=1/Math.tan(e.fovY/2),p=.5*Math.sqrt(a*a+c*c)*Math.max(h,u)+.5*l,f=.5*l*h+.5*Math.max(a,c);return Math.max(p,f)/n}async function I0t(t,e,r,i,n,s,o,a){a.targetGeometry=r.clone();const l=P2(t),c=$0t(t,l,r,i,n);sA(t,l,s);const u=Bae(s,e)?Fa.LOCKED:Fa.ADJUST;return a.scale=e2(t,c,a.targetGeometry.latitude),a.camera=await D$e(t,a.targetGeometry,a.scale,s,u,o),a}function L0t(t,e){if(!e||!t.spatialReference)return null;const r={target:void 0};return"declaredClass"in e||Array.isArray(e)?r.target=e:(Object.assign(r,e),e.center&&!r.target&&(r.target=e.center)),r}function Uw(t){return(t==null?void 0:t.camera)!=null&&(t.rotation=tG(t.camera.heading)),t}function D0t(t,e){const r=g0t;if(!e.length)return r;let i=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n].screenSpaceBoundingRect;i=Math.max(i,Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]),Math.abs(s[3]))}return r-i/Math.min(t.width,t.height)*2}const jn=C(),Bye=xe(),Q5=gi(),cM=Ds(),N0t=Ht(),O9=C(),K5=C(),rq=C(),iq={heading:0,tilt:0},wh=new He,F0t={point(t,e,r){r[0]=t.x,r[1]=t.y,t.z!=null&&(r[2]=t.z),e(r)},polygon(t,e,r){const i=t.hasZ;for(let n=0;n<t.rings.length;n++){const s=t.rings[n];for(let o=0;o<s.length;o++)r[0]=s[o][0],r[1]=s[o][1],i&&(r[2]=s[o][2]),e(r)}},polyline(t,e,r){const i=t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n];for(let o=0;o<s.length;o++)r[0]=s[o][0],r[1]=s[o][1],i&&(r[2]=s[o][2]),e(r)}},multipoint(t,e,r){const i=t.points,n=t.hasZ;for(let s=0;s<i.length;s++)r[0]=i[s][0],r[1]=i[s][1],n&&(r[2]=i[s][2]),e(r)},extent(t,e,r){t.zmin!=null&&t.zmax!=null?(e(se(r,t.xmin,t.ymin,t.zmin)),e(se(r,t.xmax,t.ymin,t.zmin)),e(se(r,t.xmin,t.ymax,t.zmin)),e(se(r,t.xmax,t.ymax,t.zmin)),e(se(r,t.xmin,t.ymin,t.zmax)),e(se(r,t.xmax,t.ymin,t.zmax)),e(se(r,t.xmin,t.ymax,t.zmax)),e(se(r,t.xmax,t.ymax,t.zmax))):(e(se(r,t.xmin,t.ymin,r[2])),e(se(r,t.xmax,t.ymin,r[2])),e(se(r,t.xmin,t.ymax,r[2])),e(se(r,t.xmax,t.ymax,r[2])))}};let k0t=class{constructor(e,r,i){this.target=e,this.options=r,this.view=i,this.state="pending",this._animationController=null,this.promise=new Promise((n,s)=>{this._resolveCallback=n,this._rejectCallback=s;const o=new AbortController;this.options.signal!=null&&la(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(gr())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await qT(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}async createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null;try{const e=await T0t(this.view,this.target,this._abortController.signal);if(this.state==="finished")return;const r=e?this._getCameraFromViewpoint(e):null;if(r==null)return;if(this.options.animate){if(this._animationController==null)return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()}catch(e){this.reject(e)}}}_getCameraFromViewpoint(e){var s;const r=!!(this.target instanceof dm&&this.target.camera||this.target instanceof Hh),i=e.camera;if(i==null)return null;if(!this.view.stateManager.isCompatible(i)){const o=i.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(s=this.view.spatialReference)==null?void 0:s.wkid;return this.reject(new B("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:i})),null}const n=_0(this.view,i);return n==null?(this.reject(new B("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:n,isFullySpecified:r}}startAnimation(e,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(i==null)return void this.reject(new B("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!r.active||r.viewAnimation==null||r.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==r)return this.abort();let n;e.isFullySpecified?(n=new II({view:this.view,desiredCamera:e.camera}),sO(this.view,e.camera,Xd.EYE_AND_CENTER)):os(this.view,e.camera),r.begin(e.camera,this.options);const s=()=>{const a=this.view.state.cameraController;n&&(a&&a.active?a instanceof F0&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=n):r.viewAnimation!=null&&r.viewAnimation.target===e.viewpoint&&r.state===dn.Finished&&(this.view.state.cameraController=n))},o=a=>{if(this.view.state!=null)switch(r.state){case dn.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case dn.Ready:case dn.Rejected:case dn.Running:case dn.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(s,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,r=null;const i=this.view.state.cameraController;return i instanceof F0&&(i.updateStateFromViewAnimation(),i.active&&(e=i,r=e.viewAnimation)),e!=null||(e=new F0({view:this.view,mode:"animation"}),r=e.viewAnimation,this.view.state.switchCameraController(e))?e:(r!=null&&r.stop(),this.reject(new B("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},Hb=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,r){var i;return(i=this._outer.get(e))==null?void 0:i.get(r)}set(e,r,i){const n=this._outer.get(e);n?n.set(r,i):this._outer.set(e,new Map([[r,i]]))}delete(e,r){const i=this._outer.get(e);i&&(i.delete(r),i.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((r,i)=>e(r,i))}};var Ys;function nq(t=!ne("disable-feature:high-quality-idle"),e=null){const r=new Hb;return t?(r.set(Xr.IDLE,Ys.Antialiasing,e!=="low"),r.set(Xr.IDLE,Ys.HighResolutionAtmosphere,e!=="low"),r.set(Xr.IDLE,Ys.HighQualityTransparency,!0),r.set(Xr.IDLE,Ys.SSAO,!0),r.set(Xr.IDLE,Ys.WaterReflection,!0),r.set(Xr.IDLE,Ys.PhysicalPixelRendering,!0)):(r.set(Xr.ANIMATING,Ys.HighResolutionShadows,!0),r.set(Xr.INTERACTING,Ys.HighResolutionShadows,!0)),r.set(Xr.IDLE,Ys.HighResolutionShadows,!0),r.set(Xr.IDLE,Ys.HighResolutionVoxel,!0),r}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(Ys||(Ys={}));let fs=class extends Pe{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=Gye,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:r=>this._devicePixelRatioOverride=r,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(r){this.viewStateManager._idleTimeout=r?Gye:0}},this._propertiesPool=new f_({frustum:Av},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new U0t}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([jo(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),pe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,r)=>this._cameraChangedHandler(e,r),ei)]),up(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([FT({prepare:()=>this._prepareFrame()}),pe(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(tF)}),jo(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Me(this._propertiesPool)}get camera(){const e=this._get("camera");if(!this.ready)return e;const r=sA(this.view,this.view.state.camera,sq);return r&&e&&r.equals(e)?e:r.clone()}set camera(e){var r,i;this._updatePropertyBeforeReady("camera",e)||((r=this.view.elevationProvider)==null||r.enableCache(!0),this.setStateCamera(_0(this.view,e),{applyConstraints:!1})||K.getLogger(this).error("#camera=","Invalid camera",e),(i=this.view.elevationProvider)==null||i.enableCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const r=sA(this.view,this.view.state.contentCamera,sq);return r&&e&&r.equals(e)?e:r.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const r=_0(this.view,e);r!=null?(this._updateElevation(r),this.view.state.contentCamera=r):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(oq),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const r=this.zoom,i=this.view.state.camera.distance**2,n=Ka(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([pe(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(oq),this.test.contentCameraResetState.clear())}),pe(()=>this.zoom,o=>{o!==void 0&&r!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-r)/2),Math.abs(o-r)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),pe(()=>this.view.state.camera,o=>{const a=ca(n,o.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],oq),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var r;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():K.getLogger(this).error("#center=","Invalid center",e):K.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):K.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,r=Y$e(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return r??this._get("extent")}set extent(e){var r;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||K.getLogger(this).error("#extent=","Invalid extent",e):K.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):K.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){var r;const e=this.view.map;return e&&"initialViewProperties"in e?(r=e.initialViewProperties)==null?void 0:r.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return e2(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||K.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,r=e.padding,i=e.pixelRatio,n=this._get("padding"),s=Math.round(r[or.TOP]/i),o=Math.round(r[or.RIGHT]/i),a=Math.round(r[or.BOTTOM]/i),l=Math.round(r[or.LEFT]/i);return n!=null&&n.top===s&&n.right===o&&n.bottom===a&&n.left===l?n:{top:s,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,eF),this.view.state.updateCamera(r=>r.padding=eF))}_paddingToArray(e,r,i){e?pn(i,e.top||0,e.right||0,e.bottom||0,e.left||0):pn(i,0,0,0,0);for(let n=0;n<4;n++)i[n]=Math.round(i[n]*r)}get screenCenter(){const e=this.padding;return lp((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?S0t(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var r;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||K.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const i=e.camera!=null?e.camera.position:e.targetGeometry,n=i!=null&&i.spatialReference;K.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(n?n.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e)}else K.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?Wlt(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||K.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){var n;if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),r=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*r),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*r);const i=(n=this.view._stage.renderView.renderingContext)==null?void 0:n.parameters.maxTextureSize;return i&&QS(this._tmpCanvasSize,i),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:r,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,r;return((r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer.isFeatureEnabled(Ys.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var r,i;const e=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer;return e&&(e.isFeatureEnabled(Ys.PhysicalPixelRendering,Xr.IDLE)||e.isFeatureEnabled(Ys.PhysicalPixelRendering,Xr.INTERACTING)||e.isFeatureEnabled(Ys.PhysicalPixelRendering,Xr.ANIMATING))}preinit(e){var r,i,n;return!(this._isOverridden("center")&&!tC(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!tC(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!tC(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||tC((r=this.viewpoint.targetGeometry)==null?void 0:r.spatialReference,e)&&tC((n=(i=this.viewpoint.camera)==null?void 0:i.position)==null?void 0:n.spatialReference,e))}init(){this._constraintsManager=new ZR({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const r of e)this.set(r.name,r.value);if(!this._cameraSetByUser){const r=this._initialViewpoint||this.view.initialExtent;r&&this.isCompatible(r)?this._setInitialView(r):this.view.state.viewingMode===Fe.Local&&this.addHandles(up(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(tF),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),tF)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(tF),this._constraintsManager=Me(this._constraintsManager))}async goTo(e,r){const i={animate:!0,...r};return this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new k0t(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(P2(this.view),{applyConstraints:!1})}step(e){const r=this.view.state,i=r==null?void 0:r.cameraController;i&&(r.updateCamera(n=>i.stepController(e,n)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,r=[];for(const{propertyName:i,overrides:n}of V0t){const s=e.has(i),o=this._isOverridden(i);!s&&o&&r.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||o)&&n.forEach(a=>e.add(a))}return r}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof Hh)return void this.setStateCamera(_0(this.view,e),{applyConstraints:!1});if(e instanceof dm){if(e.targetGeometry instanceof br){const s=P6(this.view,e.targetGeometry,0,.5,Fa.LOCKED);return void(s!=null&&this.setStateCamera(_0(this.view,s),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},n=this._viewpointToCamera(e);return void this.setStateCamera(n,i)}const r=P6(this.view,e,0,.5,Fa.LOCKED);r!=null&&this.setStateCamera(_0(this.view,r),{applyConstraints:!0})}_updatePropertyBeforeReady(e,r){return!this.ready&&(this._override(e,r),r&&z0t.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof dm?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Hh?this.isCompatible(e.position):e.spatialReference&&!JAe(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=B0t){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,r,i=c1){const{heading:n,tilt:s}=this._getPreservingHeadingTilt(),o=Ioe(this.view,n,s,e,r,Fa.ADJUST);return o==null?null:(i.copyFrom(this.view.state.camera),i.eye=o.eye,i.center=o.center,i.up=o.up,i)}_centerToCamera(e){const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:r,tilt:i}=this._getPreservingHeadingTilt(),n=P6(this.view,e,r,i,Fa.ADJUST,sq);return n?_0(this.view,n):null}_scaleToCamera(e){if(e==null)return null;const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.renderLocation,n=r.location.latitude,s=M7(this.view,e,n);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera(Q$e(this.view,e))}_viewpointToCamera(e){return _0(this.view,y0t(this.view,e))}setStateCamera(e,r){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,r.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{r.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),r.applyConstraints&&os(this.view,i)}),r.applyConstraints||(this.view.state.cameraController=new II({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:r}=this.view;if(!e||!r)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._computeCanvasSize();if(i.width!==0&&i.height!==0&&(r.width===i.width&&r.height===i.height||(r.width=i.width,r.height=i.height),this.view.state)){const n=this.view.state.camera;n.fullWidth===i.width&&n.fullHeight===i.height&&n.pixelRatio===i.pixelRatio||(c1.copyFrom(n),c1.pixelRatio!==i.pixelRatio&&(this._paddingToArray(this.padding,i.pixelRatio,eF),c1.padding=eF),c1.fullWidth=i.width,c1.fullHeight=i.height,c1.pixelRatio=i.pixelRatio,this.view.state.camera=c1),this._updateViewState()}}_updateElevation(e){var s,o;const r=(s=this.view.basemapTerrain)==null?void 0:s.spatialReference,i=((o=this.view.renderCoordsHelper)==null?void 0:o.getAltitude(e.eye))??0,n=r?O7(this.view,e.eye):0;e.relativeElevation=i-n}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Xr.ANIMATING:this.view.interacting?this.view.state.mode=Xr.INTERACTING:(this.view.state.mode===Xr.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=Xr.INTERACTING:this.view.state.mode=Xr.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,r){e&&r&&e.almostEquals(r)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};d([m({type:Hh,dependsOn:["view.state.camera","ready"]})],fs.prototype,"camera",null),d([m({type:Hh,dependsOn:["view.state.contentCamera","ready"]})],fs.prototype,"contentCamera",null),d([m({type:He})],fs.prototype,"center",null),d([m({type:br})],fs.prototype,"extent",null),d([m({readOnly:!0})],fs.prototype,"frustum",null),d([m()],fs.prototype,"_constraintsManager",void 0),d([m({readOnly:!0})],fs.prototype,"constraintsManager",null),d([m()],fs.prototype,"_initialViewpoint",null),d([m({readOnly:!0})],fs.prototype,"hasInitialView",null),d([m({readOnly:!0,type:Boolean})],fs.prototype,"ready",void 0),d([m({type:Number})],fs.prototype,"scale",null),d([m()],fs.prototype,"padding",null),d([m({readOnly:!0})],fs.prototype,"screenCenter",null),d([m({constructOnly:!0})],fs.prototype,"view",void 0),d([m({type:dm})],fs.prototype,"viewpoint",null),d([m({type:Number})],fs.prototype,"zoom",null),d([m({readOnly:!0})],fs.prototype,"_rasterPixelRatio",null),d([m({readOnly:!0})],fs.prototype,"_usePhysicalPixelRendering",null),d([m({readOnly:!0})],fs.prototype,"_usePhysicalPixelRenderingAny",null),d([m()],fs.prototype,"_windowDevicePixelRatio",void 0),d([m()],fs.prototype,"_devicePixelRatioOverride",void 0),fs=d([F("esri.views.3d.state.ViewStateManager")],fs);let U0t=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const z0t=new Set(["camera","viewpoint","extent","scale","center","zoom"]),V0t=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],B0t={heading:0,tilt:0},sq=new Hh,c1=new st,eF=tr(),tF="pending-initial-view",oq="content-camera-reset",Gye=300,jye=100;let zg=class extends C0{constructor(){super(...arguments),this.startCamera=new st,this.currentCamera=new st,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<jye}stepController(e,r){r.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(r)}onControllerStart(e){this.state=dn.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),jye),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};d([m({readOnly:!0})],zg.prototype,"isInteractive",null),d([m()],zg.prototype,"_lastInteraction",void 0),zg=d([F("esri.views.3d.state.controllers.InteractiveController")],zg);var du;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(du||(du={}));let LI=class extends zg{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=du.CENTER,this._rotScale=0,this._lastPoint=Ye(),this._tmpWorldUp=C(),this._tmpViewDir=C(),this._tmpRotCurPoint=Ye(),this._tmpTransf=xe(),this._tmpAxis=C(),this._tmpPivotPoint=C(),this._pivotPos=C(),this._constraintOptions=new wp(Xi.ALL,cr.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===du.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case du.EYE:he(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=cr.LOOK_AROUND,this._constraintOptions.tiltMode=my.LOOK_AROUND,this._constraintOptions.selection=Xi.NONE;break;case du.CENTER:{const r=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?I2:{});r||he(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,r),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=cr.TUMBLE,this._constraintOptions.tiltMode=my.TUMBLE,this._constraintOptions.selection=Xi.ALL&~Xi.DISTANCE;break}}wT(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,r){const i=this.startCamera,n=C();_e(n,this._pivotPos,i.eye);const s=Te(n),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,Hye);let a=Math.max(Math.min(Wyt,1/Math.abs(fe(Hye,i.viewForward)))*o,Yyt);r&&(a=Math.min(s,a));const l=zr(this.view.spatialReference),c=Sn(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),u=eG(this.startCamera,c,l);let h=this.view._stage.renderView.getMinimalDepthForArea(vD(this.view),i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*JH,JH),p=this.view._stage.renderView.getMinimalDepthForArea(vD(this.view),e[0],e[1],i,JH);h==null&&p==null||(h=h??p??0,p=p==null||u===Bo.Horizontal?h:p,a=h>p?p:h,a=r?Math.min(a,s):a),me(n,n),he(this._pivotPos,ge(this._tmpPivotPoint,i.eye,oe(this._tmpPivotPoint,n,a)))}update(e){if(this.active){switch(this.pivot){case du.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case du.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}os(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,r,i,n){this.view.renderCoordsHelper.worldUpAtPosition(n,this._tmpWorldUp),wT(e,r,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;_e(this._tmpViewDir,i,n);const a=Te(this._tmpViewDir),l=_o(fe(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===du.EYE){s*=-.5;const c=.5*Math.PI-l,u=.5*Math.PI*.99;s=c-Math.max(-u,Math.min(u,c+s))}return s=we(s+l,Oa.min,Oa.max)-l,it(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===du.CENTER&&(o=-o),Gu(this._tmpTransf,o,this._tmpWorldUp),Ou(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),ze(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=ze(aq,e.up,this._tmpTransf),ge(aq,n,this._tmpViewDir),vo(this._lastPoint,this._tmpRotCurPoint),aq}};d([m()],LI.prototype,"pivot",void 0),LI=d([F("esri.views.3d.state.controllers.RotateController")],LI);const aq=C(),Hye=C();let lq=class extends va{constructor(e,r,i,n){super(!0),this._view=e,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",n,s=>this._handleDrag(s))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!zae(e.data,this.pointerAction))return;const i=Sn(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new LI({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},Oee=class extends zg{constructor(){super(...arguments),this._pickPoint=C(),this._tmpP0=Ye(),this._panAxisAngle=Q7(),this._tmpRayDir=C(),this._tmpRayDirPick=C(),this._targetOnSphere=C(),this._navMode=Bo.Horizontal,this._tmpRay={origin:C(),direction:C()},this.dragBeginPoint=Sn(),this._normalizedAnchorPoint=Ye(),this._constraintOptions=new wp(Xi.ALL_EXCEPT_COLLISION,cr.ZOOM,0,this.startCamera),this._sphere=hs(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;vo(this.dragBeginPoint,e),wT(this.startCamera,e,this._normalizedAnchorPoint);const r=zr(this.view.spatialReference),i=NNe(this._intersectionHelper,this.startCamera,e,r,dA.Ellipsoid,this.view.map.ground.opacity===0?I2:{});if(this._navMode=eG(this.startCamera,e,r),this._navMode===Bo.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=i.scenePickPoint??this._pickPoint,this._sphere=i.sphere;else{let n;oO(this.startCamera,e,this._tmpRay),me(this._tmpRay.direction,this._tmpRay.direction),i.scenePickPoint!=null&&(_e(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),n=Te(this._tmpRayDirPick));const s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,qye);let o=we(Math.min(ANe,1/Math.abs(fe(qye,this._tmpRay.direction)))*s,w9[0],w9[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,K7);o=a??o,o=n!=null?Math.min(o,n):o,this._hasPickPoint=!0,oe(this._tmpRay.direction,this._tmpRay.direction,o),ge(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Bo.Horizontal){_e(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const r=Te(this._tmpRayDir);wT(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=r*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&n<s&&(n=s),Math.abs(r-n)<1e-6)return;if(this._hasPickPoint&&n<r){const o=1-(1-n/r)*(1-this._sphere[3]/Te(this.currentCamera.center));this.currentCamera.center=oe(rF,this.currentCamera.center,o)}oe(this._tmpRayDir,this._tmpRayDir,-n/r),this.currentCamera.eye=ge(rF,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Of($b(this.dragBeginPoint,e)),os(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(_D(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),Iae(this._pickPoint,this._targetOnSphere,this._panAxisAngle),jb(this.currentCamera,this._sphere,this._panAxisAngle))}else{const r=Te(this._tmpRay.direction);wT(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=r*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&n<s&&(n=s),Math.abs(r-n)<1e-6)return;oe(this._tmpRayDir,this._tmpRay.direction,1-n/r),this.currentCamera.eye=ge(rF,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=ge(rF,this.currentCamera.center,this._tmpRayDir)}sO(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};Oee=d([F("esri.views.3d.state.controllers.global.ZoomController")],Oee);const rF=C(),qye=C();let Mee=class extends zg{constructor(){super(...arguments),this._tmpP=C(),this._tmpDir=C(),this._tmpN=C(),this._tmpP0=Ye(),this._tmpPoi=C(),this._tmpRayDir=C(),this.dragBeginPoint=Sn(),this._normalizedAnchorPoint=Ye(),this._constraintOptions=new wp(Xi.ALL,cr.ZOOM,0,this.startCamera,C()),this._plane=Yr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;vo(this.dragBeginPoint,e),wT(this.startCamera,e,this._normalizedAnchorPoint);const r=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?I2:{});_e(this._tmpDir,this._tmpP,this.startCamera.eye);const i=Te(this._tmpDir);me(this._tmpDir,this._tmpDir);const n=Math.abs(this.view.camera.position.z);let s=we(Math.min(ANe,1/Math.abs(fe(G0t,this._tmpDir)))*n,w9[0],w9[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(vD(this.view),e[0],e[1],this.view.state.camera,K7);s=o??s,s=r?Math.min(s,i):s,oe(this._tmpDir,this._tmpDir,s),ge(this._tmpP,this.startCamera.eye,this._tmpDir),_e(this._tmpN,this.startCamera.eye,this.startCamera.center),me(this._tmpN,this._tmpN),this._tmpN[1]<0&&ua(this._tmpN,this._tmpN),dN(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.active)return;Xyt(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||he(this._tmpPoi,this.currentCamera.center),wT(this.currentCamera,e,this._tmpP0);let r=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);vo(this._normalizedAnchorPoint,this._tmpP0),_e(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=Te(this._tmpRayDir);let n=i*(1-r);this._constraintOptions.interactionDirection&&(he(this._constraintOptions.interactionDirection,this._tmpRayDir),oe(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(r)/i));const s=this.view.state.constraints.minimumPoiDistance;r>=0&&n<s&&(n=s,r=-(n-i)/i),Math.abs(i-n)<1e-6||(oe(this._tmpRayDir,this._tmpRayDir,r),this.currentCamera.eye=ge(zw,this.currentCamera.eye,this._tmpRayDir),pi(zw,this.currentCamera.center,this._tmpPoi,r),this._tmpPoi[2]>this.startCamera.center[2]?zw[2]=Math.max(this.startCamera.center[2],zw[2]):zw[2]=Math.min(this.startCamera.center[2],zw[2]),this.currentCamera.center=zw,this._constraintOptions.interactionFactor=Of($b(this.dragBeginPoint,e)),os(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};Mee=d([F("esri.views.3d.state.controllers.local.ZoomController")],Mee);const zw=C(),G0t=Ce(0,0,1);let j0t=class extends va{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this.registerIncoming("drag",i,n=>this._handleDrag(n))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!zae(e.data,this.pointerAction))return;const i=Sn(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new Oee({view:this._view}):this._cameraController=new Mee({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function $p(t){let e=t*t;return t<0&&(e*=-1),e}function Wye(t,e,r){const i=r,n=t.state,s=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return s.deviceType==="standard"?(i.translation[0]=$p(n.axes[0]),i.translation[1]=$p(n.axes[1]),i.translation[2]=$p(n.buttons[7])-$p(n.buttons[6]),i.heading=$p(n.axes[2]),i.tilt=$p(n.axes[3])):s.deviceType==="spacemouse"&&(i.translation[0]=1.2*$p(n.axes[0]),i.translation[1]=1.2*$p(n.axes[1]),i.translation[2]=2*-$p(n.axes[2]),i.heading=1.2*$p(n.axes[5]),i.tilt=1.2*$p(n.axes[3])),i.tilt*=o,oe(i.translation,i.translation,a),i}function Yye(t,e){const r=e;return r.translation[0]=t[1]-t[0],r.translation[1]=t[3]-t[2],r.translation[2]=t[4]-t[5],r.heading=t[7]-t[6],r.tilt=t[8]-t[9],r.zoom=t[10]-t[11],r}function cq(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let KS=class extends zg{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new st,this._headingStart=0,this._constraintOptions=new wp(Xi.ALL,cr.NONE,0,new st,null,my.LOOK_AROUND)}handleEventGamepad(e){const r=Wye(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||cq(r))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,Yye(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const r=Yye(this._keysButtonState,this._transformation);cq(r)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const r=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(r-this._filteredSurfaceElevation)*e}stepController(e,r){var i;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(r),this._updateCameraCenter(),(i=this._constraintOptions.interactionStartCamera)==null||i.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Vw),this._applyDisabledMovementTypes(Vw),this._applyPan(Vw.pan),this._applyRotate(Vw.rotate),this._applyZoom(Vw.zoom),this._applyAscend(Vw.ascend),this._constraintOptions.interactionType=cr.NONE,this._constraintOptions.selection=Xi.COLLISION,os(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,r)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const r=this.currentCamera;_e(nc,r.center,r.eye),ze(nc,nc,e.matrix),r.center=ge(nc,nc,r.eye),r.up=ze(nc,r.up,e.matrix),this._constraintOptions.interactionType=cr.LOOK_AROUND,this._constraintOptions.selection=Xi.ALL_EXCEPT_COLLISION,os(this.view,r,this._constraintOptions)}_applyPan(e,r=this.currentCamera){e.enabled&&(r.eye=ze(nc,r.eye,e.matrix),r.center=ze(nc,r.center,e.matrix),this.view.state.isGlobal&&(r.up=ze(nc,r.up,e.matrix)),this._constraintOptions.interactionType=cr.PAN,this._constraintOptions.selection=Xi.ALL,os(this.view,r,this._constraintOptions))}_applyZoom(e){if(!e)return;const r=this.currentCamera.viewForward;this.currentCamera.eye=ge(nc,this.currentCamera.eye,oe(je.get(),r,e)),he(uM,r),ua(uM,uM),this._constraintOptions.interactionDirection=uM,this._constraintOptions.interactionType=cr.ZOOM,this._constraintOptions.selection=Xi.ALL_EXCEPT_COLLISION,os(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const r=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,je.get());if(this._constraintOptions.interactionDirection=he(uM,r),this.view.state.isGlobal){const i=Te(this.currentCamera.eye),n=(i+e)/i;this.currentCamera.eye=oe(nc,this.currentCamera.eye,n),this.currentCamera.center=oe(nc,this.currentCamera.center,n)}else{const i=oe(je.get(),r,e);this.currentCamera.eye=ge(nc,this.currentCamera.eye,i),this.currentCamera.center=ge(nc,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=cr.ASCEND,this._constraintOptions.selection=Xi.COLLISION,os(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Xi.ALL_EXCEPT_COLLISION,os(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,r,i){J0t(i);const n=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(n,r,i):this._calculateControlTransformationGlobal(n,r,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,r=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=r.intersectManifoldClosestSilhouette(i,e,nc)}_calculateControlTransformationLocal(e,r,i){const{viewRight:n,viewForward:s}=r,o=this._transformation,a=this.view.navigation.gamepad,l=se(je.get(),s[0],s[1],0);me(l,l);const c=o.translation[0]*e.pan;if(c!==0){const y=oe(je.get(),n,c);Fc(i.pan.matrix,i.pan.matrix,y),i.pan.enabled=!0}switch(a.mode){case"pan":{const y=-o.translation[1]*e.pan;if(y!==0){const v=oe(je.get(),l,y);Fc(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=o.zoom*e.zoom;break}case"zoom":i.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const u=o.translation[2]*e.ascend;i.ascend=u;const h=-o.heading*e.rotate;h!==0&&(Ou(i.rotate.matrix,i.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(r.eye,je.get())),i.rotate.enabled=!0);const p=o.tilt*e.rotate,f=Gb(this.view.renderCoordsHelper,r.center,r.eye),g=we(f+p,Oa.min,Oa.max)-f;g&&(Ou(i.rotate.matrix,i.rotate.matrix,g,n),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,r,i){const{eye:n,viewRight:s}=r,o=this._transformation,a=this.view.navigation.gamepad,l=it(je.get(),s,n);me(l,l),ua(l,l),t0t(this.startCamera,r,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Vw.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=o.translation[2]*e.ascend;i.ascend=u;const h=-o.heading*e.rotate;h!==0&&(Ou(i.rotate.matrix,i.rotate.matrix,h,this._tmpCamera.eye),i.rotate.enabled=!0);const p=o.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(p,r.ray,c);f!==0&&(Ou(i.rotate.matrix,i.rotate.matrix,f,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,r,i){const n=zr(this.view.spatialReference),s=c8(Oa.min,r.origin,i,n);let o=0,a=0;const l=je.get();if(this.view.renderCoordsHelper.intersectManifold(r,i,l)){const c=Gb(this.view.renderCoordsHelper,l,r.origin);o=c8(c,r.origin,i,n),a=c8(Oa.max,r.origin,i,n)}else{QA(x7(S7,i+n.radius),r,l);const c=Math.PI+zB(r.direction,l);o=Mye(c,r.origin,i,n),a=Mye(Oa.max,r.origin,i,n)}return we(o+e,s,a)-o}_getPointAbsoluteSurfaceElevation(e,r,i){const{renderCoordsHelper:n}=this.view,s=n.getAltitude(e),o=r+Math.abs(s-r);return n.setAltitude(i,o,e),o}_clampedDistanceToSurface(e,r){const{renderCoordsHelper:i}=this.view,{camera:n}=this.view.state,{direction:s}=klt(this.view,r,0,XNe,Z0t),o=i.intersectManifoldClosestSilhouette(Wh(r,s),e,je.get()),a=Bi(r,o),l=i.intersectManifoldClosestSilhouette(Wh(r,x_(je.get(),r,n.center)),e,je.get()),c=Bi(r,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:r,state:i}=this.view,{camera:n,isGlobal:s}=i,o=r.intersectManifoldClosestSilhouette(n.ray,this._filteredSurfaceElevation,je.get());if(s){const a=_e(je.get(),e,o),l=Te(a);oe(a,a,1/l);const c=me(je.get(),e),u=_o(fe(c,a));return l*Math.sin(Math.min(q0t,u))}{const a=he(je.get(),e);return r.setAltitude(a,this._filteredSurfaceElevation),Bi(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:W0t}_computeVelocities(e){const r=this._filteredSurfaceElevation,i=r+zr(this.view.spatialReference).radius,{camera:n,isGlobal:s}=this.view.state,o=je.get(),a=this._getPointAbsoluteSurfaceElevation(n.eye,r,o),l=this._clampedDistanceToSurface(r,o),c=n.width/2,u=Xye*n.width,h=Xye*n.width,p=l*Math.tan(.5*n.fovX)/c,f=p/i,g=p/this._computeHeadingRotateRadius(o),y=a-r;return{pan:(s?f:p)*u*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(u*e/c)*y-y),zoom:2**(u*e/c)*l-l,rotate:we(g*h,Y0t,X0t)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&cp(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&cp(e.rotate.matrix))}static activatesFor(e,r){const i=Wye(r,e.navigation.gamepad,H0t);return!(r.action==="end"||cq(i))}};d([m({constructOnly:!0})],KS.prototype,"gamepadDevice",void 0),d([m({constructOnly:!0})],KS.prototype,"disableMovements",void 0),KS=d([F("esri.views.3d.state.controllers.GamepadKeyboardController")],KS);const H0t={translation:[0,0,0],heading:0,tilt:0,zoom:0},XNe=80,q0t=Ut(XNe),Xye=.75,W0t=5,Y0t=Ut(30),X0t=Ut(80),Vw={zoom:0,ascend:0,pan:{enabled:!1,matrix:xe()},rotate:{enabled:!1,matrix:xe()}},nc=C(),uM=C(),Z0t=Roe();function J0t(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,cp(t.pan.matrix),t.rotate.enabled=!1,cp(t.rotate.matrix)}let Q0t=class extends va{constructor(e){super(!0),this._view=e,this._watchHandles=new iw,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([pe(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},mi),pe(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const r=this._view.navigation.gamepad.device;if(r&&e.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||KS.activatesFor(this._view,e.data)){if(!i){const n=new KS({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(n)&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};function K0t(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),{remove:()=>document.addEventListener("visibilitychange",e)}}var nu;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(nu||(nu={}));let e_t=class extends va{constructor(e,r){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Fe.Local},this._keyToNumber={[r.left]:nu.LEFT,[r.right]:nu.RIGHT,[r.forward]:nu.FORWARD,[r.backward]:nu.BACKWARD,[r.up]:nu.UP,[r.down]:nu.DOWN,[r.headingLeft]:nu.HEADINGLEFT,[r.headingRight]:nu.HEADINGRIGHT,[r.tiltUp]:nu.TILTUP,[r.tiltDown]:nu.TILTDOWN,[r.zoomIn]:nu.ZOOMIN,[r.zoomOut]:nu.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=K0t(i=>i?null:this._handleStop())}onUninstall(){var e;(e=this._visibilityHandle)==null||e.remove(),this._handleStop()}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new KS({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),e.stopPropagation()))}_handleStop(){var e;(e=this._cameraControllerKeyboard)!=null&&e.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),e.stopPropagation())}},t_t=class extends va{constructor(e,r){super(!0),this._view=e,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new E9({view:this._view,mode:"interaction"}):new C9({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,Sn(r.x,r.y)),e.preventDefault(),e.stopPropagation()}},M9=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},n2=class extends gD{constructor(){super(...arguments),this._beginCamera=new st,this._elapsedTimeSec=0,this.constraintOptions=new wp(Xi.ALL,cr.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new aA}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,r){r.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,r),os(this.view,r,this.constraintOptions)}};n2=d([F("esri.views.3d.state.controllers.momentum.MomentumController")],n2);let DI=class extends n2{constructor(e){super(e),this.interactionType=cr.PAN,this._tmpPan=C()}momentumStep(e,r){const i=this.momentum.value(e);oe(this._tmpPan,this.momentum.direction,i),r.eye=_e(Zye,r.eye,this._tmpPan),r.center=_e(Zye,r.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};d([m({constructOnly:!0})],DI.prototype,"momentum",void 0),DI=d([F("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],DI);const Zye=C(),r_t=C(),iF=C();let p8=class extends n2{constructor(e){super(e),this.interactionType=cr.PAN}momentumStep(e,r){const i=this.momentum.value1(e),n=this.momentum.value2(e);he(iF,r.eye),me(iF,iF),it(this.momentum.axis2,iF,this.momentum.axis1),zNe(r,r_t,this.momentum.axis1,i,this.momentum.axis2,n)}};d([m({constructOnly:!0})],p8.prototype,"momentum",void 0),p8=d([F("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],p8);let CS=class extends n2{set center(e){this._set("center",nn(e))}set axis(e){this._set("axis",nn(e))}constructor(e){super(e),this.interactionType=cr.TUMBLE}momentumStep(e,r){const i=this.momentum.value(e);jb(r,this.center,yD(this.axis,i))}};d([m({constructOnly:!0})],CS.prototype,"momentum",void 0),d([m({constructOnly:!0})],CS.prototype,"center",null),d([m({constructOnly:!0})],CS.prototype,"axis",null),CS=d([F("esri.views.3d.state.controllers.momentum.MomentumController")],CS);let u3=class extends n2{set zoomCenter(e){this._set("zoomCenter",nn(e))}constructor(e){super(e),this.interactionType=cr.ZOOM,this.constraintOptions.interactionDirection=C()}momentumStep(e,r){const{interactionDirection:i}=this.constraintOptions;if(!i)return;he(i,r.eye);const n=this.momentum.valueDelta(0,e);Fae(r,this.zoomCenter,n,this.view.state.constraints.minimumPoiDistance),x_(i,r.eye,i)}};d([m({constructOnly:!0})],u3.prototype,"momentum",void 0),d([m({constructOnly:!0})],u3.prototype,"zoomCenter",null),u3=d([F("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],u3);let Yx=class extends n2{set screenCenter(e){this._set("screenCenter",Sn(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",nn(e))}constructor(e){super(e),this.interactionType=cr.ZOOM,this.radius=0,this._tmpSceneCenter=C(),this._tmpZoomAxisAngle=Q7(),this._sphere=hs()}initialize(){this._sphere[3]=this.radius}momentumStep(e,r){const i=this.momentum.valueDelta(0,e);LNe(this._sphere,r,i),this.constraintOptions.interactionType=cr.ZOOM,os(this.view,r,this.constraintOptions),_D(this._sphere,r,this.screenCenter,this._tmpSceneCenter),Iae(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),jb(r,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=cr.PAN}};d([m({constructOnly:!0})],Yx.prototype,"momentum",void 0),d([m({constructOnly:!0})],Yx.prototype,"screenCenter",null),d([m({constructOnly:!0})],Yx.prototype,"sceneCenter",null),d([m({constructOnly:!0})],Yx.prototype,"radius",void 0),Yx=d([F("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Yx);let Mf=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const r=this.computeDelta(e);this._updateDelta(r)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},rG=class{constructor(e,r,i){this._initialVelocity=e,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,r){const i=this.value(e);return this.value(e+r)-i}valueFromInitialVelocity(e,r){r=Math.min(r,this.duration);const i=1-this.friction;return e*(i**r-1)/Math.log(i)}},i_t=class extends rG{constructor(e,r,i,n,s){super(e,r,i),this._sceneVelocity=n,this.direction=s}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},ZNe=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new Mf(.6),this._screen=[new Mf(.4),new Mf(.4)],this._scene=[new Mf(.6),new Mf(.6),new Mf(.6)],this._tmpDirection=C()}add(e,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?0:Math.sqrt(e*e+r*r),n=this._time.filteredDelta,s=n==null||i==null?0:i/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,r,i){se(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=Te(this._tmpDirection);n>0&&oe(this._tmpDirection,this._tmpDirection,1/n);const s=this._time.filteredDelta;return new i_t(e,r,i,s==null?0:n/s,this._tmpDirection)}},Jye=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const Qye=1e-5;let n_t=class extends rG{constructor(e,r,i,n,s,o=0,a){super(e,r,i),this._angularVelocity1=n,this.axis1=s,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},s_t=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=C(),this._tmpAxis2=C(),this._tmpAngles=Ye(),this._time=new Mf(.3),this._screen=[new Mf(.4),new Mf(.4)],this._angle1=new Jye(.6),this._angle2=new Jye(.6),this._axis1=C(),this._axis2=C(),this._lastScene=C()}addMomentumDirectRotation(e,r,i,n,s,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=kNe(this._lastScene,r,this._tmpAxis2,n,s,o);this._angle2.update(0),nl(this._tmpAxis2)<Qye?a=0:me(this._axis1,this._tmpAxis2),this._angle1.update(a),he(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,r,i,n,s,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;UNe(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,n,s,o,a,!1),nl(this._tmpAxis2)<Qye?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),me(this._axis1,this._tmpAxis1),me(this._axis2,this._tmpAxis2)),he(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?null:Math.sqrt(e*e+r*r),n=this._time.filteredDelta,s=i==null||n==null?0:i/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,r,i){const n=this._time.filteredDelta,s=this._angle1.filteredValue,o=this._angle2.filteredValue,a=n==null||o==null?0:o/n;return new n_t(e,r,i,n==null||s==null?0:s/n,this._axis1,a,this._axis2)}},JNe=class{constructor(e=2.5,r=.01,i=.95,n=12){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this._maxVelocity=n,this.enabled=!0,this.value=new Mf(.8),this.time=new Mf(.3)}add(e,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=we(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,r,i){return new rG(e,r,i)}},QNe=class extends JNe{constructor(e=3,r=.01,i=.95,n=12){super(e,r,i,n)}add(e,r){const i=this.value.lastValue;if(i!=null){let n=e-i;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;e=i+n}super.add(e,r)}},o_t=class extends rG{constructor(e,r,i){super(e,r,i)}value(e){const r=super.value(e);return Math.exp(r)}valueDelta(e,r){const i=super.value(e),n=super.value(e+r)-i;return Math.exp(n)}},KNe=class extends JNe{constructor(e=2.5,r=.01,i=.95,n=12){super(e,r,i,n)}add(e,r){super.add(Math.log(e),r)}createMomentum(e,r,i){return new o_t(e,r,i)}},Ree=class extends zg{constructor(){super(...arguments),this._smoothRotation=new M9(.05),this._rotationAxis=C(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Yr(),this._beginRadius=0,this._smoothScaling=new M9(.05),this._zoomCenterScreen=Sn(),this._zoomMomentumEstimator=new KNe,this._rotationMomentumEstimator=new QNe,this._panSphericalMomentumEstimator=new s_t,this._panPlanarMomentumEstimator=new ZNe,this._adjustedSphere=hs(),this._tmp3d=C(),this._tmpScreenPointArray=Sn(),this._beginScreenPoint=Sn(),this._beginScenePoint=C(),this._screenPickPoint=Sn(),this._scenePickPoint=C(),this._mode=Bo.Horizontal,this._sphere=hs(),this._pointerCount=0,this._tmpInteractionDirection=C(),this._beginCamera=new st,this._constraintOptions=new wp(Xi.ALL,cr.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-Db.normalize(Ut(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),$f(e.center,this._screenPickPoint),vo(this._beginScreenPoint,this._screenPickPoint);const r=zr(this.view.spatialReference),i=NNe(this._intersectionHelper,this.startCamera,this._screenPickPoint,r,dA.Silhouette,this.view.map.ground.opacity===0?I2:{});i.scenePickPoint!=null&&(this._scenePickPoint=i.scenePickPoint,this._sphere=i.sphere,he(this._beginScenePoint,this._scenePickPoint),this._mode=eG(this.startCamera,this._screenPickPoint,r),this._mode===Bo.Vertical&&this._preparePlanarPanMode(e,i.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1;this._mode===Bo.Horizontal?(r&&this._zoomSpherical(e),this._panningSpherical(e),r&&this._rotateSpherical(e)):(r&&this._zoomPlanar(e),this._panningPlanar(e),r&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return this._mode===Bo.Horizontal?new Yx({view:this.view,momentum:r,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new u3({view:this.view,momentum:r,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new CS({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===Bo.Horizontal){const n=this._panSphericalMomentumEstimator.evaluateMomentum();if(n)return new p8({view:this.view,momentum:n})}else{const n=this._panPlanarMomentumEstimator.evaluateMomentum();if(n)return new DI({view:this.view,momentum:n})}return null}_preparePlanarPanMode(e,r){const i=ua(this._tmp3d,this.startCamera.viewForward);dN(this._scenePickPoint,i,this._panningPlane);const n=Sn(this._screenPickPoint[0],0),s=C(),o=Te(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],_D(this._adjustedSphere,this.startCamera,n,s);const a=Na();this.startCamera.projectToRenderScreen(s,a);const l=C(),c=C(),u=C();_e(l,this._scenePickPoint,this.currentCamera.eye);const h=Te(l);me(l,l);const p=$Ne*Math.max(Math.abs(this.view.camera.position.z),INe),f=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,K7);let g=f??p;g=r?Math.min(g,h):g,he(u,ge(c,this.currentCamera.eye,oe(c,l,g))),this._panningPlane[3]=-fe(this._panningPlane,u),this.startCamera.center=ge(c,this.startCamera.eye,oe(c,this.startCamera.viewForward,g));const y=$f(e.center,this._tmpScreenPointArray);Aee(this._panningPlane,this.startCamera,y,this._beginScenePoint)}_zoomSpherical(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),LNe(this._sphere,this.currentCamera,this._smoothScaling.value),$f(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=cr.ZOOM,this._constraintOptions.interactionFactor=Of(e.radius-this._beginRadius),os(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const r=$f(e.center,this._tmpScreenPointArray);_D(this._sphere,this.currentCamera,r,this._tmp3d),kae(this._beginScenePoint,fe(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(BNe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(VNe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=cr.PAN,this._constraintOptions.interactionFactor=Of($b(this._screenPickPoint,r)),os(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){me(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||ua(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value,i=r+Pee(e.angle-r),n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(i);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),jb(this.currentCamera,this._sphere,yD(this._rotationAxis,s)),this._constraintOptions.interactionType=cr.TUMBLE,this._constraintOptions.interactionFactor=Of(e.radius*i),os(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const r=$f(e.center,this._tmpScreenPointArray);Aee(this._panningPlane,this.currentCamera,r,this._tmp3d)&&(FNe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(r,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=cr.PAN,this._constraintOptions.interactionFactor=Of($b(this._beginScreenPoint,r)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),os(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Fae(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=cr.ZOOM,this._constraintOptions.interactionFactor=Of(e.radius-this._beginRadius),os(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){he(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||ua(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value;let i=e.angle-r;i=Pee(i);const n=r+i,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(n);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),jb(this.currentCamera,this._sphere,yD(this._rotationAxis,o)),this._constraintOptions.interactionType=cr.TUMBLE,this._constraintOptions.interactionFactor=Of(e.radius*o),os(this.view,this.currentCamera,this._constraintOptions)}};Ree=d([F("esri.views.3d.state.controllers.global.PinchAndPanController")],Ree);const Kye=Ce(0,0,1),a_t={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let $ee=class extends zg{constructor(){super(...arguments),this._rotationValueSmooth=new M9(.05),this._scalingValueSmooth=new M9(.05),this._planeHorizontal=Yr(),this._planeVertical=Yr(),this._rotationMomentumEstimator=new QNe,this._panMomentumEstimator=new ZNe(300,12,.9),this._zoomMomentumEstimator=new KNe,this._beginRadius=0,this._beginCenter=C(),this._beginAngle=0,this._tmpPoints=[],this._panMode=Bo.Horizontal,this._beginCenterScreen=Sn(),this._tmpCentroid3d=C(),this._tmpCentroid2d=Sn(),this._tmp2d=Sn(),this._pointerCount=0,this._beginCamera=new st,this._constraintOptions=new wp(Xi.ALL,cr.NONE,0,this._beginCamera)}begin(e){if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panMomentumEstimator.enabled=r,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),$f(e.center,this._beginCenterScreen),EAe(Kye,0,this._planeHorizontal);const i=C(),n=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?I2:{}),s=C();ua(s,this.startCamera.viewForward);const o=C();he(o,Kye);const a=fe(s,o),l=ap(a<0?-a:a);this._panMode=l>=a_t.ANGLE_THRESHOLD?Bo.Horizontal:Bo.Vertical;const c=Math.min($Ne,1/Math.abs(fe(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),INe);JZ(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||QZ(this._planeHorizontal,this._planeHorizontal);const u=C(),h=C(),p=C();_e(u,i,this.currentCamera.eye);const f=Te(u);if(me(u,u),this._panMode===Bo.Vertical){oe(o,o,a),_e(this._planeVertical,s,o),me(this._planeVertical,this._planeVertical),JZ(this._planeVertical,this._planeVertical,i);const g=this.view._stage.renderView.getMinimalDepthForArea(vD(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,K7);let y=g??c;y=n?Math.min(y,f):y,he(p,ge(h,this.currentCamera.eye,oe(h,u,y))),this._planeVertical[3]=-fe(this._planeVertical,p),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),QH(this._tmpPoints,this._beginCenter)}else{const g=n?f:c;he(p,ge(h,this.currentCamera.eye,oe(h,u,g))),this._planeHorizontal[3]=-fe(this._planeHorizontal,p),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),QH(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1,i=this._panMode===Bo.Horizontal?this._planeHorizontal:this._planeVertical,n=this._beginCenter;if(r){const s=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(s),Fae(this.currentCamera,n,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=cr.ZOOM,this._constraintOptions.interactionFactor=Of(Math.abs(e.radius-this._beginRadius)),os(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),QH(this._tmpPoints,this._tmpCentroid3d),$f(e.center,this._tmpCentroid2d),FNe(this.currentCamera,n,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=cr.PAN,this._constraintOptions.interactionFactor=Of($b(this._beginCenterScreen,this._tmpCentroid2d)),os(this.view,this.currentCamera,this._constraintOptions),r){const s=n,o=this._rotationValueSmooth.value,a=o+Pee(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(a);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp);const u=this._planeHorizontal;jb(this.currentCamera,s,yD(u,c)),this._constraintOptions.interactionType=cr.TUMBLE,this._constraintOptions.interactionFactor=Of(Math.abs(e.radius*c)),os(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return new u3({view:this.view,momentum:r,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new CS({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const n=this._panMomentumEstimator.evaluateMomentum();return n?new DI({view:this.view,momentum:n}):null}_computePlanePoints(e,r,i,n){n.length=e.size;const s=this._tmp2d;let o=0;return e.forEach(a=>{s[0]=a.x,s[1]=a.y,n[o]===void 0&&(n[o]=C()),Aee(r,i,s,n[o]),o+=1}),n}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};$ee=d([F("esri.views.3d.state.controllers.local.PinchAndPanController")],$ee);let e0e=class extends va{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,n=>this._handleDrag(n))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!zae(e.data,this.pointerAction))return;const r=e.timestamp-this._lastEndTimestamp,i=40,n=this._momentum&&this._momentum.active&&r<i;switch(e.data.action){case"start":case"update":if(n)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new Ree({view:this._view}):new $ee({view:this._view})}},l_t=class extends va{constructor(e,r){super(!0),this.view=e,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}},e4e=class extends va{constructor(e,r){super(!0),this.key=e,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},c_t=class extends e4e{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},u_t=class extends e4e{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},h_t=class extends va{constructor(e,r=!1){super(!0),this._view=e,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(e){var n,s,o;const r=this._invert?-1:1,i=Sn(0,e.data.delta*r);switch(e.data.action){case"begin":(n=this._cameraController)==null||n.end(),this._cameraController=new LI({view:this._view,pivot:du.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":(s=this._cameraController)==null||s.update(i);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function t0e(t){const e=t.native;return e?{buttons:e.buttons.map(r=>r.pressed?r.value||1:0),axes:e.axes.map(r=>f_t(r,t.axisThreshold))}:{buttons:[],axes:[]}}function d_t(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let r=0;r<t.axes.length;r++)if(t.axes[r]!==e.axes[r])return!1;for(let r=0;r<t.buttons.length;r++)if(t.buttons[r]!==e.buttons[r])return!1;return!0}function p_t(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function f_t(t,e){const r=Math.abs(t);return r<e?0:Math.sign(t)*(r-e)/(1-e)}let m_t=class{constructor(e,r){this._element=e,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const o=s.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,t0e(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=i&&n,this.supported&&(this._forEachGamepad(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const r=new Koe(e);r.deviceType!=="unknown"&&(this._inputDevices[e.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=FT({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(n=>{const s=this._inputDevices[n.index];if(!s)return;const o=this._latestUpdate[n.index],a=t0e(s),l=i||p_t(a);o&&(o.timestamp===n.timestamp||!o.active&&l||d_t(o.state,a))||this._emitGamepadEvent(n,a,!l)})}_forEachGamepad(e){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const n=r[i];this._validate(n)&&e(n)}}_emitGamepadEvent(e,r,i){const n=this._latestUpdate[e.index],s=n&&n.active;if(!s&&!i)return;const o=!s&&i?"start":s&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:r,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let r=0;r<e.axes.length;r++)if(isNaN(e.axes[r]))return!1;return!0}};const r0e=ne("edge"),g_t=ne("chrome"),y_t=ne("ff"),__t=ne("safari"),i0e="esri-view-surface",lE={touchNone:`${i0e}--touch-none`,touchPan:`${i0e}--touch-pan`};let t4e=class r4e{constructor(e,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new m_t(e,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Me(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const r in this._active)if(!e||!e.has(r)){const i=this._active[r];this._element.removeEventListener(uq[r],i),delete this._active[r]}e&&e.forEach(r=>{if(!this._active[r]&&uq[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(uq[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,r){r?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?lE.touchNone:lE.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?lE.touchPan:lE.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(lE.touchNone),this._element.classList.remove(lE.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,r){const i=mLe(this._element,e);return r4e.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(e,r){const{key:i}=r;i&&e==="key-up"&&this._keyDownState.delete(i);const n={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&e==="key-down"&&this._keyDownState.add(n.key),this._callback(e,n)}_handlePointer(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,r){let i=r.deltaY;switch(r.deltaMode){case 0:r0e&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}r0e?i*=.7:g_t||__t?i*=.6:y_t&&(i*=1.375);const n=100,s=Math.abs(i);s>n&&(i=i/s*200/(1+Math.exp(-.02*(s-n))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(e,o)}_handlePointerCaptureLost(e,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(e,r)}_handleDefault(e,r){const i={native:r};r.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};t4e.test={disableSubpixelCoordinates:!1};const uq={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let v_t=class extends va{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};const Oh={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function Iee(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function b_t(t,e){const r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function w_t(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:lp()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[x,S]=t,[E,P]=[S.x-x.x,S.y-x.y];return e.radius=Math.sqrt(E*E+P*P)/2,e.center.x=(x.x+S.x)/2,e.center.y=(x.y+S.y)/2,e}let r=0,i=0;for(let x=0;x<t.length;x++)r+=t[x].x,i+=t[x].y;r/=t.length,i/=t.length;const n=t.map(x=>x.x-r),s=t.map(x=>x.y-i);let o=0,a=0,l=0,c=0,u=0,h=0,p=0;for(let x=0;x<n.length;x++){const S=n[x],E=s[x],P=S*S,M=E*E;o+=P,a+=M,l+=S*E,c+=P*S,u+=M*E,h+=S*M,p+=E*P}const f=.5*(c+h),g=.5*(u+p),y=o*a-l*l,v=(f*a-g*l)/y,b=(o*g-l*f)/y,w=lp(v+r,b+i);return{radius:Math.sqrt(v*v+b*b+(o+a)/t.length),center:w}}function NI(t){const{native:e}=t,{pointerId:r,button:i,pointerType:n}=e;return n==="mouse"?`${r}:${i}`:`${n}`}let x_t=class extends va{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,r,i,n){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:n,pointers:S_t(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const r=e.native.pointerId,i=nF(this._activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,n);const s=f8(n,i4e(this._activePointerMap));n.initialAngle=s,n.lastAngle=s,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const r=e.native.pointerId,i=this._activePointerMap.get(r);i?i.event=e:this._addPointer(e)}_removePointer(e){const r=nF(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(r)}_updatePointerAngles(e){const r=nF(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=f8(i,r)-e,i.lastAngle=f8(i,r)-e})}_emitEvent(e,r,i){const n=nF(this._activePointerMap);this._drag.emit(this._createPayload(e,r,n,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const r=e.data.native.pointerId,i=e.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const r=e.data,i=r.currentEvent,n=e.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,n)):(this._addPointer(i),this._emitEvent("added",i,n),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,n))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function i4e(t){const e=[];return t.forEach(r=>{e.push(lp(r.event.x,r.event.y))}),w_t(e)}function nF(t){const e=i4e(t);let r=0;return t.forEach(i=>{let n=f8(i,e),s=n-i.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=i.lastAngle+s,i.lastAngle=n;const o=n-i.initialAngle;r+=o}),r/=t.size||1,{angle:r,radius:e.radius,center:e.center}}function S_t(t){const e=new Map;return t.forEach((r,i)=>e.set(i,r.event)),e}function f8(t,e){const r=t.event,i=r.x-e.center.x,n=r.y-e.center.y;return Math.atan2(n,i)}var n0e;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(n0e||(n0e={}));let T_t=class extends va{constructor(e=Oh.maximumDoubleClickDelay,r=Oh.maximumDoubleClickDistance,i=Oh.maximumDoubleTouchDelay,n=Oh.maximumDoubleTouchDistance,s=tN){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=NI(r);if(!this._pointerState.has(i)){const n={downButton:r.native.button,x:r.x,y:r.y,immediateDoubleClick:null};this._pointerState.set(i,n),this.startCapturingPointer(r.native)}}_handlePointerUp(e){const r=e.data,i=NI(r),n=this._pointerState.get(i);if(n&&n.downButton===r.native.button){const s=n.immediateDoubleClick,o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;s?(s.timeoutHandle.remove(),Iee(s,e.data)>o?this._startImmediateDoubleClick(e,n):(this._immediateDoubleClick.emit(e.data,void 0,s.modifiers),this._removeState(r))):Iee(n,e.data)>o?this._removeState(r):this._startImmediateDoubleClick(e,n)}}_startImmediateDoubleClick(e,r){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const r=NI(e);this._pointerState.delete(r),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},E_t=class extends va{constructor(e=Oh.maximumClickDelay,r=Oh.movementUntilMouseDrag,i=Oh.movementUntilPenDrag,n=Oh.movementUntilTouchDrag,s=Oh.holdDelay,o=tN){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=n,this._holdDelay=s,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Pi(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=r.native.pointerId;let n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const s={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(i,s),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,r,i){return{action:e,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(e){const r=e.data,i=r.native.pointerId,n=this._pointerState.get(i);n&&(n.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",n,r),void 0,n.modifiers):b_t(r,n.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(e),n.previousEvent=r)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const r=e.data,i=r.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,i===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",n,r)):this._pointerDrag.emit(this._createPointerDragData("start",n,n.previousEvent),e.timestamp))})}_handlePointerLoss(e,r){const i=e.data,n=i.native.pointerId,s=this._pointerState.get(n);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,r==="pointer-up"?i:s.previousEvent),void 0,s.modifiers):r==="pointer-up"&&s.downButton===i.native.button&&e.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(n),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}},C_t=class extends va{constructor(e=Oh.maximumDoubleClickDelay,r=Oh.maximumDoubleClickDistance,i=Oh.maximumDoubleTouchDelay,n=Oh.maximumDoubleTouchDistance,s=tN){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Pi(e.doubleClickTimer))}get hasPendingInputs(){return Hd(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,r){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=Pi(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const r=this._pointerState.get(e);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:r,pointerType:i,button:n}=e.native;return i==="mouse"?`${r}:${n}`:`${i}`}_handleImmediateClick(e){const r=e.data,{pointerType:i}=r.native,n=this._getPointerId(r);if(!this._pointerState.has(n))return void this._startClick(e);const s=this._pointerState.get(n),{data:o,modifiers:a}=s.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;Iee(o,r)>l?(this._clearDoubleClickTimer(n,!0),this._startClick(e)):(this._clearDoubleClickTimer(n,!1),s.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const r=NI(e.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:r}=e,{native:{pointerType:i}}=r,n=NI(r),s=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),s);this._pointerState.set(n,{event:e,doubleClickTimer:o,pointerDownCount:1}),this.refreshHasPendingInputs()}},P_t=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const r=e.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var r,i;this._startEvent=e,(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},A_t=class extends va{constructor(e=20,r=40){super(!1),this._threshold=e,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new P_t({start:(i,n)=>this._observeStart(i,n),update:(i,n,s)=>this._observeUpdate(i,n,s),end:(i,n)=>this._observeEnd(n)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(e,r){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,r,i){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,r){let i=-1/0,n=1/0,s=-1/0,o=1/0;for(const{x:y,y:v}of r.pointers.values())i=Math.max(i,y),n=Math.min(n,y),s=Math.max(s,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:y,y:v}of e.pointers.values())a=Math.max(a,y),l=Math.min(l,y),c=Math.max(c,v),u=Math.min(u,v);const h=i-n,p=s-o,f=a-l,g=c-u;return Math.abs(e.center.x-r.center.x)<this._threshold&&Math.abs(f-h)<=this._maxDelta&&Math.abs(g-p)<=this._maxDelta}_checkVerticalThresholdReached(e,r){let i=Math.abs(e.center.y-r.center.y);return e.pointers.forEach((n,s)=>{const o=r.pointers.get(s);i=Math.min(i,Math.abs(n.y-o.y))}),i>=this._threshold}},tf=class extends Pe{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Me(this._inputManager)}connect(){const e=this.view;this._source=new t4e(this.view.surface,e.input);const r=[new T_t,new E_t,new C_t,new x_t(this.view.navigation),new A_t],i=new dd({eventSource:this._source,recognizers:r});this._inputManager=i,i.installHandlers("prevent-context-menu",[new v_t],cb.INTERNAL),this._modeDragPan=new e0e(e,"primary"),this._modeDragRotate=new lq(e,"secondary",du.CENTER),this._modeDragZoom=new j0t(e,"tertiary");const n={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new l_t(e),new l0t(e),new Q0t(e),new e_t(e,n.pan),new t_t(e),new u_t(e,n.resetTilt),new c_t(e,n.resetHeading),new lq(e,"primary",du.EYE,[n.lookAround]),new lq(e,"secondary",du.CENTER,[n.lookAround]),new e0e(e,"tertiary",[n.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new h_t(e)],cb.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this.addHandles(pe(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},mi))}isModifierKeyDown(e){var r;return((r=this._inputManager)==null?void 0:r.isModifierKeyDown(e))??!1}_updateMode(){var n;const e=this.mode,r=this.primaryDragAction,i=(n=Lee.get(e))==null?void 0:n.get(r);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};d([m()],tf.prototype,"view",void 0),d([m({value:"pan"})],tf.prototype,"primaryDragAction",null),d([m({value:"default"})],tf.prototype,"mode",null),d([m({readOnly:!0})],tf.prototype,"updating",null),d([m()],tf.prototype,"latestPointerType",null),d([m()],tf.prototype,"latestPointerLocation",null),d([m()],tf.prototype,"multiTouchActive",null),d([m()],tf.prototype,"_inputManager",void 0),tf=d([F("esri.views.3d.input.SceneInputManager")],tf);const Lee=new Map,hq=new Map,dq=new Map;hq.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),hq.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),dq.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),dq.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),Lee.set("default",hq),Lee.set("pro",dq);const O_t=tf;let Kn=class extends Pe{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};d([m()],Kn.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),d([m()],Kn.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),d([m()],Kn.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),d([m()],Kn.prototype,"DECONFLICTOR_SHOW_GRID",void 0),d([m()],Kn.prototype,"LABELS_SHOW_BORDER",void 0),d([m()],Kn.prototype,"TEXT_SHOW_BASELINE",void 0),d([m()],Kn.prototype,"TEXT_SHOW_BORDER",void 0),d([m()],Kn.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),d([m()],Kn.prototype,"OVERLAY_SHOW_CENTER",void 0),d([m()],Kn.prototype,"SHOW_POI",void 0),d([m()],Kn.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),d([m()],Kn.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),d([m()],Kn.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),d([m()],Kn.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),d([m()],Kn.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),d([m()],Kn.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),d([m()],Kn.prototype,"I3S_TREE_SHOW_TILES",void 0),d([m()],Kn.prototype,"I3S_SHOW_MODIFICATIONS",void 0),d([m()],Kn.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),d([m()],Kn.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),d([m()],Kn.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),d([m()],Kn.prototype,"LINE_WIREFRAMES",void 0),Kn=d([F("esri.views.3d.support.DebugFlags")],Kn);const Si=new Kn;let xh,lP,Dee=!1,Nee=!1,Fee=!1,kee=!1,FI=null;function M_t(t,e){if(!Nee||!lP)return;n4e();const r=lP;let i=0;for(let n=0;n<t.accBinsNumX;n++)for(let s=0;s<t.accBinsNumY;s++){const o=t.accBins[n][t.accBinsNumY-1-s];i+=o.length;const a=n*t.accBinsSizeX,l=(n+1)*t.accBinsSizeX,c=s*t.accBinsSizeY,u=(s+1)*t.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),s4e(a,l,c,u,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+e.size,70,50),r.fillText("total numTests: "+t.accNumTests,70,30)}function R_t(t){Fee=Si.DECONFLICTOR_SHOW_VISIBLE,kee=Si.DECONFLICTOR_SHOW_INVISIBLE,Dee=Fee||kee,Nee=Si.DECONFLICTOR_SHOW_GRID,FI=null,Dee||Nee?FI=()=>$_t(t):xh&&(xh.parentElement.removeChild(xh),xh=null)}function n4e(){FI&&(FI(),FI=null)}function $_t(t){xh==null&&(xh=document.createElement("canvas"),xh.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(xh));const{state:e}=t,{camera:r,pixelRatio:i}=e,{width:n,height:s}=r,o=n*i,a=s*i;xh.setAttribute("width",`${o}px`),xh.setAttribute("height",`${a}px`),xh.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),lP=xh.getContext("2d"),lP.clearRect(0,0,n,s),lP.font="12px Arial"}function s4e(t,e,r,i,n){n4e();const s=xh.height,o=lP;o.beginPath(),o.lineWidth=1,o.strokeStyle=n,o.moveTo(t,s-r),o.lineTo(e,s-r),o.stroke(),o.lineTo(e,s-i),o.stroke(),o.lineTo(e,s-r),o.stroke(),o.lineTo(t,s-r),o.stroke(),o.lineTo(t,s-r),o.stroke(),o.closePath()}function I_t(t,e){Dee&&(e&&Fee||!e&&kee)&&s4e(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var Da,Uo;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(Da||(Da={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(Uo||(Uo={}));function o4e(t,e){return new c4e(t,h4e,e)}function L_t(t,e){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:n}=h4e;return new c4e(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:pq.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:pq.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:n,minPixelSize:pq.minPixelSize},e)}function D_t(t){return Math.abs(t*t*t)}function a4e(t,e,r){const i=r.parameters;return fq.scale=Math.min(i.divisor/(e-i.offset),1),fq.factor=D_t(t),fq}function jae(t,e){return Dt(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function N_t(t,e,r){const i=a4e(t,e,r);return i.minScaleFactor=0,jae(1,i)}function s0e(t,e,r,i){i.scale=N_t(t,e,r),i.factor=0,i.minScaleFactor=r.minScaleFactor}function l4e(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,e.minScaleFactor),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function F_t(t,e,r,i){return jae(t,a4e(e,r,i))}let c4e=class u4e{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,r,i,n=k_t(),s){this._viewingMode=e,this._description=r,this._ellipsoidRadius=i,this.parameters=n,this._fontHeight=s,this._viewingMode===Fe.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new u4e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,i){const{scaleStart:n,scaleFallOffRange:s}=this._description,{fovY:o,distance:a}=e,l=this._calculateCurvatureDependentParameters(e,r),c=this._coverageCompensation(e,r,l),{tiltAngle:u,scaleFallOffFactor:h}=l,p=Math.sin(u)*a,f=.5*Math.PI-u-o*(.5-n*c),g=p/Math.cos(f),y=f+o*s*c,v=(g-h*(p/Math.cos(y)))/(1-h);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=v,i.divisor=g-v,i}_calculateCurvatureDependentParametersLocal(e,r,i=o0e){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,r,i=o0e){const n=this._description.curvatureDependent,s=1+e.distance/r,o=Math.sqrt(s*s-1),[a,l]=[n.min.curvature,n.max.curvature],c=we((o-a)/(l-a),0,1),[u,h]=[n.min,n.max];return i.tiltAngle=Dt(u.tiltAngle,h.tiltAngle,c),i.scaleFallOffFactor=Dt(u.scaleFallOffFactor,h.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,r,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,r,i){const n=r*r,s=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+n-2*Math.cos(s)*a*r,c=Math.sqrt(l),u=Math.sqrt(l-n);return(Math.acos(u/c)-Math.asin(r/(c/Math.sin(s)))+.5*o)/o}};const h4e={curvatureDependent:{min:{curvature:Ut(10),tiltAngle:Ut(12),scaleFallOffFactor:.5},max:{curvature:Ut(70),tiltAngle:Ut(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},pq={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function k_t(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const fq={scale:0,factor:0,minScaleFactor:0},o0e={tiltAngle:0,scaleFallOffFactor:0};function U_t(t){return t instanceof Float32Array&&t.length>=16}function z_t(t){return Array.isArray(t)&&t.length>=16}function V_t(t){return U_t(t)||z_t(t)}const pA={unknown:1,inches:Lo(1,"meters","inches"),feet:Lo(1,"meters","feet"),"us-feet":Lo(1,"meters","us-feet"),yards:Lo(1,"meters","yards"),miles:Lo(1,"meters","miles"),"nautical-miles":Lo(1,"meters","nautical-miles"),millimeters:Lo(1,"meters","millimeters"),centimeters:Lo(1,"meters","centimeters"),decimeters:Lo(1,"meters","decimeters"),meters:Lo(1,"meters","meters"),kilometers:Lo(1,"meters","kilometers"),"decimal-degrees":1/JYe(1,"meters",ni.radius)};var il,a0e;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(il||(il={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(a0e||(a0e={}));let Hae=class{constructor(e){this.field=e}},B_t=class extends Hae{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[il.Undefined,il.Undefined,il.Undefined]}},G_t=class extends Hae{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},j_t=class extends Hae{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},H_t=class{};function hM(t){return t!=null}function cE(t){return typeof t=="number"}function iG(t){return typeof t=="string"}function q_t(t){return t==null||iG(t)}function Js(t,e){t&&t.push(e)}function W_t(t,e,r,i=xe()){const n=t||0,s=e||0,o=r||0;return n!==0&&UP(i,i,-n/180*Math.PI),s!==0&&kP(i,i,s/180*Math.PI),o!==0&&xB(i,i,o/180*Math.PI),i}function u1(t,e,r,i,n){var a;const s=t.minSize,o=t.maxSize;if(t.expression)return Js(n,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const l=i.symbolSize[r];return e.minSize[r]=l,e.maxSize[r]=l,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=il.DefinedSize,!0}if(hM(t.field))return hM(t.stops)?t.stops.length===2&&cE(t.stops[0].size)&&cE(t.stops[1].size)?(l0e(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=il.DefinedSize,!0):(Js(n,"Could not convert size info: stops only supported with 2 elements"),!1):cE(s)&&cE(o)&&hM(t.minDataValue)&&hM(t.maxDataValue)?(l0e(s,o,t.minDataValue,t.maxDataValue,e,r),e.type[r]=il.DefinedSize,!0):t.valueUnit==="unknown"?(Js(n,"Could not convert size info: proportional size not supported"),!1):pA[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/pA[t.valueUnit],e.type[r]=il.DefinedSize,!0):(Js(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!hM(t.field)){if((a=t.stops)!=null&&a[0]&&cE(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=il.DefinedSize,!0;if(cE(s))return e.minSize[r]=s,e.maxSize[r]=s,e.offset[r]=s,e.factor[r]=0,e.type[r]=il.DefinedSize,!0}return Js(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function l0e(t,e,r,i,n,s){const o=Math.abs(i-r)>0?(e-t)/(i-r):0;n.minSize[s]=o>0?t:e,n.maxSize[s]=o>0?e:t,n.offset[s]=t-r*o,n.factor[s]=o}function Y_t(t,e,r,i){if(t.normalizationField||t.valueRepresentation)return Js(i,"Could not convert size info: unsupported property"),null;if(!q_t(t.field))return Js(i,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return Js(i,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new B_t(t.field);let n;switch(t.axis){case"width":return n=u1(t,e.size,0,r,i),n?e:null;case"height":return n=u1(t,e.size,2,r,i),n?e:null;case"depth":return n=u1(t,e.size,1,r,i),n?e:null;case"width-and-depth":return n=u1(t,e.size,0,r,i),n&&u1(t,e.size,1,r,i),n?e:null;case null:case void 0:case"all":return n=u1(t,e.size,0,r,i),n=n&&u1(t,e.size,1,r,i),n=n&&u1(t,e.size,2,r,i),n?e:null;default:return Js(i,`Could not convert size info: unknown axis "${t.axis}""`),null}}function X_t(t,e,r){for(let n=0;n<3;++n){let s=e.unitInMeters;t.type[n]===il.DefinedSize&&(s*=e.modelSize[n],t.type[n]=il.DefinedScale),t.minSize[n]=t.minSize[n]/s,t.maxSize[n]=t.maxSize[n]/s,t.offset[n]=t.offset[n]/s,t.factor[n]=t.factor[n]/s}let i;if(t.type[0]!==il.Undefined)i=0;else if(t.type[1]!==il.Undefined)i=1;else{if(t.type[2]===il.Undefined)return Js(r,"No size axis contains a valid size or scale"),!1;i=2}for(let n=0;n<3;++n)t.type[n]===il.Undefined&&(t.minSize[n]=t.minSize[i],t.maxSize[n]=t.maxSize[i],t.offset[n]=t.offset[i],t.factor[n]=t.factor[i],t.type[n]=t.type[i]);return!0}function c0e(t,e,r){t[4*e]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function Z_t(t,e,r){if(t.normalizationField)return Js(r,"Could not convert color info: unsupported property"),null;if(iG(t.field)){if(!t.stops)return Js(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return Js(r,"Could not convert color info: too many color stops"),null;e.color=new G_t(t.field);const i=t.stops;for(let n=0;n<8;++n){const s=i[Math.min(n,i.length-1)];e.color.values[n]=s.value,c0e(e.color.colors,n,s.color)}}}else{if(!(t.stops&&t.stops.length>=0))return Js(r,"Could not convert color info: no field and no colors/stops"),null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.color.values[n]=1/0,c0e(e.color.colors,n,i)}}return e}function J_t(t,e,r){if(t.normalizationField)return Js(r,"Could not convert opacity info: unsupported property"),null;if(iG(t.field)){if(!t.stops)return Js(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return Js(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new j_t(t.field);const i=t.stops;for(let n=0;n<8;++n){const s=i[Math.min(n,i.length-1)];e.opacity.values[n]=s.value,e.opacity.opacityValues[n]=s.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return Js(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.opacity.values[n]=1/0,e.opacity.opacityValues[n]=i}}return e}function mq(t,e,r){const i=r===2&&t.rotationType==="arithmetic";e.offset[r]=i?90:0,e.factor[r]=i?-1:1,e.type[r]=1}function Q_t(t,e,r){if(!iG(t.field))return Js(r,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return Js(r,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return mq(t,e.rotation,0),e;case"roll":return mq(t,e.rotation,1),e;case null:case void 0:case"heading":return mq(t,e.rotation,2),e;default:return Js(r,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let IN=class{constructor(e,r=[1,1,1],i=[1,1,1],n=1,s=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=r,this.symbolSize=i,this.unitInMeters=n,this.anchor=s,this.scale=o,this.rotation=a}};function d4e(t,e,r){if(!t)return null;const i=t.reduce((n,s)=>{if(!n)return n;if(s.valueExpression)return Js(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(s.type){case"size":return e.supports.size?Y_t(s,n,e,r):n;case"color":return e.supports.color?Z_t(s,n,r):n;case"opacity":return e.supports.opacity?J_t(s,n,r):null;case"rotation":return e.supports.rotation?Q_t(s,n,r):n;default:return null}},new H_t);return!(t.length>0&&i)||i.size||i.color||i.opacity||i.rotation?i!=null&&i.size&&!X_t(i.size,e,r)?null:i:null}let K_t=class{constructor(e,r,i){this.visualVariables=e,this.materialParameters=r,this.requiresShaderTransformation=i}};function fA(t,e){if(!t||Si.TESTS_DISABLE_FAST_UPDATES)return null;const r=d4e(t.visualVariables,e);return r?new K_t(r,f4e(r,e),!!r.size):null}function mA(t,e,r){if(!e||!t)return!1;const i=t.visualVariables,n=d4e(e.visualVariables,r);return!!n&&!!(sF(i.size,n.size,"size")&&sF(i.color,n.color,"color")&&sF(i.rotation,n.rotation,"rotation")&&sF(i.opacity,n.opacity,"opacity"))&&(t.visualVariables=n,t.materialParameters=f4e(n,r),t.requiresShaderTransformation=!!n.size,!0)}function sF(t,e,r){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&r==="rotation"){const i=t,n=e;for(let s=0;s<3;s++)if(i.type[s]!==n.type[s]||i.offset[s]!==n.offset[s]||i.factor[s]!==n.factor[s])return!1}return!0}let p4e=class extends Li{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}};function f4e(t,e){const r=new p4e(t);return r.vvSize&&(r.vvSymbolAnchor=e.anchor,cp(kI),W_t(e.rotation[2],e.rotation[0],e.rotation[1],kI),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||gi(),jh(r.vvSymbolRotationMatrix,kI)),r}function e1t(t,e,r){if(!t.vvSize)return r;cs(h1,r);const i=t.vvSymbolRotationMatrix;_y(kI,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),Kr(h1,h1,kI);for(let n=0;n<3;++n){const s=t.vvSize.offset[n]+e[0]*t.vvSize.factor[n];u0e[n]=we(s,t.vvSize.minSize[n],t.vvSize.maxSize[n])}return g2(h1,h1,u0e),Fc(h1,h1,t.vvSymbolAnchor),h1}function qae(t,e,r){if(!e.vvSize)return se(t,1,1,1),t;for(let i=0;i<3;++i){const n=e.vvSize.offset[i]+r[0]*e.vvSize.factor[i];t[i]=we(n,e.vvSize.minSize[i],e.vvSize.maxSize[i])}return t}function tm(t,e){const r=t==null?0:e.attributes[t];return typeof r=="number"&&isFinite(r)?r:0}const h1=xe(),u0e=C(),kI=xe();function Wae(t){t.vertex.code.add(T`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(T`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(T`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(T`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(T`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(T`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function t1t(t){t.uniforms.add(new zt("screenSizePerspective",e=>m4e(e.screenSizePerspective)))}function nG(t){t.uniforms.add(new zt("screenSizePerspectiveAlignment",e=>m4e(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function m4e(t){return se(r1t,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const r1t=C();function g4e(t,e){const r=t.vertex;e.hasVerticalOffset?(y4e(r),e.hasScreenSizePerspective&&(t.include(Wae),nG(r),mm(t.vertex,e)),r.code.add(T`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?T`vec3 worldNormal = normalize(worldPos + localOrigin);`:T`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?T`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:T`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(T`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const i1t=tr();function y4e(t){t.uniforms.add(new Or("verticalOffset",(e,r)=>{const{minWorldLength:i,maxWorldLength:n,screenLength:s}=e.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return pn(i1t,s*a,o,i,n)}))}const _4e=.5;function v4e(t,e){t.include(Wae),t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.NORMAL,"vec3"),t.attributes.add(R.CENTEROFFSETANDDISTANCE,"vec4");const r=t.vertex;Uu(r,e),mm(r,e),r.uniforms.add(new Or("viewport",(i,n)=>n.camera.fullViewport),new Ie("polygonOffset",i=>i.shaderPolygonOffset),new Ie("cameraGroundRelative",(i,n)=>n.camera.aboveGround?1:-1)),e.hasVerticalOffset&&y4e(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(T`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(T`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.multipassEnabled?T.float(0):T`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||hA(r),e.draped||(r.uniforms.add(new Ie("perDistancePixelRatio",(i,n)=>Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2))),r.code.add(T`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${T.float(_4e)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&iO(r),e.hasScreenSizePerspective&&nG(r),r.code.add(T`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?T`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":T`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}const oF=Ds();function b4e(t,e,r,i,n,s){if(t.visible)if(t.boundingInfo){_t(t.type===Ln.Mesh);const o=e.tolerance;w4e(t.boundingInfo,r,i,o,n,s)}else{const o=t.attributes.get(R.POSITION),a=o.indices;LN(r,i,0,a.length/3,a,o,void 0,n,s)}}const n1t=C();function w4e(t,e,r,i,n,s){if(t==null)return;const o=S4e(e,r,n1t);if(NAe(oF,t.bbMin),FAe(oF,t.bbMax),n!=null&&n.applyToAabb(oF),Xae(oF,e,o,i)){const{primitiveIndices:a,position:l}=t,c=a?a.length:l.indices.length/3;if(c>l1t){const u=t.getChildren();if(u!==void 0){for(const h of u)w4e(h,e,r,i,n,s);return}}LN(e,r,0,c,l.indices,l,a,n,s)}}const x4e=C();function LN(t,e,r,i,n,s,o,a,l){if(o)return s1t(t,e,r,i,n,s,o,a,l);const{data:c,stride:u}=s,h=t[0],p=t[1],f=t[2],g=e[0]-h,y=e[1]-p,v=e[2]-f;for(let b=r,w=3*r;b<i;++b){let x=u*n[w++],S=c[x++],E=c[x++],P=c[x];x=u*n[w++];let M=c[x++],L=c[x++],U=c[x];x=u*n[w++];let z=c[x++],W=c[x++],V=c[x];a!=null&&([S,E,P]=a.applyToVertex(S,E,P,b),[M,L,U]=a.applyToVertex(M,L,U,b),[z,W,V]=a.applyToVertex(z,W,V,b));const J=M-S,Y=L-E,X=U-P,le=z-S,D=W-E,I=V-P,k=y*I-D*v,j=v*le-I*g,q=g*D-le*y,Q=J*k+Y*j+X*q;if(Math.abs(Q)<=Number.EPSILON)continue;const ie=h-S,ye=p-E,Ae=f-P,Ze=ie*k+ye*j+Ae*q;if(Q>0){if(Ze<0||Ze>Q)continue}else if(Ze>0||Ze<Q)continue;const Et=ye*X-Y*Ae,xt=Ae*J-X*ie,Qe=ie*Y-J*ye,Ke=g*Et+y*xt+v*Qe;if(Q>0){if(Ke<0||Ze+Ke>Q)continue}else if(Ke>0||Ze+Ke<Q)continue;const Ge=(le*Et+D*xt+I*Qe)/Q;Ge>=0&&l(Ge,Yae(J,Y,X,le,D,I,x4e),b,!1)}}function s1t(t,e,r,i,n,s,o,a,l){const{data:c,stride:u}=s,h=t[0],p=t[1],f=t[2],g=e[0]-h,y=e[1]-p,v=e[2]-f;for(let b=r;b<i;++b){const w=o[b];let x=3*w,S=u*n[x++],E=c[S++],P=c[S++],M=c[S];S=u*n[x++];let L=c[S++],U=c[S++],z=c[S];S=u*n[x];let W=c[S++],V=c[S++],J=c[S];a!=null&&([E,P,M]=a.applyToVertex(E,P,M,b),[L,U,z]=a.applyToVertex(L,U,z,b),[W,V,J]=a.applyToVertex(W,V,J,b));const Y=L-E,X=U-P,le=z-M,D=W-E,I=V-P,k=J-M,j=y*k-I*v,q=v*D-k*g,Q=g*I-D*y,ie=Y*j+X*q+le*Q;if(Math.abs(ie)<=Number.EPSILON)continue;const ye=h-E,Ae=p-P,Ze=f-M,Et=ye*j+Ae*q+Ze*Q;if(ie>0){if(Et<0||Et>ie)continue}else if(Et>0||Et<ie)continue;const xt=Ae*le-X*Ze,Qe=Ze*Y-le*ye,Ke=ye*X-Y*Ae,Ge=g*xt+y*Qe+v*Ke;if(ie>0){if(Ge<0||Et+Ge>ie)continue}else if(Ge>0||Et+Ge<ie)continue;const Jt=(D*xt+I*Qe+k*Ke)/ie;Jt>=0&&l(Jt,Yae(Y,X,le,D,I,k,x4e),w,!1)}}const h0e=C(),d0e=C();function Yae(t,e,r,i,n,s,o){return se(h0e,t,e,r),se(d0e,i,n,s),it(o,h0e,d0e),me(o,o),o}function S4e(t,e,r){return se(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function Xae(t,e,r,i){return Zae(t,e,r,i,1/0)}function Zae(t,e,r,i,n){const s=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(t[1]-i-e[1])*r[1],u=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const h=(t[2]-i-e[2])*r[2],p=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(h,p)),!(l<0)&&(a=Math.max(a,Math.min(h,p)),!(a>l)&&a<n)}function T4e(t,e,r,i,n){let s=(r.screenLength||0)*t.pixelRatio;n!=null&&(s=F_t(s,i,e,n));const o=s*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return we(o*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function E4e(t,e){const r=e?E4e(e):{};for(const i in t){let n=t[i];n!=null&&n.forEach&&(n=a1t(n)),n==null&&i in r||(r[i]=n)}return r}function o1t(t,e){let r=!1;for(const i in e){const n=e[i];n!==void 0&&(Array.isArray(n)?t[i]===null?(t[i]=n.slice(),r=!0):SEe(t[i],n)&&(r=!0):t[i]!==n&&(r=!0,t[i]=n))}return r}function a1t(t){const e=[];return t.forEach(r=>e.push(r)),e}const C4e={multiply:1,ignore:2,replace:3,tint:4},l1t=1e3;let mw=class extends pN{constructor(e,r){super(),this.type=Ln.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=Nr,this._pp0=Ce(0,0,1),this._pp1=Ce(0,0,0),this._parameters=E4e(e,r),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){o1t(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bindParameters.decorations===Ac.ON)&&(this.parameters.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){var e;(e=this.repository)==null||e.materialChanged(this)}queryRenderOccludedState(e){return this.isVisible()&&this.parameters.renderOccluded===e}intersectDraped(e,r,i,n,s,o){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],this.intersect(e,r,i,this._pp0,this._pp1,s)}},P4e=class extends Umt{constructor(e,r,i){super(r,i),this.camera=e}};var Wr;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Wr||(Wr={}));let Jae=class extends Li{constructor(){super(...arguments),this.renderOccluded=Wr.Occlude,this.isDecoration=!1}},A4e=class{constructor(){this.factor=new p0e,this.factorAlignment=new p0e}},p0e=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function ser(t,e,r,i=1){const{data:n,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(r*=a,i===1)for(let c=0;c<l;++c)o[r]=n[s[c]],r+=a;else for(let c=0;c<l;++c){const u=n[s[c]];for(let h=0;h<i;h++)o[r]=u,r+=a}}function f0e(t,e,r){const{data:i,indices:n}=t,s=e.typedBuffer,o=e.typedBufferStride,a=n.length;r*=o;for(let l=0;l<a;++l){const c=2*n[l];s[r]=i[c],s[r+1]=i[c+1],r+=o}}function O4e(t,e,r,i){const{data:n,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(r*=a,i==null||i===1)for(let c=0;c<l;++c){const u=3*s[c];o[r]=n[u],o[r+1]=n[u+1],o[r+2]=n[u+2],r+=a}else for(let c=0;c<l;++c){const u=3*s[c];for(let h=0;h<i;++h)o[r]=n[u],o[r+1]=n[u+1],o[r+2]=n[u+2],r+=a}}function gA(t,e,r,i=1){const{data:n,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(r*=a,i===1)for(let c=0;c<l;++c){const u=4*s[c];o[r]=n[u],o[r+1]=n[u+1],o[r+2]=n[u+2],o[r+3]=n[u+3],r+=a}else for(let c=0;c<l;++c){const u=4*s[c];for(let h=0;h<i;++h)o[r]=n[u],o[r+1]=n[u+1],o[r+2]=n[u+2],o[r+3]=n[u+3],r+=a}}function m0e(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride;e*=n;for(let s=0;s<r;++s)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=n}function Qae(t,e,r,i,n=1){if(!e)return void O4e(t,r,i,n);const{data:s,indices:o}=t,a=r.typedBuffer,l=r.typedBufferStride,c=o.length,u=e[0],h=e[1],p=e[2],f=e[4],g=e[5],y=e[6],v=e[8],b=e[9],w=e[10],x=e[12],S=e[13],E=e[14];i*=l;let P=0,M=0,L=0;const U=CB(e)?z=>{P=s[z]+x,M=s[z+1]+S,L=s[z+2]+E}:z=>{const W=s[z],V=s[z+1],J=s[z+2];P=u*W+f*V+v*J+x,M=h*W+g*V+b*J+S,L=p*W+y*V+w*J+E};if(n===1)for(let z=0;z<c;++z)U(3*o[z]),a[i]=P,a[i+1]=M,a[i+2]=L,i+=l;else for(let z=0;z<c;++z){U(3*o[z]);for(let W=0;W<n;++W)a[i]=P,a[i+1]=M,a[i+2]=L,i+=l}}function Kae(t,e,r,i,n=1){if(!e)return void O4e(t,r,i,n);const{data:s,indices:o}=t,a=e,l=r.typedBuffer,c=r.typedBufferStride,u=o.length,h=a[0],p=a[1],f=a[2],g=a[4],y=a[5],v=a[6],b=a[8],w=a[9],x=a[10],S=!ese(a),E=1e-6,P=1-E;i*=c;let M=0,L=0,U=0;const z=CB(a)?W=>{M=s[W],L=s[W+1],U=s[W+2]}:W=>{const V=s[W],J=s[W+1],Y=s[W+2];M=h*V+g*J+b*Y,L=p*V+y*J+w*Y,U=f*V+v*J+x*Y};if(n===1)if(S)for(let W=0;W<u;++W){z(3*o[W]);const V=M*M+L*L+U*U;if(V<P&&V>E){const J=1/Math.sqrt(V);l[i]=M*J,l[i+1]=L*J,l[i+2]=U*J}else l[i]=M,l[i+1]=L,l[i+2]=U;i+=c}else for(let W=0;W<u;++W)z(3*o[W]),l[i]=M,l[i+1]=L,l[i+2]=U,i+=c;else for(let W=0;W<u;++W){if(z(3*o[W]),S){const V=M*M+L*L+U*U;if(V<P&&V>E){const J=1/Math.sqrt(V);M*=J,L*=J,U*=J}}for(let V=0;V<n;++V)l[i]=M,l[i+1]=L,l[i+2]=U,i+=c}}function c1t(t,e,r,i,n=1){if(!e)return void gA(t,r,i,n);const{data:s,indices:o}=t,a=e,l=r.typedBuffer,c=r.typedBufferStride,u=o.length,h=a[0],p=a[1],f=a[2],g=a[4],y=a[5],v=a[6],b=a[8],w=a[9],x=a[10],S=!ese(a),E=1e-6,P=1-E;if(i*=c,n===1)for(let M=0;M<u;++M){const L=4*o[M],U=s[L],z=s[L+1],W=s[L+2],V=s[L+3];let J=h*U+g*z+b*W,Y=p*U+y*z+w*W,X=f*U+v*z+x*W;if(S){const le=J*J+Y*Y+X*X;if(le<P&&le>E){const D=1/Math.sqrt(le);J*=D,Y*=D,X*=D}}l[i]=J,l[i+1]=Y,l[i+2]=X,l[i+3]=V,i+=c}else for(let M=0;M<u;++M){const L=4*o[M],U=s[L],z=s[L+1],W=s[L+2],V=s[L+3];let J=h*U+g*z+b*W,Y=p*U+y*z+w*W,X=f*U+v*z+x*W;if(S){const le=J*J+Y*Y+X*X;if(le<P&&le>E){const D=1/Math.sqrt(le);J*=D,Y*=D,X*=D}}for(let le=0;le<n;++le)l[i]=J,l[i+1]=Y,l[i+2]=X,l[i+3]=V,i+=c}}function M4e(t,e,r,i,n=1){const{data:s,indices:o}=t,a=r.typedBuffer,l=r.typedBufferStride,c=o.length;if(i*=l,e!==s.length||e!==4)if(n!==1)if(e!==4)for(let u=0;u<c;++u){const h=3*o[u];for(let p=0;p<n;++p)a[i]=s[h],a[i+1]=s[h+1],a[i+2]=s[h+2],a[i+3]=255,i+=l}else for(let u=0;u<c;++u){const h=4*o[u];for(let p=0;p<n;++p)a[i]=s[h],a[i+1]=s[h+1],a[i+2]=s[h+2],a[i+3]=s[h+3],i+=l}else{if(e===4){for(let u=0;u<c;++u){const h=4*o[u];a[i]=s[h],a[i+1]=s[h+1],a[i+2]=s[h+2],a[i+3]=s[h+3],i+=l}return}for(let u=0;u<c;++u){const h=3*o[u];a[i]=s[h],a[i+1]=s[h+1],a[i+2]=s[h+2],a[i+3]=255,i+=l}}else{a[i]=s[0],a[i+1]=s[1],a[i+2]=s[2],a[i+3]=s[3];const u=new Uint32Array(r.typedBuffer.buffer,r.start),h=l/4,p=u[i/=4];i+=h;const f=c*n;for(let g=1;g<f;++g)u[i]=p,i+=h}}function u1t(t,e,r){const{data:i,indices:n}=t,s=e.typedBuffer,o=e.typedBufferStride,a=n.length,l=i[0];r*=o;for(let c=0;c<a;++c)s[r]=l,r+=o}function R4e(t,e,r,i,n=1){const s=e.typedBuffer,o=e.typedBufferStride;if(i*=o,n===1)for(let a=0;a<r;++a)s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<n;++l)s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],i+=o}function $4e(t,e,r,i,n,s){var o;for(const a of e.fields.keys()){const l=t.attributes.get(a),c=l==null?void 0:l.indices;if(l&&c)h1t(a,l,r,i,n,s);else if(a===R.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const u=(o=t.attributes.get(R.POSITION))==null?void 0:o.indices;if(u){const h=u.length,p=n.getField(a,dl);R4e(t.objectAndLayerIdColor,p,h,s)}}}}function h1t(t,e,r,i,n,s){switch(t){case R.POSITION:{_t(e.size===3);const o=n.getField(t,mo);_t(!!o,`No buffer view for ${t}`),o&&Qae(e,r,o,s);break}case R.NORMAL:{_t(e.size===3);const o=n.getField(t,mo);_t(!!o,`No buffer view for ${t}`),o&&Kae(e,i,o,s);break}case R.NORMALCOMPRESSED:{_t(e.size===2);const o=n.getField(t,yN);_t(!!o,`No buffer view for ${t}`),o&&f0e(e,o,s);break}case R.UV0:{_t(e.size===2);const o=n.getField(t,S2);_t(!!o,`No buffer view for ${t}`),o&&f0e(e,o,s);break}case R.COLOR:case R.SYMBOLCOLOR:{const o=n.getField(t,dl);_t(!!o,`No buffer view for ${t}`),_t(e.size===3||e.size===4),!o||e.size!==3&&e.size!==4||M4e(e,e.size,o,s);break}case R.COLORFEATUREATTRIBUTE:{const o=n.getField(t,ZB);_t(!!o,`No buffer view for ${t}`),_t(e.size===1),o&&e.size===1&&u1t(e,o,s);break}case R.TANGENT:{_t(e.size===4);const o=n.getField(t,hm);_t(!!o,`No buffer view for ${t}`),o&&c1t(e,i,o,s);break}case R.PROFILERIGHT:case R.PROFILEUP:case R.PROFILEVERTEXANDNORMAL:case R.FEATUREVALUE:{_t(e.size===4);const o=n.getField(t,hm);_t(!!o,`No buffer view for ${t}`),o&&gA(e,o,s)}}}let oer=class extends Li{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function d1t(t,e){I4e(t,e,new zt("slicePlaneOrigin",(r,i)=>F4e(e,r,i)),new zt("slicePlaneBasis1",(r,i)=>{var n;return R9(e,r,i,(n=i.slicePlane)==null?void 0:n.basis1)}),new zt("slicePlaneBasis2",(r,i)=>{var n;return R9(e,r,i,(n=i.slicePlane)==null?void 0:n.basis2)}))}function Wn(t,e){I4e(t,e,new Vh("slicePlaneOrigin",(r,i)=>F4e(e,r,i)),new Vh("slicePlaneBasis1",(r,i)=>{var n;return R9(e,r,i,(n=i.slicePlane)==null?void 0:n.basis1)}),new Vh("slicePlaneBasis2",(r,i)=>{var n;return R9(e,r,i,(n=i.slicePlane)==null?void 0:n.basis2)}))}function I4e(t,e,...r){if(!e.hasSlicePlane){const o=T`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...r),t.fragment.uniforms.add(...r);const i=T`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=T`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=e.hasSliceHighlight?T`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:T`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(s)}function L4e(t,e,r){return t.instancedDoublePrecision?se(p1t,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function D4e(t,e){return t!=null?_e($9,e.origin,t):e.origin}function N4e(t,e,r){return t.hasSliceTranslatedView?e!=null?Fc(f1t,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function F4e(t,e,r){if(r.slicePlane==null)return Yn;const i=L4e(t,e,r),n=D4e(i,r.slicePlane),s=N4e(t,i,r);return s!=null?ze($9,n,s):n}function R9(t,e,r,i){if(i==null||r.slicePlane==null)return Yn;const n=L4e(t,e,r),s=D4e(n,r.slicePlane),o=N4e(t,n,r);return o!=null?(ge(dM,i,s),ze($9,s,o),ze(dM,dM,o),_e(dM,dM,$9)):i}const p1t=C(),$9=C(),dM=C(),f1t=xe();function aO(t,e){const r=e.output===G.ObjectAndLayerIdColor,i=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),i?t.attributes.add(R.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(R.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(T`
     void forwardObjectAndLayerIdColor() {
      ${r?i?T`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:T`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:T``} }`),t.fragment.code.add(T`
      void outputObjectAndLayerIdColor() {
        ${r?T`fragColor = objectAndLayerIdColorVarying;`:T``} }`)}function sG(t){t.uniforms.add(new Qg("alignPixelEnabled",(e,r)=>r.alignPixelEnabled)),t.code.add(T`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(T`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function m1t(t,e){const{vertex:r,fragment:i}=t;r.include(sG),e.multipassEnabled&&(r.include(CDe),t.varyings.add("depth","float")),r.code.add(T`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.multipassEnabled?T`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.include(Yu,e),i.code.add(T`
  void main() {
    fragColor = vec4(1);
    ${e.multipassEnabled?T`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}function k4e(t){t.vertex.uniforms.add(new Ie("renderTransparentlyOccludedHUD",(e,r)=>r.hudRenderStyle===cu.Occluded?1:r.hudRenderStyle===cu.NotOccluded?0:.75),new Or("viewport",(e,r)=>r.camera.fullViewport),new ft("hudVisibilityTexture",(e,r)=>{var i;return(i=r.hudVisibility)==null?void 0:i.getTexture()})),t.vertex.include(sG),t.vertex.code.add(T`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}const U4e=Xt(1,1,0,1),ele=Xt(1,0,1,1);function gw(t){t.fragment.uniforms.add(new ft("depthTexture",(e,r)=>r.mainDepth)),t.fragment.constants.add("occludedHighlightFlag","vec4",U4e).add("unoccludedHighlightFlag","vec4",ele),t.fragment.code.add(T`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let z4e=class extends Pn{constructor(e,r,i){super(e,"vec4",kr.Pass,(n,s,o)=>n.setUniform4fv(e,r(s,o)),i)}},Oc=class extends Pn{constructor(e,r,i){super(e,"float",kr.Pass,(n,s,o)=>n.setUniform1fv(e,r(s,o)),i)}},DN=class extends p4e{constructor(){super(...arguments),this.renderOccluded=Wr.Occlude,this.isDecoration=!1}};const cP=8;function X0(t,e){const{vertex:r,attributes:i}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&i.add(R.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(r.uniforms.add(new zt("vvSizeMinSize",n=>n.vvSize.minSize)),r.uniforms.add(new zt("vvSizeMaxSize",n=>n.vvSize.maxSize)),r.uniforms.add(new zt("vvSizeOffset",n=>n.vvSize.offset)),r.uniforms.add(new zt("vvSizeFactor",n=>n.vvSize.factor)),r.uniforms.add(new Zh("vvSymbolRotationMatrix",n=>n.vvSymbolRotationMatrix)),r.uniforms.add(new zt("vvSymbolAnchor",n=>n.vvSymbolAnchor)),r.code.add(T`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(T`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?T`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(T`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(r.constants.add("vvColorNumber","int",cP),r.uniforms.add(new Oc("vvColorValues",n=>n.vvColor.values,cP),new z4e("vvColorColors",n=>n.vvColor.colors,cP)),r.code.add(T`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?T`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(T`vec4 vvColor() { return vec4(1.0); }`)}const I9=.1,sa=.001;function V4e(t){const e=new Fr,r=t.signedDistanceFieldEnabled;if(e.include(v4e,t),e.include(Wn,t),t.occlusionPass)return e.include(m1t,t),e;const{vertex:i,fragment:n}=e;e.include(Wae),n.include(bp),n.include(Ty),e.include(X0,t),e.include(aO,t),e.include(k4e),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),e.varyings.add("voccluded","float"),i.uniforms.add(new Or("viewport",(c,u)=>u.camera.fullViewport),new ci("screenOffset",(c,u)=>yr(B4e,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new ci("anchorPosition",c=>bD(c)),new Or("materialColor",c=>c.color)),iO(i),r&&(i.uniforms.add(new Or("outlineColor",c=>c.outlineColor)),n.uniforms.add(new Or("outlineColor",c=>g0e(c)?c.outlineColor:Fh),new Ie("outlineSize",c=>g0e(c)?c.outlineSize:0))),t.pixelSnappingEnabled&&i.include(sG),t.hasScreenSizePerspective&&(t1t(i),nG(i)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(R.UV0,"vec2"),e.attributes.add(R.COLOR,"vec4"),e.attributes.add(R.SIZE,"vec2"),e.attributes.add(R.FEATUREATTRIBUTE,"vec4"),i.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?T`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:T`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const s=T`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?r?T`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:T`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:T`posProj += quadOffset;`;i.code.add(T`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${s}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===G.ObjectAndLayerIdColor?T`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${T.float(sa)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${T.float(sa)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?T`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),n.uniforms.add(new ft("tex",c=>c.texture));const a=t.debugDrawLabelBorder?T`(isBorder > 0.0 ? 0.0 : ${T.float(I9)})`:T.float(I9),l=T`
    ${t.debugDrawLabelBorder?T`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${t.sampleSignedDistanceFieldTexelCenter?T`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:T`
      vec2 samplePos = vtc;
      `}

    ${r?T`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${T.float(sa)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:T`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?T`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(t.output){case G.Color:n.code.add(T`
        void main() {
          ${l}
          ${t.transparencyPassType===vt.FrontFace?"fragColor.rgb /= fragColor.a;":""}
        }`);break;case G.Alpha:n.code.add(T`
        void main() {
          ${l}
          fragColor = vec4(fragColor.a);
        }`);break;case G.ObjectAndLayerIdColor:n.code.add(T`
        void main() {
          ${l}
          outputObjectAndLayerIdColor();
        }`);break;case G.Highlight:n.constants.add("occludedHighlightFlag","vec4",U4e),n.constants.add("unoccludedHighlightFlag","vec4",ele),n.code.add(T`
        void main() {
          ${l}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return e}function g0e(t){return t.outlineColor[3]>0&&t.outlineSize>0}function bD(t,e=B4e){return t.textureIsSignedDistanceField?g1t(t.anchorPosition,t.distanceFieldBoundingBox,e):vo(e,t.anchorPosition),e}function g1t(t,e,r){e!=null?yr(r,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):yr(r,0,0)}const B4e=Ye(),y1t=Object.freeze(Object.defineProperty({__proto__:null,build:V4e,calculateAnchorPosForRendering:bD},Symbol.toStringTag,{value:"Module"})),Bh=ya(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),_1t=qu(Ee.ONE,Ee.ONE),G4e=qu(Ee.ZERO,Ee.ONE_MINUS_SRC_ALPHA);function $_(t){return t===vt.FrontFace?null:t===vt.Alpha?G4e:_1t}function oG(t){return t===vt.FrontFace?Wu:null}const aG=5e5,lG={factor:-1,units:-2};function cG(t){return t?lG:null}function yw(t,e=si.LESS){return t===vt.NONE||t===vt.FrontFace?e:si.LEQUAL}let j4e=class H4e extends Zr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Fe.Global}initializeProgram(e){return new Br(e.rctx,H4e.shader.get().build(this.configuration),Nr)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===vt.NONE,n=e===vt.FrontFace,s=this.configuration.hasPolygonOffset?v1t:null,o=r.draped?null:(i||n)&&r.output!==G.Highlight&&(r.depthEnabled||r.occlusionPass)?Wu:null;return Bt({blending:r.output===G.Color||r.output===G.Alpha||r.output===G.Highlight?i?b1t:$_(e):null,depthTest:r.draped?null:{func:si.LEQUAL},depthWrite:o,colorWrite:rr,polygonOffset:s})}get primitiveType(){return this.configuration.occlusionPass?dr.POINTS:dr.TRIANGLES}};j4e.shader=new Vr(y1t,()=>re(()=>Promise.resolve().then(()=>Ejt),void 0));const v1t={factor:0,units:-4},b1t=qu(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA);let ms=class extends Zl{constructor(){super(...arguments),this.output=G.Color,this.transparencyPassType=vt.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};d([H({count:G.COUNT})],ms.prototype,"output",void 0),d([H({count:vt.COUNT})],ms.prototype,"transparencyPassType",void 0),d([H()],ms.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([H()],ms.prototype,"spherical",void 0),d([H()],ms.prototype,"occlusionTestEnabled",void 0),d([H()],ms.prototype,"signedDistanceFieldEnabled",void 0),d([H()],ms.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),d([H()],ms.prototype,"vvSize",void 0),d([H()],ms.prototype,"vvColor",void 0),d([H()],ms.prototype,"hasVerticalOffset",void 0),d([H()],ms.prototype,"hasScreenSizePerspective",void 0),d([H()],ms.prototype,"debugDrawLabelBorder",void 0),d([H()],ms.prototype,"hasSlicePlane",void 0),d([H()],ms.prototype,"hasPolygonOffset",void 0),d([H()],ms.prototype,"depthEnabled",void 0),d([H()],ms.prototype,"pixelSnappingEnabled",void 0),d([H()],ms.prototype,"draped",void 0),d([H()],ms.prototype,"multipassEnabled",void 0),d([H()],ms.prototype,"cullAboveGround",void 0),d([H()],ms.prototype,"occlusionPass",void 0),d([H()],ms.prototype,"objectAndLayerIdColorInstanced",void 0),d([H({constValue:!0})],ms.prototype,"hasSliceInVertexProgram",void 0),d([H({constValue:!1})],ms.prototype,"hasVvInstancing",void 0);let yA=class extends mw{constructor(e){super(e,new R1t),this._configuration=new ms,this.produces=new Map([[de.HUD_MATERIAL,r=>r8(r)&&!this.parameters.drawInSecondSlot],[de.LABEL_MATERIAL,r=>r8(r)&&this.parameters.drawInSecondSlot],[de.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[de.DRAPED_MATERIAL,r=>r8(r)]])}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=r.slot===de.OCCLUSION_PIXELS&&this.parameters.occlusionTest,e===G.Color&&(this._configuration.debugDrawLabelBorder=!!Si.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,n,s,o){if(!(i.options.selectionMode&&i.options.hud&&e.visible&&i.point))return;const a=this.parameters,l=i.point,c=i.camera;let{scaleX:u,scaleY:h}=this._getScreenScale(e);u*=c.pixelRatio,h*=c.pixelRatio,jh(yq,r),e.attributes.has(R.FEATUREATTRIBUTE)&&S1t(yq);const p=e.attributes.get(R.POSITION),f=e.attributes.get(R.SIZE),g=e.attributes.get(R.NORMAL),y=e.attributes.get(R.CENTEROFFSETANDDISTANCE);_t(p.size>=3);const v=bD(a),b=this.parameters.centerOffsetUnits==="screen";for(let w=0;w<p.data.length/p.size;w++){const x=w*p.size;se(Ba,p.data[x],p.data[x+1],p.data[x+2]),ze(Ba,Ba,r);const S=w*f.size;d1[0]=f.data[S]*u,d1[1]=f.data[S+1]*h,ze(Ba,Ba,c.viewMatrix);const E=w*y.size;if(se(rh,y.data[E],y.data[E+1],y.data[E+2]),!b&&(Ba[0]+=rh[0],Ba[1]+=rh[1],rh[2]!==0)){const M=rh[2];me(rh,Ba),_e(Ba,Ba,oe(rh,rh,M))}const P=w*g.size;if(se(pM,g.data[P],g.data[P+1],g.data[P+2]),this._normalAndViewAngle(pM,yq,c,_q),this._applyVerticalOffsetTransformationView(Ba,_q,c,gq),c.applyProjection(Ba,Tl),Tl[0]>-1){b&&(rh[0]||rh[1])&&(Tl[0]+=rh[0]*c.pixelRatio,rh[1]!==0&&(Tl[1]+=jae(rh[1],gq.factorAlignment)*c.pixelRatio),c.unapplyProjection(Tl,Ba)),Tl[0]+=this.parameters.screenOffset[0]*c.pixelRatio,Tl[1]+=this.parameters.screenOffset[1]*c.pixelRatio,Tl[0]=Math.floor(Tl[0]),Tl[1]=Math.floor(Tl[1]),l4e(d1,gq.factor,d1);const M=A1t*c.pixelRatio;let L=0;if(a.textureIsSignedDistanceField&&(L=a.outlineSize*c.pixelRatio/2),y0e(l,Tl[0],Tl[1],d1,M,L,a,v)){const U=i.ray;if(ze(_0e,Ba,us(E1t,c.viewMatrix)),Tl[0]=l[0],Tl[1]=l[1],c.unprojectFromRenderScreen(Tl,Ba)){const z=C();he(z,U.direction);const W=1/Te(z);oe(z,z,W),o(Bi(U.origin,Ba)*W,z,-1,!0,1,_0e)}}}}}intersectDraped(e,r,i,n,s,o){const a=e.attributes.get(R.POSITION),l=e.attributes.get(R.SIZE),c=this.parameters,u=bD(c);let{scaleX:h,scaleY:p}=this._getScreenScale(e);h*=e.screenToWorldRatio,p*=e.screenToWorldRatio;const f=O1t*e.screenToWorldRatio;for(let g=0;g<a.data.length/a.size;g++){const y=g*a.size,v=a.data[y],b=a.data[y+1],w=g*l.size;d1[0]=l.data[w]*h,d1[1]=l.data[w+1]*p;let x=0;c.textureIsSignedDistanceField&&(x=c.outlineSize*e.screenToWorldRatio/2),y0e(n,v,b,d1,f,x,c,u)&&s(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new I1t(this)}_normalAndViewAngle(e,r,i,n){return V_t(r)&&(r=jh(T1t,r)),po(n.normal,e,r),ze(n.normal,n.normal,i.viewInverseTransposeMatrix),n.cosAngle=fe(q4e,M1t),n}_updateScaleInfo(e,r,i){const n=this.parameters;n.screenSizePerspective!=null?s0e(i,r,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),n.screenSizePerspectiveAlignment!=null?s0e(i,r,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,r,i,n,s,o,a){const l=this._normalAndViewAngle(r,i,s,_q);return this._applyVerticalGroundOffsetView(e,l,s,a),this._applyVerticalOffsetTransformationView(a,l,s,o),this._applyPolygonOffsetView(a,l,n[3],s,a),this._applyCenterOffsetView(a,n,a),a}applyShaderOffsetsNDC(e,r,i,n,s){return this._applyCenterOffsetNDC(e,r,i,n),s!=null&&he(s,n),this._applyPolygonOffsetNDC(n,r,i,n),n}_applyPolygonOffsetView(e,r,i,n,s){const o=n.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return he(s,e);const c=we(Math.abs(r.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/n.viewport[2];return oe(s,e,l>0?u:1/u),s}_applyVerticalGroundOffsetView(e,r,i,n){const s=Te(e),o=i.aboveGround?1:-1,a=i.computeRenderPixelSizeAtDist(s)*_4e,l=oe(Ba,r.normal,o*a);return ge(n,e,l),n}_applyVerticalOffsetTransformationView(e,r,i,n){var c;const s=this.parameters;if(!((c=s.verticalOffset)!=null&&c.screenLength)){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const u=Te(e);this._updateScaleInfo(n,u,r.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const o=Te(e),a=s.screenSizePerspectiveAlignment??s.screenSizePerspective,l=T4e(i,o,s.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(n,o,r.cosAngle),oe(r.normal,r.normal,l),ge(e,e,r.normal)}_applyCenterOffsetView(e,r,i){const n=this.parameters.centerOffsetUnits!=="screen";return i!==e&&he(i,e),n&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(me(pM,i),ge(i,i,oe(pM,pM,r[2])))),i}_applyCenterOffsetNDC(e,r,i,n){const s=this.parameters.centerOffsetUnits!=="screen";return n!==e&&he(n,e),s||(n[0]+=r[0]/i.fullWidth*2,n[1]+=r[1]/i.fullHeight*2),n}_applyPolygonOffsetNDC(e,r,i,n){const s=this.parameters.shaderPolygonOffset;if(e!==n&&he(n,e),s){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);n[2]-=(a||o)*s}return n}createGLMaterial(e){return new w1t(e)}calculateRelativeScreenBounds(e,r,i=Ht()){return x1t(this.parameters,e,r,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}_getScreenScale(e){const r=e.attributes.get(R.FEATUREATTRIBUTE);if(r==null)return{scaleX:1,scaleY:1};const i=use(r.data,P1t),[n,s]=qae(C1t,this.parameters,i);return{scaleX:n,scaleY:s}}},w1t=class extends hae{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(j4e,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function x1t(t,e,r,i){i[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*r,i[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*r}function S1t(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=1/Math.sqrt(e*e+r*r+i*i),h=1/Math.sqrt(n*n+s*s+o*o),p=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*u,t[1]=r*u,t[2]=i*u,t[3]=n*h,t[4]=s*h,t[5]=o*h,t[6]=a*p,t[7]=l*p,t[8]=c*p,t}function y0e(t,e,r,i,n,s,o,a){let l=e-n-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*n,u=r-n-(a[1]>0?i[1]*a[1]:0),h=u+i[1]+2*n;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&p!=null&&(l+=i[0]*p[0],u+=i[1]*p[1],c-=i[0]*(1-p[2]),h-=i[1]*(1-p[3]),l-=s,c+=s,u-=s,h+=s),t[0]>l&&t[0]<c&&t[1]>u&&t[1]<h}const gq=new A4e,Ba=C(),pM=C(),Tl=tr(),q4e=C(),_0e=C(),yq=gi(),T1t=gi(),E1t=xe(),rh=C(),C1t=C(),P1t=tr(),_q={normal:q4e,cosAngle:0},A1t=1,O1t=2,d1=[0,0],M1t=Ce(0,0,1);let R1t=class extends uDe{constructor(){super(...arguments),this.renderOccluded=Wr.Occlude,this.isDecoration=!1,this.color=Xt(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=mr(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=Xt(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1}};const W4e=ln().vec3f(R.POSITION).vec3f(R.NORMAL).vec2f(R.UV0).vec4u8(R.COLOR).vec2f(R.SIZE).vec4f(R.CENTEROFFSETANDDISTANCE).vec4f(R.FEATUREATTRIBUTE),$1t=W4e.clone().vec4u8(R.OBJECTANDLAYERIDCOLOR);let I1t=class{constructor(e){this._material=e,this.vertexBufferLayout=ne("enable-feature:objectAndLayerId-rendering")?$1t:W4e}elementCount(e){return 6*e.attributes.get(R.POSITION).indices.length}write(e,r,i,n,s){var b;Qae(i.attributes.get(R.POSITION),e,n.position,s,6),Kae(i.attributes.get(R.NORMAL),r,n.normal,s,6);const o=i.attributes.get(R.UV0).data;let a,l,c,u;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],u=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let h=i.attributes.get(R.POSITION).indices.length,p=s;const f=n.uv0;for(let w=0;w<h;++w)f.set(p,0,a),f.set(p,1,l),p++,f.set(p,0,c),f.set(p,1,l),p++,f.set(p,0,c),f.set(p,1,u),p++,f.set(p,0,c),f.set(p,1,u),p++,f.set(p,0,a),f.set(p,1,u),p++,f.set(p,0,a),f.set(p,1,l),p++;M4e(i.attributes.get(R.COLOR),4,n.color,s,6);const{data:g,indices:y}=i.attributes.get(R.SIZE);h=y.length;const v=n.size;p=s;for(let w=0;w<h;++w){const x=g[2*y[w]],S=g[2*y[w]+1];for(let E=0;E<6;++E)v.set(p,0,x),v.set(p,1,S),p++}if(i.attributes.get(R.CENTEROFFSETANDDISTANCE)?gA(i.attributes.get(R.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,s,6):m0e(n.centerOffsetAndDistance,s,6*h),i.attributes.get(R.FEATUREATTRIBUTE)?gA(i.attributes.get(R.FEATUREATTRIBUTE),n.featureAttribute,s,6):m0e(n.featureAttribute,s,6*h),i.objectAndLayerIdColor!=null){const w=(b=i.attributes.get(R.POSITION))==null?void 0:b.indices;if(w){const x=w.length,S=n.getField(R.OBJECTANDLAYERIDCOLOR,dl);R4e(i.objectAndLayerIdColor,S,x,s,6)}}}};const Lm=C(),uE=tr(),fM=tr(),vq=C(),L1t=xe(),D1t=hs(),bq=fo(),N1t=C(),F1t=Ht();class k1t{constructor(){this.aabr=Ht(),this.distance=0,this.culled=!1,this.visible=!1}}class U1t{constructor(e,r){this.graphics3DGraphic=e,this.slicePlaneEnabled=r,this.info={}}}var au;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(au||(au={}));class z1t{constructor(){this.camera=new st,this.slicePlane=A_(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),E2(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let h3=class extends Pe{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._viewState=new z1t,this._state=au.Idle,this._active=new Map,this._visible=new Map,this._iterators=new j1t,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==au.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/au.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case au.Idle:this._startUpdate(),t.madeProgress();case au.Process:if(this._state=au.Process,!this._processActiveGraphics(t))return;case au.Sort:if(this._state=au.Sort,!this._sortVisibleGraphics(t))return;case au.Deconflict:if(this._state=au.Deconflict,!this._deconflictVisibleGraphics(t))return;default:M_t(this,this._visible),this._state=au.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(r=>this.addToActiveGraphics(r)):t.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;if(((e==null?void 0:e.geometries.length)??0)!==1)return!1;const r=e==null?void 0:e.geometries[0];return(r==null?void 0:r.material)instanceof yA}_startUpdate(){R_t(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._viewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new k1t,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),V1t(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),r=zA(L1t,this._viewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._viewState.camera.relativeElevation>0?D1t:null;let n=0;for(i!=null&&(ze(i,Yn,this._viewState.camera.viewMatrix),i[3]=zr(this.view.spatialReference).radius,n=NRe(i,Yn));!t.done;){t.madeProgress();const s=e.next();if(s.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=s.value,a=o==null?void 0:o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,n),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const r=e.next();if(t.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===Uo.LABEL;for(;!t.done;){t.madeProgress();const i=e.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const n=i.value,s=n.info[this.visibilityGroup];if(!s||s.culled){this._setGraphicVisibility(n,!1);continue}const o=n.graphics3DGraphic,a=!r||o.isVisible();s.visible=a&&!this._isConflicted(n),s.visible&&this._addToBins(n),this._setGraphicVisibility(n,s.visible),I_t(s,s.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=v0e(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=v0e(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=B1t(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,r,i){const n=t.graphics3DGraphic;if(n.destroyed)return;const s=t.info[this.visibilityGroup];if(!n.isVisible(Uo.GRAPHIC,Da.DECONFLICTION))return void(s.culled=!0);const o=this.getGraphicsLayers(n);kc(s.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=W1t,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,Lm)||r!=null&&this._isCulledByHorizon(a,r,i)))return void(s.culled=!0);this._expandBoundingRect(s,l,c,a)}a==null?s.culled=!0:(s.distance=a.distance,s.culled=!1)}_getProjectionInfo(t,e,r){const i=this._viewState.camera,n=t.stageObject,s=n.geometries[0],o=s.material,a=n.boundingVolumeWorldSpace.bounds;ze(Lm,a,i.viewMatrix);const l=s.attributes,c=l.get(R.NORMAL).data,u=l.get(R.CENTEROFFSETANDDISTANCE).data;o.applyShaderOffsetsView(Lm,c,n.transformation,u,i,r.scaleInfo,Lm),pn(uE,Lm[0],Lm[1],Lm[2],1),Mu(fM,uE,i.projectionMatrix),oe(r.positionNDC,fM,1/fM[3]),o.applyShaderOffsetsNDC(r.positionNDC,u,i,r.positionNDC,vq),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(vq[2]),r.distance=vq[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),pn(fM,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),Mu(uE,fM,e),WT(uE,uE,1/uE[3]),se(r.positionView,Lm[0],Lm[1],Lm[2])}_isCulledByHorizon(t,e,r){return he(bq.direction,t.positionView),se(bq.origin,0,0,0),!!cw(e,bq,N1t)&&t.distanceWithoutPolygonOffset>r}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&voe(this._viewState.slicePlane,e)}_expandBoundingRect(t,e,r,{positionNDC:i,scaleInfo:n}){const s=this._viewState.camera,o=e.getScreenSize(H1t);l4e(o,n.factor,o),o[0]*=s.pixelRatio,o[1]*=s.pixelRatio;const a=Sz(r.calculateRelativeScreenBounds(o,n.factorAlignment.scale,F1t),Dt(0,s.fullWidth,.5+.5*i[0]),Dt(0,s.fullHeight,.5+.5*i[1])),l=this.marginFactor;if(l!==0){const c=l*Math.min(sl(a),Mc(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}ab(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,r=t.info[this.visibilityGroup];let i=!0;for(let n=Math.floor(r.aabr[0]/this._accBinsSizeX);n<=Math.floor(r.aabr[2]/this._accBinsSizeX);n++)if(!(n<0||n>=this._accBinsNumX))for(let s=Math.floor(r.aabr[1]/this._accBinsSizeY);s<=Math.floor(r.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;i=!1;const o=this._accBins[n][s];for(let a=0;a<o.length;a++){const l=o.data[a],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,lN(c.aabr,r.aabr)))return!0}}return i}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let n=0;n<this._accBinsNumY;n++)i.push(new jt)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],r=Math.floor(e.aabr[0]/this._accBinsSizeX),i=Math.floor(e.aabr[2]/this._accBinsSizeX),n=Math.floor(e.aabr[1]/this._accBinsSizeY),s=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=n;a<=s;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const r=t.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(this.visibilityGroup,Da.DECONFLICTION,e),this.visibilityGroup===Uo.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,e))}};function V1t(t,e){const r=t.graphics3DGraphic;r.destroyed||r.setVisibilityFlag(e,Da.DECONFLICTION,!0)}function*v0e(t){if(Map.prototype.entries){const e=t.entries();for(let r=e.next();!r.done;r=e.next())yield r.value[1]}else yield*t.values()}function*B1t(t,e,r){e.clear(),t.forEach((n,s)=>{var l;const o=e.pushNew();o.id=s,o.visible=n.graphics3DGraphic.getVisibilityFlag(r,Da.DECONFLICTION);const a=(l=n.info)==null?void 0:l[r];o.prio=n.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const i=e.iterableSort((n,s)=>n.prio!==s.prio?s.prio-n.prio:n.distance!==s.distance?n.distance-s.distance:n.visible!==s.visible?n.visible?-1:1:n.id-s.id);for(let n=i.next();!n.done;n=i.next())yield;e.forAll(n=>{const s=t.get(n.id);s&&(t.delete(n.id),t.set(n.id,s))}),e.clear()}d([m({constructOnly:!0})],h3.prototype,"view",void 0),d([m({type:Boolean,readOnly:!0})],h3.prototype,"updating",null),h3=d([F("esri.views.3d.layers.graphics.Deconflictor")],h3);class G1t{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class j1t{constructor(e=null,r=null,i=null){this.active=e,this.visible=r,this.sort=i,this.sortArray=new jt({allocator:n=>n||new G1t})}}const H1t=Ye();class q1t{constructor(){this.positionView=C(),this.positionNDC=C(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new A4e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const W1t=new q1t,Y1t=2e3;let m8=class extends h3{constructor(e){super(e),this.visibilityGroup=Uo.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return pa;const r=performance.now();if(e.state!==Xr.IDLE&&r-this._lastDeconfliction<Y1t)return pa;super.runTask(e),this.state===au.Idle&&(this._lastDeconfliction=r)}enabledChanged(e,r){this.modifyGraphics(r,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};d([m({constructOnly:!0})],m8.prototype,"parent",void 0),m8=d([F("esri.views.3d.layers.graphics.LabelDeconflictor")],m8);let Uee=class extends h3{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=Uo.GRAPHIC,this._marginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([pe(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.state)==null?void 0:r.camera},()=>{this._updateViewState(),this.setDirty()}),pe(()=>{var e,r,i;return(i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity},(e,r)=>{e!==1&&r!==1||this.setDirty()}),pe(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},mi)]),this._frameTask=this.view.resourceController.scheduler.registerTask(Ct.GRAPHICS_DECONFLICTOR,this),this._labels=new m8({view:this.view,parent:this})}destroy(){this._labels=Me(this._labels),this._frameTask=Pi(this._frameTask)}get marginFactor(){return this._marginFactor}set marginFactor(e){this._marginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,r){const i=!(this._graphicSupportsDeconfliction(r)&&wq(e));r.setVisibilityFlag(Uo.GRAPHIC,Da.DECONFLICTION,i)}_updateViewState(){var e;(e=this.view)!=null&&e.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&ARe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){Hd(this._contexts,(e,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const r=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,r,i),removeGraphic:i=>this._removeGraphic(r,i),labelingInfoChange:()=>this._labels.enabledChanged(e,r),featureReductionChange:()=>this.enabledChanged(e,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,r),clear:()=>r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic))}}removeGraphicsOwner(e){const r=this._contexts.get(e);r&&(r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,r,i){const n=i.graphic.uid,s=new U1t(i,e.symbolCreationContext.slicePlaneEnabled);r.set(n,s),wq(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,r){const i=r.graphic.uid,n=e.get(i);n&&(this.removeFromActiveGraphics(n),this._labels.removeFromActiveGraphics(n),e.delete(i),this.setDirty())}enabledChanged(e,r){const i=wq(e);i||X1t(e),this.modifyGraphics(r,i)}_slicePlaneEnabledChanged(e,r){const i=e.symbolCreationContext.slicePlaneEnabled;r.forEach(n=>n.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const r=e.layers;if(!(r!=null&&r.length))return!1;for(const i of r)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const r=this._contexts.get(e);if(r)return r;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function wq(t){const e=t.layer;return!(!(e!=null&&e.featureReduction)||e.featureReduction.type!=="selection")}function X1t(t){const e=t.graphics3DGraphics;e&&e.forEach(r=>r.setVisibilityFlag(Uo.GRAPHIC,Da.DECONFLICTION,!0))}Uee=d([F("esri.views.3d.layers.graphics.GraphicsDeconflictor")],Uee);function Y4e(t){return"declaredClass"in t}function b0e(t){return"declaredClass"in t}function Z1t(t){return"declaredClass"in t}function J1t(t,e){return t?Z1t(t)?t:new Hu({layer:e,sourceLayer:e,visible:t.visible,symbol:ae(t.symbol),attributes:ae(t.attributes),geometry:X4e(t.geometry)}):null}function X4e(t){return t==null?null:Y4e(t)?t:Sb(Q1t(t))}function Q1t(t){const{wkid:e,wkt:r,wkt2:i,latestWkid:n}=t.spatialReference,s={wkid:e,wkt:r,wkt2:i,latestWkid:n};switch(t.type){case"point":{const{x:o,y:a,z:l,m:c}=t;return{x:o,y:a,z:l,m:c,spatialReference:s}}case"polygon":{const{rings:o,hasZ:a,hasM:l}=t;return{rings:w0e(o),hasZ:a,hasM:l,spatialReference:s}}case"polyline":{const{paths:o,hasZ:a,hasM:l}=t;return{paths:w0e(o),hasZ:a,hasM:l,spatialReference:s}}case"extent":{const{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:h,mmin:p,mmax:f,hasZ:g,hasM:y}=t;return{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:h,mmin:p,mmax:f,hasZ:g,hasM:y,spatialReference:s}}case"multipoint":{const{points:o,hasZ:a,hasM:l}=t;return{points:J4e(o)?Z4e(o):o,hasZ:a,hasM:l,spatialReference:s}}default:return}}function w0e(t){return K1t(t)?t.map(e=>Z4e(e)):t}function Z4e(t){return t.map(e=>Array.from(e))}function K1t(t){for(const e of t)if(e.length!==0)return J4e(e);return!1}function J4e(t){return t.length>0&&(XD(t[0])||ZD(t[0]))}function evt(t,e){if(!t)return null;let r;if(b0e(t)){if(e==null)return t.clone();if(b0e(e))return e.copy(t)}return e!=null?(r=e,r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=uw(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0)),r}function _er(t){const{wkid:e,wkt:r,wkt2:i,latestWkid:n}=t,s={wkid:e,wkt:r,wkt2:i,latestWkid:n};return Ve.fromJSON(s)}const tle="__begin__",rle="__end__",tvt=new RegExp(tle,"ig"),rvt=new RegExp(rle,"ig"),x0e=new RegExp("^"+tle,"i"),S0e=new RegExp(rle+"$","i"),L9='"',ivt=L9+" + ",nvt=" + "+L9;function svt(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function ovt(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function uG(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=svt(t.labelExpression),e.type="conventional"),e}function avt(t){const e=uG(t);if(!e)return null;switch(e.type){case"conventional":return zee(e.expression);case"arcade":return e.expression}return null}function lvt(t){const e=uG(t);if(!e)return null;switch(e.type){case"conventional":return uvt(e.expression);case"arcade":return ile(e.expression)}return null}function zee(t){let e;return t?(e=une(t,r=>tle+'$feature["'+r+'"]'+rle),e=x0e.test(e)?e.replace(x0e,""):L9+e,e=S0e.test(e)?e.replace(S0e,""):e+L9,e=e.replaceAll(tvt,ivt).replaceAll(rvt,nvt)):e='""',e}const cvt=/^\s*\{([^}]+)\}\s*$/i;function uvt(t){const e=t==null?void 0:t.match(cvt);return(e==null?void 0:e[1].trim())||null}const hvt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,dvt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,pvt=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function ile(t){if(!t)return null;let e=hvt.exec(t)||dvt.exec(t);return e?e[1]||e[3]:(e=pvt.exec(t),e?e[2]:null)}const xq=()=>K.getLogger("esri.layers.support.labelFormatUtils"),Sq={type:"simple",evaluate:()=>null},fvt={getAttribute:(t,e)=>t.field(e)};async function mvt(t,e,r){if(!t||!t.symbol||!e)return Sq;const i=t.where,n=uG(t);let s;if(n.type==="arcade"){const o=await Ict(n.expression,r,e);if(o==null)return Sq;s={type:"arcade",evaluate(a,l){try{const c="attributes"in a?o.repurposeFeature(a):a;c.contextTimeZone=l??null;const u=o.evaluate({$view:{timeZone:l},$feature:c},o.services);if(u!=null)return u.toString()}catch(c){xq().error(new B("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:a,expression:n}))}return null},needsHydrationToEvaluate:()=>ile(n.expression)==null}}else s={type:"simple",evaluate:o=>n.expression.replaceAll(/{[^}]*}/g,a=>{const l=a.slice(1,-1),c=e.get(l);if(!c)return a;let u=null;return"attributes"in o?o&&o.attributes&&(u=o.attributes[c.name]):u=o.field(c.name),u==null?"":gvt(u,c)})};if(i){let o;try{o=await Foe(i,e)}catch(l){return xq().error(new B("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:l})),Sq}const a=s.evaluate;s.evaluate=(l,c)=>{const u="attributes"in l?void 0:fvt;try{if(o.testFeature(l,u))return a(l,c)}catch(h){xq().error(new B("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:l,error:h}))}return null}}return s}function gvt(t,e){if(t==null)return"";const r=e.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const n=t;for(const s of r.codedValues)if(s.code===n)return s.name}else if(r.type==="range"){const{max:n,min:s}=uIe(e),o=+t;if(s!=null&&n!=null&&s<=o&&o<=n)return r.name}}let i=t;return vIe(e)?i=_7(i,Qnt("short-date")):zoe(e)&&(i=tst(+i)),i||""}function Q4e(t,e,r,i,n,s,o,a,l,c,u){const h=Tvt[u.mode];let p,f,g=0;if(an(t,e,r,i,l.spatialReference,n,a))return h.requiresAlignment(u)?(g=h.applyElevationAlignmentBuffer(i,n,s,o,a,l,c,u),p=s,f=o):(p=i,f=n),an(p,l.spatialReference,f,s,c.spatialReference,o,a)?g:void 0}function qb(t,e,r,i,n){const s=(Kz(t)?t.z:M$e(t)?t.array[t.offset+2]:t[2])||0;switch(r.mode){case"on-the-ground":{const o=kg(e,t,"ground")??0;return n.verticalDistanceToGround=0,n.sampledElevation=o,void(n.z=o)}case"relative-to-ground":{const o=kg(e,t,"ground")??0,a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"relative-to-scene":{const o=kg(e,t,"scene")??0,a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(s,i),a=kg(e,t,"ground")??0;return n.verticalDistanceToGround=o-a,n.sampledElevation=a,void(n.z=o)}default:return void(n.z=0)}}function yvt(t,e,r,i){return qb(t,e,r,i,d3),d3.z}function NN(t,e,r){return e==null||r==null?t.definedChanged:e==="on-the-ground"&&r==="on-the-ground"?t.staysOnTheGround:e===r||e!=="on-the-ground"&&r!=="on-the-ground"?Dn.UPDATE:t.onTheGroundChanged}function mp(t){return t==="relative-to-ground"||t==="relative-to-scene"}function Wb(t){return t!=="absolute-height"}function _vt(t,e,r,i,n){qb(e,r,n,i,d3),K4e(t,d3.verticalDistanceToGround);const s=d3.sampledElevation,o=cs(Evt,t.transformation);return aF[0]=e.x,aF[1]=e.y,aF[2]=d3.z,Ua(e.spatialReference,aF,o,i.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function K4e(t,e){for(let r=0;r<t.geometries.length;++r){const i=t.geometries[r].getMutableAttribute(R.CENTEROFFSETANDDISTANCE);i&&i.data[3]!==e&&(i.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[r],R.CENTEROFFSETANDDISTANCE))}}function vvt(t,e,r,i,n,s){let o=0;const a=s.spatialReference;e*=3,i*=3;for(let l=0;l<n;++l){const c=t[e],u=t[e+1],h=t[e+2],p=s.getElevation(c,u,h,a,"ground")??0;o+=p,r[i]=c,r[i+1]=u,r[i+2]=p,e+=3,i+=3}return o/n}function bvt(t,e,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=s.spatialReference;e*=3,i*=3;for(let p=0;p<n;++p){const f=t[e],g=t[e+1],y=t[e+2],v=s.getElevation(f,g,y,h,"ground")??0;l+=v,r[i]=f,r[i+1]=g,r[i+2]=u==null?y+v+c:v+c,e+=3,i+=3}return l/n}function wvt(t,e,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=s.spatialReference;e*=3,i*=3;for(let p=0;p<n;++p){const f=t[e],g=t[e+1],y=t[e+2],v=s.getElevation(f,g,y,h,"scene")??0;l+=v,r[i]=f,r[i+1]=g,r[i+2]=u==null?y+v+c:v+c,e+=3,i+=3}return l/n}function xvt(t){const e=t.meterUnitOffset,r=t.featureExpressionInfoContext;return e!==0||r!=null}function Svt(t,e,r,i,n,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,i*=3;for(let u=0;u<n;++u){const h=t[e],p=t[e+1],f=t[e+2];r[i]=h,r[i+1]=p,r[i+2]=c==null?f+l:l,e+=3,i+=3}return 0}let FN=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var Dn;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(Dn||(Dn={}));const Tvt={"absolute-height":{applyElevationAlignmentBuffer:Svt,requiresAlignment:xvt},"on-the-ground":{applyElevationAlignmentBuffer:vvt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:bvt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:wvt,requiresAlignment:()=>!0}},Evt=xe(),d3=new FN,aF=C();function nle(t){return t.mapPositions!=null}function e5e(t,e,r,i,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!nle(l))continue;const{update:c,averageGeometrySampledElevation:u}=r5e(l,e,r,i,n);a+=u,c&&s.geometryVertexAttributeUpdated(l,R.POSITION)}return a/o.length}function xT(t,e,r,i,n,s){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(i(a,Pc),K4e(o,Pc.verticalDistanceToGround),l=Pc.sampledElevation):(i(a,Pc),e.mode!=="absolute-height"&&(l=Pc.sampledElevation));const c=cs(Cvt,s??o.transformation),u=se(t5e,c[12],c[13],c[14]);Si.TESTS_DISABLE_OPTIMIZATIONS?(Cc[0]=a.x,Cc[1]=a.y,Cc[2]=Pc.z,Ua(a.spatialReference,Cc,c,n.spatialReference)&&(s?cs(s,c):o.transformation=c)):n.setAltitudeOfTransformation(Pc.z,c);const h=sle/n.unitInMeters;return(Math.abs(c[12]-u[0])>=h||Math.abs(c[13]-u[1])>=h||Math.abs(c[14]-u[2])>=h)&&(s?cs(s,c):o.transformation=c),l}const Cvt=xe();function Pvt(t,e,r,i,n){const s=t.graphics3DSymbolLayer.lodRenderer;if(s==null)return 0;const o=e.centerPointInElevationSR;i(o,Pc);const a=e.mode!=="absolute-height"?Pc.sampledElevation:0,l=s.instanceData,c=t.instanceIndex,u=Ovt;l.getGlobalTransform(c,u);const h=se(t5e,u[12],u[13],u[14]);Si.TESTS_DISABLE_OPTIMIZATIONS?(Cc[0]=o.x,Cc[1]=o.y,Cc[2]=Pc.z,Ua(o.spatialReference,Cc,u,n.spatialReference)&&l.setGlobalTransform(c,u)):n.setAltitudeOfTransformation(Pc.z,u);const p=sle/n.unitInMeters;return(Si.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-h[0])>=p||Math.abs(u[13]-h[1])>=p||Math.abs(u[14]-h[2])>=p)&&l.setGlobalTransform(c,u),a}function Avt(t,e,r,i,n){const s=t.stageObject,o=s.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const h of o){if(!nle(h))continue;const p=h.attributes.get(R.POSITION);if(p!==l){const{update:f,averageGeometrySampledElevation:g}=r5e(h,e,r,i,n);c=g,l=p,u=f}u&&s.geometryVertexAttributeUpdated(h,R.POSITION),a+=c}return a/o.length}const sle=.01,Cc=C(),id=C(),hE=C(),Ovt=xe(),t5e=C(),Pc=new FN;function r5e(t,e,r,i,n){let s=!1;const o=t.transformation,a=e.requiresSampledElevationInfo;id[0]=o[12],id[1]=o[13],id[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(R.POSITION),c=l.data,u=l.size,h=c.length/u,p=new $oe(t.mapPositions,r);let f=0,g=0;for(let y=0;y<h;y++){if(hE[0]=c[f],hE[1]=c[f+1],hE[2]=c[f+2],i(p,Pc),a&&(g+=Pc.sampledElevation),Si.TESTS_DISABLE_OPTIMIZATIONS)c[f]=p.array[p.offset],c[f+1]=p.array[p.offset+1],c[f+2]=Pc.z,an(c,r,f,c,n.spatialReference,f,1),c[f]-=id[0],c[f+1]-=id[1],c[f+2]-=id[2],s=!0;else{Cc[0]=c[f]+id[0],Cc[1]=c[f+1]+id[1],Cc[2]=c[f+2]+id[2],n.setAltitude(Cc,Pc.z),c[f]=Cc[0]-id[0],c[f+1]=Cc[1]-id[1],c[f+2]=Cc[2]-id[2];const v=sle/n.unitInMeters;(Math.abs(hE[0]-c[f])>=v||Math.abs(hE[1]-c[f+1])>=v||Math.abs(hE[2]-c[f+2])>=v)&&(s=!0)}f+=u,p.offset+=3}return g/=h,{update:s,averageGeometrySampledElevation:g}}function Mvt(t){return!!t&&pA[t]!=null}function i5e(t){return 1/(pA[t]||1)}function Rvt(){const t=Object.keys(pA);return t.sort(),t}const $vt=Rvt(),Ivt=()=>K.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Lvt(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function ber(t){const e=t==null?void 0:t.expression;if(typeof e=="string"){const r=o5e(e);if(r!=null)return{cachedResult:r}}return null}async function wer(t,e,r,i){const n=t==null?void 0:t.expression;if(typeof n!="string")return null;const s=o5e(n);if(s!=null)return{cachedResult:s};const o=await Ub();dt(r);const a=o.arcadeUtils,l=a.createSyntaxTree(n);return a.dependsOnView(l)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function n5e(t,e,r){return t.arcadeUtils.createFeature(e.attributes,e.geometry,r)}function hG(t,e){if(t!=null&&!s5e(t)){if(!e||!t.arcade)return void Ivt().errorOncePerTick("Arcade support required but not provided");const r=e;r._geometry&&(r._geometry=X4e(r._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function Dvt(t){if(t!=null){if(s5e(t))return t.cachedResult;const e=t.arcade;let r=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof r!="number"&&(t.cachedResult=0,r=0),r}return 0}function xer(t,e=!1){let r=t==null?void 0:t.featureExpressionInfo;const i=r==null?void 0:r.expression;return e||i==="0"||(r=null),r??null}const Nvt={cachedResult:0};function s5e(t){return t.cachedResult!=null}function o5e(t){return t==="0"?0:null}let D9=class a5e{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=i5e(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:e+i}calculateOffsetRenderUnits(e){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=Dvt(i)*this._metersPerElevationInfoUnit),r/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Mvt(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,r,i){if(e==null)return void(this._featureExpressionInfoContext=null);const n=e==null?void 0:e.arcade;n&&r!=null&&i!=null?(this._featureExpressionInfoContext=Lvt(e),hG(this._featureExpressionInfoContext,n5e(n.modules,r,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const r=new a5e;return e!=null&&r.setFromElevationInfo(e),r}},Fvt=class{constructor(e,r,i){this.graphic=e,this.renderingInfo=r,this.layer=i}};function ole(t,e){if(t.type==="point")return p1(t,e,!1);if(Y4e(t))switch(t.type){case"extent":return p1(t.center,e,!1);case"polygon":return p1(t.centroid,e,!1);case"polyline":return p1(T0e(t),e,!0);case"mesh":return p1(t.origin,e,!1)}else switch(t.type){case"extent":return p1(kvt(t),e,!0);case"polygon":return p1(Uvt(t),e,!0);case"polyline":return p1(T0e(t),e,!0)}}function T0e(t){const e=t.paths[0];if(!e||e.length===0)return null;const r=wPe(e,bPe(e)/2);return uw(r[0],r[1],r[2],t.spatialReference)}function kvt(t){return uw(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function Uvt(t){const e=t.rings[0];if(!e||e.length===0)return null;const r=SPe(t.rings,!!t.hasZ);return uw(r[0],r[1],r[2],t.spatialReference)}function p1(t,e,r){const i=r?t:evt(t);return e&&t?eOe(t,i,e)?i:null:i}function Ter(t,e,r,i=0){if(t){e||(e=Ht());const n=t;let s=.5*n.width*(r-1),o=.5*n.height*(r-1);return n.width<1e-7*n.height?s+=o/20:n.height<1e-7*n.width&&(o+=s/20),pn(e,n.xmin-s-i,n.ymin-o-i,n.xmax+s+i,n.ymax+o+i),e}return null}function UI(t,e,r=null){const i=uN(Bd);return t!=null&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),e!=null?i[3]=e:t!=null&&t.length>3&&(i[3]=t[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function Eer(t,e,r,i,n,s=[0,0,0,0]){for(let o=0;o<3;++o)s[o]=(t==null?void 0:t[o])!=null?t[o]:(r==null?void 0:r[o])!=null?r[o]:n[o];return s[3]=e??i??n[3],s}function E0e(t=Fg,e,r,i=1){const n=new Array(3);if(e==null||r==null)n[0]=1,n[1]=1,n[2]=1;else{let s,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const u=l!=null,h=a===0&&!s&&!u,p=r[a];l==="symbol-value"||h?c=p!==0?e[a]/p:1:u&&l!=="proportional"&&isFinite(l)&&(c=p!==0?l/p:1),c!=null&&(n[a]=c,s=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)n[a]==null?n[a]=s:n[a]===0&&(n[a]=.001*o)}for(let s=2;s>=0;s--)n[s]/=i;return Ka(n)}function zvt(t){return t.isPrimitive!=null}function dG(t){return Vee(zvt(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function Vee(t){const e=r=>r==null||r>=0;return Array.isArray(t)?t.every(e):e(t)}function Vvt(t,e,r,i=xe()){return t&&UP(i,i,-t/180*Math.PI),e&&kP(i,i,e/180*Math.PI),r&&xB(i,i,r/180*Math.PI),i}function ale(t,e,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=fl(e),n=b2(t)*i,s=w2(t)*i,o=aw(t)*(e.isGeographic?1:i);return n===0&&s===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(n,s,o)}var ir;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(ir||(ir={}));let Bvt=class{constructor(e,r,i){this.baseMaterial=e,this.edgeMaterials=r,this.properties=i}},Ey=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,r,i,n,s,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=n,this._sharedResource=s,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const r=e.stage;r.addMany(this._uniqueMaterials),r.addMany(this._uniqueGeometries),r.add(this.stageObject)}destroy(){var r,i;if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),(r=e.renderer.edgeView)==null||r.removeObject(this.stageObject),this.stageObject.dispose(),(i=this._sharedResource)==null||i.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,r){if(this._edgeState==null)return;const i=C0e(this._edgeState.baseMaterial);let n=!1;for(const s of this._edgeState.edgeMaterials)s.objectTransparency!==i&&(s.objectTransparency=i,n=!0);n&&this.resetEdgeObject(r),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,r){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!r),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const r=this._stageLayer.stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(e,r,i,n){if(this.elevationAligner==null)return;i!=null&&hG(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>qb(o,e,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,r),this.resetEdgeObject(n)}alignWithAbsoluteElevation(e,r,i){const n=(s,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,n,r),this.resetEdgeObject(i)}getCenterObjectSpace(e=C()){return he(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=Ds()){const r=this.stageObject.boundingVolumeObjectSpace;return NAe(e,r.min),FAe(e,r.max),e}computeAttachmentOrigin(e){const r=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=r[12],e.render.origin[1]+=r[13],e.render.origin[2]+=r[14],e.render.num++;else for(const i of this.stageObject.geometries)i.computeAttachmentOrigin(Ny)&&(ze(Ny,Ny,r),ge(e.render.origin,e.render.origin,Ny),e.render.num++)}async getProjectedBoundingBox(e,r,i,n,s){const o=this.getBoundingBoxObjectSpace(s),a=Gvt,l=Sse(o)?1:a.length;for(let u=0;u<l;u++){const h=a[u];f1[0]=o[h[0]],f1[1]=o[h[1]],f1[2]=o[h[2]],ze(f1,f1,this.stageObject.transformation),Bw[3*u]=f1[0],Bw[3*u+1]=f1[1],Bw[3*u+2]=f1[2]}if(!e(Bw,0,l))return null;zi(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let h=0;h<3;h++)o[h]=Math.min(o[h],Bw[u+h]),o[h+3]=Math.max(o[h+3],Bw[u+h]);c&&i.push({location:Bw.slice(u,u+3),screenSpaceBoundingRect:c})}if(r!=null&&r.service&&this.elevationContext.mode!=="absolute-height"){kf(o,Ny);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let h=0;if(r.useViewElevation)h=r.service.getElevation(Ny[0],Ny[1],u)??0;else try{const p=ale(o,r.service.spatialReference,r);h=await r.service.queryElevation(Ny[0],Ny[1],n,p,u)??0}catch{}DAe(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,r){e===h_.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),e===h_.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(this._edgeState==null)return;const r=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,e):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,r){const i=this._edgeState;if(i==null)return;const n=C0e(i.baseMaterial);for(const s of i.edgeMaterials)s.objectTransparency=n;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var s;return(s=this._stageLayer)==null?void 0:s.sync()})}};function C0e(t){return t.isVisible()?t.parameters.transparent?ir.TRANSPARENT:ir.OPAQUE:ir.INVISIBLE}const Bw=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f1=C(),Ny=C(),Gvt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let l5e=class{constructor(e,r=null){this.labelText=r,this.elevationOffset=e??0}};const c5e=3,Bee=3,u5e=10;let h5e=class{constructor(e,r=null){this.geometry=e,this.textures=r}},d5e=class{constructor(e,r,i){this.components=e,this.minScreenSpaceRadius=r,this.pivotOffset=i;const n=this.geometries;this.numVertices=n.reduce((s,o)=>s+o.attributes.get(R.POSITION).indices.length,0)}get geometries(){return XV(this.components.map(e=>e.geometry))}},p5e=class{constructor(e){this.levels=e,this.levels.sort((r,i)=>r.minScreenSpaceRadius===i.minScreenSpaceRadius?r.numVertices-i.numVertices:r.minScreenSpaceRadius-i.minScreenSpaceRadius)}};function lF(t){const e=[];return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry.material))),XV(e)}function P0e(t){const e=new Array;return t.levels.forEach(r=>r.components.forEach(i=>{i.textures!=null&&e.push(...i.textures)})),XV(e)}function A0e(t){const e=new Array;return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry))),XV(e)}function jvt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function f5e(t,e){const r=(i,n,s=!1)=>new p5e(i.map(o=>{const a=n(o.tesselation);return s&&Tmt(a),new d5e([new h5e(a)],o.minScreenSpaceRadius)}));switch(t){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>wmt(e,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>dmt(e,1));case"cone":return r(Tq,i=>Wge(e,1,.5,i,!1),!0);case"inverted-cone":return r(Tq,i=>Wge(e,1,.5,i,!0),!0);case"cylinder":return r(Tq,i=>Smt(e,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>bmt(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>gmt(e,1),!0);default:return}}const Tq=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let Rd=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new m5e}},lle=class extends Rd{constructor(e){super(e),this.estimated=!0}},Hvt=class extends Rd{constructor(e,r){super(r),this.numComplexities=e}},qvt=class extends lle{constructor(e,r){super(r),this.numComplexities=e}},m5e=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function Wvt(t){return t.type==="fill"}function Yvt(t){return t.type==="extrude"}function Xvt(t){return t&&t.enabled&&(Yvt(t)||Wvt(t))&&t.edges!=null}function Zvt(t){return t&&t.enabled&&t.edges||null}function g5e(t,e){return y5e(Zvt(t),e)}function y5e(t,e){if(t==null)return null;const r=t.color!=null?use(De.toUnitRGBA(t.color)):Xt(0,0,0,0),i=bs(t.size),n=bs(t.extensionLength);switch(t.type){case"solid":return _5e({color:r,size:i,extensionLength:n,...e});case"sketch":return Jvt({color:r,size:i,extensionLength:n,...e});default:return}}function _5e(t){return{...Qvt,...t,type:"solid"}}function Jvt(t){return{...Kvt,...t,type:"sketch"}}const Qvt={color:Xt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:ir.OPAQUE,hasSlicePlane:!1},Kvt={color:Xt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:ir.OPAQUE,hasSlicePlane:!1};function lO(t,e){switch(e.normalType){case Ur.Compressed:t.attributes.add(R.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(T`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case Ur.Attribute:t.attributes.add(R.NORMAL,"vec3"),t.vertex.code.add(T`vec3 normalModel() {
return normal;
}`);break;case Ur.ScreenDerivative:t.fragment.code.add(T`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case Ur.COUNT:case Ur.Ground:}}var Ur;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(Ur||(Ur={}));function v5e(t,e){const r=t.fragment;switch(r.code.add(T`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case En.None:r.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case En.View:r.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case En.WindingOrder:r.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case En.COUNT:}}var En;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(En||(En={}));let cO=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get(R.POSITION).indices.length}write(e,r,i,n,s){$4e(i,this.vertexBufferLayout,e,r,n,s)}};function pG(t,e){switch(e.normalType){case Ur.Attribute:case Ur.Compressed:t.include(lO,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new m9("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new Zh("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),t.vertex.code.add(T`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case Ur.Ground:t.include(rP,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(T`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?T`normalize(vPositionWorldCameraRelative);`:T`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case Ur.ScreenDerivative:t.vertex.code.add(T`void forwardNormal() {}`);break;default:e.normalType;case Ur.COUNT:}}let b5e=class extends qDe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=gi()}},w5e=class extends WDe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=gi(),this.toMapSpace=tr()}};const cle={func:si.LESS},N9={func:si.ALWAYS},gy={mask:255},x5e={mask:0},ebt=t=>({function:{func:si.NOTEQUAL,ref:t,mask:t},operation:{fail:vn.KEEP,zFail:vn.KEEP,zPass:vn.KEEP}}),tbt=t=>({function:{func:si.ALWAYS,ref:t,mask:t},operation:{fail:vn.KEEP,zFail:vn.KEEP,zPass:vn.REPLACE}}),_w={function:{func:si.ALWAYS,ref:Lc.OutlineVisualElementMask,mask:Lc.OutlineVisualElementMask},operation:{fail:vn.KEEP,zFail:vn.KEEP,zPass:vn.ZERO}},Yb={function:{func:si.ALWAYS,ref:Lc.OutlineVisualElementMask,mask:Lc.OutlineVisualElementMask},operation:{fail:vn.KEEP,zFail:vn.KEEP,zPass:vn.REPLACE}},S5e={function:{func:si.EQUAL,ref:Lc.OutlineVisualElementMask,mask:Lc.OutlineVisualElementMask},operation:{fail:vn.KEEP,zFail:vn.KEEP,zPass:vn.KEEP}},T5e={function:{func:si.NOTEQUAL,ref:Lc.OutlineVisualElementMask,mask:Lc.OutlineVisualElementMask},operation:{fail:vn.KEEP,zFail:vn.KEEP,zPass:vn.KEEP}};function E5e({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:r,roughnessFactor:i,emissiveTexture:n,emissiveFactor:s,occlusionTexture:o}){return t==null&&e==null&&n==null&&(s==null||aa(s,Yn))&&o==null&&(i==null||i===1)&&(r==null||r===1)}function zer({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:r,roughnessFactor:i,emissiveTexture:n,emissiveFactor:s,occlusionTexture:o}){return t==null&&e==null&&n==null&&(s==null||aa(s,Yn))&&o==null&&(i==null||i===1)&&(r==null||r===1||r===0)}const fG=[1,1,.5],ule=[0,.6,.2],rbt=[0,1,.2];function C5e(t){t.vertex.code.add(T`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}var ws;function P5e(t){switch(t){case"multiply":default:return ws.Multiply;case"ignore":return ws.Ignore;case"replace":return ws.Replace;case"tint":return ws.Tint}}function A5e(t,e,r){if(t==null||e===ws.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=we(Math.round(t[3]*F9),0,F9),n=i===0||e===ws.Tint?0:e===ws.Replace?ibt:nbt;r[0]=we(Math.round(t[0]*dE),0,dE),r[1]=we(Math.round(t[1]*dE),0,dE),r[2]=we(Math.round(t[2]*dE),0,dE),r[3]=i+n}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(ws||(ws={}));const dE=255,F9=85,ibt=F9,nbt=2*F9;function O5e(t){t.vertex.code.add(T`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${T.int(ws.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${T.int(ws.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${T.int(ws.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${T.int(ws.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let kN=class extends Pn{constructor(e,r){super(e,"int",kr.Pass,(i,n,s)=>i.setUniform1i(e,r(n,s)))}};function M5e(t,e){e.hasSymbolColors?(t.include(O5e),t.attributes.add(R.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(T`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new kN("colorMixMode",r=>C4e[r.colorMixMode])),t.vertex.code.add(T`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function L2(t,e){e.hasVertexColors?(t.attributes.add(R.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(T`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(T`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(T`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function R5e(t){t.code.add(T`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function g_(t,e){switch(e.output){case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:t.fragment.include(R5e),t.fragment.code.add(T`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`);break;case G.LinearDepth:t.fragment.include(bp),t.fragment.code.add(T`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}function sbt(t){t.fragment.code.add(T`
    #define discardOrAdjustAlpha(color) { if (color.a < ${T.float(sa)}) { discard; } }
  `)}let ST=class extends Pn{constructor(e,r){super(e,"float",kr.Draw,(i,n,s)=>i.setUniform1f(e,r(n,s)))}};function TT(t,e){$5e(t,e,new Ie("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function obt(t,e){$5e(t,e,new ST("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function $5e(t,e,r){const i=t.fragment;switch(e.alphaDiscardMode!==xi.Mask&&e.alphaDiscardMode!==xi.MaskBlend||i.uniforms.add(r),e.alphaDiscardMode){case xi.Blend:return t.include(sbt);case xi.Opaque:i.code.add(T`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case xi.Mask:i.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case xi.MaskBlend:t.fragment.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function I5e(t,e){const{vertex:r,fragment:i}=t,n=e.hasColorTexture&&e.alphaDiscardMode!==xi.Opaque;switch(e.output){case G.LinearDepth:case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ObjectAndLayerIdColor:Uu(r,e),t.include($c,e),t.include(Jg,e),t.include(X0,e),t.include(g_,e),t.include(Wn,e),t.include(aO,e),r2(t),t.varyings.add("depth","float"),n&&i.uniforms.add(new ft("tex",s=>s.texture)),r.code.add(T`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`),t.include(TT,e),i.code.add(T`
          void main(void) {
            discardBySlice(vpos);
            ${n?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===G.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:T`outputDepth(depth);`}
          }
        `);break;case G.Normal:{Uu(r,e),t.include($c,e),t.include(lO,e),t.include(pG,e),t.include(Jg,e),t.include(X0,e),n&&i.uniforms.add(new ft("tex",o=>o.texture)),e.normalType===Ur.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const s=e.normalType===Ur.Attribute||e.normalType===Ur.Compressed;r.code.add(T`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${s?T`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:T`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(Wn,e),t.include(TT,e),i.code.add(T`
          void main() {
            discardBySlice(vpos);
            ${n?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===Ur.ScreenDerivative?T`vec3 normal = screenDerivativeNormal(vPositionView);`:T`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case G.Highlight:Uu(r,e),t.include($c,e),t.include(Jg,e),t.include(X0,e),n&&i.uniforms.add(new ft("tex",s=>s.texture)),r.code.add(T`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(Wn,e),t.include(TT,e),t.include(gw,e),i.code.add(T`
          void main() {
            discardBySlice(vpos);
            ${n?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function L5e(t,e){const r=t.fragment;e.hasVertexTangents?(t.attributes.add(R.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===En.WindingOrder?r.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(T`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==mn.None&&(t.include(uae,e),r.uniforms.add(e.pbrTextureBindType===kr.Pass?new ft("normalTexture",i=>i.textureNormal):new Kd("normalTexture",i=>i.textureNormal)),e.hasNormalTextureTransform&&(r.uniforms.add(new ci("scale",i=>i.scale??VB)),r.uniforms.add(new Zh("normalTextureTransformMatrix",i=>i.normalTextureTransformMatrix??y2))),r.code.add(T`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),e.hasNormalTextureTransform&&r.code.add(T`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),r.code.add(T`return tangentSpace * rawNormal;
}`))}const D5e=3e5,g8=5e5;let N5e=class extends Pn{constructor(e,r){super(e,"vec2",kr.Draw,(i,n,s,o)=>i.setUniform2fv(e,r(n,s,o)))}};const Eq=4;function F5e(){const t=new Fr,e=t.fragment;t.include(gl);const r=(Eq+1)/2,i=1/(2*r*r);return e.include(ULe),e.uniforms.add(new ft("depthMap",n=>n.depthTexture),new Kd("tex",n=>n.colorTexture),new N5e("blurSize",n=>n.blurSize),new Ie("projScale",(n,s)=>{const o=Bi(s.camera.eye,s.camera.center);return o>5e4?Math.max(0,n.projScale-(o-5e4)):n.projScale}),new ci("nearFar",(n,s)=>s.camera.nearFar)),e.code.add(T`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${T.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.code.add(T`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${T.int(Eq)}; r <= ${T.int(Eq)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `),t}const abt=Object.freeze(Object.defineProperty({__proto__:null,build:F5e},Symbol.toStringTag,{value:"Module"}));let k5e=class U5e extends Zr{initializeProgram(e){return new Br(e.rctx,U5e.shader.get().build(),Nr)}initializePipeline(){return Bt({colorWrite:rr})}};k5e.shader=new Vr(abt,()=>re(()=>Promise.resolve().then(()=>Cjt),void 0));const lbt="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let cbt=class extends Li{constructor(){super(...arguments),this.projScale=1}},ubt=class extends cbt{constructor(){super(...arguments),this.intensity=1}},hbt=class extends Li{},dbt=class extends hbt{constructor(){super(...arguments),this.blurSize=Ye()}};function mG(t){t.fragment.uniforms.add(new Or("projInfo",(e,r)=>pbt(r.camera))),t.fragment.uniforms.add(new ci("zScale",(e,r)=>fbt(r.camera))),t.fragment.code.add(T`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function pbt(t){const e=t.projectionMatrix;return e[11]===0?pn(O0e,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):pn(O0e,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const O0e=tr();function fbt(t){return t.projectionMatrix[11]===0?yr(M0e,0,1):yr(M0e,1,0)}const M0e=Ye(),R0e=16;function z5e(){const t=new Fr,e=t.fragment;return t.include(gl),t.include(mG),e.include(ULe),e.uniforms.add(new Ie("radius",(r,i)=>gG(i.camera))),e.code.add(T`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(T`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new ci("nearFar",(r,i)=>i.camera.nearFar),new ft("normalMap",r=>r.normalTexture),new ft("depthMap",r=>r.depthTexture),new Ie("projScale",r=>r.projScale),new ft("rnm",r=>r.noiseTexture),new ci("rnmScale",(r,i)=>yr($0e,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new Ie("intensity",r=>r.intensity),new ci("screenSize",(r,i)=>yr($0e,i.camera.fullWidth,i.camera.fullHeight))),t.outputs.add("fragOcclusion","float"),e.code.add(T`
    void main(void) {
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${T.int(R0e)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${T.int(R0e)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `),t}function gG(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const $0e=Ye(),mbt=Object.freeze(Object.defineProperty({__proto__:null,build:z5e,getRadius:gG},Symbol.toStringTag,{value:"Module"}));let V5e=class B5e extends Zr{initializeProgram(e){return new Br(e.rctx,B5e.shader.get().build(),Nr)}initializePipeline(){return Bt({colorWrite:rr})}};V5e.shader=new Vr(mbt,()=>re(()=>Promise.resolve().then(()=>Pjt),void 0));const JR=2;let QR=class extends R2{constructor(e){super(e),this._context=null,this._passParameters=new ubt,this._drawParameters=new dbt,this.produces=new Map([[de.SSAO,()=>this._produces()]])}_getCameraElevation(){var e;return((e=this._context)==null?void 0:e.renderContext.bindParameters.camera.relativeElevation)??1/0}_produces(){return this._enableTime!=null&&this._context!=null&&this._getCameraElevation()<g8}consumes(){return this._produces()?Wmt:X7}initializeRenderContext(e){this._context=e,this.addHandles([pe(()=>{var r;return this.view.qualitySettings.ambientOcclusion||((r=this._context)==null?void 0:r.isFeatureEnabled(Ys.SSAO))},r=>r?this._enable():this._disable(),li)])}uninitializeRenderContext(){this._disable(),this._context=null}_disable(){this._passParameters.noiseTexture=wt(this._passParameters.noiseTexture),this._enableTime=null}destroy(){this._disable()}_enable(){var i;if(this._enableTime!=null||!this._context)return;const e=Uint8Array.from(atob(lbt),n=>n.charCodeAt(0)),r=new ui;r.wrapMode=nr.CLAMP_TO_EDGE,r.pixelFormat=Ot.RGB,r.wrapMode=nr.REPEAT,r.hasMipmap=!0,r.width=32,r.height=32,this._passParameters.noiseTexture=new Mr(this._context.renderContext.rctx,r,e),this._ssaoTechnique==null&&(this._ssaoTechnique=this._context.techniqueRepository.acquire(V5e)),this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(k5e)),this._enableTime=0,(i=this._context)==null||i.requestRender()}renderNode(e,r,i){const n=e.bindParameters,s=i==null?void 0:i.get("normals"),o=s==null?void 0:s.getTexture(),a=s==null?void 0:s.getTexture(cA);if(this._enableTime==null||this._context==null||!o||!a)return;if(!this._ssaoTechnique.compiled||!this._blurTechnique.compiled)return this._enableTime=e.time,void this._context.requestRender();this._enableTime===0&&(this._enableTime=e.time);const l=e.rctx,c=n.camera,u=this.view.qualitySettings.fadeDuration,h=c.relativeElevation,p=we((g8-h)/(g8-D5e),0,1),f=u>0?Math.min(u,e.time-this._enableTime)/u:1,g=f*p;this._passParameters.normalTexture=o,this._passParameters.depthTexture=a,this._passParameters.projScale=1/c.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*gbt/gG(c)**6*g;const y=c.fullViewport[2],v=c.fullViewport[3],b=Math.round(y/JR),w=Math.round(v/JR),x=this._context.fbos,S=x.acquire(y,v,"ssao input",tn.RG);l.unbindTexture(S.fbo.colorTexture),l.bindFramebuffer(S.fbo),l.setViewport(0,0,y,v),l.bindTechnique(this._ssaoTechnique,n,this._passParameters,this._drawParameters),l.screen.draw();const E=x.acquire(b,w,"ssao blur",tn.RED);l.unbindTexture(E.fbo.colorTexture),l.bindFramebuffer(E.fbo),this._drawParameters.colorTexture=S.getTexture(),yr(this._drawParameters.blurSize,0,JR/v),l.bindTechnique(this._blurTechnique,n,this._passParameters,this._drawParameters),l.setViewport(0,0,b,w),l.screen.draw(),S.release();const P=x.acquire(b,w,"ssao",tn.RED);return l.unbindTexture(P.fbo.colorTexture),l.bindFramebuffer(P.fbo),l.setViewport(0,0,y,v),l.setClearColor(1,1,1,0),l.clear(Mi.COLOR_BUFFER_BIT),this._drawParameters.colorTexture=E.getTexture(),yr(this._drawParameters.blurSize,JR/y,0),l.bindTechnique(this._blurTechnique,n,this._passParameters,this._drawParameters),l.setViewport(0,0,b,w),l.screen.draw(),l.setViewport4fv(c.fullViewport),E.release(),f<1&&this._context.requestRender(),P}};d([m({constructOnly:!0})],QR.prototype,"view",void 0),d([m()],QR.prototype,"_context",void 0),QR=d([F("esri.views.3d.webgl-engine.effects.ssao.SSAO")],QR);const gbt=.5;function UN(t,e){const r=t.fragment;e.receiveAmbientOcclusion?(r.uniforms.add(new ft("ssaoTex",(i,n)=>{var s;return(s=n.ssao)==null?void 0:s.getTexture()})),r.constants.add("blurSizePixelsInverse","float",1/JR),r.code.add(T`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(T`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function ybt(t){const e=t.fragment.code;e.add(T`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(T`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(T`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function hle(t,e){const r=t.fragment.code;t.include(MN),e.pbrMode!==ht.Normal&&e.pbrMode!==ht.Schematic&&e.pbrMode!==ht.Simplified&&e.pbrMode!==ht.TerrainWithWater||(r.add(T`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(T`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==ht.Normal&&e.pbrMode!==ht.Schematic||(t.include(ybt),r.add(T`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(T`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(T`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(T`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function _bt(t,e){const r=t.fragment.code;t.include(MN),r.add(T`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(T`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(T`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(T`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(T`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function zN(t){t.constants.add("ambientBoostFactor","float",kDe)}function uO(t){t.uniforms.add(new Ie("lightingGlobalFactor",(e,r)=>r.lighting.globalFactor))}function s2(t,e){const r=t.fragment;switch(t.include(UN,e),e.pbrMode!==ht.Disabled&&t.include(hle,e),t.include(pae,e),t.include(MN),r.code.add(T`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===ht.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),zN(r),uO(r),R_(r),r.code.add(T`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?T`normalize(vPosWorld)`:T`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),by(r),r.code.add(T`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case ht.Disabled:case ht.WaterOnIntegratedMesh:case ht.Water:t.include(a9),r.code.add(T`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case ht.Normal:case ht.Schematic:r.code.add(T`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(T`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?r.uniforms.add(new Qg("hasFillLights",(i,n)=>n.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(T`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new Ie("lightingSpecularStrength",(i,n)=>n.lighting.mainLight.specularStrength),new Ie("lightingEnvironmentStrength",(i,n)=>n.lighting.mainLight.environmentStrength)),r.code.add(T`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(T`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode!==ht.Schematic||e.hasColorTexture?T`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:T`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case ht.Simplified:case ht.TerrainWithWater:t.include(a9),r.code.add(T`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case ht.COUNT:}}let vbt=class extends Pn{constructor(e,r,i){super(e,"mat4",kr.Draw,(n,s,o,a)=>n.setUniformMatrix4fv(e,r(s,o,a)),i)}},bbt=class extends Pn{constructor(e,r,i){super(e,"mat4",kr.Pass,(n,s,o)=>n.setUniformMatrix4fv(e,r(s,o)),i)}},wbt=class extends Li{constructor(){super(...arguments),this.modelTransformation=fn}},dle=class extends wbt{constructor(){super(...arguments),this.origin=C()}};function VN(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new bbt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),G5e(t))}function _A(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new vbt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),G5e(t))}function G5e(t){const e=t.fragment;e.include(R5e),e.uniforms.add(new ft("shadowMap",(r,i)=>i.shadowMap.depthTexture),new kN("numCascades",(r,i)=>i.shadowMap.numCascades),new Or("cascadeDistances",(r,i)=>i.shadowMap.cascadeDistances)),e.code.add(T`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}function xbt(t,e){e.hasColorTextureTransform?(t.vertex.uniforms.add(new Zh("colorTextureTransformMatrix",r=>r.colorTextureTransformMatrix??y2)),t.varyings.add("colorUV","vec2"),t.vertex.code.add(T`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardColorUV(){}`)}function Sbt(t,e){e.hasNormalTextureTransform&&e.textureCoordinateType!==mn.None?(t.vertex.uniforms.add(new Zh("normalTextureTransformMatrix",r=>r.normalTextureTransformMatrix??y2)),t.varyings.add("normalUV","vec2"),t.vertex.code.add(T`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardNormalUV(){}`)}function Tbt(t,e){e.hasEmissionTextureTransform&&e.textureCoordinateType!==mn.None?(t.vertex.uniforms.add(new Zh("emissiveTextureTransformMatrix",r=>r.emissiveTextureTransformMatrix??y2)),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(T`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardEmissiveUV(){}`)}function Ebt(t,e){e.hasOcclusionTextureTransform&&e.textureCoordinateType!==mn.None?(t.vertex.uniforms.add(new Zh("occlusionTextureTransformMatrix",r=>r.occlusionTextureTransformMatrix??y2)),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(T`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardOcclusionUV(){}`)}function Cbt(t,e){e.hasMetallicRoughnessTextureTransform&&e.textureCoordinateType!==mn.None?(t.vertex.uniforms.add(new Zh("metallicRoughnessTextureTransformMatrix",r=>r.metallicRoughnessTextureTransformMatrix??y2)),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(T`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardMetallicRoughnessUV(){}`)}function wD(t){t.include(Ty),t.code.add(T`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${T.int(ws.Multiply)}) {
        return allMixed;
      }
      if (mode == ${T.int(ws.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(ws.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${T.int(ws.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(ws.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function j5e(t){const e=new Fr,{vertex:r,fragment:i,varyings:n}=e;if(Uu(r,t),e.include(RN),n.add("vpos","vec3"),e.include(X0,t),e.include(HDe,t),e.include(g4e,t),e.include(xbt,t),t.output===G.Color||t.output===G.Alpha){e.include(Sbt,t),e.include(Tbt,t),e.include(Ebt,t),e.include(Cbt,t),mm(r,t),e.include(lO,t),e.include($c,t);const s=t.normalType===Ur.Attribute||t.normalType===Ur.Compressed;s&&t.offsetBackfaces&&e.include(C5e),e.include(L5e,t),e.include(pG,t),t.instancedColor&&e.attributes.add(R.INSTANCECOLOR,"vec4"),n.add("vPositionLocal","vec3"),e.include(Jg,t),e.include(nO,t),e.include(M5e,t),e.include(L2,t),r.uniforms.add(new Or("externalColor",o=>o.externalColor)),n.add("vcolorExt","vec4"),t.multipassEnabled&&n.add("depth","float"),r.code.add(T`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${T.float(sa)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${s?T`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${s&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        forwardColorUV();
        forwardNormalUV();
        forwardEmissiveUV();
        forwardOcclusionUV();
        forwardMetallicRoughnessUV();
      }
    `)}switch(t.output){case G.Alpha:e.include(Wn,t),e.include(TT,t),e.include(Yu,t),i.uniforms.add(new Ie("opacity",s=>s.opacity),new Ie("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new ft("tex",s=>s.texture)),i.include(wD),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?T`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case G.Color:e.include(Wn,t),e.include(s2,t),e.include(UN,t),e.include(TT,t),e.include(t.instancedDoublePrecision?VN:_A,t),e.include(Yu,t),mm(i,t),i.uniforms.add(r.uniforms.get("localOrigin"),new zt("ambient",s=>s.ambient),new zt("diffuse",s=>s.diffuse),new Ie("opacity",s=>s.opacity),new Ie("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new ft("tex",s=>s.texture)),e.include(dae,t),e.include(hle,t),i.include(wD),e.include(v5e,t),zN(i),uO(i),by(i),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===Ur.ScreenDerivative?T`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:T`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===ht.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?T`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?T`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?T`normalUV`:"vuv0"});`:T`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?T`normalize(posWorld);`:T`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?T`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===ht.Normal||t.pbrMode===ht.Schematic?T`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?T`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:T`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===vt.Color?T`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return e.include(I5e,t),e}const Pbt=Object.freeze(Object.defineProperty({__proto__:null,build:j5e},Symbol.toStringTag,{value:"Module"}));let Abt=class extends b5e{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ka(fG),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=$i.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Ce(0,0,0),this.instancedDoublePrecision=!1,this.normalType=Ur.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ce(.2,.2,.2),this.diffuse=Ce(.8,.8,.8),this.externalColor=Xt(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=C(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=ZT.Less,this.textureAlphaMode=xi.Blend,this.textureAlphaCutoff=I9,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Wr.Occlude,this.isDecoration=!1}},Obt=class extends w5e{constructor(){super(...arguments),this.origin=C(),this.slicePlaneLocalOrigin=this.origin}},ple=class H5e extends Zr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Fe.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?mn.Default:mn.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,H5e.shader)}_initializeProgram(e,r){return new Br(e.rctx,r.get().build(this.configuration),Nr)}_convertDepthTestFunction(e){return e===ZT.Lequal?si.LEQUAL:si.LESS}_makePipeline(e,r){const i=this.configuration,n=e===vt.NONE,s=e===vt.FrontFace;return Bt({blending:i.output!==G.Color&&i.output!==G.Alpha||!i.transparent?null:n?Bh:$_(e),culling:Mbt(i)?j7(i.cullFace):null,depthTest:{func:yw(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(n||s)&&i.writeDepth?Wu:null,colorWrite:rr,stencilWrite:i.hasOccludees?gy:null,stencilTest:i.hasOccludees?r?Yb:_w:null,polygonOffset:n||s?null:cG(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function Mbt(t){return t.cullFace!==$i.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}ple.shader=new Vr(Pbt,()=>re(()=>Promise.resolve().then(()=>Ajt),void 0));let Qt=class extends Zl{constructor(){super(...arguments),this.output=G.Color,this.alphaDiscardMode=xi.Opaque,this.doubleSidedMode=En.None,this.pbrMode=ht.Disabled,this.cullFace=$i.None,this.transparencyPassType=vt.NONE,this.normalType=Ur.Attribute,this.textureCoordinateType=mn.None,this.customDepthTest=ZT.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};d([H({count:G.COUNT})],Qt.prototype,"output",void 0),d([H({count:xi.COUNT})],Qt.prototype,"alphaDiscardMode",void 0),d([H({count:En.COUNT})],Qt.prototype,"doubleSidedMode",void 0),d([H({count:ht.COUNT})],Qt.prototype,"pbrMode",void 0),d([H({count:$i.COUNT})],Qt.prototype,"cullFace",void 0),d([H({count:vt.COUNT})],Qt.prototype,"transparencyPassType",void 0),d([H({count:Ur.COUNT})],Qt.prototype,"normalType",void 0),d([H({count:mn.COUNT})],Qt.prototype,"textureCoordinateType",void 0),d([H({count:ZT.COUNT})],Qt.prototype,"customDepthTest",void 0),d([H()],Qt.prototype,"spherical",void 0),d([H()],Qt.prototype,"hasVertexColors",void 0),d([H()],Qt.prototype,"hasSymbolColors",void 0),d([H()],Qt.prototype,"hasVerticalOffset",void 0),d([H()],Qt.prototype,"hasSlicePlane",void 0),d([H()],Qt.prototype,"hasSliceHighlight",void 0),d([H()],Qt.prototype,"hasColorTexture",void 0),d([H()],Qt.prototype,"hasMetallicRoughnessTexture",void 0),d([H()],Qt.prototype,"hasEmissionTexture",void 0),d([H()],Qt.prototype,"hasOcclusionTexture",void 0),d([H()],Qt.prototype,"hasNormalTexture",void 0),d([H()],Qt.prototype,"hasScreenSizePerspective",void 0),d([H()],Qt.prototype,"hasVertexTangents",void 0),d([H()],Qt.prototype,"hasOccludees",void 0),d([H()],Qt.prototype,"multipassEnabled",void 0),d([H()],Qt.prototype,"hasModelTransformation",void 0),d([H()],Qt.prototype,"offsetBackfaces",void 0),d([H()],Qt.prototype,"vvSize",void 0),d([H()],Qt.prototype,"vvColor",void 0),d([H()],Qt.prototype,"receiveShadows",void 0),d([H()],Qt.prototype,"receiveAmbientOcclusion",void 0),d([H()],Qt.prototype,"textureAlphaPremultiplied",void 0),d([H()],Qt.prototype,"instanced",void 0),d([H()],Qt.prototype,"instancedColor",void 0),d([H()],Qt.prototype,"objectAndLayerIdColorInstanced",void 0),d([H()],Qt.prototype,"instancedDoublePrecision",void 0),d([H()],Qt.prototype,"doublePrecisionRequiresObfuscation",void 0),d([H()],Qt.prototype,"writeDepth",void 0),d([H()],Qt.prototype,"transparent",void 0),d([H()],Qt.prototype,"enableOffset",void 0),d([H()],Qt.prototype,"cullAboveGround",void 0),d([H()],Qt.prototype,"snowCover",void 0),d([H()],Qt.prototype,"hasColorTextureTransform",void 0),d([H()],Qt.prototype,"hasEmissionTextureTransform",void 0),d([H()],Qt.prototype,"hasNormalTextureTransform",void 0),d([H()],Qt.prototype,"hasOcclusionTextureTransform",void 0),d([H()],Qt.prototype,"hasMetallicRoughnessTextureTransform",void 0),d([H({constValue:!1})],Qt.prototype,"occlusionPass",void 0),d([H({constValue:!0})],Qt.prototype,"hasVvInstancing",void 0),d([H({constValue:!1})],Qt.prototype,"useCustomDTRExponentForWater",void 0),d([H({constValue:!1})],Qt.prototype,"supportsTextureAtlas",void 0),d([H({constValue:!0})],Qt.prototype,"useFillLights",void 0);function q5e(t){const e=new Fr,{vertex:r,fragment:i,varyings:n}=e;return Uu(r,t),e.include(RN),n.add("vpos","vec3"),e.include(X0,t),e.include(HDe,t),e.include(g4e,t),t.output!==G.Color&&t.output!==G.Alpha||(mm(e.vertex,t),e.include(lO,t),e.include($c,t),t.offsetBackfaces&&e.include(C5e),t.instancedColor&&e.attributes.add(R.INSTANCECOLOR,"vec4"),n.add("vNormalWorld","vec3"),n.add("localvpos","vec3"),t.multipassEnabled&&n.add("depth","float"),e.include(Jg,t),e.include(nO,t),e.include(M5e,t),e.include(L2,t),r.uniforms.add(new Or("externalColor",s=>s.externalColor)),n.add("vcolorExt","vec4"),r.code.add(T`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${T.float(sa)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.multipassEnabled?T`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===G.Alpha&&(e.include(Wn,t),e.include(TT,t),e.include(Yu,t),i.uniforms.add(new Ie("opacity",s=>s.opacity),new Ie("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new ft("tex",s=>s.texture)),i.include(wD),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?T`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?T`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===G.Color&&(e.include(Wn,t),e.include(s2,t),e.include(UN,t),e.include(TT,t),e.include(t.instancedDoublePrecision?VN:_A,t),e.include(Yu,t),mm(e.fragment,t),R_(i),zN(i),uO(i),i.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new zt("ambient",s=>s.ambient),new zt("diffuse",s=>s.diffuse),new Ie("opacity",s=>s.opacity),new Ie("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new ft("tex",s=>s.texture)),e.include(dae,t),e.include(hle,t),i.include(wD),by(i),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?T`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===ht.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?T`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?T`albedo = mix(albedo, vec3(1), 0.9);`:T``}
        ${T`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===ht.Normal||t.pbrMode===ht.Schematic?t.spherical?T`vec3 normalGround = normalize(vpos + localOrigin);`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:T``}
        ${t.pbrMode===ht.Normal||t.pbrMode===ht.Schematic?T`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?T`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:T`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===vt.Color?T`fragColor = premultiplyAlpha(fragColor);`:T``}
      }
    `)),e.include(I5e,t),e}const Rbt=Object.freeze(Object.defineProperty({__proto__:null,build:q5e},Symbol.toStringTag,{value:"Module"}));let W5e=class Y5e extends ple{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=Ur.Attribute,r.doubleSidedMode=En.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,Y5e.shader)}};W5e.shader=new Vr(Rbt,()=>re(()=>Promise.resolve().then(()=>Ojt),void 0));let gm=class extends mw{constructor(e){super(e,Lbt),this.supportsEdges=!0,this.produces=new Map([[de.OPAQUE_MATERIAL,r=>($I(r)||tP(r))&&!this.parameters.transparent],[de.TRANSPARENT_MATERIAL,r=>($I(r)||tP(r))&&this.parameters.transparent&&this.parameters.writeDepth],[de.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,r=>($I(r)||tP(r))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._configuration=new Qt,this._vertexBufferLayout=Dbt(this.parameters)}isVisibleForOutput(e){return e!==G.Shadow&&e!==G.ShadowExcludeHighlight&&e!==G.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:r,hasVertexColors:i,hasSymbolColors:n,vvColor:s}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=r||s||n;return i&&c?o||a:i?o?l:a:c?o||a:o?l:a}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?$i.None:this.parameters.cullFace,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==G.Color&&e!==G.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=En.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?En.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?En.WindingOrder:En.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=this.parameters.receiveAmbientOcclusion&&r.ssao!=null,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?ht.Schematic:ht.Normal:ht.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<aG,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,i,n,s,o){if(this.parameters.verticalOffset!=null){const a=i.camera;se(Pq,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case Fe.Global:l=me(I0e,Pq);break;case Fe.Local:l=he(I0e,kbt)}let c=0;const u=_e(Ubt,Pq,a.eye),h=Te(u),p=oe(u,u,1/h);let f=null;this.parameters.screenSizePerspective&&(f=fe(l,p)),c+=T4e(a,h,this.parameters.verticalOffset,f??0,this.parameters.screenSizePerspective),oe(l,l,c),po(Cq,l,i.transform.inverseRotation),n=_e(Nbt,n,Cq),s=_e(Fbt,s,Cq)}b4e(e,i,n,s,pQ(i.verticalOffset),o)}createGLMaterial(e){return new $bt(e)}createBufferWriter(){return new cO(this._vertexBufferLayout)}},$bt=class extends hae{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==G.Color&&this._output!==G.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return se(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?W5e:ple,e)}},Ibt=class extends Abt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const Lbt=new Ibt;function Dbt(t){const e=ln().vec3f(R.POSITION);return t.normalType===Ur.Compressed?e.vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(R.NORMAL),t.hasVertexTangents&&e.vec4f(R.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(R.UV0),t.hasVertexColors&&e.vec4u8(R.COLOR),t.hasSymbolColors&&e.vec4u8(R.SYMBOLCOLOR),ne("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),e}const Nbt=C(),Fbt=C(),kbt=Ce(0,0,1),I0e=C(),Cq=C(),Pq=C(),Ubt=C(),X5e=new lle({});function str(t){return t.type==="web-style"?X5e:fle(t.symbolLayers.toArray().map(e=>Z5e(t,e)))}function fle(t){let e=0,r=0,i=0,n=!1,s=0;const o=new m5e;for(const a of t)a!=null&&(e+=a.verticesPerFeature,r+=a.verticesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,n=n||a.estimated,++s);return n?new qvt(s,{verticesPerFeature:e,verticesPerCoordinate:r,drawCallsPerFeature:i,memory:o}):new Hvt(s,{verticesPerFeature:e,verticesPerCoordinate:r,drawCallsPerFeature:i,memory:o})}function otr(t){const e=fle(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const Aq={};function Z5e(t,e){var n,s;const r=J5e(t,e),i=Xvt(e)?2:0;switch(e.type){case"extrude":return new Rd({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:i,memory:r});case"fill":if(t.type==="mesh-3d")return new Rd({drawCallsPerFeature:i,memory:r});if(e.outline!=null&&e.outline.size>0)return new Rd({verticesPerFeature:-12,verticesPerCoordinate:9,memory:r});case"water":return new Rd({verticesPerFeature:-6,verticesPerCoordinate:3,memory:r});case"line":return new Rd({verticesPerFeature:-6,verticesPerCoordinate:6,memory:r});case"object":return(n=e.resource)!=null&&n.href?new lle({verticesPerFeature:100,memory:r}):{...zbt(((s=e.resource)==null?void 0:s.primitive)??VIe),memory:r};case"path":{let o=0,a=0;switch(e.profile){case"circle":o=u5e;break;case"quad":o=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":a=c5e;break;case"miter":case"bevel":a=1;break;default:return}const l=2*o,c=o*a*2,u=c+l;let h=-2*c-l;switch(e.cap){case"none":break;case"butt":case"square":h+=2*(o-1);break;case"round":h+=2*(o*(Bee-1)*2+o);break;default:return}return new Rd({verticesPerFeature:h,verticesPerCoordinate:u,memory:r})}case"text":case"icon":return new Rd({verticesPerFeature:6,memory:r});default:return}}function J5e(t,e){const r=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?sc.EXTRUDE_EDGES:sc.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?sc.FILL_OUTLINE:sc.FILL;case"water":return sc.FILL;case"line":return e.join==="round"?sc.LINE_ROUND:sc.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return sc.PATH_ROUND_CIRCLE;case"quad":return sc.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return sc.PATH_MITER_CIRCLE;case"quad":return sc.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return r?sc.OBJECT_POINT:sc.OBJECT_POLYGON;case"icon":case"text":return r?sc.ICON_POINT:sc.ICON_POLYGON;default:return}}function zbt(t){const e=Aq[t];if(e)return e;const r=Q5e(f5e(t,new gm({})).levels);return Aq[t]=new Rd({verticesPerFeature:r}),Aq[t]}function Q5e(t){return t.reduce((e,r,i)=>e+r.numVertices*(1/10**i),0)/t.reduce((e,r,i)=>e+1/10**i,0)}const sc={ICON_POINT:{bytesPerFeature:2379.8272296852992,bytesPerFeatureLabel:852.246235,resourceBytes:0,draped:{bytesPerFeature:1868.2382921559424,bytesPerFeatureLabel:839.205415}},ICON_POLYGON:{bytesPerFeature:2957.8429876524656,bytesPerFeatureLabel:862.5307816666666,resourceBytes:0,draped:{bytesPerFeature:2579.7767085451133,bytesPerFeatureLabel:856.9298550000001}},OBJECT_POINT:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999,resourceBytes:0,draped:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999}},OBJECT_POLYGON:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998,resourceBytes:0,draped:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998}},LINE_MITER:{bytesPerFeature:3081.208408220661,bytesPerFeatureLabel:858.6749016666668,resourceBytes:0,draped:{bytesPerFeature:2682.57863388475,bytesPerFeatureLabel:844.6118016666666}},LINE_ROUND:{bytesPerFeature:3209.3236242927915,bytesPerFeatureLabel:858.1810416666667,resourceBytes:0,draped:{bytesPerFeature:2687.6256038096126,bytesPerFeatureLabel:849.578535}},PATH_MITER_CIRCLE:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415,resourceBytes:0,draped:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415}},PATH_ROUND_CIRCLE:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001,resourceBytes:0,draped:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001}},PATH_MITER_QUAD:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355,resourceBytes:0,draped:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355}},PATH_ROUND_QUAD:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955,resourceBytes:0,draped:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955}},FILL:{bytesPerFeature:3147.43349219103,bytesPerFeatureLabel:850.7598550000001,resourceBytes:0,draped:{bytesPerFeature:2673.7898488975106,bytesPerFeatureLabel:846.6459950000002}},FILL_OUTLINE:{bytesPerFeature:4565.099993465867,bytesPerFeatureLabel:855.334515,resourceBytes:0,draped:{bytesPerFeature:3904.46969705314,bytesPerFeatureLabel:844.7081016666667}},EXTRUDE:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333,resourceBytes:0,draped:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333}},EXTRUDE_EDGES:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335,resourceBytes:0,draped:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335}}};var ls;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(ls||(ls={}));let mle=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Ch.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,r){return this._loadStatus===Ch.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===Ch.FAILED?(r&&r(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Ch.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=Ch.FAILED,!on(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(e,r).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=Ql(this._abortController):this._loadStatus===Ch.LOADING&&(this._loadStatus=Ch.FAILED),this._loader=null}};var Ch;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(Ch||(Ch={}));const pE=()=>K.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Cy=class extends mle{constructor(e,r,i,n){super(i.schedule),this.symbol=e,this.symbolLayer=r,this._context=i,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this._materials=[],this.usedMemory=0,this.logger=pE(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=n.renderPriority,this._renderPriorityStep=n.renderPriorityStep,this._elevationContext=new D9,this.complexity=this.computeComplexity(),this.ignoreDrivers=n.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=L0e(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const r=this._drivenProperties,i=L0e(e);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,r,i,n){const s=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${n} geometry failed to be created`;let l=null;s?!this._logGeometryValidationWarnings(r,i,n)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&pE().warnOncePerTick(l)}_logGeometryValidationWarnings(e,r,i){const n=`${i} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(pE().warnOncePerTick(`${n} (no ${r} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(pE().warnOncePerTick(`${n} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(e,r=null,i=null){if(r!=null&&!r.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if(e.type==="point"){const n=e;if(!isFinite(n.x)||!isFinite(n.y))return pE().warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return Vbt}_defaultElevationInfoZ(){return Bbt}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,r=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,r=new D9){const i=e.geometry,n=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:n.unit,r.mode=this.getGeometryElevationMode(i,n),r.offsetMeters=this._elevationContext.meterUnitOffset??n.offset??0;const s=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";s&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=s?Nvt:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,e,this._context.layer),r}prepareSymbolLayerPatch(e){}updateGeometry(e,r){return!1}updateTransform(e,r,i,n){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,r=D0e){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?i*=e.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,r=D0e){const i=this._getCombinedOpacity(e,r);if(this._drivenProperties.color)return UI(null,i);const n=e!=null?De.toUnitRGB(e):Fg;return UI(n,i)}_getVertexOpacityAndColor(e,r=null){const i=this._drivenProperties.color?e.color:null,n=this._drivenProperties.opacity?e.opacity:null,s=UI(i,n);return r&&(s[0]*=r,s[1]*=r,s[2]*=r,s[3]*=r),s}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return Z5e(this.symbol,this.symbolLayer)}globalPropertyChanged(e,r,i){switch(e){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,n)!==Dn.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,r,i){let n=Dn.UPDATE;return e.forEach(s=>{const o=r(s);if(o!=null){const a=s.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else n=Dn.RECREATE}),n}applyRendererDiff(e,r){return ls.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const r=this._fastUpdates.visualVariables,i=r.size?tm(r.size.field,e):0,n=r.color?tm(r.color.field,e):0,s=r.opacity?tm(r.opacity.field,e):0;return Xt(i,n,s,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&pE().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var r,i,n,s,o,a,l,c;return{size:((i=(r=this._fastUpdates)==null?void 0:r.visualVariables.size)==null?void 0:i.field)??null,color:((s=(n=this._fastUpdates)==null?void 0:n.visualVariables.color)==null?void 0:s.field)??null,opacity:((a=(o=this._fastUpdates)==null?void 0:o.visualVariables.opacity)==null?void 0:a.field)??null,rotation:((c=(l=this._fastUpdates)==null?void 0:l.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function L0e(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(e.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const n=r.stops[i].color;n&&(e.opacity=!0,n.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const Vbt={mode:"on-the-ground",offset:0,unit:"meters"},Bbt={mode:"absolute-height",offset:0,unit:"meters"},D0e={hasIntrinsicColor:!1};let I_=class extends pN{get geometries(){return this._geometries}get transformation(){return this._transformation??fn}set transformation(e){this._transformation=cs(this._transformation??xe(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?cs(this._shaderTransformation??xe(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=Ln.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new K5e),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){_t(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const r=this._geometries.splice(e,1)[0];r&&(this._emit("geometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,r,i=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:r,sync:i}),QKe(r)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new Rz(h_.MaskOccludee);for(const r of this._geometries)r.occludees=rJ(r.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const r of this._geometries)r.occludees=iJ(r.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new Rz(h_.Highlight);for(const r of this._geometries)r.highlights=rJ(r.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const r of this._geometries)r.highlights=iJ(r.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,r){return Kr(r,this.transformation,e.transformation)}getCombinedShaderTransformation(e,r=xe()){return Kr(r,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new N0e,this._validateBoundingVolume(this._bvWorldSpace,zI.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new N0e,this._validateBoundingVolume(this._bvObjectSpace,zI.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,r){const i=r===zI.ObjectSpace;for(const n of this._geometries){const s=n.boundingInfo;s&&Gbt(s,e,i?n.transformation:this.getCombinedShaderTransformation(n))}pi(e.bounds,e.min,e.max,.5);for(const n of this._geometries){const s=n.boundingInfo;if(s==null)continue;const o=i?n.transformation:this.getCombinedShaderTransformation(n),a=WP(o);ze(F0e,s.center,o);const l=Bi(F0e,e.bounds),c=s.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){var r;const e=(r=this._bvWorldSpace)==null?void 0:r.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,r){this._parentLayer&&this._parentLayer.events.emit(e,r)}get test(){const e=this;return{hasGeometry:r=>e._geometries.includes(r),getGeometryIndex:r=>e._geometries.indexOf(r)}}},K5e=class{constructor(){this.min=Ce(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ce(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},N0e=class extends K5e{constructor(){super(...arguments),this.bounds=hs()}};function Gbt(t,e,r){const i=t.bbMin,n=t.bbMax;if(CB(r)){const s=se(jbt,r[12],r[13],r[14]);ge(ih,i,s),ge(Ip,n,s);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],ih[o]),e.max[o]=Math.max(e.max[o],Ip[o])}else if(ze(ih,i,r),aa(i,n))for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],ih[s]),e.max[s]=Math.max(e.max[s],ih[s]);else{ze(Ip,n,r);for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],ih[s],Ip[s]),e.max[s]=Math.max(e.max[s],ih[s],Ip[s]);for(let s=0;s<3;++s){he(ih,i),he(Ip,n),ih[s]=n[s],Ip[s]=i[s],ze(ih,ih,r),ze(Ip,Ip,r);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],ih[o],Ip[o]),e.max[o]=Math.max(e.max[o],ih[o],Ip[o])}}}const jbt=C(),ih=C(),Ip=C(),F0e=C();var zI;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(zI||(zI={}));function gle(t,e,r,i,n){const s=t.clippingExtent;if(Cn(e,Hv,t.elevationProvider.spatialReference),s!=null&&!wse(s,Hv))return null;Cn(e,Hv,t.renderCoordsHelper.spatialReference),r.localOrigin=t.localOriginFactory.getOrigin(Hv);const o=new I_({geometries:[r],castShadow:!1,layerUid:t.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0});return{object:o,sampledElevation:_vt(o,e,t.elevationProvider,t.renderCoordsHelper,i)}}function xD(t,e,r){const i=t.elevationContext,n=r.spatialReference;Cn(e,Hv,n),i.centerPointInElevationSR=uw(Hv[0],Hv[1],e.hasZ?Hv[2]:0,n??null)}function SD(t){switch(t.type){case"point":return t;case"polygon":case"extent":return ole(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const r=wPe(e,bPe(e)/2);return uw(r[0],r[1],r[2],t.spatialReference)}case"mesh":return t.origin}return null}const Hv=C();function eFe(){return new Float32Array(2)}function Hbt(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function kd(t,e){const r=new Float32Array(2);return r[0]=t,r[1]=e,r}function qbt(t,e){return new Float32Array(t,e,2)}function tFe(){return eFe()}function rFe(){return kd(1,1)}function iFe(){return kd(1,0)}function nFe(){return kd(0,1)}const sFe=tFe(),oFe=rFe(),Wbt=iFe(),Ybt=nFe();Object.freeze(Object.defineProperty({__proto__:null,ONES:oFe,UNIT_X:Wbt,UNIT_Y:Ybt,ZEROS:sFe,clone:Hbt,create:eFe,createView:qbt,fromValues:kd,ones:rFe,unitX:iFe,unitY:nFe,zeros:tFe},Symbol.toStringTag,{value:"Module"}));function aFe(t){const e=new Fr,{vertex:r,fragment:i}=e;return r.include(sG),e.include(v4e,t),e.include(Wn,t),e.attributes.add(R.UV0,"vec2"),r.uniforms.add(new Or("viewport",(n,s)=>s.camera.fullViewport),new Ie("lineSize",(n,s)=>n.size>0?Math.max(1,n.size)*s.camera.pixelRatio:0),new ci("pixelToNDC",(n,s)=>yr(U0e,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new Ie("borderSize",(n,s)=>n.borderColor!=null?s.camera.pixelRatio:0),new ci("screenOffset",(n,s)=>yr(U0e,n.horizontalScreenOffset*s.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.multipassEnabled&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(k4e),t.hasScreenSizePerspective&&nG(r),r.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?T`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?T`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:T`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.multipassEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?T`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:T`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?T`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:T`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add(new Or("uColor",n=>k0e(n.color)),new Or("borderColor",n=>k0e(n.borderColor))),t.multipassEnabled&&(i.include(CDe,t),i.uniforms.add(new ci("inverseViewport",(n,s)=>s.inverseViewport))),i.code.add(T`
    void main() {
      ${t.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?T`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:T`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function k0e(t){return t??Fh}const U0e=Ye(),Xbt=Object.freeze(Object.defineProperty({__proto__:null,build:aFe},Symbol.toStringTag,{value:"Module"}));let lFe=class cFe extends Zr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Fe.Global}initializeProgram(e){return new Br(e.rctx,cFe.shader.get().build(this.configuration),Nr)}setPipelineState(e){const r=e?si.ALWAYS:si.LESS;return this.configuration.depthHudEnabled?Bt({depthTest:{func:r},depthWrite:Wu}):Bt({blending:ya(Ee.ONE,Ee.SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:rr})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}};lFe.shader=new Vr(Xbt,()=>re(()=>Promise.resolve().then(()=>Mjt),void 0));let _d=class extends Zl{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.multipassEnabled=!1}};d([H()],_d.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([H()],_d.prototype,"spherical",void 0),d([H()],_d.prototype,"occlusionTestEnabled",void 0),d([H()],_d.prototype,"hasVerticalOffset",void 0),d([H()],_d.prototype,"hasScreenSizePerspective",void 0),d([H()],_d.prototype,"depthHudEnabled",void 0),d([H()],_d.prototype,"depthHudAlignStartEnabled",void 0),d([H()],_d.prototype,"hasSlicePlane",void 0),d([H()],_d.prototype,"multipassEnabled",void 0),d([H({constValue:!0})],_d.prototype,"hasSliceInVertexProgram",void 0),d([H({constValue:!1})],_d.prototype,"draped",void 0);let cF=class Gee extends mw{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new uFe),this.produces=new Map([[de.LINE_CALLOUTS,r=>r===G.Color],[de.LINE_CALLOUTS_HUD_DEPTH,r=>r===G.Color]]),this._configuration=new _d,this._uniqueMaterialIdentifier=Gee.uniqueMaterialIdentifier(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,r){const i=(r==null?void 0:r.slot)!==de.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration}intersect(){}createGLMaterial(e){return new Zbt(e)}createBufferWriter(){return new Qbt}validateParameters(e){const r=Gee.uniqueMaterialIdentifier(e);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(e){return JSON.stringify({horizontalScreenOffset:e.horizontalScreenOffset??0,centerOffsetUnits:e.centerOffsetUnits||"world"})}},Zbt=class extends fw{beginSlot(e){return this.ensureTechnique(lFe,e)}},uFe=class extends Jae{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const Jbt=ln().vec3f(R.POSITION).vec3f(R.NORMAL).vec2f(R.UV0).vec4f(R.CENTEROFFSETANDDISTANCE),z0e=[kd(0,0),kd(1,0),kd(0,1),kd(1,0),kd(1,1),kd(0,1)];let Qbt=class{constructor(){this.vertexBufferLayout=Jbt}elementCount(e){return 6*e.attributes.get(R.POSITION).indices.length}write(e,r,i,n,s){Qae(i.attributes.get(R.POSITION),e,n.position,s,6),Kae(i.attributes.get(R.NORMAL),r,n.normal,s,6),gA(i.attributes.get(R.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,s,6);for(let o=0;o<z0e.length;++o)n.uv0.setVec(s+o,z0e[o])}},hFe=class dFe extends Cy{constructor(e,r){super(e,null,r,ewt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new cF(this._materialParameters),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const r=this._materialParameters;return r.horizontalScreenOffset=e.horizontalScreenOffset??0,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}get _materialParameters(){var o;const e=new uFe,r=this.symbol,i=r.callout;if(e.color=i.color!=null?De.toUnitRGBA(i.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=bs(i.size||0),r.verticalOffset){const{screenLength:a,minWorldLength:l,maxWorldLength:c}=r.verticalOffset;e.verticalOffset={screenLength:bs(a),minWorldLength:l||0,maxWorldLength:c??1/0}}e.borderColor=((o=i.border)==null?void 0:o.color)!=null?De.toUnitRGBA(i.border.color):null;const n=r.symbolLayers.at(0).type==="object",s=r.type==="label-3d";return e.occlusionTest=!n,e.shaderPolygonOffset=n?0:void 0,e.depthHUDAlignStart=s,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Kbt}createGraphics3DGraphic(e){const r=e.renderingInfo,i=e.graphic,n=this.setGraphicElevationContext(i,new D9,r.elevationOffset||0),s=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(s.type==="cim"||!s.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(s.type!=="label-3d"&&o||s.type==="point-3d"&&s.symbolLayers.every(l=>l.type==="text"&&!WIe(l)))return null;const a=ole(i.geometry);return a==null?null:this._createAs3DShape(a,n,r,i.uid)}layerOpacityChanged(){var e;(e=this._materials[0])==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=NN(dFe.elevationModeChangeTypes,i,n);return s!==Dn.UPDATE||e.forEach(o=>{const a=r(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),s}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,r,i=0){return super.setGraphicElevationContext(e,r),r.addOffsetRenderUnits(i),r}updateGraphicElevationContext(e,r){this.setGraphicElevationContext(e,r.elevationContext,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=mp(r.elevationContext.mode)}computeComplexity(){return new Rd({verticesPerFeature:6})}_createVertexData(e){const{translation:r,centerOffset:i}=e,n=new tt(r?[r[0],r[1],r[2]]:[0,0,0],Oq,3,!0),s=new tt(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],Oq,4,!0);return[[R.POSITION,n],[R.NORMAL,new tt([0,0,1],Oq,3,!0)],[R.CENTEROFFSETANDDISTANCE,s]]}_getOrCreateMaterial(e){var n;const r=this._perInstanceMaterialParameters(e),i=cF.uniqueMaterialIdentifier(r);if(i===((n=this._materials[0])==null?void 0:n.uniqueMaterialIdentifier))return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let s=e.materialCollection.get(i);return s==null&&(s=new cF(r),e.materialCollection.add(i,s)),{material:s,isUnique:!1}}return{material:new cF(r),isUnique:!0}}_createAs3DShape(e,r,i,n){const s=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:s}),a=this._getOrCreateMaterial(i),l=new Is(a.material,this._createVertexData(i),null,Ln.Point,o),c=gle(this._context,e,l,r,n);if(c==null)return null;const u=new Ey(this,c.object,[l],a.isUnique?[a.material]:null,null,xT,r);return u.metadata=new l5e(i.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=mp(r.mode),xD(u,e,this._context.elevationProvider),u}};hFe.elevationModeChangeTypes={definedChanged:Dn.UPDATE,staysOnTheGround:Dn.UPDATE,onTheGroundChanged:Dn.RECREATE};const Oq=[0],Kbt={mode:"relative-to-ground",offset:0},ewt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let twt=class{constructor(e,r,i=C(),n=tr(),s=0,o="world",a=0,l=null){this.renderer=e,this.symbol=r,this.translation=i,this.centerOffset=n,this.horizontalScreenOffset=s,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},rwt=class extends Fvt{};const V0e=()=>K.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function iwt(t,e){if(!Joe(t))return V0e().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const r=nwt[t.callout.type];return r?new r(t,e):(V0e().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const nwt={line:hFe},yle=(t,e,r)=>[e,r],vA=(t,e,r)=>[e,r,t[2]],_le=(t,e,r)=>[e,r,t[2],t[3]];function _tr(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function swt({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function owt({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function pFe({scale:t,translate:e},r){return r*t[0]+e[0]}function fFe({scale:t,translate:e},r){return e[1]-r*t[1]}function mFe(t,e,r){const i=new Array(r.length);if(!r.length)return i;const[n,s]=t.scale;let o=pFe(t,r[0][0]),a=fFe(t,r[0][1]);i[0]=e(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*n,a-=c[1]*s,i[l]=e(c,o,a)}return i}function gFe(t,e,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=mFe(t,e,r[n]);return i}function awt(t,e,r,i){return mFe(t,r?i?_le:vA:i?vA:yle,e)}function lwt(t,e,r,i){return gFe(t,r?i?_le:vA:i?vA:yle,e)}function cwt(t,e,r,i){return gFe(t,r?i?_le:vA:i?vA:yle,e)}function vtr(t,e,r,i,n){return e.x=swt(t,r.x),e.y=owt(t,r.y),e!==r&&(i&&(e.z=r.z),n&&(e.m=r.m)),e}function yFe(t,e,r,i,n){return r!=null&&(e.points=awt(t,r.points,i,n)),e}function _Fe(t,e,r,i,n){return r==null||(e.x=pFe(t,r.x),e.y=fFe(t,r.y),e!==r&&(i&&(e.z=r.z),n&&(e.m=r.m))),e}function vFe(t,e,r,i,n){return r!=null&&(e.rings=cwt(t,r.rings,i,n)),e}function bFe(t,e,r,i,n){return r!=null&&(e.paths=lwt(t,r.paths,i,n)),e}let btr=class{constructor(e,r,i){this.uid=e,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}};function xtr(t){return t.geometry!=null}let Str=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function Etr(t,e){var u;const r=qL.fromJSON(t.geometryType),i=Ve.fromJSON(t.spatialReference),n=t.transform,s=t.objectIdFieldName,o=e==null?void 0:e.maxStringAttributeLength,a=e==null?void 0:e.maxStringAttributeFields;let l;const c=t.features.map(h=>{const p=uwt(h,r,i,t.objectIdFieldName),f=p.geometry;if(mwt(p.attributes,a,o,g=>{l??(l=[]);const y=fwt(p,s);y!=null&&l.push({objectId:y,attribute:g})}),f!=null&&n)switch(f.type){case"point":p.geometry=_Fe(n,f,f,f.hasZ,f.hasM);break;case"multipoint":p.geometry=yFe(n,f,f,!!f.hasZ,!!f.hasM);break;case"polygon":p.geometry=vFe(n,f,f,!!f.hasZ,!!f.hasM);break;case"polyline":p.geometry=bFe(n,f,f,!!f.hasZ,!!f.hasM);break;case"extent":case"mesh":p.geometry=f}return p});return{geometryType:r,features:c,spatialReference:i,fields:((u=t.fields)==null?void 0:u.map(h=>AN.fromJSON(h)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null,missingAttributes:l}}function uwt(t,e,r,i){return{uid:Dh(),objectId:i&&t.attributes?t.attributes[i]:null,attributes:t.attributes,geometry:hwt(t.geometry,e,r),visible:!0}}function hwt(t,e,r){if(t==null)return null;switch(e){case"point":{const i=t;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=t;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=t;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=t;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function dwt(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),n=t.type==="polyline"?t.paths:t.rings;for(const s of n)r+=s.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32*(n.length+1);break}case"multipoint":{const r=2+(t.hasZ?1:0)+(t.hasM?1:0),i=t.points.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=i_(t.vertexAttributes.position,t.vertexAttributes.normal,t.vertexAttributes.uv,t.vertexAttributes.tangent)}return e}function Ctr(t){let e=32;return e+=AEe(t.attributes),e+=3,e+=8+dwt(t.geometry),e}function Ptr(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const r of t.paths)e+=r.length;return e}case"polygon":{let e=0;for(const r of t.rings)e+=r.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function Atr(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function Otr(t,e){switch(zi(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let r=0;r<t.paths.length;r++)jj(e,t.paths[r],!!t.hasZ);break;case"polygon":for(let r=0;r<t.rings.length;r++)jj(e,t.rings[r],!!t.hasZ);break;case"multipoint":jj(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function pwt(t,e){switch(kc(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let r=0;r<t.paths.length;r++)Fj(e,t.paths[r]);break;case"polygon":for(let r=0;r<t.rings.length;r++)Fj(e,t.rings[r]);break;case"multipoint":Fj(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function fwt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function mwt(t,e,r,i){if(e!=null&&e.size&&r!=null&&t)for(const n in t){if(!e.has(n))continue;const s=t[n];typeof s=="string"&&s.length>r&&(i(n),t[n]="")}}let o2=class jee{constructor(e=null,r={},i,n){this.geometry=e,this.attributes=r,this.centroid=i,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new jee(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){var i,n;const e=(i=this.geometry)==null?void 0:i.clone(),r=new jee(e,{...this.attributes},(n=this.centroid)==null?void 0:n.clone(),this.objectId);return r.displayId=this.displayId,r.geohashX=this.geohashX,r.geohashY=this.geohashY,r}};function gwt(t){var e,r;return!!((r=(e=t.geometry)==null?void 0:e.coords)!=null&&r.length)}let wFe=class xFe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new xFe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};const Mq=2;let zc=class KR{constructor(e=[],r=[],i=!1){this.lengths=e??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[r,i,n,s]=e,o=n-r,a=s-i;return new KR([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,r)=>e+r)}forEachVertex(e){let r=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const n=this.lengths[i];for(let s=0;s<n;s++)e(this.coords[Mq*(s+r)],this.coords[Mq*(s+r)+1]);r+=n}}deltaDecode(){const e=this.clone(),{coords:r,lengths:i}=e;let n=0;for(const s of i){for(let o=1;o<s;o++)r[2*(n+o)]+=r[2*(n+o)-2],r[2*(n+o)+1]+=r[2*(n+o)-1];n+=s}return e}clone(e){if(this.lengths.length===0)return new KR([],[this.coords[0],this.coords[1]]);const r=(this.lengths.length===0?1:this.lengths.reduce((n,s)=>n+s))*Mq,i=this.coords.slice(0,r);return e?(e.set(i),new KR(this.lengths,e,this.hasIndeterminateRingOrder)):new KR(Array.from(this.lengths),Array.from(i),this.hasIndeterminateRingOrder)}};function pl(t,e){return t?e?4:3:e?3:2}const BN=()=>K.getLogger("esri.layers.graphics.featureConversionUtils"),SFe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},ywt=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s},B0e=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+2]},_wt=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+3]},vwt=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+2],t[r+3]=e[i+3]};function vle(t,e,r,i){if(t){if(r)return e&&i?vwt:B0e;if(e&&i)return _wt}else if(e&&i)return B0e;return ywt}function Rq({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function $q({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function Iq({scale:t,translate:e},r,i){return r*t[i]+e[i]}function Mtr(t,e,r){return t?e?r?xle(t):ble(t):r?wle(t):yG(t):null}function yG(t){const e=t.coords;return{x:e[0],y:e[1]}}function TFe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function ble(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function bwt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function wle(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function wwt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function xle(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function xwt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function Swt(t,e,r,i){let n=yG;r&&i?n=xle:r?n=ble:i&&(n=wle);for(const s of e){const{geometry:o,attributes:a}=s,l=o!=null?n(o):null;t.push({attributes:a,geometry:l})}return t}function Sle(t,e){return t&&e?xwt:t?bwt:e?wwt:TFe}function Twt(t,e,r,i,n){const s=Sle(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?s(new zc,o):null;t.push(new o2(l,a,null,n?a[n]:void 0))}return t}function Ewt(t,e,r=Sle(e.z!=null,e.m!=null)){return r(t,e)}function Cwt(t,e,r,i){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?EFe(n,r,i):null});return t}function EFe(t,e,r){if(t==null)return null;const i=pl(e,r),n=[];for(let s=0;s<t.coords.length;s+=i){const o=[];for(let a=0;a<i;a++)o.push(t.coords[s+a]);n.push(o)}return e?r?{points:n,hasZ:e,hasM:r}:{points:n,hasZ:e}:r?{points:n,hasM:r}:{points:n}}function Pwt(t,e,r,i,n){const s=pl(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?CFe(new zc,o,s):null;t.push(new o2(l,a,null,n?a[n]:void 0))}return t}function CFe(t,e,r=pl(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const i=t.coords;let n=0;for(const s of e.points)for(let o=0;o<r;o++)i[n++]=s[o];return t}function Awt(t,e,r,i){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?PFe(n,r,i):null});return t}function PFe(t,e,r){if(!t)return null;const i=pl(e,r),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const h=[];for(let p=0;p<i;p++)h.push(n[a++]);c.push(h)}o.push(c)}return e?r?{paths:o,hasZ:e,hasM:r}:{paths:o,hasZ:e}:r?{paths:o,hasM:r}:{paths:o}}function Owt(t,e,r,i,n){const s=pl(r,i);for(const{geometry:o,attributes:a,centroid:l}of e){const c=o!=null?AFe(new zc,o,s):null,u=l!=null?Ewt(new zc,l):null;t.push(new o2(c,a,u,n?a[n]:void 0))}return t}function AFe(t,e,r=pl(e.hasZ,e.hasM)){const{lengths:i,coords:n}=t;let s=0;for(const o of e.paths){for(const a of o)for(let l=0;l<r;l++)n[s++]=a[l];i.push(o.length)}return t}function Mwt(t,e,r,i){for(const{geometry:n,attributes:s,centroid:o}of e){const a=n!=null?OFe(n,r,i):null;if(o!=null){const l=yG(o);t.push({attributes:s,centroid:l,geometry:a})}else t.push({attributes:s,geometry:a})}return t}function OFe(t,e,r){if(!t)return null;const i=pl(e,r),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const h=[];for(let p=0;p<i;p++)h.push(n[a++]);c.push(h)}o.push(c)}return e?r?{rings:o,hasZ:e,hasM:r}:{rings:o,hasZ:e}:r?{rings:o,hasM:r}:{rings:o}}function Rwt(t,e,r,i,n){for(const{geometry:s,centroid:o,attributes:a}of e){const l=s!=null?MFe(new zc,s,r,i):null,c=n?a[n]:void 0;o!=null?t.push(new o2(l,a,TFe(new zc,o),c)):t.push(new o2(l,a,null,c))}return t}function MFe(t,e,r=e.hasZ,i=e.hasM){return $wt(t,e.rings,r,i)}function $wt(t,e,r,i){const n=pl(r,i),{lengths:s,coords:o}=t;let a=0;Z0(t);for(const l of e){for(const c of l)for(let u=0;u<n;u++)o[a++]=c[u];s.push(l.length)}return t}const uP=[],VI=[];function Rtr(t,e,r,i,n){uP[0]=t;const[s]=RFe(VI,uP,e,r,i,n);return ym(uP),ym(VI),s}function RFe(t,e,r,i,n,s){if(ym(t),!r){for(const o of e){const a=s?o.attributes[s]:void 0;t.push(new o2(null,o.attributes,null,a))}return t}switch(r){case"esriGeometryPoint":return Twt(t,e,i,n,s);case"esriGeometryMultipoint":return Pwt(t,e,i,n,s);case"esriGeometryPolyline":return Owt(t,e,i,n,s);case"esriGeometryPolygon":return Rwt(t,e,i,n,s);default:BN().error("convertToFeatureSet:unknown-geometry",new B(`Unable to parse unknown geometry type '${r}'`)),ym(t)}return t}function $tr(t,e,r,i){VI[0]=t,IFe(uP,VI,e,r,i);const n=uP[0];return ym(uP),ym(VI),n}function Iwt(t,e,r){if(t==null)return null;const i=new zc;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&r==null&&(r=t.hasM),GP(t)?Sle(e??t.z!=null,r??t.m!=null)(i,t):ol(t)?MFe(i,t,e,r):Lf(t)?AFe(i,t,pl(e,r)):dT(t)?CFe(i,t,pl(e,r)):void BN().error("convertFromGeometry:unknown-geometry",new B(`Unable to parse unknown geometry type '${t}'`))}function $Fe(t,e,r,i){const n=t&&("coords"in t?t:t.geometry);if(n==null)return null;switch(e){case"esriGeometryPoint":{let s=yG;return r&&i?s=xle:r?s=ble:i&&(s=wle),s(n)}case"esriGeometryMultipoint":return EFe(n,r,i);case"esriGeometryPolyline":return PFe(n,r,i);case"esriGeometryPolygon":return OFe(n,r,i);default:return BN().error("convertToGeometry:unknown-geometry",new B(`Unable to parse unknown geometry type '${e}'`)),null}}function Lwt(t,e){for(const r of e)t.push({attributes:r.attributes});return t}function IFe(t,e,r,i,n){if(ym(t),r==null)return Lwt(t,e);switch(r){case"esriGeometryPoint":return Swt(t,e,i,n);case"esriGeometryMultipoint":return Cwt(t,e,i,n);case"esriGeometryPolyline":return Awt(t,e,i,n);case"esriGeometryPolygon":return Mwt(t,e,i,n);default:BN().error("convertToFeatureSet:unknown-geometry",new B(`Unable to parse unknown geometry type '${r}'`))}return t}function Itr(t){const{objectIdFieldName:e,spatialReference:r,transform:i,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:p}=t,f={features:IFe([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:e,spatialReference:r,uniqueIdField:u,queryGeometry:$Fe(h,p,!1,!1)};return i&&(f.transform=i),c&&(f.exceededTransferLimit=c),s&&(f.hasM=s),o&&(f.hasZ=o),f}function Ltr(t,e){const r=new wFe,{hasM:i,hasZ:n,features:s,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:h}=t;return h&&(r.fields=h),r.geometryType=l??null,r.objectIdFieldName=o??e??null,r.spatialReference=a??null,r.objectIdFieldName?(s&&RFe(r.features,s,l,n,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),n&&(r.hasZ=n),u&&(r.transform=u),r):(BN().error(new B("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function Dtr(t){const{transform:e,features:r,hasM:i,hasZ:n}=t;if(!e)return t;for(const s of r)s.geometry!=null&&qee(s.geometry,s.geometry,i,n,e),s.centroid!=null&&qee(s.centroid,s.centroid,i,n,e);return t.transform=null,t}function Ntr(t,e){const{geometryType:r,features:i,hasM:n,hasZ:s}=e;if(!t)return e;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new zc,G0e(l.geometry,a.geometry,n,s,r,t),a.centroid&&(l.centroid=new zc,G0e(l.centroid,a.centroid,n,s,"esriGeometryPoint",t)),i[o]=l}return e.transform=t,e}function G0e(t,e,r,i,n,s,o=r,a=i){if(Z0(t),!(e!=null&&e.coords.length))return null;const l=SFe[n],{coords:c,lengths:u}=e,h=pl(r,i),p=pl(r&&o,i&&a),f=vle(r,i,o,a);if(!u.length)return f(t.coords,c,0,0,Rq(s,c[0]),$q(s,c[1])),Z0(t,h,0),t;let g,y,v,b,w=0,x=0,S=x;for(const E of u){if(E<l)continue;let P=0;x=S,v=g=Rq(s,c[w]),b=y=$q(s,c[w+1]),f(t.coords,c,x,w,v,b),P++,w+=h,x+=p;for(let M=1;M<E;M++,w+=h)v=Rq(s,c[w]),b=$q(s,c[w+1]),v===g&&b===y||(f(t.coords,c,x,w,v-g,b-y),x+=p,P++,g=v,y=b);P>=l&&(t.lengths.push(P),S=x)}return ym(t.coords,S),t.coords.length?t:null}function Ftr(t,e,r,i,n,s,o=r,a=i){if(Z0(t),!(e!=null&&e.coords.length))return null;const l=SFe[n],{coords:c,lengths:u}=e,h=pl(r,i),p=pl(r&&o,i&&a),f=vle(r,i,o,a);if(!u.length)return f(t.coords,c,0,0,c[0],c[1]),Z0(t,h,0),t;let g=0;const y=s*s;for(const v of u){if(v<l){g+=v*h;continue}const b=t.coords.length/p,w=g,x=g+(v-1)*h;f(t.coords,c,t.coords.length,w,c[w],c[w+1]),Hee(t.coords,c,h,y,f,w,x),f(t.coords,c,t.coords.length,x,c[x],c[x+1]);const S=t.coords.length/p-b;S>=l?t.lengths.push(S):ym(t.coords,b*p),g+=v*h}return t.coords.length?t:null}function Dwt(t,e,r,i){const n=t[e],s=t[e+1],o=t[r],a=t[r+1],l=t[i],c=t[i+1];let u=o,h=a,p=l-u,f=c-h;if(p!==0||f!==0){const g=((n-u)*p+(s-h)*f)/(p*p+f*f);g>1?(u=l,h=c):g>0&&(u+=p*g,h+=f*g)}return p=n-u,f=s-h,p*p+f*f}function Hee(t,e,r,i,n,s,o){let a,l=i,c=0;for(let u=s+r;u<o;u+=r)a=Dwt(e,u,s,o),a>l&&(c=u,l=a);l>i&&(c-s>r&&Hee(t,e,r,i,n,s,c),n(t,e,t.length,c,e[c],e[c+1]),o-c>r&&Hee(t,e,r,i,n,c,o))}function ktr(t,e,r,i){var c;if(!((c=e==null?void 0:e.coords)!=null&&c.length))return null;const n=pl(r,i);let s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const u=e.coords;for(let h=0;h<u.length;h+=n){const p=u[h],f=u[h+1];s=Math.min(s,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return nJ(t)?det(t,s,o,a,l):OB(s,o,a,l,t),t}function qee(t,e,r,i,n){const{coords:s,lengths:o}=e,a=pl(r,i);if(!s.length)return t!==e&&Z0(t),t;JD(n);const{originPosition:l,scale:c,translate:u}=n,h=Fwt;h.originPosition=l;const p=h.scale;p[0]=c[0]??1,p[1]=-(c[1]??1),p[2]=c[2]??1,p[3]=c[3]??1;const f=h.translate;if(f[0]=u[0]??0,f[1]=u[1]??0,f[2]=u[2]??0,f[3]=u[3]??0,!o.length){for(let y=0;y<a;++y)t.coords[y]=Iq(h,s[y],y);return t!==e&&Z0(t,a,0),t}let g=0;for(let y=0;y<o.length;y++){const v=o[y];t.lengths[y]=v;for(let x=0;x<a;++x)t.coords[g+x]=Iq(h,s[g+x],x);let b=t.coords[g],w=t.coords[g+1];g+=a;for(let x=1;x<v;x++,g+=a){b+=s[g]*p[0],w+=s[g+1]*p[1],t.coords[g]=b,t.coords[g+1]=w;for(let S=2;S<a;++S)t.coords[g+S]=Iq(h,s[g+S],S)}}return t!==e&&Z0(t,s.length,o.length),t}function Utr(t,e,r,i,n,s){if(Z0(t),t.lengths.push(...e.lengths),r===n&&i===s)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=pl(r,i),a=vle(r,i,n,s),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function Nwt(t,e,r,i){let n=0,s=t[i*e],o=t[i*(e+1)];for(let a=1;a<r;a++){const l=s+t[i*(e+a)],c=o+t[i*(e+a)+1],u=(l-s)*(c+o);s=l,o=c,n+=u}return .5*n}function ztr(t,e){const{coords:r,lengths:i}=t;let n=0,s=0;for(let o=0;o<i.length;o++){const a=i[o];s+=Nwt(r,n,a,e),n+=a}return Math.abs(s)}function Z0(t,e=0,r=0){ym(t.lengths,r),ym(t.coords,e)}function ym(t,e=0){t.length!==e&&(t.length=e)}const Fwt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},j0e=new fa(Array,t=>HB(t,Tse),null,10,5),kwt=Ht();let Uwt=class{get labelLayers(){return this._labelLayers||yHe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,r,i,n,s){this.graphic=e,this.graphics3DSymbol=r,this.layers=i,this._visibleFlags=Da.ALL_LABEL,this.deconflictionPriority=0,++r.referenced,this._featureExpressionFeature=s?n5e(s,e,n):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,r){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(r),e.setVisibility(this.isVisible(Uo.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(e=!0)}),e}isVisible(e=Uo.GRAPHIC,r){const i=r?this._visibleFlags|r|Uo.LABEL*r:this._visibleFlags;return e===Uo.GRAPHIC?(i&Da.ALL_GRAPHIC)===Da.ALL_GRAPHIC:(i&Da.ALL_LABEL)===Da.ALL_LABEL}setVisibilityFlag(e,r,i){const n=this.isVisible(e);i?this._visibleFlags|=e*r:this._visibleFlags&=~(e*r);const s=this.isVisible(e);if(n===s)return!1;if(e===Uo.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(s));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(s));const o=this.isVisible(Uo.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,r){return(this._visibleFlags&e*r)!=0}computeExtent(e){if(!this._extent){const r=this.graphic.geometry;if(r==null)return!1;this._extent=Ht(),pwt(r,this._extent);const i=r.spatialReference;if(!yo(i,e)&&!v7(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,r){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,r)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,r,i){let n=e.geometry;return n.type!=="mesh"&&n.type!=="extent"||(n=ku.fromExtent(n.type==="mesh"?n.extent:n)),Iwt(n,r,i)}get usedMemory(){let e=AEe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>e+=r.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:C(),num:0},draped:{origin:Ye(),num:0}};for(const r of this.layers)r!=null&&r.computeAttachmentOrigin(e);return e.render.num>1&&oe(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Eu(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,r,i,n,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?zi(s.boundingBox):s.boundingBox=zi(),s.requiresDrapedElevation=!1,await dB(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?r:e,l=j0e.acquire(),c=await o.getProjectedBoundingBox(a,i,s.screenSpaceObjects,n,l);isFinite(c[2])&&isFinite(c[5])||(s.requiresDrapedElevation=!0),c&&YP(s.boundingBox,l),j0e.release(l)}),uet(s.boundingBox)||zZ(xse(s.boundingBox,kwt))?s:null}needsElevationUpdates(){var e;for(const r of this.layers)if(r!=null&&(r.type==="object3d"||r.type==="lod-instance")&&r.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(r=>(r==null?void 0:r.needsElevationUpdates)??!1))??!1}alignWithElevation(e,r,i){this._forEachRenderedGraphic(n=>{n.type!=="object3d"&&n.type!=="lod-instance"||n.alignWithElevation(e,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,r,i){this._forEachRenderedGraphic(n=>{n.type==="object3d"&&n.alignWithAbsoluteElevation(e,r,i)})}addObjectStateSet(e,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,r))}removeObjectState(e){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(e))}_forEachGraphicList(e,r){e==null||e.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:r=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(r)}}}},Btr=class{constructor(e,r){this.scheduler=e,this.schedule=r,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},zwt=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};function Vwt(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function H0e(t,e,r,i,n,s=!1){return{objectId:t,target:e,distance:r,type:"edge",start:i,end:n,draped:s}}var J0,ia;function p3(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function TD(t){return t!=null&&!isNaN(t)&&isFinite(t)}function LFe(t){return t.valueExpression?J0.Expression:t.field&&typeof t.field=="string"?J0.Field:J0.Unknown}function Bwt(t,e){const r=e||LFe(t),i=t.valueUnit||"unknown";return r===J0.Unknown?ia.Constant:t.stops?ia.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?ia.ClampedLinear:i==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?ia.Proportional:ia.Additive:ia.Identity:ia.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(J0||(J0={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(ia||(ia={}));const Xb=()=>K.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),q0e=new Hu,y8=Math.PI,DFe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function NFe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="color"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Xb().warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const n=typeof e=="number",s=n?null:e,o=s==null?void 0:s.attributes;let a=n?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let h=i.cache.compiledFunc;if(!l&&!u){const g=i.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(u){if((r==null?void 0:r.arcade)==null)return void Xb().error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,v=y.getViewInfo(g),b=y.createExecContext(s,v,r.timeZone);if(!h){const w=y.createSyntaxTree(i.valueExpression);h=y.createFunction(w),i.cache.compiledFunc=h}a=y.executeFunction(h,b)}else o&&(a=o[l]);const p=i.normalizationField,f=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||n||!isNaN(f)&&f!==0)){isNaN(f)||n||(a/=f);const g=Ele(a,c);if(g){const y=g[0],v=g[1],b=y===v?i.stops[y].color:De.blendColors(i.stops[y].color,i.stops[v].color,g[2],r!=null?r.color:void 0);return new De(b)}}}function FFe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="opacity"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Xb().warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const n=typeof e=="number",s=n?null:e,o=s==null?void 0:s.attributes;let a=n?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let h=i.cache.compiledFunc;if(!l&&!u){const g=i.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(u){if((r==null?void 0:r.arcade)==null)return void Xb().error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,v=y.getViewInfo(g),b=y.createExecContext(s,v,r.timeZone);if(!h){const w=y.createSyntaxTree(i.valueExpression);h=y.createFunction(w),i.cache.compiledFunc=h}a=y.executeFunction(h,b)}else o&&(a=o[l]);const p=i.normalizationField,f=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||n||!isNaN(f)&&f!==0)){isNaN(f)||n||(a/=f);const g=Ele(a,c);if(g){const y=g[0],v=g[1];if(y===v)return i.stops[y].opacity;{const b=i.stops[y].opacity;return b+(i.stops[v].opacity-b)*g[2]}}}}function kFe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(f=>f.type==="rotation"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Xb().warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const n=i.axis||"heading",s=n==="heading"&&i.rotationType==="arithmetic"?90:0,o=n==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a==null?void 0:a.attributes,c=i.field,{hasExpression:u}=i.cache;let h=i.cache.compiledFunc,p=0;if(!c&&!u)return p;if(u){if((r==null?void 0:r.arcade)==null)return void Xb().error("Use of arcade expressions requires an arcade context");const f={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},g=r.arcade.arcadeUtils,y=g.getViewInfo(f),v=g.createExecContext(a,y,r.timeZone);if(!h){const b=g.createSyntaxTree(i.valueExpression);h=g.createFunction(b),i.cache.compiledFunc=h}p=g.executeFunction(h,v)}else l&&(p=l[c]||0);return p=typeof p!="number"||isNaN(p)?null:s+o*p,p}function Gwt(t,e,r){const i=typeof e=="number",n=i?null:e,s=n==null?void 0:n.attributes;let o=i?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const u=r!=null?r.scale:void 0,h=r!=null?r.view:void 0;o=u==null||h==="3d"?jwt(t):u}else if(!i)switch(t.inputValueType){case J0.Expression:{if((r==null?void 0:r.arcade)==null)return void Xb().error("Use of arcade expressions requires an arcade context");const u={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},h=r.arcade.arcadeUtils,p=h.getViewInfo(u),f=h.createExecContext(n,p,r.timeZone);if(!l){const g=h.createSyntaxTree(t.valueExpression);l=h.createFunction(g),t.cache.compiledFunc=l}o=h.executeFunction(l,f);break}case J0.Field:s&&(o=s[t.field]);break;case J0.Unknown:o=null}if(!TD(o))return null;if(i||!t.normalizationField)return o;const c=s?parseFloat(s[t.normalizationField]):null;return TD(c)&&c!==0?o/c:null}function jwt(t){let e=null,r=null;const i=t.stops;return i?(e=i[0].value,r=i[i.length-1].value):(e=t.minDataValue||0,r=t.maxDataValue||0),(e+r)/2}function _G(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(s=>s.type==="size"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Xb().warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const n=zFe(Gwt(i,e,r),i,e,r,i.cache.ipData);return n==null||isNaN(n)?0:n}function zu(t,e,r){return t==null?null:p3(t)?_G(t,e,r):TD(t)?t:null}function UFe(t,e,r){return TD(r)&&t>r?r:TD(e)&&t<e?e:t}function Hwt(t,e,r,i){return t+((zu(e.minSize,r,i)||e.minDataValue)??0)}function qwt(t,e,r){const i=t.stops;let n=(i==null?void 0:i.length)&&i[0].size;return n==null&&(n=t.minSize),zu(n,e,r)}function Wwt(t,e,r,i){const n=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),s=zu(e.minSize,r,i),o=zu(e.maxSize,r,i),a=i!=null?i.shape:void 0;if(t<=e.minDataValue)return s;if(t>=e.maxDataValue)return o;if(s==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?y8*(s/2)**2:s*s,u=c+n*((l?y8*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/y8):Math.sqrt(u)}return s+n*(o-s)}function Ywt(t,e,r,i){const n=i!=null?i.shape:void 0,s=t/e.minDataValue,o=zu(e.minSize,r,i),a=zu(e.maxSize,r,i);let l=null;return l=n==="circle"?2*Math.sqrt(s*(o/2)**2):n==="square"||n==="diamond"||n==="image"?Math.sqrt(s*o**2):s*o,UFe(l,o,a)}function Xwt(t,e,r,i,n){var l,c,u;const[s,o,a]=Ele(t,n);if(s===o)return zu((l=e.stops)==null?void 0:l[s].size,r,i);{const h=zu((c=e.stops)==null?void 0:c[s].size,r,i);return h+(zu((u=e.stops)==null?void 0:u[o].size,r,i)-h)*a}}function Zwt(t,e,r,i){const n=((i==null?void 0:i.resolution)??1)*pA[e.valueUnit],s=zu(e.minSize,r,i),o=zu(e.maxSize,r,i),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/y8)/n:a==="radius"||a==="distance"?2*t/n:t/n,UFe(l,s,o)}function zFe(t,e,r,i,n){switch(e.transformationType){case ia.Additive:return Hwt(t,e,r,i);case ia.Constant:return qwt(e,r,i);case ia.ClampedLinear:return Wwt(t,e,r,i);case ia.Proportional:return Ywt(t,e,r,i);case ia.Stops:return Xwt(t,e,r,i,n);case ia.RealWorldSize:return Zwt(t,e,r,i);case ia.Identity:return t;case ia.Unknown:return null}}function Jwt(t,e,r){const{isScaleDriven:i}=t.cache;if(!(i&&r==="3d"||e))return null;const n={scale:e,view:r};let s=zu(t.minSize,q0e,n),o=zu(t.maxSize,q0e,n);if(s!=null||o!=null){if(s>o){const a=o;o=s,s=a}return{minSize:s,maxSize:o}}}function Tle(t,e,r){if(!t.visualVariables)return;const i=[],n=[],s=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":n.push(l);break;case"opacity":s.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return n.forEach(l=>{const c=NFe(l,e,r);i.push({variable:l,value:c})}),s.forEach(l=>{const c=FFe(l,e,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=kFe(l,e,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=_G(l,e,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function Ele(t,e){if(!e)return;let r=0,i=e.length-1;return e.some((n,s)=>t<n?(i=s,!0):(r=s,!1)),[r,i,(t-e[r])/(e[i]-e[r])]}function Qwt(t,e,r){const i=["proportional","proportional","proportional"];for(const n of t){const s=n.useSymbolValue?"symbol-value":_G(n,e,r);switch(n.axis){case"width":i[0]=s;break;case"depth":i[1]=s;break;case"height":i[2]=s;break;case"width-and-depth":i[0]=s,i[1]=s;break;case"all":case void 0:case null:i[0]=s,i[1]=s,i[2]=s;break;default:n.axis}}return i}const Htr=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:Qwt,getColor:NFe,getOpacity:FFe,getRotationAngle:kFe,getSize:_G,getSizeForValue:zFe,getSizeFromNumberOrVariable:zu,getSizeRangeAtScale:Jwt,getVisualVariableValues:Tle,viewScaleRE:DFe},Symbol.toStringTag,{value:"Module"}));function vG(t,e){if(!t||t.symbol)return null;const r=e==null?void 0:e.renderer;return t&&r!=null&&r.getObservationRenderer?r.getObservationRenderer(t):r}function Kwt(t,e){if(t.symbol!=null)return t.symbol;const r=vG(t,e);return r!=null&&r.type!=="dot-density"?r.getSymbol(t,e):null}function qtr(t,e){const r=vG(t,e),i=Kwt(t,e);if(i==null)return null;const n={renderer:r,symbol:i};if(r==null||!("visualVariables"in r)||!r.visualVariables)return n;const s=Tle(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)switch(a.type){case"color":n.color=l.toRgba();break;case"size":if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":n.opacity=l;break;case"rotation":switch(a.axis){case"tilt":n.tilt=l;break;case"roll":n.roll=l;break;default:n.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(n.size=o),n}async function ext(t,e){if(t.symbol!=null)return t.symbol;const r=vG(t,e);return r!=null?r.getSymbolAsync(t,e):null}async function Wtr(t,e){const r=vG(t,e),i=await ext(t,e);if(!i)return null;const n={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return n;const s=Tle(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)if(a.type==="color")n.color=De.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?n.opacity=l:a.type==="rotation"&&a.axis==="tilt"?n.tilt=l:a.type==="rotation"&&a.axis==="roll"?n.roll=l:a.type==="rotation"&&(n.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(n.size=o),n}function txt(t,e=0){const r=t[e];return typeof r=="number"&&isFinite(r)?r:null}function rxt(t){for(let e=0;e<3;e++){const r=t[e];if(typeof r=="number")return isFinite(r)?r:0}return 0}var BI,k9,Wee;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(BI||(BI={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(k9||(k9={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(Wee||(Wee={}));var Cs,Ud,GI,Os;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(Cs||(Cs={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Ud||(Ud={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(GI||(GI={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(Os||(Os={}));let ixt=class{constructor(e,r){this.vec3=e,this.id=r}};function U9(t,e,r,i){return new ixt(Ce(t,e,r),i)}let W0e=class{constructor(){this._extent=Ht(),this.resolution=0,this.renderLocalOrigin=U9(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new nxt}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const r=.001*e.range;if(this._extent[0]-r<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Sz(this._extent,e.range,0,i)}if(this._extent[2]+r>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Sz(this._extent,-e.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,c_(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}},nxt=class{constructor(){this.extents=[Ht(),Ht(),Ht()],this.numViews=0}};var Wi;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(Wi||(Wi={}));let sxt=class{constructor(e,r,i){this._fbos=e,this._format=r,this._name=i}get valid(){var e;return((e=this._handle)==null?void 0:e.getTexture())!=null}dispose(){this._handle=lr(this._handle)}get texture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}bind(e,r,i){var n,s,o;this._handle&&this._handle.fbo.width===r&&this._handle.fbo.height===i||((n=this._handle)==null||n.release(),this._handle=this._fbos.acquire(r,i,this._name,this._format)),e.unbindTexture((s=this._handle)==null?void 0:s.fbo.colorTexture),e.bindFramebuffer((o=this._handle)==null?void 0:o.fbo)}generateMipMap(){var e,r,i,n,s;(i=(r=(e=this._handle)==null?void 0:e.getTexture())==null?void 0:r.descriptor)!=null&&i.hasMipmap&&((s=(n=this._handle)==null?void 0:n.getTexture())==null||s.generateMipmap())}},fE=class{constructor(e,r,i,n,s=tn.RGBA_MIPMAP){this.output=i,this.content=n,this.fbo=new sxt(e,s,r)}get valid(){return this.fbo.valid}},oxt=class{constructor(e){this.targets=[new fE(e,"overlay color",G.Color,Wi.Color),new fE(e,"overlay IM color",G.Color,Wi.ColorNoRasterImage),new fE(e,"overlay highlight",G.Highlight,Wi.Highlight,tn.RGBA4),new fE(e,"overlay water",G.Normal,Wi.WaterNormal),new fE(e,"overlay occluded",G.Color,Wi.Occluded)],ne("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new fE(e,"overlay oid",G.ObjectAndLayerIdColor,Wi.ObjectAndLayerIdColor))}getTexture(e){var r;return(r=this.targets[e])==null?void 0:r.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,r,i)=>r.valid?e|=1<<i:e,0)}},Cle=class extends b5e{constructor(){super(...arguments),this.slicePlaneLocalOrigin=C(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var Cu;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(Cu||(Cu={}));let axt=class extends Cle{constructor(){super(...arguments),this.identifier=Cu.Material,this.output=G.Color,this.transparent=!1}},lxt=class extends Cle{constructor(){super(...arguments),this.identifier=Cu.ShadowMap}},cxt=class extends Cle{constructor(){super(...arguments),this.identifier=Cu.Highlight}};function uxt(t){t.fragment.code.add(T`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function hxt(t){t.fragment.code.add(T`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function dxt(t,e){const r=t.fragment;r.include(dy),r.uniforms.add(new ci("nearFar",(i,n)=>n.camera.nearFar)),r.uniforms.add(new ft("depthMap",(i,n)=>{var s;return(s=n.linearDepth)==null?void 0:s.getTexture()})),r.uniforms.add(new _n("proj",(i,n)=>n.camera.projectionMatrix)),r.uniforms.add(new Ie("invResolutionHeight",(i,n)=>1/n.camera.height)),r.uniforms.add(new _n("reprojectionMatrix",(i,n)=>n.ssr.reprojectionMatrix)),r.code.add(T`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function VFe(t,e){t.include(_bt,e),t.include(G7),t.include(hxt),e.hasCloudsReflections&&t.include(hDe,e),e.hasScreenSpaceReflections&&t.include(dxt,e);const r=t.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",D5e).add("ssrHeightFadeEnd","float",g8).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(T`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new Ie("lightingSpecularStrength",(i,n)=>n.lighting.mainLight.specularStrength),new Ie("lightingEnvironmentStrength",(i,n)=>n.lighting.mainLight.environmentStrength)),r.code.add(T`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&r.code.add(T`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(r.uniforms.add(new _n("view",(i,n)=>n.camera.viewMatrix),new ft("lastFrameColorTexture",(i,n)=>{var s;return(s=n.ssr.lastFrameColor)==null?void 0:s.getTexture()}),new Ie("fadeFactorSSR",(i,n)=>n.ssr.fadeFactor)),r.code.add(T`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(T`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?r.code.add(T`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(T`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(T`return waterRenderedColor;
}`)}let z9=class extends Pn{constructor(e,r){super(e,"vec4",kr.Draw,(i,n,s)=>i.setUniform4fv(e,r(n,s)))}};var Vg;function pxt(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new z9("overlayTexOffset",(n,s)=>fxt(n,s)),new z9("overlayTexScale",(n,s)=>mxt(n,s))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new ft("ovColorTex",(n,s)=>Yee(n,s))),BFe(t,e)}function mM(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new Y0e("overlayTexOffset"),new Y0e("overlayTexScale")),i.uniforms.add(new Ie("overlayOpacity",n=>n.overlayOpacity),new ft("ovColorTex",(n,s)=>{var o;return(o=s.overlay)==null?void 0:o.getTexture(n.overlayContent)})),BFe(t,e)}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(Vg||(Vg={}));let Y0e=class extends Pn{constructor(e){super(e,"vec4")}};function BFe(t,e){e.pbrMode!==ht.Water&&e.pbrMode!==ht.WaterOnIntegratedMesh&&e.pbrMode!==ht.TerrainWithWater||t.include(VFe,e);const{vertex:r,fragment:i}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(T`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(T`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(T`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(T`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==ht.Water&&e.pbrMode!==ht.WaterOnIntegratedMesh&&e.pbrMode!==ht.TerrainWithWater||(R_(i),by(i),i.code.add(T`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function Yee(t,e){var r,i,n;return t.identifier===Cu.Material&&t.output===G.Color?(r=e.overlay)==null?void 0:r.getTexture(Wi.ColorNoRasterImage):t.identifier===Cu.Material&&t.output===G.ObjectAndLayerIdColor?(i=e.overlay)==null?void 0:i.getTexture(Wi.ObjectAndLayerIdColor):t.identifier===Cu.Highlight?(n=e.overlay)==null?void 0:n.getTexture(Wi.Highlight):null}function fxt(t,e){var n,s,o,a;const r=(s=(n=e.overlay)==null?void 0:n.overlays[Cs.INNER])==null?void 0:s.extent;xz(r)&&($g[0]=t.toMapSpace[0]/sl(r)-r[0]/sl(r),$g[1]=t.toMapSpace[1]/Mc(r)-r[1]/Mc(r));const i=(a=(o=e.overlay)==null?void 0:o.overlays[Cs.OUTER])==null?void 0:a.extent;return xz(i)&&($g[2]=t.toMapSpace[0]/sl(i)-i[0]/sl(i),$g[3]=t.toMapSpace[1]/Mc(i)-i[1]/Mc(i)),$g}function mxt(t,e){var n,s,o,a;const r=(s=(n=e.overlay)==null?void 0:n.overlays[Cs.INNER])==null?void 0:s.extent;xz(r)&&($g[0]=t.toMapSpace[2]/sl(r),$g[1]=t.toMapSpace[3]/Mc(r));const i=(a=(o=e.overlay)==null?void 0:o.overlays[Cs.OUTER])==null?void 0:a.extent;return xz(i)&&($g[2]=t.toMapSpace[2]/sl(i),$g[3]=t.toMapSpace[3]/Mc(i)),$g}const $g=tr();let Ple=class extends Li{constructor(){super(...arguments),this.color=Ce(1,1,1)}};function GFe(){const t=new Fr;return t.include(gl),t.fragment.uniforms.add(new ft("tex",e=>e.texture),new zt("uColor",e=>e.color)),t.fragment.code.add(T`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);
}`),t}const gxt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Ple,build:GFe},Symbol.toStringTag,{value:"Module"}));let jFe=class{constructor(e){this._context=e,this._perConstructorInstances=new Hb,this._frameCounter=0,this._keepAliveFrameCount=X0e}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,r=_xt){const i=r.key;let n=this._perConstructorInstances.get(e,i);if(n==null){const s=new e(this._context,r,()=>this.release(s));n=new yxt(s),this._perConstructorInstances.set(e,i,n)}return++n.refCount,n.technique}releaseAndAcquire(e,r,i){if(i!=null){if(r.key===i.key)return i;this.release(i)}return this.acquire(e,r)}release(e){if(e==null||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(e.constructor,e.key);r!=null&&(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==X0e&&this._perConstructorInstances.forEach((e,r)=>{e.forEach((i,n)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,n))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((r,i)=>{const n=async(s,o)=>{const a=o.shader;a&&(await a.reload(),s.forEach(l=>l.technique.reload(this._context)))};e.push(n(r,i))}),await Promise.all(e)}},yxt=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const X0e=-1,_xt=new jc;let HFe=class{constructor(e,r,i,n){this._textureRepository=e,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=n,this._id2glMaterialRef=new Hb}dispose(){this._textureRepository.destroy()}acquire(e,r,i){this._ownMaterial(e);const n=e.produces.get(r);if(!n||!n(i))return null;let s=this._id2glMaterialRef.get(i,e.id);if(s==null){const o=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRepository:this._textureRepository,output:i});s=new vxt(o),this._id2glMaterialRef.set(i,e.id,s)}return s.ref(),s.glMaterial}release(e,r){const i=this._id2glMaterialRef.get(r,e.id);i!=null&&(i.unref(),i.referenced||(wt(i.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&K.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},vxt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,_t(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const bxt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let Xee=class _8{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,r){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new $o,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),$o.clearPool(),Zee[0]=null,Gw.prune(),Xx.prune()}add(e,r=e.length){this._objectCount+=r,this._grow(e,r);const i=$o.acquire();for(let n=0;n<r;n++){const s=e[n];this._isDegenerate(s)?this._degenerateObjects.add(s):(i.init(this._root),this._add(s,i))}$o.release(i)}remove(e,r=null){this._objectCount-=e.length;const i=$o.acquire();for(const n of e){const s=r??KT(this.objectToBoundingSphere(n),Ext);e$(s[3])?(i.init(this._root),this._remove(n,s,i)):this._degenerateObjects.delete(n)}$o.release(i),this._shrink()}update(e,r){if(!e$(r[3])&&this._isDegenerate(e))return;const i=Txt(e);this.remove(i,r),this.add(i)}forEachAlongRay(e,r,i){const n=Wh(e,r);this._forEachNode(this._root,s=>{if(!this._intersectsNode(n,s))return!1;const o=s.node;return o.terminals.forAll(a=>{this._intersectsObject(n,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(n,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(e,r,i,n){const s=Wh(e,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(s,o,n))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&i(l)}),!0})}forEach(e){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(e),i.residents!==null&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,r,i,n=()=>!0,s=1/0){let o=1/0,a=1/0,l=null;const c=Lq(e,r),u=h=>{if(--s,!n(h))return;const p=this.objectToBoundingSphere(h);if(!jv(i,p))return;const f=vv(e,r,p),g=f-p[3],y=f+p[3];g<o&&(o=g,a=y,l=h)};return this._forEachNodeDepthOrdered(this._root,h=>{if(s<=0||!jv(i,h.bounds)||(oe(nd,c,h.halfSize),ge(nd,nd,h.bounds),vv(e,r,nd)>a))return!1;const p=h.node;return p.terminals.forAll(f=>u(f)),p.residents!==null&&p.residents.forAll(f=>u(f)),!0},e,r),l}forEachInDepthRange(e,r,i,n,s,o,a){let l=-1/0,c=1/0;const u={setRange:y=>{i===_8.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,y.near),c=Math.min(c,y.far)):(l=Math.max(l,-y.far),c=Math.min(c,-y.near))}};u.setRange(n);const h=vv(r,i,e),p=Lq(r,i),f=Lq(r,-i),g=y=>{if(!a(y))return;const v=this.objectToBoundingSphere(y),b=v,w=vv(r,i,b)-h,x=w-v[3],S=w+v[3];x>c||S<l||!jv(o,v)||s(y,u)};this._forEachNodeDepthOrdered(this._root,y=>{if(!jv(o,y.bounds)||(oe(nd,p,y.halfSize),ge(nd,nd,y.bounds),vv(r,i,nd)-h>c)||(oe(nd,f,y.halfSize),ge(nd,nd,y.bounds),vv(r,i,nd)-h<l))return!1;const v=y.node;return v.terminals.forAll(b=>g(b)),v.residents!==null&&v.residents.forAll(b=>g(b)),!0},r,i)}forEachNode(e){this._forEachNode(this._root,r=>e(r.node,r.bounds,r.halfSize,r.depth))}forEachNeighbor(e,r){const i=H0(r),n=r,s=l=>{const c=this.objectToBoundingSphere(l),u=H0(c),h=i+u;return!(ca(c,n)-h*h<=0)||e(l)};let o=!0;const a=l=>{o&&(o=s(l))};this._forEachNode(this._root,l=>{const c=H0(l.bounds),u=i+c;if(ca(l.bounds,n)-u*u>0)return!1;const h=l.node;return h.terminals.forAll(a),o&&h.residents!==null&&h.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,r){return uF(r.bounds,2*-r.halfSize,Sh),uF(r.bounds,2*r.halfSize,Th),Ppe(e.origin,e.direction,Sh,Th)}_intersectsNodeWithOffset(e,r,i){return uF(r.bounds,2*-r.halfSize,Sh),uF(r.bounds,2*r.halfSize,Th),i.applyToMinMax(Sh,Th),Ppe(e.origin,e.direction,Sh,Th)}_intersectsObject(e,r){const i=this.objectToBoundingSphere(r);return!(i[3]>0)||iQ(i,e)}_intersectsObjectWithOffset(e,r,i){const n=this.objectToBoundingSphere(r);return!(n[3]>0)||iQ(i.applyToBoundingSphere(n),e)}_forEachNode(e,r){let i=$o.acquire().init(e);const n=[i];for(;n.length!==0;){if(i=n.pop(),r(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&n.push($o.acquire().init(i).advance(s));$o.release(i)}}_forEachNodeDepthOrdered(e,r,i,n=_8.DepthOrder.FRONT_TO_BACK){let s=$o.acquire().init(e);const o=[s];for(Sxt(i,n,Q0e);o.length!==0;){if(s=o.pop(),r(s)&&!s.isLeaf())for(let a=7;a>=0;--a){const l=Q0e[a];s.node.children[l]&&o.push($o.acquire().init(s).advance(l))}$o.release(s)}}_remove(e,r,i){Gw.clear();const n=i.advanceTo(r,(s,o)=>{Gw.push(s.node),Gw.push(o)})?i.node.terminals:i.node.residents;if(n.removeUnordered(e),n.length===0)for(let s=Gw.length-2;s>=0;s-=2){const o=Gw.data[s],a=Gw.data[s+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let r=0;r<e.children.length;r++)if(e.children[r])return!1;return!0}_purge(e,r){return r>=0&&(e.children[r]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new jt({shrink:!0})),!0)}_add(e,r){r.advanceTo(this.objectToBoundingSphere(e))?r.node.terminals.push(e):(r.node.residents.push(e),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(e){const r=e.node.residents;e.node.residents=null;for(let i=0;i<r.length;i++){const n=$o.acquire().init(e);this._add(r.at(i),n),$o.release(n)}}_grow(e,r){if(r!==0&&(Z0e(e,r,i=>this.objectToBoundingSphere(i),Fy),e$(Fy[3])&&!this._fitsInsideTree(Fy)))if(this._nodeIsEmpty(this._root.node))KT(Fy,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(Fy);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(Fy,i):this._growRootAsSubNode(i),$o.release(i)}}_rebuildTree(e,r){he(Nq,r.bounds),Nq[3]=r.halfSize,Z0e([e,Nq],2,n=>n,Fq);const i=$o.acquire().init(this._root);this._root.initFrom(null,Fq,Fq[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,n=>(this.add(n.node.terminals.data,n.node.terminals.length),n.node.residents!==null&&this.add(n.node.residents.data,n.node.residents.length),!0)),$o.release(i)}_placingRootViolatesMaxDepth(e){const r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,n=>(i=Math.max(i,n.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const r=e[3],i=e;let n=-1/0;const s=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=s[l]-o-(i[l]-r),u=i[l]+r-(s[l]+o),h=Math.max(0,Math.ceil(c/(2*o))),p=Math.max(0,Math.ceil(u/(2*o)))+1,f=2**Math.ceil(Math.log(h+p)*Math.LOG2E);n=Math.max(n,f),hF[l].min=h,hF[l].max=p}for(let l=0;l<3;l++){let c=hF[l].min,u=hF[l].max;const h=(n-(c+u))/2;c+=Math.ceil(h),u+=Math.floor(h);const p=s[l]-o-c*o*2;Dq[l]=p+(u+c)*o}const a=n*o;return Dq[3]=a*WFe,$o.acquire().initFrom(null,Dq,a,0)}_growRootAsSubNode(e){const r=this._root.node;he(Fy,this._root.bounds),Fy[3]=this._root.halfSize,this._root.init(e),e.advanceTo(Fy,null,!0),e.node.children=r.children,e.node.residents=r.residents,e.node.terminals=r.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const r=this._root.node.children;let i=0,n=0;for(;n<r.length&&e==null;)i=n++,e=r[i];for(;n<r.length;)if(r[n++])return-1;return i}_isDegenerate(e){return!e$(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const r=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=r[0]-i&&e[0]<=r[0]+i&&e[1]>=r[1]-i&&e[1]<=r[1]+i&&e[2]>=r[2]-i&&e[2]<=r[2]+i}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:r,_objectCount:i}=this,n=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:r,objectCount:i,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:n}}}_nodeToJSON(e){var s,o;const r=e.children.map(a=>a?this._nodeToJSON(a):null),i=(s=e.residents)==null?void 0:s.map(a=>this.objectToBoundingSphere(a)),n=(o=e.terminals)==null?void 0:o.map(a=>this.objectToBoundingSphere(a));return{children:r,residents:i,terminals:n}}static fromJSON(e){const r=new _8(i=>i,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return r._objectCount=e.objectCount,r._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),r}},$o=class bC{constructor(){this.bounds=hs(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,r,i,n=this.depth){return this.node=e??bC.createEmptyNode(),r&&KT(r,this.bounds),this.halfSize=i,this.depth=n,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*WFe}advance(e){let r=this.node.children[e];r||(r=bC.createEmptyNode(),this.node.children[e]=r),this.node=r,this.halfSize/=2,this.depth++;const i=qFe[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,r,i=!1){for(;;){if(this.isTerminalFor(e))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const n=this._childIndex(e);r&&r(this,n),this.advance(n)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const r=this.bounds;return(r[0]<e[0]?1:0)+(r[1]<e[1]?2:0)+(r[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new jt({shrink:!0}),residents:new jt({shrink:!0})}}static acquire(){return bC._pool.acquire()}static release(e){bC._pool.release(e)}static clearPool(){bC._pool.prune()}};function wxt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function xxt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function uF(t,e,r){r[0]=t[0]+e,r[1]=t[1]+e,r[2]=t[2]+e}function Z0e(t,e,r,i){if(e===1){const n=r(t[0]);KT(n,i)}else{Sh[0]=1/0,Sh[1]=1/0,Sh[2]=1/0,Th[0]=-1/0,Th[1]=-1/0,Th[2]=-1/0;for(let n=0;n<e;n++){const s=r(t[n]);e$(s[3])&&(wxt(Sh,s),xxt(Th,s))}pi(i,Sh,Th,.5),i[3]=Math.max(Th[0]-Sh[0],Th[1]-Sh[1],Th[2]-Sh[2])/2}}function Sxt(t,e,r){if(!Xx.length)for(let i=0;i<8;++i)Xx.push({index:0,distance:0});for(let i=0;i<8;++i){const n=qFe[i];Xx.data[i].index=i,Xx.data[i].distance=vv(t,e,n)}Xx.sort((i,n)=>i.distance-n.distance);for(let i=0;i<8;++i)r[i]=Xx.data[i].index}function Lq(t,e){let r,i=1/0;for(let n=0;n<8;++n){const s=vv(t,e,J0e[n]);s<i&&(i=s,r=J0e[n])}return r}function vv(t,e,r){return e*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2])}function e$(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}$o._pool=new fa($o),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(Xee||(Xee={}));const qFe=[Ce(-1,-1,-1),Ce(1,-1,-1),Ce(-1,1,-1),Ce(1,1,-1),Ce(-1,-1,1),Ce(1,-1,1),Ce(-1,1,1),Ce(1,1,1)],J0e=[Ce(-1,-1,-1),Ce(-1,-1,1),Ce(-1,1,-1),Ce(-1,1,1),Ce(1,-1,-1),Ce(1,-1,1),Ce(1,1,-1),Ce(1,1,1)],WFe=Math.sqrt(3),Zee=[null];function Txt(t){return Zee[0]=t,Zee}const Dq=hs(),nd=C(),Sh=C(),Th=C(),Gw=new jt,Ext=hs(),Fy=hs(),Nq=hs(),Fq=hs(),hF=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Xx=new jt,Q0e=[0,0,0,0,0,0,0,0],Bf=Xee;var db;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(db||(db={}));let YFe=class extends pN{get objects(){return this._objects}constructor(e,r,i=""){super(),this.stage=e,this.apiLayerUid=i,this.type=Ln.Layer,this.events=new Xn,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new jt,this._objectsAdded=new jt,this._handles=new iw,this.apiLayerUid=i,this.visible=(r==null?void 0:r.visible)??!0,this.pickable=(r==null?void 0:r.pickable)??!0,this.updatePolicy=(r==null?void 0:r.updatePolicy)??db.ASYNC,this._disableOctree=(r==null?void 0:r.disableOctree)??!1,e.add(this);for(const n of bxt)this._handles.add(this.events.on(n,s=>e.handleEvent(n,s)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const r of e)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const r=new Array;if(this._objects.removeUnorderedMany(e,e.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),this._octree!=null){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){this.updatePolicy!==db.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,r){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,r)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new Bf(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=Me(this._octree),this._objectsAdded.clear()}};function V9(t){return t!=null&&t.type===Ln.Layer}var Dc,a2;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(Dc||(Dc={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(a2||(a2={}));let Po=class extends Zl{constructor(){super(...arguments),this.output=G.Color,this.transparencyPassType=vt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Dc.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=a2.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===Dc.Draped}};d([H({count:G.COUNT})],Po.prototype,"output",void 0),d([H({count:vt.COUNT})],Po.prototype,"transparencyPassType",void 0),d([H()],Po.prototype,"occluder",void 0),d([H()],Po.prototype,"hasSlicePlane",void 0),d([H()],Po.prototype,"writeDepth",void 0),d([H({count:Dc.COUNT})],Po.prototype,"space",void 0),d([H()],Po.prototype,"hideOnShortSegments",void 0),d([H()],Po.prototype,"hasCap",void 0),d([H({count:a2.COUNT})],Po.prototype,"anchor",void 0),d([H()],Po.prototype,"hasTip",void 0),d([H()],Po.prototype,"vvSize",void 0),d([H()],Po.prototype,"vvColor",void 0),d([H()],Po.prototype,"vvOpacity",void 0),d([H()],Po.prototype,"hasOccludees",void 0),d([H()],Po.prototype,"multipassEnabled",void 0),d([H()],Po.prototype,"cullAboveGround",void 0),d([H({constValue:!1})],Po.prototype,"occlusionPass",void 0),d([H({constValue:!0})],Po.prototype,"hasVvInstancing",void 0),d([H({constValue:!0})],Po.prototype,"hasSliceTranslatedView",void 0);const K0e=8;function XFe(t,e){const r=t.vertex;r.uniforms.add(new Ie("intrinsicWidth",i=>i.width)),e.vvSize?(t.attributes.add(R.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new zt("vvSizeMinSize",i=>i.vvSize.minSize),new zt("vvSizeMaxSize",i=>i.vvSize.maxSize),new zt("vvSizeOffset",i=>i.vvSize.offset),new zt("vvSizeFactor",i=>i.vvSize.factor)),r.code.add(T`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(R.SIZE,"float"),r.code.add(T`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(R.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new Oc("vvOpacityValues",i=>i.vvOpacity.values,K0e),new Oc("vvOpacityOpacities",i=>i.vvOpacity.opacityValues,K0e)),r.code.add(T`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(T`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(X0,e),t.attributes.add(R.COLORFEATUREATTRIBUTE,"float"),r.code.add(T`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(R.COLOR,"vec4"),r.code.add(T`vec4 getColor(){
return applyOpacity(color);
}`))}function ED(t,e,r=0){const i=we(t,0,Axt);for(let n=0;n<4;n++)e[r+n]=Math.floor(256*Oxt(i*Cxt[n]))}function Ale(t,e=0){let r=0;for(let i=0;i<4;i++)r+=t[e+i]*Pxt[i];return r}const Cxt=[1,256,65536,16777216],Pxt=[1/256,1/65536,1/16777216,1/4294967296],Axt=Ale(new Uint8ClampedArray([255,255,255,255]));function Oxt(t){return t-Math.floor(t)}let ZFe=class{constructor(e,r,i){this._createTexture=e,this._parametersKey=r,this._repository=new Map,this._orphanCache=i.newCache(`procedural-texture-repository:${Dh()}`,n=>n.dispose())}destroy(){for(const[e,{texture:r}]of this._repository)r.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,r=null){const i=this._acquire(e);return this.release(r),i}release(e){if(e==null)return;const r=this._parametersKey(e),i=this._repository.get(r);if(i&&(i.refCount--,i.refCount===0)){this._repository.delete(r);const{texture:n}=i,s=n.usedMemory;this._orphanCache.put(r,n,s)}}_acquire(e){if(e==null)return null;const r=this._parametersKey(e),i=this._repository.get(r);if(i)return i.refCount++,i.texture;const n=this._orphanCache.pop(r)??this._createTexture(e),s=new Mxt(n);return this._repository.set(r,s),n}},Mxt=class{constructor(e){this.texture=e,this.refCount=1}};function Rxt(t,e){return new ZFe(r=>{const{encodedData:i,textureSize:n}=$xt(r),s=new ui;return s.internalFormat=Ot.RGBA,s.width=n,s.height=1,s.wrapMode=nr.REPEAT,new Mr(t,s,i)},r=>`${r.pattern.join(",")}-r${r.pixelRatio}`,e)}function $xt(t){const e=Ole(t),r=1/t.pixelRatio,i=JFe(t),n=QFe(t),s=(Math.floor(.5*(n-1))+.5)*r,o=[];let a=1;for(const p of e){for(let f=0;f<p;f++){const g=a*(Math.min(f,p-1-f)+.5)*r/s*.5+.5;o.push(g)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=new Uint8Array(4*i);let h=0;for(const p of c)ED(p,u,h),h+=4;return{encodedData:u,textureSize:i}}function Ole(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function JFe(t){if(t==null)return 1;const e=Ole(t);return Math.floor(e.reduce((r,i)=>r+i))}function QFe(t){return Ole(t).reduce((e,r)=>Math.max(e,r))}function Ixt(t){return t==null?Fh:t.length===4?t:pn(Lxt,t[0],t[1],t[2],1)}const Lxt=tr();function Dxt(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?Nxt(t,e):Fxt(t)}function Nxt(t,e){const r=!(e.draped&&e.stipplePreferContinuous),{vertex:i,fragment:n}=t;n.include(bp),e.draped||(mm(i,e),i.uniforms.add(new Ie("worldToScreenPerDistanceRatio",(s,o)=>1/o.camera.perScreenPixelRatio)),i.code.add(T`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),i.code.add(T`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${Uxt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(T`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(T`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),iO(i),i.code.add(T`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),n.uniforms.add(new ft("stipplePatternTexture",s=>s.stippleTexture),new Ie("stipplePatternSDFNormalizer",s=>kxt(s.stipplePattern)),new Ie("stipplePatternPixelSizeInv",s=>1/KFe(s))),n.code.add(T`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),e.stippleOffColorEnabled?(n.uniforms.add(new Or("stippleOffColor",s=>Ixt(s.stippleOffColor))),n.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):n.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Fxt(t){t.fragment.code.add(T`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function kxt(t){return t?(Math.floor(.5*(QFe(t)-1))+.5)/t.pixelRatio:1}function KFe(t){const e=t.stipplePattern;return e?JFe(t.stipplePattern)/e.pixelRatio:1}const Uxt=T.float(.4);async function y_(t,e){const{data:r}=await Vt(t,{responseType:"image",...e});return r}function zxt(){if(kq==null){const t=e=>di(`esri/libs/basisu/${e}`);kq=re(()=>import("./basis_transcoder-DRIKdGLg.js"),__vite__mapDeps([])).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(r=>(r.initializeBasis(),delete r.then,r)))}return kq}let kq;var PS;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(PS||(PS={}));let rm=null,dF=null;async function eke(){return dF==null&&(dF=zxt(),rm=await dF),dF}function Vxt(t,e){if(rm==null)return t.byteLength;const r=new rm.BasisFile(new Uint8Array(t)),i=rke(r)?tke(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}function Bxt(t,e){if(rm==null)return t.byteLength;const r=new rm.KTX2File(new Uint8Array(t)),i=ike(r)?tke(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}function tke(t,e,r,i,n){const s=aae(e?Bn.COMPRESSED_RGBA8_ETC2_EAC:Bn.COMPRESSED_RGB8_ETC2),o=n&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*s*o)}function rke(t){return t.getNumImages()>=1&&!t.isUASTC()}function ike(t){return t.getFaces()>=1&&t.isETC1S()}async function Gxt(t,e,r){rm==null&&(rm=await eke());const i=new rm.BasisFile(new Uint8Array(r));if(!rke(i))return null;i.startTranscoding();const n=nke(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(s,o)=>i.getImageTranscodedSizeInBytes(0,s,o),(s,o,a)=>i.transcodeImage(a,0,s,o,0,0));return i.close(),i.delete(),n}async function jxt(t,e,r){rm==null&&(rm=await eke());const i=new rm.KTX2File(new Uint8Array(r));if(!ike(i))return null;i.startTranscoding();const n=nke(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(s,o)=>i.getImageTranscodedSizeInBytes(s,0,0,o),(s,o,a)=>i.transcodeImage(a,s,0,0,o,0,-1,-1));return i.close(),i.delete(),n}function nke(t,e,r,i,n,s,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,h]=l?i?[PS.ETC2_RGBA,Bn.COMPRESSED_RGBA8_ETC2_EAC]:[PS.ETC1_RGB,Bn.COMPRESSED_RGB8_ETC2]:c?i?[PS.BC3_RGBA,Bn.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[PS.BC1_RGB,Bn.COMPRESSED_RGB_S3TC_DXT1_EXT]:[PS.RGBA32,Ot.RGBA],p=e.hasMipmap?r:Math.min(1,r),f=[];for(let g=0;g<p;g++)f.push(new Uint8Array(o(g,u))),a(g,u,f[g]);return e.internalFormat=h,e.hasMipmap=f.length>1,e.samplingMode=e.hasMipmap?Kt.LINEAR_MIPMAP_LINEAR:Kt.LINEAR,e.width=n,e.height=s,new Mr(t,e,{type:"compressed",levels:f})}const pF=()=>K.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),Hxt=542327876,qxt=131072,Wxt=4;function Mle(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function Yxt(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const Xxt=Mle("DXT1"),Zxt=Mle("DXT3"),Jxt=Mle("DXT5"),Qxt=31,Kxt=0,eSt=1,tSt=2,rSt=3,iSt=4,nSt=7,sSt=20,oSt=21;function aSt(t,e,r){const i=lSt(r,e.hasMipmap??!1);if(i==null)throw new Error("DDS texture data is null");const{textureData:n,internalFormat:s,width:o,height:a}=i;return e.samplingMode=n.levels.length>1?Kt.LINEAR_MIPMAP_LINEAR:Kt.LINEAR,e.hasMipmap=n.levels.length>1,e.internalFormat=s,e.width=o,e.height=a,new Mr(t,e,n)}function lSt(t,e){const r=new Int32Array(t,0,Qxt);if(r[Kxt]!==Hxt)return pF().error("Invalid magic number in DDS header"),null;if(!(r[sSt]&Wxt))return pF().error("Unsupported format, must contain a FourCC code"),null;const i=r[oSt];let n,s;switch(i){case Xxt:n=8,s=Bn.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Zxt:n=16,s=Bn.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Jxt:n=16,s=Bn.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return pF().error("Unsupported FourCC code:",Yxt(i)),null}let o=1,a=r[iSt],l=r[rSt];!(3&a)&&!(3&l)||(pF().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let h,p;r[tSt]&qxt&&e!==!1&&(o=Math.max(1,r[nSt]));let f=r[eSt]+4;const g=[];for(let y=0;y<o;++y)p=(a+3>>2)*(l+3>>2)*n,h=new Uint8Array(t,f,p),g.push(h),f+=p,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:s,width:c,height:u}}let Zb=class extends pN{get parameters(){return this._parameters}constructor(e,r){super(),this._data=e,this.type=Ln.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new Xn,this._parameters={...uSt,...r},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=r=>this._frameUpdate(e,r),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(vb(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const r=!e.paused;if(e.src=e.src,r&&e.autoplay){const i=()=>{e.removeEventListener("canplay",i),e.play()};e.addEventListener("canplay",i)}}}_startPreloadImageElement(e){yy(e.src)||vb(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const r=new ui;return r.wrapMode=this._parameters.wrap??nr.REPEAT,r.flipped=!this._parameters.noUnpackFlip,r.samplingMode=this._parameters.mipmap?Kt.LINEAR_MIPMAP_LINEAR:Kt.LINEAR,r.hasMipmap=!!this._parameters.mipmap,r.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,r.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),r}get glTexture(){return this._glTexture}get memoryEstimate(){var e;return((e=this._glTexture)==null?void 0:e.usedMemory)||cSt(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const r=this._data;return r==null?(this._glTexture=new Mr(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof r=="string"?this._loadFromURL(e,r):r instanceof Image?this._loadFromImageElement(e,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r):(HM(r)||Lv(r))&&this._parameters.encoding===G0.DDS_ENCODING?this._loadFromDDSData(e,r):(HM(r)||Lv(r))&&this._parameters.encoding===G0.KTX2_ENCODING?this._loadFromKTX2(e,r):(HM(r)||Lv(r))&&this._parameters.encoding===G0.BASIS_ENCODING?this._loadFromBasis(e,r):Lv(r)?this._loadFromPixelData(e,r):HM(r)?this._loadFromPixelData(e,new Uint8Array(r)):null)}_frameUpdate(e,r){return this._glTexture==null||e.readyState<jI.HAVE_CURRENT_DATA||r===e.currentTime?r:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,r){return this._glTexture=aSt(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>jxt(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(e,r){return this._loadAsync(()=>Gxt(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(e,r){_t(this._parameters.width>0&&this._parameters.height>0);const i=this._createDescriptor(e);return i.pixelFormat=this._parameters.components===1?Ot.LUMINANCE:this._parameters.components===3?Ot.RGB:Ot.RGBA,i.width=this._parameters.width??0,i.height=this._parameters.height??0,this._glTexture=new Mr(e,i,r),this._glTexture}_loadFromURL(e,r){return this._loadAsync(async i=>{const n=await y_(r,{signal:i});return dt(i),this._loadFromImage(e,n)})}_loadFromImageElement(e,r){return r.complete?this._loadFromImage(e,r):this._loadAsync(async i=>{const n=await ZCe(r,r.src,!1,i);return dt(i),this._loadFromImage(e,n)})}_loadFromVideoElement(e,r){return r.readyState>=jI.HAVE_CURRENT_DATA?this._loadFromImage(e,r):this._loadFromVideoElementAsync(e,r)}_loadFromVideoElementAsync(e,r){return this._loadAsync(i=>new Promise((n,s)=>{const o=()=>{r.removeEventListener("loadeddata",a),r.removeEventListener("error",l),Pi(c)},a=()=>{r.readyState>=jI.HAVE_CURRENT_DATA&&(o(),n(this._loadFromImage(e,r)))},l=u=>{o(),s(u||new B("Failed to load video"))};r.addEventListener("loadeddata",a),r.addEventListener("error",l);const c=la(i,()=>l(gr()))}))}_loadFromImage(e,r){let i=r;if(!(i instanceof HTMLVideoElement)){const{maxTextureSize:o}=e.parameters;i=this._parameters.downsampleUncompressed?Upt(i,o):zpt(i,o)}const n=ske(i);this._parameters.width=n.width,this._parameters.height=n.height;const s=this._createDescriptor(e);return s.pixelFormat=this._parameters.components===3?Ot.RGB:Ot.RGBA,s.width=n.width,s.height=n.height,this._glTexture=new Mr(e,s,i),this._glTexture}_loadAsync(e){const r=new AbortController;this._loadingController=r;const i=e(r.signal);this._loadingPromise=i;const n=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(n,n),i}unload(){if(this._glTexture=wt(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function cSt(t,e){if(t==null)return 0;if(HM(t)||Lv(t))return e.encoding===G0.KTX2_ENCODING?Bxt(t,!!e.mipmap):e.encoding===G0.BASIS_ENCODING?Vxt(t,!!e.mipmap):t.byteLength;const{width:r,height:i}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?ske(t):e;return(e.mipmap?4/3:1)*r*i*(e.components||4)||0}function ske(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var jI;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(jI||(jI={}));const uSt={wrap:{s:nr.REPEAT,t:nr.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1},B9=128,Rle=.5;function hSt(t){return t==="cross"||t==="x"}function dSt(t,e=B9,r=e*Rle,i=0){const n=oke(t,e,r,i);return new Zb(n,{mipmap:!1,wrap:{s:nr.CLAMP_TO_EDGE,t:nr.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function oke(t,e=B9,r=e*Rle,i=0){switch(t){case"circle":default:return pSt(e,r);case"square":return fSt(e,r);case"cross":return gSt(e,r,i);case"x":return ySt(e,r,i);case"kite":return mSt(e,r);case"triangle":return _St(e,r);case"arrow":return vSt(e,r)}}function pSt(t,e){const r=t/2-.5;return GN(t,cke(r,r,e/2))}function fSt(t,e){return ake(t,e,!1)}function mSt(t,e){return ake(t,e,!0)}function gSt(t,e,r=0){return lke(t,e,!1,r)}function ySt(t,e,r=0){return lke(t,e,!0,r)}function _St(t,e){return GN(t,uke(t/2,e,e/2))}function vSt(t,e){const r=e,i=e/2,n=t/2,s=.8*r,o=cke(n,(t-e)/2-s,Math.sqrt(s*s+i*i)),a=uke(n,r,i);return GN(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function ake(t,e,r){return r&&(e/=Math.SQRT2),GN(t,(i,n)=>{let s=i-.5*t+.25,o=.5*t-n-.75;if(r){const a=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=a}return Math.max(Math.abs(s),Math.abs(o))-.5*e})}function lke(t,e,r,i=0){e-=i,r&&(e*=Math.SQRT2);const n=.5*e;return GN(t,(s,o)=>{let a,l=s-.5*t,c=.5*t-o-1;if(r){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>n?Math.sqrt((l-n)*(l-n)+c*c):c:c>n?Math.sqrt(l*l+(c-n)*(c-n)):l,a-=i/2,a})}function cke(t,e,r){return(i,n)=>{const s=i-t,o=n-e;return Math.sqrt(s*s+o*o)-r}}function uke(t,e,r){const i=Math.sqrt(e*e+r*r);return(n,s)=>{const o=Math.abs(n-t)-r,a=s-t+e/2+.75,l=(e*o+r*a)/i,c=-a;return Math.max(l,c)}}function GN(t,e){const r=new Uint8Array(4*t*t);for(let i=0;i<t;i++)for(let n=0;n<t;n++){const s=n+t*i;let o=e(n,i);o=o/t+.5,ED(o,r,4*s)}return r}const ET=64,$le=ET/2,hke=$le/5,bSt=ET/hke,wSt=.25;function xSt(t,e){const r=oke(t,ET,$le,hke),i=new ui;return i.internalFormat=Ot.RGBA,i.width=ET,i.height=ET,i.wrapMode=nr.CLAMP_TO_EDGE,new Mr(e,i,r)}function dke(t,e){const{vertex:r,constants:i}=t;i.add("markerSizePerLineWidth","float",bSt),iO(r),r.uniforms.get("markerScale")==null&&r.constants.add("markerScale","float",1),r.code.add(T`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===Dc.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new Ie("perRenderPixelRatio",(n,s)=>s.camera.perRenderPixelRatio)),r.code.add(T`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var ep;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(ep||(ep={}));let On=class extends Zl{constructor(){super(...arguments),this.output=G.Color,this.capType=ep.BUTT,this.transparencyPassType=vt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};d([H({count:G.COUNT})],On.prototype,"output",void 0),d([H({count:ep.COUNT})],On.prototype,"capType",void 0),d([H({count:vt.COUNT})],On.prototype,"transparencyPassType",void 0),d([H()],On.prototype,"occluder",void 0),d([H()],On.prototype,"hasSlicePlane",void 0),d([H()],On.prototype,"hasPolygonOffset",void 0),d([H()],On.prototype,"writeDepth",void 0),d([H()],On.prototype,"draped",void 0),d([H()],On.prototype,"stippleEnabled",void 0),d([H()],On.prototype,"stippleOffColorEnabled",void 0),d([H()],On.prototype,"stipplePreferContinuous",void 0),d([H()],On.prototype,"roundJoins",void 0),d([H()],On.prototype,"applyMarkerOffset",void 0),d([H()],On.prototype,"vvSize",void 0),d([H()],On.prototype,"vvColor",void 0),d([H()],On.prototype,"vvOpacity",void 0),d([H()],On.prototype,"falloffEnabled",void 0),d([H()],On.prototype,"innerColorEnabled",void 0),d([H()],On.prototype,"hasOccludees",void 0),d([H()],On.prototype,"multipassEnabled",void 0),d([H()],On.prototype,"cullAboveGround",void 0),d([H()],On.prototype,"wireframe",void 0),d([H()],On.prototype,"objectAndLayerIdColorInstanced",void 0),d([H({constValue:!1})],On.prototype,"occlusionPass",void 0),d([H({constValue:!0})],On.prototype,"hasVvInstancing",void 0),d([H({constValue:!0})],On.prototype,"hasSliceTranslatedView",void 0);const CD=1;function pke(t){const e=new Fr,{attributes:r,varyings:i,constants:n,vertex:s,fragment:o}=e;e.include(MN),e.include(XFe,t),e.include(Dxt,t);const a=t.applyMarkerOffset&&!t.draped;a&&(s.uniforms.add(new Ie("markerScale",g=>g.markerScale)),e.include(dke,{space:Dc.World,draped:!1})),t.output===G.LinearDepth&&e.include(g_,t),e.include(aO,t),Uu(s,t),s.uniforms.add(new _n("inverseProjectionMatrix",(g,y)=>y.camera.inverseProjectionMatrix),new ci("nearFar",(g,y)=>y.camera.nearFar),new Ie("miterLimit",g=>g.join!=="miter"?0:g.miterLimit),new Or("viewport",(g,y)=>y.camera.fullViewport)),s.constants.add("LARGE_HALF_FLOAT","float",65500),r.add(R.POSITION,"vec3"),r.add(R.PREVPOSITION,"vec3"),r.add(R.NEXTPOSITION,"vec3"),r.add(R.SUBDIVISIONFACTOR,"float"),r.add(R.UV0,"vec2"),i.add("vColor","vec4"),i.add("vpos","vec3"),i.add("vLineDistance","float"),i.add("vLineWidth","float"),Bb(e);const l=t.multipassEnabled&&(t.output===G.Color||t.output===G.Alpha);l&&i.add("depth","float");const c=t.stippleEnabled;c&&i.add("vLineSizeInv","float"),n.add("aaWidth","float",t.stippleEnabled?0:1);const u=t.capType===ep.ROUND,h=t.stippleEnabled&&u,p=t.falloffEnabled||h;p&&i.add("vLineDistanceNorm","float"),u&&(i.add("vSegmentSDF","float"),i.add("vReverseSegmentSDF","float")),s.code.add(T`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),s.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),W7(e),s.code.add(T`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${l?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),iO(s),s.code.add(T`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${c?T`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),a&&s.code.add(T`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),s.code.add(T`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||u)&&s.code.add(T`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${u?T`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),s.code.add(T`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?s.code.add(T`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?T`min(1.0, subdivisionFactor * ${T.float((CD+2)/(CD+1))})`:T`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):s.code.add(T`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==ep.BUTT;return s.code.add(T`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?T`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),s.code.add(T`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${p?T`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),u&&s.code.add(T`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?s.uniforms.add(new Ie("worldToScreenRatio",(g,y)=>1/y.screenToPCSRatio)):s.code.add(T`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),s.code.add(T`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?s.code.add(T`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):s.code.add(T`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),s.uniforms.add(new Ie("stipplePatternPixelSize",g=>KFe(g))),s.code.add(T`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),s.code.add(T`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),l&&e.include(Yu,t),e.include(Wn,t),o.include(Ty),o.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${l?"terrainDepthTest(depth);":""}
  `),t.wireframe?o.code.add(T`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(u&&o.code.add(T`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${T.float(sa)}) {
          discard;
        }
      `),h?o.code.add(T`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${T.float(sa)}, stippleCoverage);
      `):o.code.add(T`float stippleAlpha = getStippleAlpha();`),t.output!==G.ObjectAndLayerIdColor&&o.code.add(T`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),o.uniforms.add(new Or("intrinsicColor",g=>g.color)),o.code.add(T`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(o.uniforms.add(new Or("innerColor",g=>g.innerColor??g.color),new Ie("innerWidth",(g,y)=>g.innerWidth*y.camera.pixelRatio)),o.code.add(T`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),o.code.add(T`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(o.uniforms.add(new Ie("falloff",g=>g.falloff)),o.code.add(T`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),t.stippleEnabled||o.code.add(T`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),o.code.add(T`
    ${t.output===G.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${T.float(sa)}) {
      discard;
    }

    ${t.output===G.Alpha?T`fragColor = vec4(finalColor.a);`:""}
    ${t.output===G.Color?T`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===G.Color&&t.transparencyPassType===vt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===G.Highlight?T`fragColor = vec4(1.0);`:""}
    ${t.output===G.LinearDepth?T`outputDepth(linearDepth);`:""}
    ${t.output===G.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const SSt=Object.freeze(Object.defineProperty({__proto__:null,build:pke,ribbonlineNumRoundJoinSubdivisions:CD},Symbol.toStringTag,{value:"Module"})),fke=new Map([[R.POSITION,0],[R.PREVPOSITION,1],[R.NEXTPOSITION,2],[R.SUBDIVISIONFACTOR,3],[R.UV0,4],[R.COLOR,5],[R.COLORFEATUREATTRIBUTE,5],[R.SIZE,6],[R.SIZEFEATUREATTRIBUTE,6],[R.OPACITYFEATUREATTRIBUTE,7],[R.OBJECTANDLAYERIDCOLOR,8]]);let mke=class gke extends Zr{initializeProgram(e){return new Br(e.rctx,gke.shader.get().build(this.configuration),fke)}_makePipelineState(e,r){const i=this.configuration,n=e===vt.NONE,s=e===vt.FrontFace,o=emt(i.output);return Bt({blending:i.output===G.Color||i.output===G.Alpha?n?Bh:$_(e):null,depthTest:{func:yw(e)},depthWrite:n?i.writeDepth||o?Wu:null:oG(e),colorWrite:rr,stencilWrite:i.hasOccludees?gy:null,stencilTest:i.hasOccludees?r?Yb:_w:null,polygonOffset:n||s?i.hasPolygonOffset?e_e:null:lG})}initializePipeline(){const e=this.configuration;if(e.occluder){const r=e.hasPolygonOffset?e_e:null;this._occluderPipelineTransparent=Bt({blending:Bh,polygonOffset:r,depthTest:N9,depthWrite:null,colorWrite:rr,stencilWrite:null,stencilTest:T5e}),this._occluderPipelineOpaque=Bt({blending:Bh,polygonOffset:r,depthTest:N9,depthWrite:null,colorWrite:rr,stencilWrite:x5e,stencilTest:S5e}),this._occluderPipelineMaskWrite=Bt({blending:null,polygonOffset:r,depthTest:cle,depthWrite:null,colorWrite:null,stencilWrite:gy,stencilTest:Yb})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?dr.LINES:dr.TRIANGLE_STRIP}getPipeline(e,r,i){return e?this._occludeePipelineState:this.configuration.occluder?i?this._occluderPipelineTransparent:r?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};mke.shader=new Vr(SSt,()=>re(()=>Promise.resolve().then(()=>Rjt),void 0));const e_e={factor:0,units:-4};var su;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(su||(su={}));let f3=class extends mw{constructor(e){super(e,new ESt),this._configuration=new On,this.produces=new Map([[de.OPAQUE_MATERIAL,r=>r===G.Highlight||r===G.ObjectAndLayerIdColor||(r===G.Color||r===G.Alpha)&&this.parameters.renderOccluded===Wr.OccludeAndTransparentStencil],[de.OPAQUE_NO_SSAO_DEPTH,r=>r===G.LinearDepth],[de.OCCLUDER_MATERIAL,r=>dee(r)&&this.parameters.renderOccluded===Wr.OccludeAndTransparentStencil],[de.TRANSPARENT_OCCLUDER_MATERIAL,r=>dee(r)&&this.parameters.renderOccluded===Wr.OccludeAndTransparentStencil],[de.TRANSPARENT_MATERIAL,r=>(r===G.Color||r===G.Alpha)&&this.parameters.writeDepth&&this.parameters.renderOccluded!==Wr.OccludeAndTransparentStencil],[de.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,r=>(r===G.Color||r===G.Alpha)&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==Wr.OccludeAndTransparentStencil],[de.DRAPED_MATERIAL,r=>BDe(r)]]),this._vertexAttributeLocations=fke}getConfiguration(e,r){this._configuration.output=e,this._configuration.draped=r.slot===de.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null&&e!==G.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&PSt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Wr.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,r,i,n,s,o){if(!i.options.selectionMode)return;const a=e.attributes.get(R.POSITION).data,l=e.attributes.get(R.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const y=e.attributes.get(R.SIZEFEATUREATTRIBUTE).data[0];c*=we(this.parameters.vvSize.offset[0]+y*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=n[0],h=n[1],p=(c/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,g=0;for(let y=0;y<a.length-5;y+=3){const v=a[y],b=a[y+1],w=u-v,x=h-b,S=a[y+3]-v,E=a[y+4]-b,P=we((S*w+E*x)/(S*S+E*E),0,1),M=S*P-w,L=E*P-x,U=M*M+L*L;U<f&&(f=U,g=y/3)}f<p*p&&s(o.dist,o.normal,g,!1)}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!e.visible)return;if(!PAe(r))return void K.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes,l=a.get(R.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const w=a.get(R.SIZEFEATUREATTRIBUTE).data[0];c*=we(this.parameters.vvSize.offset[0]+w*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(R.SIZE)&&(c*=a.get(R.SIZE).data[0]);const u=i.camera,h=ASt;vo(h,i.point);const p=c*u.pixelRatio/2+4*u.pixelRatio;se(gM[0],h[0]-p,h[1]+p,0),se(gM[1],h[0]+p,h[1]+p,0),se(gM[2],h[0]+p,h[1]-p,0),se(gM[3],h[0]-p,h[1]-p,0);for(let w=0;w<4;w++)if(!u.unprojectFromRenderScreen(gM[w],ky[w]))return;rl(u.eye,ky[0],ky[1],zq),rl(u.eye,ky[1],ky[2],Vq),rl(u.eye,ky[2],ky[3],Bq),rl(u.eye,ky[3],ky[0],Gq);let f=Number.MAX_VALUE,g=0;const y=yke(this.parameters,a)?l.length-2:l.length-5;for(let w=0;w<y;w+=3){oc[0]=l[w]+r[12],oc[1]=l[w+1]+r[13],oc[2]=l[w+2]+r[14];const x=(w+3)%l.length;if(ac[0]=l[x]+r[12],ac[1]=l[x+1]+r[13],ac[2]=l[x+2]+r[14],Ci(zq,oc)<0&&Ci(zq,ac)<0||Ci(Vq,oc)<0&&Ci(Vq,ac)<0||Ci(Bq,oc)<0&&Ci(Bq,ac)<0||Ci(Gq,oc)<0&&Ci(Gq,ac)<0)continue;if(u.projectToRenderScreen(oc,Hw),u.projectToRenderScreen(ac,qw),Hw[2]<0&&qw[2]>0){_e(Dm,oc,ac);const E=u.frustum,P=-Ci(E[fi.NEAR],oc)/fe(Dm,E[fi.NEAR]);oe(Dm,Dm,P),ge(oc,oc,Dm),u.projectToRenderScreen(oc,Hw)}else if(Hw[2]>0&&qw[2]<0){_e(Dm,ac,oc);const E=u.frustum,P=-Ci(E[fi.NEAR],ac)/fe(Dm,E[fi.NEAR]);oe(Dm,Dm,P),ge(ac,ac,Dm),u.projectToRenderScreen(ac,qw)}else if(Hw[2]<0&&qw[2]<0)continue;Hw[2]=0,qw[2]=0;const S=bse(pT(Hw,qw,i_e),h);S<f&&(f=S,he(t_e,oc),he(r_e,ac),g=w/3)}const v=i.rayBegin,b=i.rayEnd;if(f<p*p){let w=Number.MAX_VALUE;if(MAe(pT(t_e,r_e,i_e),pT(v,b,OSt),jw)){_e(jw,jw,v);const x=Te(jw);oe(jw,jw,1/x),w=x/Bi(v,b)}o(w,jw,g,!1)}}get _layout(){const e=ln().vec3f(R.POSITION).vec3f(R.PREVPOSITION).vec3f(R.NEXTPOSITION).f32(R.SUBDIVISIONFACTOR).vec2f(R.UV0);return this.parameters.vvSize?e.f32(R.SIZEFEATUREATTRIBUTE):e.f32(R.SIZE),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4f(R.COLOR),this.parameters.vvOpacity&&e.f32(R.OPACITYFEATUREATTRIBUTE),ne("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new CSt(this._layout,this.parameters)}createGLMaterial(e){return new TSt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},TSt=class extends fw{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==G.Color&&this._output!==G.Alpha||this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(mke,e)}},ESt=class extends DN{constructor(){super(...arguments),this.width=0,this.color=Bd,this.join="miter",this.cap=ep.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},CSt=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r,this.numJoinSubdivisions=0;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=CD+i}}_isClosed(e){return yke(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const i=e.attributes.get(R.POSITION).indices.length/2+1,n=this._isClosed(e);let s=n?2:2*2;return s+=((n?i:i-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this._parameters.wireframe&&(s=2+4*(s-2)),s}write(e,r,i,n,s){var le,D,I;const o=MSt,a=RSt,l=$St,c=i.attributes.get(R.POSITION),u=c.indices,h=c.data.length/3,p=(le=i.attributes.get(R.DISTANCETOSTART))==null?void 0:le.data;u&&u.length!==2*(h-1)&&console.warn("RibbonLineMaterial does not support indices");const f=((D=i.attributes.get(R.SIZEFEATUREATTRIBUTE))==null?void 0:D.data[0])??((I=i.attributes.get(R.SIZE))==null?void 0:I.data[0])??1;let g=[1,1,1,1],y=0;const v=this.vertexBufferLayout.fields.has(R.COLORFEATUREATTRIBUTE);v?y=i.attributes.get(R.COLORFEATUREATTRIBUTE).data[0]:i.attributes.has(R.COLOR)&&(g=i.attributes.get(R.COLOR).data);const b=ne("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null,w=this.vertexBufferLayout.fields.has(R.OPACITYFEATUREATTRIBUTE),x=w?i.attributes.get(R.OPACITYFEATUREATTRIBUTE).data[0]:0,S=new Float32Array(n.buffer),E=ne("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,P=this.vertexBufferLayout.stride/4;let M=s*P;const L=M;let U=0;const z=p?(k,j,q)=>U=p[q]:(k,j,q)=>U+=Bi(k,j),W=ne("enable-feature:objectAndLayerId-rendering"),V=(k,j,q,Q,ie,ye,Ae)=>{if(S[M++]=j[0],S[M++]=j[1],S[M++]=j[2],S[M++]=k[0],S[M++]=k[1],S[M++]=k[2],S[M++]=q[0],S[M++]=q[1],S[M++]=q[2],S[M++]=Q,S[M++]=Ae,S[M++]=ie,S[M++]=f,v)S[M++]=y;else{const Ze=Math.min(4*ye,g.length-4);S[M++]=g[Ze],S[M++]=g[Ze+1],S[M++]=g[Ze+2],S[M++]=g[Ze+3]}w&&(S[M++]=x),W&&(b!=null&&(E[4*M]=b[0],E[4*M+1]=b[1],E[4*M+2]=b[2],E[4*M+3]=b[3]),M++)};M+=P,se(a,c.data[0],c.data[1],c.data[2]),e&&ze(a,a,e);const J=this._isClosed(i);if(J){const k=c.data.length-3;se(o,c.data[k],c.data[k+1],c.data[k+2]),e&&ze(o,o,e)}else se(l,c.data[3],c.data[4],c.data[5]),e&&ze(l,l,e),V(a,a,l,1,su.LEFT_CAP_START,0,0),V(a,a,l,1,su.RIGHT_CAP_START,0,0),he(o,a),he(a,l);const Y=J?0:1,X=J?h:h-1;for(let k=Y;k<X;k++){const j=(k+1)%h*3;se(l,c.data[j],c.data[j+1],c.data[j+2]),e&&ze(l,l,e),z(o,a,k),V(o,a,l,0,su.LEFT_JOIN_END,k,U),V(o,a,l,0,su.RIGHT_JOIN_END,k,U);const q=this.numJoinSubdivisions;for(let Q=0;Q<q;++Q){const ie=(Q+1)/(q+1);V(o,a,l,ie,su.LEFT_JOIN_END,k,U),V(o,a,l,ie,su.RIGHT_JOIN_END,k,U)}V(o,a,l,1,su.LEFT_JOIN_START,k,U),V(o,a,l,1,su.RIGHT_JOIN_START,k,U),he(o,a),he(a,l)}J?(se(l,c.data[3],c.data[4],c.data[5]),e&&ze(l,l,e),U=z(o,a,X),V(o,a,l,0,su.LEFT_JOIN_END,Y,U),V(o,a,l,0,su.RIGHT_JOIN_END,Y,U)):(U=z(o,a,X),V(o,a,a,0,su.LEFT_CAP_END,X,U),V(o,a,a,0,su.RIGHT_CAP_END,X,U)),Uq(S,L+P,S,L,P),M=Uq(S,M-P,S,M,P),this._parameters.wireframe&&this._addWireframeVertices(n,L,M,P)}_addWireframeVertices(e,r,i,n){const s=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=Uq(o,c,s,a,n);for(let c=0;c<o.length-1;c+=2*n)l(c),l(c+2*n),l(c+1*n),l(c+2*n),l(c+1*n),l(c+3*n)}};function Uq(t,e,r,i,n){for(let s=0;s<n;s++)r[i++]=t[e++];return i}function yke(t,e){return t.isClosed?e.get(R.POSITION).indices.length>2:!1}function PSt(t){return t.anchor===a2.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const oc=C(),ac=C(),Dm=C(),jw=C(),ASt=C(),Hw=Na(),qw=Na(),t_e=C(),r_e=C(),i_e=bm(),OSt=bm(),MSt=C(),RSt=C(),$St=C(),gM=[Na(),Na(),Na(),Na()],ky=[C(),C(),C(),C()],zq=Yr(),Vq=Yr(),Bq=Yr(),Gq=Yr();let Ile=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+Dh(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const r=this._origins.get(this._rootOriginId);if(r==null){const u=U9(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const i=this._gridSize,n=Math.round(e[0]/i),s=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${n}/${s}/${o}`;let l=this._origins.get(a);const c=.5*i;if(_e(Yo,e,r.vec3),Yo[0]=Math.abs(Yo[0]),Yo[1]=Math.abs(Yo[1]),Yo[2]=Math.abs(Yo[2]),Yo[0]<c&&Yo[1]<c&&Yo[2]<c){if(l){const u=Math.max(...Yo);if(_e(Yo,e,l.vec3),Yo[0]=Math.abs(Yo[0]),Yo[1]=Math.abs(Yo[1]),Yo[2]=Math.abs(Yo[2]),Math.max(...Yo)<u)return l}return r}return l||(l=U9(n*i,s*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,r=Xt(1,1,0,1)){const i=window.view,n=i._stage,s=r.toString();if(!this._objects.has(s)){this._material=new f3({width:2,color:r}),n.add(this._material);const f=new YFe(n,{pickable:!1}),g=new I_({castShadow:!1});n.add(g),f.add(g),this._objects.set(s,g)}const o=this._objects.get(s),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,h=.5*this._gridSize;for(let f=0;f<l;f++)c[3*f]=e[0]+(1&a[f]?h:-h),c[3*f+1]=e[1]+(2&a[f]?h:-h),c[3*f+2]=e[2]+(4&a[f]?h:-h),f>0&&u.push(f-1,f);an(c,this._originSR,0,c,i.renderSpatialReference,0,l);const p=new Is(this._material,[[R.POSITION,new tt(c,u,3,!0)]],null,Ln.Line);n.add(p),o.addGeometry(p)}get test(){const e=this;return{set gridSize(r){e._gridSize=r}}}};const Yo=C();let _ke=class{constructor(e,r,i=null){this.rctx=e,this.sliceHelper=i,this.lastFrameCamera=new st,this.output=G.Color,this.renderOccludedMask=G9,this.bindParameters=new q7(r,i!=null?i.plane:null),this.bindParameters.alignPixelEnabled=!0}},ISt=class extends _ke{constructor(e,r,i,n){super(e,i,n),this.offscreenRenderingHelper=r,this.sliceHelper=n,this.time=0}};const G9=Wr.Occlude|Wr.OccludeAndTransparent|Wr.OccludeAndTransparentStencil;let t$=class extends st{constructor(){super(...arguments),this._projectionMatrix=xe()}get projectionMatrix(){return this._projectionMatrix}};d([m()],t$.prototype,"_projectionMatrix",void 0),d([m({readOnly:!0})],t$.prototype,"projectionMatrix",null),t$=d([F("esri.views.3d.webgl-engine.lib.CascadeCamera")],t$);var l2;(function(t){t[t.Highlight=0]="Highlight",t[t.ExcludeHighlight=1]="ExcludeHighlight"})(l2||(l2={}));let fF=class{constructor(){this.camera=new t$,this.lightMat=xe()}},LSt=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},Lle=class{constructor(e,r){this._fbos=e,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new LSt,this._projectionView=xe(),this._projectionViewInverse=xe(),this._modelViewLight=xe(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=tr(),this._cascades=[new fF,new fF,new fF,new fF],this._lastOrigin=null,this._maxTextureWidth=Math.min(ne("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return pn(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=lr(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=we(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)Hq[e]=this._cascades[e];return Hq.length=this._numCascades,Hq}start(e,r,i,n,s){_t(this.enabled);const{near:o,far:a}=this._clampNearFar(i);this._computeCascadeDistances(o,a,n),this._textureHeight=this._computeTextureHeight(e,s,n),this._setupMatrices(e,r);const{viewMatrix:l,projectionMatrix:c}=e;for(let u=0;u<this._numCascades;++u)this._constructCascade(u,c,l,r);this._lastOrigin=null,this.clear()}finish(){var e;_t(this.enabled),(e=this._handle)==null||e.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!aa(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||C(),he(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){Fc(c_e,this._cascades[r].lightMat,e);for(let i=0;i<16;++i)u_e[16*r+i]=c_e[i]}}return u_e}moveSnapshot(e){var r,i;_t(this.enabled),(r=this._handle)==null||r.detachDepth(),(i=this._snapshots[e])==null||i.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){var l,c,u,h;const r=(c=(l=this._handle)==null?void 0:l.getTexture())==null?void 0:c.descriptor;if(!this.enabled||!r)return;(u=this._snapshots[e])==null||u.release();const{width:i,height:n}=r,s=e===l2.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(i,n,s,tn.RGBA4);const o=this._fbos.rctx;this._bindFbo();const a=o.bindTexture((h=this._snapshots[e])==null?void 0:h.getTexture(),Mr.TEXTURE_UNIT_FOR_UPDATES);o.gl.copyTexSubImage2D(In.TEXTURE_2D,0,0,0,0,0,i,n),o.bindTexture(a,Mr.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){var r;return this.enabled?(r=this._snapshots[e])==null?void 0:r.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(Mi.COLOR_BUFFER_BIT|Mi.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,r,i){const n=Math.min(window.devicePixelRatio,r)/e.pixelRatio,s=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=vT(Math.floor(Math.max(e.fullWidth,e.fullHeight)*n*s)),a=Math.min(this._maxTextureWidth,this._numCascades*o);return kpt(a/this._numCascades)}_ensureFbo(){var e,r,i,n;((e=this._handle)==null?void 0:e.fbo.width)===this._textureWidth&&((r=this._handle)==null?void 0:r.fbo.height)===this._textureHeight||((i=this._handle)==null||i.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",tn.RGBA4)),(n=this._handle)==null||n.acquireDepth(Ra.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=lr(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){var r;const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer((r=this._handle)==null?void 0:r.fbo)}_constructCascade(e,r,i,n){const s=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);_t(l<c);for(let f=0;f<8;++f){pn(n_e,f%4==0||f%4==3?-1:1,f%4==0||f%4==1?-1:1,f<4?l:c,1);const g=Ad[f];Mu(g,n_e,this._projectionViewInverse),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3]}ua(jq,Ad[0]),s.camera.viewMatrix=Fc(DSt,this._modelViewLight,jq);for(let f=0;f<8;++f)ze(Ad[f],Ad[f],s.camera.viewMatrix);let u=Ad[0][2],h=Ad[0][2];for(let f=1;f<8;++f)u=Math.min(u,Ad[f][2]),h=Math.max(h,Ad[f][2]);u-=200,h+=200,s.camera.near=-h,s.camera.far=-u,USt(i,n,u,h,s.camera),Kr(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const p=this._textureHeight;s.camera.viewport=[e*p,0,p,p]}_setupMatrices(e,r){Kr(this._projectionView,e.projectionMatrix,e.viewMatrix),us(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===Fe.Global?e.eye:se(jq,0,0,1);TB(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(e){let{near:r,far:i}=e;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(e,r,i){const n=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(VKe(r/e,4)),n);const s=(r-e)/this._numCascades,o=(r/e)**(1/this._numCascades);let a=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=Dt(a,l,this.settings.splitSchemeLambda),a*=o,l+=s}get test(){return{cascades:this._cascades,textureHeight:this._textureHeight}}};const DSt=xe(),n_e=tr(),Ad=[];for(let t=0;t<8;++t)Ad.push(tr());const s_e=Ye(),o_e=Ye(),NSt=Ye(),a_e=Ye(),l_e=Ye(),jq=C(),Hq=[],c_e=xe(),u_e=fn.concat(fn,fn,fn,fn),nh=Ye(),mE=Ye(),Ww=[Ye(),Ye(),Ye(),Ye()],ro=Ye(),qq=Ye(),m1=Ye(),yM=Ye(),gE=Ye(),yE=Ye(),mF=Ye();function FSt(t,e,r,i,n,s,o,a){yr(nh,0,0);for(let E=0;E<4;++E)vf(nh,nh,t[E]);Eu(nh,nh,.25),yr(mE,0,0);for(let E=4;E<8;++E)vf(mE,mE,t[E]);Eu(mE,mE,.25),Dd(Ww[0],t[4],t[5],.5),Dd(Ww[1],t[5],t[6],.5),Dd(Ww[2],t[6],t[7],.5),Dd(Ww[3],t[7],t[4],.5);let l=0,c=Lz(Ww[0],nh);for(let E=1;E<4;++E){const P=Lz(Ww[E],nh);P<c&&(c=P,l=E)}Ag(ro,Ww[l],t[l+4]);const u=ro[0];let h,p;ro[0]=-ro[1],ro[1]=u,Ag(qq,mE,nh),js(qq,ro)<0&&Use(ro,ro),Dd(ro,ro,qq,r),QL(ro,ro),h=p=js(Ag(m1,t[0],nh),ro);for(let E=1;E<8;++E){const P=js(Ag(m1,t[E],nh),ro);P<h?h=P:P>p&&(p=P)}vo(i,nh),Eu(m1,ro,h-e),vf(i,i,m1);let f=-1,g=1,y=0,v=0;for(let E=0;E<8;++E){Ag(yM,t[E],i),QL(yM,yM);const P=ro[0]*yM[1]-ro[1]*yM[0];P>0?P>f&&(f=P,y=E):P<g&&(g=P,v=E)}V2(f>0,"leftArea"),V2(g<0,"rightArea"),Eu(gE,ro,h),vf(gE,gE,nh),Eu(yE,ro,p),vf(yE,yE,nh),mF[0]=-ro[1],mF[1]=ro[0];const b=j4(i,t[v],yE,vf(m1,yE,mF),1,n),w=j4(i,t[y],yE,m1,1,s),x=j4(i,t[y],gE,vf(m1,gE,mF),1,o),S=j4(i,t[v],gE,m1,1,a);V2(b,"rayRay"),V2(w,"rayRay"),V2(x,"rayRay"),V2(S,"rayRay")}function Ir(t,e){return 3*e+t}const h_e=Ye();function Yc(t,e){return yr(h_e,t[e],t[e+3]),h_e}const lc=Ye(),ct=gi();function kSt(t,e,r,i,n){Ag(lc,r,i),Eu(lc,lc,.5),ct[0]=lc[0],ct[1]=lc[1],ct[2]=0,ct[3]=lc[1],ct[4]=-lc[0],ct[5]=0,ct[6]=lc[0]*lc[0]+lc[1]*lc[1],ct[7]=lc[0]*lc[1]-lc[1]*lc[0],ct[8]=1,ct[Ir(0,2)]=-js(Yc(ct,0),t),ct[Ir(1,2)]=-js(Yc(ct,1),t);let s=js(Yc(ct,0),r)+ct[Ir(0,2)],o=js(Yc(ct,1),r)+ct[Ir(1,2)],a=js(Yc(ct,0),i)+ct[Ir(0,2)],l=js(Yc(ct,1),i)+ct[Ir(1,2)];s=-(s+a)/(o+l),ct[Ir(0,0)]+=ct[Ir(1,0)]*s,ct[Ir(0,1)]+=ct[Ir(1,1)]*s,ct[Ir(0,2)]+=ct[Ir(1,2)]*s,s=1/(js(Yc(ct,0),r)+ct[Ir(0,2)]),o=1/(js(Yc(ct,1),r)+ct[Ir(1,2)]),ct[Ir(0,0)]*=s,ct[Ir(0,1)]*=s,ct[Ir(0,2)]*=s,ct[Ir(1,0)]*=o,ct[Ir(1,1)]*=o,ct[Ir(1,2)]*=o,ct[Ir(2,0)]=ct[Ir(1,0)],ct[Ir(2,1)]=ct[Ir(1,1)],ct[Ir(2,2)]=ct[Ir(1,2)],ct[Ir(1,2)]+=1,s=js(Yc(ct,1),e)+ct[Ir(1,2)],o=js(Yc(ct,2),e)+ct[Ir(2,2)],a=js(Yc(ct,1),r)+ct[Ir(1,2)],l=js(Yc(ct,2),r)+ct[Ir(2,2)],s=-.5*(s/o+a/l),ct[Ir(1,0)]+=ct[Ir(2,0)]*s,ct[Ir(1,1)]+=ct[Ir(2,1)]*s,ct[Ir(1,2)]+=ct[Ir(2,2)]*s,s=js(Yc(ct,1),e)+ct[Ir(1,2)],o=js(Yc(ct,2),e)+ct[Ir(2,2)],a=-o/s,ct[Ir(1,0)]*=a,ct[Ir(1,1)]*=a,ct[Ir(1,2)]*=a,n[0]=ct[0],n[1]=ct[1],n[2]=0,n[3]=ct[2],n[4]=ct[3],n[5]=ct[4],n[6]=0,n[7]=ct[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=ct[6],n[13]=ct[7],n[14]=0,n[15]=ct[8]}function USt(t,e,r,i,n){const s=1/Ad[0][3],o=1/Ad[4][3];_t(s<o);let a=s+Math.sqrt(s*o);const l=Math.sin(_o(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,FSt(Ad,a,l,s_e,o_e,NSt,a_e,l_e),kSt(s_e,o_e,a_e,l_e,n.projectionMatrix),n.projectionMatrix[10]=2/(r-i),n.projectionMatrix[14]=-(r+i)/(r-i)}function zSt(t){return _p(t)&&t.intersector===Yi.TERRAIN&&!!t.target}let VSt=class extends xN{constructor(e,r,i){super(e,r),this.triangleNr=i}};function vke(t){return _p(t)&&t.intersector===Yi.OVERLAY&&!!t.target}let Jee=class{constructor(){this.adds=new jt,this.removes=new jt,this.updates=new jt({allocator:e=>e||new BSt,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},BSt=class{},GSt=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var un,Zs;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(un||(un={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Zs||(Zs={}));var Rf;function bke(t){const e=new Map,r=i=>{let n=e.get(i);return n||(n=new GSt,e.set(i,n)),n};return t.removes.forAll(i=>{Wq(i)&&r(i.material).removes.push(i)}),t.adds.forAll(i=>{Wq(i)&&r(i.material).adds.push(i)}),t.updates.forAll(i=>{Wq(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),e}function Wq(t){return t.geometry.indexCount>=1}(function(t){t[t.Default=0]="Default",t[t.Screenshot=1]="Screenshot",t[t.ObjectAndLayerID=2]="ObjectAndLayerID"})(Rf||(Rf={}));let wke=class{constructor(e,r){this._material=e,this._repository=r,this._map=new Map}dispose(){this._map.forEach((e,r)=>{e!=null&&this._repository.release(this._material,r)})}load(e,r,i){const n=this._material.produces.get(r);if(!n||!n(i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const s=this._map.get(i);if(s!=null){if(s.ensureResources(e)===Cb.LOADED)return s;this._repository.requestRender()}return null}},Qee=class extends w5e{constructor(e=C()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},Dle=class{constructor(e=0,r=0){this.from=e,this.to=r}get numElements(){return this.to-this.from}};function d_e(t){const e=new Map;t.forAll(i=>e.set(i.from,i));let r=!0;for(;r;){r=!1;for(let i=0;i<t.length;++i){const n=t.data[i],s=e.get(n.to);if(!s)return;n.to=s.to,e.delete(s.from),t.removeUnordered(s),r=!0}}}let p_e=class extends Dle{constructor(e,r,i){super(r,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},jSt=class{constructor(){this.first=0,this.count=0}},HSt=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new jt({allocator:e=>e||new Dle,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=gF(),this.drawCommandsHighlight=gF(),this.drawCommandsOccludees=gF(),this.drawCommandsShadowHighlightRest=gF()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,r){this.deleteInstance(e),this._instances.set(e,r),this._numElements+=r.numElements}deleteInstance(e){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,this._instances.delete(e))}updateInstance(e,r,i){const n=this._instances.get(e);n&&(this._numElements-=n.numElements,n.from=r,n.to=i,this._numElements+=n.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),n=this.holes.front();return this.vao!=null&&this.holes.length===1&&n.to===Math.floor(this.vao.byteSize/e)?(i.first=0,void(i.count=n.from)):(i.first=1/0,i.count=0,this._instances.forEach(s=>{i.first=Math.min(i.first,s.from),i.count=Math.max(i.count,s.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,n)=>i.from===n.from?i.to-n.to:i.from-n.from);for(const i of r)i.isVisible&&(f_e(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),f_e(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function qSt(t){return t.vao!=null}function gF(){return new jt({allocator:t=>t||new jSt,deallocator:t=>t})}function f_e(t,e){const r=t.back();if(r==null){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(WSt(r,e)){const i=e.from-r.first+e.numElements;r.count=i}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}function WSt(t,e){return t.first+t.count>=e.from}let YSt=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(r=>r.instances.has(e))}};const Kee=-3,xke=Kee-1;var xf;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(xf||(xf={}));let XSt=class{constructor(e,r,i){this.name=e,this._storage=r,this.id=ZSt+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,r,i,n=0){this._storage.put(this,e,r,i,n)}pop(e){const r=this._storage.pop(this,e);return r===void 0?++this._miss:++this._hit,r}get(e){const r=this._storage.get(this,e);return r===void 0?++this._miss:++this._hit,r}peek(e){return this._storage.peek(this,e)}updateSize(e,r,i){this._storage.updateSize(this,e,r,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},Ske=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new jt,this._users=new jt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,r){this._removeFuncs.push([e,r])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(r=>r[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,r){const i=this._db.get(e.id+r);return(i==null?void 0:i.size)??0}put(e,r,i,n,s){r=e.id+r;const o=this._db.get(r);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(r),o.entry!==i&&this._notifyRemove(r,o.entry,o.size,xf.ALL)),n>this._maxSize)return void this._notifyRemove(r,i,n,xf.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!n||n<0)return console.warn(`Refusing to cache entry with size ${n} for key ${r}`),void this._notifyRemove(r,i,0,xf.ALL);const a=1+Math.max(s,xke)-Kee;this._db.set(r,new JSt(i,n,a)),this._size+=n,e.size+=n,this._checkSize()}updateSize(e,r,i,n){r=e.id+r;const s=this._db.get(r);if(s&&s.entry===i){for(this._size-=s.size,e.size-=s.size;n>this._maxSize;){const o=this._notifyRemove(r,i,n,xf.SOME);if(!(o!=null&&o>0))return void this._db.delete(r);n=o}s.size=n,this._size+=n,e.size+=n,this._checkSize()}}pop(e,r){r=e.id+r;const i=this._db.get(r);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(r),++this._hit,i.entry;++this._miss}get(e,r){r=e.id+r;const i=this._db.get(r);if(i!==void 0)return this._db.delete(r),i.lives=i.lifetime,this._db.set(r,i),++this._hit,i.entry;++this._miss}peek(e,r){const i=this._db.get(e.id+r);return i?++this._hit:++this._miss,i==null?void 0:i.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const{id:u,name:h}=c;if(a.startsWith(u)){const p=r[h]||0;r[h]=p+o.size}})});const n={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,n[a]=Math.round(100*o.hitRate)+"%"}else n[a]="0%"});const s=Object.keys(r);s.sort((o,a)=>r[a]-r[o]),s.forEach(o=>e[o]=Math.round(r[o]/2**20)+"MB / "+n[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(e["Priority "+(o+Kee-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const r=e.id;this._db.forEach((i,n)=>{n.startsWith(r)&&(this._size-=i.size,this._db.delete(n),this._notifyRemove(n,i.entry,i.size,xf.ALL))}),e.size=0}clearAll(){this._db.forEach((e,r)=>this._notifyRemove(r,e.entry,e.size,xf.ALL)),this._users.forAll(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,r,i,n){let s;return this._removeFuncs.some(o=>{if(e.startsWith(o[0])){const a=o[1](r,n,i);return typeof a=="number"&&(s=a),!0}return!1}),s}_checkSize(){this._users.forAll(e=>this._checkSizeLimits(e)),this._checkSizeLimits()}_checkSizeLimits(e){const r=e??this;if(r.maxSize<0||r.size<=r.maxSize)return;const i=e==null?void 0:e.id;let n=!0;for(;n;){n=!1;for(const[s,o]of this._db)if(o.lifetime===0&&(!i||s.startsWith(i))){if(this._purgeItem(s,o,e),r.size<=.9*r.maxSize)return;n||(n=this._db.has(s))}}for(const[s,o]of this._db)if((!i||s.startsWith(i))&&(this._purgeItem(s,o,e),r.size<=.9*r.maxSize))return}_purgeItem(e,r,i=this._users.find(n=>e.startsWith(n.id))){if(this._db.delete(e),r.lives<=1){this._size-=r.size,i&&(i.size-=r.size);const n=this._notifyRemove(e,r.entry,r.size,xf.SOME);n!=null&&n>0&&(this._size+=n,i&&(i.size+=n),r.lives=r.lifetime,r.size=n,this._db.set(e,r))}else--r.lives,this._db.set(e,r)}},ZSt=0,JSt=class{constructor(e,r,i){this.entry=e,this.size=r,this.lifetime=i,this.lives=i}},jN=class{constructor(e,r){this._cache=e(r,(i,n,s)=>this._remove(i,n,s))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const r=this._cache.peek(e);if(!r)return;const i=r.pop();if(r.length>0){if(i){const n=this._cache.getSize(e)-Math.round(i.usedMemory);this._cache.updateSize(e,r,n)}}else this._cache.pop(e);return i}put(e,r,i=xke){const n=this._cache.peek(e);if(!n)return void this._cache.put(e,[r],r.usedMemory,i);n.push(r);const s=this._cache.getSize(e)+Math.round(r.usedMemory);this._cache.updateSize(e,n,s)}_remove(e,r,i){switch(r){case xf.ALL:return e.forEach(n=>n.dispose()),0;case xf.SOME:{const n=e.shift();return n&&(i-=Math.round(n.usedMemory),n.dispose()),i}}}},QSt=class{constructor(e,r,i){this._rctx=e,this._locations=r,this._layout=i,this._cache=new jN(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const r=e.toString();let i=this._cache.pop(r);return i||(i=new wm(this._rctx,this._locations,{geometry:this._layout},{geometry:ti.createVertex(this._rctx,Lr.STATIC_DRAW)}),i.vertexBuffers.geometry.setSize(e),i)}deleteVao(e){if(e==null)return;const r=e.byteSize.toString();this._cache.put(r,e)}},HI=class extends dNe{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._produces=new Map,this.drapedPriority=0}destroy(){this._glMaterials=wt(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=wt(this._vaoCache)}initialize(){this.material.produces.forEach((e,r)=>{this._produces.set(r,i=>!(this._dataByOrigin.size===0||!(i!==G.Highlight&&i!==G.ShadowHighlight||this._hasHighlights))&&e(i))})}get produces(){return this._produces}initializeRenderContext(e,r){const{rctx:i}=e.renderContext;this._glMaterials=new wke(this.material,r??e.materialRepository),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new QSt(i,this.material.vertexAttributeLocations,Ju(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get materialReference(){return this.material}get numGeometries(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,n)=>i+n.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,n)=>i+n.vao.usedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(n=>e(n.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const r=this._bufferWriter;if(r===null)return;const i=r.vertexBufferLayout.stride/4;for(const n of e){const s=n.renderGeometry,o=this._dataByOrigin.get(s.localOrigin.id),a=o==null?void 0:o.findBuffer(s.id);if(a==null)return;const l=a.instances.get(s.id);if(n.updateType&(Zs.GEOMETRY|Zs.TRANSFORMATION)){const c=vF(r.elementCount(l.geometry.geometry)*i),u=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(s,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i)}n.updateType&(Zs.HIGHLIGHT|Zs.OCCLUDEE|Zs.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,r){const i=new Hb;for(const n of e){const s=n.localOrigin;if(s==null)continue;let o=i.get(s.id,null);o==null&&(o=new m_e(s.vec3),i.set(s.id,null,o)),o.changes.push(n)}for(const n of r){const s=n.localOrigin;if(s==null)continue;const o=this._dataByOrigin.get(s.id),a=o==null?void 0:o.findBuffer(n.id);if(a==null)continue;let l=i.get(s.id,a);l==null&&(l=new m_e(s.vec3),i.set(s.id,a,l)),l.changes.push(n)}return i}_addAndRemoveGeometries(e,r){if(this._bufferWriter===null||this._vaoCache===null)return;const{_bufferWriter:i,_dataByOrigin:n}=this,s=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,r);o.forEach((a,l)=>{const c=a.get(null),u=c!=null?c.changes:[];o.delete(l,null);let h=n.get(l);if(a.forEach((p,f)=>{if(o.delete(l,f),f==null)return void _t(!1,"No VAO for removed geometries");if(f.instances.size===p.changes.length)return this._vaoCache.deleteVao(f.vao),RL(h.buffers,f),void(h.buffers.length===0&&u.length===0&&n.delete(l));const g=f.numElements,y=f.vao.byteSize/4,v=u.reduce((S,E)=>S+i.elementCount(E.geometry),0),b=p.changes.reduce((S,E)=>S+i.elementCount(E.geometry),0),w=Math.min((g+v-b)*s,_F),x=w>y;w>j9&&w<y/2?(p.changes.forEach(({id:S})=>f.deleteInstance(S)),f.instances.forEach(({geometry:S})=>u.push(S)),this._vaoCache.deleteVao(f.vao),RL(h.buffers,f)):x?this._applyAndRebuild(f,u,p):this._applyRemoves(f,p)}),u.length>0)for(h==null&&(h=new YSt(c.origin),n.set(l,h)),h.buffers.forEach(p=>this._applyAdds(p,u));u.length>0;)h.buffers.push(this._applyAndRebuild(new HSt,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,Hd(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(e,r,i){if(i!=null)for(const g of i.changes)e.deleteInstance(g.id);const n=this._bufferWriter,s=n.vertexBufferLayout.stride,o=s/4,a=Math.floor(_F/o);let l=e.numElements;for(;r.length>0;){const g=r.pop(),y=n.elementCount(g.geometry);if(l+y>a&&l>0){r.push(g);break}l+=y;const v=new p_e(g,0,0);_t(e.instances.get(g.id)==null),e.addInstance(g.id,v)}const c=l*o,u=vF(c),h=n.vertexBufferLayout.createView(u.buffer);let p=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((g,y)=>{this._writeGeometry(g.geometry,h,p);const v=p;p+=n.elementCount(g.geometry.geometry),e.updateInstance(y,v,p),e.updateDrawState(g)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(__e(c)),e.vao.vertexBuffers.geometry.setSubData(u,0,0,p*o),e.holes.clear();const f=e.holes.pushNew();return f.from=p,f.to=Math.floor(e.vao.byteSize/s),e.updateDrawCommands(s),e}_applyRemoves(e,r){if(r.changes.length===0||this._bufferWriter===null)return;for(const a of r.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const u=Nm.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const h=Nm.pushNew();h.from=c.from,h.to=c.to}d_e(Nm);const i=this._bufferWriter.vertexBufferLayout.stride/4,n=Nm.reduce((a,l)=>Math.max(a,l.numElements),0)*i,s=vF(n);s.fill(0,0,n);const o=e.vao.vertexBuffers.geometry;Nm.forAll(a=>o.setSubData(s,a.from*i,0,a.numElements*i)),e.holes.pushArray(Nm.data,Nm.length),Nm.forAll((a,l)=>Nm.data[l]=null),Nm.clear(),e.drawCommandsDirty=!0}_applyAdds(e,r){if(r.length===0||this._bufferWriter===null)return;if(!qSt(e))return void this._applyAndRebuild(e,r,null);const i=this._bufferWriter,n=i.vertexBufferLayout.stride/4,s=e.numElements,o=r.reduce((b,w)=>b+i.elementCount(w.geometry),0),a=Math.min((s+o)*n,_F),l=4*a;if(e.vao.byteSize<__e(_F-j9)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,r,null);d_e(e.holes);const c=new Array;for(const b of r){const w=i.elementCount(b.geometry),x=KSt(e.holes,w);c.push(x)}const u=e.vao.vertexBuffers.geometry;let h=0,p=0,f=0;const g=vF(a),y=i.vertexBufferLayout.createView(g.buffer);r.forEach((b,w)=>{const x=c[w];if(x==null)return;if(f!==x){const P=f-p;P>0&&u.setSubData(g,p*n,0,P*n),p=x,h=0}const S=i.elementCount(b.geometry);this._writeGeometry(b,y,h),h+=S,f=x+S;const E=new p_e(b,x,x+S);_t(e.instances.get(b.id)==null),e.addInstance(b.id,E),e.drawCommandsDirty=!0});const v=f-p;v>0&&u.setSubData(g,p*n,0,v*n),mHe(r,(b,w)=>c[w]==null)}_writeGeometry(e,r,i){if(this._bufferWriter===null)return;const n=e.localOrigin.vec3;BKe(g_e,-n[0],-n[1],-n[2]);const s=Kr(eTt,g_e,e.transformation);us(yF,s),Bu(yF,yF),this._bufferWriter.write(s,yF,e.geometry,r,i)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:r,bindParameters:i}=e,n=this.material.produces.get(i.slot);if(!n||!n(r))return null;const s=r===G.Highlight||r===G.ShadowHighlight;if(s&&!this._hasHighlights)return null;const o=r===G.ShadowExcludeHighlight,a=!(s||o);for(const l of this._dataByOrigin.values())for(const c of l.buffers){if(s&&!c.hasHighlights)continue;const u=(s?c.drawCommandsHighlight:o&&c.needsMultipleCommands()?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,h=a&&c.drawCommandsOccludees||null;if(u!=null&&u.length||h!=null&&h.length){const p=this._glMaterials.load(e.rctx,i.slot,r),f=p!=null?p.beginSlot(i):null;if(f!=null)return f}}return null}renderNode(e,r){const{output:i,bindParameters:n}=e,s=i===G.Highlight||i===G.ShadowHighlight,o=i===G.ShadowExcludeHighlight,a=!(s||o),l=e.rctx,c=e.bindParameters.slot===de.OCCLUDER_MATERIAL,u=e.bindParameters.slot===de.TRANSPARENT_OCCLUDER_MATERIAL;l.runAppleAmdDriverHelper(),l.bindTechnique(r,n,this.material.parameters);for(const h of this._dataByOrigin.values())for(const p of h.buffers){if(s&&!p.hasHighlights)continue;const f=(s?p.drawCommandsHighlight:o&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,g=a&&p.drawCommandsOccludees||null;(f!=null&&f.length||g!=null&&g.length)&&(r.program.bindDraw(new Qee(h.origin),n,this.material.parameters),r.ensureAttributeLocations(p.vao),l.bindVAO(p.vao),f!=null&&f.length&&(l.setPipelineState(r.getPipeline(!1,c,u)),f.forAll(y=>l.drawArrays(r.primitiveType,y.first,y.count))),g!=null&&g.length&&(l.setPipelineState(r.getPipeline(!0,c,u)),g.forAll(y=>l.drawArrays(r.primitiveType,y.first,y.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}};d([m({constructOnly:!0})],HI.prototype,"material",void 0),HI=d([F("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],HI);let m_e=class{constructor(e){this.origin=e,this.changes=new Array}};function KSt(t,e){let r;if(!t.some(n=>!(n.numElements<e)&&(r=n,!0)))return null;const i=r.from;return r.from+=e,r.from>=r.to&&t.removeUnordered(r),i}const g_e=xe(),eTt=xe(),yF=xe(),Nm=new jt({allocator:t=>t||new Dle,deallocator:null}),j9=65536,Yq=4*j9,y_e=1024,Tke=16777216,_F=Tke/4;let Xq=new Float32Array(j9);function vF(t){return Xq.length<t&&(Xq=new Float32Array(t)),Xq}function __e(t){const e=4*t;return e<=y_e?y_e:e<Yq?W3e(e):Math.max(Math.min(Math.ceil(1.5*e/Yq)*Yq,Tke),e)}let mh=class extends Pe{constructor(e){super(e),this._pending=new tTt,this._changes=new Jee,this._materialRenderers=new jt,this._sortedMaterialRenderers=new jt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forAll(e=>e.destroy()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return this._materialRenderers.some(e=>e.numGeometries!==0&&!e.queryRenderOccludedState(Wr.Occlude))}get isEmpty(){return!this.updating&&this._materialRenderers.length===0&&this._geometries.size===0}getMemoryForMaterial(e){if(e==null)return 0;const r=this._materialRenderers.find(i=>i.materialReference===e);return(r==null?void 0:r.usedMemory)??0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=bke(this._changes);let r=!1;return e.forEach((i,n)=>{let s=this._materialRenderers.find(o=>o.materialReference===n);if(!s&&i.adds.length>0){const o=new HI({material:n});o.initializeRenderContext(this.rendererContext.pluginContext,this._materialRepository),s=o,this._materialRenderers.push(s),r=!0}s&&(s.modify(i),s.numGeometries===0&&(this._materialRenderers.removeUnordered(s),s.destroy(),r=!0))}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),this._hasHighlights=this._materialRenderers.some(i=>{const n=i.produces.get(de.DRAPED_MATERIAL);return!!n&&n(G.Highlight)}),this._hasWater=this._materialRenderers.some(i=>{const n=i.produces.get(de.DRAPED_WATER);return!!n&&n(G.Normal)}),this.notifyChange("updating"),!0}addGeometries(e,r){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const s of i)this._geometries.set(s.id,s);const n=this._pending.empty;for(const s of i)this._pending.adds.add(s);n&&this.notifyChange("updating"),r===un.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,r){const i=this._pending.empty,n=this._pending.adds;for(const s of e)n.has(s)?(this._pending.removed.add(s),n.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);i&&!this._pending.empty&&this.notifyChange("updating"),r===un.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,r){const i=this._changes.updates.length===0;for(const n of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(n),s.updateType=r}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case Zs.TRANSFORMATION:case Zs.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Zs.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll(i=>r=!!i.updateAnimation&&i.updateAnimation(e)||r),r}shouldRender(e){return this._sortedMaterialRenderers.some(r=>r.prepareTechnique(e))}render(e){this._sortedMaterialRenderers.forAll(r=>{const i=r.prepareTechnique(e);i!=null&&r.renderNode(e,i)})}intersect(e,r,i,n,s){return this._geometries.forEach(o=>{if(n&&!n(o))return;this._intersectRenderGeometry(o,i,r,0,e,s);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,i,r,a.range,e,s),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,i,r,-a.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear(),this._materialRenderers.forAll((e,r)=>{e.drapedPriority=r,this._sortedMaterialRenderers.push(e)}),this._sortedMaterialRenderers.sort((e,r)=>{var i,n,s,o;return((i=r.materialReference)==null?void 0:i.renderPriority)===((n=e.materialReference)==null?void 0:n.renderPriority)?e.drapedPriority-r.drapedPriority:(((s=r.materialReference)==null?void 0:s.renderPriority)||0)-(((o=e.materialReference)==null?void 0:o.renderPriority)||0)})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,r,i,n,s,o){if(!e.visible)return;let a=0;n+=e.transformation[12],a=e.transformation[13],Zq[0]=i[0]-n,Zq[1]=i[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,Zq,(l,c,u)=>{rTt(r,u,o,e.material.renderPriority,s,e.layerUid,e.graphicUid)},r)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let r;for(const i of e){const n=i.graphicUid;n!=null&&n!==r&&(this.drapeSource.notifyGraphicGeometryChanged(n),r=n)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let r;for(const i of e){const n=i.graphicUid;n!=null&&n!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(n),r=n)}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};d([m()],mh.prototype,"drapeSource",void 0),d([m()],mh.prototype,"updating",null),d([m()],mh.prototype,"rctx",null),d([m({constructOnly:!0})],mh.prototype,"rendererContext",void 0),d([m()],mh.prototype,"_materialRepository",null),d([m()],mh.prototype,"_localOriginFactory",null),d([m({readOnly:!0})],mh.prototype,"isEmpty",null),d([m()],mh.prototype,"_materialRenderers",void 0),d([m()],mh.prototype,"_geometries",void 0),mh=d([F("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],mh);let tTt=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function rTt(t,e,r,i,n,s,o){const a=new VSt(s,o,e),l=c=>{c.set(Yi.OVERLAY,a,t.dist,t.normal,t.transformation,r,i)};if((n.results.min.drapedLayerOrder==null||r>=n.results.min.drapedLayerOrder)&&(n.results.min.dist==null||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==ha.MIN&&(n.results.max.drapedLayerOrder==null||r<n.results.max.drapedLayerOrder)&&(n.results.max.dist==null||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===ha.ALL){const c=Moe(n.ray);l(c),n.results.all.push(c)}}const Zq=Ye();let Nle=class Eke extends Zr{initializeProgram(e){return new Br(e.rctx,Eke.shader.get().build(),Nr)}initializePipeline(){return this.configuration.hasAlpha?Bt({blending:ya(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:rr}):Bt({colorWrite:rr})}};Nle.shader=new Vr(gxt,()=>re(()=>Promise.resolve().then(()=>$jt),void 0));let Fle=class extends jc{constructor(){super(...arguments),this.hasAlpha=!1}};d([H()],Fle.prototype,"hasAlpha",void 0);let kle=class extends Li{constructor(){super(...arguments),this.overlayIndex=Cs.INNER,this.opacity=1}};function Cke(){const t=new Fr;return t.include(gl),t.fragment.uniforms.add(new ft("tex",e=>e.texture)),t.fragment.uniforms.add(new kN("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Ie("opacity",e=>e.opacity)),t.fragment.code.add(T`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const iTt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:kle,build:Cke},Symbol.toStringTag,{value:"Module"}));let Pke=class Ake extends Zr{initializeProgram(e){return new Br(e.rctx,Ake.shader.get().build(),Nr)}initializePipeline(){return Bt({blending:qu(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:rr})}};Pke.shader=new Vr(iTt,()=>re(()=>Promise.resolve().then(()=>Ijt),void 0));let vd=class extends R2{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new kle,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new jt,this._passParameters=new Ple,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new st,this.worldToPCSRatio=1,this.events=new Xn,this.longitudeCyclical=null,this.produces=new Map([[de.DRAPED_MATERIAL,r=>r!==G.Highlight||this.hasHighlights],[de.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,r=this.view._stage.renderView,{waterTextures:i,stippleTextures:n,markerTextures:s}=r;this._shaderTechniques=new jFe({rctx:this._rctx,viewingMode:Fe.Local,stippleTextureRepository:n,markerTextureRepository:s,waterTextureRepository:i}),this._renderContext=new _ke(this._rctx,new Lle(e,this.view.state.viewingMode),null),this.addHandles([pe(()=>i.updating,()=>this.events.emit("content-changed"),li),pe(()=>this.spatialReference,o=>this._localOriginFactory=new Ile(o),li),jo(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new HFe(r.textureRepository,this._shaderTechniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=de.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=vt.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new yae(Ce(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(Ct.STAGE,this))}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=lr(this._debugTextureTechnique),this._passParameters.texture=wt(this._passParameters.texture),this._shaderTechniques=Me(this._shaderTechniques),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||Hd(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMemoryForMaterial(e){return Array.from(this._renderers.values()).reduce((r,i)=>r+i.getMemoryForMaterial(e),0)}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,mh)}createDrapeSourceRenderer(e,r,i){const n=this._renderers.get(e);n!=null&&n.destroy();const s=new r({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(pe(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(e==null)return;const r=this._renderers.get(e);r!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),r.destroy())}computeValidity(){var e;return((e=this._renderTargets)==null?void 0:e.computeValidity())??0}releaseRenderTargets(){var e;(e=this._renderTargets)==null||e.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&t6(e,r=>r.drapeTargetType===Wee.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=t6(e,r=>r.drapeSourceType===BI.Features),this._hasDrapedRasterSource=t6(e,r=>r.drapeSourceType===BI.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,r,i=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new oxt(this.view._stage.renderer.fboCache),this._overlays=[new W0e,new W0e]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r),this._bindParameters.overlayStretch=i}disposeOverlays(){this._overlays=null,this._renderTargets=wt(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var r,i;if(e!=null)return e===Wi.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?(r=this._renderTargets)==null?void 0:r.getTexture(Wi.Color):(i=this._renderTargets)==null?void 0:i.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,r){let i=!1;for(const[n,s]of this._renderers){if(e.done)break;(n.destroyed||r(n))&&s.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=Hd(this._renderers,n=>n.hasHighlights),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Xl,e=>e.updatePolicy===db.SYNC)}get isEmpty(){return!Si.OVERLAY_DRAW_DEBUG_TEXTURE&&!Hd(this._renderers,e=>!e.isEmpty)}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=H9;const r=this._sortedRenderers.some(({renderer:i})=>i.shouldRender(this._renderContext));return this._renderContext.renderOccludedMask=e,r}renders(e){return Si.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==Wi.Occluded||this._sortedRenderers.some(({renderer:r})=>r.shouldRender(this._renderContext))}get mode(){var e,r;return this.isEmpty?Vg.Disabled:(e=this._renderTargets)!=null&&e.getTexture(Wi.WaterNormal)?Vg.EnabledWithWater:(r=this._renderTargets)!=null&&r.getTexture(Wi.Color)?Vg.Enabled:Vg.Disabled}updateAnimation(e){let r=!1;return this._renderers.forEach(i=>r=i.updateAnimation(e)||r),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const r of this._overlays)this.longitudeCyclical?r.setupGeometryViewsCyclical(this.longitudeCyclical):r.setupGeometryViewsDirect();for(const r of this._renderTargets.targets){if(r.content===Wi.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const i=this._drawTarget(Cs.INNER,r,e),n=this._drawTarget(Cs.OUTER,r,e);(i||n)&&r.fbo.generateMipMap()}}}_drawTarget(e,r,i){const n=this._overlays[e],s=n.canvasGeometries;if(s.numViews===0)return!1;const{alignPixelEnabled:o,contentPixelRatio:a}=i;this._screenToWorldRatio=a*n.mapUnitsPerPixel/this._bindParameters.overlayStretch;const l=r.output;if(this.isEmpty||l===G.Highlight&&!this.hasHighlights||l===G.Normal&&!this.hasWater||!n.hasSomeSizedView())return!1;const c=this._rctx;if(this._camera.pixelRatio=n.pixelRatio*a,this._renderContext.output=l,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=l===G.Normal?de.DRAPED_WATER:de.DRAPED_MATERIAL,r.content===Wi.Occluded&&(this._renderContext.renderOccludedMask=H9),!this.renders(r.content))return this._renderContext.renderOccludedMask=G9,!1;const u=n.resolution;this._rctx.setViewport(e===Cs.INNER?0:u,0,u,u);const h=2*n.resolution,p=n.resolution,f=r.fbo;if(f.bind(c,h,p),e===Cs.INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(Mi.COLOR_BUFFER_BIT)),Si.OVERLAY_DRAW_DEBUG_TEXTURE&&r.content!==Wi.Occluded)for(let g=0;g<s.numViews;g++)this._setViewParameters(s.extents[g],n),this._ensureDebugPatternResources(n.resolution,sTt[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll(({drapeSource:g,renderer:y})=>{if(r.content===Wi.ColorNoRasterImage&&g.drapeSourceType===BI.RasterImage)return;const{fullOpacity:v}=g,b=v!=null&&v<1&&l===G.Color?this.bindTemporaryFramebuffer(h,p):null;for(let w=0;w<s.numViews;w++)this._setViewParameters(s.extents[w],n),y.render(this._renderContext);if(b){f.bind(c,h,p),this._overlayParameters.texture=b.getTexture(),this._overlayParameters.opacity=v,this._overlayParameters.overlayIndex=e;const w=this.pluginContext.techniqueRepository.acquire(Pke);this._rctx.bindTechnique(w,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),w.release(),b.release()}}),c.bindFramebuffer(null),this._renderContext.renderOccludedMask=G9,!0}bindTemporaryFramebuffer(e,r){const i=this.view._stage.renderer.fboCache,n=i.acquire(e,r,"overlay tmp");return i.rctx.unbindTexture(n.fbo.colorTexture),i.rctx.bindFramebuffer(n.fbo),i.rctx.clearSafe(Mi.COLOR_BUFFER_BIT),n}async reloadShaders(){await this._shaderTechniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,r,i,n){var o;this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let s=0;for(const{renderer:a}of this._sortedRenderers)s=((o=a.intersect)==null?void 0:o.call(a,e,r,i,n,s))??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers,r=e.length;this._renderers.forEach((i,n)=>{const s=e.indexOf(n.layer),o=s>=0,a=n.renderGroup??(o?k9.MapLayer:k9.ViewLayer),l=r*a+(o?s:0);this._sortedRenderers.push(new nTt(n,i,l))}),this._sortedRenderers.sort((i,n)=>i.index-n.index)}_setViewParameters(e,r){const i=this._camera;i.viewport=[0,0,r.resolution,r.resolution],nPe(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),aN(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=Hd(this._renderers,r=>r.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_ensureDebugPatternResources(e,r){if(se(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const i=new Uint8Array(e*e*4);let n=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),u=Math.floor(a/10);c<2||u<2||10*c>e-20||10*u>e-20?(i[n++]=255,i[n++]=255,i[n++]=255,i[n++]=255):(i[n++]=255,i[n++]=255,i[n++]=255,i[n++]=1&c&&1&u?1&l^1&a?0:255:1&c^1&u?0:128)}const s=new ui(e);s.samplingMode=Kt.NEAREST,this._passParameters.texture=new Mr(this._rctx,s,i);const o=new Fle;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniques.acquire(Nle,o)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),sortedDrapeSources:Array.from(this._sortedRenderers).map(({drapeSource:e})=>e),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};d([m()],vd.prototype,"hasHighlights",void 0),d([m()],vd.prototype,"_sortedDrapeSourceRenderersDirty",void 0),d([m()],vd.prototype,"_shaderTechniques",void 0),d([m({constructOnly:!0})],vd.prototype,"view",void 0),d([m()],vd.prototype,"worldToPCSRatio",void 0),d([m()],vd.prototype,"spatialReference",void 0),d([m({type:Boolean,readOnly:!0})],vd.prototype,"updating",null),d([m()],vd.prototype,"isEmpty",null),d([m({readOnly:!0})],vd.prototype,"rendersOccludedDraped",null),vd=d([F("esri.views.3d.terrain.OverlayRenderer")],vd);let nTt=class{constructor(e,r,i){this.drapeSource=e,this.renderer=r,this.index=i}};const sTt=[[1,.5,.5],[.5,.5,1]],Ule=-2,H9=Wr.OccludeAndTransparent;function zle(t,e,r,i){const n=fN(t.rings,!!t.hasZ&&i.mode!=="on-the-ground",ly.CCW_IS_HOLE,t.spatialReference),s=Go(n.position.length),o=Q4e(n.position,t.spatialReference,0,s,0,n.position,0,n.position.length/3,e,r,i),a=o!=null;return new lTt(n.position,s,Rke(n.polygons,n.position,s),Mke(n.outlines,n.position,s),a,o)}function Oke(t,e){const r=fN(t.rings,!1,ly.CCW_IS_HOLE),i=an(r.position,t.spatialReference,0,r.position,e,0,r.position.length/3);for(let n=2;n<r.position.length;n+=3)r.position[n]=Ule;return{position:r.position,polygons:Rke(r.polygons,r.position),outlines:Mke(r.outlines,r.position),projectionSuccess:i}}function Mke(t,e,r=null){return t.filter(({count:i})=>i>1).map(({index:i,count:n})=>{const s=3*i,o=3*n;return r!=null?new $ke(i,n,Qd(e,s,o),Qd(r,s,o)):new Vle(i,n,Qd(e,s,o))})}function Rke(t,e,r=null){const i=new Array;for(const{index:n,count:s,holeIndices:o,pathLengths:a}of t){if(s<=1)continue;const l=3*n,c=3*s,u=o.map(p=>p-n),h=r!=null?new oTt(n,s,Qd(e,3*n,3*s),Qd(r,l,c),u,a):new aTt(n,s,Qd(e,3*n,3*s),u,a);i.push(h)}return i}let Vle=class{constructor(e,r,i){this.index=e,this.count=r,this.position=i}},$ke=class extends Vle{constructor(e,r,i,n){super(e,r,i),this.mapPositions=n}},oTt=class extends $ke{constructor(e,r,i,n,s,o){super(e,r,i,n),this.holeIndices=s,this.pathLengths=o}},aTt=class extends Vle{constructor(e,r,i,n,s){super(e,r,i),this.holeIndices=n,this.pathLengths=s}},lTt=class{constructor(e,r,i,n,s,o){this.position=e,this.mapPositions=r,this.polygons=i,this.outlines=n,this.projectionSuccess=s,this.sampledElevation=o}};function _m(t,e,r,i,n,s=2){const o=1/(Math.abs(r)+Math.abs(i)+Math.abs(n)),a=r*o,l=i*o,c=n<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,u=n<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,h=e*s;t[h]=v_e(c),t[h+1]=v_e(u)}function cTt(t){const e=t.length/3,r=new Int16Array(2*e);let i=0;for(let n=0;n<e;++n)_m(r,n,t[i++],t[i++],t[i++]);return r}function iir(t,e){const r=t.length/3,i=new Int16Array(2*r);let n=0;const s=C();for(let o=0;o<r;++o)s[0]=t[n++],s[1]=t[n++],s[2]=t[n++],po(s,s,e),_m(i,o,s[0],s[1],s[2]);return i}function uTt(t,e,r,i=2){const n=r*i,s=b_e(e[n]),o=b_e(e[n+1]),a=1-Math.abs(s)-Math.abs(o);t[2]=a,a<0?(t[0]=(s>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(s))):(t[0]=s,t[1]=o),me(t,t)}function v_e(t){return we(Math.round(32767*t),-32767,32767)}function b_e(t){return we(t/32767,-1,1)}const hTt=["polygon","extent"];let dTt=class extends Cy{constructor(e,r,i,n){super(e,r,i,n),this.ensureDrapedStatus(!1)}async doLoad(){var a,l;if(!this._drivenProperties.size){const c=dG(this._getSymbolSize());if(c)throw new B("graphics3dextrudesymbollayer:invalid-size",c)}const e=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,r=this._getCombinedOpacityAndColor(e),i=Ka(r),n=r[3],s=n<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:n,transparent:s,cullFace:s?$i.None:$i.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:Ur.Compressed};this._materials[gh.Main]=new gm(o),this._materials[gh.Bottom]=new gm({...o,cullFace:$i.Back}),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,hTt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(r);return this._createAs3DShape(r,e.renderingInfo,i,n,r.uid)}layerOpacityChanged(e,r){var a,l,c,u;const i=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,n=this._getCombinedOpacity(i),s=n<1||this.needsDrivenTransparentPass;(c=this._materials[gh.Main])==null||c.setParameters({opacity:n,transparent:s}),(u=this._materials[gh.Bottom])==null||u.setParameters({opacity:n,transparent:s});const o=this._getLayerOpacity();e.forEach(h=>{const p=r(h);p!=null&&p.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,Wb)}slicePlaneEnabledChanged(e,r){var i,n;return(i=this._materials[gh.Main])==null||i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),(n=this._materials[gh.Bottom])==null||n.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(s=>{const o=r(s);o!=null&&o.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){var r,i;const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return(r=this._materials[gh.Main])==null||r.setParameters(e),(i=this._materials[gh.Bottom])==null||i.setParameters(e),!0}_getExtrusionSize(e){let r;return r=e.size&&this._drivenProperties.size?txt(e.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(e,r){return this._drivenPropertiesChanged(r)?ls.RecreateSymbol:ls.RecreateGraphics}async queryForSnapping(e,r,i,n){const s=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/zT(r),{objectId:o,target:a}=e,l=ae(a);switch(l.z=(l.z??0)+s,e.type){case"edge":{const{start:c,end:u}=e,h=ae(c),p=ae(u);return h.z=(h.z??0)+s,p.z=(p.z??0)+s,[H0e(o,l,1/0,h,p)]}case"vertex":return[Vwt(o,l,1/0),H0e(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,r,i,n,s){const o=XL(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(L=>L.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=zle(o,this._context.elevationProvider,this._context.renderCoordsHelper,n);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=ole(o);if(l==null)return null;const c=new Array,u=new Array,h=Ds(),p=xe(),f=C(),g=this._context.renderCoordsHelper.viewingMode===Fe.Global;g||this._context.renderCoordsHelper.worldUpAtPosition(null,f),Ua(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const y=xe();us(y,p);const v=gi();d_(v,y);const{polygons:b,mapPositions:w,position:x}=a;for(const L of b){const U=L.count;if(this._context.clippingExtent&&(zi(h),Ru(h,L.mapPositions),!Uf(h,this._context.clippingExtent)))continue;const z=qP(L.mapPositions,L.holeIndices,3);if(z.length===0)continue;const W=z.length,V=6*U,J=Az(V+W),Y=Az(W),X=Go(3*V),le=Go(3*V),D=Go(3*V),I=Go(V);pTt(x,w,z,L,X,D,le,I,J,Y,this._getExtrusionSize(r),f,g),am(X,X,y);const k=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),j=new _Tt(X,D,cTt(le),I);c.push(w_e(this._materials[gh.Main],J,J.length-Y.length,j,i,k),w_e(this._materials[gh.Bottom],Y,0,j,i,k)),u.push(j.heights)}if(c.length===0)return null;const S=new I_({geometries:c,layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0});S.transformation=p;const E=g5e(this.symbolLayer,{opacity:this._getLayerOpacity()}),P=E!=null?{baseMaterial:this._materials[gh.Main],edgeMaterials:[E],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,M=new Ey(this,S,c,null,null,(L,U,z,W,V)=>gTt(L,U,z,W,V,u),n,P);return M.alignedSampledElevation=a.sampledElevation,M.needsElevationUpdates=Wb(n.mode),M}};function w_e(t,e,r,i,n,s){const o=ow(e.length),a=[[R.POSITION,new tt(i.positions,e,3,!0)],[R.NORMALCOMPRESSED,new tt(i.normals,e,2,!0)],[R.COLOR,new tt(n,o,4,!0)]];return new Is(t,a,i.elevation,Ln.Mesh,s,r)}function pTt(t,e,r,i,n,s,o,a,l,c,u,h,p){const f=r.length/3;let g=0,y=2*i.count;fTt(t,e,i.index,i.count,r,0,f,n,s,o,a,l,c,y,u,h,p);let v=2*i.count;y=0,x_e(n,s,a,o,g,i.pathLengths[0],i.count,v,l,y,u),v+=4*i.pathLengths[0],y+=2*i.pathLengths[0],g+=i.pathLengths[0];for(let b=1;b<i.pathLengths.length;++b)x_e(n,s,a,o,g,i.pathLengths[b],i.count,v,l,y,u),v+=4*i.pathLengths[b],y+=2*i.pathLengths[b],g+=i.pathLengths[b]}function fTt(t,e,r,i,n,s,o,a,l,c,u,h,p,f,g,y,v){he(cc,y);const b=g>0?1:-1;let w=3*r,x=0,S=3*x,E=i,P=3*E;for(let U=0;U<i;++U)v&&(cc[0]=t[w],cc[1]=t[w+1],cc[2]=t[w+2],me(cc,cc)),a[S]=t[w],a[S+1]=t[w+1],a[S+2]=t[w+2],l[S]=e[w],l[S+1]=e[w+1],l[S+2]=e[w+2],c[S]=-b*cc[0],c[S+1]=-b*cc[1],c[S+2]=-b*cc[2],u[x]=0,a[P]=t[w]+g*cc[0],a[P+1]=t[w+1]+g*cc[1],a[P+2]=t[w+2]+g*cc[2],l[P]=e[w],l[P+1]=e[w+1],l[P+2]=e[w+2],c[P]=b*cc[0],c[P+1]=b*cc[1],c[P+2]=b*cc[2],u[E]=g,S+=3,P+=3,w+=3,x+=1,E+=1;w=3*s,S=0,P=3*f;const M=g<0?A_e:P_e,L=g<0?P_e:A_e;for(let U=0;U<o;++U)p[S]=n[w+M[0]],p[S+1]=n[w+M[1]],p[S+2]=n[w+M[2]],h[P]=n[w+L[0]]+i,h[P+1]=n[w+L[1]]+i,h[P+2]=n[w+L[2]]+i,S+=3,P+=3,w+=3}function bF(t,e,r,i,n,s,o){i[s]=i[o],o*=3,t[s*=3]=t[o],t[s+1]=t[o+1],t[s+2]=t[o+2],e[s]=e[o],e[s+1]=e[o+1],e[s+2]=e[o+2],r[s]=n[0],r[s+1]=n[1],r[s+2]=n[2]}const _M=C();function x_e(t,e,r,i,n,s,o,a,l,c,u){let h=n,p=n+1,f=n+o,g=n+o+1,y=a,v=a+1,b=a+2*s,w=a+2*s+1;u<0&&(h=n+o+1,g=n),c*=3;for(let x=0;x<s;++x)x===s-1&&(u>0?(p=n,g=n+o):(p=n,h=n+o)),mTt(t,h,p,f,_M),bF(t,e,i,r,_M,y,h),bF(t,e,i,r,_M,v,p),bF(t,e,i,r,_M,b,f),bF(t,e,i,r,_M,w,g),l[c++]=y,l[c++]=b,l[c++]=w,l[c++]=y,l[c++]=w,l[c++]=v,h++,p++,f++,g++,y+=2,v+=2,b+=2,w+=2}const Jq=C(),S_e=C(),T_e=C(),E_e=C(),C_e=C();function mTt(t,e,r,i,n){e*=3,r*=3,i*=3,se(Jq,t[e++],t[e++],t[e++]),se(S_e,t[r++],t[r++],t[r++]),se(T_e,t[i++],t[i++],t[i++]),_e(E_e,S_e,Jq),_e(C_e,T_e,Jq),it(n,C_e,E_e),me(n,n)}const _E=C();function gTt(t,e,r,i,n,s){const o=t.stageObject,a=o.geometries,l=a.length,c=e.mode!=="absolute-height";let u=0;const h=o.transformation,p=zA(xe(),h);for(let f=0;f<l;f+=2){const g=a[f];if(!nle(g))continue;const y=g.getMutableAttribute(R.POSITION).data,v=s[f/2],b=new $oe(g.mapPositions),w=y.length/3;let x=0,S=!1,E=0;for(let P=0;P<w;P++){_E[0]=y[x],_E[1]=y[x+1],_E[2]=y[x+2],i(b,wF),c&&(E+=wF.sampledElevation),Si.TESTS_DISABLE_OPTIMIZATIONS?(se(Xc,b.array[b.offset],b.array[b.offset+1],wF.z+v[x/3]),r!=null&&n.toRenderCoords(Xc,r,Xc),ze(Xc,Xc,p)):(se(Xc,y[x],y[x+1],y[x+2]),ze(Xc,Xc,h),n.setAltitude(Xc,wF.z+v[x/3]),ze(Xc,Xc,p)),y[x]=Xc[0],y[x+1]=Xc[1],y[x+2]=Xc[2];const M=yTt/n.unitInMeters;(Math.abs(_E[0]-y[x])>=M||Math.abs(_E[1]-y[x+1])>=M||Math.abs(_E[2]-y[x+2])>=M)&&(S=!0),b.offset+=3,x+=3}S&&(g.invalidateBoundingInfo(),o.geometryVertexAttributeUpdated(a[f],R.POSITION),a[f+1].invalidateBoundingInfo(),o.geometryVertexAttributeUpdated(a[f+1],R.POSITION)),u+=E/w}return u/l}const Xc=C(),cc=C(),wF=new FN,P_e=[0,2,1],A_e=[0,1,2],yTt=.01;var gh;(function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"})(gh||(gh={}));let _Tt=class{constructor(e,r,i,n){this.positions=e,this.elevation=r,this.normals=i,this.heights=n}};const xF=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["«","»"],["»","«"],["‹","›"],["›","‹"],["⁽","⁾"],["⁾","⁽"],["₍","₎"],["₎","₍"],["≤","≥"],["≥","≤"],["〈","〉"],["〉","〈"],["﹙","﹚"],["﹚","﹙"],["﹛","﹜"],["﹜","﹛"],["﹝","﹞"],["﹞","﹝"],["﹤","﹥"],["﹥","﹤"]],bA=["آ","أ","إ","ا"],vTt=["ﻵ","ﻷ","ﻹ","ﻻ"],bTt=["ﻶ","ﻸ","ﻺ","ﻼ"],q9=["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ی","ئ","ؤ"],wTt=["ﺍ","ﺏ","ﺕ","ﺙ","ﺝ","ﺡ","ﺥ","ﺩ","ﺫ","ﺭ","ﺯ","ﺱ","ﺵ","ﺹ","ﺽ","ﻁ","ﻅ","ﻉ","ﻍ","ﻑ","ﻕ","ﻙ","ﻝ","ﻡ","ﻥ","ﻩ","ﻭ","ﻱ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯼ","ﺉ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺉ","ﺅ"],xTt=["ﺎ","ﺐ","ﺖ","ﺚ","ﺞ","ﺢ","ﺦ","ﺪ","ﺬ","ﺮ","ﺰ","ﺲ","ﺶ","ﺺ","ﺾ","ﻂ","ﻆ","ﻊ","ﻎ","ﻒ","ﻖ","ﻚ","ﻞ","ﻢ","ﻦ","ﻪ","ﻮ","ﻲ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯽ","ﺊ","ﺆ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺊ","ﺆ"],STt=["ﺎ","ﺒ","ﺘ","ﺜ","ﺠ","ﺤ","ﺨ","ﺪ","ﺬ","ﺮ","ﺰ","ﺴ","ﺸ","ﺼ","ﻀ","ﻄ","ﻈ","ﻌ","ﻐ","ﻔ","ﻘ","ﻜ","ﻠ","ﻤ","ﻨ","ﻬ","ﻮ","ﻴ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯿ","ﺌ","ﺆ","ﹱ","ﹲ","ﹴ","ﹷ","ﹹ","ﹻ","ﹽ","ﹿ","ﺀ","ﺌ","ﺆ"],TTt=["ﺍ","ﺑ","ﺗ","ﺛ","ﺟ","ﺣ","ﺧ","ﺩ","ﺫ","ﺭ","ﺯ","ﺳ","ﺷ","ﺻ","ﺿ","ﻃ","ﻇ","ﻋ","ﻏ","ﻓ","ﻗ","ﻛ","ﻟ","ﻣ","ﻧ","ﻫ","ﻭ","ﻳ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯾ","ﺋ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺋ","ﺅ"],O_e=["ء","آ","أ","ؤ","إ","ا","ة","د","ذ","ر","ز","و","ى"],ETt=["ً","ً","ٌ","؟","ٍ","؟","َ","َ","ُ","ُ","ِ","ِ","ّ","ّ","ْ","ْ","ء","آ","آ","أ","أ","ؤ","ؤ","إ","إ","ئ","ئ","ئ","ئ","ا","ا","ب","ب","ب","ب","ة","ة","ت","ت","ت","ت","ث","ث","ث","ث","ج","ج","ج","ج","ح","ح","ح","ح","خ","خ","خ","خ","د","د","ذ","ذ","ر","ر","ز","ز","س","س","س","س","ش","ش","ش","ش","ص","ص","ص","ص","ض","ض","ض","ض","ط","ط","ط","ط","ظ","ظ","ظ","ظ","ع","ع","ع","ع","غ","غ","غ","غ","ف","ف","ف","ف","ق","ق","ق","ق","ك","ك","ك","ك","ل","ل","ل","ل","م","م","م","م","ن","ن","ن","ن","ه","ه","ه","ه","و","و","ى","ى","ي","ي","ي","ي","ﻵ","ﻶ","ﻷ","ﻸ","ﻹ","ﻺ","ﻻ","ﻼ","؟","؟","؟"],M_e=["ء","ف"],CTt=["غ","ي"],PTt=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],ATt=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],$=0,be=1,Lt=2,Gs=3,A=4,Tg=5,v8=6,O=7,Ll=8,uc=9,Lp=10,qt=11,te=12,OTt=13,MTt=14,RTt=15,$Tt=16,ITt=17,yt=18,LTt=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],wg=100,DTt=[wg+0,$,$,$,$,wg+1,wg+2,wg+3,be,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,wg+4,A,A,A,$,A,$,A,$,A,A,A,$,$,A,A,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,A,A,$,$,A,A,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,$,wg+5,O,O,wg+6,wg+7],NTt=[[yt,yt,yt,yt,yt,yt,yt,yt,yt,v8,Tg,v8,Ll,Tg,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,Tg,Tg,Tg,v8,Ll,A,A,qt,qt,qt,A,A,A,A,A,Lp,uc,Lp,uc,uc,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,uc,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,yt,yt,yt,yt,yt,yt,Tg,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,uc,A,qt,qt,qt,qt,A,A,A,A,$,A,A,yt,A,A,qt,qt,Lt,Lt,A,$,A,A,A,Lt,$,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,$,$,$,$,$,$,$,$],[$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,$,$,$,$,$,$,$,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,$,A,A,A,A,A,A,A,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,be,te,be,te,te,be,te,te,be,te,A,A,A,A,A,A,A,A,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,A,A,A,A,A,be,be,be,be,be,A,A,A,A,A,A,A,A,A,A,A],[Gs,Gs,Gs,Gs,A,A,A,A,O,qt,qt,O,uc,O,A,A,te,te,te,te,te,te,te,te,te,te,te,O,A,A,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,Gs,Gs,Gs,Gs,Gs,Gs,Gs,Gs,Gs,Gs,qt,Gs,Gs,O,O,O,te,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,te,te,te,te,te,te,te,Gs,A,te,te,te,te,te,te,O,O,te,te,A,te,te,te,te,O,O,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,O,O,O,O,O,O],[O,O,O,O,O,O,O,O,O,O,O,O,O,O,A,O,O,te,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,A,A,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,te,te,te,te,te,te,te,te,te,te,te,O,A,A,A,A,A,A,A,A,A,A,A,A,A,A,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,te,te,te,te,te,te,te,te,te,be,be,A,A,A,A,be,A,A,A,A,A],[Ll,Ll,Ll,Ll,Ll,Ll,Ll,Ll,Ll,Ll,Ll,yt,yt,yt,$,be,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,Ll,Tg,OTt,MTt,RTt,$Tt,ITt,uc,qt,qt,qt,qt,qt,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,uc,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,Ll,yt,yt,yt,yt,yt,A,A,A,A,A,yt,yt,yt,yt,yt,yt,Lt,$,A,A,Lt,Lt,Lt,Lt,Lt,Lt,Lp,Lp,A,A,A,$,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lp,Lp,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,qt,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A],[$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$,$,A,A,A,A,A,be,te,be,be,be,be,be,be,be,be,be,be,Lp,be,be,be,be,be,be,be,be,be,be,be,be,be,A,be,be,be,be,be,A,be,A,be,be,A,be,be,A,be,be,be,be,be,be,be,be,be,be,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O],[te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,te,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,te,te,te,te,te,te,te,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,uc,A,uc,A,A,uc,A,A,A,A,A,A,A,A,A,qt,A,A,Lp,Lp,A,A,A,A,A,qt,qt,A,A,A,A,A,O,O,O,O,O,A,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,A,A,yt],[A,A,A,qt,qt,qt,A,A,A,A,A,Lp,uc,Lp,uc,uc,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,Lt,uc,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,$,$,$,$,$,$,A,A,$,$,$,$,$,$,A,A,$,$,$,$,$,$,A,A,$,$,$,A,A,A,qt,qt,A,A,A,qt,qt,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A]];let FTt=class{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(e,r,i){if(this.sourceToTarget=[],this.targetToSource=[],!e)return"";if(e2t(this.sourceToTarget,this.targetToSource,e.length),!this.checkParameters(r,i))return e;r=this.inputFormat,i=this.outputFormat;let n=e;const s=r2t,o=I_e(r.charAt(1)),a=I_e(i.charAt(1)),l=(r.charAt(0)==="I"?"L":r.charAt(0))+o,c=(i.charAt(0)==="I"?"L":i.charAt(0))+a,u=r.charAt(2)+i.charAt(2);s.defInFormat=l,s.defOutFormat=c,s.defSwap=u;const h=r$(e,l,c,u,s);let p=!1;return i.charAt(1)==="R"?p=!0:i.charAt(1)!=="C"&&i.charAt(1)!=="D"||(p=this.checkContextual(h)==="rtl"),this.sourceToTarget=Mh,this.targetToSource=t2t(this.sourceToTarget),Y9=this.targetToSource,n=r.charAt(3)===i.charAt(3)?h:i.charAt(3)==="S"?UTt(p,h,!0):BTt(h,p,!0),this.sourceToTarget=Mh,this.targetToSource=Y9,this.levels=bG,n}_inputFormatSetter(e){if(!L_e.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!L_e.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,r){return e?this._inputFormatSetter(e):e=this.inputFormat,r?this._outputFormatSetter(r):r=this.outputFormat,e!==r}checkContextual(e){let r=W9(e);if(r!=="ltr"&&r!=="rtl"){try{r=document.dir.toLowerCase()}catch{}r!=="ltr"&&r!=="rtl"&&(r="ltr")}return r}hasBidiChar(e){return s2t.test(e)}};function r$(t,e,r,i,n){const s=kTt(t,{inFormat:e,outFormat:r,swap:i},n);if(s.inFormat===s.outFormat)return t;e=s.inFormat,r=s.outFormat,i=s.swap;const o=e.substring(0,1),a=e.substring(1,4),l=r.substring(0,1),c=r.substring(1,4);if(n.inFormat=e,n.outFormat=r,n.swap=i,o==="L"&&r==="VLTR"){if(a==="LTR")return n.dir=vE,g1(t,n);if(a==="RTL")return n.dir=i$,g1(t,n)}if(o==="V"&&l==="V")return n.dir=a==="RTL"?i$:vE,Qq(t,n);if(o==="L"&&r==="VRTL")return a==="LTR"?(n.dir=vE,t=g1(t,n)):(n.dir=i$,t=g1(t,n)),Qq(t);if(e==="VLTR"&&r==="LLTR")return n.dir=vE,g1(t,n);if(o==="V"&&l==="L"&&a!==c)return t=Qq(t),a==="RTL"?r$(t,"LLTR","VLTR",i,n):r$(t,"LRTL","VRTL",i,n);if(e==="VRTL"&&r==="LRTL")return r$(t,"LRTL","VRTL",i,n);if(o==="L"&&l==="L"){const u=n.swap;return n.swap=u.substr(0,1)+"N",a==="RTL"?(n.dir=i$,t=g1(t,n),n.swap="N"+u.substr(1,2),n.dir=vE,t=g1(t,n)):(n.dir=vE,t=g1(t,n),n.swap="N"+u.substr(1,2),t=r$(t,"VLTR","LRTL",n.swap,n)),t}return t}function kTt(t,e,r){if(e.inFormat===void 0&&(e.inFormat=r.defInFormat),e.outFormat===void 0&&(e.outFormat=r.defOutFormat),e.swap===void 0&&(e.swap=r.defSwap),e.inFormat===e.outFormat)return e;const i=e.inFormat.substring(0,1),n=e.outFormat.substring(0,1);let s,o=e.inFormat.substring(1,4),a=e.outFormat.substring(1,4);return o.charAt(0)==="C"&&(s=W9(t),o=s==="ltr"||s==="rtl"?s.toUpperCase():e.inFormat.charAt(2)==="L"?"LTR":"RTL",e.inFormat=i+o),a.charAt(0)==="C"&&(s=W9(t),s==="rtl"?a="RTL":s==="ltr"?(s=VTt(t),a=s.toUpperCase()):a=e.outFormat.charAt(2)==="L"?"LTR":"RTL",e.outFormat=n+a),e}function UTt(t,e,r){if(e.length===0)return"";t===void 0&&(t=!0),r===void 0&&(r=!0);const i=(e=String(e)).split("");let n=0,s=1,o=i.length;t||(n=i.length-1,s=-1,o=1);const a=zTt(i,n,s,o,r);let l="";for(let c=0;c<i.length;c++)r&&qTt(a,a.length,c)>-1?(Dke(Y9,c,!t,-1),Mh.splice(c,1)):l+=i[c];return l}function zTt(t,e,r,i,n){let s=0;const o=[];let a=0;for(let l=e;l*r<i;l+=r)if(Lke(t[l])||PD(t[l])){if(t[l]==="ل"&&WTt(t,l+r,r,i)){t[l]=KTt(t[l+r],s===0?vTt:bTt),l+=r,QTt(t,l,r,i),n&&(o[a]=l,a++),s=0;continue}const c=t[l];s===1?t[l]=R_e(t,l+r,r,i)?JTt(t[l]):Kq(t[l],xTt):R_e(t,l+r,r,i)===!0?t[l]=Kq(t[l],TTt):t[l]=Kq(t[l],wTt),PD(c)||(s=1),ZTt(c)===!0&&(s=0)}else s=0;return o}function W9(t){const e=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(t);return e?e[0]<="z"?"ltr":"rtl":""}function VTt(t){const e=t.split("");return e.reverse(),W9(e.join(""))}function BTt(t,e,r){if(t.length===0)return"";r===void 0&&(r=!0),e===void 0&&(e=!0);let i="";const n=(t=String(t)).split("");for(let s=0;s<t.length;s++){let o=!1;if(n[s]>="ﹰ"&&n[s]<"\uFEFF"){const a=t.charCodeAt(s);n[s]>="ﻵ"&&n[s]<="ﻼ"?(e?(s>0&&r&&n[s-1]===" "?i=i.substring(0,i.length-1)+"ل":(i+="ل",o=!0),i+=bA[(a-65269)/2]):(i+=bA[(a-65269)/2],i+="ل",s+1<t.length&&r&&n[s+1]===" "?s++:o=!0),o&&(Dke(Y9,s,!0,1),Mh.splice(s,0,Mh[s]))):i+=ETt[a-65136]}else i+=n[s]}return i}function g1(t,e){const r=t.split(""),i=[];return Ike(r,i,e),jTt(r,i,e),$_e(2,r,i,e),$_e(1,r,i,e),bG=i,r.join("")}function Ike(t,e,r){const i=t.length,n=r.dir?ATt:PTt;let s=0,o=-1;const a=[],l=[];r.hiLevel=r.dir,r.lastArabic=!1,r.hasUbatAl=!1,r.hasUbatB=!1,r.hasUbatS=!1;for(let c=0;c<i;c++)a[c]=HTt(t[c]);for(let c=0;c<i;c++){const u=s,h=YTt(t,a,l,c,r);l[c]=h,s=n[u][h];const p=240&s;s&=15;const f=n[s][i2t];if(e[c]=f,p>0)if(p===16){for(let g=o;g<c;g++)e[g]=1;o=-1}else o=-1;if(n[s][n2t])o===-1&&(o=c);else if(o>-1){for(let g=o;g<c;g++)e[g]=f;o=-1}a[c]===Tg&&(e[c]=0),r.hiLevel|=f}r.hasUbatS&&GTt(a,e,i,r)}function GTt(t,e,r,i){for(let n=0;n<r;n++)if(t[n]===v8){e[n]=i.dir;for(let s=n-1;s>=0&&t[s]===Ll;s--)e[s]=i.dir}}function jTt(t,e,r){if(r.hiLevel!==0&&r.swap.substr(0,1)!==r.swap.substr(1,2))for(let i=0;i<t.length;i++)e[i]===1&&(t[i]=XTt(t[i]))}function HTt(t){const e=t.charCodeAt(0),r=DTt[e>>8];return r<wg?r:NTt[r-wg][255&e]}function Qq(t,e){const r=t.split("");if(e){const i=[];Ike(r,i,e),bG=i}return r.reverse(),Mh.reverse(),r.join("")}function qTt(t,e,r){for(let i=0;i<e;i++)if(t[i]===r)return i;return-1}function Lke(t){for(let e=0;e<M_e.length;e++)if(t>=M_e[e]&&t<=CTt[e])return!0;return!1}function R_e(t,e,r,i){for(;e*r<i&&PD(t[e]);)e+=r;return!!(e*r<i&&Lke(t[e]))}function WTt(t,e,r,i){for(;e*r<i&&PD(t[e]);)e+=r;let n=" ";if(!(e*r<i))return!1;n=t[e];for(let s=0;s<bA.length;s++)if(bA[s]===n)return!0;return!1}function $_e(t,e,r,i){if(i.hiLevel<t)return;if(t===1&&i.dir===i$&&!i.hasUbatB)return e.reverse(),void Mh.reverse();const n=e.length;let s,o,a,l,c,u=0;for(;u<n;){if(r[u]>=t){for(s=u+1;s<n&&r[s]>=t;)s++;for(o=u,a=s-1;o<a;o++,a--)l=e[o],e[o]=e[a],e[a]=l,c=Mh[o],Mh[o]=Mh[a],Mh[a]=c;u=s}u++}}function YTt(t,e,r,i,n){const s=e[i];return{UBAT_L:()=>(n.lastArabic=!1,$),UBAT_R:()=>(n.lastArabic=!1,be),UBAT_ON:()=>A,UBAT_AN:()=>Gs,UBAT_EN:()=>n.lastArabic?Gs:Lt,UBAT_AL:()=>(n.lastArabic=!0,n.hasUbatAl=!0,be),UBAT_WS:()=>A,UBAT_CS:()=>{let o,a;return i<1||i+1>=e.length||(o=r[i-1])!==Lt&&o!==Gs||(a=e[i+1])!==Lt&&a!==Gs?A:(n.lastArabic&&(a=Gs),a===o?a:A)},UBAT_ES:()=>(i>0?r[i-1]:Tg)===Lt&&i+1<e.length&&e[i+1]===Lt?Lt:A,UBAT_ET:()=>{if(i>0&&r[i-1]===Lt)return Lt;if(n.lastArabic)return A;let o=i+1;const a=e.length;for(;o<a&&e[o]===qt;)o++;return o<a&&e[o]===Lt?Lt:A},UBAT_NSM:()=>{if(n.inFormat==="VLTR"){const o=e.length;let a=i+1;for(;a<o&&e[a]===te;)a++;if(a<o){const l=t[i].charCodeAt(0),c=l>=1425&&l<=2303||l===64286,u=e[a];if(c&&(u===be||u===O))return be}}return i<1||e[i-1]===Tg?A:r[i-1]},UBAT_B:()=>(n.lastArabic=!0,n.hasUbatB=!0,n.dir),UBAT_S:()=>(n.hasUbatS=!0,A),UBAT_LRE:()=>(n.lastArabic=!1,A),UBAT_RLE:()=>(n.lastArabic=!1,A),UBAT_LRO:()=>(n.lastArabic=!1,A),UBAT_RLO:()=>(n.lastArabic=!1,A),UBAT_PDF:()=>(n.lastArabic=!1,A),UBAT_BN:()=>A}[LTt[s]]()}function XTt(t){let e,r=0,i=xF.length-1;for(;r<=i;)if(e=Math.floor((r+i)/2),t<xF[e][0])i=e-1;else{if(!(t>xF[e][0]))return xF[e][1];r=e+1}return t}function ZTt(t){for(let e=0;e<O_e.length;e++)if(O_e[e]===t)return!0;return!1}function JTt(t){for(let e=0;e<q9.length;e++)if(t===q9[e])return STt[e];return t}function Kq(t,e){for(let r=0;r<q9.length;r++)if(t===q9[r])return e[r];return t}function PD(t){return t>="ً"&&t<="ٕ"}function I_e(t){return t==="L"?"LTR":t==="R"?"RTL":t==="C"?"CLR":t==="D"?"CRL":""}function QTt(t,e,r,i){for(;e*r<i&&PD(t[e]);)e+=r;return e*r<i&&(t[e]=" ",!0)}function KTt(t,e){for(let r=0;r<bA.length;r++)if(t===bA[r])return e[r];return t}function e2t(t,e,r){Mh=[],bG=[];for(let i=0;i<r;i++)t[i]=i,e[i]=i,Mh[i]=i}function t2t(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[t[r]]=r;return e}function Dke(t,e,r,i){for(let n=0;n<t.length;n++)(t[n]>e||!r&&t[n]===e)&&(t[n]+=i)}let Mh=[],Y9=[],bG=[];const r2t={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},i2t=5,n2t=6,vE=0,i$=1,L_e=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,s2t=/[\u0591-\u06ff\ufb1d-\ufefc]/,eW=new FTt;function o2t(t){if(t==null)return["",!1];if(!eW.hasBidiChar(t))return[t,!1];let e;return e=eW.checkContextual(t)==="rtl"?"IDNNN":"ICNNN",[eW.bidiTransform(t,e,"VLYSN"),!0]}let hO=class{constructor(){this.setIdentity()}getAngle(){return(this.rz==null||this.rz===0&&this.rzCos!==1&&this.rzSin!==0)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,r){this.tx=e,this.ty=r}setTranslateZ(e){this.tz=e}setRotateCS(e,r){this.rz=void 0,this.rzCos=e,this.rzSin=r}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}};const Nke="arial-unicode-ms",D_e="woff2",N_e=new Map,Fke=new Set;let a2t=class{constructor(e,r){this.fontFace=e,this.promise=r}};async function l2t(t){const e=h2t(t),r=N_e.get(e);if(r)return r.promise;const i=new FontFace(t.family,`url('${ai.fontsUrl}/woff2/${e}.${D_e}') format('${D_e}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(i)&&i.status==="loading")return i.loaded;const s=i.load().then(()=>(n.add(i),i));return N_e.set(e,new a2t(i,s)),Fke.add(i),s}function c2t(t){return Fke.has(t)}function u2t(t){if(!t)return Nke;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function h2t(t){const e=d2t(t)+p2t(t);return u2t(t.family)+(e.length>0?e:"-regular")}function d2t(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function p2t(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let eo=class{static fromOptimized(e,r,i=!1,n=!1,s=1){return new ete().initialize(e,r,i,n,s)}static fromJSON(e,r=!1,i=!1){const[n,s]=F_e(e);return new tte().initialize(n,s,r,i,1)}static fromOptimizedCIM(e,r,i=!1,n=!1,s=1){return new k_e().initialize(e,r,i,n,s)}static fromJSONCIM(e,r=!1,i=!1,n=1){const[s,o]=F_e(e);return new U_e().initialize(s,o,r,i,n)}static fromFeatureSetReader(e){const r=e.readGeometryForDisplay(),i=e.geometryType;return r&&i?this.fromOptimized(r,i):null}static fromFeatureSetReaderCIM(e){const r=e.readGeometryForDisplay(),i=e.geometryType;return r&&i?this.fromOptimizedCIM(r,i):null}static createEmptyOptimized(e,r=!1,i=!1,n=1){return new ete().initialize(new zc,e,r,i,n)}static createEmptyJSON(e,r=!1,i=!1){return new tte().initialize([],e,r,i,1)}static createEmptyOptimizedCIM(e,r=!1,i=!1,n=1){return new k_e().initialize(new zc,e,r,i,n)}static createEmptyJSONCIM(e,r=!1,i=!1,n=1){return new U_e().initialize([],e,r,i,n)}asJSON(){const e=PB(this);return this.geometryType==="esriGeometryEnvelope"?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:this.geometryType==="esriGeometryMultipoint"?{points:e.flat()}:this.geometryType==="esriGeometryPoint"?{x:e[0][0][0],y:e[0][0][1]}:this.geometryType==="esriGeometryPolygon"?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,r,i=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,r=this.y;const n=e,s=r;for(;this.nextPoint();)i+=(e-this.x)*(r+this.y),e=this.x,r=this.y;return i+=(e-n)*(r+s),-.5*i}invertY(){this.yFactor*=-1}},ete=class kke extends eo{constructor(){super(...arguments),this._end=-1}initialize(e,r,i,n,s){return this.hasZ=i,this.hasM=n,this.geometryType=r,this._stride=2+Number(i)+Number(n),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=s,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){const r=this._pathOffset+e*this._stride;return r>=0&&r<this._end&&(this._pointOffset=r,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1)&&(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,!0)}prevPath(){return!(this.pathIndex<=0)&&(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,!0)}pathLength(){const e=this._end,r=this._stride,i=this._geometry.coords;let n=0;for(let s=this._pathOffset+r;s<e;s+=r){const o=i[s-r],a=i[s-r+1],l=i[s]-o,c=i[s+1]-a;n+=Math.sqrt(l*l+c*c)}return n}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let r=0;r<this._stride;++r)this._geometry.coords.push(e[r]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,r){this._geometry.coords.push(e,r),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const r of e)for(let i=0;i<this._stride;++i)this._geometry.coords.push(r[i]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){const r=e.asOptimized();this._geometry.coords.push(...r.coords),this._geometry.lengths.push(...r.lengths)}asOptimized(){const e=this._geometry.clone();if(this.yFactor!==1)for(let r=1;r<e.coords.length;r+=this._stride)e.coords[r]*=this.yFactor;return this.geometryType==="esriGeometryPoint"&&(e.lengths.length=0),e}isClosed(){const e=this._geometry.coords,r=this._pathOffset,i=this._end-this._stride;for(let n=0;n<this._stride;n++)if(e[r+n]!==e[i+n])return!1;return!0}clone(){return new kke().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((e,r)=>e+r)}get pathSize(){const{lengths:e}=this._geometry;return this._pathIndex<0||this._pathIndex>e.length-1?0:this._geometry.isPoint?1:e[this._pathIndex]}get totalSize(){return this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){const e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}};function f2t(t){const e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e}function F_e(t){return ol(t)?[t.rings,"esriGeometryPolygon"]:Lf(t)?[t.paths,"esriGeometryPolyline"]:dT(t)?[[t.points],"esriGeometryMultipoint"]:If(t)?[[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]],"esriGeometryEnvelope"]:GP(t)?[[[f2t(t)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}let tte=class Uke extends eo{initialize(e,r,i,n,s){return this._paths=e,this.geometryType=r,this.hasZ=i,this.hasM=n,this._pathIndex=this._pointIndex=-1,this.yFactor=s,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const e=this._currentPath.length,r=this._currentPath;let i=0;for(let n=1;n<e;n++){const s=r[n-1],o=r[n],a=s[0],l=s[1],c=o[0]-a,u=o[1]-l;i+=Math.sqrt(c*c+u*u)}return i}startPath(){this._paths.push([])}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,r){this._paths[this.totalSize-1].push([e,r])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){const r=PB(e);for(const i of r)this.pushPath(i)}asOptimized(){const e=new zc;if(this.geometryType==="esriGeometryPoint")e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const r of this._paths){for(const i of r)e.coords.push(i[0]),e.coords.push(i[1]*this.yFactor),this.hasZ&&e.coords.push(i[2]),this.hasM&&e.coords.push(i[this._mIndex]);e.lengths.push(r.length)}return e}isClosed(){const e=this._currentPath[0],r=this._currentPath[this._currentPath.length-1];for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}clone(){return new Uke().initialize(ae(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(e=>e.length).reduce((e,r)=>e+r)}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}};const SF=4,TF=1;let k_e=class zke extends ete{initialize(e,r,i,n,s){return super.initialize(e,r,i,n,s),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map(o=>new Set)),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const e=new zke().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return e._controlPoints=this._controlPoints,e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}},U_e=class Vke extends tte{initialize(e,r,i,n,s){return super.initialize(e,r,i,n,s)}clone(){return new Vke().initialize(ae(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][SF]=TF}getControlPoint(){return this._paths[this.pathIndex][this._pointIndex][SF]===TF}setControlPointAt(e){this._paths[this.pathIndex][e][SF]=TF}getControlPointAt(e){return this._paths[this.pathIndex][e][SF]===TF}};const m2t=512;var Sf,Pa;(function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"})(Sf||(Sf={}));let Qa=class b8{constructor(e,r){this.x=e,this.y=r}clone(){return new b8(this.x,this.y)}equals(e,r){return e===this.x&&r===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,r){return this.x=e,this.y=r,this}normalize(){const e=this.x,r=this.y,i=Math.sqrt(e*e+r*r);return this.x/=i,this.y/=i,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,r){return this.x+=e,this.y+=r,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,r){return this.x=e.x+r.x,this.y=e.y+r.y,this}assignSub(e,r){return this.x=e.x-r.x,this.y=e.y-r.y,this}rotate(e,r){const i=this.x,n=this.y;return this.x=i*e-n*r,this.y=i*r+n*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,r=this.y;return Math.sqrt(e*e+r*r)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,r){const i=r.x-e.x,n=r.y-e.y;return Math.sqrt(i*i+n*n)}static add(e,r){return new b8(e.x+r.x,e.y+r.y)}static sub(e,r){return new b8(e.x-r.x,e.y-r.y)}},EF=class{constructor(e,r,i){this.ratio=e,this.x=r,this.y=i}},g2t=class{constructor(e,r,i,n=8,s=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=n,this._pixelMargin=s,this._tileSize=m2t*n,this._dz=e,this._yPos=r,this._xPos=i}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let r=this._pixelRatio*this._pixelMargin;r/=this._finalRatio;const i=e>>this._dz;r>i&&(r=i),this._margin=r,this._xmin=i*this._xPos-r,this._ymin=i*this._yPos-r,this._xmax=this._xmin+i+2*r,this._ymax=this._ymin+i+2*r}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,r){this._pushLine(),this._prevIsIn=this._isIn(e,r),this._moveTo(e,r,this._prevIsIn),this._prevPt=new Qa(e,r),this._firstPt=new Qa(e,r),this._dist=0}lineTo(e,r){const i=this._isIn(e,r),n=new Qa(e,r),s=Qa.distance(this._prevPt,n);let o,a,l,c,u,h,p,f;if(i)this._prevIsIn?this._lineTo(e,r,!0):(o=this._prevPt,a=n,l=this._intersect(a,o),this._start=this._dist+s*(1-this._r),this._lineTo(l.x,l.y,!0),this._lineTo(a.x,a.y,!0));else if(this._prevIsIn)a=this._prevPt,o=n,l=this._intersect(a,o),this._lineTo(l.x,l.y,!0),this._lineTo(o.x,o.y,!1);else{const g=this._prevPt,y=n;if(g.x<=this._xmin&&y.x<=this._xmin||g.x>=this._xmax&&y.x>=this._xmax||g.y<=this._ymin&&y.y<=this._ymin||g.y>=this._ymax&&y.y>=this._ymax)this._lineTo(y.x,y.y,!1);else{const v=[];if((g.x<this._xmin&&y.x>this._xmin||g.x>this._xmin&&y.x<this._xmin)&&(c=(this._xmin-g.x)/(y.x-g.x),f=g.y+c*(y.y-g.y),f<=this._ymin?h=!1:f>=this._ymax?h=!0:v.push(new EF(c,this._xmin,f))),(g.x<this._xmax&&y.x>this._xmax||g.x>this._xmax&&y.x<this._xmax)&&(c=(this._xmax-g.x)/(y.x-g.x),f=g.y+c*(y.y-g.y),f<=this._ymin?h=!1:f>=this._ymax?h=!0:v.push(new EF(c,this._xmax,f))),(g.y<this._ymin&&y.y>this._ymin||g.y>this._ymin&&y.y<this._ymin)&&(c=(this._ymin-g.y)/(y.y-g.y),p=g.x+c*(y.x-g.x),p<=this._xmin?u=!1:p>=this._xmax?u=!0:v.push(new EF(c,p,this._ymin))),(g.y<this._ymax&&y.y>this._ymax||g.y>this._ymax&&y.y<this._ymax)&&(c=(this._ymax-g.y)/(y.y-g.y),p=g.x+c*(y.x-g.x),p<=this._xmin?u=!1:p>=this._xmax?u=!0:v.push(new EF(c,p,this._ymax))),v.length===0)u?h?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):h?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(v.length>1&&v[0].ratio>v[1].ratio)this._start=this._dist+s*v[1].ratio,this._lineTo(v[1].x,v[1].y,!0),this._lineTo(v[0].x,v[0].y,!0);else{this._start=this._dist+s*v[0].ratio;for(let b=0;b<v.length;b++)this._lineTo(v[b].x,v[b].y,!0)}this._lineTo(y.x,y.y,!1)}}this._dist+=s,this._prevIsIn=i,this._prevPt=n}close(){if(this._line.length>2){const e=this._firstPt,r=this._prevPt;e.x===r.x&&e.y===r.y||this.lineTo(e.x,e.y);const i=this._line;let n=i.length;for(;n>=4&&(i[0].x===i[1].x&&i[0].x===i[n-2].x||i[0].y===i[1].y&&i[0].y===i[n-2].y);)i.pop(),i[0].x=i[n-2].x,i[0].y=i[n-2].y,--n}}result(e=!0){return this._pushLine(),this._lines.length===0?null:(this._type===Sf.Polygon&&e&&y2t.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==Sf.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,r=e.length;if(r===0)return null;const i=[];for(let n=0;n<r;n++)i.push({line:e[n],start:this._starts[n]||0});return i}_isIn(e,r){return e>=this._xmin&&e<=this._xmax&&r>=this._ymin&&r<=this._ymax}_intersect(e,r){let i,n,s;if(r.x>=this._xmin&&r.x<=this._xmax)n=r.y<=this._ymin?this._ymin:this._ymax,s=(n-e.y)/(r.y-e.y),i=e.x+s*(r.x-e.x);else if(r.y>=this._ymin&&r.y<=this._ymax)i=r.x<=this._xmin?this._xmin:this._xmax,s=(i-e.x)/(r.x-e.x),n=e.y+s*(r.y-e.y);else{n=r.y<=this._ymin?this._ymin:this._ymax,i=r.x<=this._xmin?this._xmin:this._xmax;const o=(i-e.x)/(r.x-e.x),a=(n-e.y)/(r.y-e.y);o<a?(s=o,n=e.y+o*(r.y-e.y)):(s=a,i=e.x+a*(r.x-e.x))}return this._r=s,new Qa(i,n)}_pushLine(){this._line&&(this._type===Sf.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Sf.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Sf.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,r,i){this._type!==Sf.Polygon?i&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line.push(new Qa(e,r))):(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),r<this._ymin&&(r=this._ymin),r>this._ymax&&(r=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line.push(new Qa(e,r)),this._isH=!1,this._isV=!1)}_lineTo(e,r,i){let n,s;if(this._type!==Sf.Polygon)if(i){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(n=this._line[this._line.length-1],n.equals(e,r)))return;this._line.push(new Qa(e,r))}else this._line&&this._line.length>0&&this._pushLine();else if(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),r<this._ymin&&(r=this._ymin),r>this._ymax&&(r=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){n=this._line[this._line.length-1];const o=n.x===e,a=n.y===r;if(o&&a)return;this._isH&&o||this._isV&&a?(n.x=e,n.y=r,s=this._line[this._line.length-2],s.x===e&&s.y===r?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(s=this._line[this._line.length-2],this._isH=s.x===e,this._isV=s.y===r)):(this._isH=s.x===e,this._isV=s.y===r)):(this._line.push(new Qa(e,r)),this._isH=o,this._isV=a)}else this._line.push(new Qa(e,r))}},dir=class{setExtent(e){this._ratio=e===4096?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,r){this._line&&this._lines.push(this._line),this._line=[];const i=this._ratio;this._line.push(new Qa(e*i,r*i))}lineTo(e,r){const i=this._ratio;this._line.push(new Qa(e*i,r*i))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),this._lines.length===0?null:this._lines}};(function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"})(Pa||(Pa={}));let y2t=class X1{static simplify(e,r,i){if(!i)return;const n=-r,s=e+r,o=-r,a=e+r,l=[],c=[],u=i.length;for(let p=0;p<u;++p){const f=i[p];if(!f||f.length<2)continue;let g,y=f[0];const v=f.length;for(let b=1;b<v;++b)g=f[b],y.x===g.x&&(y.x<=n&&(y.y>g.y?(l.push(p),l.push(b),l.push(Pa.sideLeft),l.push(-1)):(c.push(p),c.push(b),c.push(Pa.sideLeft),c.push(-1))),y.x>=s&&(y.y<g.y?(l.push(p),l.push(b),l.push(Pa.sideRight),l.push(-1)):(c.push(p),c.push(b),c.push(Pa.sideRight),c.push(-1)))),y.y===g.y&&(y.y<=o&&(y.x<g.x?(l.push(p),l.push(b),l.push(Pa.sideTop),l.push(-1)):(c.push(p),c.push(b),c.push(Pa.sideTop),c.push(-1))),y.y>=a&&(y.x>g.x?(l.push(p),l.push(b),l.push(Pa.sideBottom),l.push(-1)):(c.push(p),c.push(b),c.push(Pa.sideBottom),c.push(-1)))),y=g}if(l.length===0||c.length===0)return;X1.fillParent(i,c,l),X1.fillParent(i,l,c);const h=[];X1.calcDeltas(h,c,l),X1.calcDeltas(h,l,c),X1.addDeltas(h,i)}static fillParent(e,r,i){const n=i.length,s=r.length;for(let o=0;o<s;o+=4){const a=r[o],l=r[o+1],c=r[o+2],u=e[a][l-1],h=e[a][l];let p=8092,f=-1;for(let g=0;g<n;g+=4){if(i[g+2]!==c)continue;const y=i[g],v=i[g+1],b=e[y][v-1],w=e[y][v];switch(c){case Pa.sideLeft:case Pa.sideRight:if(CF(u.y,b.y,w.y)&&CF(h.y,b.y,w.y)){const x=Math.abs(w.y-b.y);x<p&&(p=x,f=g)}break;case Pa.sideTop:case Pa.sideBottom:if(CF(u.x,b.x,w.x)&&CF(h.x,b.x,w.x)){const x=Math.abs(w.x-b.x);x<p&&(p=x,f=g)}}}r[o+3]=f}}static calcDeltas(e,r,i){const n=r.length;for(let s=0;s<n;s+=4){const o=[],a=X1.calcDelta(s,r,i,o);e.push(r[s]),e.push(r[s+1]),e.push(r[s+2]),e.push(a)}}static calcDelta(e,r,i,n){const s=r[e+3];if(s===-1)return 0;const o=n.length;return o>1&&n[o-2]===s?0:(n.push(s),X1.calcDelta(s,i,r,n)+1)}static addDeltas(e,r){const i=e.length;let n=0;for(let s=0;s<i;s+=4){const o=e[s+3];o>n&&(n=o)}for(let s=0;s<i;s+=4){const o=r[e[s]],a=e[s+1],l=n-e[s+3];switch(e[s+2]){case Pa.sideLeft:o[a-1].x-=l,o[a].x-=l,a===1&&(o[o.length-1].x-=l),a===o.length-1&&(o[0].x-=l);break;case Pa.sideRight:o[a-1].x+=l,o[a].x+=l,a===1&&(o[o.length-1].x+=l),a===o.length-1&&(o[0].x+=l);break;case Pa.sideTop:o[a-1].y-=l,o[a].y-=l,a===1&&(o[o.length-1].y-=l),a===o.length-1&&(o[0].y-=l);break;case Pa.sideBottom:o[a-1].y+=l,o[a].y+=l,a===1&&(o[o.length-1].y+=l),a===o.length-1&&(o[0].y+=l)}}}};const CF=(t,e,r)=>t>=e&&t<=r||t>=r&&t<=e,_2t=512;let Uy,v2t=class{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}};function Ble(t,e){Uy||(Uy=new g2t(0,0,0,1));const r=t.geometryType==="esriGeometryPolygon",i=r?Sf.Polygon:Sf.LineString,n=r?3:2;let s,o;for(Uy.reset(i),Uy.setPixelMargin(e+1),Uy.setExtent(_2t);t.nextPath();)if(!(t.pathSize<n)){for(t.nextPoint(),s=t.x,o=-t.y,Uy.moveTo(s,o);t.nextPoint();)s=t.x,o=-t.y,Uy.lineTo(s,o);r&&Uy.close()}const a=Uy.result(!1);if(a){const l=eo.createEmptyOptimizedCIM(t.geometryType);for(const c of a){l.startPath();for(const u of c)l.pushXY(u.x,-u.y)}return l.reset(),l}return null}let b2t=class{applyColorSubstituition(e,r){if(!r)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:n}=e,s=this._rasterizationCanvas,o=s.getContext("2d",{willReadFrequently:!0});e!==s&&(s.width=i,s.height=n,o.drawImage(e,0,0,i,n));const a=o.getImageData(0,0,i,n).data;if(r){for(const c of r)if(c&&c.oldColor&&c.oldColor.length===4&&c.newColor&&c.newColor.length===4){const[u,h,p,f]=c.oldColor,[g,y,v,b]=c.newColor;if(u===g&&h===y&&p===v&&f===b)continue;for(let w=0;w<a.length;w+=4)u===a[w]&&h===a[w+1]&&p===a[w+2]&&f===a[w+3]&&(a[w]=g,a[w+1]=y,a[w+2]=v,a[w+3]=b)}}const l=new ImageData(a,i,n);return o.putImageData(l,0,0),s}tintImageData(e,r){if(!r||r.length<4)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:n}=e,s=this._rasterizationCanvas,o=s.getContext("2d",{willReadFrequently:!0});e!==s&&(s.width=i,s.height=n,o.drawImage(e,0,0,i,n));const a=o.getImageData(0,0,i,n),l=new Uint8Array(a.data),c=[r[0]/255,r[1]/255,r[2]/255,r[3]/255];for(let h=0;h<l.length;h+=4)l[h]*=c[0],l[h+1]*=c[1],l[h+2]*=c[2],l[h+3]*=c[3];const u=new ImageData(new Uint8ClampedArray(l.buffer),i,n);return o.putImageData(u,0,0),s}},Bke=class n${static local(){return n$.instance===null&&(n$.instance=new n$),n$.instance}execute(e,r,i,n,s){return new w2t(e,r,i)}};Bke.instance=null;let w2t=class{constructor(e,r,i){this._inputGeometries=e,this._angleTolerance=r.angleTolerance!==void 0?r.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();for(;e;){if(e.geometryType==="esriGeometryPolygon")this._isClosed=!0;else if(e.geometryType==="esriGeometryPolyline")this._isClosed=!1;else{if(e.geometryType!=="esriGeometryEnvelope"){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const r=e.x,i=e.y;let n=r,s=i,o=e.pathSize,a=0,l=0,c=0,u=0,h=0,p=0;this._isClosed&&++o;for(let f=1;e.nextPoint()||f<o;++f){let g,y;this._isClosed&&f===o-1?(g=r,y=i):(g=e.x,y=e.y);const v=g-n,b=y-s,w=Math.sqrt(v*v+b*b);f>1&&w>0&&c>0&&(a*v+l*b)/w/c<=this._maxCosAngle&&e.setControlPointAt(f-1),f===1&&(u=v,h=b,p=w),w>0&&(n=g,s=y,a=v,l=b,c=w)}this._isClosed&&c>0&&p>0&&(a*u+l*h)/p/c<=this._maxCosAngle&&e.setControlPointAt(0)}}};function tW(t,e){t[4]=e}let HN=class{constructor(e,r=!0,i=!0,n=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!r&&e.geometryType==="esriGeometryPolygon"||!i&&e.geometryType==="esriGeometryPolyline"?null:e,this.geomUnitsPerPoint=n,this.iteratePath=!1,this.internalPlacement=new hO}next(){if(!this.geometryCursor)return null;for(;this.iteratePath||this.geometryCursor.pathIndex<this.geometryCursor.totalSize-1;){this.iteratePath||this.geometryCursor.nextPath();const e=this.processPath(this.geometryCursor);if(e)return e}return this.geometryCursor=null,null}},wG=class{constructor(e,r,i,n=0){this.isClosed=!1,this.inputGeometries=e,this.acceptPolygon=r,this.acceptPolyline=i,this.geomUnitsPerPoint=n,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&e.geometryType==="esriGeometryPolygon"||e.geometryType==="esriGeometryEnvelope",this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}};var rte,ite,z_e,V_e,Bg,B_e,nte,ste,ote,G_e,j_e,H_e,q_e,W_e,Y_e,ate,lte,X_e,Z_e,hP,Hr,AS,J_e,Q_e,k0,K_e,e1e,m3,cte,t1e,r1e,i1e,n1e,s1e,o1e,Zd,Xa,a1e,l1e,Gg,c1e,u1e,h1e,d1e,df,qI,OS,g3,p1e,f1e,m1e,g1e,y1e,_1e,v1e,X9,y3,b1e,ute,w1e,x1e;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(rte||(rte={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(ite||(ite={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(z_e||(z_e={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(V_e||(V_e={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(Bg||(Bg={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(B_e||(B_e={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(nte||(nte={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(ste||(ste={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(ote||(ote={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(G_e||(G_e={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(j_e||(j_e={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(H_e||(H_e={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(q_e||(q_e={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(W_e||(W_e={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(Y_e||(Y_e={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(ate||(ate={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(lte||(lte={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(X_e||(X_e={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(Z_e||(Z_e={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(hP||(hP={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees"}(Hr||(Hr={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(AS||(AS={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(J_e||(J_e={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(Q_e||(Q_e={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(k0||(k0={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(K_e||(K_e={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(e1e||(e1e={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(m3||(m3={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(cte||(cte={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(t1e||(t1e={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(r1e||(r1e={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(i1e||(i1e={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(n1e||(n1e={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(s1e||(s1e={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(o1e||(o1e={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(Zd||(Zd={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(Xa||(Xa={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(a1e||(a1e={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(l1e||(l1e={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(Gg||(Gg={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(c1e||(c1e={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(u1e||(u1e={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(h1e||(h1e={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(d1e||(d1e={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(df||(df={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(qI||(qI={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(OS||(OS={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(g3||(g3={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(p1e||(p1e={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(f1e||(f1e={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(m1e||(m1e={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(g1e||(g1e={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(y1e||(y1e={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(_1e||(_1e={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(v1e||(v1e={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(X9||(X9={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(y3||(y3={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(b1e||(b1e={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(ute||(ute={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(w1e||(w1e={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(x1e||(x1e={}));const AD=.03;let L_=class{constructor(e=0,r=!1){}isEmpty(e){if(!e.nextPoint())return!0;let r,i,n,s;for(r=e.x,i=e.y;e.nextPoint();r=i,i=s)if(n=e.x,s=e.y,n!==r||s!==i)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]);r!==0&&(e[0]/=r,e[1]/=r)}getLength(e,r,i,n){const s=i-e,o=n-r;return Math.sqrt(s*s+o*o)}getSegLength(e){const[[r,i],[n,s]]=e;return this.getLength(r,i,n,s)}getCoord2D(e,r,i,n,s){return[e+(i-e)*s,r+(n-r)*s]}getSegCoord2D(e,r){const[[i,n],[s,o]]=e;return this.getCoord2D(i,n,s,o,r)}getAngle(e,r,i,n,s){const o=i-e,a=n-r;return Math.atan2(a,o)}getAngleCS(e,r,i,n,s){const o=i-e,a=n-r,l=Math.sqrt(o*o+a*a);return l>0?[o/l,a/l]:[1,0]}getSegAngleCS(e,r){const[[i,n],[s,o]]=e;return this.getAngleCS(i,n,s,o,r)}cut(e,r,i,n,s,o){return[s<=0?[e,r]:this.getCoord2D(e,r,i,n,s),o>=1?[i,n]:this.getCoord2D(e,r,i,n,o)]}getSubCurve(e,r,i){const n=eo.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(n,e,r,i)?n:null}appendSubCurve(e,r,i,n){e.startPath(),r.seekPathStart();let s=0,o=!0;if(!r.nextPoint())return!1;let a=r.x,l=r.y;for(;r.nextPoint();){const c=this.getLength(a,l,r.x,r.y);if(c!==0){if(o){if(s+c>i){const u=(i-s)/c;let h=1,p=!1;s+c>=n&&(h=(n-s)/c,p=!0);const f=this.cut(a,l,r.x,r.y,u,h);if(f&&e.pushPoints(f),p)break;o=!1}}else{if(s+c>n){const u=this.cut(a,l,r.x,r.y,0,(n-s)/c);u&&e.pushPoint(u[1]);break}e.pushXY(r.x,r.y)}s+=c,a=r.x,l=r.y}else a=r.x,l=r.y}return!0}getCIMPointAlong(e,r){if(!e.nextPoint())return null;let i,n,s,o,a=0;for(i=e.x,n=e.y;e.nextPoint();i=s,n=o){s=e.x,o=e.y;const l=this.getLength(i,n,s,o);if(l!==0){if(a+l>r){const c=(r-a)/l;return this.getCoord2D(i,n,s,o,c)}a+=l}}return null}offset(e,r,i,n,s){if(!e||e.length<2)return null;let o=0,a=e[o++],l=o;for(;o<e.length;){const p=e[o];p[0]===a[0]&&p[1]===a[1]||(o!==l&&(e[l]=e[o]),a=e[l++]),o++}const c=e[0][0]===e[l-1][0]&&e[0][1]===e[l-1][1];if(c&&--l,l<(c?3:2))return null;const u=[];a=c?e[l-1]:null;let h=e[0];for(let p=0;p<l;p++){const f=p===l-1?c?e[0]:null:e[p+1];if(a)if(f){const g=[f[0]-h[0],f[1]-h[1]];this.normalize(g);const y=[h[0]-a[0],h[1]-a[1]];this.normalize(y);const v=y[0]*g[1]-y[1]*g[0],b=y[0]*g[0]+y[1]*g[1];if(v===0&&b===1){h=f;continue}if(v>=0==r<=0){if(b<1){const w=[g[0]-y[0],g[1]-y[1]];this.normalize(w);const x=Math.sqrt((1+b)/2);if(x>1/n){const S=-Math.abs(r)/x;u.push([h[0]-w[0]*S,h[1]-w[1]*S])}}}else switch(i){case k0.Mitered:{const w=Math.sqrt((1+b)/2);if(w>0&&1/w<n){const x=[g[0]-y[0],g[1]-y[1]];this.normalize(x);const S=Math.abs(r)/w;u.push([h[0]-x[0]*S,h[1]-x[1]*S]);break}}case k0.Bevelled:u.push([h[0]+y[1]*r,h[1]-y[0]*r]),u.push([h[0]+g[1]*r,h[1]-g[0]*r]);break;case k0.Rounded:if(b<1){u.push([h[0]+y[1]*r,h[1]-y[0]*r]);const w=Math.floor(2.5*(1-b));if(w>0){const x=1/w;let S=x;for(let E=1;E<w;E++,S+=x){const P=[y[1]*(1-S)+g[1]*S,-y[0]*(1-S)-g[0]*S];this.normalize(P),u.push([h[0]+P[0]*r,h[1]+P[1]*r])}}u.push([h[0]+g[1]*r,h[1]-g[0]*r])}break;case k0.Square:default:if(v<0)u.push([h[0]+(y[1]+y[0])*r,h[1]+(y[1]-y[0])*r]),u.push([h[0]+(g[1]-g[0])*r,h[1]-(g[0]+g[1])*r]);else{const w=Math.sqrt((1+Math.abs(b))/2),x=[g[0]-y[0],g[1]-y[1]];this.normalize(x);const S=r/w;u.push([h[0]-x[0]*S,h[1]-x[1]*S])}}}else{const g=[h[0]-a[0],h[1]-a[1]];this.normalize(g),u.push([h[0]+g[1]*r,h[1]-g[0]*r])}else{const g=[f[0]-h[0],f[1]-h[1]];this.normalize(g),u.push([h[0]+g[1]*r,h[1]-g[0]*r])}a=h,h=f}return u.length<(c?3:2)?null:(c&&u.push([u[0][0],u[0][1]]),u)}};const rW=1.7320508075688772,x2t=5,S2t=hP.OpenEnded;let Gke=class s${static local(){return s$.instance===null&&(s$.instance=new s$),s$.instance}execute(e,r,i,n,s){return new T2t(e,r,i)}};Gke.instance=null;let T2t=class extends wG{constructor(e,r,i){super(e,!1,!0),this._curveHelper=new L_,this._width=(r.width!==void 0?r.width:x2t)*i,this._arrowType=r.geometricEffectArrowType!==void 0?r.geometricEffectArrowType:r.arrowType!==void 0?r.arrowType:S2t,this._offsetFlattenError=AD*i}processPath(e){const r=eo.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case hP.OpenEnded:default:this._constructSimpleArrow(r,e,!0);break;case hP.Block:this._constructSimpleArrow(r,e,!1);break;case hP.Crossed:this._constructCrossedArrow(r,e)}return r}_constructSimpleArrow(e,r,i){const n=r.pathLength();let s=this._width;n<2*s&&(s=n/2);const o=this._curveHelper.getSubCurve(r,0,n-s);if(!o||!o.nextPath())return;o.seekPathStart();const a=s/2;if(this._curveHelper.isEmpty(o))return;const l=ob(o),c=this._constructOffset(l,-a);if(!c)return;const u=this._constructOffset(l,a);if(!u)return;const h=this._constructArrowBasePoint(c,-a/2);if(!h)return;const p=this._constructArrowBasePoint(u,a/2);if(!p)return;r.seekInPath(r.pathSize-1);const f=[r.x,r.y];e.pushPath(u),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(p),e.nextPoint(),e.setControlPoint(),e.pushPoint(f),e.nextPoint(),e.setControlPoint(),e.pushPoint(h),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),i||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(u[0])),e.reset()}_constructCrossedArrow(e,r){const i=r.pathLength();let n=this._width;i<n*(1+rW+1)&&(n=i/(1+rW+1)),r.seekPathStart();const s=this._curveHelper.getSubCurve(r,0,i-n*(1+rW));if(!s)return;s.nextPath();const o=n/2;if(this._curveHelper.isEmpty(s))return;const a=ob(s),l=this._constructOffset(a,o);if(!l)return;const c=this._constructOffset(a,-o);if(!c)return;const u=this._curveHelper.getSubCurve(r,0,i-n);if(!u||(u.nextPath(),this._curveHelper.isEmpty(u)))return;const h=ob(u),p=this._constructOffset(h,o);if(!p)return;const f=this._constructOffset(h,-o);if(!f)return;const g=p[p.length-1],y=this._constructArrowBasePoint(p,o/2);if(!y)return;const v=f[f.length-1],b=this._constructArrowBasePoint(f,-o/2);if(!b)return;r.seekInPath(r.pathSize-1);const w=[r.x,r.y];e.pushPath(l),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(v),e.nextPoint(),e.setControlPoint(),e.pushPoint(b),e.nextPoint(),e.setControlPoint(),e.pushPoint(w),e.nextPoint(),e.setControlPoint(),e.pushPoint(y),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,r){return this._curveHelper.offset(e,r,k0.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(e,r){if(!e||e.length<2)return null;const i=e[e.length-2],n=e[e.length-1],s=[n[0]-i[0],n[1]-i[1]];return this._curveHelper.normalize(s),[n[0]+s[1]*r,n[1]-s[0]*r]}},jke=class o${static local(){return o$.instance===null&&(o$.instance=new o$),o$.instance}execute(e,r,i,n,s,o){return new E2t(e,r,i,n,s,o)}};jke.instance=null;let E2t=class{constructor(e,r,i,n,s,o){this._inputGeometries=e,this._tileKey=n,this._geometryEngine=s,this._curveHelper=new L_,this._size=(r.size!==void 0?r.size:1)*i,this._maxInflateSize=o*i,this._offsetFlattenError=AD*i}next(){let e;for(;e=this._inputGeometries.next();){if(this._size===0)return e;if(e.geometryType==="esriGeometryEnvelope"){if(this._size>0){const s=eo.createEmptyOptimizedCIM(e.geometryType),o=PB(e)[0],a=this._curveHelper.offset(o,this._size,k0.Rounded,4,this._offsetFlattenError);if(a)return s.pushPath(a),s}else if(this._size<0){const s=e.asJSON();if(Math.min(s.xmax-s.xmin,s.ymax-s.ymin)+2*this._size>0)return eo.fromJSONCIM({xmin:s.xmin-this._size,xmax:s.xmax+this._size,ymin:s.ymin-this._size,ymax:s.ymax+this._size})}}const r=this._geometryEngine;if(r==null)return null;const i=this._tileKey?Ble(e,this._maxInflateSize):e;if(!i)continue;const n=r.buffer(Ve.WebMercator,i.asJSON(),this._size,1);return n?eo.fromJSONCIM(n):null}return null}},Hke=class a${static local(){return a$.instance===null&&(a$.instance=new a$),a$.instance}execute(e,r,i,n,s){return new C2t(e,r,i)}};Hke.instance=null;let C2t=class{constructor(e,r,i){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=i,this._rule=r.rule??Hr.FullGeometry,this._defaultSize=this._defaultPointSize*i}next(){let e;for(;e=this._inputGeometries.next();){const r=this._processGeom(PB(e));if(r&&r.length)return eo.fromJSONCIM({paths:r})}return null}_clone(e){return[e[0],e[1]]}_mid(e,r){return[(e[0]+r[0])/2,(e[1]+r[1])/2]}_mix(e,r,i,n){return[e[0]*r+i[0]*n,e[1]*r+i[1]*n]}_add(e,r){return[e[0]+r[0],e[1]+r[1]]}_add2(e,r,i){return[e[0]+r,e[1]+i]}_sub(e,r){return[e[0]-r[0],e[1]-r[1]]}_dist(e,r){return Math.sqrt((e[0]-r[0])*(e[0]-r[0])+(e[1]-r[1])*(e[1]-r[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,r=1){const i=r/this._norm(e);e[0]*=i,e[1]*=i}_leftPerpendicular(e){const r=-e[1],i=e[0];e[0]=r,e[1]=i}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const r=e[1],i=-e[0];e[0]=r,e[1]=i}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,r){return e[0]*r[0]+e[1]*r[1]}_crossProduct(e,r){return e[0]*r[1]-e[1]*r[0]}_rotateDirect(e,r,i){const n=e[0]*r-e[1]*i,s=e[0]*i+e[1]*r;e[0]=n,e[1]=s}_makeCtrlPt(e){const r=[e[0],e[1]];return tW(r,1),r}_addAngledTicks(e,r,i,n){const s=this._sub(i,r);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));let a;a=o>0?this._rightPerp(s):this._leftPerp(s);const l=Math.abs(o)/2,c=[];c.push([r[0]+(a[0]-s[0])*l,r[1]+(a[1]-s[1])*l]),c.push(r),c.push(i),c.push([i[0]+(a[0]+s[0])*l,i[1]+(a[1]+s[1])*l]),e.push(c)}_addBezier2(e,r,i,n,s){if(s--==0)return void e.push(n);const o=this._mid(r,i),a=this._mid(i,n),l=this._mid(o,a);this._addBezier2(e,r,o,l,s),this._addBezier2(e,l,a,n,s)}_addBezier3(e,r,i,n,s,o){if(o--==0)return void e.push(s);const a=this._mid(r,i),l=this._mid(i,n),c=this._mid(n,s),u=this._mid(a,l),h=this._mid(l,c),p=this._mid(u,h);this._addBezier3(e,r,a,u,p,o),this._addBezier3(e,p,h,c,s,o)}_add90DegArc(e,r,i,n,s){const o=s??this._crossProduct(this._sub(i,r),this._sub(n,r))>0,a=this._mid(r,i),l=this._sub(a,r);o?this._leftPerpendicular(l):this._rightPerpendicular(l),a[0]+=l[0],a[1]+=l[1],this._addBezier3(e,r,this._mix(r,.33333,a,.66667),this._mix(i,.33333,a,.66667),i,4)}_addArrow(e,r,i){const n=r[0],s=r[1],o=r[r.length-1],a=this._sub(n,s);this._normalize(a);const l=this._crossProduct(a,this._sub(o,s)),c=.5*l,u=this._leftPerp(a),h=[o[0]-u[0]*l,o[1]-u[1]*l],p=r.length-1,f=[];f.push(i?[-u[0],-u[1]]:u);let g=[-a[0],-a[1]];for(let y=1;y<p-1;y++){const v=this._sub(r[y+1],r[y]);this._normalize(v);const b=this._dotProduct(v,g),w=this._crossProduct(v,g),x=Math.sqrt((1+b)/2),S=this._sub(v,g);this._normalize(S),S[0]/=x,S[1]/=x,f.push(w<0?[-S[0],-S[1]]:S),g=v}f.push(this._rightPerp(g));for(let y=f.length-1;y>0;y--)e.push([r[y][0]+f[y][0]*c,r[y][1]+f[y][1]*c]);e.push([h[0]+f[0][0]*c,h[1]+f[0][1]*c]),e.push([h[0]+f[0][0]*l,h[1]+f[0][1]*l]),e.push(n),e.push([h[0]-f[0][0]*l,h[1]-f[0][1]*l]),e.push([h[0]-f[0][0]*c,h[1]-f[0][1]*c]);for(let y=1;y<f.length;y++)e.push([r[y][0]-f[y][0]*c,r[y][1]-f[y][1]*c])}_cp2(e,r,i){return e.length>=2?e[1]:this._add2(e[0],r*this._defaultSize,i*this._defaultSize)}_cp3(e,r,i,n){if(e.length>=3)return e[2];const s=this._mix(e[0],1-i,r,i),o=this._sub(r,e[0]);return this._normalize(o),this._rightPerpendicular(o),[s[0]+o[0]*n*this._defaultSize,s[1]+o[1]*n*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const r=e[0],i=this._cp2(e,-4,0),n=this._sub(r,i);this._normalize(n);const s=this._rightPerp(n);return[r,i,[r[0]+(s[0]-n[0])*this._defaultSize,r[1]+(s[1]-n[1])*this._defaultSize]]}_arrowLastSeg(e){const r=e[0],i=this._cp2(e,-4,0);let n;if(e.length>=3)n=e[e.length-1];else{const s=this._sub(r,i);this._normalize(s);const o=this._rightPerp(s);n=[r[0]+(o[0]-s[0])*this._defaultSize,r[1]+(o[1]-s[1])*this._defaultSize]}return[i,n]}_processGeom(e){if(!e)return null;const r=[];for(const i of e){if(!i||i.length===0)continue;const n=i.length;let s=i[0];switch(this._rule){case Hr.PerpendicularFromFirstSegment:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,4),l=[];l.push(a),l.push(this._mid(s,o)),r.push(l);break}case Hr.ReversedFirstSegment:{const o=this._cp2(i,0,-1);r.push([o,s]);break}case Hr.PerpendicularToSecondSegment:{const o=this._cp2(i,-4,1),a=this._cp3(i,o,.882353,-1.94),l=[];l.push(this._mid(o,a)),l.push(s),r.push(l);break}case Hr.SecondSegmentWithTicks:{const o=this._cp2(i,-4,1),a=this._cp3(i,o,.882353,-1.94),l=this._sub(a,o);let c;c=this._crossProduct(l,this._sub(s,o))>0?this._rightPerp(c):this._leftPerp(l);const u=[];u.push([o[0]+(c[0]-l[0])/3,o[1]+(c[1]-l[1])/3]),u.push(o),u.push(a),u.push([a[0]+(c[0]+l[0])/3,a[1]+(c[1]+l[1])/3]),r.push(u);break}case Hr.DoublePerpendicular:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,3),l=this._mid(s,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(s,a));this._leftPerpendicular(c);const h=[];h.push(s),h.push([a[0]+c[0]*u,a[1]+c[1]*u]),r.push(h);const p=[];p.push([a[0]-c[0]*u,a[1]-c[1]*u]),p.push(o),r.push(p);break}case Hr.OppositeToFirstSegment:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,3),l=this._mid(s,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(s,a));this._leftPerpendicular(c);const h=[];h.push([a[0]+c[0]*u,a[1]+c[1]*u]),h.push([a[0]-c[0]*u,a[1]-c[1]*u]),r.push(h);break}case Hr.TriplePerpendicular:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,4),l=this._mid(s,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(s,a));this._leftPerpendicular(c);const h=[];h.push([a[0]+c[0]*u*.8,a[1]+c[1]*u*.8]),h.push([l[0]+.8*(s[0]-l[0]),l[1]+.8*(s[1]-l[1])]),r.push(h),r.push([a,l]);const p=[];p.push([a[0]-c[0]*u*.8,a[1]-c[1]*u*.8]),p.push([l[0]+.8*(o[0]-l[0]),l[1]+.8*(o[1]-l[1])]),r.push(p);break}case Hr.HalfCircleFirstSegment:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,4),l=this._mid(s,o);let c=this._sub(o,s);const u=Math.cos(Math.PI/18),h=Math.sin(Math.PI/18),p=Math.sqrt((1+u)/2),f=Math.sqrt((1-u)/2),g=[];let y;this._crossProduct(c,this._sub(a,s))>0?(g.push(s),c=this._sub(s,l),y=o):(g.push(o),c=this._sub(o,l),y=s),this._rotateDirect(c,p,f),c[0]/=p,c[1]/=p;for(let v=1;v<=18;v++)g.push(this._add(l,c)),this._rotateDirect(c,u,h);g.push(y),r.push(g);break}case Hr.HalfCircleSecondSegment:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,1,-1);let l=this._sub(s,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,o))/2;this._leftPerpendicular(l);const u=[o[0]+l[0]*c,o[1]+l[1]*c];l=this._sub(o,u);const h=Math.cos(Math.PI/18);let p=Math.sin(Math.PI/18);c>0&&(p=-p);const f=[o];for(let g=1;g<=18;g++)this._rotateDirect(l,h,p),f.push(this._add(u,l));r.push(f);break}case Hr.HalfCircleExtended:{const o=this._cp2(i,0,-2),a=this._cp3(i,o,1,-1);let l;if(n>=4)l=i[3];else{const g=this._sub(s,o);l=this._add(a,g)}const c=this._dist(o,a)/2/.75,u=this._sub(o,s);this._normalize(u,c);const h=this._sub(a,l);this._normalize(h,c);const p=[l,a];r.push(p);const f=[this._clone(a)];this._addBezier3(f,a,this._add(a,h),this._add(o,u),o,4),f.push(s),r.push(f);break}case Hr.OpenCircle:{const o=this._cp2(i,-2,0),a=this._sub(o,s),l=Math.cos(Math.PI/18),c=-Math.sin(Math.PI/18),u=[o];for(let h=1;h<=33;h++)this._rotateDirect(a,l,c),u.push(this._add(s,a));r.push(u);break}case Hr.CoverageEdgesWithTicks:{const o=this._cp2(i,0,-1);let a,l;if(n>=3)a=i[2];else{const p=this._sub(o,s),f=this._leftPerp(p);a=[s[0]+f[0]-.25*p[0],s[1]+f[1]-.25*p[1]]}if(n>=4)l=i[3];else{const p=this._mid(s,o),f=this._sub(s,o);this._normalize(f),this._leftPerpendicular(f);const g=this._crossProduct(f,this._sub(a,p));this._rightPerpendicular(f),l=[a[0]+f[0]*g*2,a[1]+f[1]*g*2]}const c=this._sub(o,s);let u,h;u=this._crossProduct(c,this._sub(a,s))>0?this._rightPerp(c):this._leftPerp(c),h=[],h.push(a),h.push(s),h.push([s[0]+(u[0]-c[0])/3,s[1]+(u[1]-c[1])/3]),r.push(h),u=this._crossProduct(c,this._sub(l,o))>0?this._rightPerp(u):this._leftPerp(c),h=[],h.push([o[0]+(u[0]+c[0])/3,o[1]+(u[1]+c[1])/3]),h.push(o),h.push(l),r.push(h);break}case Hr.GapExtentWithDoubleTicks:{const o=this._cp2(i,0,2),a=this._cp3(i,o,0,1);let l;if(n>=4)l=i[3];else{const c=this._sub(o,s);l=this._add(a,c)}this._addAngledTicks(r,s,o,this._mid(a,l)),this._addAngledTicks(r,a,l,this._mid(s,o));break}case Hr.GapExtentMidline:{const o=this._cp2(i,2,0),a=this._cp3(i,o,0,1);let l;if(n>=4)l=i[3];else{const u=this._sub(o,s);l=this._add(a,u)}const c=[];c.push(this._mid(s,a)),c.push(this._mid(o,l)),r.push(c);break}case Hr.Chevron:{const o=this._cp2(i,-1,-1);let a;if(n>=3)a=i[2];else{const l=this._sub(o,s);this._leftPerpendicular(l),a=this._add(s,l)}r.push([o,this._makeCtrlPt(s),a]);break}case Hr.PerpendicularWithArc:{const o=this._cp2(i,0,-2),a=this._cp3(i,o,.5,-1);let l=this._sub(o,s);const c=this._norm(l);l[0]/=c,l[1]/=c;const u=this._crossProduct(l,this._sub(a,s));let h=this._dotProduct(l,this._sub(a,s));h<.05*c?h=.05*c:h>.95*c&&(h=.95*c);const p=[s[0]+l[0]*h,s[1]+l[1]*h];this._leftPerpendicular(l);let f=[];f.push([p[0]-l[0]*u,p[1]-l[1]*u]),f.push([p[0]+l[0]*u,p[1]+l[1]*u]),r.push(f);const g=[o[0]+l[0]*u,o[1]+l[1]*u];l=this._sub(o,g);const y=Math.cos(Math.PI/18);let v=Math.sin(Math.PI/18);u<0&&(v=-v),f=[s,o];for(let b=1;b<=9;b++)this._rotateDirect(l,y,v),f.push(this._add(g,l));r.push(f);break}case Hr.ClosedHalfCircle:{const o=this._cp2(i,2,0),a=this._mid(s,o),l=this._sub(o,a),c=Math.cos(Math.PI/18),u=Math.sin(Math.PI/18),h=[s,o];for(let p=1;p<=18;p++)this._rotateDirect(l,c,u),h.push(this._add(a,l));r.push(h);break}case Hr.TripleParallelExtended:{const o=this._cp2(i,0,-2),a=this._cp3(i,o,1,-2),l=this._mid(s,o),c=this._sub(a,o);this._normalize(c);const u=Math.abs(this._crossProduct(c,this._sub(l,o)))/2,h=this._dist(o,a),p=[o,s];p.push([s[0]+c[0]*h*.5,s[1]+c[1]*h*.5]),r.push(p);const f=[];f.push([l[0]-c[0]*u,l[1]-c[1]*u]),f.push([l[0]+c[0]*h*.375,l[1]+c[1]*h*.375]),tW(f[f.length-1],1),f.push([l[0]+c[0]*h*.75,l[1]+c[1]*h*.75]),r.push(f);const g=[o,a];r.push(g);break}case Hr.ParallelWithTicks:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._sub(a,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,s));this._leftPerpendicular(l),this._addAngledTicks(r,s,o,a),this._addAngledTicks(r,this._mix(s,1,l,c),this._mix(o,1,l,c),this._mid(s,o));break}case Hr.Parallel:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._sub(o,s);this._normalize(l);const c=this._leftPerp(l),u=this._crossProduct(l,this._sub(a,s));let h=[s,o];r.push(h),h=[],h.push([s[0]+c[0]*u,s[1]+c[1]*u]),h.push([o[0]+c[0]*u,o[1]+c[1]*u]),r.push(h);break}case Hr.PerpendicularToFirstSegment:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._mid(s,o),c=this._sub(o,s);this._normalize(c);const u=this._crossProduct(c,this._sub(a,s));this._leftPerpendicular(c);const h=[];h.push([l[0]-c[0]*u*.25,l[1]-c[1]*u*.25]),h.push([l[0]+c[0]*u*1.25,l[1]+c[1]*u*1.25]),r.push(h);break}case Hr.ParallelOffset:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._sub(o,s);this._normalize(l);const c=this._crossProduct(l,this._sub(a,s));this._leftPerpendicular(l);const u=[];u.push([s[0]-l[0]*c,s[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),r.push(u);const h=[];h.push([s[0]+l[0]*c,s[1]+l[1]*c]),h.push([o[0]+l[0]*c,o[1]+l[1]*c]),r.push(h);break}case Hr.OffsetOpposite:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._sub(o,s);this._normalize(l);const c=this._crossProduct(l,this._sub(a,s));this._leftPerpendicular(l);const u=[];u.push([s[0]-l[0]*c,s[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),r.push(u);break}case Hr.OffsetSame:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._sub(o,s);this._normalize(l);const c=this._crossProduct(l,this._sub(a,s));this._leftPerpendicular(l);const u=[];u.push([s[0]+l[0]*c,s[1]+l[1]*c]),u.push([o[0]+l[0]*c,o[1]+l[1]*c]),r.push(u);break}case Hr.CircleWithArc:{let o=this._cp2(i,3,0);const a=this._cp3(i,o,.5,-1);let l,c;if(n>=4)l=i[3],c=this._crossProduct(this._sub(l,o),this._sub(a,o))>0;else{l=o,c=this._crossProduct(this._sub(l,s),this._sub(a,s))>0;const g=24*this._geomUnitsPerPoint,y=this._sub(l,s);this._normalize(y,g);const v=Math.sqrt(2)/2;this._rotateDirect(y,v,c?v:-v),o=this._add(s,y)}const u=this._sub(o,s),h=Math.cos(Math.PI/18),p=Math.sin(Math.PI/18),f=[o];for(let g=1;g<=36;g++)this._rotateDirect(u,h,p),f.push(this._add(s,u));this._add90DegArc(f,o,l,a,c),tW(f[f.length-8],1),r.push(f);break}case Hr.DoubleJog:{let o,a,l=this._cp2(i,-3,1);if(o=n>=3?i[2]:this._add(s,this._sub(s,l)),n>=4)a=i[3];else{const b=s;s=l,a=o;const w=this._dist(s,b),x=this._dist(a,b);let S=30*this._geomUnitsPerPoint;.5*w<S&&(S=.5*w),.5*x<S&&(S=.5*x),l=this._mix(s,S/w,b,(w-S)/w),o=this._mix(a,S/x,b,(x-S)/x)}const c=this._mid(s,l),u=this._mid(a,o),h=this._dist(s,l),p=this._dist(o,a);let f=Math.min(h,p)/8;f=Math.min(f,24*this._geomUnitsPerPoint);const g=Math.cos(Math.PI/4);let y=this._sub(s,l);this._normalize(y,f),this._crossProduct(y,this._sub(a,l))>0?this._rotateDirect(y,g,-g):this._rotateDirect(y,g,g);let v=[];v.push(l),v.push(this._add(c,y)),v.push(this._sub(c,y)),v.push(s),r.push(v),y=this._sub(a,o),this._normalize(y,f),this._crossProduct(y,this._sub(s,o))<0?this._rotateDirect(y,g,g):this._rotateDirect(y,g,-g),v=[],v.push(o),v.push(this._add(u,y)),v.push(this._sub(u,y)),v.push(a),r.push(v);break}case Hr.PerpendicularOffset:{const o=this._cp2(i,-4,1),a=this._cp3(i,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(s,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c);r.push([u,s]);break}case Hr.LineExcludingLastSegment:{const o=this._arrowPath(i),a=[];let l=o.length-2;for(;l--;)a.push(o[l]);r.push(a);break}case Hr.MultivertexArrow:{const o=this._arrowPath(i),a=[];this._addArrow(a,o,!1),r.push(a);break}case Hr.CrossedArrow:{const o=this._arrowPath(i),a=[];this._addArrow(a,o,!0),r.push(a);break}case Hr.ChevronArrow:{const[o,a]=this._arrowLastSeg(i),l=10*this._geomUnitsPerPoint,c=this._sub(s,o);this._normalize(c);const u=this._crossProduct(c,this._sub(a,o)),h=this._leftPerp(c),p=[a[0]-h[0]*u*2,a[1]-h[1]*u*2],f=[];f.push([a[0]+c[0]*l,a[1]+c[1]*l]),f.push(s),f.push([p[0]+c[0]*l,p[1]+c[1]*l]),r.push(f);break}case Hr.ChevronArrowOffset:{const[o,a]=this._arrowLastSeg(i),l=this._sub(s,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,o));this._leftPerpendicular(l);const u=[a[0]-l[0]*c,a[1]-l[1]*c],h=[];h.push([u[0]+l[0]*c*.5,u[1]+l[1]*c*.5]),h.push(this._mid(u,s)),h.push([u[0]-l[0]*c*.5,u[1]-l[1]*c*.5]),r.push(h);break}case Hr.PartialFirstSegment:{const[o,a]=this._arrowLastSeg(i),l=this._sub(s,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,o));this._leftPerpendicular(l);const u=[a[0]-l[0]*c,a[1]-l[1]*c];r.push([o,u]);break}case Hr.Arch:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,1),l=this._sub(s,o),c=this._mix(a,1,l,.55),u=this._mix(a,1,l,-.55),h=[s];this._addBezier2(h,s,c,a,4),this._addBezier2(h,a,u,o,4),r.push(h);break}case Hr.CurvedParallelTicks:{const o=this._cp2(i,-4,1),a=this._cp3(i,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(s,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c),h=this._sub(this._mix(o,.75,a,.25),c),p=this._sub(this._mix(o,.25,a,.75),c),f=[o];this._addBezier2(f,o,h,u,3),this._addBezier2(f,u,p,a,3),r.push(f);for(let g=0;g<8;g++){const y=f[2*g+1],v=[this._clone(y)];v.push(this._add(y,[l[0]/4,l[1]/4])),r.push(v)}break}case Hr.Arc90Degrees:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,1),l=[o];this._add90DegArc(l,o,s,a),r.push(l);break}case Hr.FullGeometry:default:r.push(i)}}return r}},qke=class l${static local(){return l$.instance===null&&(l$.instance=new l$),l$.instance}execute(e,r,i,n,s){return new P2t(e,r,i)}};qke.instance=null;let P2t=class extends wG{constructor(e,r,i){super(e,!0,!0),this._curveHelper=new L_,this._beginCut=(r.beginCut!==void 0?r.beginCut:1)*i,this._endCut=(r.endCut!==void 0?r.endCut:1)*i,this._middleCut=(r.middleCut!==void 0?r.middleCut:0)*i,this._invert=r.invert!==void 0&&r.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:r,_endCut:i,_middleCut:n}=this,s=e.pathLength(),o=eo.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(r!==0||i!==0||n!==0)if(r+i+n>=s)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,r),this._curveHelper.appendSubCurve(o,e,.5*(s-n),.5*(s+n)),this._curveHelper.appendSubCurve(o,e,s-i,i)}else if(r===0&&i===0&&n===0)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else r+i+n<s&&(n===0?this._curveHelper.appendSubCurve(o,e,r,s-i):(this._curveHelper.appendSubCurve(o,e,r,.5*(s-n)),this._curveHelper.appendSubCurve(o,e,.5*(s+n),s-i)));return o.totalSize===0?null:o}};const S1e=1e-7;let xG=class{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return this._values.length===0}size(){return this._values.length}init(e,r,i=!0){if(this._setEmpty(),!e||e.length===0)return!1;for(let n=0;n<e.length;n++){let s=Math.abs(e[n]);i&&s<S1e&&(s=S1e),this._values.push(s),this._length+=s}return r&&1&e.length&&(this._length*=2),this._length!==0&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const r=this._values?this._values.length:0;for(let i=0;i<r;++i)this._values[i]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}},b0=class{constructor(){this.pt=null,this.ca=0,this.sa=0}};var Ov;(function(t){t[t.FAIL=0]="FAIL",t[t.END=1]="END",t[t.CONTINUE=2]="CONTINUE"})(Ov||(Ov={}));let PF=class{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return this.segment!==null}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}},SG=class extends L_{constructor(e=0,r=!1){super(e,r),this._tolerance=AD,this._currentPosition=new PF}updateTolerance(e){this._tolerance=AD*e}init(e,r,i=!0){return i?(this._patternLength=r.length(),this._partExtPtGap=r.extPtGap,this._partCtrlPtGap=r.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,r=Ov.FAIL){const i=new PF;return!!this._nextPosition(e,i,null,r)&&(i.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[r,i]=this._getAngleCS(this._currentPosition);e.ca=r,e.sa=i}nextPointAndAngle(e,r,i=Ov.FAIL){const n=new PF;if(!this._nextPosition(e,n,null,i))return!1;n.copyTo(this._currentPosition),r.pt=this._getPoint(n);const[s,o]=this._getAngleCS(n);return r.ca=s,r.sa=o,!0}nextCurve(e){if(e===0)return null;const r=eo.createEmptyOptimizedCIM("esriGeometryPolyline");r.startPath(),r.nextPath();const i=new PF;return this._nextPosition(e,i,r,Ov.END)?(i.copyTo(this._currentPosition),r):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,r,i,n){if(this._currentPosition.isPathEnd)return!1;let s=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(s/=this._currentPosition.segmentLength),this._currentPosition.copyTo(r);r.abscissa+e*this._partLengthRatio>r.segmentLength+this._tolerance;){if(i){if(i.pathSize===0)if(s===0){const a=r.segment[0];i.pushXY(a[0],a[1])}else i.pushPoint(this.getSegCoord2D(r.segment,s));const o=r.segment[1];i.pushXY(o[0],o[1])}if(s=0,e-=(r.segmentLength-r.abscissa)/this._partLengthRatio,this._partSegCount)r.segment=this._nextSegment(),r.segmentLength=this.getSegLength(r.segment),r.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return n!==Ov.FAIL&&(r.segmentLength=this.getSegLength(r.segment),r.isPartEnd=!0,n===Ov.END?(r.abscissa=r.segmentLength,r.isPathEnd=!0):r.abscissa=r.segmentLength+e,!0);this._currentPosition.copyTo(r)}}if(r.abscissa+=e*this._partLengthRatio,i){i.pathSize===0&&(s===0?i.pushPoint(r.segment[0]):i.pushPoint(this.getSegCoord2D(r.segment,s)));const o=r.abscissa/r.segmentLength;o===1?i.pushPoint(r.segment[1]):i.pushPoint(this.getSegCoord2D(r.segment,o))}return this._partSegCount||Math.abs(r.abscissa-r.segmentLength)<this._tolerance&&(r.isPathEnd=this._partIsLast,r.isPartEnd=!0),!0}_getPoint(e){const r=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,r)}_getAngleCS(e){const r=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,r)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const r=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(r);let i=r+this._partSegCount+1;if(i>=this._pathCursor.pathSize&&(i=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(i),this._patternLength>0){const n=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,s=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let o=Math.round((this._partLength-(n+s))/this._patternLength);o<=0&&(o=n+s>0?0:1),this._partLengthRatio=this._partLength/(n+s+o*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}};const _3={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetX:0,offsetY:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0}};function A2t(t){return typeof t=="function"}function O2t(t,e,r,i){return A2t(t)?t(e,r,i):t}const M2t=` /-,
`;function T1e(t){let e=t.length;for(;e--;)if(!M2t.includes(t.charAt(e)))return!1;return!0}function R2t(t,e){const r=[];let i=0,n=-1;do if(n=t.indexOf("[",i),n>=i){if(n>i){const s=t.substr(i,n-i);r.push([s,null,T1e(s)])}if(i=n+1,n=t.indexOf("]",i),n>=i){if(n>i){const s=e[t.substr(i,n-i)];s&&r.push([null,s,!1])}i=n+1}}while(n!==-1);if(i<t.length-1){const s=t.substr(i);r.push([s,null,T1e(s)])}return r}function $2t(t,e,r,i){let n="",s=null;for(const o of e){const[a,l,c]=o;if(a)c?s=a:(s&&(n+=s,s=null),n+=a);else{let u=l;r!=null&&(u=Jke(l,r));const h=t.attributes[u];h&&(s&&(n+=s,s=null),n+=h)}}return I2t(n,i)}function I2t(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function L2t(t){return t?[t[0],t[1],t[2],t[3]/255]:[0,0,0,0]}function D2t(t){var e;return((e=t.data)==null?void 0:e.symbol)??null}function N2t(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function F2t(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function Wke(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const Ar=(t,e=0)=>t==null||isNaN(t)?e:t,k2t=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function U2t(){return re(()=>import("./geometryEngineJSON-CtI8zAu5.js").then(t=>t.g),__vite__mapDeps([13,14,15]))}function z2t(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function V2t(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function Yke(t){let e="normal",r="normal";if(t){const i=t.toLowerCase();i.includes("italic")?e="italic":i.includes("oblique")&&(e="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:e,weight:r}}function Xke(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function WI(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=WI(e);if(r!=null)return r}break;case"CIMTextSymbol":return WI(t.symbol);case"CIMSolidFill":return t.color}return null}function hte(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const r of e){const i=hte(r);if(i!=null)return i}break}case"CIMTextSymbol":return hte(t.symbol);case"CIMSolidStroke":return t.color}}function dte(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=dte(e);if(r!==void 0)return r}break;case"CIMTextSymbol":return dte(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function B2t(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function G2t(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function j2t(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const bE=t=>t.includes("data:image/svg+xml");function Air(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function E1e(t){return t&&t.charAt(0).toLowerCase()+t.substring(1)}function Oir(t,e,r,i,n,s){const{infos:o}=s;let a=1,l=0,c=0,u=0;for(const{offsetX:f,offsetY:g,rotation:y,size:v,frameHeight:b,rotateClockWise:w}of o)c=P1e(f,g,l,a,c),u=C1e(f,g,l,a,u),b&&(a*=v/b),l=A1e(y,w,l);const h=P1e(i,n,l,a,c),p=C1e(i,n,l,a,u);return{size:t*a,rotation:A1e(e,r,l),offsetX:h,offsetY:p}}function Zke(t){return t!=null&&t.dashTemplate&&typeof t.dashTemplate=="string"&&(t.dashTemplate=t.dashTemplate.split(" ").map(Number)),t}function pte(t){if(t==null)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const e=t.symbolLayers;if(!e)return"Normal";for(const r of e)if(r.type==="CIMVectorMarker")return pte(r)}break;case"CIMVectorMarker":{const e=t.markerGraphics;if(!e)return"Normal";for(const r of e)if(r.symbol)return pte(r.symbol)}}return"Normal"}function Jke(t,e){if(e!==null){const r=e.get(t);return r?r.name:t}return t}function C1e(t,e,r,i,n){const s=r*Math.PI/180;if(s){const o=Math.cos(s);return(Math.sin(s)*t+o*e)*i+n}return e*i+n}function P1e(t,e,r,i,n){const s=r*Math.PI/180;return s?(Math.cos(s)*t-Math.sin(s)*e)*i+n:t*i+n}function A1e(t,e,r){return e?r-t:r+t}let Qke=class c${static local(){return c$.instance===null&&(c$.instance=new c$),c$.instance}execute(e,r,i,n,s){return new H2t(e,r,i)}};Qke.instance=null;let H2t=class extends wG{constructor(e,r,i){super(e,!0,!0),this._firstCurve=null,this._walker=new SG,this._walker.updateTolerance(i),this._endings=r.lineDashEnding,this._customDashPos=-(r.offsetAlongLine??0)*i,this._offsetAtEnd=(r.customEndingOffset??0)*i,this._pattern=new xG,this._pattern.init(Zke(r).dashTemplate,!0),this._pattern.scale(i)}processPath(e){if(this._pattern.length()===0){this.iteratePath=!1;const n=ob(e);return eo.fromJSONCIM({paths:[n]})}if(!this.iteratePath){let n=!0;switch(this._endings){case Xa.HalfPattern:case Xa.HalfGap:default:this._pattern.extPtGap=0;break;case Xa.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case Xa.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case Xa.NoConstraint:this.isClosed||(n=!1);break;case Xa.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const s=e.pathLength();if(this._pattern.isEmpty()||s<.1*this._pattern.length()){const o=ob(e);return eo.fromJSONCIM({paths:[o]})}if(!this._walker.init(e,this._pattern,n)){const o=ob(e);return eo.fromJSONCIM({paths:[o]})}}let r;if(this.iteratePath)r=this._pattern.nextValue();else{let n;switch(this._endings){case Xa.HalfPattern:default:n=.5*this._pattern.firstValue();break;case Xa.HalfGap:n=.5*-this._pattern.lastValue();break;case Xa.FullGap:n=-this._pattern.lastValue();break;case Xa.FullPattern:n=0;break;case Xa.NoConstraint:case Xa.Custom:n=-this._customDashPos}let s=n/this._pattern.length();s-=Math.floor(s),n=s*this._pattern.length(),this._pattern.reset(),r=this._pattern.nextValue();let o=!1;for(;n>=r;)n-=r,r=this._pattern.nextValue(),o=!o;r-=n,o?(this._walker.nextPosition(r),r=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(r),r=this._pattern.nextValue(),this._walker.nextPosition(r),r=this._pattern.nextValue())}let i=this._walker.nextCurve(r);if(i)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)i.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else r=this._pattern.nextValue(),!this._walker.nextPosition(r)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(i.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,i=this._firstCurve,this._firstCurve=null;return i==null||i.reset(),i}},Kke=class u${static local(){return u$.instance===null&&(u$.instance=new u$),u$.instance}execute(e,r,i,n,s,o){return new q2t(e,r,i,n,s,o)}};Kke.instance=null;let q2t=class{constructor(e,r,i,n,s,o){switch(this._inputGeometries=e,this._tileKey=n,this._geometryEngine=s,this._maxInflateSize=o*i,this._width=(r.width!==void 0?r.width:2)*i,r.method){case AS.Mitered:case AS.Bevelled:case AS.Rounded:case AS.TrueBuffer:case AS.Square:}this._option=r.option}next(){let e;for(;e=this._inputGeometries.next();){if(e.geometryType==="esriGeometryEnvelope"&&this._width>0){const r=e.asJSON();return Math.min(r.xmax-r.xmin,r.ymax-r.ymin)-2*this._width<0?e:eo.fromJSONCIM({paths:[[[r.xmin+this._width,r.ymin+this._width],[r.xmax-this._width,r.ymin+this._width],[r.xmax-this._width,r.ymax-this._width],[r.xmin+this._width,r.ymax-this._width],[r.xmin+this._width,r.ymin+this._width]],[[r.xmin,r.ymin],[r.xmin,r.ymax],[r.xmax,r.ymax],[r.xmax,r.ymin],[r.xmin,r.ymin]]]})}if(e.geometryType==="esriGeometryPolygon"){if(this._width===0)return e.clone();const r=this._geometryEngine;if(r==null)return null;const i=this._tileKey?Ble(e,this._maxInflateSize):e.clone();if(!i)continue;const n=r.buffer(Ve.WebMercator,i.asJSON(),-this._width,1);if(n){for(const s of n.rings)if(s){i.startPath();for(const o of s.reverse())i.pushXY(o[0],i.yFactor*o[1])}}return i}}return null}},e6e=class h${static local(){return h$.instance===null&&(h$.instance=new h$),h$.instance}execute(e,r,i,n,s){return new W2t(e,r,i)}};e6e.instance=null;let W2t=class extends wG{constructor(e,r,i){super(e,!1,!0),this._curveHelper=new L_,this._length=(r.length!==void 0?r.length:20)*i,this._angle=r.angle!==void 0?r.angle:225,this._position=r.position!==void 0?r.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const r=eo.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const i=e.x,n=e.y;e.seekInPath(e.pathSize-1);const s=e.x,o=e.y,a=[s-i,o-n];this._curveHelper.normalize(a);const l=i+(s-i)*this._position/100,c=n+(o-n)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let h=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(h=-h),this._mirror=!this._mirror;const p=[l-this._length/2*u,c-this._length/2*h],f=[l+this._length/2*u,c+this._length/2*h];return r.pushPath([[i,n],p,f,[s,o]]),r}},t6e=class d${static local(){return d$.instance===null&&(d$.instance=new d$),d$.instance}execute(e,r,i,n,s){return new Y2t(e,r,i)}};t6e.instance=null;let Y2t=class{constructor(e,r,i){this._inputGeometries=e,this._offsetX=r.offsetX!==void 0?r.offsetX*i:0,this._offsetY=r.offsetY!==void 0?r.offsetY*i:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,r,i){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+r,e.y=e.y+i;return e.reset(),e}};const X2t=10;let r6e=class p${static local(){return p$.instance===null&&(p$.instance=new p$),p$.instance}execute(e,r,i,n,s,o){return new Z2t(e,r,i,n,s,o)}};r6e.instance=null;let Z2t=class{constructor(e,r,i,n,s,o){this._inputGeometries=e,this._tileKey=n,this._geometryEngine=s,this._curveHelper=new L_,this._offset=(r.offset??1)*i,this._method=r.method,this._maxInflateSize=Math.max(Math.abs(o*i),X2t),this._option=r.option,this._offsetFlattenError=AD*i}next(){let e;for(;e=this._inputGeometries.next();){if(this._offset===0)return e.clone();if(e.geometryType==="esriGeometryEnvelope"){if(this._method===k0.Rounded&&this._offset>0){const o=ob(e),a=this._curveHelper.offset(o,-this._offset,this._method,4,this._offsetFlattenError);if(a){const l=eo.createEmptyOptimizedCIM(e.geometryType);return l.pushPath(a),l}return null}const s=e.asJSON();if(If(s)&&Math.min(s.xmax-s.xmin,s.ymax-s.ymin)+2*this._offset>0)return eo.fromJSONCIM({xmin:s.xmin-this._offset,xmax:s.xmax+this._offset,ymin:s.ymin-this._offset,ymax:s.ymax+this._offset})}const r=this._geometryEngine;if(r==null)continue;const i=this._tileKey?Ble(e,this._maxInflateSize):e.clone();if(!i)continue;const n=r.offset(Ve.WebMercator,i.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return n?eo.fromJSONCIM(n):null}return null}},i6e=class f${static local(){return f$.instance===null&&(f$.instance=new f$),f$.instance}execute(e,r,i,n,s){return new J2t(e,r,i)}};i6e.instance=null;let J2t=class{constructor(e,r,i){this._inputGeometries=e,this._reverse=r.reverse===void 0||r.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if(e.geometryType==="esriGeometryPolyline")return Q2t(e.clone());e=this._inputGeometries.next()}return null}};function Q2t(t){for(;t.nextPath();)for(let e=0;e<t.pathSize/2;e++){t.seekInPath(e);const r=t.x,i=t.y;t.seekInPath(t.pathSize-e-1);const n=t.x,s=t.y;t.x=r,t.y=i,t.seekInPath(e),t.x=n,t.y=s}return t.reset(),t}let n6e=class m${static local(){return m$.instance===null&&(m$.instance=new m$),m$.instance}execute(e,r,i,n,s){return new K2t(e,r,i)}};n6e.instance=null;let K2t=class{constructor(e,r,i){this._inputGeometries=e,this._rotateAngle=r.angle!==void 0?r.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(this._rotateAngle===0||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const r=$B(e),i=(r[2]+r[0])/2,n=(r[3]+r[1])/2;return e.reset(),this._rotate(e.clone(),i,n)}e=this._inputGeometries.next()}return null}_rotate(e,r,i){const n=Math.cos(this._rotateAngle),s=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const o=e.x-r,a=e.y-i;e.x=r+o*n-a*s,e.y=i+o*s+a*n}return e.reset(),e}},s6e=class g${static local(){return g$.instance===null&&(g$.instance=new g$),g$.instance}execute(e,r,i,n,s){return new eEt(e,r,i)}};s6e.instance=null;let eEt=class{constructor(e,r,i){this._inputGeometries=e,this._xFactor=r.XScaleFactor!==void 0?r.XScaleFactor:1.15,this._yFactor=r.YScaleFactor!==void 0?r.YScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(this._xFactor===1&&this._yFactor===1||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const r=$B(e),i=(r[2]+r[0])/2,n=(r[3]+r[1])/2;return e.reset(),this._scaleCursor(e.clone(),i,n)}}return null}_scaleCursor(e,r,i){for(;e.nextPath();)for(;e.nextPoint();)e.x=r+(e.x-r)*this._xFactor,e.y=i+(e.y-i)*this._yFactor;return e.reset(),e}},o6e=class y${static local(){return y$.instance===null&&(y$.instance=new y$),y$.instance}execute(e,r,i,n,s){return new tEt(e,r,i)}};o6e.instance=null;let tEt=class{constructor(e,r,i){this._inputGeometries=e,this._height=(r.amplitude!==void 0?r.amplitude:2)*i,this._period=(r.period!==void 0?r.period:3)*i,this._style=r.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new xG,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new SG,this._walker.updateTolerance(i)}next(){let e=this._inputGeometries.next();for(;e;){if(this._height===0||this._period===0)return e;const r=this._processGeom(e);if(r)return r;e=this._inputGeometries.next()}return null}_processGeom(e){const r=eo.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){r.startPath();const i=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case m3.Sinus:default:this._constructCurve(r,i,!1);break;case m3.Square:this._constructSquare(r,i);break;case m3.Triangle:this._constructTriangle(r,i);break;case m3.Random:this._constructCurve(r,i,!0)}else for(;e.nextPoint();)r.pushXY(e.x,e.y)}return r}_constructCurve(e,r,i){let n=Math.round(r/this._period);n===0&&(n=1);const s=n*16+1,o=r/n,a=this._period/16,l=1/s,c=2*Math.PI*r/o,u=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),p=2*Math.PI*Math.random(),f=.75-Math.random()/2,g=.75-Math.random()/2,y=new b0;this._walker.curPointAndAngle(y),e.pushPoint(y.pt);let v=0;for(;;){if(!this._walker.nextPointAndAngle(a,y)){e.pushPoint(this._walker.getPathEnd());break}{const b=v;let w;if(v+=l,i){const x=this._height/2*(1+.3*Math.sin(f*c*b+u));w=x*Math.sin(c*b+h),w+=x*Math.sin(g*c*b+p),w/=2}else w=.5*this._height*Math.sin(.5*c*b);e.pushXY(y.pt[0]-w*y.sa,y.pt[1]+w*y.ca)}}}_constructSquare(e,r){Math.round(r/this._period);let i=!0;for(;;){let n=!1;if(this._walker.curPositionIsValid()){const s=new b0;this._walker.curPointAndAngle(s);const o=new b0;if(this._walker.nextPointAndAngle(this._period,o)){const a=new b0;this._walker.nextPointAndAngle(this._period,a)&&(i?(e.pushPoint(s.pt),i=!1):e.pushPoint(s.pt),e.pushXY(s.pt[0]-this._height/2*s.sa,s.pt[1]+this._height/2*s.ca),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca),n=!0)}}if(!n){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,r){Math.round(r/this._period);let i=!0;for(;;){let n=!1;if(this._walker.curPositionIsValid()){const s=new b0;this._walker.curPointAndAngle(s);const o=new b0;if(this._walker.nextPointAndAngle(this._period/2,o)){const a=new b0;this._walker.nextPointAndAngle(this._period,a)&&(this._walker.nextPosition(this._period/2)&&(i?(e.pushPoint(s.pt),i=!1):e.pushPoint(s.pt),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca)),n=!0)}}if(!n){e.pushPoint(this._walker.getPathEnd());break}}}},a6e=class _${static local(){return _$.instance===null&&(_$.instance=new _$),_$.instance}execute(e,r,i,n,s){return new rEt(e,r,i)}};a6e.instance=null;let rEt=class extends HN{constructor(e,r,i){super(e),this._geometryWalker=new SG,this._geometryWalker.updateTolerance(i),this._angleToLine=r.angleToLine??!0,this._offset=(r.offset?r.offset:0)*i,this._originalEndings=r.endings,this._offsetAtEnd=(r.customEndingOffset?r.customEndingOffset:0)*i,this._position=-(r.offsetAlongLine?r.offsetAlongLine:0)*i,this._pattern=new xG,this._pattern.init(r.placementTemplate,!1),this._pattern.scale(i),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let r;if(this.iteratePath)r=this._pattern.nextValue();else{this._originalEndings===df.WithFullGap&&this.isClosed?this._endings=df.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let n,s=!0;switch(this._endings){case df.NoConstraint:n=-this._position,n=this._adjustPosition(n),s=!1;break;case df.WithHalfGap:default:n=-this._pattern.lastValue()/2;break;case df.WithFullGap:n=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case df.WithMarkers:n=0;break;case df.Custom:n=-this._position,n=this._adjustPosition(n),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,s))return null;this._pattern.reset();let o=0;for(;n>o;)n-=o,o=this._pattern.nextValue();o-=n,r=o,this.iteratePath=!0}const i=new b0;return this._geometryWalker.nextPointAndAngle(r,i)?this._endings===df.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===df.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca),this._angleToLine&&this.internalPlacement.setRotateCS(i.ca,i.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let r=e/this._pattern.length();return r-=Math.floor(r),r*this._pattern.length()}},l6e=class v${static local(){return v$.instance===null&&(v$.instance=new v$),v$.instance}execute(e,r,i,n,s){return new iEt(e,r,i)}};l6e.instance=null;let iEt=class extends HN{constructor(e,r,i){super(e,!1,!0),this._curveHelper=new L_,this._angleToLine=r.angleToLine===void 0||r.angleToLine,this._offset=r.offset!==void 0?r.offset*i:0,this._type=r.extremityPlacement,this._position=r.offsetAlongLine!==void 0?r.offsetAlongLine*i:0,this._beginProcessed=!1}processPath(e){let r;switch(this._type){case Bg.Both:default:this._beginProcessed?(r=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iteratePath=!1):(r=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iteratePath=!0);break;case Bg.JustBegin:r=this._atExtremities(e,this._position,!0);break;case Bg.JustEnd:r=this._atExtremities(e,this._position,!1);case Bg.None:}return r}_atExtremities(e,r,i){if(i||e.seekPathEnd(),i?e.nextPoint():e.prevPoint()){let n=0,[s,o]=[0,0],[a,l]=[e.x,e.y];for(;i?e.nextPoint():e.prevPoint();){s=a,o=l,a=e.x,l=e.y;const c=this._curveHelper.getLength(s,o,a,l);if(n+c>r){const u=(r-n)/c,[h,p]=this._curveHelper.getAngleCS(s,o,a,l,u),f=this._curveHelper.getCoord2D(s,o,a,l,u);return this.internalPlacement.setTranslate(f[0]-this._offset*p,f[1]+this._offset*h),this._angleToLine&&this.internalPlacement.setRotateCS(-h,-p),this.internalPlacement}n+=c}}return null}},c6e=class b${static local(){return b$.instance===null&&(b$.instance=new b$),b$.instance}execute(e,r,i,n,s){return new nEt(e,r,i)}};c6e.instance=null;let nEt=class extends HN{constructor(e,r,i){super(e),this._walker=new SG,this._walker.updateTolerance(i),this._angleToLine=r.angleToLine===void 0||r.angleToLine,this._offset=r.offset!==void 0?r.offset*i:0,this._beginGap=r.beginPosition!==void 0?r.beginPosition*i:0,this._endGap=r.endPosition!==void 0?r.endPosition*i:0,this._flipFirst=r.flipFirst===void 0||r.flipFirst,this._pattern=new xG,this._pattern.init(r.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let r;if(this.iteratePath){const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;r=l-this._prevPos,this._prevPos=l}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;r=l-this._prevPos,this._prevPos=l,this.iteratePath=!0}const i=new b0;if(!this._walker.nextPointAndAngle(r,i,Ov.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca);const n=this._isFirst&&this._flipFirst;let s,o;return this._angleToLine?(s=i.ca,o=i.sa):(s=1,o=0),n&&(s=-s,o=-o),this.internalPlacement.setRotateCS(s,o),this._isFirst=!1,this._posCount--,this._posCount===0&&(this.iteratePath=!1),this.internalPlacement}};const y1=512,sEt=10,Fm=24,Z9=1e-6;let u6e=class w${static local(){return w$.instance===null&&(w$.instance=new w$),w$.instance}execute(e,r,i,n,s){return new oEt(e,r,i,n,s)}};u6e.instance=null;let oEt=class Zx{constructor(e,r,i,n,s){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(r.stepX??16)*i,this._stepY=Math.abs(r.stepY??16)*i,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,this._stepX!==0&&this._stepY!==0){if(this._gridType=r.gridType??qI.Fixed,this._gridType===qI.Random){const o=r.seed??13,a=1;this._randomLCG=new lT(o*a),this._randomness=(r.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=r.gridAngle??0,this._shiftOddRows=r.shiftOddRows??!1,this._offsetX=(r.offsetX??0)*i,this._offsetY=(r.offsetY??0)*i,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,n!=null){const[o,a,l,c]=n.split("/"),u=parseFloat(o),h=parseFloat(a),p=parseFloat(l),f=parseFloat(c);this._graphicOriginX=-(f*2**u+p)*y1,this._graphicOriginY=h*y1,this._testInsidePolygon=!0}this._internalPlacement=new hO,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!Zx._randValues){Zx._randValues=[];for(let e=0;e<Fm;e++)for(let r=0;r<Fm;r++)Zx._randValues.push(this._randomLCG.getFloat()),Zx._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let r,i,n,s,o,a,l,c,u,h,p,f,g,y;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=c=g=p=Number.MAX_VALUE,u=h=y=f=-Number.MAX_VALUE;const v=this._cosAngle!==1;for(e.reset();e.nextPath();)for(;e.nextPoint();)a=e.x,o=e.y,r=a-this._graphicOriginX-this._offsetX,i=o-this._graphicOriginY-this._offsetY,v?(n=this._cosAngle*r-this._sinAngle*i,s=this._sinAngle*r+this._cosAngle*i):(n=r,s=i),l=Math.min(l,n),u=Math.max(u,n),c=Math.min(c,s),h=Math.max(h,s),p=Math.min(p,o),f=Math.max(f,o),g=Math.min(g,a),y=Math.max(y,a);p=p!==Number.MAX_VALUE?p:-y1-this._stepY,f=f!==-Number.MAX_VALUE?f:this._stepY,g=g!==Number.MAX_VALUE?g:-this._stepX,y=y!==-Number.MAX_VALUE?y:y1+this._stepX;const b=f-p,w=y-g;if(this._verticalSubdivision=b>=w,this._polygonMin=this._verticalSubdivision?p:g,this._testInsidePolygon){let x=0-this._graphicOriginX-this._offsetX-this._stepX,S=y1-this._graphicOriginX-this._offsetX+this._stepX,E=-y1-this._graphicOriginY-this._offsetY-this._stepY,P=0-this._graphicOriginY-this._offsetY+this._stepY;if(v){const M=[[x,E],[x,P],[S,E],[S,P]];x=E=Number.MAX_VALUE,S=P=-Number.MAX_VALUE;for(const L of M){const U=this._cosAngle*L[0]-this._sinAngle*L[1],z=this._sinAngle*L[0]+this._cosAngle*L[1];x=Math.min(x,U),S=Math.max(S,U),E=Math.min(E,z),P=Math.max(P,z)}}l=l!==Number.MAX_VALUE?Math.max(l,x):x,c=c!==Number.MAX_VALUE?Math.max(c,E):E,u=u!==-Number.MAX_VALUE?Math.min(u,S):S,h=h!==-Number.MAX_VALUE?Math.min(h,P):P}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(h/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,g,y,p,f)}_buildAccelerationMap(e,r,i,n,s){e.reset();const o=new Map,a=this._verticalSubdivision,l=a?s-n:i-r;let c=Math.ceil(l/sEt);if(c<=1)return;const u=Math.floor(l/c);let h,p,f,g,y,v,b,w,x,S,E;for(c++,this._delta=u,a?(x=-y1-2*this._stepY,S=2*this._stepY,E=n):(x=-2*this._stepX,S=y1+2*this._stepX,E=r);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(h=e.x,p=e.y;e.nextPoint();h=f,p=g){if(f=e.x,g=e.y,a){if(p===g||p<x&&g<x||p>S&&g>S)continue;y=Math.min(p,g),v=Math.max(p,g)}else{if(h===f||h<x&&f<x||h>S&&f>S)continue;y=Math.min(h,f),v=Math.max(h,f)}for(;y<v;)b=Math.floor((y-E)/u),O1e(b,h,p,f,g,o),y+=u;w=Math.floor((v-E)/u),w>b&&O1e(w,h,p,f,g,o)}this._accelerationMap=o}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const r=this._currentY*this._stepY+this._offsetY;let i,n;if(this._currentX++,this._gridType===qI.Random){const s=(this._currentX%Fm+Fm)%Fm,o=(this._currentY%Fm+Fm)%Fm;i=this._graphicOriginX+e+this._stepX*this._randomness*(.5-Zx._randValues[o*Fm+s])*2/3,n=this._graphicOriginY+r+this._stepY*this._randomness*(.5-Zx._randValues[o*Fm+s+1])*2/3}else i=this._graphicOriginX+this._cosAngle*e+this._sinAngle*r,n=this._graphicOriginY-this._sinAngle*e+this._cosAngle*r;if(!this._testInsidePolygon||this._isInsidePolygon(i,n,this._geometryCursor))return this._internalPlacement.setTranslate(i,n),this._internalPlacement}}_isInsidePolygon(e,r,i){if(this._accelerationMap==null)return aEt(e,r,i);e+=Z9,r+=Z9;const n=this._verticalSubdivision,s=n?r:e,o=Math.floor((s-this._polygonMin)/this._delta),a=this._accelerationMap.get(o);if(!a)return!1;let l,c,u,h=0;for(const p of a){if(l=p[0],c=p[1],n){if(l[1]>r==c[1]>r)continue;u=(c[0]-l[0])*(r-l[1])-(c[1]-l[1])*(e-l[0])}else{if(l[0]>e==c[0]>e)continue;u=(c[1]-l[1])*(e-l[0])-(c[0]-l[0])*(r-l[1])}u>0?h++:h--}return h!==0}};function aEt(t,e,r){let i,n,s,o,a=0;for(t+=Z9,e+=Z9,r.reset();r.nextPath();)if(r.nextPoint())for(i=r.x,n=r.y;r.nextPoint();i=s,n=o)s=r.x,o=r.y,n>e!=o>e&&((s-i)*(e-n)-(o-n)*(t-i)>0?a++:a--);return a!==0}function O1e(t,e,r,i,n,s){let o=s.get(t);o||(o=[],s.set(t,o)),o.push([[e,r],[i,n]])}const lEt=.001;let h6e=class x${static local(){return x$.instance===null&&(x$.instance=new x$),x$.instance}execute(e,r,i,n,s){return new cEt(e,r,i)}};h6e.instance=null;let cEt=class extends HN{constructor(e,r,i){super(e),this._curveHelper=new L_,this._angleToLine=r.angleToLine===void 0||r.angleToLine,this._offset=r.offset!==void 0?r.offset*i:0,this._relativeTo=r.relativeTo,this._position=r.startPointOffset!==void 0?r.startPointOffset*i:0,this._epsilon=lEt*i}processPath(e){const r=this._position;if(this._relativeTo===OS.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[n,s]=[e.x,e.y],[o,a]=[0,0];for(;e.nextPoint();){o=e.x,a=e.y;const l=this._curveHelper.getLength(n,s,o,a);if(l<this._epsilon){n=o,s=a;continue}const c=.5+this._position/l,[u,h]=this._curveHelper.getAngleCS(n,s,o,a,c),p=this._curveHelper.getCoord2D(n,s,o,a,c);return this.internalPlacement.setTranslate(p[0]-this._offset*h,p[1]+this._offset*u),this._angleToLine&&this.internalPlacement.setRotateCS(u,h),this.internalPlacement}}return this.iteratePath=!1,null}const i=this._relativeTo===OS.LineEnd;return this.onLine(e,r,i)}onLine(e,r,i){let n,s=!1;switch(this._relativeTo){case OS.LineMiddle:default:e.seekPathStart(),n=e.pathLength()/2+r;break;case OS.LineBeginning:n=r;break;case OS.LineEnd:n=r,s=!0}i?e.seekPathEnd():e.seekPathStart();let o=0;if(i?e.prevPoint():e.nextPoint()){let[a,l]=[e.x,e.y],[c,u]=[0,0];for(;i?e.prevPoint():e.nextPoint();){c=e.x,u=e.y;const h=this._curveHelper.getLength(a,l,c,u);if(o+h>n){const p=(n-o)/h,[f,g]=this._curveHelper.getAngleCS(a,l,c,u,p),y=this._curveHelper.getCoord2D(a,l,c,u,p),v=s?-this._offset:this._offset;return this.internalPlacement.setTranslate(y[0]-v*g,y[1]+v*f),this._angleToLine&&(s?this.internalPlacement.setRotateCS(-f,-g):this.internalPlacement.setRotateCS(f,g)),this.internalPlacement}a=c,l=u,o+=h}}return null}};const uEt=1e-15;let d6e=class S${static local(){return S$.instance===null&&(S$.instance=new S$),S$.instance}execute(e,r,i,n,s){return new hEt(e,r,i)}};d6e.instance=null;let hEt=class extends HN{constructor(e,r,i){super(e),this._curveHelper=new L_,this._angleToLine=r.angleToLine===void 0||r.angleToLine,this._offset=r.offset!==void 0?r.offset*i:0,this._endPoints=r.placeOnEndPoints===void 0||r.placeOnEndPoints,this._controlPoints=r.placeOnControlPoints===void 0||r.placeOnControlPoints,this._regularVertices=r.placeOnRegularVertices===void 0||r.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const r=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(r[2]);let i=r[0],n=r[1];if(this._offset!==0){const s=Math.cos(r[2]),o=Math.sin(r[2]);i-=this._offset*o,n+=this._offset*s}return this.internalPlacement.setTranslate(i,n),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const r=e.isClosed();let i=0,n=!1,s=0,o=0;if(e.seekPathStart(),e.nextPoint()){let a=e.x,l=e.y,c=e.getControlPoint(),u=!0,h=e.nextPoint();for(;h;){const p=e.x,f=e.y,g=e.getControlPoint();(this._angleToLine||this._offset!==0)&&(s=this._curveHelper.getAngle(a,l,p,f,0)),u?(u=!1,r?(i=s,n=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([a,l,s])):c?this._controlPoints&&this._tags.push([a,l,AF(o,s)]):this._regularVertices&&this._tags.push([a,l,AF(o,s)]),(this._angleToLine||this._offset!==0)&&(o=this._curveHelper.getAngle(a,l,p,f,1)),h=e.nextPoint(),h||(r?g||n?this._controlPoints&&this._tags.push([p,f,AF(o,i)]):this._regularVertices&&this._tags.push([p,f,AF(o,i)]):(this._endPoints||this._controlPoints&&g)&&this._tags.push([p,f,o])),a=p,l=f,c=g}}this._tagIterator=0}};function AF(t,e){const r=Math.PI;for(;Math.abs(e-t)>r+2*uEt;)e-t>r?e-=2*r:e+=2*r;return(t+e)/2}const dEt=100*222045e-21;function pEt(t){if(t.totalSize===0)return null;const e=$B(t);if(!e)return null;const r=4*(Math.abs(e[0])+Math.abs(e[2])+Math.abs(e[1])+Math.abs(e[3])+1)*dEt;let i=0,n=0;t.reset();for(let U=0;t.nextPath();U++){const z=t.getCurrentRingArea();z>n&&(n=z,i=U)}if(t.seekPath(i),t.pathSize===0)return null;t.seekPathStart();const s=IPe(t);if(Math.abs(n)<=2*r*r)return[(s[0]+s[2])/2,(s[1]+s[3])/2];t.seekPathStart();const o=CJe(t,Ht());if(o===null)return null;if(t.totalPoints<4)return o;const a=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],l=[NaN,NaN,NaN,NaN],c=[NaN,NaN,NaN,NaN];let u=!1,h=vM(o,t,!0);h.distance===0&&(u=!0,a[0][0]=o[0],a[0][1]=o[1],h=vM(o,t,!1)),l[0]=h.distance,c[0]=0;const p=[NaN,NaN];let f=!1,g=.25,y=-1,v=NaN;do if(v=NaN,a[1]=iW(t,nW(s[0],s[2],g),r,e),isNaN(a[1][0])||isNaN(a[1][1])||(h=vM(a[1],t,!1),v=h.distance),!isNaN(v)&&v>r&&w8(a[1],t))f=!0,l[1]=v,c[1]=Jx(a[1],o);else if(!isNaN(v)&&v>y&&(y=v,p[0]=a[1][0],p[1]=a[1][1]),g-=.01,g<.1){if(!(y>=0))break;f=!0,l[1]=y,a[1][0]=p[0],a[1][1]=p[1],c[1]=Jx(a[1],o)}while(!f);f=!1,g=.5,y=-1;let b=.01,w=1;do if(v=NaN,a[2]=iW(t,nW(s[0],s[2],g),r,e),isNaN(a[2][0])||isNaN(a[2][1])||(h=vM(a[2],t,!1),v=h.distance),!isNaN(v)&&v>r&&w8(a[2],t))f=!0,l[2]=v,c[2]=Jx(a[2],o);else if(!isNaN(v)&&v>y)y=v,p[0]=a[2][0],p[1]=a[2][1];else if(v>y&&(y=v,p[0]=a[2][0],p[1]=a[2][1]),g=.5+b*w,b+=.01,w*=-1,g<.3||g>.7){if(!(y>=0))break;f=!0,l[2]=y,a[2][0]=p[0],a[2][1]=p[1],c[2]=Jx(a[2],o)}while(!f);f=!1,g=.75,y=-1;do if(v=NaN,a[3]=iW(t,nW(s[0],s[2],g),r,e),isNaN(a[3][0])||isNaN(a[3][1])||(h=vM(a[3],t,!1),v=h.distance),!isNaN(v)&&v>r&&w8(a[3],t))f=!0,l[3]=v,c[3]=Jx(a[3],o);else if(v>y&&(y=v,p[0]=a[3][0],p[1]=a[3][1]),g+=.01,g>.9){if(!(y>=0))break;f=!0,l[3]=y,a[3][0]=p[0],a[3][1]=p[1],c[3]=Jx(a[3],o)}while(!f);const x=[0,1,2,3],S=u?0:1;let E;for(let U=S;U<4;U++)for(let z=S;z<3;z++){const W=c[z],V=c[z+1];gEt(W,V)>0&&(E=x[z],x[z]=x[z+1],x[z+1]=E,c[z]=V,c[z+1]=W)}let P=S,M=0,L=0;for(let U=S;U<4;U++){switch(U){case 0:L=2*l[x[U]];break;case 1:L=1.66666666*l[x[U]];break;case 2:L=1.33333333*l[x[U]];break;case 3:L=l[x[U]]}L>M&&(M=L,P=x[U])}return a[P]}function w8(t,e){let r,i,n,s,o=0;for(e.reset();e.nextPath()&&e.nextPoint();)for(r=e.x,i=e.y;e.nextPoint();r=n,i=s)n=e.x,s=e.y,i>t[1]!=s>t[1]&&((n-r)*(t[1]-i)-(s-i)*(t[0]-r)>0?o++:o--);return o!==0}function vM(t,e,r){if(r&&w8(t,e))return{coord:t,distance:0};let i=1/0,n=0,s=0,o=[0,0],a=[0,0];const l=[0,0];for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(o[0]=e.x,o[1]=e.y;e.nextPoint();o=a){a=[e.x,e.y],SJe(l,t,o,a);const c=Jx(t,l);c<i&&(i=c,n=l[0],s=l[1])}return{coord:[n,s],distance:Math.sqrt(i)}}function iW(t,e,r,i){const n=[e,0];let s=1/0,o=1/0,a=!1,l=!1;const c=[[e,i[1]-1],[e,i[3]+1]],u=[0,0],h=[0,0],p=[0,0],f=[[0,0],[0,0]],g=Ht();for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(f[0][0]=t.x,f[0][1]=t.y;t.nextPoint();f[0][0]=f[1][0],f[0][1]=f[1][1]){if(f[1][0]=t.x,f[1][1]=t.y,fEt(g,f)===null||(h[0]=c[0][0],h[1]=c[0][1],p[0]=c[1][0],p[1]=c[1][1],mEt(g,h,p)===0)||!gz(c[0],c[1],f[0],f[1],u))continue;const y=u[1];s>o?y<s&&(s=y,a=!0):y<o&&(o=y,l=!0)}return a&&l?n[1]=(s+o)/2:n[0]=n[1]=NaN,n}function fEt(t,e){if(e.length<2)return null;t||(t=Ht());const[r,i]=e[0],[n,s]=e[1];return t[0]=Math.min(r,n),t[1]=Math.min(i,s),t[2]=Math.max(r,n),t[3]=Math.max(i,s),t}const OF=1,MF=4,M1e=3,R1e=12;function mEt(t,e,r){let i=km(e,t),n=km(r,t);const s=t[0],o=t[1],a=t[2],l=t[3];if(i&n)return 0;if(!(i|n))return 4;const c=(i?1:0)|(n?2:0);do{const u=r[0]-e[0],h=r[1]-e[1];if(u>h)i&M1e?(i&OF?(e[1]+=h*(s-e[0])/u,e[0]=s):(e[1]+=h*(a-e[0])/u,e[0]=a),i=km(e,t)):n&M1e?(n&OF?(r[1]+=h*(s-r[0])/u,r[0]=s):(r[1]+=h*(a-r[0])/u,r[0]=a),n=km(r,t)):i?(i&MF?(e[0]+=u*(o-e[1])/h,e[1]=o):(e[0]+=u*(l-e[1])/h,e[1]=l),i=km(e,t)):(n&MF?(r[0]+=u*(o-r[1])/h,r[1]=o):(r[0]+=u*(l-r[1])/h,r[1]=l),n=km(r,t));else if(i&R1e?(i&MF?(e[0]+=u*(o-e[1])/h,e[1]=o):(e[0]+=u*(l-e[1])/h,e[1]=l),i=km(e,t)):n&R1e?(n&MF?(r[0]+=u*(o-r[1])/h,r[1]=o):(r[0]+=u*(l-r[1])/h,r[1]=l),n=km(r,t)):i?(i&OF?(e[1]+=h*(s-e[0])/u,e[0]=s):(e[1]+=h*(a-e[0])/u,e[0]=a),i=km(e,t)):(n&OF?(r[1]+=h*(s-r[0])/u,r[0]=s):(r[1]+=h*(a-r[0])/u,r[0]=a),n=km(r,t)),i&n)return 0}while(i|n);return c}function km(t,e){return(t[0]<e[0]?1:0)|(t[0]>e[2]?1:0)<<1|(t[1]<e[1]?1:0)<<2|(t[1]>e[3]?1:0)<<3}function nW(t,e,r){return t+(e-t)*r}function Jx(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function gEt(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;const r=isNaN(t),i=isNaN(e);return r<i?-1:r>i?1:0}let p6e=class T${static local(){return T$.instance===null&&(T$.instance=new T$),T$.instance}execute(e,r,i,n,s){return new yEt(e,r,i)}};p6e.instance=null;let yEt=class{constructor(e,r,i){this._geometryCursor=e,this._offsetX=r.offsetX!==void 0?r.offsetX*i:0,this._offsetY=r.offsetY!==void 0?r.offsetY*i:0,this._method=r.method!==void 0?r.method:g3.OnPolygon,this._internalPlacement=new hO}next(){const e=this._geometryCursor;return this._geometryCursor=null,e?this._polygonCenter(e):null}_polygonCenter(e){let r=!1;switch(this._method){case g3.CenterOfMass:{const i=RJe(e);i&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),r=!0)}break;case g3.BoundingBoxCenter:{const i=$B(e);i&&(this._internalPlacement.setTranslate((i[2]+i[0])/2+this._offsetX,(i[3]+i[1])/2+this._offsetY),r=!0)}break;case g3.OnPolygon:default:{const i=pEt(e);i!==null&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),r=!0)}}return r?this._internalPlacement:null}};function _Et(t){if(!t)return null;switch(t.type){case"CIMGeometricEffectAddControlPoints":return Bke.local();case"CIMGeometricEffectArrow":return Gke.local();case"CIMGeometricEffectBuffer":return jke.local();case"CIMGeometricEffectControlMeasureLine":return Hke.local();case"CIMGeometricEffectCut":return qke.local();case"CIMGeometricEffectDashes":return Qke.local();case"CIMGeometricEffectDonut":return Kke.local();case"CIMGeometricEffectJog":return e6e.local();case"CIMGeometricEffectMove":return t6e.local();case"CIMGeometricEffectOffset":return r6e.local();case"CIMGeometricEffectReverse":return i6e.local();case"CIMGeometricEffectRotate":return n6e.local();case"CIMGeometricEffectScale":return s6e.local();case"CIMGeometricEffectWave":return o6e.local()}return null}function vEt(t){if(!t)return null;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":return a6e.local();case"CIMMarkerPlacementAtExtremities":return l6e.local();case"CIMMarkerPlacementAtRatioPositions":return c6e.local();case"CIMMarkerPlacementInsidePolygon":return u6e.local();case"CIMMarkerPlacementOnLine":return h6e.local();case"CIMMarkerPlacementOnVertices":return d6e.local();case"CIMMarkerPlacementPolygonCenter":return p6e.local()}return null}function sW(t){const e=t.getFrame(0);if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)return e;const r=document.createElement("canvas");r.width=t.width,r.height=t.height;const i=r.getContext("2d");return e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0),r}let bEt=class f6e{constructor(e=0,r=0,i=0,n=0){this.x=e,this.y=r,this.width=i,this.height=n}static fromExtent(e){return new f6e(e.xmin,-e.ymax,e.xmax-e.xmin,e.ymax-e.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}};function wEt(t){return`rgb(${t.slice(0,3).toString()})`}function oW(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}let m6e=class{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,r){var W,V;this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,n=i.getContext("2d",{willReadFrequently:!0});this._setFontProperties(n,r),this._parameters=r,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:s,weight:o}=r.font;this._lineThroughWidthOffset=s&&s==="line-through"?.1*this._lineHeight:0;const a=r.backgroundColor!=null||r.borderLine!=null,l=a?lht:0,c=this._computeTextWidth(n,r)+2*l,u=this._lineHeight*this._textLines.length+2*l;if(i.width=c+2*this._lineThroughWidthOffset,i.height=u,i.width===0||i.height===0)return i.width=i.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:i};this._renderedLineHeight=Math.round(this._lineHeight*r.pixelRatio),this._renderedHaloSize=bs(r.halo.size)*r.pixelRatio,this._renderedWidth=c*r.pixelRatio,this._renderedHeight=u*r.pixelRatio,this._lineThroughWidthOffset*=r.pixelRatio;const h=r.color??[0,0,0,0],p=r.halo&&r.halo.color?r.halo.color:[0,0,0,0];this._fillStyle=oW(h),this._haloStyle=wEt(p);const f=this._renderedLineHeight,g=this._renderedHaloSize;n.save(),n.clearRect(0,0,i.width,i.height),this._setFontProperties(n,r);const y=l*r.pixelRatio,v=xEt(n.textAlign,this._renderedWidth-2*y)+g+y,b=g+y,w=g>0;let x=this._lineThroughWidthOffset,S=0;if(a){n.save();const J=r.backgroundColor??[0,0,0,0],Y=((W=r.borderLine)==null?void 0:W.color)??[0,0,0,0],X=2*bs(((V=r.borderLine)==null?void 0:V.size)??0);n.fillStyle=oW(J),n.strokeStyle=oW(Y),n.lineWidth=X,n.fillRect(0,0,i.width,i.height),n.strokeRect(0,0,i.width,i.height),n.restore()}w&&this._renderHalo(n,v,b,x,S,r),S+=b,x+=v;for(const J of this._textLines)w?(n.globalCompositeOperation="destination-out",n.fillStyle="rgb(0, 0, 0)",n.fillText(J,x,S),n.globalCompositeOperation="source-over",n.fillStyle=this._fillStyle,n.fillText(J,x,S)):(n.fillStyle=this._fillStyle,n.fillText(J,x,S)),s&&s!=="none"&&this._renderDecoration(n,x,S,s,o),S+=f;n.restore();const E=this._renderedWidth+2*this._lineThroughWidthOffset,P=this._renderedHeight,M=n.getImageData(0,0,E,P),L=new Uint8Array(M.data);if(r.premultiplyColors){let J;for(let Y=0;Y<L.length;Y+=4)J=L[Y+3]/255,L[Y]=L[Y]*J,L[Y+1]=L[Y+1]*J,L[Y+2]=L[Y+2]*J}let U,z;switch(r.horizontalAlignment){case"left":U=-.5;break;case"right":U=.5;break;default:U=0}switch(r.verticalAlignment){case"bottom":z=-.5;break;case"top":z=.5;break;case"baseline":z=-1/6;break;default:z=0}return{size:[E,P],image:new Uint32Array(L.buffer),sdf:!1,simplePattern:!1,anchorX:U,anchorY:z,canvas:i}}_renderHalo(e,r,i,n,s,o){const a=this._renderedWidth,l=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=a,this._haloRasterizationCanvas.height=l;const c=this._haloRasterizationCanvas,u=c.getContext("2d");u.clearRect(0,0,a,l),this._setFontProperties(u,o);const{decoration:h,weight:p}=o.font;u.fillStyle=this._haloStyle,u.strokeStyle=this._haloStyle,u.lineJoin="round",this._renderHaloNative(u,r,i,h,p),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(c,0,0,a,l,n,s,a,l),e.globalAlpha=1}_renderHaloNative(e,r,i,n,s){const o=this._renderedLineHeight,a=this._renderedHaloSize;for(const l of this._textLines){const c=2*a,u=5,h=.1;for(let p=0;p<u;p++){const f=(1-(u-1)*h+p*h)*c;e.lineWidth=f,e.strokeText(l,r,i),n&&n!=="none"&&this._renderDecoration(e,r,i,n,s,f)}i+=o}}_setFontProperties(e,r){const i=Math.max(r.size,.5),n=r.font,s=`${n.style} ${n.weight} ${bs(i*r.pixelRatio).toFixed(1)}px ${n.family}, sans-serif`;let o;switch(e.font=s,e.textBaseline="top",r.horizontalAlignment){case"left":default:o="left";break;case"right":o="right";break;case"center":o="center"}e.textAlign=o}computeTextSize(e,r){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,n=i.getContext("2d");this._setFontProperties(n,r),this._parameters=r,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const s=this._computeTextWidth(n,r),o=this._lineHeight*this._textLines.length;return i.width=s,i.height=o,[s*r.pixelRatio,o*r.pixelRatio]}_computeTextWidth(e,r){let i=0;for(const s of this._textLines)i=Math.max(i,e.measureText(s).width);const n=r.font;return(n.style==="italic"||n.style==="oblique"||typeof n.weight=="string"&&(n.weight==="bold"||n.weight==="bolder")||typeof n.weight=="number"&&n.weight>600)&&(i+=.3*e.measureText("w").width),i+=2*bs(this._parameters.halo.size),Math.round(i)}_computeLineHeight(){let e=1.275*this._parameters.size;const r=this._parameters.font.decoration;return r&&r==="underline"&&(e*=1.3),Math.round(e+2*bs(this._parameters.halo.size))}_renderDecoration(e,r,i,n,s,o){const a=.9*this._lineHeight,l=s==="bold"?.06:s==="bolder"?.09:.04;switch(e.textAlign){case"center":r-=this._renderedWidth/2;break;case"right":r-=this._renderedWidth}const c=e.textBaseline;if(n==="underline")switch(c){case"top":i+=a;break;case"middle":i+=a/2}else if(n==="line-through")switch(c){case"top":i+=a/1.5;break;case"middle":i+=a/3}const u=o?1.5*o:Math.ceil(a*l);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=u,e.moveTo(r-this._lineThroughWidthOffset,i),e.lineTo(r+this._renderedWidth+2*this._lineThroughWidthOffset,i),e.stroke(),e.restore()}};function xEt(t,e){return t==="center"?.5*e:t==="right"?e:0}const qir=512,Wir=128,Yir=511,Xir=29,Zir=24;var $1e;(function(t){t[t.FilterFlags=0]="FilterFlags",t[t.Animation=1]="Animation",t[t.GPGPU=2]="GPGPU",t[t.VV=3]="VV",t[t.DD0=4]="DD0",t[t.DD1=5]="DD1",t[t.DD2=6]="DD2"})($1e||($1e={}));const Jir=1.05,Qir=5,Kir=6,enr=1.15,SEt=2,tnr=128-2*SEt,rnr=10,TEt=1024,inr=256;function EEt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function CEt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function PEt(t,e,r,i,n,s,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t}function g6e(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5];let l=r*s-i*n;return l?(l=1/l,t[0]=s*l,t[1]=-i*l,t[2]=-n*l,t[3]=r*l,t[4]=(n*a-s*o)*l,t[5]=(i*o-r*a)*l,t):null}function AEt(t){return t[0]*t[3]-t[1]*t[2]}function y6e(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1],h=r[2],p=r[3],f=r[4],g=r[5];return t[0]=i*c+s*u,t[1]=n*c+o*u,t[2]=i*h+s*p,t[3]=n*h+o*p,t[4]=i*f+s*g+a,t[5]=n*f+o*g+l,t}function Gle(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(r),u=Math.cos(r);return t[0]=i*u+s*c,t[1]=n*u+o*c,t[2]=i*-c+s*u,t[3]=n*-c+o*u,t[4]=a,t[5]=l,t}function _6e(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i*c,t[1]=n*c,t[2]=s*u,t[3]=o*u,t[4]=a,t[5]=l,t}function jle(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i,t[1]=n,t[2]=s,t[3]=o,t[4]=i*c+s*u+a,t[5]=n*c+o*u+l,t}function OEt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function MEt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Hle(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function REt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function $Et(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function IEt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function v6e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function LEt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function DEt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function NEt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function FEt(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=e[0],c=e[1],u=e[2],h=e[3],p=e[4],f=e[5],g=ml();return Math.abs(r-l)<=g*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=g*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-u)<=g*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-h)<=g*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-p)<=g*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-f)<=g*Math.max(1,Math.abs(a),Math.abs(f))}const kEt=y6e,UEt=v6e;Object.freeze(Object.defineProperty({__proto__:null,add:IEt,copy:EEt,determinant:AEt,equals:FEt,exactEquals:NEt,frob:$Et,fromRotation:OEt,fromScaling:MEt,fromTranslation:Hle,identity:CEt,invert:g6e,mul:kEt,multiply:y6e,multiplyScalar:LEt,multiplyScalarAndAdd:DEt,rotate:Gle,scale:_6e,set:PEt,str:REt,sub:UEt,subtract:v6e,translate:jle},Symbol.toStringTag,{value:"Module"}));function b6e(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function zEt(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function VEt(t,e,r,i,n,s){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o}function BEt(t,e){return new Float32Array(t,e,6)}function w6e(t,e,r,i){const n=e[i],s=e[i+1];t[i]=r[0]*n+r[2]*s+r[4],t[i+1]=r[1]*n+r[3]*s+r[5]}function GEt(t,e,r,i=0,n=0,s=2){const o=n||e.length/s;for(let a=i;a<o;a++)w6e(t,e,r,a*s)}Object.freeze(Object.defineProperty({__proto__:null,clone:zEt,create:b6e,createView:BEt,fromValues:VEt,transform:w6e,transformMany:GEt},Symbol.toStringTag,{value:"Module"}));const jEt=()=>K.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var Ig,Nf;function nnr(t){if(!t)return Ig.Center;switch(t){case"Left":case"left":return Ig.Left;case"Right":case"right":return Ig.Right;case"Justify":return jEt().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),Ig.Center;case"Center":case"center":return Ig.Center}}function snr(t){if(!t)return Nf.Center;switch(t){case"Top":case"top":return Nf.Top;case"Center":case"middle":return Nf.Center;case"Baseline":case"baseline":return Nf.Baseline;case"Bottom":case"bottom":return Nf.Bottom}}function onr(t){switch(t){case Ig.Right:case"right":return-1;case Ig.Center:case"center":return 0;case Ig.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${t}`),0}}function anr(t){switch(t){case Nf.Top:case"top":return 1;case Nf.Center:case"middle":return 0;case Nf.Bottom:case Nf.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${t}`),0}}(function(t){t[t.Left=-1]="Left",t[t.Center=0]="Center",t[t.Right=1]="Right"})(Ig||(Ig={})),function(t){t[t.Top=1]="Top",t[t.Center=0]="Center",t[t.Bottom=-1]="Bottom",t[t.Baseline=2]="Baseline"}(Nf||(Nf={}));const Yw=Math.PI/180,x6e=.5,HEt=()=>K.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");let Qx=class dg{constructor(e){this._t=e}static createIdentity(){return new dg([1,0,0,0,1,0])}clone(){const e=this._t;return new dg(e.slice())}transform(e){const r=this._t;return[r[0]*e[0]+r[1]*e[1]+r[2],r[3]*e[0]+r[4]*e[1]+r[5]]}static createScale(e,r){return new dg([e,0,0,0,r,0])}scale(e,r){const i=this._t;return i[0]*=e,i[1]*=e,i[2]*=e,i[3]*=r,i[4]*=r,i[5]*=r,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,r){return new dg([0,0,e,0,0,r])}translate(e,r){const i=this._t;return i[2]+=e,i[5]+=r,this}static createRotate(e){const r=Math.cos(e),i=Math.sin(e);return new dg([r,-i,0,i,r,0])}rotate(e){return dg.multiply(this,dg.createRotate(e),this)}angle(){const e=this._t[0],r=this._t[3],i=Math.sqrt(e*e+r*r);return[e/i,r/i]}static multiply(e,r,i){const n=e._t,s=r._t,o=n[0]*s[0]+n[3]*s[1],a=n[1]*s[0]+n[4]*s[1],l=n[2]*s[0]+n[5]*s[1]+s[2],c=n[0]*s[3]+n[3]*s[4],u=n[1]*s[3]+n[4]*s[4],h=n[2]*s[3]+n[5]*s[4]+s[5],p=i._t;return p[0]=o,p[1]=a,p[2]=l,p[3]=c,p[4]=u,p[5]=h,i}invert(){const e=this._t;let r=e[0]*e[4]-e[1]*e[3];if(r===0)return new dg([0,0,0,0,0,0]);r=1/r;const i=(e[1]*e[5]-e[2]*e[4])*r,n=(e[2]*e[3]-e[0]*e[5])*r,s=e[4]*r,o=-e[1]*r,a=-e[3]*r,l=e[0]*r;return new dg([s,o,i,a,l,n])}},S6e=class{constructor(e,r){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new fa(hO,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(r||Qx.createIdentity()),this._sizeTransfos.push(r?r.scaleRatio():1)}setTransform(e,r){this._transfos=[e||Qx.createIdentity()],this._sizeTransfos=[r||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,r){const i=r?e.scaleRatio():1;Qx.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*i)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,r,i){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,r);break;case"CIMTextSymbol":this.drawTextSymbol(e,r,i)}}drawMultiLayerSymbol(e,r){if(!e||!r)return;const i=e.symbolLayers;if(!i)return;const n=e.effects;if(n&&n.length>0){const s=this.executeEffects(n,r);if(s){let o=s.next();for(;o;)this.drawSymbolLayers(i,o.asJSON()),o=s.next()}}else this.drawSymbolLayers(i,r)}executeEffects(e,r){const i=this._resourceManager.geometryEngine;let n=new v2t(eo.fromJSONCIM(r));for(const s of e){const o=_Et(s);o&&(n=o.execute(n,s,this.geomUnitsPerPoint(),null,i))}return n}drawSymbolLayers(e,r){let i=e.length;for(;i--;){const n=e[i];if(!n||n.enable===!1)continue;const s=n.effects;if(s&&s.length>0){const o=this.executeEffects(s,r);if(o){let a=null;for(;(a=o.next())&&(this.drawSymbolLayer(n,a.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(n,r);if(this._earlyReturn)return}}drawSymbolLayer(e,r){switch(e.type){case"CIMSolidFill":this.drawSolidFill(r,e.color);break;case"CIMHatchFill":this.drawHatchFill(r,e);break;case"CIMPictureFill":this.drawPictureFill(r,e);break;case"CIMGradientFill":this.drawGradientFill(r,e);break;case"CIMSolidStroke":this.drawSolidStroke(r,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMPictureStroke":this.drawPictureStroke(r,e);break;case"CIMGradientStroke":this.drawGradientStroke(r,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,r)}}drawHatchFill(e,r){const i=this._buildHatchPolyline(r,e,this.geomUnitsPerPoint());i&&(this.pushClipPath(e),this.drawMultiLayerSymbol(r.lineSymbol,i),this.popClipPath())}drawPictureFill(e,r){}drawGradientFill(e,r){}drawPictureStroke(e,r){}drawGradientStroke(e,r){}drawMarkerLayer(e,r){const i=e.markerPlacement;if(i){const n=vEt(i);if(n){const s=i.type==="CIMMarkerPlacementInsidePolygon"||i.type==="CIMMarkerPlacementPolygonCenter"&&i.clipAtBoundary;s&&this.pushClipPath(r);const o=n.execute(eo.fromJSONCIM(r),i,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(o){let a=null;for(;(a=o.next())&&(this.drawMarker(e,a),!this._earlyReturn););}s&&this.popClipPath()}}else{const n=this._placementPool.acquire();if(GP(r))n.tx=r.x,n.ty=r.y,this.drawMarker(e,n);else if(ol(r)){const s=xPe(r);s&&([n.tx,n.ty]=s,this.drawMarker(e,n))}else for(const s of r.points)if(n.tx=s[0],n.ty=s[1],this.drawMarker(e,n),this._earlyReturn)break;this._placementPool.release(n)}}drawMarker(e,r){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,r);break;case"CIMVectorMarker":this.drawVectorMarker(e,r)}}drawPictureMarker(e,r){if(!e)return;const i=this._resourceManager.getResource(e.url),n=Ar(e.size,_3.CIMPictureMarker.size);if(i==null||n<=0)return;const s=i.width,o=i.height;if(!s||!o)return;const a=s/o,l=Ar(e.scaleX,1),c=Qx.createIdentity(),u=e.anchorPoint;if(u){let v=u.x,b=u.y;e.anchorPointUnits!=="Absolute"&&(v*=n*a*l,b*=n),c.translate(-v,-b)}let h=Ar(e.rotation);e.rotateClockwise&&(h=-h),this._mapRotation&&(h+=this._mapRotation),h&&c.rotate(h*Yw);let p=Ar(e.offsetX),f=Ar(e.offsetY);if(p||f){if(this._mapRotation){const v=Yw*this._mapRotation,b=Math.cos(v),w=Math.sin(v),x=p*w+f*b;p=p*b-f*w,f=x}c.translate(p,f)}const g=this.geomUnitsPerPoint();g!==1&&c.scale(g,g);const y=r.getAngle();y&&c.rotate(y),c.translate(r.tx,r.ty),this.push(c,!1),this.drawImage(e,n),this.pop()}drawVectorMarker(e,r){if(!e)return;const i=e.markerGraphics;if(!i)return;const n=Ar(e.size,_3.CIMVectorMarker.size),s=e.frame,o=s?s.ymax-s.ymin:0,a=n&&o?n/o:1,l=Qx.createIdentity();s&&l.translate(.5*-(s.xmax+s.xmin),.5*-(s.ymax+s.ymin));const c=e.anchorPoint;if(c){let y=c.x,v=c.y;e.anchorPointUnits!=="Absolute"?s&&(y*=s.xmax-s.xmin,v*=s.ymax-s.ymin):(y/=a,v/=a),l.translate(-y,-v)}a!==1&&l.scale(a,a);let u=Ar(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*Yw);let h=Ar(e.offsetX),p=Ar(e.offsetY);if(h||p){if(this._mapRotation){const y=Yw*this._mapRotation,v=Math.cos(y),b=Math.sin(y),w=h*b+p*v;h=h*v-p*b,p=w}l.translate(h,p)}const f=this.geomUnitsPerPoint();f!==1&&l.scale(f,f);const g=r.getAngle();g&&l.rotate(g),l.translate(r.tx,r.ty),this.push(l,e.scaleSymbolsProportionally);for(const y of i){y!=null&&y.symbol&&y.geometry||HEt().error("Invalid marker graphic",y);let v=y.textString;if(typeof v=="number"&&(v=v.toString()),this.drawSymbol(y.symbol,y.geometry,v),this._earlyReturn)break}this.pop()}drawTextSymbol(e,r,i){if(!e||!GP(r)||Ar(e.height,_3.CIMTextSymbol.height)<=0)return;const n=Qx.createIdentity();let s=Ar(e.angle);s=-s,s&&n.rotate(s*Yw);const o=Ar(e.offsetX),a=Ar(e.offsetY);(o||a)&&n.translate(o,a);const l=this.geomUnitsPerPoint();l!==1&&n.scale(l,l),n.translate(r.x,r.y),this.push(n,!1),this.drawText(e,i),this.pop()}_buildHatchPolyline(e,r,i){let n=Ar(e.separation,_3.CIMHatchFill.separation)*i,s=Ar(e.rotation);if(n===0)return null;n<0&&(n=-n);let o=0;const a=.5*n;for(;o>a;)o-=n;for(;o<-a;)o+=n;const l=Ht();kJe(l,r),l[0]-=a,l[1]-=a,l[2]+=a,l[3]+=a;const c=[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]]];for(;s>180;)s-=180;for(;s<0;)s+=180;const u=Math.cos(s*Yw),h=Math.sin(s*Yw),p=-n*h,f=n*u;let g,y,v,b;o=Ar(e.offsetX)*i*h-Ar(e.offsetY)*i*u,g=v=Number.MAX_VALUE,y=b=-Number.MAX_VALUE;for(const L of c){const U=L[0],z=L[1],W=u*U+h*z,V=-h*U+u*z;g=Math.min(g,W),v=Math.min(v,V),y=Math.max(y,W),b=Math.max(b,V)}v=Math.floor(v/n)*n;let w=u*g-h*v-p*o/n,x=h*g+u*v-f*o/n,S=u*y-h*v-p*o/n,E=h*y+u*v-f*o/n;const P=1+Math.round((b-v)/n),M=[];for(let L=0;L<P;L++)w+=p,x+=f,S+=p,E+=f,M.push([[w,x],[S,E]]);return{paths:M}}},qEt=class extends S6e{constructor(e,r){super(e,r),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new bEt(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return OB(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if(ol(e))this._processPath(e.rings,0);else if(Lf(e))this._processPath(e.paths,0);else if(If(e)){const r=MS(e);r&&this._processPath(r.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(e,r,i){if(!e||this._clipCount>0||i==null||i<=0)return;const n=Math.max(.5*this.transformSize(Ar(i,_3.CIMSolidStroke.width)),.5*x6e);if(ol(e))this._processPath(e.rings,n);else if(Lf(e))this._processPath(e.paths,n);else if(If(e)){const s=MS(e);s&&this._processPath(s.rings,n)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(e,r){ol(r)&&e.markerPlacement&&(e.markerPlacement.type==="CIMMarkerPlacementInsidePolygon"||e.markerPlacement.type==="CIMMarkerPlacementPolygonCenter"&&e.markerPlacement.clipAtBoundary)?this._processPath(r.rings,0):super.drawMarkerLayer(e,r)}drawHatchFill(e,r){this.drawSolidFill(e)}drawPictureFill(e,r){this.drawSolidFill(e)}drawGradientFill(e,r){this.drawSolidFill(e)}drawPictureStroke(e,r){this.drawSolidStroke(e,null,r.width)}drawGradientStroke(e,r){this.drawSolidStroke(e,null,r.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,r){const{url:i}=e,n=Ar(e.scaleX,1);let s=n*r,o=r;const a=this._resourceManager.getResource(i);if(a!=null){const l=a.height/a.width;s=n*(r?l>1?r:r/l:a.width),o=r?l>1?r*l:r:a.height}this._merge(this.transformPt([-s/2,-o/2]),0),this._merge(this.transformPt([-s/2,o/2]),0),this._merge(this.transformPt([s/2,-o/2]),0),this._merge(this.transformPt([s/2,o/2]),0)}drawText(e,r){if(!r||r.length===0)return;this._textRasterizer||(this._textRasterizer=new m6e);const i=T6e(e);let[n,s]=this._textRasterizer.computeTextSize(r,i);n=hl(n),s=hl(s);let o=0;switch(e.horizontalAlignment){case"Left":o=n/2;break;case"Right":o=-n/2}let a=0;switch(e.verticalAlignment){case"Bottom":a=s/2;break;case"Top":a=-s/2;break;case"Baseline":a=s/6}this._merge(this.transformPt([-n/2+o,-s/2+a]),0),this._merge(this.transformPt([-n/2+o,s/2+a]),0),this._merge(this.transformPt([n/2+o,-s/2+a]),0),this._merge(this.transformPt([n/2+o,s/2+a]),0)}_processPath(e,r){if(e)for(const i of e){const n=i?i.length:0;if(n>1){this._merge(this.transformPt(i[0]),r);for(let s=1;s<n;s++)this._merge(this.transformPt(i[s]),r)}}}_merge(e,r){e[0]-r<this._xmin&&(this._xmin=e[0]-r),e[0]+r>this._xmax&&(this._xmax=e[0]+r),e[1]-r<this._ymin&&(this._ymin=e[1]-r),e[1]+r>this._ymax&&(this._ymax=e[1]+r)}},WEt=class extends S6e{constructor(e,r,i,n){super(r,i),this._applyAdditionalRenderProps=n,this._colorSubstitutionHelper=new b2t,this._ctx=e}drawSolidFill(e,r){if(!e)return;if(ol(e))this._buildPath(e.rings,!0);else if(Lf(e))this._buildPath(e.paths,!0);else if(If(e))this._buildPath(MS(e).rings,!0);else{if(!dT(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const i=this._ctx;i.fillStyle=typeof r=="string"?r:"rgba("+Math.round(r[0])+","+Math.round(r[1])+","+Math.round(r[2])+","+(r[3]??255)/255+")",i.fill("evenodd")}drawSolidStroke(e,r,i,n,s,o){if(!e||!r||i===0)return;if(ol(e))this._buildPath(e.rings,!0);else if(Lf(e))this._buildPath(e.paths,!1);else{if(!If(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(MS(e).rings,!0)}const a=this._ctx;a.strokeStyle=typeof r=="string"?r:"rgba("+Math.round(r[0])+","+Math.round(r[1])+","+Math.round(r[2])+","+(r[3]??255)/255+")",a.lineWidth=Math.max(this.transformSize(i),x6e),this._setCapStyle(n),this._setJoinStyle(s),a.miterLimit=o,a.stroke()}pushClipPath(e){if(this._ctx.save(),ol(e))this._buildPath(e.rings,!0);else if(Lf(e))this._buildPath(e.paths,!0);else{if(!If(e))return;this._buildPath(MS(e).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,r){const{colorSubstitutions:i,url:n,tintColor:s}=e,o=Ar(e.scaleX,1),a=this._resourceManager.getResource(n);if(a==null)return;let l=r*(a.width/a.height),c=r;r||(l=a.width,c=a.height);const u=bE(n)||"src"in a&&bE(a.src);let h="getFrame"in a?sW(a):a;i&&(h=this._colorSubstitutionHelper.applyColorSubstituition(h,i)),this._applyAdditionalRenderProps&&!u&&s&&(h=this._colorSubstitutionHelper.tintImageData(h,s));const p=this.transformPt([0,0]),[f,g]=this.getTransformAngle(),y=this.transformSize(1),v=this._ctx;v.save(),v.setTransform({m11:o*y*f,m12:o*y*g,m21:-y*g,m22:y*f,m41:p[0],m42:p[1]}),v.drawImage(h,-l/2,-c/2,l,c),v.restore()}drawText(e,r){if(!r||r.length===0)return;this._textRasterizer||(this._textRasterizer=new m6e);const i=T6e(e);i.size*=this.transformSize(hl(1));const n=this._textRasterizer.rasterizeText(r,i);if(!n)return;const{size:s,anchorX:o,anchorY:a,canvas:l}=n,c=s[0]*(o+.5),u=s[1]*(a-.5),h=this._ctx,p=this.transformPt([0,0]),[f,g]=this.getTransformAngle(),y=1;h.save(),h.setTransform({m11:y*f,m12:y*g,m21:-y*g,m22:y*f,m41:p[0]-y*c,m42:p[1]+y*u}),h.drawImage(l,0,0),h.restore()}drawPictureFill(e,r){if(!e)return;let{colorSubstitutions:i,height:n,offsetX:s,offsetY:o,rotation:a,scaleX:l,tintColor:c,url:u}=r;const h=this._resourceManager.getResource(u);if(h==null)return;if(ol(e))this._buildPath(e.rings,!0);else if(Lf(e))this._buildPath(e.paths,!0);else if(If(e))this._buildPath(MS(e).rings,!0);else{if(!dT(e))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const p=this._ctx,f=bE(u)||"src"in h&&bE(h.src);let g,y="getFrame"in h?sW(h):h;if(i&&(y=this._colorSubstitutionHelper.applyColorSubstituition(y,i)),this._applyAdditionalRenderProps){f||c&&(y=this._colorSubstitutionHelper.tintImageData(y,c)),g=p.createPattern(y,"repeat");const v=this.transformSize(1);a||(a=0),s?s*=v:s=0,o?o*=v:o=0,n&&(n*=v);const b=n?n/h.height:1,w=l&&n?l*n/h.width:1;if(a!==0||b!==1||w!==1||s!==0||o!==0){const x=new DOMMatrix;x.rotateSelf(0,0,-a).translateSelf(s,o).scaleSelf(w,b,1),g.setTransform(x)}}else g=p.createPattern(y,"repeat");p.save(),p.fillStyle=g,p.fill("evenodd"),p.restore()}drawPictureStroke(e,r){if(!e)return;let{colorSubstitutions:i,capStyle:n,joinStyle:s,miterLimit:o,tintColor:a,url:l,width:c}=r;const u=this._resourceManager.getResource(l);if(u==null)return;let h;if(ol(e))h=e.rings;else if(Lf(e))h=e.paths;else{if(!If(e))return dT(e)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;h=MS(e).rings}c||(c=u.width);const p=bE(l)||"src"in u&&bE(u.src);let f="getFrame"in u?sW(u):u;i&&(f=this._colorSubstitutionHelper.applyColorSubstituition(f,i)),this._applyAdditionalRenderProps&&(p||a&&(f=this._colorSubstitutionHelper.tintImageData(f,a)));const g=Math.max(this.transformSize(bs(c)),.5),y=g/f.width,v=this._ctx,b=v.createPattern(f,"repeat-y");let w,x;v.save(),this._setCapStyle(n),this._setJoinStyle(s),o!==void 0&&(v.miterLimit=o),v.lineWidth=g;for(let S of h)if(S=ae(S),ZEt(S),S&&!(S.length<=1)){w=this.transformPt(S[0]);for(let E=1;E<S.length;E++){x=this.transformPt(S[E]);const P=YEt(w,x),M=new DOMMatrix;M.translateSelf(0,w[1]-g/2).scaleSelf(y,y,1).rotateSelf(0,0,90-P),b.setTransform(M),v.strokeStyle=b,v.beginPath(),v.moveTo(w[0],w[1]),v.lineTo(x[0],x[1]),v.stroke(),w=x}}v.restore()}_buildPath(e,r){const i=this._ctx;if(i.beginPath(),e)for(const n of e){const s=n?n.length:0;if(s>1){let o=this.transformPt(n[0]);i.moveTo(o[0],o[1]);for(let a=1;a<s;a++)o=this.transformPt(n[a]),i.lineTo(o[0],o[1]);r&&i.closePath()}}}_setCapStyle(e){switch(e){case Zd.Butt:this._ctx.lineCap="butt";break;case Zd.Round:this._ctx.lineCap="round";break;case Zd.Square:this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case Gg.Bevel:this._ctx.lineJoin="bevel";break;case Gg.Round:this._ctx.lineJoin="round";break;case Gg.Miter:this._ctx.lineJoin="miter"}}};function YEt(t,e){const r=e[0]-t[0],i=e[1]-t[1];return 180/Math.PI*Math.atan2(i,r)}const MS=t=>t?{spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:null;function T6e(t,e=1){var b;const r=Xke(t),i=Yke(t.fontStyleName),n=t.fontFamilyName??Nke,{weight:s,style:o}=i,a=e*(t.height||5),l=B2t(t.horizontalAlignment),c=G2t(t.verticalAlignment),u=WI(t),h=WI(t.haloSymbol),p=h!=null?e*(t.haloSize??0):0,f=((b=t.callout)==null?void 0:b.type)==="CIMBackgroundCallout"?t.callout.backgroundSymbol:null,g=WI(f),y=dte(f),v=hte(f);return{color:u,size:a,horizontalAlignment:l,verticalAlignment:c,font:{family:n,style:z2t(o),weight:V2t(s),decoration:r},halo:{size:p||0,color:h,style:o},backgroundColor:g,borderLine:y!=null&&v!=null?{size:y,color:v}:null,pixelRatio:1,premultiplyColors:!0}}const XEt=1e-4;function ZEt(t){let e,r,i,n,s,o=t[0],a=1;for(;a<t.length;)e=t[a][0]-o[0],r=t[a][1]-o[1],n=e!==0?r/e:Math.PI/2,i!==void 0&&n-i<=XEt?(t.splice(a-1,1),o=s):(s=o,o=t[a],a++),i=n}const E6e=[252,146,31,255],hnr=[153,153,153,255],JEt={type:"esriSMS",style:"esriSMSCircle",size:6,color:E6e,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},QEt={type:"esriSLS",style:"esriSLSSolid",width:.75,color:E6e},KEt={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},eCt={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},tCt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},rCt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},iCt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},dnr=pw.fromJSON(JEt),nCt=vp.fromJSON(QEt),pnr=O2.fromJSON(KEt),sCt=tO.fromJSON(eCt);pw.fromJSON(tCt);vp.fromJSON(rCt);O2.fromJSON(iCt);const fnr=Number.POSITIVE_INFINITY,qle=Math.PI,mnr=2*qle,oCt=128/qle,aCt=256/360,gnr=qle/180,lCt=1/Math.LN2;function C6e(t,e){return(t%=e)>=0?t:t+e}function ynr(t){return C6e(t*oCt,256)}function _nr(t){return C6e(t*aCt,256)}function vnr(t){return Math.log(t)*lCt}function bnr(t,e,r){return t*(1-r)+e*r}const cCt=8,uCt=14,hCt=16;function wnr(t){return cCt+Math.max((t-uCt)*hCt,0)}function xnr(t,e,r){let i,n,s,o=0;for(const a of r){i=a.length;for(let l=1;l<i;++l)n=a[l-1],s=a[l],n.y>e!=s.y>e&&((s.x-n.x)*(e-n.y)-(s.y-n.y)*(t-n.x)>0?o++:o--)}return o!==0}function Snr(t,e,r,i){let n,s,o,a;const l=i*i;for(const c of r){const u=c.length;if(!(u<2)){n=c[0].x,s=c[0].y;for(let h=1;h<u;++h){if(o=c[h].x,a=c[h].y,TJe(t,e,n,s,o,a)<l)return!0;n=o,s=a}}}return!1}function dCt(t,e,r,i,n,s,o){const a=Math.max(i,Math.min(e,s))-e,l=Math.max(n,Math.min(r,o))-r;return a*a+l*l<=t*t}function Tnr(t,e){if(e===0||Number.isNaN(e))return t;const r=[],i=new Qa(0,0),n=new Qa(0,0),s=new Qa(0,0);for(let o=0;o<t.length;o++){const a=t[o],l=[];for(let c=0;c<a.length;c++){const u=a[c-1],h=a[c],p=a[c+1];c===0?i.setCoords(0,0):i.assignSub(h,u).normalize().rightPerpendicular(),c===a.length-1?n.setCoords(0,0):n.assignSub(p,h).normalize().rightPerpendicular(),s.assignAdd(i,n).normalize();const f=s.x*n.x+s.y*n.y;f!==0&&s.scale(1/f),l.push(Qa.add(h,s.scale(e)))}r.push(l)}return r}function Enr(t,e,r,i){const n=new Qa(t[0],t[1]);if(n.scale(i),e==="viewport"){const s=-r*(Math.PI/180),o=Math.cos(s),a=Math.sin(s);n.rotate(o,a)}return n}const P6e=Math.PI,pCt=P6e/2,Um=96/72,I1e=4,J9=()=>K.getLogger("esri.symbols.cim.CIMSymbolHelper");function x8(t,e,r){switch(e.type){case"CIMSymbolReference":return x8(t,e.symbol,r);case"CIMPointSymbol":r==null&&(r={x:0,y:0}),t.drawSymbol(e,r);break;case"CIMLineSymbol":r==null&&(r={paths:[[[0,0],[10,0]]]}),t.drawSymbol(e,r);break;case"CIMPolygonSymbol":r==null&&(r={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),t.drawSymbol(e,r);break;case"CIMTextSymbol":{const i={x:0,y:0};t.drawSymbol(e,i);break}case"CIMVectorMarker":{const i=new hO;t.drawMarker(e,i);break}}return t.envelope()}function fCt(t){if(!t)return 0;switch(t.type){case"CIMGeometricEffectArrow":return Math.abs(.5*t.width);case"CIMGeometricEffectBuffer":return Math.abs(t.size);case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(t.length);case"CIMGeometricEffectJog":return Math.abs(.5*t.length);case"CIMGeometricEffectMove":return Math.max(Math.abs(Ar(t.offsetX)),Math.abs(Ar(t.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(t.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(t.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return .5*Math.max(Math.abs(t.fromWidth),Math.abs(t.toWidth));case"CIMGeometricEffectWave":return Math.abs(t.amplitude);case"CIMGeometricEffectDonut":return Math.abs(t.width)}}function Cnr(t){if(!t)return 0;let e=0;for(const r of t)e+=fCt(r);return e}let aW=class S8{static getEnvelope(e,r,i){if(!e)return null;const n=new qEt(i);if(Array.isArray(e)){let s;for(const o of e)s?s.union(x8(n,o,r)):s=x8(n,o,r);return s}return x8(n,e,r)}static getTextureAnchor(e,r){const i=this.getEnvelope(e,null,r);if(!i)return[0,0,0];const n=(i.x+.5*i.width)*Um,s=(i.y+.5*i.height)*Um,o=i.width*Um+2,a=i.height*Um+2;return[-n/o,-s/a,a]}static rasterize(e,r,i,n,s=!0){const o=i||this.getEnvelope(r,null,n);if(!o)return[null,0,0,0,0];const a=(o.x+.5*o.width)*Um,l=(o.y+.5*o.height)*Um;e.width=o.width*Um,e.height=o.height*Um,i||(e.width+=2,e.height+=2);const c=e.getContext("2d",{willReadFrequently:!0}),u=Qx.createScale(Um,-Um);u.translate(.5*e.width-a,.5*e.height+l);const h=new WEt(c,n,u);switch(r.type){case"CIMPointSymbol":{const g={type:"point",x:0,y:0};h.drawSymbol(r,g);break}case"CIMVectorMarker":{const g=new hO;h.drawMarker(r,g);break}}const p=c.getImageData(0,0,e.width,e.height),f=new Uint8Array(p.data);if(s){let g;for(let y=0;y<f.length;y+=4)g=f[y+3]/255,f[y]=f[y]*g,f[y+1]=f[y+1]*g,f[y+2]=f[y+2]*g}return[f,e.width,e.height,-a/e.width,-l/e.height]}static fromTextSymbol(e){const{text:r}=e;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:S8.createCIMTextSymbolfromTextSymbol(e),textString:r}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(e){const{height:r,outline:i,width:n,xoffset:s,xscale:o,yoffset:a,yscale:l}=e,c=[],u={type:"CIMPolygonSymbol",symbolLayers:c};if(i){const y=L1e(i);y&&c.push(y)}let h=e.url;e.type==="esriPFS"&&e.imageData&&(h=e.imageData);const p="angle"in e?e.angle??0:0,f=(n??0)*(o||1),g=(r??0)*(l||1);return c.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:y3.Picture,tintColor:null,url:h,height:g,width:f,offsetX:Ar(s),offsetY:Ar(a),rotation:Ar(-p),colorSubstitutions:null}),u}static fromSimpleFillSymbol(e){const{color:r,style:i,outline:n}=e,s=[],o={type:"CIMPolygonSymbol",symbolLayers:s};if(n){const a=L1e(n);a&&s.push(a)}if(i&&i!=="solid"&&i!=="none"&&i!=="esriSFSSolid"&&i!=="esriSFSNull"){const a={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:hh(r),capStyle:Zd.Butt,joinStyle:Gg.Miter,width:.75}]};let l=0;const c=hl(bCt(i)?8:10);switch(i){case"vertical":case"esriSFSVertical":l=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":l=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":l=45;break;case"cross":case"esriSFSCross":l=0}s.push({type:"CIMHatchFill",lineSymbol:a,offsetX:0,offsetY:0,rotation:l,separation:c}),i==="cross"||i==="esriSFSCross"?s.push({type:"CIMHatchFill",lineSymbol:ae(a),offsetX:0,offsetY:0,rotation:90,separation:c}):i!=="diagonal-cross"&&i!=="esriSFSDiagonalCross"||s.push({type:"CIMHatchFill",lineSymbol:ae(a),offsetX:0,offsetY:0,rotation:45,separation:c})}else!i||i!=="solid"&&i!=="esriSFSSolid"||s.push({type:"CIMSolidFill",enable:!0,color:hh(r)});return o}static fromSimpleLineSymbol(e){const{cap:r,color:i,join:n,marker:s,miterLimit:o,style:a,width:l}=e;let c=null;a!=="solid"&&a!=="none"&&a!=="esriSLSSolid"&&a!=="esriSLSNull"&&(c=[{type:"CIMGeometricEffectDashes",dashTemplate:fte(a,r),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const u=[];if(s){let h;switch(s.placement){case"begin-end":h=Bg.Both;break;case"begin":h=Bg.JustBegin;break;case"end":h=Bg.JustEnd;break;default:h=Bg.None}const p=S8.fromSimpleMarker(s,l,i).symbolLayers[0];p.markerPlacement={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:h,offsetAlongLine:0},u.push(p)}return u.push({type:"CIMSolidStroke",color:a!=="none"&&a!=="esriSLSNull"?hh(i):[0,0,0,0],capStyle:O6e(r),joinStyle:M6e(n),miterLimit:o,width:l,effects:c}),{type:"CIMLineSymbol",symbolLayers:u}}static fromPictureMarker(e){const{angle:r,height:i,width:n,xoffset:s,yoffset:o}=e;let a=e.url;return e.type==="esriPMS"&&e.imageData&&(a=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:y3.Picture,tintColor:null,url:a,size:i,width:n,offsetX:Ar(s),offsetY:Ar(o),rotation:Ar(-r)}]}}static createCIMTextSymbolfromTextSymbol(e){const{angle:r,color:i,font:n,haloColor:s,haloSize:o,horizontalAlignment:a,kerning:l,text:c,verticalAlignment:u,xoffset:h,yoffset:p,backgroundColor:f,borderLineColor:g,borderLineSize:y}=e;let v,b,w,x,S,E;n&&(v=n.family,b=n.style,w=n.weight,x=n.size,S=n.decoration);let P=!1;return c&&(P=o2t(c)[1]),(f||y)&&(E={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:hh(f)},{type:"CIMSolidStroke",color:hh(g),width:y}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:r,blockProgression:ate.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:nte.Normal,fontEncoding:ste.Unicode,fontFamilyName:v||"Arial",fontStyleName:yCt(b,w),fontType:ote.Unspecified,haloSize:o,height:x,hinting:cte.Default,horizontalAlignment:mCt(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",offsetX:Ar(h),offsetY:Ar(p),strikethrough:S==="line-through",underline:S==="underline",symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:hh(i)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:hh(s)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:P?X9.RTL:X9.LTR,verticalAlignment:gCt(u??"baseline"),verticalGlyphOrientation:ute.Right,wordSpacing:100,billboardMode3D:lte.FaceNearPlane,callout:E}}static createPictureMarkerRasterizationParam(e){var l,c;const{angle:r,height:i,width:n,xoffset:s,yoffset:o}=e,a=e.url??((l=e.source)==null?void 0:l.url)??((c=e.source)==null?void 0:c.imageData);return a?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:y3.Picture,tintColor:null,url:a,size:i,width:n,offsetX:Ar(s),offsetY:Ar(o),rotation:Ar(-r)}}:null}static createPictureFillRasterizationParam(e){const{width:r,height:i,xoffset:n,yoffset:s,url:o}=e;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:y3.Picture,tintColor:null,url:o,width:r,height:i,offsetX:Ar(n),offsetY:Ar(s),rotation:0}}:null}static fromSimpleMarker(e,r,i){const{style:n}=e,s=e.color??i;if(n==="path"||n==="esriSMSPath"){const h=[];if("outline"in e&&e.outline){const g=e.outline;h.push({type:"CIMSolidStroke",enable:!0,width:g.width,color:hh(g.color),path:e.path})}h.push({type:"CIMSolidFill",enable:!0,color:hh(s),path:e.path});const[p,f]=bM("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-Ar(e.angle),size:Ar(e.size||6),offsetX:Ar(e.xoffset),offsetY:Ar(e.yoffset),scaleSymbolsProportionally:!1,frame:p,markerGraphics:[{type:"CIMMarkerGraphic",geometry:f,symbol:{type:"CIMPolygonSymbol",symbolLayers:h}}]}]}}const o=[];let a,l,c=e.size;if("outline"in e&&e.outline&&e.outline.style!=="none"&&e.outline.style!=="esriSLSNull"){const h=e.outline,p=h.style!=="solid"&&h.style!=="esriSLSSolid";[a,l]=p?bM(n,e.size):bM(n);const f=h.width??nCt.width;if(p){const v=f/e.size,b=(a.xmax-a.xmin)*v/2,w=(a.ymax-a.ymin)*v/2;a.xmin-=b,a.xmax+=b,a.ymin-=w,a.ymax+=w,c&&(c+=f)}const g=e.style!=="cross"&&e.style!=="x"||(e==null?void 0:e.outline.style)==="dot"||(e==null?void 0:e.outline.style)==="short-dot"?Xa.HalfGap:Xa.FullPattern,y=p?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:fte(h.style,null).map(v=>h.width&&h.width>0?v*h.width:v),lineDashEnding:g,controlPointEnding:Xa.FullPattern}]:void 0;o.push({type:"CIMSolidStroke",capStyle:p?Zd.Round:Zd.Butt,enable:!0,width:f,color:hh(h.color),effects:y})}else!r||e.type!=="line-marker"||e.style!=="cross"&&e.style!=="x"?[a,l]=bM(n):([a,l]=bM(n),o.push({type:"CIMSolidStroke",enable:!0,width:r,color:hh(s)}));o.push({type:"CIMSolidFill",enable:!0,color:hh(s)});const u={type:"CIMPolygonSymbol",symbolLayers:o};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:Ar(-e.angle),size:Ar(c||6*r),offsetX:Ar(e.xoffset),offsetY:Ar(e.yoffset),scaleSymbolsProportionally:!1,frame:a,markerGraphics:[{type:"CIMMarkerGraphic",geometry:l,symbol:u}]}]}}static fromCIMHatchFill(e,r){var l;const i=r*(e.separation??_3.CIMHatchFill.separation),n=i/2,s=ae(e.lineSymbol);(l=s.symbolLayers)==null||l.forEach(c=>{var u;switch(c.type){case"CIMSolidStroke":c.width!=null&&(c.width*=r),(u=c.effects)==null||u.forEach(h=>{if(h.type==="CIMGeometricEffectDashes"){const p=h.dashTemplate;h.dashTemplate=p.map(f=>f*r)}});break;case"CIMVectorMarker":{c.size!=null&&(c.size*=r);const h=c.markerPlacement;h!=null&&"placementTemplate"in h&&(h.placementTemplate=h.placementTemplate.map(p=>p*r));break}}});let o=this._getLineSymbolPeriod(s)||I1e;for(;o<I1e;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-n,ymax:n},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:s}],size:i}}static fetchResources(e,r,i,n=null){return e&&r&&A6e(e,s=>{wCt(s,r,i),"url"in s&&s.url&&i.push(r.fetchResource(s.url,{signal:n}))}),i}static fetchFonts(e,r,i){if(e&&r){if("symbolLayers"in e&&e.symbolLayers){for(const n of e.symbolLayers)if(n.type==="CIMVectorMarker"&&n.markerGraphics)for(const s of n.markerGraphics)s!=null&&s.symbol&&S8.fetchFonts(s.symbol,r,i)}else if(e.type==="CIMTextSymbol"){const{fontFamilyName:n,fontStyleName:s}=e;if(!n||n.toLowerCase()==="calcitewebcoreicons")return;const{style:o,weight:a}=Yke(s),l=Xke(e),c=new EN({family:n,style:o,weight:a,decoration:l});i.push(r.loadFont(c).catch(()=>{J9().error(`Unsupported font ${n} in CIM symbol`)}))}}}static _getLineSymbolPeriod(e){if(e){const r=this._getEffectsRepeat(e.effects);if(r)return r;if(e.symbolLayers){for(const i of e.symbolLayers)if(i){const n=this._getEffectsRepeat(i.effects);if(n)return n;switch(i.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const s=this._getPlacementRepeat(i.markerPlacement);if(s)return s}}}}}return 0}static _getEffectsRepeat(e){if(e){for(const r of e)if(r)switch(r.type){case"CIMGeometricEffectDashes":{const i=r.dashTemplate;if(i&&i.length){let n=0;for(const s of i)n+=s;return 1&i.length&&(n*=2),n}break}case"CIMGeometricEffectWave":return r.period;default:J9().error(`unsupported geometric effect type ${r.type}`)}}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const r=e.placementTemplate;if(r&&r.length){let i=0;for(const n of r)i+=+n;return 1&r.length&&(i*=2),i}break}}return 0}static fromCIMInsidePolygon(e){const r=e.markerPlacement,i={...e};i.markerPlacement=null,i.anchorPoint=null;const n=Math.abs(r.stepX),s=Math.abs(r.stepY),o=(r.randomness??100)/100;let a,l,c,u;if(r.gridType==="Random"){const h=hl(TEt),p=Math.max(Math.floor(h/n),1),f=Math.max(Math.floor(h/s),1);a=p*n/2,l=f*s/2,c=2*l;const g=new lT(r.seed),y=o*n/1.5,v=o*s/1.5;u=[];for(let b=0;b<p;b++)for(let w=0;w<f;w++){const x=b*n-a+y*(.5-g.getFloat()),S=w*s-l+v*(.5-g.getFloat());u.push({x,y:S}),b===0&&u.push({x:x+2*a,y:S}),w===0&&u.push({x,y:S+2*l})}}else r.shiftOddRows===!0?(a=n/2,l=s,c=2*s,u=[{x:-a,y:0},{x:a,y:0},{x:0,y:l},{x:0,y:-l}]):(a=n/2,l=s/2,c=s,u=[{x:-n,y:0},{x:0,y:-s},{x:-n,y:-s},{x:0,y:0},{x:n,y:0},{x:0,y:s},{x:n,y:s},{x:-n,y:s},{x:n,y:-s}]);return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-l,ymax:l},markerGraphics:u.map(h=>({type:"CIMMarkerGraphic",geometry:h,symbol:{type:"CIMPointSymbol",symbolLayers:[i]}})),size:c}}};function A6e(t,e){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=t.symbolLayers;if(!r)return;for(const i of r)if(e(i),i.type==="CIMVectorMarker"){const n=i.markerGraphics;if(!n)continue;for(const s of n)if(s){const o=s.symbol;o&&A6e(o,e)}}break}}}const O6e=t=>{if(!t)return Zd.Butt;switch(t){case"butt":return Zd.Butt;case"square":return Zd.Square;case"round":return Zd.Round}},M6e=t=>{if(!t)return Gg.Miter;switch(t){case"miter":return Gg.Miter;case"round":return Gg.Round;case"bevel":return Gg.Bevel}},mCt=t=>{if(t==null)return"Center";switch(t){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},gCt=t=>{if(t==null)return"Center";switch(t){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},hh=t=>{if(!t)return[0,0,0,0];const{r:e,g:r,b:i,a:n}=t;return[e,r,i,255*n]},yCt=(t,e)=>{const r=_Ct(e),i=vCt(t);return r&&i?`${r}-${i}`:`${r}${i}`},_Ct=t=>{if(!t)return"";switch(t.toLowerCase()){case"bold":case"bolder":return"bold"}return""},vCt=t=>{if(!t)return"";switch(t.toLowerCase()){case"italic":case"oblique":return"italic"}return""},fte=(t,e)=>{const r=ne("safari")?.001:0,i=e==="butt";switch(t){case"dash":case"esriSLSDash":return i?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return i?[4,3,1,3]:[3,4,r,4];case"dot":case"esriSLSDot":return i?[1,3]:[r,4];case"long-dash":case"esriSLSLongDash":return i?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return i?[8,3,1,3]:[7,4,r,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return i?[8,3,1,3,1,3]:[7,4,r,4,r,4];case"short-dash":case"esriSLSShortDash":return i?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return i?[4,1,1,1]:[3,2,r,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return i?[4,1,1,1,1,1]:[3,2,r,2,r,2];case"short-dot":case"esriSLSShortDot":return i?[1,1]:[r,2];case"solid":case"esriSLSSolid":case"none":return J9().error("Unexpected: style does not require rasterization"),[0,0];default:return J9().error(`Tried to rasterize SLS, but found an unexpected style: ${t}!`),[0,0]}},bM=(t,e=100)=>{const r=e/2;let i,n;const s=t;if(s==="circle"||s==="esriSMSCircle"){let a=Math.acos(1-.25/r),l=Math.ceil(P6e/a/4);l===0&&(l=1),a=pCt/l,l*=4;const c=[];c.push([r,0]);for(let u=1;u<l;u++)c.push([r*Math.cos(u*a),-r*Math.sin(u*a)]);c.push([r,0]),i={rings:[c]},n={xmin:-r,ymin:-r,xmax:r,ymax:r}}else if(s==="cross"||s==="esriSMSCross")i={paths:[[[0,r],[0,-r]],[[r,0],[-r,0]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if(s==="diamond"||s==="esriSMSDiamond")i={rings:[[[-r,0],[0,r],[r,0],[0,-r],[-r,0]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if(s==="square"||s==="esriSMSSquare")i={rings:[[[-r,-r],[-r,r],[r,r],[r,-r],[-r,-r]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if(s==="x"||s==="esriSMSX")i={paths:[[[r,r],[-r,-r]],[[r,-r],[-r,r]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if(s==="triangle"||s==="esriSMSTriangle"){const o=e*.5773502691896257,a=-o,l=2/3*e,c=l-e;i={rings:[[[a,c],[0,l],[o,c],[a,c]]]},n={xmin:a,ymin:c,xmax:o,ymax:l}}else s==="arrow"&&(i={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r});return[n,i]},bCt=t=>t==="vertical"||t==="horizontal"||t==="cross"||t==="esriSFSCross"||t==="esriSFSVertical"||t==="esriSFSHorizontal";function wCt(t,e,r){if(!(!t.effects||e.geometryEngine!=null)){if(e.geometryEnginePromise)return void r.push(e.geometryEnginePromise);k2t(t.effects)&&(e.geometryEnginePromise=U2t(),r.push(e.geometryEnginePromise),e.geometryEnginePromise.then(i=>e.geometryEngine=i))}}function L1e(t){if(!t)return null;let e=null;const{cap:r,color:i,join:n,miterLimit:s,style:o,width:a}=t;return o!=="solid"&&o!=="none"&&o!=="esriSLSSolid"&&o!=="esriSLSNull"&&(e=[{type:"CIMGeometricEffectDashes",dashTemplate:fte(o,r),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:o!=="esriSLSNull"&&o!=="none"?hh(i):[0,0,0,0],capStyle:O6e(r),joinStyle:M6e(n),miterLimit:s,width:a,effects:e}}function R6e(t,e,r,i,n){if(t==null)return null;const s=t.referencesGeometry()&&n?xCt(e,i,n):e,o=t.repurposeFeature(s);try{return t.evaluate({...r,$feature:o},t.services)}catch(a){return K.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const lW=new Map;function xCt(t,e,r){const{transform:i,hasZ:n,hasM:s}=r;lW.has(e)||lW.set(e,SCt(e));const o=lW.get(e)(t.geometry,i,n,s);return{...t,geometry:o}}function SCt(t){const e={};switch(t){case"esriGeometryPoint":return(r,i,n,s)=>_Fe(i,e,r,n,s);case"esriGeometryPolygon":return(r,i,n,s)=>vFe(i,e,r,n,s);case"esriGeometryPolyline":return(r,i,n,s)=>bFe(i,e,r,n,s);case"esriGeometryMultipoint":return(r,i,n,s)=>yFe(i,e,r,n,s);default:return K.getLogger("esri.views.2d.support.arcadeOnDemand").error(new B("mapview-arcade",`Unable to handle geometryType: ${t}`)),r=>r}}const TCt=t=>{if(!t)return[0,0,0,0];const{r:e,g:r,b:i,a:n}=t;return[e,r,i,255*n]};let v3=class gs{static findApplicableOverrides(e,r,i){if(e&&r){if(e.primitiveName){let n=!1;for(const s of i)if(s.primitiveName===e.primitiveName){n=!0;break}if(!n)for(const s of r)s.primitiveName===e.primitiveName&&i.push(s)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)gs.findApplicableOverrides(n,r,i);if(e.symbolLayers)for(const n of e.symbolLayers)gs.findApplicableOverrides(n,r,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const n of e.effects)gs.findApplicableOverrides(n,r,i);if(e.markerPlacement&&gs.findApplicableOverrides(e.markerPlacement,r,i),e.type==="CIMVectorMarker"){if(e.markerGraphics)for(const n of e.markerGraphics)gs.findApplicableOverrides(n,r,i),gs.findApplicableOverrides(n.symbol,r,i)}else e.type==="CIMCharacterMarker"?gs.findApplicableOverrides(e.symbol,r,i):e.type==="CIMHatchFill"?gs.findApplicableOverrides(e.lineSymbol,r,i):e.type==="CIMPictureMarker"&&gs.findApplicableOverrides(e.animatedSymbolProperties,r,i)}}}static findEffectOverrides(e,r){if(!e)return null;if(e.type==="CIMGeometricEffectDashes"&&Zke(e),!r||!e.primitiveName)return{type:"cim-effect-info",effect:e,overrides:[]};const i=e.primitiveName,n=[];for(const s of r)s.primitiveName===i&&n.push({...s,propertyName:E1e(s.propertyName)});return{type:"cim-effect-info",effect:e,overrides:n}}static async resolveSymbolOverrides(e,r,i,n,s,o,a){if(!(e!=null&&e.symbol))return null;let{symbol:l,primitiveOverrides:c}=e;const u=!!c;if(!u&&!n)return l;l=ae(l),c=ae(c);let h=!0;if(r||(r={attributes:{}},h=!1),u){if(h||(c=c.filter(p=>{var f;return!((f=p.valueExpressionInfo)!=null&&f.expression.includes("$feature"))})),a||(c=c.filter(p=>{var f;return!((f=p.valueExpressionInfo)!=null&&f.expression.includes("$view"))})),c.length>0){const p={spatialReference:i,fields:j2t(r.attributes),geometryType:s};await gs.createRenderExpressions(c,p),gs.evaluateOverrides(c,r,s??"esriGeometryPoint",o,a)}gs.applyOverrides(l,c)}return n&&gs.applyDictionaryTextOverrides(l,r,n,null),l}static async createRenderExpressions(e,r){const i=[];for(const n of e){const s=n.valueExpressionInfo;if(!s||gs._expressionToRenderExpression.has(s.expression))continue;const o=hIe(s.expression,r.spatialReference,r.fields);i.push(o),o.then(a=>gs._expressionToRenderExpression.set(s.expression,a))}i.length>0&&await Promise.all(i)}static evaluateOverrides(e,r,i,n,s){const o={$view:{scale:s==null?void 0:s.scale}};for(const a of e){a.value&&typeof a.value=="object"&&RLe(a.value)&&(a.propertyName==="Color"||a.propertyName==="StrokeColor")&&(a.value=TCt(a.value));const l=a.valueExpressionInfo;if(!l)continue;const c=gs._expressionToRenderExpression.get(l.expression);c&&(a.value=R6e(c,r,o,i,n))}}static applyDictionaryTextOverrides(e,r,i,n,s="Normal"){if(e!=null&&e.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const o=e.symbolLayers;if(!o)return;for(const a of o)a&&a.type==="CIMVectorMarker"&&gs.applyDictionaryTextOverrides(a,r,i,n,e.type==="CIMTextSymbol"?e.textCase:s)}break;case"CIMVectorMarker":{const o=e.markerGraphics;if(!o)return;for(const a of o)a&&gs.applyDictionaryTextOverrides(a,r,i,n)}break;case"CIMMarkerGraphic":{const o=e.textString;if(o&&o.includes("[")){const a=R2t(o,i);e.textString=$2t(r,a,n,s)}}}}static applyOverrides(e,r,i,n){if(e.primitiveName){for(const s of r)if(s.primitiveName===e.primitiveName){const o=E1e(s.propertyName);if(n&&n.push({cim:e,nocapPropertyName:o,value:e[o]}),i){let a=!1;for(const l of i)l.primitiveName===e.primitiveName&&(a=!0);a||i.push(s)}s.value!=null&&(e[o]=s.value)}}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)gs.applyOverrides(s,r,i,n);if(e.symbolLayers)for(const s of e.symbolLayers)gs.applyOverrides(s,r,i,n);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const s of e.effects)gs.applyOverrides(s,r,i,n);if(e.type==="CIMVectorMarker"&&e.markerGraphics)for(const s of e.markerGraphics)gs.applyOverrides(s,r,i,n),gs.applyOverrides(s.symbol,r,i,n)}}static restoreOverrides(e){for(const r of e)r.cim[r.nocapPropertyName]=r.value}static buildOverrideKey(e){let r="";for(const i of e)i.value!==void 0&&(r+=`${i.primitiveName}${i.propertyName}${JSON.stringify(i.value)}`);return r}static toValue(e,r){if(e==="DashTemplate")return r.split(" ").map(i=>Number(i));if(e==="Color"){const i=new De(r).toRgba();return i[3]*=255,i}return r}};v3._expressionToRenderExpression=new Map;function Wle(t,e,r,i){if(t)if(t.type!=="CIMTextSymbol"){if(r&&t.effects)for(const n of t.effects)PCt(n,e);if(t.symbolLayers)for(const n of t.symbolLayers)switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":ECt(n,e,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!(i!=null&&i.preserveOutlineWidth)&&n.width&&(n.width*=e);break;case"CIMPictureFill":n.height&&(n.height*=e),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e);break;case"CIMHatchFill":Wle(n.lineSymbol,e,!0,{...i,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e),n.separation&&(n.separation*=e)}}else t.height!=null&&(t.height*=e)}function ECt(t,e,r){if(t&&(t.markerPlacement&&CCt(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const i of t.markerGraphics)t.scaleSymbolsProportionally||Wle(i.symbol,e,!0,r)}function CCt(t,e){switch(Wke(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function PCt(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const r=t.dashTemplate.map(i=>i*e);t.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function ACt(t){const e=[];return mte(D2t(t),e),e.length?new De(L2t(e[0])):null}function mte(t,e){var n;if(!t)return;let r;r=t.type==="CIMTextSymbol"?t.symbol:t;const i=t.type==="CIMPolygonSymbol";if(r!=null&&r.symbolLayers){for(const s of r.symbolLayers)if(!(s.colorLocked||i&&(F2t(s)||N2t(s)&&s.markerPlacement&&Wke(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&D1e(e,s.tintColor);break;case"CIMVectorMarker":(n=s.markerGraphics)==null||n.forEach(o=>{mte(o.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":D1e(e,s.color);break;case"CIMHatchFill":mte(s.lineSymbol,e)}}}function D1e(t,e){for(const r of t)if(r.join(".")===e.join("."))return;t.push(e)}var N1e,F1e,$6e={exports:{}};F1e=function(){function t(n,s){function o(){this.constructor=n}o.prototype=s.prototype,n.prototype=new o}function e(n,s,o,a){var l=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=s,l.found=o,l.location=a,l.name="SyntaxError",l}function r(n,s,o){return o=o||" ",n.length>s?n:(s-=n.length,n+(o+=o.repeat(s)).slice(0,s))}function i(n,s){var o,a={},l=(s=s!==void 0?s:{}).grammarSource,c={start:Oy},u=Oy,h="none",p=")",f=",",g="(",y="%",v="px",b="cm",w="mm",x="in",S="pt",E="pc",P="deg",M="rad",L="grad",U="turn",z="#",W=".",V="e",J=/^[ \t\n\r]/,Y=/^[a-z\-]/,X=/^[0-9a-fA-F]/,le=/^[+\-]/,D=/^[0-9]/,I=rc("none"),k=xo("none",!1),j=xo(")",!1),q=xo(",",!1),Q=rc("whitespace"),ie=ww([" ","	",`
`,"\r"],!1,!1),ye=rc("function"),Ae=xo("(",!1),Ze=rc("identifier"),Et=ww([["a","z"],"-"],!1,!1),xt=rc("percentage"),Qe=xo("%",!1),Ke=rc("length"),Ge=xo("px",!1),Jt=xo("cm",!1),Rr=xo("mm",!1),Gi=xo("in",!1),Be=xo("pt",!1),wr=xo("pc",!1),Re=rc("angle"),qe=xo("deg",!1),At=xo("rad",!1),Gt=xo("grad",!1),Je=xo("turn",!1),$t=rc("number"),Le=rc("color"),ot=xo("#",!1),It=ww([["0","9"],["a","f"],["A","F"]],!1,!1),_i=ww(["+","-"],!1,!1),Jr=ww([["0","9"]],!1,!1),Di=xo(".",!1),Gr=xo("e",!1),ii=function(){return[]},xr=function(Z,ve){return{type:"function",name:Z,parameters:ve||[]}},jr=function(Z,ve){return ve.length>0?bO(Z,ve,3):[Z]},Cr=function(Z){return{type:"quantity",value:Z.value,unit:Z.unit}},oi=function(Z){return{type:"color",colorType:Z.type,value:Z.value}},Mt=function(Z){return Z},pr=function(){return Hc()},Pr=function(Z){return{value:Z,unit:"%"}},vi=function(Z){return{value:Z,unit:"px"}},ps=function(Z){return{value:Z,unit:"cm"}},_r=function(Z){return{value:Z,unit:"mm"}},ji=function(Z){return{value:Z,unit:"in"}},Nn=function(Z){return{value:Z,unit:"pt"}},qo=function(Z){return{value:Z,unit:"pc"}},yl=function(Z){return{value:Z,unit:"deg"}},_l=function(Z){return{value:Z,unit:"rad"}},Wo=function(Z){return{value:Z,unit:"grad"}},Ss=function(Z){return{value:Z,unit:"turn"}},Fn=function(Z){return{value:Z,unit:null}},Sr=function(){return{type:"hex",value:Hc()}},Ji=function(Z){return{type:"function",value:Z}},Fs=function(){return{type:"named",value:Hc()}},bo=function(){return parseFloat(Hc())},ue=0,Qr=0,Tp=[{line:1,column:1}],wo=0,Ep=[],mt=0;if("startRule"in s){if(!(s.startRule in c))throw new Error(`Can't start parsing from rule "`+s.startRule+'".');u=c[s.startRule]}function Hc(){return n.substring(Qr,ue)}function xo(Z,ve){return{type:"literal",text:Z,ignoreCase:ve}}function ww(Z,ve,Oe){return{type:"class",parts:Z,inverted:ve,ignoreCase:Oe}}function xw(){return{type:"end"}}function rc(Z){return{type:"other",description:Z}}function Ay(Z){var ve,Oe=Tp[Z];if(Oe)return Oe;for(ve=Z-1;!Tp[ve];)ve--;for(Oe={line:(Oe=Tp[ve]).line,column:Oe.column};ve<Z;)n.charCodeAt(ve)===10?(Oe.line++,Oe.column=1):Oe.column++,ve++;return Tp[Z]=Oe,Oe}function Sw(Z,ve,Oe){var Tr=Ay(Z),Ts=Ay(ve),Ni={source:l,start:{offset:Z,line:Tr.line,column:Tr.column},end:{offset:ve,line:Ts.line,column:Ts.column}};return Oe&&l&&typeof l.offset=="function"&&(Ni.start=l.offset(Ni.start),Ni.end=l.offset(Ni.end)),Ni}function sr(Z){ue<wo||(ue>wo&&(wo=ue,Ep=[]),Ep.push(Z))}function k_(Z,ve,Oe){return new e(e.buildMessage(Z,ve),Z,ve,Oe)}function Oy(){var Z;return(Z=U_())===a&&(Z=vl()),Z}function U_(){var Z,ve;return mt++,Z=ue,An(),n.substr(ue,4)===h?(ve=h,ue+=4):(ve=a,mt===0&&sr(k)),ve!==a?(An(),Qr=Z,Z=ii()):(ue=Z,Z=a),mt--,Z===a&&mt===0&&sr(I),Z}function vl(){var Z,ve;if(Z=[],(ve=qc())!==a)for(;ve!==a;)Z.push(ve),ve=qc();else Z=a;return Z}function qc(){var Z,ve,Oe,Tr;return Z=ue,An(),(ve=z_())!==a?(An(),(Oe=Sm())===a&&(Oe=null),An(),n.charCodeAt(ue)===41?(Tr=p,ue++):(Tr=a,mt===0&&sr(j)),Tr!==a?(An(),Qr=Z,Z=xr(ve,Oe)):(ue=Z,Z=a)):(ue=Z,Z=a),Z}function Sm(){var Z,ve,Oe,Tr,Ts,Ni,bl,Pw;if(Z=ue,(ve=So())!==a){for(Oe=[],Tr=ue,Ts=An(),n.charCodeAt(ue)===44?(Ni=f,ue++):(Ni=a,mt===0&&sr(q)),Ni===a&&(Ni=null),bl=An(),(Pw=So())!==a?Tr=Ts=[Ts,Ni,bl,Pw]:(ue=Tr,Tr=a);Tr!==a;)Oe.push(Tr),Tr=ue,Ts=An(),n.charCodeAt(ue)===44?(Ni=f,ue++):(Ni=a,mt===0&&sr(q)),Ni===a&&(Ni=null),bl=An(),(Pw=So())!==a?Tr=Ts=[Ts,Ni,bl,Pw]:(ue=Tr,Tr=a);Qr=Z,Z=jr(ve,Oe)}else ue=Z,Z=a;return Z}function So(){var Z,ve;return Z=ue,(ve=Ew())===a&&(ve=N2())===a&&(ve=Cw())===a&&(ve=V_()),ve!==a&&(Qr=Z,ve=Cr(ve)),(Z=ve)===a&&(Z=ue,(ve=l4())!==a&&(Qr=Z,ve=oi(ve)),Z=ve),Z}function An(){var Z,ve;for(mt++,Z=[],J.test(n.charAt(ue))?(ve=n.charAt(ue),ue++):(ve=a,mt===0&&sr(ie));ve!==a;)Z.push(ve),J.test(n.charAt(ue))?(ve=n.charAt(ue),ue++):(ve=a,mt===0&&sr(ie));return mt--,ve=a,mt===0&&sr(Q),Z}function z_(){var Z,ve,Oe;return mt++,Z=ue,(ve=Tw())!==a?(n.charCodeAt(ue)===40?(Oe=g,ue++):(Oe=a,mt===0&&sr(Ae)),Oe!==a?(Qr=Z,Z=Mt(ve)):(ue=Z,Z=a)):(ue=Z,Z=a),mt--,Z===a&&(ve=a,mt===0&&sr(ye)),Z}function Tw(){var Z,ve,Oe;if(mt++,Z=ue,ve=[],Y.test(n.charAt(ue))?(Oe=n.charAt(ue),ue++):(Oe=a,mt===0&&sr(Et)),Oe!==a)for(;Oe!==a;)ve.push(Oe),Y.test(n.charAt(ue))?(Oe=n.charAt(ue),ue++):(Oe=a,mt===0&&sr(Et));else ve=a;return ve!==a&&(Qr=Z,ve=pr()),mt--,(Z=ve)===a&&(ve=a,mt===0&&sr(Ze)),Z}function Ew(){var Z,ve,Oe;return mt++,Z=ue,An(),(ve=ic())!==a?(n.charCodeAt(ue)===37?(Oe=y,ue++):(Oe=a,mt===0&&sr(Qe)),Oe!==a?(Qr=Z,Z=Pr(ve)):(ue=Z,Z=a)):(ue=Z,Z=a),mt--,Z===a&&mt===0&&sr(xt),Z}function N2(){var Z,ve,Oe;return mt++,Z=ue,An(),(ve=ic())!==a?(n.substr(ue,2)===v?(Oe=v,ue+=2):(Oe=a,mt===0&&sr(Ge)),Oe!==a?(Qr=Z,Z=vi(ve)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,An(),(ve=ic())!==a?(n.substr(ue,2)===b?(Oe=b,ue+=2):(Oe=a,mt===0&&sr(Jt)),Oe!==a?(Qr=Z,Z=ps(ve)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,An(),(ve=ic())!==a?(n.substr(ue,2)===w?(Oe=w,ue+=2):(Oe=a,mt===0&&sr(Rr)),Oe!==a?(Qr=Z,Z=_r(ve)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,An(),(ve=ic())!==a?(n.substr(ue,2)===x?(Oe=x,ue+=2):(Oe=a,mt===0&&sr(Gi)),Oe!==a?(Qr=Z,Z=ji(ve)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,An(),(ve=ic())!==a?(n.substr(ue,2)===S?(Oe=S,ue+=2):(Oe=a,mt===0&&sr(Be)),Oe!==a?(Qr=Z,Z=Nn(ve)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,An(),(ve=ic())!==a?(n.substr(ue,2)===E?(Oe=E,ue+=2):(Oe=a,mt===0&&sr(wr)),Oe!==a?(Qr=Z,Z=qo(ve)):(ue=Z,Z=a)):(ue=Z,Z=a)))))),mt--,Z===a&&mt===0&&sr(Ke),Z}function Cw(){var Z,ve,Oe;return mt++,Z=ue,(ve=ic())!==a?(n.substr(ue,3)===P?(Oe=P,ue+=3):(Oe=a,mt===0&&sr(qe)),Oe!==a?(Qr=Z,Z=yl(ve)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,(ve=ic())!==a?(n.substr(ue,3)===M?(Oe=M,ue+=3):(Oe=a,mt===0&&sr(At)),Oe!==a?(Qr=Z,Z=_l(ve)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,(ve=ic())!==a?(n.substr(ue,4)===L?(Oe=L,ue+=4):(Oe=a,mt===0&&sr(Gt)),Oe!==a?(Qr=Z,Z=Wo(ve)):(ue=Z,Z=a)):(ue=Z,Z=a),Z===a&&(Z=ue,(ve=ic())!==a?(n.substr(ue,4)===U?(Oe=U,ue+=4):(Oe=a,mt===0&&sr(Je)),Oe!==a?(Qr=Z,Z=Ss(ve)):(ue=Z,Z=a)):(ue=Z,Z=a)))),mt--,Z===a&&(ve=a,mt===0&&sr(Re)),Z}function V_(){var Z,ve;return mt++,Z=ue,An(),(ve=ic())!==a?(Qr=Z,Z=Fn(ve)):(ue=Z,Z=a),mt--,Z===a&&mt===0&&sr($t),Z}function l4(){var Z,ve,Oe,Tr;if(mt++,Z=ue,n.charCodeAt(ue)===35?(ve=z,ue++):(ve=a,mt===0&&sr(ot)),ve!==a){if(Oe=[],X.test(n.charAt(ue))?(Tr=n.charAt(ue),ue++):(Tr=a,mt===0&&sr(It)),Tr!==a)for(;Tr!==a;)Oe.push(Tr),X.test(n.charAt(ue))?(Tr=n.charAt(ue),ue++):(Tr=a,mt===0&&sr(It));else Oe=a;Oe!==a?(Qr=Z,Z=Sr()):(ue=Z,Z=a)}else ue=Z,Z=a;return Z===a&&(Z=ue,(ve=qc())!==a&&(Qr=Z,ve=Ji(ve)),(Z=ve)===a&&(Z=ue,(ve=Tw())!==a&&(Qr=Z,ve=Fs()),Z=ve)),mt--,Z===a&&(ve=a,mt===0&&sr(Le)),Z}function ic(){var Z,ve,Oe,Tr,Ts,Ni,bl;for(Z=ue,le.test(n.charAt(ue))?(n.charAt(ue),ue++):mt===0&&sr(_i),ve=ue,Oe=[],D.test(n.charAt(ue))?(Tr=n.charAt(ue),ue++):(Tr=a,mt===0&&sr(Jr));Tr!==a;)Oe.push(Tr),D.test(n.charAt(ue))?(Tr=n.charAt(ue),ue++):(Tr=a,mt===0&&sr(Jr));if(n.charCodeAt(ue)===46?(Tr=W,ue++):(Tr=a,mt===0&&sr(Di)),Tr!==a){if(Ts=[],D.test(n.charAt(ue))?(Ni=n.charAt(ue),ue++):(Ni=a,mt===0&&sr(Jr)),Ni!==a)for(;Ni!==a;)Ts.push(Ni),D.test(n.charAt(ue))?(Ni=n.charAt(ue),ue++):(Ni=a,mt===0&&sr(Jr));else Ts=a;Ts!==a?ve=Oe=[Oe,Tr,Ts]:(ue=ve,ve=a)}else ue=ve,ve=a;if(ve===a)if(ve=[],D.test(n.charAt(ue))?(Oe=n.charAt(ue),ue++):(Oe=a,mt===0&&sr(Jr)),Oe!==a)for(;Oe!==a;)ve.push(Oe),D.test(n.charAt(ue))?(Oe=n.charAt(ue),ue++):(Oe=a,mt===0&&sr(Jr));else ve=a;if(ve!==a){if(Oe=ue,n.charCodeAt(ue)===101?(Tr=V,ue++):(Tr=a,mt===0&&sr(Gr)),Tr!==a){if(le.test(n.charAt(ue))?(Ts=n.charAt(ue),ue++):(Ts=a,mt===0&&sr(_i)),Ts===a&&(Ts=null),Ni=[],D.test(n.charAt(ue))?(bl=n.charAt(ue),ue++):(bl=a,mt===0&&sr(Jr)),bl!==a)for(;bl!==a;)Ni.push(bl),D.test(n.charAt(ue))?(bl=n.charAt(ue),ue++):(bl=a,mt===0&&sr(Jr));else Ni=a;Ni!==a?Oe=Tr=[Tr,Ts,Ni]:(ue=Oe,Oe=a)}else ue=Oe,Oe=a;Oe===a&&(Oe=null),Qr=Z,Z=bo()}else ue=Z,Z=a;return Z}function vO(Z,ve){return Z.map(function(Oe){return Oe[ve]})}function bO(Z,ve,Oe){return[Z].concat(vO(ve,Oe))}if((o=u())!==a&&ue===n.length)return o;throw o!==a&&ue<n.length&&sr(xw()),k_(Ep,wo<n.length?n.charAt(wo):null,wo<n.length?Sw(wo,wo+1):Sw(wo,wo))}return t(e,Error),e.prototype.format=function(n){var s="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<n.length;o++)if(n[o].source===this.location.source){a=n[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+c.line+":"+c.column;if(a){var h=this.location.end,p=r("",c.line.toString().length," "),f=a[l.line-1],g=(l.line===h.line?h.column:f.length+1)-l.column||1;s+=`
 --> `+u+`
`+p+` |
`+c.line+" | "+f+`
`+p+" | "+r("",l.column-1," ")+r("",g,"^")}else s+=`
 at `+u}return s},e.buildMessage=function(n,s){var o={literal:function(f){return'"'+l(f.text)+'"'},class:function(f){var g=f.parts.map(function(y){return Array.isArray(y)?c(y[0])+"-"+c(y[1]):c(y)});return"["+(f.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(f){return f.description}};function a(f){return f.charCodeAt(0).toString(16).toUpperCase()}function l(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function u(f){return o[f.type](f)}function h(f){var g,y,v=f.map(u);if(v.sort(),v.length>0){for(g=1,y=1;g<v.length;g++)v[g-1]!==v[g]&&(v[y]=v[g],y++);v.length=y}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function p(f){return f?'"'+l(f)+'"':"end of input"}return"Expected "+h(n)+" but "+p(s)+" found."},{SyntaxError:e,parse:i}},(N1e=$6e).exports&&(N1e.exports=F1e());var OCt=$6e.exports;function I6e(t){if(!t||t.length===0)return null;if(typeof t=="string"){const r=k1e(t);return r&&r.length!==0?r:null}const e=t.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new B("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:k1e(r.value)}});e.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<e.length-1;r++){if(!fJe(e[r].effects,e[r+1].effects))throw new B("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});mJe(e[r].effects,e[r+1].effects)}return e.sort((r,i)=>i.scale-r.scale),e}function k1e(t){let e;if(!t)return[];try{e=OCt.parse(t)}catch(r){throw new B("effect:invalid-syntax","Invalid effect syntax",{value:t,error:r})}return e.map(r=>MCt(r))}function MCt(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return RCt(t);case"opacity":return $Ct(t);case"hue-rotate":return ICt(t);case"blur":return LCt(t);case"drop-shadow":return DCt(t);case"bloom":return NCt(t)}}catch(e){throw e.details.filter=t,e}throw new B("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function RCt(t){let e=1;return dO(t.parameters,1),t.parameters.length===1&&(e=Tf(t.parameters[0])),new kZ(t.name,e)}function $Ct(t){let e=1;return dO(t.parameters,1),t.parameters.length===1&&(e=Tf(t.parameters[0])),new gPe(e)}function ICt(t){let e=0;return dO(t.parameters,1),t.parameters.length===1&&(e=BCt(t.parameters[0])),new fPe(e)}function LCt(t){let e=0;return dO(t.parameters,1),t.parameters.length===1&&(e=Zle(t.parameters[0]),qN(e,t.parameters[0])),new cPe(e)}function DCt(t){const e=[];let r=null;for(const i of t.parameters)if(i.type==="color"){if(e.length&&Object.freeze(e),r)throw new B("effect:type-error","Accepts only one color",{});r=GCt(i)}else{const n=Zle(i);if(Object.isFrozen(e))throw new B("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(n),e.length===3&&qN(n,i)}if(e.length<2||e.length>3)throw new B("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new dPe(e[0],e[1],e[2]||0,r||L6e("black"))}function NCt(t){let e=1,r=0,i=0;return dO(t.parameters,3),t.parameters[0]&&(e=Tf(t.parameters[0])),t.parameters[1]&&(r=Zle(t.parameters[1]),qN(r,t.parameters[1])),t.parameters[2]&&(i=Tf(t.parameters[2])),new aPe(e,r,i)}function dO(t,e){if(t.length>e)throw new B("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function TG(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in Xle)return"<length>";if(t.unit in Yle)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function qN(t,e){if(t<0)throw new B("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function FCt(t){if(t.type!=="quantity"||t.unit!==null)throw new B("effect:type-error",`Expected <double>, Actual: ${TG(t)}`,{term:t})}function kCt(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new B("effect:type-error",`Expected <double> or <percentage>, Actual: ${TG(t)}`,{term:t})}const Yle={deg:1,grad:.9,rad:180/Math.PI,turn:360};function UCt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Yle[t.unit]!=null))throw new B("effect:type-error",`Expected <angle>, Actual: ${TG(t)}`,{term:t})}const Xle={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function zCt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Xle[t.unit]!=null))throw new B("effect:type-error",`Expected <length>, Actual: ${TG(t)}`,{term:t})}function Tf(t){kCt(t);const e=t.value;return qN(e,t),t.unit==="%"?.01*e:e}function VCt(t){return FCt(t),qN(t.value,t),t.value}function BCt(t){return UCt(t),t.value*Yle[t.unit]||0}function Zle(t){return zCt(t),t.value*Xle[t.unit]||0}function GCt(t){switch(t.colorType){case"hex":return pZe(t.value);case"named":return L6e(t.value);case"function":return qCt(t.value)}}function L6e(t){if(!N3e(t))throw new B("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return dZe(t)}const jCt=/^rgba?/i,HCt=/^hsla?/i;function qCt(t){if(dO(t.parameters,4),jCt.test(t.name))return[Tf(t.parameters[0]),Tf(t.parameters[1]),Tf(t.parameters[2]),t.parameters[3]?Tf(t.parameters[3]):1];if(HCt.test(t.name))return F3e(VCt(t.parameters[0]),Tf(t.parameters[1]),Tf(t.parameters[2]),t.parameters[3]?Tf(t.parameters[3]):1);throw new B("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function WCt(t,e,r){var i;try{return ZCt(t)}catch(n){(i=r==null?void 0:r.messages)==null||i.push(n)}return null}function YCt(t,e,r,i){try{const n=XCt(t);f2(r,n,e)}catch(n){i.messages&&i.messages.push(n)}}function XCt(t){const e=I6e(t);return e?gJe(e)?e.map(r=>r.toJSON()):e.map(({scale:r,effects:i})=>({scale:r,value:i.map(n=>n.toJSON())})):null}function ZCt(t){if(!t||t.length===0)return null;if(JCt(t)){const e=[];for(const r of t)e.push({scale:r.scale,value:U1e(r.value)});return e}return U1e(t)}function JCt(t){const e=t[0];return!!e&&"scale"in e}function U1e(t){if(!(t!=null&&t.length))return"";const e=[];for(const r of t){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[zy(r,"amount")];break;case"blur":i=[zy(r,"radius","pt")];break;case"hue-rotate":i=[zy(r,"angle","deg")];break;case"drop-shadow":i=[zy(r,"xoffset","pt"),zy(r,"yoffset","pt"),zy(r,"blurRadius","pt"),QCt(r,"color")];break;case"bloom":i=[zy(r,"strength"),zy(r,"radius","pt"),zy(r,"threshold")]}const n=`${r.type}(${i.filter(Boolean).join(" ")})`;I6e(n),e.push(n)}return e.join(" ")}function zy(t,e,r){if(t[e]==null)throw new B("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return r?t[e]+r:""+t[e]}function QCt(t,e){if(t[e]==null)throw new B("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const r=t[e];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}let Jle=class{constructor(e,r){this._storage=new Ske,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),r&&this._storage.registerRemoveFunc("",r)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,r,i=1){this._storage.put(this,e,r,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};new Jle(1e3);new De([128,128,128]);const KCt=new De("white");function e3t(t){var e;return((e=t.resource)==null?void 0:e.href)??""}function Anr(t,e){if(!t)return null;let r=null;return zb(t)?r=t3t(t):z7(t)&&(r=t.type==="cim"?ACt(t):t.color?new De(t.color):null),r?OD(r,e):null}function t3t(t){const e=t.symbolLayers;if(!e)return null;let r=null;return e.forEach(i=>{var n;i.type==="object"&&((n=i.resource)!=null&&n.href)||(r=i.type==="water"?i.color:i.material?i.material.color:null)}),r?new De(r):null}function OD(t,e){if(e==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*e,new De(r)}function r3t(t,e,r){const i=t.symbolLayers;if(!i)return;const n=s=>OD(e=e??s??(r!=null?KCt:null),r);i.forEach(s=>{var o,a;if(s.type!=="object"||!((o=s.resource)!=null&&o.href)||e)if(s.type==="water")s.color=n(s.color);else{const l=s.material!=null?s.material.color:null,c=n(l);s.material==null?s.material=new zh({color:c}):s.material.color=c,r!=null&&"outline"in s&&((a=s.outline)==null?void 0:a.color)!=null&&(s.outline.color=OD(s.outline.color,r))}})}function i3t(t,e,r){var i;(e=e??t.color)&&(t.color=OD(e,r)),r!=null&&"outline"in t&&((i=t.outline)!=null&&i.color)&&(t.outline.color=OD(t.outline.color,r))}function Onr(t,e,r){t&&(e||r!=null)&&(e&&(e=new De(e)),zb(t)?r3t(t,e,r):z7(t)&&i3t(t,e,r))}async function n3t(t,e){const r=t.symbolLayers;r&&await dB(r,async i=>s3t(i,e))}async function s3t(t,e){switch(t.type){case"extrude":a3t(t,e);break;case"icon":case"line":case"text":o3t(t,e);break;case"path":c3t(t,e);break;case"object":await l3t(t,e)}}function o3t(t,e){const r=D6e(e);r!=null&&(t.size=r)}function D6e(t){for(const e of t)if(typeof e=="number")return e;return null}function a3t(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function l3t(t,e){const{resourceSize:r,symbolSize:i}=await u3t(t),n=N6e(e,r,i);t.width=YI(e[0],i[0],r[0],n),t.depth=YI(e[1],i[1],r[1],n),t.height=YI(e[2],i[2],r[2],n)}function c3t(t,e){const r=N6e(e,Fg,[t.width,void 0,t.height]);t.width=YI(e[0],t.width,1,r),t.height=YI(e[2],t.height,1,r)}function N6e(t,e,r){for(let i=0;i<3;i++){const n=t[i];switch(n){case"symbol-value":{const s=r[i];return s!=null?s/e[i]:1}case"proportional":break;default:if(n&&e[i])return n/e[i]}}return 1}async function u3t(t){const{computeObjectLayerResourceSize:e}=await re(()=>import("./symbolLayerUtils-DkIMMIyJ.js"),__vite__mapDeps([])),r=await e(t,10),{width:i,height:n,depth:s}=t,o=[i,s,n];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function YI(t,e,r,i){switch(t){case"proportional":return r*i;case"symbol-value":return e??r;default:return t}}function h3t(t,e){const r=D6e(e);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const i=t.width/t.height;i>1?(t.width=r,t.height=r*i):(t.width=r*i,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function Mnr(t,e){if(t&&e)return zb(t)?n3t(t,e):void(z7(t)&&h3t(t,e))}function Rnr(t,e,r){if(t&&e!=null)if(zb(t)){const i=t.symbolLayers;i&&i.forEach(n=>{if(n&&n.type==="object")switch(r){case"tilt":n.tilt=(n.tilt??0)+e;break;case"roll":n.roll=(n.roll??0)+e;break;default:n.heading=(n.heading??0)+e}})}else z7(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=e))}function $nr(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function Inr(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}const Lnr=1.2,d3t=Fh,p3t=4;let EG=class{constructor(e,r,i,n){this.graphics3DSymbolLayer=e,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=n,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,un.ADD);if(e||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Zs.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,un.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=C()){return se(e,0,0,0)}getBoundingBoxObjectSpace(e=Ds()){return zi(e)}addObjectState(e,r){e===h_.Highlight&&(this.renderGeometries.forEach(i=>{const n=i.geometry.addHighlight();r.addRenderGeometry(i,n,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Zs.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(r=>{e.removeRenderGeometry(r)})}removeRenderGeometryObjectState(e,r){e.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Zs.HIGHLIGHT)}computeAttachmentOrigin(e){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(wE)&&(e.draped.origin[0]+=wE[0],e.draped.origin[1]+=wE[1],e.draped.num++)}async getProjectedBoundingBox(e,r,i,n,s){zi(s);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,z1e,i),cet(s,z1e)}if(r){let o;kf(s,wE);const a=ale(s,r.service.spatialReference,r);try{o=await r.service.queryElevation(wE[0],wE[1],n,a,"ground")}catch{}o!=null&&(s[2]=Math.min(s[2],o),s[5]=Math.max(s[5],o))}return s}_getRenderGeometryProjectedBoundingRect(e,r,i,n){if(this.boundingBox)HB(zm,this.boundingBox);else{const s=e.boundingSphere,o=s[3];zm[0]=s[0]-o,zm[1]=s[1]-o,zm[2]=s[2]-o,zm[3]=s[0]+o,zm[4]=s[1]+o,zm[5]=s[2]+o}return r(zm,0,2),this.calculateRelativeScreenBounds&&n.push({location:kf(zm),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),xse(zm,i)}};const z1e=Ht(),zm=Ds(),wE=C();function Q9(t,e,r){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=r,t.canvas}function F6e(t){const{size:e}=t.definition,r=t.fontString(e);let i=V1e.get(r);if(!i){const n=Q9(m3t,0,0).getContext("2d");t.setFontProperties(n,e);const s=n.measureText(g3t);i=new f3t(s.actualBoundingBoxAscent,s.actualBoundingBoxDescent),V1e.set(r,i)}return i}const V1e=new Map;let f3t=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,r){this.maxAscent=e,this.maxDescent=r}};const m3t={canvas:null},g3t=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),K9=1;let k6e=class{constructor(e,r,i,n){this.text=e,this._alignment=r,this._parameters=i,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.replaceAll(" "," ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let r=0;r<this._lines.length-1;r++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=Q9(B1e,RF,RF).getContext("2d"),r=this._parameters.definition.pixelRatio,i=this._fontSize*r;this._parameters.setFontProperties(e,i);let n=2*this._haloSize;const s=this._parameters.definition.font;s.style!=="italic"&&s.style!=="oblique"&&s.weight!=="bold"&&s.weight!=="bolder"||(n+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let o=0,a=0,l=0,c=0,u=0;this._lines.forEach((b,w)=>{const x=e.measureText(b),S=x.width/r,E=S+n;this._textWidths.push(S),this._lineWidths.push(E),o=Math.max(o,E),c=Math.max(c,x.actualBoundingBoxAscent/r),u=Math.max(u,x.actualBoundingBoxDescent/r),w===0&&(a=x.actualBoundingBoxAscent/r),w===this._lines.length-1&&(l=x.actualBoundingBoxDescent/r)});const h=F6e(this._parameters),p=Math.max(c,h.maxAscent),f=Math.max(u,h.maxDescent),g=a,y=this._parameters.definition.font.decoration==="underline"?f:l,v=o;this._metricsCached=new _3t(g,y,p,f,v)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*y3t}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,K9)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case pb.Left:return this._horizontalPadding;case pb.Center:return(this.displayWidth-this._lineWidths[e])/2;case pb.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,r,i){e.save();const n=r/=this.renderPixelRatio,s=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;r+=o,i+=a;const l=this._haloSize>0;l&&this._renderHalo(e,n,s,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],h=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,r+h,i),this._renderLineDecoration(e,r+h,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,r+this._getLineXOffset(c),i),this._renderLineDecoration(e,r+h,i,this._textWidths[c]),i+=this._lineSpacing}if(Si.TEXT_SHOW_BASELINE){e.strokeStyle=G1e,e.setLineDash([2,2]),e.lineWidth=1;let c=s+a;for(let u=0;u<this._lines.length;++u)this._drawLine(e,[n,c],[n+this.displayWidth,c]),c+=this._lineSpacing}if(Si.TEXT_SHOW_BORDER&&(e.strokeStyle=G1e,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[n,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,n,s,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,r,i,n,s=!1){if(this._parameters.definition.font.decoration==="none"||n===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._midLineAscent}const l=s?this._haloSize:0;e.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(r+n+l),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,r,i,n){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const s=this.renderedWidth,o=this.renderedHeight;n!==0?(n=we(n,0,Math.floor(o/2)),e.beginPath(),e.moveTo(r,i+n),e.arcTo(r,i,r+n,i,n),e.lineTo(r+s-n,i),e.arcTo(r+s,i,r+s,i+n,n),e.lineTo(r+s,i+o-n),e.arcTo(r+s,i+o,r+s-n,i+o,n),e.lineTo(r+n,i+o),e.arcTo(r,i+o,r,i+o-n,n),e.closePath()):e.rect(r,i,s,o)}_renderHalo(e,r,i,n,s){const o=this.renderedWidth,a=this.renderedHeight,l=Q9(B1e,Math.max(o,RF),Math.max(a,RF)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,n,s):this._renderHaloNative(c,n,s);let h=s;for(let p=0;p<this._lines.length;++p){const f=this._getLineXOffset(p);this._renderLineDecoration(c,n+f,h,this._textWidths[p],!0),h+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),e.globalAlpha=1}_renderHaloEmulated(e,r,i){for(let n=0;n<this._lines.length;++n){const s=this._lines[n],o=this._getLineXOffset(n);for(const[a,l]of U6e)this._fillText(e,s,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(e,r,i){const n=2*this._haloSize;for(let s=0;s<this._lines.length;++s){const o=this._lines[s],a=this._getLineXOffset(s),l=5,c=.1;for(let u=0;u<l;u++){const h=1-(l-1)*c+u*c;e.lineWidth=this._toRenderUnit(h*n),this._strokeText(e,o,r+a,i)}i+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,r,i,n){e.fillText(r,this._toRenderUnit(i),this._toRenderUnit(n))}_strokeText(e,r,i,n){e.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(n))}_drawLine(e,r,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,r,i){const n=this._toRenderUnit(r[0]),s=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(n)+.5,c=Math.ceil(n+o)-.5,u=Math.floor(s)+.5,h=Math.ceil(s+a)-.5;e.beginPath(),e.moveTo(l,u),e.lineTo(c,u),e.lineTo(c,h),e.lineTo(l,h),e.lineTo(l,u),e.stroke()}};const U6e=[];for(let e=0;e<360;e+=360/16)U6e.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var pb;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(pb||(pb={}));const B1e={canvas:null},y3t=.2,RF=512,G1e="rgb(255, 0, 255, 0.5)";let _3t=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,r,i,n,s){this.firstLineAscent=e,this.lastLineDescent=r,this.maxLineAscent=i,this.maxLineDescent=n,this.displayWidth=s}};const v3t=Object.freeze({left:0,center:.5,right:1}),T8=Object.freeze({"bottom-left":mr(0,0),bottom:mr(.5,0),"bottom-right":mr(1,0),left:mr(0,.5),center:mr(.5,.5),right:mr(1,.5),"top-left":mr(0,1),top:mr(.5,1),"top-right":mr(1,1)});function z6e(t){switch(t){case"left":return pb.Left;case"right":return pb.Right;default:return pb.Center}}function j1e(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function b3t(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function w3t(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function x3t(t){return t==="middle"?"center":t}function S3t(t,e){switch(t){case"top":return yr(e,0,K9);case"bottom":return yr(e,0,-K9);default:return vo(e,u_)}}let wA=class{constructor(e,r={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=xe(),this._shaderTransformation=null,this._boundingSphere=null,this.id=Dh(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.castShadow=r.castShadow??!1,r.objectShaderTransformation!=null&&this.objectShaderTransformationChanged(r.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){cs(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=xe()),Kr(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=hs()),ze(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*WP(this.shaderTransformation)),this._boundingSphere):$Re}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const H1e=Ce(0,0,1),T3t=16,E3t=1.5,eT=Rle,C3t=[eT/2,eT/2,1-eT/2,1-eT/2],P3t=[B9*eT,B9*eT];let gte=class V6e extends Cy{getCachedSize(){return{size:this._getIconSize()}}constructor(e,r,i,n){super(e,r,i,n),this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._patchTask=null,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(i!=null)this._prepareResourcesPrimitive(r,i);else{const n=e3t(this.symbolLayer),s=this._getCIMResource(n);s!=null?await this._prepareResourcesCIM(r,JSON.parse(s),e):await this._prepareResourcesHref(r,n,e)}}_getCIMResource(e){const r=bb(e);return(r==null?void 0:r.mediaType)==="application/json"?r.data:void 0}_validateOrThrow(){if(this._drivenProperties.size)return;const e=dG(this._getIconSize());if(e)throw new B("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,r=Math.round(e.size!=null?bs(e.size):T3t);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(e){let r=this._cimData;if(r&&r.symbol||this.logger.error("Can't create texture, CIM data is undefined"),r.primitiveOverrides){r=ae(r);const c=r.primitiveOverrides;v3.evaluateOverrides(c,e,this._arcadeInfo.geometryType,null,null),v3.applyOverrides(r.symbol,c)}const i=hne(JSON.stringify(r));let n=this._cimSymbolTextures.get(i);if(n)return n;const s=this._context.sharedResources.cimSymbolRasterizer,o=this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null;o&&v3.applyDictionaryTextOverrides(r.symbol,e,o,null);const a=this._cimScaleFactorOrFunction!=null?O2t(this._cimScaleFactorOrFunction,e):1;a!==1&&r.symbol&&Wle(r.symbol,a,!0);const l=aW.getEnvelope(r,null,s.resourceManager);if(l&&l.width&&l.height){const c=l.x+l.width/2,u=l.y+l.height/2,h=s.rasterize({type:"cim",data:r},l.width,l.height,c,u,1,"esriGeometryPoint"),p=new JS({x:-l.x/l.width-.5,y:(l.height+l.y)/l.height-.5});this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",p),n=new Zb(h,{width:(h==null?void 0:h.width)??1,height:(h==null?void 0:h.height)??1})}else n=new Zb(new ImageData(1,1),{width:1,height:1});return this._cimSymbolTextures.set(i,n),this._context.stage.add(n),n}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(A3t(r)){const{screenLength:i,minWorldLength:n,maxWorldLength:s}=r.verticalOffset;e.verticalOffset={screenLength:bs(i),minWorldLength:n||0,maxWorldLength:s??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,r){const i=this._getOutlineSize();if(cW(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const s=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>dSt(r));this._textureHandle=s,e.textureId=s.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=hSt(r),e.distanceFieldBoundingBox=C3t;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/eT,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,i){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const n=this._getIconSize(),s=n*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await op(this._context.sharedResources.textures.fromUrl(r,s,{signal:i}));if(o.ok===!1)throw ko(o.error),new B("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._textureHandle=o.value;const a=o.value.texture;this._size=this._computeSizeFromTexture(a,n),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,r,i){if(this._cimData=r,!this._context.sharedResources.cimSymbolRasterizer){const u=(await re(()=>import("./CIMSymbolRasterizer-TnFNdlZ4.js"),__vite__mapDeps([]))).CIMSymbolRasterizer;dt(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference))}const n=this._context.sharedResources.cimSymbolRasterizer,s=[],o=r,a=o==null?void 0:o.symbol;aW.fetchResources(a,n.resourceManager,s,i),aW.fetchFonts(a,n.resourceManager,s);const l=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):[],c=this._context.renderCoordsHelper.spatialReference;if(this._arcadeInfo={spatialReference:c,fields:l,geometryType:"esriGeometryPoint"},o!=null&&o.primitiveOverrides&&s.push(v3.createRenderExpressions(o.primitiveOverrides,this._arcadeInfo)),s.length>0&&(await Promise.all(s),dt(i)),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(u.scaleExpression){const h=u.scaleExpression,p=await hIe(h,this._context.layer.spatialReference,l);this._cimScaleFactorOrFunction=(f,g,y)=>{const v=R6e(p,f,{$view:y},"esriGeometryPoint",g);return v!==null?v:1}}}dt(i),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||uht}_getOutlineSize(){var i;let e=0;const r=this.symbolLayer;return((i=r.outline)==null?void 0:i.size)!=null?Math.max(bs(r.outline.size),0):(e=cW(this._getPrimitive())?E3t:0,Math.max(e,0))}_getOutlineColor(){var n;const e=this._getLayerOpacity(),r=this.symbolLayer,i=(n=r==null?void 0:r.outline)==null?void 0:n.color;if(i!=null){const s=De.toUnitRGB(i),o=i.a*e;return[s[0],s[1],s[2],o]}return[0,0,0,0]}_getFillColor(){var i,n;if(cW(this._getPrimitive()))return d3t;const e=this._getPrimitive()==null,r=(n=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:n.color;return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:e})}_getAnchorPos(e,r){return e==="relative"?mr((r.x||0)+.5,.5-(r.y||0)):e in T8?T8[e]:T8.center}_createMaterialAndAddToStage(e,r){if(this._cimData){this._fastUpdates=null;let i=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new yA(e),this._cimSymbolMaterials.set(e.textureId??0,i),r.add(i)),i}return this._fastUpdates=fA(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._materials[0]=new yA(e),r.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._patchTask=Ql(this._patchTask),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._textureHandle=lr(this._textureHandle)}_getScaleFactor(e,r){if(this._drivenProperties.size&&e.size){for(let i=0;i<3;i++){const n=e.size[i];n&&n!=="symbol-value"&&n!=="proportional"&&(e.size[i]=bs(n))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1}createGraphics3DGraphic(e){var h;const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;let i,n=[0,0];if(this._cimData){if(!this._cimData.symbol)return null;const p=this._generateTextureCIM(r),f={textureId:p.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(f,this._context.stage);const g=window.devicePixelRatio||1;n=[p.parameters.width/g,p.parameters.height/g]}else n=this._size,i=this._materials[0];const s=SD(r.geometry);if(s==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!((h=this._fastUpdates)!=null&&h.visualVariables.size)){const p=n[0]>n[1]?n[0]:n[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=mr(n[0]*l,n[1]*l),u=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,s,i,a,c,e.layer.uid):this._createAs3DShape(r,s,i,a,c,u,r.uid)}layerOpacityChanged(){const e=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=NN(V6e.elevationModeChangeTypes,i,n);if(s!==Dn.UPDATE)return s;const o=mp(n)||n==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,r){var i;for(const n in e.diff){if(n!=="visualVariables"||!mA(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return ls.RecreateSymbol;(i=this._materials[0])==null||i.setParameters(this._fastUpdates.materialParameters)}return ls.FastUpdate}prepareSymbolLayerPatch(e){var i;if((i=this._patchTask)==null||i.abort(),e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchResource(e,r)}_preparePatchResource(e,r){var l;if(!r.resource||r.resource.type!=="partial")return;const i=r.resource.diff;if(((l=i==null?void 0:i.href)==null?void 0:l.type)!=="complete")return;const n=i.href.newValue,{textures:s}=this._context.sharedResources;if(n==null||s==null||this._getCIMResource(n)!=null)return;const o=this._getIconSize(),a=o*this._context.graphicsCoreOwner.view.state.pixelRatio;e.symbolLayerStatePatches.push(()=>{this._patchTask=Ql(this._patchTask),this._patchTask=b_(c=>this._context.schedule(async(u,h)=>{const p=await op(s.fromUrl(n,a,{signal:h}));dt(h);const f=!p.ok;if(f&&ko(p.error),this._textureHandle=lr(this._textureHandle),this._patchTask=null,f){this._forEachMaterial(v=>{v.visible=!1,v.setParameters({textureId:null})});const y=`Failed to load (Request for icon resource failed: ${n})`;return void this.logger.error(new B("graphics3diconsymbollayer:request-failed",y))}this._textureHandle=p.value;const g=p.value.texture;this._size=this._computeSizeFromTexture(g,o),this._forEachMaterial(y=>{y.setParameters({textureId:g.id}),y.visible=!0})},c))}),delete i.href}_defaultElevationInfoNoZ(){return O3t}_createAs3DShape(e,r,i,n,s,o,a){const l=this.getFastUpdateAttrValues(e),c=this._context.layer.uid,u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:c}),h=mee(i,H1e,null,n,s,M3t,null,l,u),p=gle(this._context,r,h,o,a);if(p==null)return null;const f=new Ey(this,p.object,[h],null,null,xT,o);return f.alignedSampledElevation=p.sampledElevation,f.needsElevationUpdates=mp(o.mode)||o.mode==="absolute-height",f.getScreenSize=this._createScreenSizeGetter(s,l),f.calculateRelativeScreenBounds=g=>i.calculateRelativeScreenBounds(f.getScreenSize(),1,g),xD(f,r,this._context.elevationProvider),f}_createAsOverlay(e,r,i,n,s,o){i.renderPriority=this._renderPriority;const a=C();Cn(r,a,this._context.overlaySR),a[2]=Ule;const l=this._context.clippingExtent;if(l!=null&&!wse(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),h=mee(i,H1e,a,n,s,null,null,c,u),p=new wA(h,{layerUid:o,graphicUid:e.uid}),f=new EG(this,[p],null,this._context.drapeSourceRenderer);return f.getScreenSize=this._createScreenSizeGetter(s,c),f.calculateRelativeScreenBounds=g=>i.calculateRelativeScreenBounds(f.getScreenSize(),1,g),f}_createScreenSizeGetter(e,r){const i=this._outlineSize+2;if(this._fastUpdates&&r){const o=e[0]/this._symbolTextureRatio,a=e[1]/this._symbolTextureRatio;return(l=Ye())=>{const[c,u]=qae(R3t,this._fastUpdates.materialParameters,r);return l[0]=c*o+i,l[1]=u*a+i,l}}const n=e[0]/this._symbolTextureRatio+i,s=e[1]/this._symbolTextureRatio+i;return(o=Ye())=>(o[0]=n,o[1]=s,o)}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),r=Ce(e,e,e),i=hl(1),n=e*i,s=Ce(n,n,n);return new IN({size:!0,color:!0,rotation:!0,opacity:!1},r,s,i)}_forEachMaterial(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}_computeSizeFromTexture({parameters:e},r){const i=(e.width??1)/(e.height??1);return i>1?[r,Math.round(r/i)]:[Math.round(r*i),r]}test(){return{...super.test(),material:this._materials[0]}}};function A3t(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function cW(t){return t!=null&&(t==="cross"||t==="x")}gte.PRIMITIVE_SIZE=P3t,gte.elevationModeChangeTypes={definedChanged:Dn.UPDATE,staysOnTheGround:Dn.NONE,onTheGroundChanged:Dn.RECREATE};const O3t={mode:"relative-to-ground",offset:0},M3t=Xt(0,0,0,1),R3t=C();function yte(t){switch(t){case"butt":return ep.BUTT;case"square":return ep.SQUARE;case"round":return ep.ROUND;default:return null}}function q1e(t){return t==="diamond"?"kite":t}function _te(t,e,r=null){const i=[],n=e.mapPositions;$3t(e,i);const s=i[0][1].data,o=i[0][1].indices.length,a=ow(o);return I3t(e,i,a),N3t(e,i,a),L3t(e,i,a),D3t(e,i,a),F3t(e,i,a),k3t(e,i,a),U3t(e,i,s),new Is(t,i,n,Ln.Line,r)}function $3t(t,e){const{attributeData:{position:r},removeDuplicateStartEnd:i}=t,n=z3t(r)&&i,s=r.length/3-(n?1:0),o=new Array(2*(s-1)),a=n?r.slice(0,-3):r;let l=0;for(let c=0;c<s-1;c++)o[l++]=c,o[l++]=c+1;e.push([R.POSITION,new tt(a,o,3,n)])}function I3t(t,e,r){if(t.attributeData.colorFeature!=null)return;const i=t.attributeData.color;e.push([R.COLOR,new tt(i??Bd,r,4)])}function L3t(t,e,r){t.attributeData.normal&&e.push([R.NORMAL,new tt(t.attributeData.normal,r,3)])}function D3t(t,e,r){t.attributeData.colorFeature!=null&&e.push([R.COLORFEATUREATTRIBUTE,new tt([t.attributeData.colorFeature],r,1,!0)])}function N3t(t,e,r){t.attributeData.sizeFeature==null&&e.push([R.SIZE,new tt([t.attributeData.size??1],r,1,!0)])}function F3t(t,e,r){t.attributeData.sizeFeature!=null&&e.push([R.SIZEFEATUREATTRIBUTE,new tt([t.attributeData.sizeFeature],r,1,!0)])}function k3t(t,e,r){t.attributeData.opacityFeature!=null&&e.push([R.OPACITYFEATUREATTRIBUTE,new tt([t.attributeData.opacityFeature],r,1,!0)])}function U3t(t,e,r){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Fe.Global||!t.overlayInfo.spatialReference.isGeographic)return;const i=Go(r.length),n=zr(t.overlayInfo.spatialReference);for(let h=0;h<i.length;h+=3)Ose(r,h,i,h,n);const s=r.length/3,o=Tn(s+1);let a=V3t,l=B3t,c=0,u=0;yr(a,i[u++],i[u++]),u++,o[0]=0;for(let h=1;h<s+1;++h)h===s&&(u=0),yr(l,i[u++],i[u++]),u++,c+=yOe(a,l),o[h]=c,[a,l]=[l,a];e.push([R.DISTANCETOSTART,new tt(o,e[0][1].indices,1,!0)])}function z3t(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const V3t=Ye(),B3t=Ye();function znr(t,e){if(t==null||t.length===0)return[];const r=[];return t.forEach(i=>{const n=i.length,s=Go(3*n);i.forEach((a,l)=>{s[3*l]=a[0],s[3*l+1]=a[1],s[3*l+2]=a[2]});const o={attributeData:{position:s,normal:e},removeDuplicateStartEnd:!1};r.push(o)}),r}function G3t(t,e,r,i){const n=t.type==="polygon"?ly.CCW_IS_HOLE:ly.NONE,s=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=fN(s,!!t.hasZ,n,t.spatialReference),l=Go(o.length),c=Q4e(o,t.spatialReference,0,l,0,o,0,o.length/3,e,r,i),u=c!=null;return{lines:u?B6e(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function j3t(t,e){const r=t.type==="polygon"?ly.CCW_IS_HOLE:ly.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:n,outlines:s}=fN(i,!1,r),o=an(n,t.spatialReference,0,n,e,0,n.length/3);for(let a=2;a<n.length;a+=3)n[a]=Ule;return{lines:o?B6e(s,n):[],projectionSuccess:o}}function B6e(t,e,r=null){const i=new Array;for(const{index:n,count:s}of t){if(s<=1)continue;const o=3*n,a=3*s;i.push({position:Qd(e,3*n,3*s),mapPositions:r!=null?Qd(r,o,a):void 0})}return i}function G6e(t){const e=new Fr,r=t.multipassEnabled&&(t.output===G.Color||t.output===G.Alpha),i=t.space===Dc.World;e.include(XFe,t),e.include(dke,t),t.output===G.LinearDepth&&e.include(g_,t);const{vertex:n,fragment:s}=e;return s.include(bp),Uu(n,t),e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.PREVPOSITION,"vec3"),e.attributes.add(R.UV0,"vec2"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),Bb(e),r&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),n.uniforms.add(new ci("nearFar",(o,a)=>a.camera.nearFar),new Or("viewport",(o,a)=>a.camera.fullViewport)),n.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(T`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(e.attributes.add(R.NORMAL,"vec3"),hA(n),n.constants.add("tiltThreshold","float",.7),n.code.add(T`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):n.code.add(T`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),n.code.add(T`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===a2.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===Dc.Screen&&(n.uniforms.add(new _n("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),n.code.add(T`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),n.code.add(T`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),n.uniforms.add(new Ie("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),n.code.add(T`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),iO(n),W7(e),n.code.add(T`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position, 1.0);
vec4 prev = view * vec4(prevPosition, 1.0);
clip(pos, prev);`),i?(t.hideOnShortSegments&&n.code.add(T`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),n.code.add(T`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(n.code.add(T`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===Dc.Screen&&n.code.add(T`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),n.code.add(T`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&e.include(Yu,t),e.include(Wn,t),s.uniforms.add(new Or("intrinsicColor",o=>o.color),new ft("tex",o=>o.markerTexture)),s.include(Ty),e.constants.add("texelSize","float",1/ET),s.code.add(T`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",$le/ET),e.constants.add("relativeTipLineWidth","float",wSt),s.code.add(T`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",sa),s.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===G.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===G.Alpha?T`fragColor = vec4(finalColor.a);`:""}
    ${t.output===G.Color?T`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===G.Color&&t.transparencyPassType===vt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===G.Highlight?T`fragColor = vec4(1.0);`:""}
    ${t.output===G.LinearDepth?T`outputDepth(linearDepth);`:""}
  }
  `),e}const H3t=Object.freeze(Object.defineProperty({__proto__:null,build:G6e},Symbol.toStringTag,{value:"Module"})),j6e=new Map([[R.POSITION,0],[R.PREVPOSITION,1],[R.UV0,2],[R.NORMAL,3],[R.COLOR,4],[R.COLORFEATUREATTRIBUTE,4],[R.SIZE,5],[R.SIZEFEATUREATTRIBUTE,5],[R.OPACITYFEATUREATTRIBUTE,6]]);let H6e=class q6e extends Zr{initializeProgram(e){return new Br(e.rctx,q6e.shader.get().build(this.configuration),j6e)}_makePipelineState(e,r){const i=this.configuration,n=e===vt.NONE;return Bt({blending:i.output===G.Color||i.output===G.Alpha?n?Bh:$_(e):null,depthTest:i.space===Dc.Draped?null:{func:yw(e)},depthWrite:i.space===Dc.Draped?null:n?i.writeDepth?Wu:null:oG(e),colorWrite:rr,stencilWrite:i.hasOccludees?gy:null,stencilTest:i.hasOccludees?r?Yb:_w:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Bt({blending:Bh,depthTest:N9,depthWrite:null,colorWrite:rr,stencilWrite:null,stencilTest:T5e}),this._occluderPipelineOpaque=Bt({blending:Bh,depthTest:N9,depthWrite:null,colorWrite:rr,stencilWrite:x5e,stencilTest:S5e}),this._occluderPipelineMaskWrite=Bt({blending:null,depthTest:cle,depthWrite:null,colorWrite:null,stencilWrite:gy,stencilTest:Yb})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,r,i){return e?this._occludeePipelineState:this.configuration.occluder?i?this._occluderPipelineTransparent:r?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};H6e.shader=new Vr(H3t,()=>re(()=>Promise.resolve().then(()=>Ljt),void 0));let q3t=class extends mw{constructor(e){super(e,new Y3t),this.produces=new Map([[de.OPAQUE_MATERIAL,r=>r===G.Highlight||W0(r)&&this.parameters.renderOccluded===Wr.OccludeAndTransparentStencil],[de.OPAQUE_NO_SSAO_DEPTH,r=>r===G.LinearDepth],[de.OCCLUDER_MATERIAL,r=>Vge(r)&&this.parameters.renderOccluded===Wr.OccludeAndTransparentStencil],[de.TRANSPARENT_OCCLUDER_MATERIAL,r=>Vge(r)&&this.parameters.renderOccluded===Wr.OccludeAndTransparentStencil],[de.TRANSPARENT_MATERIAL,r=>W0(r)&&this.parameters.writeDepth],[de.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,r=>W0(r)&&!this.parameters.writeDepth],[de.DRAPED_MATERIAL,r=>r===G.Color||r===G.Highlight]]),this._vertexAttributeLocations=j6e,this._configuration=new Po,this._layout=this.createLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.space=r.slot===de.DRAPED_MATERIAL?Dc.Draped:this.parameters.worldSpace?Dc.World:Dc.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==ep.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===Wr.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=ln().vec3f(R.POSITION).vec3f(R.PREVPOSITION).vec2f(R.UV0);return this.parameters.worldSpace&&e.vec3f(R.NORMAL),this.parameters.vvSize?e.f32(R.SIZEFEATUREATTRIBUTE):e.f32(R.SIZE),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4f(R.COLOR),this.parameters.vvOpacity&&e.f32(R.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new X3t(this._layout,this.parameters)}createGLMaterial(e){return new W3t(e)}},W3t=class extends hae{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const r=this._material.parameters.markerPrimitive;return r!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(r,this._markerPrimitive)}),this._markerPrimitive=r),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(H6e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==G.Color&&this._output!==G.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},Y3t=class extends DN{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=ep.BUTT,this.anchor=a2.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},X3t=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,r,i,n,s){const o=i.attributes.get(R.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.attributes.get(R.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let u=1,h=0;this._parameters.vvSize?h=i.attributes.get(R.SIZEFEATUREATTRIBUTE).data[0]:i.attributes.has(R.SIZE)&&(u=i.attributes.get(R.SIZE).data[0]);let p=[1,1,1,1],f=0;this._parameters.vvColor?f=i.attributes.get(R.COLORFEATUREATTRIBUTE).data[0]:i.attributes.has(R.COLOR)&&(p=i.attributes.get(R.COLOR).data);let g=0;this._parameters.vvOpacity&&(g=i.attributes.get(R.OPACITYFEATUREATTRIBUTE).data[0]);const y=new Float32Array(n.buffer);let v=s*(this.vertexBufferLayout.stride/4);const b=(E,P,M,L)=>{if(y[v++]=E[0],y[v++]=E[1],y[v++]=E[2],y[v++]=P[0],y[v++]=P[1],y[v++]=P[2],y[v++]=M[0],y[v++]=M[1],this._parameters.worldSpace&&(y[v++]=l[0],y[v++]=l[1],y[v++]=l[2]),this._parameters.vvSize?y[v++]=h:y[v++]=u,this._parameters.vvColor)y[v++]=f;else{const U=Math.min(4*L,p.length-4);y[v++]=p[U],y[v++]=p[U+1],y[v++]=p[U+2],y[v++]=p[U+3]}this._parameters.vvOpacity&&(y[v++]=g)};let w;(function(E){E[E.ASCENDING=1]="ASCENDING",E[E.DESCENDING=-1]="DESCENDING"})(w||(w={}));const x=(E,P)=>{const M=se(Z3t,o[3*E],o[3*E+1],o[3*E+2]),L=J3t;let U=E+P;do se(L,o[3*U],o[3*U+1],o[3*U+2]),U+=P;while(HT(M,L)&&U>=0&&U<a);e&&(ze(M,M,e),ze(L,L,e)),b(M,L,[-1,-1],E),b(M,L,[1,-1],E),b(M,L,[1,1],E),b(M,L,[-1,-1],E),b(M,L,[1,1],E),b(M,L,[-1,1],E)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||x(0,w.ASCENDING),S!=="end"&&S!=="begin-end"||x(a-1,w.DESCENDING)}};const Z3t=C(),J3t=C(),Ga={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},Q3t={dash:Ga.dash,"dash-dot":[...Ga.dash,...Ga.dot],dot:Ga.dot,"long-dash":Ga["long-dash"],"long-dash-dot":[...Ga["long-dash"],...Ga.dot],"long-dash-dot-dot":[...Ga["long-dash"],...Ga.dot,...Ga.dot],none:null,"short-dash":Ga["short-dash"],"short-dash-dot":[...Ga["short-dash"],...Ga["short-dot"]],"short-dash-dot-dot":[...Ga["short-dash"],...Ga["short-dot"],...Ga["short-dot"]],"short-dot":Ga["short-dot"],solid:null},K3t=8;function ePt(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function Hnr(t){return{pattern:[t,t],pixelRatio:2}}function W6e(t){return t!=null&&t.type==="style"?tPt(t.style):null}function tPt(t){return t!=null?ePt(Q3t[t],K3t):null}const rPt=["polyline","polygon","extent"],W1e=new IN({size:!0,color:!0,rotation:!1,opacity:!0});let Y6e=class X6e extends Cy{constructor(e,r,i,n){super(e,r,i,n)}async doLoad(){if(this._fastUpdates=fA(this._context.renderer,W1e),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:hl(1))<0)throw new B("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,r=!1){var s,o;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const n={width:this._computeMaterialWidth((s=this.symbolLayer)==null?void 0:s.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:yte(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:W6e(this.symbolLayer.pattern)};return(o=this._fastUpdates)!=null&&o.visualVariables?{...n,...this._fastUpdates.materialParameters}:n}get _materialColor(){var e;return(e=this.symbolLayer.material)==null?void 0:e.color}get _markerColor(){var e;return(e=this.symbolLayer.marker)==null?void 0:e.color}get _lineMaterial(){return this._materials[zn.Line]==null&&(this._materials[zn.Line]=new f3(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[zn.Line])),this._materials[zn.Line]}get _ringMaterial(){return this._materials[zn.Ring]==null&&(this._materials[zn.Ring]=new f3(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[zn.Ring])),this._materials[zn.Ring]}get _wireframeLineMaterial(){return this._materials[zn.LineWireframe]==null&&(this._materials[zn.LineWireframe]=new f3({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[zn.LineWireframe])),this._materials[zn.LineWireframe]}get _wireframeRingMaterial(){return this._materials[zn.RingWireframe]==null&&(this._materials[zn.RingWireframe]=new f3({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[zn.RingWireframe])),this._materials[zn.RingWireframe]}get _markerMaterial(){return this._materials[zn.Marker]==null&&this.symbolLayer.marker!=null&&(this._materials[zn.Marker]=new q3t({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:q1e(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[zn.Marker])),this._materials[zn.Marker]}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0}_getDrivenSize(e){return this._drivenProperties.size&&e.size?bs(rxt(e.size)):1}_getDrivenColor(e){const r=Xt(1,1,1,1);return this._drivenProperties.color&&e.color&&(r[0]=e.color[0],r[1]=e.color[1],r[2]=e.color[2],e.color.length>0&&(r[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(r[3]=e.opacity),r}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,rPt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,r.uid)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables")return ls.RecreateSymbol;{const n=this._fastUpdates;if(!mA(n,r,W1e))return ls.RecreateSymbol;this._forEachMaterial(s=>s==null?void 0:s.setParameters(n.materialParameters))}}return ls.FastUpdate}prepareSymbolLayerPatch(e){var s,o;if(e.diff.type!=="partial")return;const r=e.diff.diff,i={};((s=r.size)==null?void 0:s.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((o=r.cap)==null?void 0:o.type)==="complete"&&(i.cap=yte(r.cap.newValue??"butt"),delete r.cap);const n=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,n),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a==null?void 0:a.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((e,r)=>this._updateMaterialLayerOpacity(e,r===zn.Marker))}_forEachMaterial(e){this._materials.forEach(e)}_updateMaterialLayerOpacity(e,r=!1){var a,l;if(e==null)return;const i=e.parameters.color,n=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,s=this._patternHidesLine&&!r?0:this._getCombinedOpacity(n),o=Xt(i[0],i[1],i[2],s);e.setParameters({color:o})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=NN(X6e.elevationModeChangeTypes,i,n);if(s!==Dn.UPDATE)return s;const o=mp(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r==null?void 0:r.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof br)return ku.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,r,i){const n=e.graphic,s=this._getGeometryAsPolygonOrPolyline(n.geometry),o=s.type==="polygon"?s.rings:s.paths,a=new Array,l=Ds(),c=G3t(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),u=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,u,"LineSymbol3DLayer");for(let f=0;f<c.lines.length;f++){const g=c.lines[f],y=g.position,v=g.mapPositions;if(this._context.clippingExtent!=null&&(zi(l),Ru(l,v),!Uf(l,this._context.clippingExtent)))continue;const b=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,y,v,s.type,XI.ELEVATED,i);a.push(b),Si.LINE_WIREFRAMES&&a.push(b.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(b.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const h=new I_({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),p=new Ey(this,h,a,null,null,Avt,r);return p.alignedSampledElevation=c.sampledElevation,p.needsElevationUpdates=mp(r.mode),p}_createGeometry(e,r,i,n,s,o,a){var y,v,b;const l=o===XI.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=s==="polygon",u=(y=this._fastUpdates)==null?void 0:y.visualVariables.color,h=(v=this._fastUpdates)==null?void 0:v.visualVariables.size,p=(b=this._fastUpdates)==null?void 0:b.visualVariables.opacity,f=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),g={position:i,size:h?null:this._getDrivenSize(r.renderingInfo),color:u?null:this._getDrivenColor(r.renderingInfo),sizeFeature:h?tm(h.field,r.graphic):null,colorFeature:u?tm(u.field,r.graphic):null,opacityFeature:p?tm(p.field,r.graphic):null};return _te(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:n,attributeData:g},f)}_createAsOverlay(e,r){const i=e.graphic,n=this._getGeometryAsPolygonOrPolyline(i.geometry),s=n.type==="polygon"?n.rings:n.paths,o=n.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=Si.LINE_WIREFRAMES?n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=Ds(),h=zi(),p=j3t(n,this._context.overlaySR),f=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,s,f,"LineSymbol3DLayer");for(const g of p.lines){if(zi(u),Ru(u,g.position),!Uf(u,this._context.clippingExtent))continue;YP(h,u);const y=v=>{const b=this._createGeometry(v,e,g.position,void 0,n.type,XI.DRAPED,i.uid),w=new wA(b,{layerUid:r,graphicUid:i.uid});c.push(w)};if(l!=null){y(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||Ru(u,g.position,0,1),v!=="end"&&v!=="begin-end"||Ru(u,g.position,g.position.length-3,1)}y(o),Si.LINE_WIREFRAMES&&y(a)}return new EG(this,c,h,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){var r;return e=e??hl(1),this._drivenProperties.size?(r=this._fastUpdates)!=null&&r.visualVariables.size?bs(1):1:bs(e)}_prepareMaterialPatch(e,r,i){var a,l;const n=r.material;if(n==null)return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._materials[zn.Marker],e));if(n.type==="collection")return;const s=n.type==="complete"?(a=n.newValue)==null?void 0:a.color:((l=n.diff.color)==null?void 0:l.type)==="complete"?n.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(s);i.useMaterialColor&&this._patchMaterialColor(uN(o),this._materials[zn.Marker],e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._materials[zn.Line],e),delete r.material}_prepareMarkerPatch(e,r){var u;const i=r.marker,n=this._markerMaterial;if(i==null||i.type!=="partial"||i.diff==null||i.diff.placement!=null||i.diff.style!=null&&i.diff.style.type!=="complete"||i.diff.color!=null&&i.diff.color.type!=="complete"||n==null)return{changed:!1,useMaterialColor:this._markerColor==null};const s=i.diff.color,o=s!=null,a=o?s.newValue:null,l=a==null&&this._markerColor==null;a&&this._patchMaterialColor(this._getCombinedOpacityAndColor(a),n,e);const c=(u=i.diff.style)==null?void 0:u.newValue;return c&&e.symbolLayerStatePatches.push(()=>n.setParameters({markerPrimitive:q1e(c)})),delete r.marker,{changed:o,useMaterialColor:l}}_patchMaterialColor(e,r,i){r!=null&&i.symbolLayerStatePatches.push(()=>r.setParameters({color:e}))}};var XI,zn;Y6e.elevationModeChangeTypes={definedChanged:Dn.RECREATE,staysOnTheGround:Dn.NONE,onTheGroundChanged:Dn.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(XI||(XI={})),function(t){t[t.Line=0]="Line",t[t.Ring=1]="Ring",t[t.LineWireframe=2]="LineWireframe",t[t.RingWireframe=3]="RingWireframe",t[t.Marker=4]="Marker"}(zn||(zn={}));var RS;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(RS||(RS={}));let Z6e=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=G0.KTX2_ENCODING}};function ZI(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function iPt(t){const e=new Blob([t]),r=await e.text();return JSON.parse(r)}async function nPt(t,e){if(e===G0.KTX2_ENCODING)return new Z6e(t);const r=new Blob([t],{type:e}),i=URL.createObjectURL(r),n=new Image;if(ne("esri-iPhone"))return new Promise((s,o)=>{const a=()=>{c(),s(n)},l=u=>{c(),o(u)},c=()=>{URL.revokeObjectURL(i),n.removeEventListener("load",a),n.removeEventListener("error",l)};n.addEventListener("load",a),n.addEventListener("error",l),n.src=i});try{n.src=i,await n.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(i),n}function Lg(t){if(t==null)return null;const e=t.offset!=null?t.offset:sFe,r=t.rotation!=null?t.rotation:0,i=t.scale!=null?t.scale:oFe,n=yI(1,0,0,0,1,0,e[0],e[1],1),s=yI(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=yI(i[0],0,0,0,i[1],0,0,0,1),a=gi();return XP(a,s,o),XP(a,n,a),a}let sPt=class extends Ey{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(e,r){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:i}=this,n=i.geometries.slice();i.removeAllGeometries();const s=zP(uW,i.transformation),o=r.getOrigin(s);for(const a of n){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,i.addGeometry(c)}this._originalGeometries=n}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:r}=this,i=r.geometries.map(n=>e(n.material));r.removeAllGeometries();for(let n=0;n<this._originalGeometries.length;n++){const s=this._originalGeometries[n],o=i[n];o.setParameters({modelTransformation:null}),o===s.material?r.addGeometry(s):r.addGeometry(s.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,r,i){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:n}=this;if(n.geometries.length===0)return;const s=n.geometries[0].localOrigin,o=zP(uW,e),a=i.getOrigin(o);if(a===s)return;const l=(r==null?void 0:r.localMatrix)??fn;n.shaderTransformation=null,n.transformation=e,n.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,r,i){const{stageObject:n}=this,s=(r==null?void 0:r.localMatrix)??fn;if(!this._fastTransformUpdatesEnabled)return n.shaderTransformation=null,n.transformation=e,n.geometries.forEach(f=>{f.transformation=s}),void(this._fastUpdateEdgeTransform()||this.resetEdgeObject(i));const o=n.transformation,a=n.geometries[0].transformation,l=e,c=s,u=Kr(Y1e,o,a),h=Kr(X1e,l,c),p=Kr(Z1e,h,us(Z1e,a));n.shaderTransformation=p,this._setFastMaterialTransformation({matA:u,matB:h}),this._fastUpdateEdgeTransform()||this.resetEdgeObject(i)}alignWithElevation(e,r,i,n){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,r,i,n);i!=null&&hG(this.elevationContext.featureExpressionInfoContext,i);const s=(g,y)=>qb(g,e,this.elevationContext,r,y),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=Kr(Y1e,a,l),u=o.effectiveTransformation,h=cs(oPt,u);this.alignedSampledElevation=xT(this,this.elevationContext,e.spatialReference,s,r,h),o.shaderTransformation=h;const p=o.geometries[0].transformation,f=Kr(X1e,h,p);this._setFastMaterialTransformation({matA:c,matB:f}),this._fastUpdateEdgeTransform()||this.resetEdgeObject(n)}_setFastMaterialTransformation({matA:e,matB:r}){const{stageObject:i}=this;if(i.geometries.length===0)return;const n=i.geometries[0].localOrigin,s=aN(aPt,oe(uW,n.vec3,-1)),o=Kr(J1e,s,e),a=Kr(Q1e,s,r),l=us(J1e,o),c=Kr(Q1e,a,l);for(const u of i.geometries)u.material.setParameters({modelTransformation:c})}_fastUpdateEdgeTransform(){return this._stageLayer.stage.renderer.ensureEdgeView().fastUpdateObject3DEdgesTransform(this.stageObject)}};const uW=C(),Y1e=xe(),X1e=xe(),oPt=xe(),Z1e=xe(),J1e=xe(),Q1e=xe(),aPt=xe();let lPt=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,r,i){e.enableFastTransformUpdates(n=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(n))return n;const o=r.byMaterial(n);return this._fastTransformOriginalMaterials.set(n,o),r.delete(n),n}const s=new gm(n.parameters);return i.stage.add(s),this._fastTransformClonedMaterials.set(s,n),s},i.localOriginFactory)}disable(e,r,i){const n=new Set,s=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,u=this._fastTransformOriginalMaterials.get(c);return r.has(u.uid)?(n.add(c),r.byUid(u.uid).material):(s.add(c),u.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),i.stage.remove(a),l});for(const o of n)this._fastTransformOriginalMaterials.delete(o),i.stage.remove(o);for(const o of s){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),r.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,r,i){this._graphicReferenceCount--,this.disable(e,r,i)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:r})=>r)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},cPt=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,r){this._byUid.set(e,r),this._byMaterial.set(r.material,r)}delete(e){var i;const r=(i=this._byMaterial.get(e))==null?void 0:i.uid;r&&(this._byUid.delete(r),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};const uPt=ln().vec3f(R.POSITION),hPt=ln().vec3f(R.POSITION).vec2f(R.UV0),dPt=ln().vec3f(R.POSITION).vec4u8(R.COLOR);ln().vec3f(R.POSITION).vec4u8(R.OBJECTANDLAYERIDCOLOR);const pPt=ln().vec3f(R.POSITION).vec2f(R.UV0).vec4u8(R.OBJECTANDLAYERIDCOLOR);ln().vec3f(R.POSITION).vec4u8(R.COLOR).vec4u8(R.OBJECTANDLAYERIDCOLOR);function J6e(t){const e=new Fr,{vertex:r,fragment:i}=e;return e.include($c,t),e.include(L2,t),Uu(r,t),e.attributes.add(R.POSITION,"vec3"),e.varyings.add("vpos","vec3"),r.code.add(T`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`),t.output===G.Highlight&&e.include(gw,t),e.include(Wn,t),i.uniforms.add(new Ie("alphaCoverage",(n,s)=>Math.min(1,n.width*s.camera.pixelRatio))),t.hasVertexColors||i.uniforms.add(new Or("constantColor",n=>n.color)),i.code.add(T`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    ${t.output===G.ObjectAndLayerIdColor?T`color.a = 1.0;`:""}

    if (color.a < ${T.float(sa)}) {
      discard;
    }

    ${t.output===G.Color?T`fragColor = highlightSlice(color, vpos);`:""}
    ${t.output===G.Highlight?T`outputHighlight();`:""}
  }
  `),e}const fPt=Object.freeze(Object.defineProperty({__proto__:null,build:J6e},Symbol.toStringTag,{value:"Module"}));let Q6e=class K6e extends Zr{initializeProgram(e){return new Br(e.rctx,K6e.shader.get().build(this.configuration),Nr)}initializePipeline(){const e=this.configuration,r=ya(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),i=(n,s=null,o=null)=>Bt({blending:s,depthTest:cle,depthWrite:o,colorWrite:rr,stencilWrite:e.hasOccludees?gy:null,stencilTest:e.hasOccludees?n?Yb:_w:null});return e.output===G.Color?(this._occludeePipelineState=i(!0,e.transparent?r:null,Wu),i(!1,e.transparent?r:null,Wu)):i(!1)}get primitiveType(){return dr.LINES}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};Q6e.shader=new Vr(fPt,()=>re(()=>Promise.resolve().then(()=>Djt),void 0));let wC=class extends Zl{constructor(){super(...arguments),this.output=G.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}};d([H({count:G.COUNT})],wC.prototype,"output",void 0),d([H()],wC.prototype,"hasSlicePlane",void 0),d([H()],wC.prototype,"hasVertexColors",void 0),d([H()],wC.prototype,"transparent",void 0),d([H()],wC.prototype,"hasOccludees",void 0);let K1e=class extends mw{constructor(e){super(e,new gPt),this._configuration=new wC,this.produces=new Map([[de.OPAQUE_MATERIAL,r=>r===G.Color||r===G.Highlight||r===G.ObjectAndLayerIdColor]])}getConfiguration(e){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!e.visible)return;if(!PAe(r))return void K.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes.get(R.POSITION).data,l=i.camera,c=_Pt;vo(c,i.point);const u=2;se(wM[0],c[0]-u,c[1]+u,0),se(wM[1],c[0]+u,c[1]+u,0),se(wM[2],c[0]+u,c[1]-u,0),se(wM[3],c[0]-u,c[1]-u,0);for(let y=0;y<4;y++)if(!l.unprojectFromRenderScreen(wM[y],Vy[y]))return;rl(l.eye,Vy[0],Vy[1],hW),rl(l.eye,Vy[1],Vy[2],dW),rl(l.eye,Vy[2],Vy[3],pW),rl(l.eye,Vy[3],Vy[0],fW);let h=Number.MAX_VALUE,p=0;for(let y=0;y<a.length-5;y+=3){if(hc[0]=a[y]+r[12],hc[1]=a[y+1]+r[13],hc[2]=a[y+2]+r[14],dc[0]=a[y+3]+r[12],dc[1]=a[y+4]+r[13],dc[2]=a[y+5]+r[14],Ci(hW,hc)<0&&Ci(hW,dc)<0||Ci(dW,hc)<0&&Ci(dW,dc)<0||Ci(pW,hc)<0&&Ci(pW,dc)<0||Ci(fW,hc)<0&&Ci(fW,dc)<0)continue;if(l.projectToRenderScreen(hc,Zw),l.projectToRenderScreen(dc,Jw),Zw[2]<0&&Jw[2]>0){_e(Vm,hc,dc);const b=l.frustum,w=-Ci(b[fi.NEAR],hc)/fe(Vm,b[fi.NEAR]);oe(Vm,Vm,w),ge(hc,hc,Vm),l.projectToRenderScreen(hc,Zw)}else if(Zw[2]>0&&Jw[2]<0){_e(Vm,dc,hc);const b=l.frustum,w=-Ci(b[fi.NEAR],dc)/fe(Vm,b[fi.NEAR]);oe(Vm,Vm,w),ge(dc,dc,Vm),l.projectToRenderScreen(dc,Jw)}else if(Zw[2]<0&&Jw[2]<0)continue;Zw[2]=0,Jw[2]=0;const v=bse(pT(Zw,Jw,rve),c);v<h&&(h=v,he(eve,hc),he(tve,dc),p=y/3)}const f=i.rayBegin,g=i.rayEnd;if(h<u*u){let y=Number.MAX_VALUE;if(MAe(pT(eve,tve,rve),pT(f,g,yPt),Xw)){_e(Xw,Xw,f);const v=Te(Xw);oe(Xw,Xw,1/v),y=v/Bi(f,g)}o(y,Xw,p,!1)}}intersectDraped(e,r,i,n,s,o){if(!i.options.selectionMode)return;const a=e.attributes.get(R.POSITION).data,l=e.attributes.get(R.SIZE),c=l?l.data[0]:0,u=n[0],h=n[1],p=((c+1)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,g=0;for(let y=0;y<a.length-5;y+=3){const v=a[y],b=a[y+1],w=u-v,x=h-b,S=a[y+3]-v,E=a[y+4]-b,P=we((S*w+E*x)/(S*S+E*E),0,1),M=S*P-w,L=E*P-x,U=M*M+L*L;U<f&&(f=U,g=y/3)}f<p*p&&s(o.dist,o.normal,g,!1)}createGLMaterial(e){return new mPt(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?dPt:uPt;return new cO(e)}},mPt=class extends fw{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===G.Color&&this._updateOccludeeState(e),this.ensureTechnique(Q6e,e)}},gPt=class extends Jae{constructor(){super(...arguments),this.color=Bd,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.hasOccludees=!1}};const hc=C(),dc=C(),Vm=C(),Xw=C(),Zw=Na(),Jw=Na(),eve=C(),tve=C(),rve=bm(),yPt=bm(),_Pt=C(),wM=[Na(),Na(),Na(),Na()],Vy=[C(),C(),C(),C()],hW=Yr(),dW=Yr(),pW=Yr(),fW=Yr(),vPt=["mesh"];let bPt=class extends Cy{constructor(e,r,i,n){super(e,r,i,n),this._materialInfoCache=new cPt,this._fastUpdateProcessor=new lPt,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Si.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new K1e({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new K1e({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach(e=>e.unload()),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,vPt,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r),n=e.renderingInfo;return this._createAs3DShape(r,n,i,r.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,r){const i=this._getLayerOpacity();this._updateMaterialParameters(n=>{n.material.setParameters({layerOpacity:i});const s=n.material.parameters;this._setMaterialTransparentParameter(s,n),n.material.setParameters({transparent:s.transparent})}),e.forEach(n=>{var s;return(s=r(n))==null?void 0:s.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,Wb)}slicePlaneEnabledChanged(e,r){return this._updateMaterialParameters(({material:i})=>{i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(i=>{var n;return(n=r(i))==null?void 0:n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:r})=>r.setParameters({usePBR:e})),!0}updateTransform(e,r,i,n){const s=e.fastTransformUpdatesEnabled;switch(n){case RS.EnableFastUpdates:if(s)return!0;break;case RS.DisableFastUpdates:if(!s)return!0;break;default:if(!s)return!1}const o=this._context.renderCoordsHelper.spatialReference,a=wPt,{origin:l,transform:c}=i;if(!Ua(r,se(To,l.x,l.y,l.z??0),a,o))return!1;switch(n){case RS.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case RS.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case RS.UpdateFastLocalOrigin:e.updateFastLocalOrigin(a,c,this._context.localOriginFactory)}const{elevationContext:u}=e;u.centerPointInElevationSR=this._getCenterPointInElevationSR(a);const{elevationProvider:h,renderCoordsHelper:p}=this._context,f=(g,y)=>qb(g,h,u,p,y);return e.alignedSampledElevation=xT(e,u,h.spatialReference,f,p,a),e.updateTransform(a,c,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof De?e.toHex():e.contentHash}_materialPropertiesDefault(e,r){const i=this._requiresSymbolVertexColors(),n=!!e.vertexAttributes.color,s=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:n,hasVertexTangents:s,uid:`vc:${n},vt:${s},vct${r},svc:${i}`}}_textureTransformUid(e){const{offset:r,scale:i,rotation:n}=e??SPt;return`${r[0]},${r[1]},${n},${i[0]},${i[1]}`}_materialProperties(e,r,i){const n=this._materialPropertiesDefault(e,i);if(!r.material)return n;const{color:s,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:u,alphaCutoff:h,alphaMode:p}=r.material,f=this._colorOrTextureUid(s),g=this._colorOrTextureUid(o),y=this._textureTransformUid(a),v=this._colorOrTextureUid(l),b=this._textureTransformUid(c);if(n.color=s,n.colorTexture=o,n.normalTexture=l,n.uid=`${n.uid},cmuid:${f},ctmuid:${g},cttuid:${y},ntmuid:${v},nttuid:${b},ds:${u},ac:${h},am:${p}`,r.material instanceof dse){const{metallic:w,roughness:x,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:E,emissiveColor:P,emissiveTexture:M,emissiveTextureTransform:L,occlusionTexture:U,occlusionTextureTransform:z}=r.material,W=this._colorOrTextureUid(S),V=this._textureTransformUid(E),J=this._colorOrTextureUid(P),Y=this._colorOrTextureUid(M),X=this._textureTransformUid(L),le=this._colorOrTextureUid(U),D=this._textureTransformUid(z);n.metallic=w,n.roughness=x,n.metallicRoughnessTexture=S,n.emissiveColor=P,n.emissiveTexture=M,n.occlusionTexture=U,n.colorTextureTransform=this._convertTextureTransform(a),n.normalTextureTransform=this._convertTextureTransform(c),n.emissiveTextureTransform=this._convertTextureTransform(L),n.occlusionTextureTransform=this._convertTextureTransform(z),n.metallicRoughnessTextureTransform=this._convertTextureTransform(E),n.uid=`${n.uid},mrm:${w},mrr:${x},mrt:${W},mrtt:${V},emuid:${J},etmuid:${Y},ett:${X},otmuid:${le},ott:${D}`}return n}_convertTextureTransform(e){if(!e)return null;const{scale:r,offset:i,rotation:n}=e;return{scale:r,offset:i,rotation:Ut(n)}}_setInternalColorValueParameters(e,r){r.diffuse=De.toUnitRGB(e),r.opacity=e.a}_getLoadableTextureResource(e){return e.data??e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,xi.Opaque);return r==null?void 0:r.id}_getInternalTexture(e,r){const i=this._getLoadableTextureResource(e);if(!i)return null;const n=`${e.contentHash}/${r}`;let s=this._textures.get(n);if(!s){let o=null;const a=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,l={wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,maxAnisotropy:a,mipmap:a>1};ZI(i)?(o=i.data,l.preMultiplyAlpha=!1,l.encoding=i.encoding):(o=i,l.preMultiplyAlpha=r!==xi.Opaque,l.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),s=new Zb(o,l),this._textures.set(n,s),s.load(this._context.stage.renderView.renderingContext),this._context.stage.add(s)}return s}_castTextureWrap(e="repeat"){if(typeof e=="string"){const r=this._castTextureWrapIndividual(e);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return nr.CLAMP_TO_EDGE;case"mirror":return nr.MIRRORED_REPEAT;default:return nr.REPEAT}}_setInternalMaterialParameters(e,r){var n,s;if(e.color!=null&&this._setInternalColorValueParameters(e.color,r),e.colorTexture!=null){const o=this._getInternalTexture(e.colorTexture,r.textureAlphaMode);o?(r.textureId=o.id,r.textureAlphaPremultiplied=!!o.parameters.preMultiplyAlpha):r.textureId=void 0}e.normalTexture&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor&&(r.emissiveFactor=De.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),r.colorTextureTransformMatrix=Lg(e.colorTextureTransform),r.normalTextureTransformMatrix=Lg(e.normalTextureTransform);const i=((n=e.normalTextureTransform)==null?void 0:n.scale)!=null?(s=e.normalTextureTransform)==null?void 0:s.scale:VB;r.scale=[i[0],i[1]],r.occlusionTextureTransformMatrix=Lg(e.occlusionTextureTransform),r.emissiveTextureTransformMatrix=Lg(e.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=Lg(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){var n,s;const r=this._drivenProperties.color;let i=((n=this.symbolLayer.material)==null?void 0:n.colorMixMode)??null;if(r)e.externalColor=Bd;else{const o=((s=this.symbolLayer.material)==null?void 0:s.color)??null;o?e.externalColor=De.toUnitRGBA(o):(i=null,e.externalColor=Bd)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const r=e.vertexAttributes.color;if(r==null)return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(e,r){var g,y,v;const i=(g=r.material)==null?void 0:g.color,n=(y=r.material)==null?void 0:y.colorTexture,s=(v=r.material)==null?void 0:v.alphaMode,o=s==="blend",a=s!=="opaque"&&(this._hasTransparentVertexColors(e)||i!=null&&i.a<1||(n==null?void 0:n.transparent)||o),l=this._materialProperties(e,r,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const u={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},h=E5e({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:De.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),p={usePBR:this._usePBR(),isSchematic:h,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Yn,diffuse:Fg,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:$i.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p.mrrFactors=h?[...ule]:[l.metallic,l.roughness,fG[2]],r.material&&(p.doubleSided=r.material.doubleSided,p.cullFace=r.material.doubleSided?$i.None:$i.Back,p.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(p),this._setMaterialTransparentParameter(p,u),this._setInternalMaterialParameters(l,p);const f=new gm(p);return u.material=f,this._materialInfoCache.set(l.uid,u),this._context.stage.add(f),f}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,r){e.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,r.alphaMode==="auto"?e.textureAlphaMode=e.transparent?xi.MaskBlend:xi.Opaque:e.textureAlphaMode=r.alphaMode==="opaque"?xi.Opaque:r.alphaMode==="mask"?xi.Mask:xi.Blend}_addDebugNormals(e,r){const i=r.length,n=e.spatialReference.isGeographic?20015077/180:1,s=.1*Math.max(e.extent.width*n,e.extent.height*n,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let f=0;f<i;f++){const g=r[f],y=g.attributes.get(R.POSITION),v=g.attributes.get(R.NORMAL),b=y.data,w=y.indices,x=v.data,S=v.indices;for(let E=0;E<w.length;E++){const P=3*w[E],M=3*S[E];for(let L=0;L<3;L++)o.push(b[P+L]);for(let L=0;L<3;L++)o.push(b[P+L]+x[M+L]*s);if(a.push(a.length),a.push(a.length),E%3==0){this._calculateFaceNormal(b,w,E,TE),this._getFaceVertices(b,w,E,To,xE,SE),ge(To,To,xE),ge(To,To,SE),oe(To,To,1/3);for(let L=0;L<3;L++)l.push(To[L]);for(let L=0;L<3;L++)l.push(To[L]+TE[L]*s);c.push(c.length),c.push(c.length)}}}const u=r[0].transformation,h=new Is(this._debugVertexNormalMaterial,[[R.POSITION,new tt(o,a,3,!0)]],null,Ln.Line);r.push(h),h.transformation=u;const p=new Is(this._debugFaceNormalMaterial,[[R.POSITION,new tt(l,c,3,!0)]],null,Ln.Line);p.transformation=u,r.push(p)}_createAs3DShape(e,r,i,n){const s=e.geometry;if(s.type!=="mesh")return null;const o=this._createGeometryInfo(s,r,n);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;Si.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,a);const c=new I_({geometries:a,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});c.transformation=l;const u=g5e(this.symbolLayer,{opacity:this._getLayerOpacity()}),h=u?new Bvt(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,p=new sPt(this,c,a,null,null,xT,i,h);this._fastUpdateProcessor.onAddGraphic(),p.needsElevationUpdates=Wb(i.mode),p.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:f,renderCoordsHelper:g}=this._context,y=(v,b)=>qb(v,f,i,g,b);return p.alignedSampledElevation=xT(p,i,f.spatialReference,y,g),p}_getCenterPointInElevationSR(e){const r=uw(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return uy([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(e,r,i,n){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,r,i,n);case"flat":return this._createComponentNormalsFlat(e,n);case"smooth":return this._createComponentNormalsSmooth(e,n)}}_createComponentNormalsSource(e,r,i,n){if(r==null)return this._createComponentNormalsFlat(e,n);let s=!1;if(!i.trustSourceNormals)for(let o=0;o<n.length;o+=3){this._calculateFaceNormal(e,n,o,TE);for(let a=0;a<3;a++){const l=3*n[o+a];To[0]=r[l],To[1]=r[l+1],To[2]=r[l+2],fe(TE,To)<0&&(r[l]=-r[l],r[l+1]=-r[l+1],r[l+2]=-r[l+2],s=!0)}}return new mW(r,n,s)}_createComponentNormalsFlat(e,r){const i=Tn(r.length),n=new Array(3*r.length);for(let s=0;s<r.length;s+=3){const o=this._calculateFaceNormal(e,r,s,TE);for(let a=0;a<3;a++)i[s+a]=o[a],n[s+a]=s/3}return new mW(i,n,!1)}_createComponentNormalsSmooth(e,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(e,r,o,TE);for(let l=0;l<3;l++){const c=r[o+l];let u=i[c];u||(u={normal:C(),count:0},i[c]=u),ge(u.normal,u.normal,a),u.count++}}const n=Tn(3*r.length),s=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(me(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)n[3*o+l]=a.normal[l];s[o]=o}return new mW(n,s,!1)}_getFaceVertices(e,r,i,n,s,o){const a=3*r[i],l=3*r[i+1],c=3*r[i+2];n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],s[0]=e[l],s[1]=e[l+1],s[2]=e[l+2],o[0]=e[c],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,r,i,n){return this._getFaceVertices(e,r,i,To,xE,SE),_e(xE,xE,To),_e(SE,SE,To),it(To,xE,SE),me(n,To),n}_getOrCreateComponents(e){return e.components??xPt}_createPositionBuffer(e,r){let i=e.vertexAttributes.position;const n=r.reprojection===ou.RENDER?r.transformBeforeProject:null;if(n&&(i=am(new Float64Array(i.length),i,n)),r.reprojection===ou.NONE)return r.needsBufferCopy?new Float64Array(i):i;const s=n?i:new Float64Array(i.length);return an(i,e.spatialReference,0,s,this._context.renderCoordsHelper.spatialReference,0,i.length/3),s}_createNormalBuffer(e,r,i){let n=e.vertexAttributes.normal;if(n==null)return null;const s=i.reprojection===ou.RENDER?i.transformBeforeProject:null;if(s&&(n=MOe(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===ou.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=s?n:new Float32Array(n.length);return s7(n,o,r,e.spatialReference,a)}_createTangentBuffer(e,r,i){let n=e.vertexAttributes.tangent;if(n==null)return null;const s=i.reprojection===ou.RENDER?i.transformBeforeProject:null;if(s&&(n=ROe(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===ou.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=s?n:new Float32Array(n.length);return o7(n,o,r,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){var r,i;if(this._requiresSymbolVertexColors()){const n=this._getVertexOpacityAndColor(e),s=P5e((i=(r=this.symbolLayer)==null?void 0:r.material)==null?void 0:i.colorMixMode),o=new Uint8Array(4);return A5e(n,s,o),o}return null}_createBuffers(e,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const n=e.vertexAttributes.normal,s=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(n&&n.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(s&&s.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),u=this._createSymbolColorBuffer(r),h=this._createNormalBuffer(e,l,a),p=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:h,tangentBuffer:p,uvBuffer:s,colorBuffer:c,symbolColorBuffer:u,objectTransformation:a.reprojection===ou.NONE&&a.objectTransformation?a.objectTransformation:this._transformOriginLocal(e,l,h,p),geometryTransformation:a.reprojection===ou.NONE&&a.geometryTransformation?a.geometryTransformation:xe()}}_computeReprojectionInfo(e){var n;const{vertexSpace:r}=e,i=r.type==="georeferenced"?yo(this._context.renderCoordsHelper.spatialReference,e.spatialReference)?ou.NONE:ou.RENDER:ou.NONE;if(cm(r)){const s=r.origin,o=xe(),a=((n=e.transform)==null?void 0:n.localMatrix)??fn;if(i===ou.NONE)return Ua(e.spatialReference,s,o,this._context.renderCoordsHelper.spatialReference),{reprojection:i,objectTransformation:o,geometryTransformation:HP(a),needsBufferCopy:!1};const l=aN(xe(),s);return Kr(l,l,a),{reprojection:i,transformBeforeProject:l,needsBufferCopy:!0}}return{reprojection:i,needsBufferCopy:!0}}_transformOriginLocal(e,r,i,n){const s=this._context.renderCoordsHelper.spatialReference,o=e.anchor;$F[0]=o.x,$F[1]=o.y,$F[2]=o.z??0;const a=xe();return Ua(e.spatialReference,$F,a,s),us(ive,a),am(r,r,ive),(i||n)&&(jh(xM,a),hp(xM,xM),i&&lm(i,i,xM),n&&lm(n,n,xM,4)),a}_validateFaces(e,r){const i=e.vertexAttributes.position.length/3,n=r.faces;if(n){let s=-1;for(let o=0;o<n.length;o++){const a=n[o];a>s&&(s=a)}if(i<=s)return this.logger.warn(`Vertex index ${s} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,r){return r.faces??_2(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){var o;if(!this._context.clippingExtent)return!1;const r=(o=e.vertexAttributes)==null?void 0:o.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference,n=Qse({positions:r,transform:e.transform,vertexSpace:e.vertexSpace,inSpatialReference:e.spatialReference,outSpatialReference:i??e.spatialReference,localMode:this._context.stage.viewingMode===Fe.Local}),s=n.length/3;return zi(gW),Ru(gW,n,0,s),!Uf(gW,this._context.clippingExtent)}_createGeometryInfo(e,r,i){if(!ju(e.spatialReference,this._context.renderCoordsHelper.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(!this._validateVertexSpace(e)||this._isOutsideClippingArea(e))return null;const n=this._createBuffers(e,r);if(n==null)return null;const{positionBuffer:s,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:h,geometryTransformation:p}=n,f=this._getOrCreateComponents(e),g=new Array;let y=!1;const v=zP(To,h),b=this._context.localOriginFactory.getOrigin(v);for(const w of f){if(!this._validateFaces(e,w))return null;const x=this._getOrCreateFaces(e,w);if(x.length===0)continue;const S=this._createComponentNormals(s,c,w,x);S.didFlipNormals&&(y=!0);const E=[[R.POSITION,new tt(s,x,3,!0)],[R.NORMAL,new tt(S.normals,S.indices,3,!0)]];a&&E.push([R.COLOR,new tt(a,x,4,!0)]),l&&E.push([R.SYMBOLCOLOR,new tt(l,ow(x.length),4,!0)]),o&&E.push([R.UV0,new tt(o,x,2,!0)]),u&&E.push([R.TANGENT,new tt(u,x,4,!0)]);const P=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),M=this._getOrCreateMaterial(e,w),L=new Is(M,E,null,Ln.Mesh,P);L.transformation=p,L.localOrigin=b,g.push(L)}return y&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,objectTransformation:h}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((r,i)=>{i.setParameters(r.parameters)})}_validateVertexSpace(e){const{_context:{graphicsCoreOwner:{view:{state:{viewingMode:r}}}}}=this,{vertexSpace:i}=e;return r!==Fe.Local||i.type!=="local"||(this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."),!1)}test(){return{...super.test(),materials:this._materialInfoCache.materials}}},mW=class{constructor(e,r,i){this.normals=e,this.indices=r,this.didFlipNormals=i}};const $F=C(),To=C(),xE=C(),SE=C(),TE=C(),ive=xe(),xM=gi(),wPt=xe(),gW=Ds(),xPt=[new Eb],SPt=new V3;var ou;(function(t){t[t.NONE=0]="NONE",t[t.RENDER=1]="RENDER"})(ou||(ou={}));let TPt=class{constructor(e,r,i,n){this.graphics3DSymbolLayer=e,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=n,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const r=this._lodRenderer.instanceData;e!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,r,i){if(this.elevationAligner){hG(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>qb(o,e,this.elevationContext,r,a),s=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,r);s!=null&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(e=C()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Bm),ze(e,this._lodRenderer.baseBoundingSphere.center,Bm)}getBoundingBoxObjectSpace(e=Ds()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Bm);const r=this._lodRenderer.baseBoundingBox;zi(e);for(let i=0;i<8;++i)se(sd,1&i?r[3]:r[0],2&i?r[4]:r[1],4&i?r[5]:r[2]),ze(sd,sd,Bm),um(e,sd);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Bm),e.render.origin[0]+=Bm[12],e.render.origin[1]+=Bm[13],e.render.origin[2]+=Bm[14],e.render.num++}async getProjectedBoundingBox(e,r,i,n,s){const o=this.getBoundingBoxObjectSpace(s),a=EPt,l=Sse(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Bm);for(let u=0;u<l;u++){const h=a[u];sd[0]=o[h[0]],sd[1]=o[h[1]],sd[2]=o[h[2]],ze(sd,sd,Bm),Qw[3*u]=sd[0],Qw[3*u+1]=sd[1],Qw[3*u+2]=sd[2]}if(!e(Qw,0,l))return null;zi(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let h=0;h<3;h++)o[h]=Math.min(o[h],Qw[u+h]),o[h+3]=Math.max(o[h+3],Qw[u+h]);c&&i.push({location:Qw.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&(kf(o,yW),this.elevationContext.mode!=="absolute-height")){let u;const h=ale(o,r.service.spatialReference,r);try{u=await r.service.queryElevation(yW[0],yW[1],n,h,"ground")}catch{}u!=null&&DAe(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e,r){if(e===h_.Highlight){const i=new Rz(e);this._addHighlightId(i),r.addExternal(n=>{this._removeHighlightId(n)},i)}}removeObjectState(e){this._highlights.forEach(r=>e.remove(r))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const Qw=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],sd=C(),yW=C(),EPt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Bm=xe();function CPt(t,e){const r=t.stageResources.geometries.map(n=>new h5e(n,t.stageResources.textures)),i=t.lodThreshold==null||t.lodThreshold===0&&e>0?APt(r):t.lodThreshold;return new d5e(r,i,t.pivotOffset)}function PPt(t){return new p5e(t.map((e,r)=>CPt(e,r)))}function APt(t){const e=t.reduce((r,{geometry:i})=>r+i.indexCount/3,0);return Math.sqrt(e*OPt/Math.PI)}const OPt=20;function MPt(t){return t=t||globalThis.location.hostname,RPt.some(e=>(t==null?void 0:t.match(e))!=null)}function vte(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(e8e)!=null||e.match(r8e)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(t8e)!=null||e.match(i8e)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const e8e=/^devext.arcgis.com$/,t8e=/^qaext.arcgis.com$/,r8e=/^[\w-]*\.mapsdevext.arcgis.com$/,i8e=/^[\w-]*\.mapsqa.arcgis.com$/,RPt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,e8e,t8e,/^jsapps.esri.com$/,r8e,i8e];function $Pt(t,e,r){if(t.count!==e.count)return void fse().error("source and destination buffers need to have the same number of elements");const i=t.count,n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],h=r[7],p=r[8],f=r[9],g=r[10],y=r[11],v=r[12],b=r[13],w=r[14],x=r[15],S=t.typedBuffer,E=t.typedBufferStride,P=e.typedBuffer,M=e.typedBufferStride;for(let L=0;L<i;L++){const U=L*E,z=L*M,W=P[z],V=P[z+1],J=P[z+2],Y=P[z+3];S[U]=n*W+l*V+p*J+v*Y,S[U+1]=s*W+c*V+f*J+b*Y,S[U+2]=o*W+u*V+g*J+w*Y,S[U+3]=a*W+h*V+y*J+x*Y}}function IPt(t,e,r){Qle(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function Qle(t,e,r,i=4,n=i){if(t.length/i!=e.length/n)return void fse().error("source and destination buffers need to have the same number of elements");const s=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],p=r[6],f=r[7],g=r[8];let y=0,v=0;for(let b=0;b<s;b++){const w=e[y],x=e[y+1],S=e[y+2],E=e[y+3];t[v]=o*w+c*x+p*S,t[v+1]=a*w+u*x+f*S,t[v+2]=l*w+h*x+g*S,t[v+3]=E,y+=n,v+=i}}function LPt(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*n,c=a*o,u=s[c],h=s[c+1],p=s[c+2],f=u*u+h*h+p*p;if(f>0){const g=1/Math.sqrt(f);i[l]=g*u,i[l+1]=g*h,i[l+2]=g*p}}}function DPt(t,e,r){eV(t.typedBuffer,e,r,t.typedBufferStride)}function eV(t,e,r,i=4){const n=Math.min(t.length/i,e.count),s=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<n;c++)t[l]=r*s[a],t[l+1]=r*s[a+1],t[l+2]=r*s[a+2],t[l+3]=r*s[a+3],a+=o,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:LPt,scale:eV,scaleView:DPt,transformMat3:Qle,transformMat3View:IPt,transformMat4:$Pt},Symbol.toStringTag,{value:"Module"}));function NPt(t,e){Kle(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function Kle(t,e,r=2,i=r){const n=e.length/2;let s=0,o=0;if(np(e)||wHe(e)){for(let l=0;l<n;++l)t[s]=e[o],t[s+1]=e[o+1],s+=r,o+=i;return}const a=xHe(e);if(bHe(e))for(let l=0;l<n;++l)t[s]=Math.max(e[o]/a,-1),t[s+1]=Math.max(e[o+1]/a,-1),s+=r,o+=i;else for(let l=0;l<n;++l)t[s]=e[o]/a,t[s+1]=e[o+1]/a,s+=r,o+=i}function FPt(t,e,r,i){const n=t.typedBuffer,s=t.typedBufferStride,o=(i==null?void 0:i.count)??t.count;let a=((i==null?void 0:i.dstIndex)??0)*s;for(let l=0;l<o;++l)n[a]=e,n[a+1]=r,a+=s}Object.freeze(Object.defineProperty({__proto__:null,fill:FPt,normalizeIntegerBuffer:Kle,normalizeIntegerBufferView:NPt},Symbol.toStringTag,{value:"Module"}));function kPt(t,e){WN(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function WN(t,e,r=3,i=r){const n=e.length/i;let s=0,o=0;for(let a=0;a<n;++a)t[s]=e[o],t[s+1]=e[o+1],t[s+2]=e[o+2],s+=r,o+=i}function UPt(t,e,r,i,n){const s=t.typedBuffer,o=t.typedBufferStride,a=(n==null?void 0:n.count)??t.count;let l=((n==null?void 0:n.dstIndex)??0)*o;for(let c=0;c<a;++c)s[l]=e,s[l+1]=r,s[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:WN,copyView:kPt,fill:UPt},Symbol.toStringTag,{value:"Module"}));function zPt(t,e){ece(t.typedBuffer,e,t.typedBufferStride)}function ece(t,e,r=4){const i=e.typedBuffer,n=e.typedBufferStride,s=e.count;let o=0,a=0;for(let l=0;l<s;++l)t[o]=i[a],t[o+1]=i[a+1],t[o+2]=i[a+2],t[o+3]=i[a+3],o+=r,a+=n}function VPt(t,e,r,i,n,s){const o=t.typedBuffer,a=t.typedBufferStride,l=(s==null?void 0:s.count)??t.count;let c=((s==null?void 0:s.dstIndex)??0)*a;for(let u=0;u<l;++u)o[c]=e,o[c+1]=r,o[c+2]=i,o[c+3]=n,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:ece,copyView:zPt,fill:VPt},Symbol.toStringTag,{value:"Module"}));let n8e=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,r){return this._load("json",e,r)}async loadBinary(e,r){return yy(e)?(dt(r),Cne(e)):this._load("binary",e,r)}async loadImage(e,r){return this._load("image",e,r)}async _load(e,r,i){if(this._streamDataRequester==null)return(await Vt(r,{responseType:BPt[e]})).data;const n=await op(this._streamDataRequester.request(r,e,i));if(n.ok===!0)return n.value;throw ko(n.error),new B("",`Request for resource failed: ${n.error}`)}};const BPt={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function GPt(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function jPt(t,e={}){return{data:t,parameters:{wrap:{s:nr.REPEAT,t:nr.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let pO=class bte{constructor(e,r,i=""){this.major=e,this.minor=r,this._context=i}lessThan(e,r){return this.major<e||e===this.major&&this.minor<r}since(e,r){return!this.lessThan(e,r)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new B(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new bte(this.major,this.minor,this._context)}static parse(e,r=""){const[i,n]=e.split("."),s=/^\s*\d+\s*$/;if(!(i!=null&&i.match)||!s.test(i))throw new B((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!(n!=null&&n.match)||!s.test(n))throw new B((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),a=parseInt(n,10);return new bte(o,a,r)}};function E8(t,e){const r=t.count;e||(e=new t.TypedArrayConstructor(r));for(let i=0;i<r;i++)e[i]=t.get(i);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:E8},Symbol.toStringTag,{value:"Module"}));let nve=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var JI,sve;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(JI||(JI={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(sve||(sve={}));const s8e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},HPt={pbrMetallicRoughness:s8e,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},qPt={ESRI_externalColorMixMode:"tint",ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},ove=(t={})=>{const e={...s8e,...t.pbrMetallicRoughness},r=WPt({...qPt,...t.extras});return{...HPt,...t,pbrMetallicRoughness:e,extras:r}};function WPt(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const YPt={magFilter:Kt.LINEAR,minFilter:Kt.LINEAR_MIPMAP_LINEAR,wrapS:nr.REPEAT,wrapT:nr.REPEAT},XPt=t=>({...YPt,...t});function ZPt(t){let e,r;return t.replace(/^(.*\/)?([^/]*)$/,(i,n,s)=>(e=n||"",r=s||"","")),{dirPart:e,filePart:r}}const IF={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let JPt=class Z1{constructor(e,r,i,n){if(this._context=e,this.uri=r,this.json=i,this._glbBuffer=n,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"],this._baseUri=ZPt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new B("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new B("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new B("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,r,i){if(yy(r)){const o=bb(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new Z1(e,r,l)}catch{}const a=Cne(r);if(Z1._isGLBData(a))return this._fromGLBData(e,r,a)}if(iAt.test(r)||(i==null?void 0:i.expectedType)==="gltf"){const o=await e.loadJSON(r,i);return new Z1(e,r,o)}const n=await e.loadBinary(r,i);if(Z1._isGLBData(n))return this._fromGLBData(e,r,n);if(nAt.test(r)||(i==null?void 0:i.expectedType)==="glb")throw new B("gltf-loader-invalid-glb","This is not a valid glb file.");const s=await e.loadJSON(r,i);return new Z1(e,r,s)}static _isGLBData(e){if(e==null)return!1;const r=new nve(e);return r.remainingBytes()>=4&&r.readUint32()===IF.MAGIC}static async _fromGLBData(e,r,i){const n=await Z1._parseGLBData(i);return new Z1(e,r,n.json,n.binaryData)}static async _parseGLBData(e){const r=new nve(e);if(r.remainingBytes()<12)throw new B("gltf-loader-error","glb binary data is insufficiently large.");const i=r.readUint32(),n=r.readUint32(),s=r.readUint32();if(i!==IF.MAGIC)throw new B("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(e.byteLength<s)throw new B("gltf-loader-error","glb binary data is smaller than header specifies.");if(n!==2)throw new B("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),u=r.readUint32();if(l===0){if(u!==IF.CHUNK_TYPE_JSON)throw new B("gltf-loader-error","First glb chunk must be JSON.");if(c<0)throw new B("gltf-loader-error","No JSON data found.");o=await iPt(r.readUint8Array(c))}else if(l===1){if(u!==IF.CHUNK_TYPE_BIN)throw new B("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");a=r.readUint8Array(c)}else K.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");l+=1}if(!o)throw new B("gltf-loader-error","No glb JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,r){const i=this.json.buffers[e];if(i.uri==null){if(this._glbBuffer==null)throw new B("gltf-loader-error","glb buffer not present");return this._glbBuffer}const n=await this._getBufferLoader(e,r);if(n.byteLength!==i.byteLength)throw new B("gltf-loader-error","Buffer byte lengths should match.");return n}async _getBufferLoader(e,r){const i=this._bufferLoaders.get(e);if(i)return i;const n=this.json.buffers[e].uri,s=this._context.loadBinary(this._resolveUri(n),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,s),s}async getAccessor(e,r){if(!this.json.accessors)throw new B("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[e];if((i==null?void 0:i.bufferView)==null)throw new B("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[JI.MAT2,JI.MAT3,JI.MAT4])throw new B("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const n=this.json.bufferViews[i.bufferView],s=await this.getBuffer(n.buffer,r),o=eAt[i.type],a=tAt[i.componentType],l=o*a,c=n.byteStride||l;return{raw:s.buffer,byteStride:c,byteOffset:s.byteOffset+(n.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,r){if(e.indices==null)return;const i=await this.getAccessor(e.indices,r);if(i.isDenselyPacked)switch(i.componentType){case et.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case et.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case et.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case et.UNSIGNED_BYTE:return E8(this._wrapAccessor(eA,i));case et.UNSIGNED_SHORT:return E8(this._wrapAccessor(e7,i));case et.UNSIGNED_INT:return E8(this._wrapAccessor(r7,i))}}async getPositionData(e,r){if(e.attributes.POSITION==null)throw new B("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,r);if(i.componentType!==et.FLOAT)throw new B("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+et[i.componentType]);if(i.componentCount!==3)throw new B("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(mo,i)}async getNormalData(e,r){if(e.attributes.NORMAL==null)throw new B("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,r);if(i.componentType!==et.FLOAT)throw new B("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+et[i.componentType]);if(i.componentCount!==3)throw new B("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(mo,i)}async getTangentData(e,r){if(e.attributes.TANGENT==null)throw new B("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,r);if(i.componentType!==et.FLOAT)throw new B("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+et[i.componentType]);if(i.componentCount!==4)throw new B("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new hm(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,r){if(e.attributes.TEXCOORD_0==null)throw new B("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new B("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===et.FLOAT)return this._wrapAccessor(S2,i);if(!i.normalized)throw new B("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return rAt(i)}async getVertexColors(e,r){if(e.attributes.COLOR_0==null)throw new B("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new B("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===et.FLOAT)return this._wrapAccessor(hm,i);if(i.componentType===et.UNSIGNED_BYTE)return this._wrapAccessor(dl,i);if(i.componentType===et.UNSIGNED_SHORT)return this._wrapAccessor(gN,i)}else if(i.componentCount===3){if(i.componentType===et.FLOAT)return this._wrapAccessor(mo,i);if(i.componentType===et.UNSIGNED_BYTE)return this._wrapAccessor(KB,i);if(i.componentType===et.UNSIGNED_SHORT)return this._wrapAccessor(t7,i)}throw new B("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+et[i.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,r,i){var s,o,a,l,c,u,h,p,f,g;let n=e.material?this._materialCache.get(e.material):void 0;if(!n){const y=e.material!=null?ove(this.json.materials[e.material]):ove(),v=y.pbrMetallicRoughness,b=this.hasVertexColors(e),w=this.getTexture(v.baseColorTexture,r),x=this.getTexture(y.normalTexture,r),S=i?this.getTexture(y.occlusionTexture,r):void 0,E=i?this.getTexture(y.emissiveTexture,r):void 0,P=i?this.getTexture(v.metallicRoughnessTexture,r):void 0,M=e.material!=null?e.material:-1;n={alphaMode:y.alphaMode,alphaCutoff:y.alphaCutoff,color:v.baseColorFactor,doubleSided:!!y.doubleSided,colorTexture:await w,normalTexture:await x,name:y.name,id:M,occlusionTexture:await S,emissiveTexture:await E,emissiveFactor:y.emissiveFactor,metallicFactor:v.metallicFactor,roughnessFactor:v.roughnessFactor,metallicRoughnessTexture:await P,hasVertexColors:b,ESRI_externalColorMixMode:y.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(s=v==null?void 0:v.baseColorTexture)==null?void 0:s.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=y.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(u=(c=y.occlusionTexture)==null?void 0:c.extensions)==null?void 0:u.KHR_texture_transform,emissiveTextureTransform:(p=(h=y.emissiveTexture)==null?void 0:h.extensions)==null?void 0:p.KHR_texture_transform,metallicRoughnessTextureTransform:(g=(f=v==null?void 0:v.metallicRoughnessTexture)==null?void 0:f.extensions)==null?void 0:g.KHR_texture_transform,receiveAmbientOcclusion:y.extras.ESRI_receiveAmbientOcclusion,receiveShadows:y.extras.ESRI_receiveShadows}}return n}async getTexture(e,r){if(!e)return;if((e.texCoord||0)!==0)throw new B("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=e.index,n=this.json.textures[i],s=XPt(n.sampler!=null?this.json.samplers[n.sampler]:{}),o=this._getTextureSourceId(n),a=this.json.images[o],l=await this._loadTextureImageData(i,n,r);return rN(this._textureCache,i,()=>{const c=h=>h===33071||h===33648||h===10497,u=h=>{throw new B("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${h}`)};return{data:l,wrapS:c(s.wrapS)?s.wrapS:u(s.wrapS),wrapT:c(s.wrapT)?s.wrapT:u(s.wrapT),minFilter:s.minFilter,name:a.name,id:i}})}getNodeTransform(e){if(e===void 0)return QPt;let r=this._nodeTransformCache.get(e);if(!r){const i=this.getNodeTransform(this._getNodeParent(e)),n=this.json.nodes[e];n.matrix?r=Kr(xe(),i,n.matrix):n.translation||n.rotation||n.scale?(r=HP(i),n.translation&&Fc(r,r,n.translation),n.rotation&&(LF[3]=FB(LF,n.rotation),Ou(r,r,LF[3],LF)),n.scale&&g2(r,r,n.scale)):r=HP(i),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return Tu(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=pO.parse(this.json.asset.version,"glTF");KPt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new B("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(e,r,i){const n=this._textureLoaders.get(e);if(n)return n;const s=this._createTextureLoader(r,i);return this._textureLoaders.set(e,s),s}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new B("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,r){const i=this._getTextureSourceId(e),n=this.json.images[i];if(n.uri){if(n.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(n.uri),r);return new Z6e(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(n.uri),r)}if(n.bufferView==null)throw new B("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(n.mimeType==null)throw new B("gltf-loader-unsupported-feature","Image mimeType must be defined.");const s=this.json.bufferViews[n.bufferView],o=await this.getBuffer(s.buffer,r);if(s.byteStride!=null)throw new B("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(s.byteOffset||0);return nPt(new Uint8Array(o.buffer,a,s.byteLength),n.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await WU(Array.from(this._bufferLoaders.values())),r=await WU(Array.from(this._textureLoaders.values()));return e.reduce((i,n)=>i+((n==null?void 0:n.byteLength)??0),0)+r.reduce((i,n)=>i+(n?ZI(n)?n.data.byteLength:n.width*n.height*4:0),0)}};const QPt=Q3e(xe(),Math.PI/2),KPt=new pO(2,0,"glTF"),LF=Gc(),eAt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},tAt={[et.BYTE]:1,[et.UNSIGNED_BYTE]:1,[et.SHORT]:2,[et.UNSIGNED_SHORT]:2,[et.FLOAT]:4,[et.INT]:4,[et.UNSIGNED_INT]:4};function rAt(t){switch(t.componentType){case et.BYTE:return new i7(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case et.UNSIGNED_BYTE:return new QB(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case et.SHORT:return new yN(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case et.UNSIGNED_SHORT:return new jse(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case et.UNSIGNED_INT:return new Hse(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case et.FLOAT:return new S2(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}const iAt=/\.gltf$/i,nAt=/\.glb$/i;let sAt=0;async function o8e(t,e,r={},i=!0){var h,p;const n=await JPt.load(t,e,r),s="gltf_"+sAt++,o={lods:[],materials:new Map,textures:new Map,meta:oAt(n)},a=!(!n.json.asset.extras||n.json.asset.extras.ESRI_type!=="symbolResource"),l=(p=(h=n.json.asset.extras)==null?void 0:h.ESRI_webstyleSymbol)==null?void 0:p.webstyle,c=new Map;await aAt(n,async(f,g,y,v)=>{var J;const b=c.get(y)??0;c.set(y,b+1);const w=f.mode!==void 0?f.mode:dr.TRIANGLES,x=w===dr.TRIANGLES||w===dr.TRIANGLE_STRIP||w===dr.TRIANGLE_FAN?w:null;if(x==null)return void K.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+dr[w]+"). Skipping primitive.");if(!n.hasPositions(f))return void K.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const S=n.getPositionData(f,r),E=n.getMaterial(f,r,i),P=n.hasNormals(f)?n.getNormalData(f,r):null,M=n.hasTangents(f)?n.getTangentData(f,r):null,L=n.hasTextureCoordinates(f)?n.getTextureCoordinates(f,r):null,U=n.hasVertexColors(f)?n.getVertexColors(f,r):null,z=n.getIndexData(f,r),W={name:v,transform:HP(g),attributes:{position:await S,normal:P?await P:null,texCoord0:L?await L:null,color:U?await U:null,tangent:M?await M:null},indices:await z,primitiveType:x,material:cAt(o,await E,s)};let V=null;((J=o.meta)==null?void 0:J.ESRI_lod)!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(V=o.meta.ESRI_lod.thresholds[y]),o.lods[y]=o.lods[y]||{parts:[],name:v,lodThreshold:V},o.lods[y].parts[b]=W});for(const f of o.lods)f.parts=f.parts.filter(g=>!!g);const u=await n.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:n.uri,ESRI_webstyle:l},customMeta:{},size:u}}function oAt(t){const e=t.json;let r=null;return e.nodes.forEach(i=>{const n=i.extras;n!=null&&(n.ESRI_proxyEllipsoid||n.ESRI_lod)&&(r=n)}),r}async function aAt(t,e){const r=t.json,i=r.scenes[r.scene||0].nodes,n=i.length>1,s=[];for(const a of i){const l=r.nodes[a];s.push(o(a,0)),lAt(l)&&!n&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=r.nodes[a],u=t.getNodeTransform(a);if(c.weights!=null&&K.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const h=r.meshes[c.mesh];for(const p of h.primitives)s.push(e(p,u,l,h.name))}for(const h of c.children||[])s.push(o(h,l))}await Promise.all(s)}function lAt(t){var e;return((e=t.extensions)==null?void 0:e.MSFT_lod)&&Array.isArray(t.extensions.MSFT_lod.ids)}function cAt(t,e,r){const i=s=>{const o=`${r}_tex_${s&&s.id}${s!=null&&s.name?"_"+s.name:""}`;if(s&&!t.textures.has(o)){const a=jPt(s.data,{wrap:{s:s.wrapS,t:s.wrapT},mipmap:uAt.has(s.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},n=`${r}_mat_${e.id}_${e.name}`;if(!t.materials.has(n)){const s=GPt({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?i(e.colorTexture):void 0,textureNormal:e.normalTexture?i(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?i(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?i(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?i(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor,receiveShadows:e.receiveShadows,receiveAmbientOcclustion:e.receiveAmbientOcclusion});t.materials.set(n,s)}return n}const uAt=new Set([Kt.LINEAR_MIPMAP_LINEAR,Kt.LINEAR_MIPMAP_NEAREST]);function hAt(t,e){switch(e){case dr.TRIANGLES:return dAt(t);case dr.TRIANGLE_STRIP:return pAt(t);case dr.TRIANGLE_FAN:return fAt(t)}}function dAt(t){return typeof t=="number"?_2(t):Lv(t)?new Uint16Array(t):t}function pAt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const r=e-2,i=Az(3*r);if(typeof t=="number"){let n=0;for(let s=0;s<r;s+=1)s%2==0?(i[n++]=s,i[n++]=s+1,i[n++]=s+2):(i[n++]=s+1,i[n++]=s,i[n++]=s+2)}else{let n=0;for(let s=0;s<r;s+=1)s%2==0?(i[n++]=t[s],i[n++]=t[s+1],i[n++]=t[s+2]):(i[n++]=t[s+1],i[n++]=t[s],i[n++]=t[s+2])}return i}function fAt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const r=e-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof t=="number"){let a=0;for(let l=0;l<r;++l)i[a++]=0,i[a++]=l+1,i[a++]=l+2;return i}const n=t[0];let s=t[1],o=0;for(let a=0;a<r;++a){const l=t[a+2];i[o++]=n,i[o++]=s,i[o++]=l,s=l}return i}let mAt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},gAt=class{constructor(e,r,i){this.name=e,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new mAt,this.numberOfVertices=0}};const o0=()=>K.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function a8e(t,e){const r=await yAt(t,e),i=await xAt(r.textureDefinitions??{},e);let n=0;for(const s in i)if(i.hasOwnProperty(s)){const o=i[s];n+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:n+OEe(r)}}async function yAt(t,e){const r=e==null?void 0:e.streamDataRequester;if(r)return _At(t,r,e);const i=await op(Vt(t,e));if(i.ok===!0)return i.value.data;ko(i.error),l8e(i.error)}async function _At(t,e,r){const i=await op(e.request(t,"json",r));if(i.ok===!0)return i.value;ko(i.error),l8e(i.error.details.url)}function l8e(t){throw new B("",`Request for object resource failed: ${t}`)}function vAt(t){const e=t.params,r=e.topology;let i=!0;switch(e.vertexAttributes||(o0().warn("Geometry must specify vertex attributes"),i=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const s=e.faces;if(s){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=s[o];a!=null&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(o0().warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(o0().warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(o0().warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else o0().warn("Indexed geometries must specify faces"),i=!1;break}default:o0().warn(`Unsupported topology '${r}'`),i=!1}t.params.material||(o0().warn("Geometry requires material"),i=!1);const n=t.params.vertexAttributes;for(const s in n)n[s].values||(o0().warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function bAt(t,e){var g,y;const r=new Array,i=new Array,n=new Array,s=new Hb,o=t.resource,a=pO.parse(o.version||"1.0","wosr");TAt.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},h=t.textures;let p=0;const f=new Map;for(let v=0;v<c.length;v++){const b=c[v];if(!vAt(b))continue;const w=SAt(b),x=b.params.vertexAttributes,S=[],E=X=>{if(b.params.topology==="PerAttributeArray")return null;const le=b.params.faces;for(const D in le)if(D===X)return le[D].values;return null},P=x[R.POSITION],M=P.values.length/P.valuesPerElement;for(const X in x){const le=x[X],D=le.values,I=E(X)??_2(M);S.push([X,new tt(D,I,le.valuesPerElement,!0)])}const L=w.texture,U=h&&h[L];if(U&&!f.has(L)){const{image:X,parameters:le}=U,D=new Zb(X,le);i.push(D),f.set(L,D)}const z=f.get(L),W=z?z.id:void 0,V=w.material;let J=s.get(V,L);if(J==null){const X=u[V.substring(V.lastIndexOf("/")+1)].params;X.transparency===1&&(X.transparency=0);const le=U&&U.alphaChannelUsage,D=X.transparency>0||le==="transparency"||le==="maskAndTransparency",I=U?c8e(U.alphaChannelUsage):void 0,k={ambient:Ka(X.diffuse),diffuse:Ka(X.diffuse),opacity:1-(X.transparency||0),transparent:D,textureAlphaMode:I,textureAlphaCutoff:.33,textureId:W,initTextureTransparent:!0,doubleSided:!0,cullFace:$i.None,colorMixMode:X.externalColorMixMode||"tint",textureAlphaPremultiplied:(U==null?void 0:U.parameters.preMultiplyAlpha)??!1};e!=null&&e.materialParameters&&Object.assign(k,e.materialParameters),J=new gm(k),s.set(V,L,J)}n.push(J);const Y=new Is(J,S);p+=((y=(g=S.find(X=>X[0]===R.POSITION))==null?void 0:g[1])==null?void 0:y.indices.length)??0,r.push(Y)}return{engineResources:[{name:l,stageResources:{textures:i,materials:n,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:p,lodThreshold:null}],referenceBoundingBox:wAt(r)}}function wAt(t){const e=zi();return t.forEach(r=>{const i=r.boundingInfo;i!=null&&(um(e,i.bbMin),um(e,i.bbMax))}),e}async function xAt(t,e){const r=new Array;for(const s in t){const o=t[s],a=o.images[0].data;if(!a){o0().warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+s,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",h={noUnpackFlip:!0,wrap:{s:nr.REPEAT,t:nr.REPEAT},preMultiplyAlpha:c8e(u)!==xi.Opaque},p=e!=null&&e.disableTextures?Promise.resolve(null):y_(l,e);r.push(p.then(f=>({refId:c,image:f,parameters:h,alphaChannelUsage:u})))}const i=await Promise.all(r),n={};for(const s of i)n[s.refId]=s;return n}function c8e(t){switch(t){case"mask":return xi.Mask;case"maskAndTransparency":return xi.MaskBlend;case"none":return xi.Opaque;default:return xi.Blend}}function SAt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const TAt=new pO(1,2,"wosr"),EE=2.1;async function u8e(t,e){var h;const r=h8e(vte(t));if(r.fileType==="wosr"){const p=await(e.cache?e.cache.loadWOSR(r.url,e):a8e(r.url,e)),{engineResources:f,referenceBoundingBox:g}=bAt(p,e);return{lods:f,referenceBoundingBox:g,isEsriSymbolResource:!1,isWosr:!0}}const i=await(e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):o8e(new n8e(e.streamDataRequester),r.url,e,e.usePBR)),n=(h=i.model.meta)==null?void 0:h.ESRI_proxyEllipsoid,s=i.meta.isEsriSymbolResource&&n!=null&&i.meta.ESRI_webstyle==="EsriRealisticTreesStyle";s&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,AAt(i,n));const o=!!e.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:s,mrrFactors:[...rbt]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...fG]},l={...e.materialParameters,treeRendering:s},{engineResources:c,referenceBoundingBox:u}=d8e(i,a,l,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function h8e(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function d8e(t,e,r,i){const n=t.model,s=new Array,o=new Map,a=new Map,l=n.lods.length,c=zi();return n.lods.forEach((u,h)=>{const p=i.skipHighLods===!0&&(l>1&&h===0||l>3&&h===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&h!==i.singleLodIndex;if(p&&h!==0)return;const f=new gAt(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(g=>{const y=p?new gm({}):EAt(n,g,f,e,r,o,a),{geometry:v,vertexCount:b}=CAt(g,y??new gm({})),w=v.boundingInfo;w!=null&&h===0&&(um(c,w.bbMin),um(c,w.bbMax)),y!=null&&(f.stageResources.geometries.push(v),f.numberOfVertices+=b)}),p||s.push(f)}),{engineResources:s,referenceBoundingBox:c}}function EAt(t,e,r,i,n,s,o){var f,g;const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,u=e.attributes.normal!=null;if(l==null)return null;const h=PAt(l.alphaMode);if(!s.has(a)){if(c){const L=(U,z=!1)=>{if(U!=null&&!o.has(U)){const W=t.textures.get(U);if(W!=null){const V=W.data;o.set(U,new Zb(ZI(V)?V.data:V,{...W.parameters,preMultiplyAlpha:!ZI(V)&&z,encoding:ZI(V)&&V.encoding!=null?V.encoding:void 0}))}}};L(l.textureColor,h!==xi.Opaque),L(l.textureNormal),L(l.textureOcclusion),L(l.textureEmissive),L(l.textureMetallicRoughness)}const y=l.color[0]**(1/EE),v=l.color[1]**(1/EE),b=l.color[2]**(1/EE),w=l.emissiveFactor[0]**(1/EE),x=l.emissiveFactor[1]**(1/EE),S=l.emissiveFactor[2]**(1/EE),E=l.textureColor!=null&&c?o.get(l.textureColor):null,P=E5e({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion}),M=((f=l.normalTextureTransform)==null?void 0:f.scale)!=null?(g=l.normalTextureTransform)==null?void 0:g.scale:VB;s.set(a,new gm({...i,transparent:h===xi.Blend,customDepthTest:ZT.Lequal,textureAlphaMode:h,textureAlphaCutoff:l.alphaCutoff,diffuse:[y,v,b],ambient:[y,v,b],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?$i.None:$i.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:u?Ur.Attribute:Ur.ScreenDerivative,castShadows:!0,receiveShadows:l.receiveShadows,receiveAmbientOcclusion:l.receiveAmbientOcclustion,textureId:E!=null?E.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:E!=null&&!!E.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[w,x,S],mrrFactors:P?[...ule]:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:P,colorTextureTransformMatrix:Lg(l.colorTextureTransform),normalTextureTransformMatrix:Lg(l.normalTextureTransform),scale:[M[0],M[1]],occlusionTextureTransformMatrix:Lg(l.occlusionTextureTransform),emissiveTextureTransformMatrix:Lg(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:Lg(l.metallicRoughnessTextureTransform),...n}))}const p=s.get(a);if(r.stageResources.materials.push(p),c){const y=v=>{v!=null&&r.stageResources.textures.push(o.get(v))};y(l.textureColor),y(l.textureNormal),y(l.textureOcclusion),y(l.textureEmissive),y(l.textureMetallicRoughness)}return p}function CAt(t,e){const r=t.attributes.position.count,i=hAt(t.indices||r,t.primitiveType),n=Tn(3*r),{typedBuffer:s,typedBufferStride:o}=t.attributes.position;am(n,s,t.transform,3,o);const a=[[R.POSITION,new tt(n,i,3,!0)]];if(t.attributes.normal!=null){const l=Tn(3*r),{typedBuffer:c,typedBufferStride:u}=t.attributes.normal;d_(DF,t.transform),lm(l,c,DF,3,u),a.push([R.NORMAL,new tt(l,i,3,!0)])}if(t.attributes.tangent!=null){const l=Tn(4*r),{typedBuffer:c,typedBufferStride:u}=t.attributes.tangent;d_(DF,t.transform),Qle(l,c,DF,4,u),a.push([R.TANGENT,new tt(l,i,4,!0)])}if(t.attributes.texCoord0!=null){const l=Tn(2*r),{typedBuffer:c,typedBufferStride:u}=t.attributes.texCoord0;Kle(l,c,2,u),a.push([R.UV0,new tt(l,i,2,!0)])}if(t.attributes.color!=null){const l=new Uint8Array(4*r);t.attributes.color.elementCount===4?t.attributes.color instanceof hm?eV(l,t.attributes.color,255):t.attributes.color instanceof dl?ece(l,t.attributes.color):t.attributes.color instanceof gN&&eV(l,t.attributes.color,1/256):(l.fill(255),t.attributes.color instanceof mo?Cz(l,t.attributes.color,255,4):t.attributes.color instanceof KB?WN(l,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof t7&&Cz(l,t.attributes.color,1/256,4)),a.push([R.COLOR,new tt(l,i,4,!0)])}return{geometry:new Is(e,a),vertexCount:r}}const DF=gi();function PAt(t){switch(t){case"BLEND":return xi.Blend;case"MASK":return xi.Mask;case"OPAQUE":case null:case void 0:return xi.Opaque}}function AAt(t,e){for(let r=0;r<t.model.lods.length;++r){const i=t.model.lods[r];for(const n of i.parts){const s=n.attributes.normal;if(s==null)return;const o=n.attributes.position,a=o.count,l=C(),c=C(),u=C(),h=new Uint8Array(4*a),p=new Float64Array(3*a),f=us(xe(),n.transform);let g=0,y=0;for(let v=0;v<a;v++){o.getVec(v,c),s.getVec(v,l),ze(c,c,n.transform),_e(u,c,e.center),_z(u,u,e.radius);const b=u[2],w=Te(u),x=Math.min(.45+.55*w*w,1);_z(u,u,e.radius),f!==null&&ze(u,u,f),me(u,u),r+1!==t.model.lods.length&&t.model.lods.length>1&&pi(u,u,l,b>-1?.2:Math.min(-4*b-3.8,1)),p[g]=u[0],p[g+1]=u[1],p[g+2]=u[2],g+=3,h[y]=255*x,h[y+1]=255*x,h[y+2]=255*x,h[y+3]=255,y+=4}n.attributes.normal=new mo(p),n.attributes.color=new dl(h)}}}const asr=Object.freeze(Object.defineProperty({__proto__:null,fetch:u8e,gltfToEngineResources:d8e,parseUrl:h8e},Symbol.toStringTag,{value:"Module"})),OAt=()=>!!ne("enable-feature:force-wosr"),lsr=()=>!!ne("enable-feature:direct-3d-object-feature-layer-display"),MAt=()=>ne.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),RAt=()=>ne.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),csr=()=>!!ne("enable-i3s-patching"),$At=()=>ne.add("enable-i3s-patching",!0,!0,!0),IAt=()=>ne.add("enable-i3s-patching",!1,!0,!0),ave=()=>!!ne("enable-feature:SceneLayer-editing"),LAt=(t="i3s-patching")=>{switch(IAt(),RAt(),ne.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":MAt();break;case"i3s-patching":$At()}};LAt("i3s-patching");let _W={};async function DAt(t,e){try{return{data:(await rce(t,e)).data,baseUrl:uB(t),styleUrl:t}}catch(r){return ko(r),null}}function NAt(t,e,r){const i=e.portal!=null?e.portal:Ho.getDefault();let n;const s=`${i.url} - ${i.user&&i.user.username} - ${t}`;return _W[s]||(_W[s]=FAt(t,i,r).then(o=>(n=o,o.fetchData())).then(o=>({data:o,baseUrl:n.itemUrl??"",styleName:t}))),_W[s]}function FAt(t,e,r){return e.load(r).then(()=>{const i=new Pg({disableExtraQuery:!0,query:`owner:${lve} AND type:${cve} AND typekeywords:"${t}"`});return e.queryItems(i,r)}).then(({results:i})=>{var o;let n=null;const s=t.toLowerCase();if(i&&Array.isArray(i)){for(const a of i)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===s))&&a.type===cve&&a.owner===lve){n=a;break}}if(!n)throw new B("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return n.load(r)})}function tce(t,e,r){return(t==null?void 0:t.styleUrl)!=null?DAt(t.styleUrl,r):(t==null?void 0:t.styleName)!=null?NAt(t.styleName,e,r):Promise.reject(new B("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function p8e(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function f8e(t,e,r=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!OAt())for(const i of r){const n=t.formatInfos.find(s=>s.type===i);if(n)return n.href}return t.webRef}function rce(t,e){const r={responseType:"json",query:{f:"json"},...e};return Vt(Xf(t),r)}const lve="esri_en",cve="Style",kAt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",SM={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function UAt(t,e=SM){var a,l;if(!t)return{symbol:null};const{retainId:r=SM.retainId,ignoreDrivers:i=SM.ignoreDrivers,hasLabelingContext:n=SM.hasLabelingContext,retainCIM:s=SM.retainCIM}=e;let o=null;if(zb(t)||t instanceof M2)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new B("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=s?t.clone():Gv.fromCIMSymbol(t)}else if(t instanceof vp)o=F7.fromSimpleLineSymbol(t);else if(t instanceof pw)o=Gv.fromSimpleMarkerSymbol(t);else if(t instanceof U7)o=Gv.fromPictureMarkerSymbol(t);else if(t instanceof O2)o=e.geometryType&&e.geometryType==="mesh"?k7.fromSimpleFillSymbol(t):PN.fromSimpleFillSymbol(t);else{if(!(t instanceof tO))return{error:new B("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=n?N7.fromTextSymbol(t):Gv.fromTextSymbol(t)}return r&&o&&o.type!=="cim"&&(o.id=t.id),i&&zb(o)&&o.symbolLayers.forEach(c=>c.ignoreDrivers=!0),{symbol:o}}function tV(t,e,r,i){const n=m8e(t,{},{context:i,isLabelSymbol:!1});n!=null&&(e[r]=n)}function uve(t,e,r,i){const n=m8e(t,{},{context:i,isLabelSymbol:!0});n!=null&&(e[r]=n)}function hve(t){return t instanceof eO||t instanceof M2}function m8e(t,e,r){if(t==null)return null;const{context:i,isLabelSymbol:n}=r,s=i==null?void 0:i.origin,o=i==null?void 0:i.messages;if(s==="web-scene"&&!hve(t)){const a=UAt(t,{retainCIM:!0,hasLabelingContext:n});return a.symbol!=null?a.symbol.write(e,i):(o==null||o.push(new B("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:a.error})),null)}return(s==="web-map"||s==="portal-item"&&!L3e(i==null?void 0:i.layer))&&hve(t)?(o==null||o.push(new B("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function g8e(t,e){return wht(t,null,e)}function zAt(t,e,r,i){const n=t.name;return n==null?Promise.reject(new B("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?VAt(n,e,i):tce(t,e,i).then(s=>nce(s,n,e,r,f8e,i))}function ice(t,e){return e.items.find(r=>r.name===t)}function nce(t,e,r,i,n,s){var f,g;const o=(r==null?void 0:r.portal)!=null?r.portal:Ho.getDefault(),a={portal:o,url:xs(t.baseUrl),origin:"portal-item"},l=ice(e,t.data);if(!l){const y=`The symbol name '${e}' could not be found`;return Promise.reject(new B("symbolstyleutils:symbol-name-not-found",y,{symbolName:e}))}let c=a_(n(l,i),a),u=((f=l.thumbnail)==null?void 0:f.href)??null;const h=(g=l.thumbnail)==null?void 0:g.imageData;MPt()&&(c=vte(c)??"",u=vte(u));const p={portal:o,url:xs(uB(c)),origin:"portal-item"};return rce(c,s).then(y=>{const v=i==="cimRef"?p8e(y.data):y.data,b=g8e(v,p);if(b&&zb(b)){if(u){const w=a_(u,a);b.thumbnail=new yT({url:w})}else h&&(b.thumbnail=new yT({url:`data:image/png;base64,${h}`}));t.styleUrl?b.styleOrigin=new cD({portal:r.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(b.styleOrigin=new cD({portal:r.portal,styleName:t.styleName,name:e}))}return b})}function VAt(t,e,r){const i=kAt.replaceAll(/\{SymbolName\}/gi,t),n=e.portal!=null?e.portal:Ho.getDefault();return rce(i,r).then(s=>{const o=p8e(s.data);return g8e(o,{portal:n,url:xs(uB(i)),origin:"portal-item"})})}const BAt=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:nce,getStyleItemFromStyle:ice,resolveWebStyleSymbol:zAt},Symbol.toStringTag,{value:"Module"}));async function GAt(t){var a;if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new B("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const r={portal:t.portal},i=await tce(t,r).catch(()=>null);if(i===null)return null;const n=ice(e,i.data);if(n&&!((a=n.formatInfos)!=null&&a.some(l=>l.type==="gltf_basisu")))return null;const s=await nce(i,e,r,"webRef",(l,c)=>f8e(l,c,["gltf_basisu","gltf"])).catch(()=>null);if(s===null||s.type!=="point-3d")return null;const o=s.symbolLayers.items[0];return o.type==="object"?o.resource:null}let jAt=class{constructor(e,r,i){this._elementSize=r,this._buffer=ti.createVertex(e,Lr.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,r,i,n=0){const s=new Uint8Array(this.array,e*this.elementSize,(r-e)*this.elementSize);new Uint8Array(i.array,n*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(e,r){const i=e*this._elementSize,n=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,n)}resize(e){const r=e*this._elementSize,i=new ArrayBuffer(r);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=e}},HAt=class{constructor(e){this.modelOriginHi=e.getField(R.INSTANCEMODELORIGINHI,mo),this.modelOriginLo=e.getField(R.INSTANCEMODELORIGINLO,mo),this.model=e.getField(R.INSTANCEMODEL,Ib),this.modelNormal=e.getField(R.INSTANCEMODELNORMAL,Ib),this.featureAttribute=e.getField(R.INSTANCEFEATUREATTRIBUTE,hm),this.color=e.getField(R.INSTANCECOLOR,dl),this.objectAndLayerIdColor=e.getField(R.INSTANCEOBJECTANDLAYERIDCOLOR,dl)}},dve=class{constructor(e,r){this._rctx=e,this._instanceBufferLayout=r,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,r=this._tailIndex;return e>=r?e-r:e+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){var e;return((e=this._buffer)==null?void 0:e.usedMemory)??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){_t(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){_t(this._updating,"not updating"),this.size<lHe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){_t(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),_t(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){_t(this._updating,"not updating"),_t(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(rV,Math.floor(this._capacity*YV));this._resize(e)}_shrink(){const e=Math.max(rV,Math.floor(this._capacity*aHe));this._resize(e)}_resize(e){if(_t(this._updating,"not updating"),e===this._capacity)return;const r=new jAt(this._rctx,this._instanceBufferLayout.stride,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,n=this._compactInstances(r);_t(n===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=r,this._view=new HAt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,e),r-i):i>r?(this._buffer.copyRange(i,this._capacity,e),r>0&&this._buffer.copyRange(0,r,e,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,r){e<r?this._buffer.transferRange(e,r):e>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(e,this._capacity))}};const rV=64;var Ki;function qAt(t){let e=ln().mat4f64(R.LOCALTRANSFORM).mat4f64(R.GLOBALTRANSFORM).vec4f64(R.BOUNDINGSPHERE).vec3f64(R.MODELORIGIN).mat3f(R.INSTANCEMODEL).mat3f(R.INSTANCEMODELNORMAL).vec2f(R.MODELSCALEFACTORS);return t.includes(R.FEATUREATTRIBUTE)&&(e=e.vec4f(R.FEATUREATTRIBUTE)),t.includes(R.COLOR)&&(e=e.vec4u8(R.COLOR)),t.includes(R.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(R.OBJECTANDLAYERIDCOLOR)),e=e.u8(R.STATE).u8(R.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Ki||(Ki={}));let pve=class{constructor(e){this.localTransform=e.getField(R.LOCALTRANSFORM,KL),this.globalTransform=e.getField(R.GLOBALTRANSFORM,KL),this.modelOrigin=e.getField(R.MODELORIGIN,dp),this.model=e.getField(R.INSTANCEMODEL,Ib),this.modelNormal=e.getField(R.INSTANCEMODELNORMAL,Ib),this.modelScaleFactors=e.getField(R.MODELSCALEFACTORS,S2),this.boundingSphere=e.getField(R.BOUNDINGSPHERE,JB),this.featureAttribute=e.getField(R.FEATUREATTRIBUTE,hm),this.color=e.getField(R.COLOR,dl),this.objectAndLayerIdColor=e.getField(R.OBJECTANDLAYERIDCOLOR,dl),this.state=e.getField(R.STATE,eA),this.lodLevel=e.getField(R.LODLEVEL,eA)}},xC=class extends Pe{constructor(e,r){super(e),this.events=new Xn,this._capacity=0,this._size=0,this._next=0,this._layout=qAt(r),this._capacity=rV,this._buffer=this._layout.createBuffer(this._capacity),this._view=new pve(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Ki.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const r=this._view.state;_t(e>=0&&e<this._capacity&&(r.get(e)&Ki.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Ki.ACTIVE)?this._setStateFlags(e,Ki.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const r=this._view.state;_t(e>=0&&e<this._capacity&&(r.get(e)&Ki.ALLOCATED)!=0,"invalid instance handle"),r.set(e,0),this._size--}setLocalTransform(e,r,i=!0){this._view.localTransform.setMat(e,r),i&&this.updateModelTransform(e)}getLocalTransform(e,r){this._view.localTransform.getMat(e,r)}setGlobalTransform(e,r,i=!0){this._view.globalTransform.setMat(e,r),i&&this.updateModelTransform(e)}getGlobalTransform(e,r){this._view.globalTransform.getMat(e,r)}updateModelTransform(e){const r=this._view,i=Zc,n=Dp;r.localTransform.getMat(e,fve),r.globalTransform.getMat(e,vW);const s=Kr(vW,vW,fve);se(i,s[12],s[13],s[14]),r.modelOrigin.setVec(e,i),jh(n,s),r.model.setMat(e,n);const o=CKe(Zc,s);o.sort(),r.modelScaleFactors.set(e,0,o[1]),r.modelScaleFactors.set(e,1,o[2]),x2(n,n),hp(n,n),r.modelNormal.setMat(e,n),this._setStateFlags(e,Ki.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,r){const i=this._view;i.model.getMat(e,Dp),i.modelOrigin.getVec(e,Zc),r[0]=Dp[0],r[1]=Dp[1],r[2]=Dp[2],r[3]=0,r[4]=Dp[3],r[5]=Dp[4],r[6]=Dp[5],r[7]=0,r[8]=Dp[6],r[9]=Dp[7],r[10]=Dp[8],r[11]=0,r[12]=Zc[0],r[13]=Zc[1],r[14]=Zc[2],r[15]=1}applyShaderTransformation(e,r){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedModelTransform(e,r){return this.getModelTransform(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedLocalTransform(e,r){this._view.localTransform.getMat(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedMaxScaleFactor(e){let r=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Zc,this,e),r*=Math.max(Zc[0],Zc[1],Zc[2])),r}getCombinedMedianScaleFactor(e){let r=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Zc,this,e),r*=WAt(Zc[0],Zc[1],Zc[2])),r}getModel(e,r){this._view.model.getMat(e,r)}setFeatureAttribute(e,r){this._view.featureAttribute.setVec(e,r)}getFeatureAttribute(e,r){this._view.featureAttribute.getVec(e,r)}setColor(e,r){this._view.color.setVec(e,r)}setObjectAndLayerIdColor(e,r){this._view.objectAndLayerIdColor.setVec(e,r)}setVisible(e,r){r!==this.getVisible(e)&&(this._setStateFlag(e,Ki.VISIBLE,r),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Ki.VISIBLE)}setHighlight(e,r){r!==this.getHighlight(e)&&(this._setStateFlag(e,Ki.HIGHLIGHT,r),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Ki.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++r;return r}_setStateFlags(e,r){const i=this._view.state;r=i.get(e)|r,i.set(e,r)}_clearStateFlags(e,r){const i=this._view.state;r=i.get(e)&~r,i.set(e,r)}_setStateFlag(e,r,i){i?this._setStateFlags(e,r):this._clearStateFlags(e,r)}_getStateFlag(e,r){return!!(this._view.state.get(e)&r)}_grow(){this._capacity=Math.max(rV,Math.floor(this._capacity*YV)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new pve(this._buffer)}_findSlot(){const e=this._view.state;let r=this._next;for(;e.get(r)&Ki.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}};function WAt(t,e,r){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),r))}d([m({constructOnly:!0})],xC.prototype,"shaderTransformation",void 0),d([m()],xC.prototype,"_size",void 0),d([m({readOnly:!0})],xC.prototype,"size",null),xC=d([F("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],xC);const Zc=C(),Dp=gi(),fve=xe(),vW=xe();let YAt=class extends Bf{constructor(e,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=r,this._tmpSphere=hs(),this._tmpMat4=xe()}addInstance(e){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);ze(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*WP(i),r.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},XAt=class{constructor(e,r){this._worldSpaceRadius=e,this._minScreenSpaceRadii=r}selectLevel(e,r,i){const n=i.computeScreenPixelSizeAt(e),s=this._worldSpaceRadius*r/n;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)s>=this._minScreenSpaceRadii[a]&&(o=a);return o}},ZAt=class extends xN{constructor(e,r,i,n,s,o){super(e,r),this.layerUid=e,this.graphicUid=r,this.geometryId=i,this.triangleNr=n,this.baseBoundingSphere=s,this.numLodLevels=o}};function sce(t){return _p(t)&&t.intersector===Yi.LOD&&!!t.target}let JAt=class{constructor(e,r){const i=e.renderContext.rctx,n=r.geometry;this._materialRepository=e.materialRepository,n.material.setParameters({instancedDoublePrecision:!0});const s=n.material.createBufferWriter(),o=s.vertexBufferLayout,a=s.elementCount(n),l=o.createBuffer(a);s.write(null,null,n,l,0),this.geometry=n,this.material=n.material,this.glMaterials=new wke(n.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=ti.createVertex(i,Lr.STATIC_DRAW,l.buffer),this.vao=new wm(i,Nr,{geometry:Ju(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,r,i,n,s,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,n,(u,h,p,f,g)=>{if(u>=0){if(r!=null&&!r(e.rayBegin,e.rayEnd,u))return;const y=new ZAt(o.layerUid,o.graphicUid(s),c,p,a,l);if((e.results.min.drapedLayerOrder==null||g>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||u<e.results.min.dist)&&e.results.min.set(Yi.LOD,y,u,h,e.transform.transform,g),e.options.store!==ha.MIN&&(e.results.max.drapedLayerOrder==null||g>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||u>e.results.max.dist)&&e.results.max.set(Yi.LOD,y,u,h,e.transform.transform,g),e.options.store===ha.ALL){const v=Moe(e.results.min.ray);v.set(Yi.LOD,y,u,h,e.transform.transform,g),e.results.all.push(v)}}})}},QAt=class y8e{static async create(e,r,i){const n=await Promise.allSettled(r.components.map(o=>e.controller.schedule(()=>new JAt(e,o),i))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(rw);if(Ms(i)||s.length!==n.length){s.forEach(o=>o.destroy()),dt(i);for(const o of n)if(o.status==="rejected")throw o.reason}return new y8e(r.minScreenSpaceRadius,s)}constructor(e,r){this.minScreenSpaceRadius=e,this.components=r}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,r,i,n,s,o,a){this.components.forEach(l=>l.intersect(e,r,i,n,s,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=zi();this.components.forEach(r=>{r.boundingInfo!=null&&(um(e,r.boundingInfo.bbMin),um(e,r.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,r=C();kf(e,r),this._boundingSphere={center:r,radius:.5*LAe(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,r)=>e+r.triangleCount,0)}};const KAt=t=>{const e=t.baseBoundingSphere.radius,r=t.levels.map(i=>i.minScreenSpaceRadius);return new XAt(e,r)};let bd=class extends Xmt{constructor(e,r){super(e),this.type=Yi.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new st,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[de.OPAQUE_MATERIAL,i=>this._produces(i)],[de.TRANSPARENT_MATERIAL,i=>!!this._hasTransparentLevels()&&this._produces(i)]]),this._instanceData=new xC({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(r.registerTask(Ct.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=tOt(this.optionalFields),this._glInstanceBufferLayout=Ju(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((e,r)=>r.reduce((i,n)=>i+n.usedMemory,e),0)}get renderStats(){const e=this._instanceData.size,r=[];return this._levels.forEach((i,n)=>{const s=this._allRenderInstanceData[0][n].size+this._allRenderInstanceData[1][n].size,o=i.triangleCount;r.push({renderedInstances:s,renderedTriangles:s*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:r.reduce((i,n)=>i+n.renderedInstances,0),renderedTriangles:r.reduce((i,n)=>i+n.renderedTriangles,0),levels:r}}async initializeRenderContext(e,r){this._context=e;const i=e.renderContext.rctx,n=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new dve(i,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new dve(i,this._instanceBufferLayout)),QAt.create(e,o,r)))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(rw);if(Ms(r)||s.length!==n.length){s.forEach(o=>o.destroy()),dt(r);for(const o of n)if(o.status==="rejected")throw o.reason}this._levels=s,this._levelSelector=KAt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}_hasTransparentLevels(){return this._levels.some(e=>e.components.some(r=>{const i=r.material.produces.get(de.TRANSPARENT_MATERIAL);return i&&i(G.Color)}))}hasHighlights(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}_produces(e){return e!==G.Highlight&&e!==G.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!Si.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const r=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),r||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(Xl),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const r=this._getInstanceDatas(e.output);if(!r)return null;const i=new Array;return r.forEach(n=>this.levels.forEach((s,o)=>{s.components.forEach(a=>i.push(this._beginComponent(e,n[o],a)))})),i}renderNode(e,r){const i=this._getInstanceDatas(e.output);if(!i||r==null)return;let n=0;e.rctx.bindVAO(),i.forEach(s=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,r[n++],s[a],l,a))}))}_getInstanceDatas(e){const r=e!==G.Highlight&&e!==G.ShadowHighlight,i=e!==G.ShadowExcludeHighlight;return r&&i?this._allRenderInstanceData:r?this._defaultRenderInstanceData:i?this._highlightRenderInstanceData:null}intersect(e,r,i,n){if(!this.baseMaterial.isVisible()||this._octree==null)return;const s=C();_e(s,n,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,yve),e.transform.set(yve),ze(_ve,i,e.transform.inverse),ze(vve,n,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),u=this._levels.length;_t((l&Ki.ACTIVE)!=0,"invalid instance state"),_t(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(e,r,_ve,vve,a,this.metadata,u)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,s,o)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(this._octreeCached==null){const r=this._instanceData,i=(e=r.view)==null?void 0:e.state;if(!i)return null;this._octreeCached=new YAt(r,this.baseBoundingSphere);for(let n=0;n<r.capacity;++n)i.get(n)&Ki.ACTIVE&&this._octreeCached.addInstance(n)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Me(this._octreeCached)}queryDepthRange(e){if(this._octree==null)return{near:1/0,far:-1/0};const r=e.viewForward,i=this._octree.findClosest(r,Bf.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(r,Bf.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||n==null)return{near:1/0,far:-1/0};const s=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,Gm),_e(Gm,Gm,s);const a=fe(Gm,r)-Gm[3];o.boundingSphere.getVec(n,Gm),_e(Gm,Gm,s);const l=fe(Gm,r)+Gm[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(r=>r.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:r,_camera:i,_levelSelector:n}=this;this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.beginUpdate()));const s=this._instanceData,o=s.view;let a=s.size;const l=s.capacity;let c=this._instanceIndex;const u=Math.ceil(l/500);for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&Ki.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const g=o.lodLevel.get(c);if(p&Ki.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][g].freeTail(),p&Ki.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][g].freeTail(),p&Ki.REMOVE)s.freeInstance(c);else if(p&Ki.VISIBLE){let y=0;r&&(o.modelOrigin.getVec(c,gve),y=n.selectLevel(gve,s.getCombinedMedianScaleFactor(c),i)),f=p&~(Ki.ACTIVE|Ki.TRANSFORM_CHANGED),y>=0&&(p&Ki.HIGHLIGHT?(mve(this._highlightRenderInstanceData[0][y],o,c),f|=Ki.HIGHLIGHT_ACTIVE):(mve(this._defaultRenderInstanceData[0][y],o,c),f|=Ki.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,y)}else f=p&~(Ki.ACTIVE|Ki.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octreeCached!=null){const y=!!(p&Ki.ACTIVE),v=!!(f&Ki.ACTIVE);!y&&v?this._octreeCached.addInstance(c):y&&!v?this._octreeCached.removeInstance(c):y&&v&&p&Ki.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%u==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.endUpdate())),this._context.requestRender()}_beginComponent(e,r,i){if(r.size===0)return null;const n=i.glMaterials.load(e.rctx,e.bindParameters.slot,e.output);return n!=null?n.beginSlot(e.bindParameters):null}_renderComponent(e,r,i,n,s){if(!r)return;const{bindParameters:o,rctx:a}=e;a.runAppleAmdDriverHelper();const l=a.bindTechnique(r,o,n.material.parameters,rOt);a.bindVAO(n.vao),r.ensureAttributeLocations(n.vao),Si.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===G.Color&&(l.setUniform4fv("externalColor",bve[Math.min(s,bve.length-1)]),l.setUniform1i("colorMixMode",C4e.replace));const c=i.capacity,u=i.headIndex,h=i.tailIndex,p=i.firstIndex,f=this._glInstanceBufferLayout,g=(y,v)=>{oae(a,Nr,i.buffer,f,y),a.drawArraysInstanced(r.primitiveType,0,n.vertexCount,v-y),rDe(a,Nr,i.buffer,f)};n.material.parameters.transparent&&p!=null?u>h?(_t(p>=h&&p<=u,"invalid firstIndex"),g(p,u),g(h,p)):u<h&&(p<=u?(_t(p>=0&&p<=u,"invalid firstIndex"),g(p,u),g(h,c),g(0,p)):(_t(p>=h&&p<=c,"invalid firstIndex"),g(p,c),g(0,u),g(h,p))):u>h?g(h,u):u<h&&(g(0,u),g(h,c)),a.bindVAO(null)}};function mve(t,e,r){const i=t.allocateHead();eOt(e,r,t.view,i)}function eOt(t,e,r,i){tet(t.modelOrigin,e,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,t.model,e),r.modelNormal.copyFrom(i,t.modelNormal,e),t.color&&r.color&&r.color.copyFrom(i,t.color,e),t.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,t.objectAndLayerIdColor,e),t.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,t.featureAttribute,e)}function tOt(t){let e=ln().vec3f(R.INSTANCEMODELORIGINHI).vec3f(R.INSTANCEMODELORIGINLO).mat3f(R.INSTANCEMODEL).mat3f(R.INSTANCEMODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(R.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(R.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(R.INSTANCEOBJECTANDLAYERIDCOLOR)),e}d([m({constructOnly:!0})],bd.prototype,"symbol",void 0),d([m({constructOnly:!0})],bd.prototype,"optionalFields",void 0),d([m({constructOnly:!0})],bd.prototype,"metadata",void 0),d([m({constructOnly:!0})],bd.prototype,"shaderTransformation",void 0),d([m()],bd.prototype,"_instanceData",void 0),d([m()],bd.prototype,"_cycleStartIndex",void 0),d([m({readOnly:!0})],bd.prototype,"_enableLevelSelection",null),d([m()],bd.prototype,"_updateCyclesWithStaticCamera",void 0),d([m({readOnly:!0})],bd.prototype,"running",null),bd=d([F("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],bd);const gve=C(),Gm=tr(),yve=xe(),_ve=C(),vve=C(),bve=[Xt(1,0,1,1),Xt(0,0,1,1),Xt(0,1,0,1),Xt(1,1,0,1),Xt(1,0,0,1)],rOt=new Obt;let wve=class{constructor(e,r,i,n,s,o,a,l,c,u,h,p){this.lodResources=e,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=n,this.resourceSize=s,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=h,this.pivotOffset=p}},iOt=class extends Cy{getCachedSize(){const[e,r,i]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:r,height:i}}constructor(e,r,i,n){super(e,r,i,n),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&dG(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,i=r&&jvt(r.primitive)?r.primitive:VIe;this._resources=await this._createResourcesForPrimitive(i,e)}else{const r=await GAt(this.symbol.styleOrigin),i=(r==null?void 0:r.href)??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(i,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){var e;return!((e=this.symbolLayer.resource)!=null&&e.href)}get lodRenderer(){var e;return(e=this._resources)==null?void 0:e.lodRenderer}get materials(){var e;return((e=this._resources)==null?void 0:e.stageResources.materials)??[]}_setMaterialTransparencyParameters(e,r=(n=>(n=(i=>(i=this.symbolLayer)==null?void 0:i.material)())==null?void 0:n.color)()){const s=this._getCombinedOpacity(r),o=s<1||this.needsDrivenTransparentPass;return e.transparent=o,e.opacity=s,e.cullFace=o?$i.None:$i.Back,e}async _createResourcesForPrimitive(e,r){const i=this.symbolLayer,n=Ds(tht(e)),s=Ka(Y4(n)),o=Ka(gH(s,i)),a=Te(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...ule],ambient:Fg,diffuse:Fg,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},h=!!u.usePBR;this._setMaterialTransparencyParameters(u);const p=this.symbol;if(p.type==="point-3d"&&p.verticalOffset){const{screenLength:w,minWorldLength:x,maxWorldLength:S}=p.verticalOffset;u.verticalOffset={screenLength:bs(w),minWorldLength:x||0,maxWorldLength:S??1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=Bd;else{const w=i.material!=null?i.material.color:null,x=w!=null?De.toUnitRGBA(w):Bd;u.externalColor=x}this._fastUpdates=fA(this._context.renderer,this._fastVisualVariableConvertOptions(n,o,s,null)),u.isInstanced=!0,this._fastUpdates?(Object.assign(u,this._fastUpdates.materialParameters),this._optionalFields.push(R.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(u.hasInstancedColor=!0,this._optionalFields.push(R.COLOR)),ne("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(R.OBJECTANDLAYERIDCOLOR);const f=new gm(u),g=f5e(e,f);if(!g)throw new Error(`Unknown object symbol primitive: ${e}`);const y=lF(g).map(w=>({opacity:1,transparent:w.parameters.transparent})),v=await this._createStageResources(g,h,r),b=await this._createLodRenderer(g,r);return new wve(g,b,v,y,s,l,c,n,o,a,h,null)}async _createResourcesForUrl(e,r){var z,W;const i={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=fA(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(i.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(R.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(i.materialParameters.hasInstancedColor=!0,this._optionalFields.push(R.COLOR)),ne("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(R.OBJECTANDLAYERIDCOLOR);const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:V,minWorldLength:J,maxWorldLength:Y}=n.verticalOffset;i.materialParameters.verticalOffset={screenLength:bs(V),minWorldLength:J||0,maxWorldLength:Y??1/0},i.materialParameters.castShadows=!1}const s=this._context.physicalBasedRenderingEnabled;i.signal=r,i.usePBR=s,i.skipHighLods=this._context.skipHighSymbolLods;const o=await u8e(e,i),a=o.isEsriSymbolResource,l=o.isWosr,c=PPt(o.lods),u=this._context,h=this.symbolLayer.material,p=this._getExternalColorParameters(h),f=(W=(z=this.symbolLayer)==null?void 0:z.material)==null?void 0:W.color,g=this._getCombinedOpacity(f,{hasIntrinsicColor:!0}),y=this.needsDrivenTransparentPass,v=lF(c),b=lF(c).map(V=>({opacity:V.parameters.opacity||1,transparent:V.parameters.transparent}));v.forEach(V=>{const J=V.parameters;V.setParameters(p);const Y=J.opacity*g,X=Y<1||y||J.transparent;V.setParameters({opacity:Y,transparent:X}),u.screenSizePerspectiveEnabled&&V.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const w=o.referenceBoundingBox,x=Ka(Y4(w)),S=Ka(c.levels[0].pivotOffset),E=Ka(gH(x,this.symbolLayer)),P=Te(E),M=this._fastUpdates;mA(M,this._context.renderer,this._fastVisualVariableConvertOptions(w,E,x,S))&&v.forEach(V=>V.setParameters(M.materialParameters));const L=await this._createStageResources(c,s,r),U=await this._createLodRenderer(c,r);return new wve(c,U,L,b,x,a,l,w,E,P,s,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,r,i){const n=this._context.stage,s=lF(e);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),n.addMany(s),this._addDisposeResource(()=>n.removeMany(s));const o=P0e(e);n.addMany(o),this._addDisposeResource(()=>{o.forEach(l=>l.unload()),n.removeMany(o)}),await Promise.all(o.map(l=>this._context.stage.schedule(()=>l.load(n.renderView.renderingContext),i))),dt(i);const a=A0e(e);return n.addMany(a),this._addDisposeResource(()=>n.removeMany(a)),{materials:s,textures:o,geometries:a}}async _createLodRenderer(e,r){const i=this._context.stage,n={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},s=this._fastUpdates,o=s?{applyTransform:(l,c,u)=>{l.getFeatureAttribute(c,NF),cs(u,e1t(s.materialParameters,NF,u))},scaleFactor:(l,c,u)=>{c.getFeatureAttribute(u,NF),qae(l,s.materialParameters,NF)}}:null,a=new bd({symbol:e,optionalFields:this._optionalFields,metadata:n,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(a),a.destroy()}),await i.addRenderPlugin(a,r),a}_getExternalColorParameters(e){const r={};return this._drivenProperties.color?r.externalColor=Bd:(e==null?void 0:e.color)!=null?r.externalColor=De.toUnitRGBA(e.color):(r.externalColor=Bd,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;const i=SD(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const n=this.setGraphicElevationContext(r),s=e.renderingInfo;return this._createAs3DShape(r,i,s,n,r.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){var s,o;if(this._resources==null)return;const e=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,n=this._resources.originalMaterialParameters;for(let a=0;a<i.length;a++){const l=i[a],c=(o=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:o.color,u=n[a],h=this._getCombinedOpacity(c,{hasIntrinsicColor:r})*u.opacity,p=h<1||e||u.transparent;l.setParameters({opacity:h,transparent:p}),this._isPrimitive&&l.setParameters({cullFace:p?$i.None:$i.Back})}}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,Wb)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:r}=this._resources;for(const i of e.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,r){if(this._resources==null)return ls.RecreateSymbol;const{stageResources:{materials:i},lodRenderer:n,resourceBoundingBox:s,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!mA(this._fastUpdates,r,this._fastVisualVariableConvertOptions(s,o,a,l)))return ls.RecreateSymbol;for(const u of i)u.setParameters(this._fastUpdates.materialParameters);n.notifyShaderTransformationChanged()}return ls.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,r=Q5e(e.levels),i=a=>Array.from(a.attributes.values()).reduce((l,c)=>l+i_(c.data,c.indices),0),n=A0e(e).reduce((a,l)=>a+i(l),0),s=P0e(e).reduce((a,l)=>a+l.memoryEstimate,0)+n,o={...J5e(this.symbol,this.symbolLayer),resourceBytes:s};return new Rd({verticesPerFeature:r,memory:o})}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,r,i,n,s,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(Cn(r,CE,this._context.elevationProvider.spatialReference),l!=null&&!wse(l,CE))return null;const c=this._requiresTerrainElevation(n),u=this._computeGlobalTransform(r,n,bW,FF),h=this._computeLocalTransform(this._resources,this.symbolLayer,i,xve),p=this._resources.lodRenderer.instanceData,f=p.addInstance();this._instanceIndexToGraphicUid.set(f,s),p.setLocalTransform(f,h,!1),p.setGlobalTransform(f,u),a&&p.setFeatureAttribute(f,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&p.setColor(f,UI(i.color,i.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&p.setObjectAndLayerIdColor(f,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:s,layerUid:o}));const g=new TPt(this,f,Pvt,n);return c&&(g.alignedSampledElevation=FF.sampledElevation),g.needsElevationUpdates=Wb(n.mode),xD(g,r,this._context.elevationProvider),g}_computeGlobalTransform(e,r,i,n){return qb(e,this._context.elevationProvider,r,this._context.renderCoordsHelper,n),CE[0]=e.x,CE[1]=e.y,CE[2]=n.z,Ua(e.spatialReference,CE,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,r,i,n){return cp(n),this._applyObjectRotation(i,!1,n),this._applyObjectRotation(r,!0,n),this._applyObjectScale(e,i,n),this._applyAnchor(e,r,n),n}_applyObjectScale(e,r,i){var o;if((o=this._fastUpdates)!=null&&o.requiresShaderTransformation)return;const n=this._drivenProperties.size&&r.size?r.size:e.symbolSize,s=E0e(n,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);s[0]===1&&s[1]===1&&s[2]===1||g2(i,i,s)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchTransform(e,r),this._preparePatchColor(e,r)}updateGeometry(e,r){if(this._resources==null)return!0;const i=r&&SD(r);if(i==null)return!1;const n=this.getGeometryElevationMode(r);return e.elevationContext.mode===n&&(this._computeGlobalTransform(i,e.elevationContext,bW,FF),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=FF.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,bW,!0),xD(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||this._resources==null)return;const i=(g,y,v)=>(g!=null&&g.type==="complete"?g.newValue:y)??v,n=i(r.heading,this.symbolLayer.heading,0),s=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),u=i(r.anchor,this.symbolLayer.anchor,void 0),h=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const p={heading:n,tilt:s,roll:o,anchor:u,anchorPosition:h},f=this._resources;this.loadStatus===Ch.LOADED&&e.symbolLayerStatePatches.push(()=>{f.symbolSize=Ka(gH(f.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((g,y)=>{const v=this._computeLocalTransform(f,p,y,xve),b=g.instanceIndex;f.lodRenderer.instanceData.setLocalTransform(b,v,!0)})}_preparePatchColor(e,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const n=i.color.newValue,s=n!=null?De.toUnitRGBA(n):Bd;delete i.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,s),l=this._setMaterialTransparencyParameters({},n)):l=this._setMaterialTransparencyParameters({externalColor:s},n);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,r,i){var n;if(!((n=this._fastUpdates)!=null&&n.requiresShaderTransformation)||!r)return Vvt(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,r,i){const n=C();switch(i.anchor){case"center":he(n,kf(e)),ua(n,n);break;case"top":{const s=kf(e);se(n,-s[0],-s[1],-e[5]);break}case"bottom":{const s=kf(e);se(n,-s[0],-s[1],-e[2]);break}case"relative":{const s=kf(e),o=Y4(e),a=i.anchorPosition,l=a?Ce(a.x,a.y,a.z):Yn;bB(n,o,l),ge(n,n,s),ua(n,n);break}default:r!=null?ua(n,r):he(n,Yn)}return n}_applyAnchor(e,r,i){var s;if((s=this._fastUpdates)!=null&&s.requiresShaderTransformation)return;const n=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,r);n&&Fc(i,i,n)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,r,i,n){const s=e!=null?Ka(Y4(e)):Fg,o=e!=null?this._computeAnchor(e,n,this.symbolLayer):Yn,a=this._context.renderCoordsHelper.unitInMeters,l=E0e(r??void 0,r,i,a),c=Ce(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new IN({size:!0,color:!0,rotation:!0,opacity:!1},s,r??Fg,a,o,l,c)}};const CE=C(),xve=xe(),bW=xe(),NF=tr(),FF=new FN;let nOt=class{constructor(e,r,i,n){this.vertices=e,this.positionsES=r,this.offset=n;const s=e.length,o=Math.floor(s/2),a=this.offset+3*o,l=i[a],c=i[a+1],u=i[a+2];this.origin=Ce(l,c,u),this.positions=Tn(3*s);const h=this.offset+3*s;for(let p=this.offset;p<h;p+=3)this.positions[p]=i[p]-l,this.positions[p+1]=i[p+1]-c,this.positions[p+2]=i[p+2]-u;this.updatePathVertexInformation()}get usedMemory(){return i_(this.positions)}updatePathVertexInformation(){const e=this.vertices.length,r=this.vertices[0];let i=this.offset;const n=this.positions;r.vRight[0]=n[i+3]-n[i],r.vRight[1]=n[i+4]-n[i+1],r.vRight[2]=n[i+5]-n[i+2],i+=3;let s=Te(r.vRight);r.vMinSiblingLength=s,me(r.vRight,r.vRight);let o=r;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=n[i+3]-n[i],l.vRight[1]=n[i+4]-n[i+1],l.vRight[2]=n[i+5]-n[i+2];const c=Te(l.vRight);l.vMinSiblingLength=Math.min(s,c),s=c,me(l.vRight,l.vRight)}else he(l.vRight,l.vLeft),l.vMinSiblingLength=s;o=l,i+=3}}},sOt=class{constructor(e,r,i,n,s,o={}){this.path=e,this.profile=r,this.extruder=i,this.startCap=n,this.endCap=s,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=vKe(1*this.numVerticesTotal),this.profileRightAxes=Tn(4*this.numVerticesTotal),this.profileUpAxes=Tn(4*this.numVerticesTotal),this.profileVertexAndNormals=Tn(4*this.numVerticesTotal),this.positions=y9(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return i_(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(e,r,i,n,s){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=r.right[0],this.profileRightAxes[o+1]=r.right[1],this.profileRightAxes[o+2]=r.right[2],this.profileUpAxes[o]=r.up[0],this.profileUpAxes[o+1]=r.up[1],this.profileUpAxes[o+2]=r.up[2],this.profileVertexAndNormals[o]=i[0],this.profileVertexAndNormals[o+1]=i[1],this.profileVertexAndNormals[o+2]=n[0],this.profileVertexAndNormals[o+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,s){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,r,i,n,s,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=r.right[0],this.profileRightAxes[a+1]=r.right[1],this.profileRightAxes[a+2]=r.right[2],this.profileRightAxes[a+3]=s,this.profileUpAxes[a]=r.up[0],this.profileUpAxes[a+1]=r.up[1],this.profileUpAxes[a+2]=r.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=i[0],this.profileVertexAndNormals[a+1]=i[1],this.profileVertexAndNormals[a+2]=n[0],this.profileVertexAndNormals[a+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:r,vertices:i}=this.path;this.positions=y9(e,r,3*i.length);let n=0;const s=(a,l,c,u,h)=>this.emitCapVertex(n,a,l,c,u,h),o=(a,l,c,u)=>this.emitVertex(n,a,l,c,u);for(this.startCap.rebuildConnectingProfileGeometry(i[n],this.profile,s),n=1;n<i.length-1;++n)this.extruder.extrude(i[n],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(i[n],this.profile,s),n=0,this.startCap.rebuildCapGeometry(i[n],s),n=i.length-1,this.endCap.rebuildCapGeometry(i[n],s)}buildTopology(){const e=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let n=3*(2*(r*i));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.numIndices,this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const s=new Array,o=new Array,a=new Array,l=(c,u,h)=>{s.push(c),s.push(u),s.push(h),o.push(c),o.push(u),o.push(h),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[h])};for(let c=0;c<r;++c){const u=this.profile.indices[2*c],h=this.profile.indices[2*c+1];for(let p=0;p<i;++p){const f=p*e+u,g=(p+1)*e+h,y=p*e+h;l(f,(p+1)*e+u,g),l(f,g,y)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=Yg(s),this.normalIndices=Yg(o),this.pathVertexIndices=Yg(a)}onPathChanged(){this._rebuildGeometry()}},oce=class{rebuildConnectingProfileGeometry(e,r,i){for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],0,0)}},Sve=class extends oce{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},kF=class extends oce{constructor(e,r=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=r,this.flip=i}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,r,i){const n=this.profilePlaneOffset;for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],n,0)}rebuildCapGeometry(e,r){const i=this.profile,n=this.flip?1:-1,s=this.profilePlaneOffset,o=_8e;yr(o,0,0);for(let a=0;a<i.vertices.length;++a)r(e.frame,i.vertices[a],o,s,n)}buildTopology(e,r){const i=this.profile,n=this.vertexBufferStart+i.indices[0];for(let s=1;s<i.numSegments;++s){const o=i.indices[2*s],a=i.indices[2*s+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?r(c,l,n):r(n,l,c)}}},Tve=class extends oce{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const r=this.profile;e+=2*r.numSegments*(this.numSegments-1);for(let i=0;i<r.numSegments;++i){const n=r.indices[2*i],s=r.indices[2*i+1];r.poleIndices[n]===r.poleIndices[s]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,r){const i=this.profile,n=e.frame,s=.5*this.sign,o=oOt,a=_8e;yr(a,0,0);for(const l of i.poles)l.normal?r(n,l.position,l.normal,s,0):r(n,l.position,a,s,this.sign);if(this.breakNormals)for(let l=0;l<i.vertices.length;++l)r(n,i.vertices[l],i.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,u=Math.sin(c),h=Math.cos(c);for(let p=0;p<i.vertices.length;++p){const f=i.poles[i.poleIndices[p]];Ag(o,i.vertices[p],f.position),Eu(o,o,u),f.normal?(vf(o,o,f.position),r(n,o,f.normal,s*h,0)):(QL(a,o),Eu(a,a,u),vf(o,o,f.position),r(n,o,a,s*h,this.sign*h))}}}buildTopology(e,r){const i=this.profile,n=this.breakNormals?this.vertexBufferStart+i.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+i.poles.length+i.vertices.length:this.vertexBufferStart+i.poles.length;for(let o=0;o<i.numSegments;++o){const a=i.indices[2*o],l=i.indices[2*o+1],c=this.vertexBufferStart+i.poleIndices[a],u=this.vertexBufferStart+i.poleIndices[l];let h=n+a,p=n+l;for(let f=0;f<this.numSegments-1;++f){const g=s+f*i.vertices.length+a,y=s+f*i.vertices.length+l;this.flip?(r(g,p,h),r(p,g,y)):(r(h,p,g),r(y,g,p)),h=g,p=y}this.flip?(r(c,p,h),c!==u&&r(c,u,p)):(r(h,p,c),c!==u&&r(p,u,c))}}};const oOt=Ye(),_8e=Ye();let aOt=class{numProfilesPerJoin(){return 1}extrude(e,r,i){for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],!1)}},wW=class{constructor(e,r){this.cutoffAngle=e,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,r,i){const n=cOt,{rotationAngle:s,rotationRight:o,frame:a}=e;if(Math.abs(s)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){Gu(Cve,.5*-s+c*s/this.numBendSubdivisions,l),lOt(n,a,Cve);for(let u=0;u<r.vertices.length;++u)js(r.vertices[u],o)*s>=0?i(n,r.vertices[u],r.normals[u],!1):i(a,e.applyMiterStretch(Eve,r.vertices[u]),r.normals[u],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<r.vertices.length;++c){const u=js(r.vertices[c],o)*s>=0;i(a,e.applyMiterStretch(Eve,r.vertices[c]),r.normals[c],!u)}}},v8e=class{constructor(){this.up=C(),this.right=C()}};function lOt(t,e,r){ze(t.up,e.up,r),ze(t.right,e.right,r)}const Eve=Ye(),Cve=xe(),cOt=new v8e;let uOt=class extends Is{constructor(e,r,i,n,s,o){super(e,r,null,Ln.Mesh,o),this.path=i,this.geometrySR=n,this.stencilWidth=s}};var Kg;function b8e(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(Kg||(Kg={}));let w8e=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},x8e=class extends w8e{constructor(e){super(e),this.vertexAttributeColor=Xt(255,255,255,255),this.size=new Array,this.vertexAttributePosition=Tn(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:r,pathVertexData:i,path:n,positions:s,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<r;++c){let u=i[c];const h=u===0||u===n.vertices.length-1;u*=3;const p=mOt;let f=0,g=0;const y=4*c,v=se(gOt,o[y],o[y+1],o[y+2]),b=se(yOt,a[y],a[y+1],a[y+2]),w=yr(Pve,l[y]*e[0],l[y+1]*e[1]);if(h)it(p,b,v),f=o[y+3]*e[0],g=a[y+3];else{const P=dOt,M=pOt;yr(P,o[y+3],a[y+3]);const L=kse(P);QL(P,P);const U=js(w,P);if(Math.abs(U)>L){yr(M,-P[1],P[0]);const z=js(w,M);Eu(P,P,L*Math.sign(U)),Eu(M,M,z),vf(w,P,M)}se(p,0,0,0)}const x=se(fOt,v[0]*w[0]+b[0]*w[1],v[1]*w[0]+b[1]*w[1],v[2]*w[0]+b[2]*w[1]),S=3*c;this.vertexAttributePosition[S]=s[u]+x[0]+p[0]*f,this.vertexAttributePosition[S+1]=s[u+1]+x[1]+p[1]*f,this.vertexAttributePosition[S+2]=s[u+2]+x[2]+p[2]*f;const E=yr(Pve,l[y+2],l[y+3]);_m(this.vertexAttributeNormal,c,v[0]*E[0]+b[0]*E[1]+p[0]*g,v[1]*E[0]+b[1]*E[1]+p[1]*g,v[2]*E[0]+b[2]*E[1]+p[2]*g)}}createGeometryData(){const e=this.builder.vertexIndices.length,{normalIndices:r,vertexIndices:i}=this.builder;return[[R.POSITION,new tt(this.vertexAttributePosition,i,3,!0)],[R.NORMALCOMPRESSED,new tt(this.vertexAttributeNormal,r,2,!0)],[R.COLOR,new tt(this.vertexAttributeColor,ow(e),4)]]}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,r,i){const n=this.builder.vertexIndices,s=new jA(this.vertexAttributePosition,3),o=n.length/3;LN(e,r,0,o,n,s,void 0,void 0,i)}},hOt=class extends w8e{constructor(e,r,i,n){super(e),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=n,this.vvData=null,this.baked=new x8e(e),this.vvData=Tn(4*this.builder.path.vertices.length);for(let s=0;s<this.builder.path.vertices.length;++s){this.vvData[4*s]=r,this.vvData[4*s+1]=i,this.vvData[4*s+2]=n;const o=s===0||s===this.builder.path.vertices.length-1;this.vvData[4*s+3]=o?1:0}}createGeometryData(){const{positions:e,profileRightAxes:r,profileUpAxes:i,profileVertexAndNormals:n,pathVertexIndices:s,vertexIndices:o}=this.builder;return[[R.POSITION,new tt(e,s,3,!0)],[R.PROFILERIGHT,new tt(r,o,4,!0)],[R.PROFILEUP,new tt(i,o,4,!0)],[R.PROFILEVERTEXANDNORMAL,new tt(n,o,4,!0)],[R.FEATUREVALUE,new tt(this.vvData,s,4,!0)]]}onPathChanged(e){super.onPathChanged(e);const r=e.getMutableAttribute(R.POSITION);r&&(r.data=this.builder.positions)}};const Pve=Ye(),dOt=Ye(),pOt=Ye(),fOt=C(),mOt=C(),gOt=C(),yOt=C();function _Ot(t,e){let r=null;const i=t.vertices.length,n=.99619469809,s=C(),o=C(),a=C(),l=C(),c=C(),u=C(),h=Yr();let p=t.vertices[0];he(o,e),se(s,0,1,0),_9(p.vRight,o,s,s,a,o,n),he(p.frame.up,o),he(p.frame.right,a);const f=t.positions;let g=t.offset;r=p;for(let y=1;y<i;++y){p=t.vertices[y],ge(c,p.vLeft,p.vRight);let v=Te(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=p.vRight[0],c[1]=p.vRight[1],c[2]=p.vRight[2]),u[0]=f[g]+r.frame.up[0],u[1]=f[g+1]+r.frame.up[1],u[2]=f[g+2]+r.frame.up[2],g+=3;const b=se(vOt,f[g],f[g+1],f[g+2]);dN(b,c,h),v2(h,Wh(u,p.vLeft),l)?(l[0]-=f[g],l[1]-=f[g+1],l[2]-=f[g+2],me(o,l),it(a,c,o),me(a,a)):_9(c,r.frame.up,r.frame.right,s,a,o,n),he(p.frame.up,o),he(p.frame.right,a),r=p}}const vOt=C();let S8e=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,r){return this.vertices.push(rR(e)),this.normals.push(rR(r)),this.vertices.length-1}addPole(e,r=null){return this.poles.push({position:rR(e),normal:r?rR(r):null}),this.poles.length-1}addSegment(e,r=null){this.indices.push(e.v0),this.indices.push(e.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.indices.length/2}translate(e,r){for(const i of this.vertices)i[0]+=e,i[1]+=r;for(const i of this.poles)i.position[0]+=e,i.position[1]+=r}get usedMemory(){return this.vertices.length*i_(this.vertices[0])*2+i_(this.indices)}};const T8e={top:[0,-.5],bottom:[0,.5]};function xW(t){const r=u5e,i=new S8e,n={v0:0,v1:0};i.addPole(mr(0,0));for(let o=0;o<r;++o){const a=2*o*Math.PI/r,l=Math.cos(a),c=Math.sin(a),u=mr(l*.5,c*.5),h=mr(l,c);i.addVertex(u,h)}for(let o=0;o<r-1;++o){const a={v0:o,v1:o+1};i.addSegment(a,n)}const s={v0:r-1,v1:0};if(i.addSegment(s,n),t!=="center"){const o=T8e[t];i.translate(o[0],o[1])}return i}const bOt={center:xW("center"),top:xW("top"),bottom:xW("bottom")},wOt={center:SW("center"),top:SW("top"),bottom:SW("bottom")};function SW(t){const i=new S8e,n=mr(.5*-1,.5*-1),s=mr(.5*1,.5*-1),o=mr(.5*1,.5*1),a=mr(.5*-1,.5*1),l=mr(0,-1),c=mr(1,0),u=mr(0,1),h=mr(-1,0);if(i.addPole(mr(0,.5*1),u),i.addPole(mr(0,.5*1)),i.addPole(mr(0,.5*-1)),i.addPole(mr(0,.5*-1),l),i.addVertex(n,l),i.addVertex(s,l),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(s,c),i.addVertex(o,c),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(o,u),i.addVertex(a,u),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(a,h),i.addVertex(n,h),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const p=T8e[t];i.translate(p[0],p[1])}return i}function xOt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function SOt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function E8e(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function TOt(t,e){if(t===e){const r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function EOt(t,e){const r=e[0],i=e[1],n=e[2],s=e[3];let o=r*s-n*i;return o?(o=1/o,t[0]=s*o,t[1]=-i*o,t[2]=-n*o,t[3]=r*o,t):null}function COt(t,e){const r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function POt(t){return t[0]*t[3]-t[2]*t[1]}function C8e(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*a+s*l,t[1]=n*a+o*l,t[2]=i*c+s*u,t[3]=n*c+o*u,t}function AOt(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+s*a,t[1]=n*l+o*a,t[2]=i*-a+s*l,t[3]=n*-a+o*l,t}function OOt(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1];return t[0]=i*a,t[1]=n*a,t[2]=s*l,t[3]=o*l,t}function MOt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function ROt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function $Ot(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function IOt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function LOt(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function DOt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function P8e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function NOt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function FOt(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=ml();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))}function kOt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function UOt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}const zOt=C8e,VOt=P8e;Object.freeze(Object.defineProperty({__proto__:null,LDU:LOt,add:DOt,adjoint:COt,copy:xOt,determinant:POt,equals:FOt,exactEquals:NOt,frob:IOt,fromRotation:MOt,fromScaling:ROt,identity:SOt,invert:EOt,mul:zOt,multiply:C8e,multiplyScalar:kOt,multiplyScalarAndAdd:UOt,rotate:AOt,scale:OOt,set:E8e,str:$Ot,sub:VOt,subtract:P8e,transpose:TOt},Symbol.toStringTag,{value:"Module"}));function A8e(){return[1,0,0,1]}function BOt(t){return[t[0],t[1],t[2],t[3]]}function GOt(t,e,r,i){return[t,e,r,i]}function jOt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:BOt,create:A8e,createView:jOt,fromValues:GOt},Symbol.toStringTag,{value:"Module"}));let O8e=class{constructor(){this.vLeft=C(),this.vRight=C(),this.vMinSiblingLength=0,this.frame=new v8e}setFrameFromUpVector(e){he(this.frame.up,e),ge(EM,this.vLeft,this.vRight),me(EM,EM),oe(Mve,this.frame.up,fe(EM,this.frame.up)),_e(UF,EM,Mve),me(UF,UF),it(this.frame.right,UF,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},HOt=class extends O8e{get rotationFrameUp(){return this.frame.up}get rotationRight(){return TAe}get rotationAngle(){return oe(_1,this.frame.up,fe(this.frame.up,this.vLeft)),_e(_1,this.vLeft,_1),ua(_1,_1),me(_1,_1),oe(AE,this.frame.up,fe(this.frame.up,this.vRight)),_e(AE,this.vRight,AE),me(AE,AE),it(iV,this.rotationFrameUp,this.vLeft),Math.sign(fe(iV,this.vRight))*(Math.PI-_o(fe(_1,AE)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)<=0)return r;const n=IZ(Math.cos(.5*i));return yr(e,(n-1+1)*r[0],r[1])}},qOt=class extends O8e{get rotationFrameUp(){const e=Math.sign(fe(this.frame.right,this.vRight));return it(TM,this.vRight,this.vLeft),oe(TM,TM,e),me(TM,TM)}get rotationRight(){const e=this.rotationFrameUp,r=fe(e,this.frame.up),i=fe(e,this.frame.right);return oe(PE,this.frame.up,-i),oe(Ove,this.frame.right,r),ge(PE,PE,Ove),me(PE,PE),WOt(Ave,this.frame,PE),Ave}get rotationAngle(){const e=Math.sign(fe(this.frame.right,this.vRight));return ua(iV,this.vLeft),-e*(Math.PI-_o(fe(iV,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*IZ(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)===0)return r;const n=IZ(Math.cos(.5*i)),s=this.rotationRight,o=E8e(XOt,1+(n-1)*s[0]*s[0],(n-1)*s[0]*s[1],(n-1)*s[0]*s[1],1+(n-1)*s[1]*s[1]);return fOe(e,r,o)}};function WOt(t,e,r){yr(t,fe(r,e.right),fe(r,e.up))}function YOt(t){switch(t){case Kg.World:return new HOt;case Kg.Path:return new qOt}}const TM=C(),Ave=Ye(),PE=C(),Ove=C(),iV=C(),_1=C(),AE=C(),Mve=C(),EM=C(),UF=C(),XOt=A8e(),TW=8;function ZOt(t,e){const r=R.FEATUREVALUE;t.attributes.add(r,"vec4");const i=t.vertex;i.code.add(T`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new ci("size",n=>n.size)),e.vvSize?(i.uniforms.add(new zt("vvSizeMinSize",n=>n.vvSize.minSize),new zt("vvSizeMaxSize",n=>n.vvSize.maxSize),new zt("vvSizeOffset",n=>n.vvSize.offset),new zt("vvSizeFactor",n=>n.vvSize.factor)),i.code.add(T`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(T`vec2 getSize(){
return size;
}`),e.vvOpacity?(i.constants.add("vvOpacityNumber","int",TW),i.uniforms.add(new Oc("vvOpacityValues",n=>n.vvOpacity.values,TW),new Oc("vvOpacityOpacities",n=>n.vvOpacity.opacityValues,TW)),i.code.add(T`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(T`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(i.constants.add("vvColorNumber","int",cP),i.uniforms.add(new Oc("vvColorValues",n=>n.vvColor.values,cP),new z4e("vvColorColors",n=>n.vvColor.colors,cP)),i.code.add(T`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(T`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(RN),t.attributes.add(R.PROFILERIGHT,"vec4"),t.attributes.add(R.PROFILEUP,"vec4"),t.attributes.add(R.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(T`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(T`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(T`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(T`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let JOt=class extends DN{constructor(){super(...arguments),this.size=mr(1,1)}};function MD(t,e){e.spherical?t.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function M8e(t){const e=new Fr,{vertex:r,fragment:i}=e;switch(Uu(r,t),e.varyings.add("vpos","vec3"),e.include(ZOt,t),t.output!==G.Color&&t.output!==G.Alpha||(e.include($c,t),e.include(_A,t),e.include(nO,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.multipassEnabled&&e.varyings.add("depth","float"),r.code.add(T`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===G.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(Yu,t),t.output){case G.Alpha:e.include(Wn,t),i.uniforms.add(new Ie("opacity",n=>n.opacity)),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case G.Color:e.include(Wn,t),e.include(s2,t),e.include(UN,t),e.include(_A,t),e.include(v5e,t),mm(i,t),zN(i),uO(i),i.uniforms.add(r.uniforms.get("localOrigin"),new zt("ambient",n=>n.ambient),new zt("diffuse",n=>n.diffuse),new zt("specular",n=>n.specular),new Ie("opacity",n=>n.opacity)),i.include(Ty),by(i),i.code.add(T`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===vt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case G.LinearDepth:case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:e.include($c,t),r2(e),e.varyings.add("depth","float"),r.code.add(T`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(Wn,t),e.include(g_,t),i.code.add(T`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case G.Normal:e.include($c,t),e.include(MD,t),hA(r),e.varyings.add("vnormal","vec3"),r.code.add(T`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Wn,t),i.code.add(T`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case G.Highlight:e.include($c,t),e.include(MD,t),e.varyings.add("vnormal","vec3"),r.code.add(T`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Wn,t),e.include(gw,t),i.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const QOt=Object.freeze(Object.defineProperty({__proto__:null,build:M8e},Symbol.toStringTag,{value:"Module"})),R8e=new Map([[R.POSITION,0],[R.PROFILERIGHT,1],[R.PROFILEUP,2],[R.PROFILEVERTEXANDNORMAL,3],[R.FEATUREVALUE,4]]);let KOt=class extends JOt{constructor(){super(...arguments),this.ambient=Ce(.2,.2,.2),this.diffuse=Ce(.8,.8,.8),this.specular=Ce(0,0,0),this.opacity=1,this.origin=C(),this.modelTransformation=null}},$8e=class I8e extends Zr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Fe.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Br(e.rctx,I8e.shader.get().build(this.configuration),R8e)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===vt.NONE,n=e===vt.FrontFace;return Bt({blending:r.output!==G.Color&&r.output!==G.Alpha||!r.transparent?null:i?Bh:$_(e),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==En.None?jLe:null,depthTest:{func:yw(e)},depthWrite:i||n?Wu:null,colorWrite:rr,stencilWrite:r.hasOccludees?gy:null,stencilTest:r.hasOccludees?_w:null,polygonOffset:i||n?null:lG})}};$8e.shader=new Vr(QOt,()=>re(()=>Promise.resolve().then(()=>Njt),void 0));let Us=class extends Zl{constructor(){super(...arguments),this.output=G.Color,this.doubleSidedMode=En.None,this.transparencyPassType=vt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};d([H({count:G.COUNT})],Us.prototype,"output",void 0),d([H({count:En.COUNT})],Us.prototype,"doubleSidedMode",void 0),d([H({count:vt.COUNT})],Us.prototype,"transparencyPassType",void 0),d([H()],Us.prototype,"spherical",void 0),d([H()],Us.prototype,"receiveShadows",void 0),d([H()],Us.prototype,"receiveAmbientOcclusion",void 0),d([H()],Us.prototype,"vvSize",void 0),d([H()],Us.prototype,"vvColor",void 0),d([H()],Us.prototype,"vvOpacity",void 0),d([H()],Us.prototype,"hasSlicePlane",void 0),d([H()],Us.prototype,"transparent",void 0),d([H()],Us.prototype,"hasOccludees",void 0),d([H()],Us.prototype,"multipassEnabled",void 0),d([H()],Us.prototype,"cullAboveGround",void 0),d([H()],Us.prototype,"doublePrecisionRequiresObfuscation",void 0),d([H({constValue:!1})],Us.prototype,"occlusionPass",void 0),d([H({constValue:ht.Disabled})],Us.prototype,"pbrMode",void 0),d([H({constValue:!0})],Us.prototype,"hasVvInstancing",void 0),d([H({constValue:!1})],Us.prototype,"useCustomDTRExponentForWater",void 0),d([H({constValue:!1})],Us.prototype,"useFillLights",void 0),d([H({constValue:!1})],Us.prototype,"hasColorTexture",void 0);let eMt=class L8e extends mw{constructor(e){super(e,new rMt),this.supportsEdges=!0,this.produces=new Map([[de.OPAQUE_MATERIAL,r=>(this.parameters.castShadows&&tP(r)||$I(r))&&!this.parameters.transparent],[de.TRANSPARENT_MATERIAL,r=>(this.parameters.castShadows&&tP(r)||$I(r))&&this.parameters.transparent]]),this._vertexAttributeLocations=R8e,this._configuration=new Us,this._vertexBufferLayout=L8e.getVertexBufferLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==G.Color&&e!==G.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?En.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?En.WindingOrder:En.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=r.ssao!=null),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==G.Shadow&&e!==G.ShadowExcludeHighlight&&e!==G.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,r,i,n,s,o){const a=e;if(!b8e(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:v,factor:b,minSize:w,maxSize:x}=this.parameters.vvSize,S=l.sizeAttributeValue;c[0]*=we(v[0]+S*b[0],w[0],x[0]),c[1]*=we(v[2]+S*b[2],w[2],x[2])}const u=Math.max(c[0],c[1]),h=e.boundingInfo;if(h==null)return void this._intersectTriangles(l,c,n,s,o);const p=JT(h.bbMin[0]-u,h.bbMin[1]-u,h.bbMin[2]-u,h.bbMax[0]+u,h.bbMax[1]+u,h.bbMax[2]+u),f=[s[0]-n[0],s[1]-n[1],s[2]-n[2]],g=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]),y=[g/f[0],g/f[1],g/f[2]];Xae(p,n,y,i.tolerance)&&this._intersectTriangles(l,c,n,s,o)}_intersectTriangles(e,r,i,n,s){e.baked.size&&e.baked.size[0]===r[0]&&e.baked.size[1]===r[1]||e.baked.bake(r),e.baked.intersect(i,n,s)}createBufferWriter(){return new cO(this._vertexBufferLayout)}createGLMaterial(e){return new tMt(e)}static getVertexBufferLayout(){return ln().vec3f(R.POSITION).vec4f(R.PROFILERIGHT).vec4f(R.PROFILEUP).vec4f(R.PROFILEVERTEXANDNORMAL).vec4f(R.FEATUREVALUE)}},tMt=class extends fw{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==G.Color&&this._output!==G.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique($8e,e)}},rMt=class extends KOt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const iMt=["polyline"];let nMt=class extends Cy{constructor(e,r,i,n){super(e,r,i,n),this._intrinsicSize=mr(1,1),this._upVectorAlignment=Kg.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){var p,f,g,y,v;const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,r=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new IN({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,r],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=((f=(p=this._context.renderer)==null?void 0:p.visualVariables)==null?void 0:f.length)>0?fA(this._context.renderer,this._vvConvertOptions):null;const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?Kg.World:Kg.Path;const n=this.symbolLayer.profile||"circle";switch(n){default:case"circle":this._profile=bOt[i];break;case"quad":this._profile=wOt[i]}switch(this.symbolLayer.join){case"round":this._extruder=new wW(0,c5e);break;case"bevel":this._extruder=new wW(0,1);break;case"miter":this._extruder=new wW(.8*Math.PI,1);break;default:this._extruder=new aOt}const s=this.symbolLayer.cap||"butt";switch(s){case"none":this._startCap=new Sve,this._endCap=new Sve;break;case"butt":default:this._startCap=new kF(this._profile,0),this._endCap=new kF(this._profile,0,!0);break;case"square":this._startCap=new kF(this._profile,-.5),this._endCap=new kF(this._profile,.5,!0);break;case"round":{const b=n==="quad";this._startCap=new Tve({profile:this._profile,flip:!1,breakNormals:b,subdivisions:Bee}),this._endCap=new Tve({profile:this._profile,flip:!0,breakNormals:b,subdivisions:Bee});break}}const o=(y=(g=this.symbolLayer)==null?void 0:g.material)==null?void 0:y.color,a=this._getCombinedOpacityAndColor(o),l=Ka(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,h={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||s==="none"?$i.None:$i.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(yr(this._intrinsicSize,e,r),!Vee(this._intrinsicSize[0])||!Vee(this._intrinsicSize[1])))throw new B("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if((v=this._fastUpdates)!=null&&v.visualVariables.size||Eu(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const b={...h,...this._fastUpdates.materialParameters,size:vAe(this._intrinsicSize)};this._materials[0]=new eMt(b)}else h.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,h.normalType=Ur.Compressed,this._materials[0]=new gm(h);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,iMt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r),n=e.renderingInfo;return this._createAs3DShape(r,n,i,r.uid)}layerOpacityChanged(){var n,s,o;const e=(s=(n=this.symbolLayer)==null?void 0:n.material)==null?void 0:s.color,r=this._getCombinedOpacity(e),i=r<1||this.needsDrivenTransparentPass;(o=this._materials[0])==null||o.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,Wb)}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){var e;return(e=this._materials[0])==null||e.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,r){var i;for(const n in e.diff){if(n!=="visualVariables"||!mA(this._fastUpdates,r,this._vvConvertOptions))return ls.RecreateSymbol;(i=this._materials[0])==null||i.setParameters(this._fastUpdates.materialParameters)}return ls.FastUpdate}_getVertexData(e){let r=0;const i=e.paths,n=[],s=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const h of i)r+=h.length;const l=Go(3*r);let c,u=0;for(const h of i){n.push({offset:u,numVertices:h.length});for(const p of h)l[u++]=p[0],l[u++]=p[1],l[u++]=e.hasZ?p[2]:0}return o==null||s.equals(o)||an(l,s,0,l,o,0,r)?(o==null||o.equals(a)?c=gAe(l):(c=Go(3*r),an(l,o,0,c,a,0,r)),{pathVertexDataInfos:n,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,r,i,n){var g,y,v;this.usedMemory=0;const s=e.geometry,o=this._getVertexData(s);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return s.paths.length!==0&&s.paths.some(b=>b.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=s.spatialReference,c=Ds(),u=this._context.renderCoordsHelper,h=new $oe(o.vertexDataES);for(const b of o.pathVertexDataInfos){const w=b.numVertices;if(w<2)continue;const x=b.offset;if(this._context.clippingExtent!=null&&(zi(c),Ru(c,o.vertexDataES,x,w),!Uf(c,this._context.clippingExtent)))continue;const S=new Array,E=x+3*w;for(let V=x;V<E;V+=3){h.offset=V;const J=yvt(h,this._context.elevationProvider,i,u);se(Gn,o.vertexDataRS[V],o.vertexDataRS[V+1],o.vertexDataRS[V+2]),u.setAltitude(Gn,J),o.vertexDataRS[V]=Gn[0],o.vertexDataRS[V+1]=Gn[1],o.vertexDataRS[V+2]=Gn[2],S.push(YOt(this._upVectorAlignment))}const P=new nOt(S,o.vertexDataES,o.vertexDataRS,x);D8e(P,this._upVectorAlignment,this._context.renderCoordsHelper);const M=new sOt(P,this._profile,this._extruder,this._startCap,this._endCap);let L=null;if(this._fastUpdates){const V=this._fastUpdates.visualVariables,J=tm((g=V.size)==null?void 0:g.field,e)??0,Y=tm((y=V.color)==null?void 0:y.field,e)??0,X=tm((v=V.opacity)==null?void 0:v.field,e)??0;L=new hOt(M,J,Y,X)}else{const V=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const X=r.size;V[0]*=Rve(X[0],X[2]==="symbol-value"?this.symbolLayer.height||0:X[2],this.symbolLayer.width||0),V[1]*=Rve(X[2],X[0]==="symbol-value"?this.symbolLayer.width||0:X[0],this.symbolLayer.height||0)}let J;this._drivenProperties.color&&(J=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(J=J?[J[0],J[1],J[2],r.opacity]:[1,1,1,r.opacity]);const Y=new x8e(M);Y.bake(V),J&&Y.bakeVertexColors(J),L=Y}const U=L.createGeometryData(),z=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),W=new uOt(this._materials[0],U,L,l,this._stencilWidth,z);W.transformation=Fc(xe(),fn,M.path.origin),a.push(W),this.usedMemory+=M.usedMemory}if(a.length===0)return null;const p=new I_({geometries:a,layerUid:this._context.layer.uid,graphicUid:n}),f=new Ey(this,p,a,null,null,(b,w,x,S,E)=>oMt(b,w,S,E,this._upVectorAlignment),i);return f.alignedSampledElevation=0,f.needsElevationUpdates=Wb(i.mode),f}};function D8e(t,e,r){const{origin:i,positions:n}=t;let s=t.offset;switch(e){default:case Kg.World:for(const o of t.vertices)Gn[0]=n[s++]+i[0],Gn[1]=n[s++]+i[1],Gn[2]=n[s++]+i[2],r.worldUpAtPosition(Gn,Gn),o.setFrameFromUpVector(Gn);break;case Kg.Path:Gn[0]=n[s]+i[0],Gn[1]=n[s+1]+i[1],Gn[2]=n[s+2]+i[2],r.worldUpAtPosition(Gn,Gn),_Ot(t,Gn)}}function Rve(t,e,r){switch(t){case"symbol-value":return r;case"proportional":return e;default:return t}}function sMt(t,e,r,i){let n=0;const{origin:s,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let u=t.offset;u<c;u+=3)se(Gn,l[u],l[u+1],l[u+2]),r(Gn,EW),n+=EW.sampledElevation,Gn[0]=a[u]+s[0],Gn[1]=a[u+1]+s[1],Gn[2]=a[u+2]+s[2],i.setAltitude(Gn,EW.z),a[u]=Gn[0]-s[0],a[u+1]=Gn[1]-s[1],a[u+2]=Gn[2]-s[2];return t.updatePathVertexInformation(),n/o.length}function oMt(t,e,r,i,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!b8e(l))continue;const c=l.path,u=c.builder.path;a+=sMt(u,e,r,i),n!==Kg.World&&D8e(u,n,i),c.onPathChanged(l),l.invalidateBoundingInfo(),s.geometryVertexAttributeUpdated(l,R.POSITION)}return a/o.length}const Gn=C(),EW=new FN;function aMt(t,e,r,i,n=1){if(r.isGeographic&&i===Fe.Global){const c=Go(e.length),u=e.length,h=zr(r);for(let p=0;p<u;p+=3)Ose(e,p,c,p,h);e=c}yr(Ws,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)Ws[0]=Math.min(Ws[0],e[c]),Ws[1]=Math.min(Ws[1],e[c+1]);const s=Ws[0]%n,o=Ws[1]%n,a=Ws[0]-s,l=Ws[1]-o;for(let c=0;c<e.length;c+=3){const u=c/3*4;t[u]=(e[c]-a)/n,t[u+1]=(e[c+1]-l)/n,t[u+2]=a/n,t[u+3]=l/n}}function N8e(t,e,r,i,n=1){se(Kw,1,0,0),se(ex,0,1,0),se(ME,0,0,1),cMt(CW,r),MKe($ve,r)&&lMt($ve,Kw,ex,ME,i,CW),yr(Ws,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),yr(tx,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<r.length;u+=3){se(OE,r[u],r[u+1],r[u+2]);const h=fe(Kw,OE),p=fe(ex,OE);Ws[0]=Math.min(Ws[0],h),Ws[1]=Math.min(Ws[1],p),tx[0]=Math.max(tx[0],h),tx[1]=Math.max(tx[1],p)}const s=fe(ME,CW);AW(v1,Ws[0],Ws[1],s,Kw,ex,ME),AW(rx,tx[0],Ws[1],s,Kw,ex,ME),AW(ix,Ws[0],tx[1],s,Kw,ex,ME),_e(rx,rx,v1),oe(rx,rx,.5),_e(ix,ix,v1),oe(ix,ix,.5),ge(v1,v1,rx),ge(v1,v1,ix);const o=Ws[0]%n,a=Ws[1]%n,l=Ws[0]-o,c=Ws[1]-a;for(let u=0;u<r.length;u+=3){se(OE,r[u],r[u+1],r[u+2]);const h=u/3,p=4*h;t[p]=(fe(Kw,OE)-l)/n,t[p+1]=(fe(ex,OE)-c)/n,t[p+2]=l/n,t[p+3]=c/n;const f=9*h;for(let g=0;g<3;g++)e[f+g]=v1[g],e[f+g+3]=rx[g],e[f+g+6]=ix[g]}}const CW=C(),OE=C(),$ve=Yr(),Kw=C(),ex=C(),ME=C(),Ws=Ye(),tx=Ye(),v1=C(),rx=C(),ix=C();function lMt(t,e,r,i,n,s){n!=null?(n.basisMatrixAtPosition(s,jm),se(zF,jm[0],jm[1],jm[2]),se(VF,jm[4],jm[5],jm[6]),se(PW,jm[8],jm[9],jm[10])):(se(zF,1,0,0),se(VF,0,1,0),se(PW,0,0,1));const o=t;fe(o,PW)<0&&oe(o,o,-1),he(i,o);const a=fe(o,VF),l=fe(o,zF);Math.abs(a)>Math.abs(l)?(ho(e,zF,o,-l),me(e,e),it(r,e,o),me(r,r),oe(r,r,-1)):(ho(r,VF,o,-a),me(r,r),it(e,r,o),me(e,e))}const jm=xe(),zF=C(),VF=C(),PW=C();function cMt(t,e){se(CM,0,0,0);for(let r=0;r<e.length-3;r+=3)CM[0]+=e[r],CM[1]+=e[r+1],CM[2]+=e[r+2];oe(t,CM,1/(e.length/3-1))}const CM=C();function AW(t,e,r,i,n,s,o){se(t,e*n[0]+r*s[0]+i*o[0],e*n[1]+r*s[1]+i*o[1],e*n[2]+r*s[2]+i*o[2])}let ace=class extends mw{intersect(e,r,i,n,s,o){return b4e(e,i,n,s,void 0,o)}};function F8e(t){const e=new Fr,{vertex:r,fragment:i,attributes:n,varyings:s}=e;Uu(r,t),e.include($c,t),e.include(L2,t),e.include(X0,t),e.include(aO,t),n.add(R.POSITION,"vec3"),t.vvColor&&n.add(R.COLORFEATUREATTRIBUTE,"float"),s.add("vColor","vec4"),s.add("vpos","vec3");const o=t.multipassEnabled&&(t.output===G.Color||t.output===G.Alpha);o&&s.add("depth","float"),r.uniforms.add(new Or("eColor",c=>c.color));const a=t.output===G.LinearDepth;a&&(e.include(g_,t),r2(e),Bb(e)),r.code.add(T`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?T`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:T`transformPosition(proj, view, vpos);`}
    }
  `),e.include(Wn,t),o&&e.include(Yu,t),i.include(Ty);const l=t.output===G.Highlight;return l&&e.include(gw,t),i.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${t.output===G.ObjectAndLayerIdColor?T`fColor.a = 1.0;`:""}

    if (fColor.a < ${T.float(sa)}) {
      discard;
    }

    ${t.output===G.Alpha?T`fragColor = vec4(fColor.a);`:""}

    ${t.output===G.Color?T`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===vt.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?T`outputHighlight();`:""};
    ${t.output===G.LinearDepth?T`outputDepth(linearDepth);`:""};
    ${t.output===G.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const uMt=Object.freeze(Object.defineProperty({__proto__:null,build:F8e},Symbol.toStringTag,{value:"Module"}));let k8e=class U8e extends Zr{initializeProgram(e){return new Br(e.rctx,U8e.shader.get().build(this.configuration),Nr)}_createPipeline(e,r){const i=this.configuration,n=e===vt.NONE,s=e===vt.FrontFace;return Bt({blending:i.output!==G.Color&&i.output!==G.Alpha||!i.transparent?null:n?Bh:$_(e),culling:j7(i.cullFace),depthTest:i.draped?null:{func:yw(e)},depthWrite:i.draped?null:(n||s)&&i.writeDepth?Wu:null,colorWrite:rr,stencilWrite:i.hasOccludees?gy:null,stencilTest:i.hasOccludees?r?Yb:_w:null,polygonOffset:n||s?i.polygonOffset?hMt:null:cG(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};k8e.shader=new Vr(uMt,()=>re(()=>Promise.resolve().then(()=>Fjt),void 0));const hMt={factor:1,units:1};let Ao=class extends Zl{constructor(){super(...arguments),this.output=G.Color,this.cullFace=$i.None,this.transparencyPassType=vt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1}};d([H({count:G.COUNT})],Ao.prototype,"output",void 0),d([H({count:$i.COUNT})],Ao.prototype,"cullFace",void 0),d([H({count:vt.COUNT})],Ao.prototype,"transparencyPassType",void 0),d([H()],Ao.prototype,"hasSlicePlane",void 0),d([H()],Ao.prototype,"hasVertexColors",void 0),d([H()],Ao.prototype,"transparent",void 0),d([H()],Ao.prototype,"polygonOffset",void 0),d([H()],Ao.prototype,"enableOffset",void 0),d([H()],Ao.prototype,"writeDepth",void 0),d([H()],Ao.prototype,"hasOccludees",void 0),d([H()],Ao.prototype,"multipassEnabled",void 0),d([H()],Ao.prototype,"cullAboveGround",void 0),d([H()],Ao.prototype,"objectAndLayerIdColorInstanced",void 0),d([H()],Ao.prototype,"vvColor",void 0),d([H()],Ao.prototype,"draped",void 0),d([H({constValue:!1})],Ao.prototype,"occlusionPass",void 0),d([H({constValue:!0})],Ao.prototype,"hasVvInstancing",void 0),d([H({constValue:!1})],Ao.prototype,"vvSize",void 0),d([H({constValue:!1})],Ao.prototype,"vvOpacity",void 0);let Ive=class extends ace{constructor(e){super(e,new pMt),this.supportsEdges=!0,this.produces=new Map([[de.OPAQUE_MATERIAL,r=>r===G.Highlight||LH(r)&&!this._isTransparent],[de.OPAQUE_NO_SSAO_DEPTH,r=>r===G.LinearDepth&&this.parameters.writeLinearDepth&&!this._isTransparent],[de.TRANSPARENT_MATERIAL,r=>LH(r)&&this._isTransparent&&this.parameters.writeDepth],[de.TRANSPARENT_NO_SSAO_DEPTH,r=>r===G.LinearDepth&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[de.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,r=>(LH(r)||r===G.LinearDepth&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[de.DRAPED_MATERIAL,r=>BDe(r)]]),this._configuration=new Ao}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<aG,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}createGLMaterial(e){return new dMt(e)}createBufferWriter(){const e=ln().vec3f(R.POSITION);return ne("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4u8(R.COLOR),new cO(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}},dMt=class extends fw{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==G.Color&&this._output!==G.Alpha||this._updateOccludeeState(e),this.ensureTechnique(k8e,e)}},pMt=class extends DN{constructor(){super(...arguments),this.color=Fh,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=$i.None,this.hasOccludees=!1,this.draped=!1}};var na;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(na||(na={}));const wte=.70710678118,Lve=wte,fMt=.08715574274;function z8e(t){const e=new Fr,r=t.multipassEnabled&&(t.output===G.Color||t.output===G.Alpha),{vertex:i,fragment:n,attributes:s,varyings:o}=e;Uu(i,t),e.include($c,t),e.include(L2,t),e.include(X0,t),e.include(aO,t),t.draped?i.uniforms.add(new Ie("worldToScreenRatio",(c,u)=>1/u.screenToPCSRatio)):s.add(R.BOUNDINGRECT,"mat3"),s.add(R.POSITION,"vec3"),s.add(R.UVMAPSPACE,"vec4"),t.vvColor&&s.add(R.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),r&&o.add("depth","float"),i.uniforms.add(new Or("uColor",c=>c.color));const a=t.style===na.ForwardDiagonal||t.style===na.BackwardDiagonal||t.style===na.DiagonalCross;a&&i.code.add(T`
      const mat2 rotate45 = mat2(${T.float(wte)}, ${T.float(-Lve)},
                                 ${T.float(Lve)}, ${T.float(wte)});
    `),t.draped||(mm(i,t),i.uniforms.add(new Ie("worldToScreenPerDistanceRatio",(c,u)=>1/u.camera.perScreenPixelRatio)),i.code.add(T`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(T`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(T`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${T.float(fMt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(T`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":T`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${T.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const l=t.output===G.LinearDepth;return l&&(e.include(g_,t),r2(e),Bb(e)),i.code.add(T`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${l?T`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:T`transformPosition(proj, view, vpos);`}
    }
  `),e.include(Wn,t),n.include(Ty),t.draped&&n.uniforms.add(new Ie("texelSize",(c,u)=>1/u.camera.pixelRatio)),t.output===G.Highlight&&e.include(gw,t),r&&e.include(Yu,t),t.output!==G.Highlight&&(n.code.add(T`
      const float lineWidth = ${T.float(t.lineWidth)};
      const float spacing = ${T.float(t.patternSpacing)};
      const float spacingINV = ${T.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||n.code.add(T`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.code.add(T`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==G.Highlight?T`color.a *= ${mMt(t)};`:""}

      ${t.output===G.ObjectAndLayerIdColor?T`color.a = 1.0;`:""}

      if (color.a < ${T.float(sa)}) {
        discard;
      }

      ${t.output===G.Alpha?T`fragColor = vec4(color.a);`:""}

      ${t.output===G.Color?T`fragColor = color; ${t.transparencyPassType===vt.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===G.Highlight?T`outputHighlight();`:""}
      ${t.output===G.LinearDepth?T`outputDepth(linearDepth);`:""};
      ${t.output===G.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
    }
  `),e}function mMt(t){function e(r){return t.draped?T`coverage(vuv.${r}, texelSize)`:T`sampleAA(vuv.${r})`}switch(t.style){case na.ForwardDiagonal:case na.Horizontal:return e("y");case na.BackwardDiagonal:case na.Vertical:return e("x");case na.DiagonalCross:case na.Cross:return T`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const gMt=Object.freeze(Object.defineProperty({__proto__:null,build:z8e},Symbol.toStringTag,{value:"Module"}));let V8e=class B8e extends Zr{initializeProgram(e){return new Br(e.rctx,B8e.shader.get().build(this.configuration),ne("enable-feature:objectAndLayerId-rendering")?j8e:G8e)}_setPipelineState(e,r){const i=this.configuration,n=e===vt.NONE,s=e===vt.FrontFace;return Bt({blending:i.output===G.Color||i.output===G.Alpha?n?Bh:$_(e):null,culling:j7(i.cullFace),depthTest:i.draped?null:{func:yw(e)},depthWrite:i.draped?null:n?Wu:oG(e),colorWrite:rr,stencilWrite:i.hasOccludees?gy:null,stencilTest:i.hasOccludees?r?Yb:_w:null,polygonOffset:n||s?i.polygonOffset?yMt:null:cG(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};V8e.shader=new Vr(gMt,()=>re(()=>Promise.resolve().then(()=>kjt),void 0));const yMt={factor:1,units:1};let io=class extends Zl{constructor(){super(...arguments),this.output=G.Color,this.cullFace=$i.None,this.transparencyPassType=vt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasOccludees=!1,this.enableOffset=!0,this.multipassEnabled=!1,this.cullAboveGround=!1,this.vvColor=!1,this.objectAndLayerIdColorInstanced=!1}};d([H({count:G.COUNT})],io.prototype,"output",void 0),d([H({count:$i.COUNT})],io.prototype,"cullFace",void 0),d([H({count:na.COUNT})],io.prototype,"style",void 0),d([H({count:vt.COUNT})],io.prototype,"transparencyPassType",void 0),d([H()],io.prototype,"hasSlicePlane",void 0),d([H()],io.prototype,"hasVertexColors",void 0),d([H()],io.prototype,"polygonOffset",void 0),d([H()],io.prototype,"hasOccludees",void 0),d([H()],io.prototype,"patternSpacing",void 0),d([H()],io.prototype,"lineWidth",void 0),d([H()],io.prototype,"enableOffset",void 0),d([H()],io.prototype,"draped",void 0),d([H()],io.prototype,"multipassEnabled",void 0),d([H()],io.prototype,"cullAboveGround",void 0),d([H()],io.prototype,"vvColor",void 0),d([H({constValue:!0})],io.prototype,"writeDepth",void 0),d([H({constValue:!1})],io.prototype,"occlusionPass",void 0),d([H({constValue:!1})],io.prototype,"hasVvInstancing",void 0),d([H({constValue:!1})],io.prototype,"vvSize",void 0),d([H({constValue:!1})],io.prototype,"vvOpacity",void 0);const G8e=new Map([[R.POSITION,0],[R.COLOR,3],[R.UVMAPSPACE,4],[R.COLORFEATUREATTRIBUTE,5],[R.BOUNDINGRECT,6]]),j8e=new Map([[R.POSITION,0],[R.COLOR,3],[R.UVMAPSPACE,4],[R.COLORFEATUREATTRIBUTE,5],[R.BOUNDINGRECT,6],[R.OBJECTANDLAYERIDCOLOR,9]]);let lce=class extends ace{constructor(e){super(e,new bMt),this.supportsEdges=!0,this.produces=new Map([[de.OPAQUE_MATERIAL,r=>bT(r)],[de.TRANSPARENT_MATERIAL,r=>W0(r)],[de.TRANSPARENT_NO_SSAO_DEPTH,r=>r===G.LinearDepth&&this.parameters.writeLinearDepth],[de.DRAPED_MATERIAL,r=>this.parameters.draped&&r===G.Color||bT(r)]]),this._vertexAttributeLocations=ne("enable-feature:objectAndLayerId-rendering")?j8e:G8e,this._configuration=new io}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<aG,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}createGLMaterial(e){return new _Mt(e)}createBufferWriter(){const e=ln().vec3f(R.POSITION).vec4f(R.UVMAPSPACE);return this.parameters.draped||e.mat3f(R.BOUNDINGRECT),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4u8(R.COLOR),ne("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),new vMt(e)}},_Mt=class extends fw{_updateParameters(e){return this.ensureTechnique(V8e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==G.Color&&this._output!==G.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},vMt=class extends cO{write(e,r,i,n,s){$4e(i,this.vertexBufferLayout,e,r,n,s);for(const o of this.vertexBufferLayout.fields.keys()){const a=i.attributes.get(o),l=a==null?void 0:a.indices;if(a&&l)switch(o){case R.UVMAPSPACE:{_t(a.size===4);const c=n.getField(o,hm);c&&gA(a,c,s);break}case R.BOUNDINGRECT:{_t(a.size===9);const c=n.getField(o,Ib);c&&this.writeBoundingRect(a,e,c,s);break}}}}writeBoundingRect(e,r,i,n){const{data:s,indices:o}=e,a=r,l=i.typedBuffer,c=i.typedBufferStride,u=o.length;n*=c;for(let h=0;h<u;++h){const p=9*o[h],f=s[p],g=s[p+1],y=s[p+2];l[n]=a[0]*f+a[4]*g+a[8]*y+a[12],l[n+1]=a[1]*f+a[5]*g+a[9]*y+a[13],l[n+2]=a[2]*f+a[6]*g+a[10]*y+a[14];for(let v=3;v<9;++v)l[n+v]=s[p+v];n+=c}}},bMt=class extends DN{constructor(){super(...arguments),this.color=Xt(1,1,1,1),this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=$i.None,this.hasOccludees=!1,this.style=na.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function wMt(t,e){const r=(t==null?void 0:t.pattern)??null;return r==null?new Ive(e):r.style==="none"||r.style==="solid"?(r.style==="none"&&(e.color=Xt(0,0,0,0),e.forceTransparentMode=!0),new Ive(e)):(e.style=xMt(r.style),new lce(e))}function xMt(t){switch(t){case"horizontal":return na.Horizontal;case"vertical":return na.Vertical;case"cross":return na.Cross;case"forward-diagonal":return na.ForwardDiagonal;case"backward-diagonal":return na.BackwardDiagonal;case"diagonal-cross":return na.DiagonalCross;default:return}}function SMt(t){return t.material instanceof lce&&!t.material.parameters.draped}function TMt(t,e){if(SMt(t)){const r=t.attributes.get(R.POSITION).data,i=t.getMutableAttribute(R.UVMAPSPACE).data,n=t.getMutableAttribute(R.BOUNDINGRECT).data;N8e(i,n,r,e)}}function EMt(t,e,r,i,n){const s=e5e(t,e,r,i,n),o=t.stageObject.geometries;for(const a of o)TMt(a,n);return s}const CMt=["polyline","polygon","extent"],Dve=new IN({size:!1,color:!0,rotation:!1,opacity:!1});let H8e=class q8e extends Cy{constructor(e,r,i,n){super(e,r,i,n),this._needsUV=!1}async doLoad(){this._fastUpdates=fA(this._context.renderer,Dve)}_createMaterials(){var n,s,o;if(this._materials.length>0)return;const e=(s=(n=this.symbolLayer)==null?void 0:n.material)==null?void 0:s.color,r=this._getCombinedOpacityAndColor(e);this._materials[Vn.Fill]=wMt(this.symbolLayer,{color:r,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...(o=this._fastUpdates)==null?void 0:o.materialParameters}),this._needsUV=this._materials[Vn.Fill]instanceof lce;const i=this.symbolLayer.outline;if(this._isValidOutline(i)){const a=W6e(i.pattern);this._materials[Vn.Outline]=new f3({width:bs(i.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:a,cap:yte(i.patternCap||"butt")})}this._context.stage.addMany(this._materials)}_isValidOutline(e){return(e==null?void 0:e.size)!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,CMt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(n.mode==="on-the-ground"),this._createMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,n)}applyRendererDiff(e,r){var i;for(const n in e.diff){if(n!=="visualVariables"||!mA(this._fastUpdates,r,Dve))return ls.RecreateSymbol;(i=this._materials[Vn.Fill])==null||i.setParameters(this._fastUpdates.materialParameters)}return ls.FastUpdate}layerOpacityChanged(){var e,r;if(this._materials[Vn.Fill]!=null){const i=this._materials[Vn.Fill].parameters.color,n=(r=(e=this.symbolLayer)==null?void 0:e.material)==null?void 0:r.color,s=this._getCombinedOpacity(n);this._materials[Vn.Fill].setParameters({color:[i[0],i[1],i[2],s],forceTransparentMode:this.needsDrivenTransparentPass})}if(this._materials[Vn.Outline]!=null){const i=this._materials[Vn.Outline].parameters.color;this._materials[Vn.Outline].setParameters({color:[i[0],i[1],i[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=NN(q8e.elevationModeChangeTypes,i,n);if(s!==Dn.UPDATE)return s;const o=mp(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){var e;if((e=this._materials[Vn.Fill])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Vn.Outline]){const r={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[Vn.Outline].setParameters(r)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var u;const n=XL(e.geometry);if(!n)return null;const s=zle(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new PMt(s,r,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Tn(4*a,!0),o.boundingRect=Go(9*a,!0),N8e(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(u=this._context.stage.renderView)==null?void 0:u.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._materials[Vn.Outline]&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,n.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new I_({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new Ey(this,l,o.outGeometries,null,null,EMt,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=mp(i.mode),c}_createAs3DShapeFill(e,r){var n;const i=r.renderData.polygons;for(const{position:s,mapPositions:o,holeIndices:a,index:l,count:c}of i){if(this._context.clippingExtent!=null&&(zi(Np),Ru(Np,o),!Uf(Np,this._context.clippingExtent)))continue;const u=net(o,a,this._context.elevationProvider.spatialReference);if(u.length===0)continue;const h=(n=this._fastUpdates)==null?void 0:n.visualVariables.color,p=$pe({material:this._materials[Vn.Fill],indices:u,mapPositions:o,attributeData:{position:s,color:h?null:r.color,colorFeature:h?tm(h.field,e):null,uvMapSpace:this._needsUV?y9(r.uvMapSpace,4*l,4*c):null,boundingRect:this._needsUV?Qd(r.boundingRect,9*l,9*c):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(p)}}_createAs3DShapeOutline(e){if(this._materials[Vn.Outline]==null)return;const r=e.renderData.outlines;for(const{mapPositions:i,position:n}of r){if(this._context.clippingExtent!=null&&(zi(Np),Ru(Np,i),!Uf(Np,this._context.clippingExtent)))continue;const s=_te(this._materials[Vn.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:i,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(s)}}_createAsOverlay(e,r){var a;const i=XL(e.geometry);if(i==null)return null;this._materials[Vn.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,this._materials[Vn.Outline]!=null&&(this._materials[Vn.Outline].renderPriority=this._renderPriority);const n=Oke(i,this._context.overlaySR),s=new AMt(n,r,this._context.layer.uid,e.uid),o=s.renderData.position.length/3;return this._needsUV&&(s.uvMapSpace=Tn(4*o,!0),aMt(s.uvMapSpace,s.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),s.outBoundingBox=zi(),s.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(s),this._createAsOverlayFill(e,s),this._materials[Vn.Outline]&&this._createAsOverlayOutline(s),this._logGeometryCreationWarnings(s.renderData,i.rings,"rings","FillSymbol3DLayer"),s.outGeometries.length===0?null:new EG(this,s.outGeometries,s.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,r){var n;const i=r.renderData.polygons;for(const{position:s,holeIndices:o,index:a,count:l}of i){const c=zi(Np);if(Ru(c,s),!Uf(c,this._context.clippingExtent))continue;const u=qP(s,o,3);if(u.length===0)continue;YP(r.outBoundingBox,c);const h=(n=this._fastUpdates)==null?void 0:n.visualVariables.color,p=$pe({material:this._materials[Vn.Fill],indices:u,attributeData:{position:s,color:h?null:r.color,colorFeature:h?tm(h.field,e):null,uvMapSpace:this._needsUV?y9(r.uvMapSpace,4*a,4*l):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(new wA(p,r))}}_createAsOverlayOutline(e){if(this._materials[Vn.Outline]==null)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{position:n}=r[i];if(zi(Np),Ru(Np,n),!Uf(Np,this._context.clippingExtent))continue;YP(e.outBoundingBox,Np);const s=_te(this._materials[Vn.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(new wA(s,e))}}_getOutlineOpacity(){var r,i;const e=(i=(r=this.symbolLayer)==null?void 0:r.outline)==null?void 0:i.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){var i,n;const e=(n=(i=this.symbolLayer)==null?void 0:i.outline)==null?void 0:n.color,r=this._getOutlineOpacity();return UI(e!=null?De.toUnitRGB(e):null,r)}test(){return{...super.test(),createAsOverlay:(e,r)=>this._createAsOverlay(e,r),createAs3DShape:(e,r,i)=>this._createAs3DShape(e,r,i)}}};H8e.elevationModeChangeTypes={definedChanged:Dn.RECREATE,staysOnTheGround:Dn.NONE,onTheGroundChanged:Dn.RECREATE};const Np=Ds();let PMt=class extends jB{constructor(e,r,i,n){super(e,i,n),this.color=r}},AMt=class extends jB{constructor(e,r,i,n){super(e,i,n),this.color=r}};var Vn;(function(t){t[t.Fill=0]="Fill",t[t.Outline=1]="Outline"})(Vn||(Vn={}));let W8e=class{constructor(e,r="center",i=!1,n=Ye(),s=Xt(0,0,0,-1),o="world",a=C(),l=0){this.verticalOffset=e,this.anchor=r,this.hasLabelVerticalOffset=i,this.screenOffset=n,this.centerOffset=s,this.centerOffsetUnits=o,this.translation=a,this.elevationOffset=l}},Y8e=class{constructor(e,r="center",i="center",n=null,s=Ye()){this.placement=e,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=n,this.displaySize=s}},X8e=class Z8e{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const r=this.definition.font;return`${r.style} ${r.weight} ${e}px ${r.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(e,r){e.font=this.fontString(r),e.textAlign="left",e.textBaseline="alphabetic"}_colorToRGB(e){return`rgb(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()},${e[3]})`}static async fromSymbol(e,r){var p,f,g,y,v;const i=(p=e==null?void 0:e.material)==null?void 0:p.color,n=De.toUnitRGBA(i)??Fh,s=e.size!=null?bs(e.size):12,o=e.lineHeight,a=e.background!=null?De.toUnitRGBA(e.background.color):Fh,l={family:((f=e.font)==null?void 0:f.family)??"sans-serif",decoration:((g=e.font)==null?void 0:g.decoration)??"none",weight:((y=e.font)==null?void 0:y.weight)??"normal",style:((v=e.font)==null?void 0:v.style)??"normal"},c=e.halo,u=(c==null?void 0:c.color)!=null&&c.size>0?{size:bs(c.size),color:De.toUnitRGBA(c.color)}:{size:0,color:Fh},h=new Z8e({color:n,size:s,background:{color:a,padding:e.background!=null?[.65*s,.5*s]:[0,0],borderRadius:e.background!=null?s*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:r});if(e.font){let b=!1;const w=h.fontString(s);try{b=(await document.fonts.load(w)).some(x=>!c2t(x))}catch{K.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${w}'. Some text symbology may be rendered using the default browser font.`)}if(!b&&!OMt.has(e.font.family))try{await l2t(e.font)}catch{}}return h}};const OMt=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),b1=4096;let tT=class extends Pe{constructor(e){super(e),this.type=Ln.Texture,this.id=Dh(),this.events=new Xn,this._glTexture=null,this._atlas=new $Mt(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=wt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return QI=0,[b1-w1-QI,b1-w1-QI-Nve]}load(e){if(this._glTexture)return this._glTexture;const r=new ui;return r.wrapMode=nr.CLAMP_TO_EDGE,r.samplingMode=Kt.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.preMultiplyAlpha=!0,r.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new Mr(e,r,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(Ct.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=Pi(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=wt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.width.toString()),this._canvas.setAttribute("height",e.height.toString())}_resizeAtlas(e,r){var s,o;const{width:i,height:n}=this._atlas;i===e&&n===r||(this._atlas.width=e,this._atlas.height=r,(s=this._glTexture)==null||s.resize(e,r),(o=this._glTexture)==null||o.updateData(0,0,0,i,n,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(a=>{const l=this._stageObjects.get(a.textRenderer.key);l==null||l.forEach(c=>OW(c,a))}),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,r,i,n){const s=this._atlas;if(s.width<i||s.height<n)return!1;let o=s.cursors.get(n);if(!o){if(s.height<s.nextY+n)return!1;o=[new Fve(s.nextY)],s.cursors.set(n,o),s.nextY+=n}let a=o.find(l=>s.width>=l.x+i);if(a==null){if(s.height<s.nextY+n)return!1;a=new Fve(s.nextY),s.nextY+=n,o.push(a)}return e.setNewPosition(a),this._elements.set(r,e),this._elementsToRender.set(r,e),a.x+=i,!0}_ensureStageObjects(e){const r=this._stageObjects.get(e);if(r)return r;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,r){this._ensureStageObjects(e).add(r)}_removeStageObject(e,r){const i=this._stageObjects.get(e);i!=null&&i.delete(r)&&(r.geometries[0].setAttributeData(R.SIZE,[0,0]),r.geometryVertexAttributeUpdated(r.geometries[0],R.SIZE),this._elementsToRender.delete(e))}_processAddition(e){const r=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(r,e);const i=this._atlas,n=e.textRenderer.renderedWidth,s=e.textRenderer.renderedHeight,o=n+w1,a=s+w1+Nve;if(!this._addAtlasElement(e,r,o,a)){if(this._canRepack)this._reset();else if(i.width<o){const l=Math.min(vT(Math.max(o,1.5*i.width)),b1);this._resizeAtlas(l,i.height)}else{const l=i.nextY+a,c=Math.min(vT(Math.max(l,1.5*i.height)),b1);if(c>i.height)this._resizeAtlas(i.width,c);else if(i.width<b1){const u=Math.min(vT(1.5*i.width),b1);this._resizeAtlas(u,i.height)}}this._elements.set(r,e)}}_renderElement(e){const r=e.commitNewPosition(),i=e.textRenderer;this._ctx.clearRect(r[0]-w1,r[1]-w1,i.renderedWidth+2*w1,i.renderedHeight+2*w1),i.render(this._ctx,r[0],r[1]);const n=this._stageObjects.get(i.key);n==null||n.forEach(s=>OW(s,e))}get running(){return this.updating}runTask(e){if(this._glTexture==null)return pa;for(;this._needsRepack&&(this._canRepack||this._atlas.height<b1&&this._atlas.height<b1);){this._canRepack=this._needsRepack=!1;const r=this._elements;this._elements=new Map,r.forEach(i=>this._processAddition(i)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[r,i]of this._elementsToRender){if(e.done)break;this._renderElement(i),this._elementsToRender.delete(r),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addTextTexture(e,r){const i=e.key;this._addStageObject(i,r);let n=this._elements.get(i);n==null&&(n=new RMt(this._atlas,e),this._processAddition(n),this.setDirty()),MMt(r,n),OW(r,n)}removeTextTexture(e,r){const i=e.key;if(!this._elements.get(i))return;this._removeStageObject(i,r);const n=this._stageObjects.get(i);n&&n.size!==0||this._elements.delete(i),(n==null?void 0:n.size)===0&&this._stageObjects.delete(i),this._canRepack=!0}setDirty(){this._glTexture&&(this.updating=!0)}get test(){const{_elements:e,_stageObjects:r,_atlas:i}=this,n=this;return{elements:e,stageObjects:r,atlas:i,resizeAtlas:(s,o)=>n._resizeAtlas(s,o),run:s=>n.runTask(s)}}};function MMt(t,e){t.geometries[0].setAttributeData(R.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],R.SIZE)}function OW(t,e){t.geometries[0].setAttributeData(R.UV0,e.uv),t.geometryVertexAttributeUpdated(t.geometries[0],R.UV0,!0)}d([m({constructOnly:!0})],tT.prototype,"view",void 0),d([m({type:Boolean})],tT.prototype,"updating",void 0),tT=d([F("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],tT);const w1=2,Nve=2;let RMt=class{constructor(e,r){this._atlas=e,this.textRenderer=r,this._uv=tr(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return Fh;const{renderedWidth:e,renderedHeight:r}=this.textRenderer;return pn(this._uv,this._xOffset/this._atlas.width,(this._yOffset+r)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},$Mt=class{constructor(e,r){this.width=e,this.height=r,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=QI}},Fve=class{constructor(e){this.y=e,this.x=QI}},QI=0,IMt=class{constructor(e,r,i){this._renderer=new k6e(e,r,i,tT.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=Q9(LMt,this._renderer.renderedWidth,this._renderer.renderedHeight),r=e.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new Zb(e,{wrap:{s:nr.CLAMP_TO_EDGE,t:nr.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const LMt={canvas:null},DMt=Ce(0,0,1);let NMt=class extends Cy{constructor(e,r,i,n){super(e,r,i,n),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=dG(this.symbolLayer.size);if(e)throw new B("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await X8e.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const r=e.graphic,i=SD(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const n=this.symbolLayer.text;if(n==null||n==="")return null;const s=Joe(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(s!=null&&!WIe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:o}=this.symbolLayer,a=new W8e(s);S3t(o,a.screenOffset);const l=new Y8e(a,this.symbolLayer.horizontalAlignment,x3t(o));return this._createAs3DShape(r,i,n,l)}createLabel(e,r,i,n,s){const o=e.graphic,a=SD(o.geometry);if(a==null)return this.logger.warn(`unsupported geometry type for label: ${o.geometry.type}`),null;const l=r.text;return!l||/^\s+$/.test(l)?null:this._createAs3DShape(o,a,l,r,i,n,s)}setGraphicElevationContext(e,r,i=0){return super.setGraphicElevationContext(e,r),r.addOffsetRenderUnits(i),r}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,r){return kve(e,r,(i,n)=>{this.updateGraphicElevationContext(n,i)}),Dn.UPDATE}slicePlaneEnabledChanged(e,r){return kve(e,r,i=>{for(const n of i.stageObject.geometries)n.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,r){const i=r.elevationContext;this.setGraphicElevationContext(e,i,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=mp(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return kMt}_createAs3DShape(e,r,i,n,s=null,o=null,a=()=>n.placement.elevationOffset){var W;const l=this.setGraphicElevationContext(e,new D9,n.placement.elevationOffset),c=((W=e.geometry)==null?void 0:W.type)==="polyline",u=e.uid;let h=null,p=null;if(o==null){const V=z6e(n.horizontalPlacement);h=new IMt(i,V,this._textRenderParameters);let J=null;if(this._context.sharedResources.textures!=null){p=this._context.sharedResources.textures.fromData(h.key,()=>h.create()),p.texture.events.on("unloaded",()=>J==null?void 0:J.release());const Y=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(Y==null||Xu(Y))return p.release(),null;J=Y}}const f=FMt(h,n),g={occlusionTest:!0,screenOffset:n.placement.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:n.placement.centerOffsetUnits,drawInSecondSlot:!0};if(o?g.textureId=o.id:p&&(g.textureId=p.texture.id),n.placement.verticalOffset!=null){const{screenLength:V,minWorldLength:J,maxWorldLength:Y}=n.placement.verticalOffset;g.verticalOffset={screenLength:bs(V),minWorldLength:J||0,maxWorldLength:Y??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:V,screenSizePerspectiveSettingsLabels:J}=this._context.sharedResources,Y=F6e(this._textRenderParameters);g.screenSizePerspective=J.overrideFontHeight(Y.maxHeight),g.screenSizePerspectiveAlignment=V}c&&(g.shaderPolygonOffset=1e-4),g.hasSlicePlane=this._context.slicePlaneEnabled;const y=(V,J)=>{const Y=JSON.stringify(J);let X=V.get(Y);return X==null&&(X=new yA(J),V.add(Y,X)),X},v=s?y(s,g):new yA(g),b=n.placement.translation,w=h?mr(h.displayWidth,h.displayHeight):u_,x=n.placement.centerOffset,S=DMt,E=Ye(),P=mee(v,S,b,null,w,x,E,null),M=gle(this._context,r,P,l,u);if(M==null)return null;const L=(V,J,Y,X,le,D)=>{const I=a()||n.placement.elevationOffset,k=this.setGraphicElevationContext(e,J,I);return xT(V,k,Y,X,le,D)},U=new Ey(this,M.object,[P],s==null?[v]:null,p,L,l);U.alignedSampledElevation=M.sampledElevation,U.needsElevationUpdates=mp(l.mode)||l.mode==="absolute-height",U.getScreenSize=(V=Ye())=>(V[0]=h?h.displayWidth:n.displaySize[0],V[1]=h?h.displayHeight:n.displaySize[1],V);const z=new l5e(n.placement.elevationOffset,i);return U.metadata=z,xD(U,r,this._context.elevationProvider),U}};function kve(t,e,r){t&&t.forEach(i=>{const n=e(i);n!=null&&r(n,i.graphic)})}function FMt(t,e){if(e.verticalPlacement==="baseline"){const i=v3t[e.horizontalPlacement],n=t!=null?t.baselineAnchorY:0;return mr(i,n)}const r=w3t(e.horizontalPlacement,e.verticalPlacement);return T8[r]}const kMt={mode:"relative-to-ground",offset:0};function Uve(t){t.fragment.uniforms.add(new ft("texWaveNormal",e=>e.waveNormal),new ft("texWavePerturbation",e=>e.wavePerturbation),new Or("waveParams",e=>pn(UMt,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new ci("waveDirection",e=>yr(zMt,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(uxt),t.fragment.code.add(T`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const UMt=tr(),zMt=Ye();function J8e(t){const e=new Fr,{vertex:r,fragment:i}=e;Uu(r,t),e.include($c,t),e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.UV0,"vec2");const n=new Or("waterColor",s=>s.color);if(t.output===G.Color&&t.draped)return e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(sa)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(n),i.code.add(T`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==G.Color&&t.output!==G.Alpha||(e.include(MD,t),e.include(nO,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.multipassEnabled&&e.varyings.add("depth","float"),r.uniforms.add(n),r.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(sa)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===G.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Yu,t),t.output){case G.Alpha:e.include(Wn,t),i.uniforms.add(n),i.code.add(T`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case G.Color:e.include(a9),e.include(pae,{pbrMode:ht.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(Uve),e.include(Wn,t),e.include(_A,t),e.include(VFe,t),i.uniforms.add(n,new Ie("timeElapsed",s=>s.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")),mm(i,t),i.include(Ty),R_(i),by(i),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?T`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===vt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case G.Normal:e.include(MD,t),e.include(Uve,t),e.include(Wn,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r.uniforms.add(n),r.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(sa)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new Ie("timeElapsed",s=>s.timeElapsed)),i.code.add(T`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case G.Highlight:e.include(gw,t),e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(sa)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(Wn,t),i.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case G.ObjectAndLayerIdColor:e.include(aO,t),e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(sa)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(Wn,t),i.code.add(T`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const VMt=Object.freeze(Object.defineProperty({__proto__:null,build:J8e},Symbol.toStringTag,{value:"Module"}));let Q8e=class K8e extends Zr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Fe.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Br(e.rctx,K8e.shader.get().build(this.configuration),Nr)}_setPipelineState(e){const r=this.configuration,i=e===vt.NONE,n=e===vt.FrontFace;return Bt({blending:r.output!==G.Normal&&r.output!==G.Highlight&&r.output!==G.ObjectAndLayerIdColor&&r.transparent?i?Bh:$_(e):null,depthTest:r.draped?null:{func:yw(e)},depthWrite:r.draped?null:i?r.writeDepth?Wu:null:oG(e),colorWrite:rr,polygonOffset:i||n?null:cG(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};Q8e.shader=new Vr(VMt,()=>re(()=>Promise.resolve().then(()=>Ujt),void 0));let no=class extends Zl{constructor(){super(...arguments),this.output=G.Color,this.transparencyPassType=vt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}};d([H({count:G.COUNT})],no.prototype,"output",void 0),d([H({count:vt.COUNT})],no.prototype,"transparencyPassType",void 0),d([H()],no.prototype,"spherical",void 0),d([H()],no.prototype,"receiveShadows",void 0),d([H()],no.prototype,"hasSlicePlane",void 0),d([H()],no.prototype,"transparent",void 0),d([H()],no.prototype,"enableOffset",void 0),d([H()],no.prototype,"writeDepth",void 0),d([H()],no.prototype,"hasScreenSpaceReflections",void 0),d([H()],no.prototype,"doublePrecisionRequiresObfuscation",void 0),d([H()],no.prototype,"hasCloudsReflections",void 0),d([H()],no.prototype,"objectAndLayerIdColorInstanced",void 0),d([H()],no.prototype,"draped",void 0),d([H()],no.prototype,"multipassEnabled",void 0),d([H()],no.prototype,"cullAboveGround",void 0),d([H({constValue:!1})],no.prototype,"occlusionPass",void 0),d([H({constValue:ht.Water})],no.prototype,"pbrMode",void 0),d([H({constValue:!0})],no.prototype,"useCustomDTRExponentForWater",void 0),d([H({constValue:!0})],no.prototype,"highStepCount",void 0),d([H({constValue:!1})],no.prototype,"useFillLights",void 0);let BMt=class extends fw{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const r=e.ssr.lastFrameColor!=null;r!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:r})}_updateCloudsReflectionState(e){const r=e.cloudsFade.data!=null;r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===G.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(Q8e,e)}},GMt=class extends ace{constructor(e){super(e,new eUe),this._configuration=new no,this._animation=new sNe,this.produces=new Map([[de.OPAQUE_MATERIAL,r=>W0(r)&&!this.parameters.transparent||bT(r)],[de.TRANSPARENT_MATERIAL,r=>W0(r)&&this.parameters.transparent||bT(r)],[de.DRAPED_MATERIAL,r=>this.parameters.draped&&r===G.Color||bT(r)],[de.DRAPED_WATER,r=>r===G.Normal]])}getConfiguration(e,r){return this._configuration.output=e,this._configuration.writeDepth=!0,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<aG,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(e){const r=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<jMt;const i=this._animation.advance(e);return this.setParameters({timeElapsed:mne(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&i}createGLMaterial(e){return new BMt(e)}createBufferWriter(){return new cO(ne("enable-feature:objectAndLayerId-rendering")?pPt:hPt)}get test(){return{animationEnabled:this._animation.enabled}}},eUe=class extends Jae{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=mr(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Xt(0,0,0,0),this.transparent=!0,this.hasSlicePlane=!1,this.draped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=C(),this.modelTransformation=null}};const jMt=35e3,HMt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},qMt=["polyline","polygon","extent"];let xte=class Kx extends Cy{constructor(e,r,i,n){super(e,r,i,n)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,qMt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(this._materials[0])return;const e=new eUe,r=this.symbolLayer.color;r!=null&&(e.color=De.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?Kx.headingVectorFromAngle(this.symbolLayer.waveDirection):mr(0,0);const n=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,s=HMt[n];e.waveStrength=s.waveStrength,e.waveTextureRepeat=s.textureRepeat,e.waveVelocity=s.waveVelocity,e.flowStrength=s.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.draped=this.draped,this._materials[0]=new GMt(e),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(this._materials[0]==null)return;const e=this._materials[0].parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],r],transparent:i})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=NN(Kx.elevationModeChangeTypes,i,n);if(s!==Dn.UPDATE)return s;const o=mp(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var h;const n=XL(e.geometry);if(n==null)return null;const s=zle(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=s.position.length/3,a=Go(2*o);this._createUVCoordsFromVertices(a,s.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new WMt(s,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=(h=this._context.stage.renderView)==null?void 0:h.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,n.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new I_({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),u=new Ey(this,c,l.outGeometries,null,null,e5e,r);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=mp(r.mode),u}_createUVCoordsFromVertices(e,r,i,n){const s=fl(n);kc(x1);for(let l=0;l<i;l++)yr(zve,r[3*l],r[3*l+1]),U3(x1,zve);WT(x1,x1,s);const o=x1[0]%Kx.unitSizeOfTexture,a=x1[1]%Kx.unitSizeOfTexture;BF[0]=x1[0]-o,BF[1]=x1[1]-a;for(let l=0;l<i;l++)e[2*l]=(r[3*l]*s-BF[0])/Kx.unitSizeOfTexture,e[2*l+1]=(r[3*l+1]*s-BF[1])/Kx.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:n,index:s,position:o,mapPositions:a,holeIndices:l}of r){if(this._context.clippingExtent!=null&&(zi(nx),Ru(nx,a),!Uf(nx,this._context.clippingExtent)))continue;const c=qP(a,l,3);if(c.length===0)continue;const u=Qd(i,2*s,2*n),h=Ipe({material:this._materials[0],indices:c,mapPositions:a,attributeData:{position:o,uv0:u}},e.objectAndLayerIdColor);e.outGeometries.push(h)}}_createAsOverlay(e){var a;const r=XL(e.geometry);if(r==null)return null;this._materials[0].renderPriority=this._renderPriority;const i=Oke(r,this._context.overlaySR),n=i.position.length/3,s=Go(2*n);this._createUVCoordsFromVertices(s,i.position,n,this._context.overlaySR);const o=new YMt(i,s,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(o),o.outBoundingBox=zi(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new EG(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const r=e.uvCoords,i=e.renderData.polygons;for(const{position:n,holeIndices:s,index:o,count:a}of i){if(zi(nx),Ru(nx,n),!Uf(nx,this._context.clippingExtent))continue;YP(e.outBoundingBox,nx);const l=qP(n,s,3);if(l.length===0)continue;const c=Qd(r,2*o,2*a),u=Ipe({material:this._materials[0],indices:l,attributeData:{position:n,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new wA(u,e))}}static headingVectorFromAngle(e){const r=Ye(),i=vB(e);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};xte.unitSizeOfTexture=100,xte.elevationModeChangeTypes={definedChanged:Dn.RECREATE,staysOnTheGround:Dn.NONE,onTheGroundChanged:Dn.RECREATE};const BF=Ye(),x1=Ht(),zve=Ye(),nx=Ds();let WMt=class extends jB{constructor(e,r,i,n){super(e,i,n),this.uvCoords=r}},YMt=class extends jB{constructor(e,r,i,n){super(e,i,n),this.uvCoords=r}};function XMt(t,e,r,i){var s;const n=((s=JMt[t.type])==null?void 0:s[e.type])||ZMt[e.type];return n?new n(t,e,r,i):(K.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const ZMt={icon:gte,object:iOt,line:Y6e,path:nMt,fill:H8e,extrude:dTt,text:NMt,water:xte},JMt={"mesh-3d":{fill:bPt}};let QMt=class extends mle{set symbol(e){this._symbol=e,e.symbolLayers.forEach((r,i)=>{const n=this.symbolLayers[i];n!=null&&(n.symbol=e,n.symbolLayer=r)})}get symbol(){return this._symbol}constructor(e,r,i){super(r.schedule),this._symbol=e,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const n=[];for(let s=0;s<i;s++){const o=r.at(s);if(o.enabled===!1)continue;GF.renderPriority=1-(1+s)/i,GF.renderPriorityStep=1/i,GF.ignoreDrivers=o.ignoreDrivers;const a=XMt(this.symbol,o,this._context,GF),l=iB(e,()=>{this.symbolLayers[s]=null,a.destroy()});l&&n.push(l),this.symbolLayers[s]=a}if(await dB(this.symbolLayers,async(s,o)=>{if(s!=null)try{await s.load(),this._extentPadding+=Math.max(this._extentPadding,s.extentPadding)}catch{this.symbolLayers[o]=null}}),n.forEach(s=>s.remove()),dt(e),this.symbolLayers.length&&!this.symbolLayers.some(s=>!!s))throw new Error}getSymbolLayerSize(e){const r=this.symbolLayers[e];return r!=null?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e==null?void 0:e.queryForSnapping)}createGraphics3DGraphic(e,r){var o,a;const i=e.graphic,n=this.symbolLayers.map(l=>(l==null?void 0:l.createGraphics3DGraphic(e))??null),s=this._context.arcade||((a=(o=this._context.featureExpressionInfoContext)==null?void 0:o.arcade)==null?void 0:a.modules)||null;return new Uwt(i,r||this,n,e.layer,s)}get complexity(){return fle(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,r){const i=this.symbolLayers.length;for(let n=0;n<i;n++){const s=this.symbolLayers[n],o=a=>{const l=a.layers[n];return l instanceof Ey?l:null};if(s!=null&&!s.globalPropertyChanged(e,r,o))return!1}return!0}applyRendererDiff(e,r){return this.loadStatus!==Ch.LOADED?ls.RecreateSymbol:this.symbolLayers.reduce((i,n)=>i!==ls.RecreateSymbol&&n!=null?Math.min(i,n.applyRendererDiff(e,r)):i,ls.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===Ch.FAILED||e.diff.type!=="partial")return;const r=e.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((n,s)=>{if(n==null)return;const o=i[s];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};n.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[s];u!=null&&a.graphics3DGraphicPatches.forEach(h=>h(u,c))})}})}updateGeometry(e,r){return this._updateGeometryOrTransform(e,(i,n)=>i.updateGeometry(n,r))}updateTransform(e,r,i,n){return this._updateGeometryOrTransform(e,(s,o)=>s.updateTransform(o,r,i,n))}_updateGeometryOrTransform(e,r){for(let i=0;i<this.symbolLayers.length;i++){const n=this.symbolLayers[i];if(n==null)continue;const s=e.layers[i];if(!s||!r(n,s))return!1}return!0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(i==null)continue;const n=e.layers[r];n!=null&&i.onRemoveGraphic(n)}}getFastUpdateStatus(){let e=0,r=0,i=0;return this.symbolLayers.forEach(n=>{n!=null&&(n.loadStatus===Ch.LOADING?e++:n.isFastUpdatesEnabled()?i++:r++)}),{loading:e,slow:r,fast:i}}async queryForSnapping(e,r,i,n){const s=this.symbolLayers.filter(rw).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,r,i,n)),o=await Promise.all(s);return dt(n),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const GF=new zwt;let KMt=class extends mle{constructor(e,r,i){super(r),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const r=await this.symbol.fetchSymbol({signal:e});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:X5e}globalPropertyChanged(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,r)}applyRendererDiff(e,r){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,r):ls.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,r)}updateTransform(e,r,i,n){var s;return((s=this.graphics3DSymbol)==null?void 0:s.updateTransform(e,r,i,n))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function cce(t){return t instanceof KMt?t.graphics3DSymbol:t instanceof QMt?t:null}const RD=()=>K.getLogger("esri.views.3d.layers.graphics.labelPlacement");let eRt=class{constructor(e,r,i,n=null){this.graphics3DGraphic=e,this.labelSymbol=r,this.labelClass=i,this.disablePlacement=n}};function Vve(t){const e=cRt(t);if(e==null)return null;const r=tRt(t,e);if(r==null)return null;const i=r.anchor,n=!!e.hasLabelVerticalOffset,s=e.verticalOffset;return iRt(new W8e(s,i,n),r,t)}function tRt(t,e){if(e.anchor)return e;const r=t.labelClass.labelPlacement,i=Gf[r],n=i||nV(t);return r&&!i&&RD().warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),rRt(n,t)}function uce(t){const e=t.graphics3DGraphic.graphics3DSymbol,r=cce(e);return r!=null?r.symbol.symbolLayers.at(0):null}function rRt(t,e){const r=e.graphics3DGraphic.graphic.geometry;if(r==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(RD().warnOncePerTick(Bve(t==null?void 0:t.placement,e.disablePlacement.logEntityDescription)),nV(e)):t;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return RD().warnOncePerTick(Bve(t==null?void 0:t.placement,`'${i}' geometries`)),nV(e);break;case"point":case"mesh":return t}return t}function Bve(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function nV(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:Yn,anchor:"center"};case"polygon":{const r=uce(t);return r!=null&&r.type==="extrude"?Gf["above-center"]:{placement:"center-center",normalizedOffset:Yn,anchor:"center"}}case"point":case"mesh":return Gf["above-center"];default:return}}function iRt(t,e,r){const i=r.graphics3DGraphic.graphic.geometry;if(i==null)return null;switch(i.type){case"point":sRt(t,e,r);break;case"polygon":nRt(t,e,r);break;case"mesh":hce(t,e,r.graphics3DGraphic.layers[0])}const n=p3t-K9;return t.screenOffset[0]+=n*e.normalizedOffset[0],t.screenOffset[1]+=n*e.normalizedOffset[1],t}function nRt(t,e,r){const i=uce(r);if(i!=null)switch(i.type){case"extrude":{const n=r.graphics3DGraphic.layers[0];n!=null?(n.getBoundingBoxObjectSpace(KI),kf(KI,t.translation),t.translation[2]=aw(KI)/2):se(t.translation,0,0,0),hce(t,e,n);break}}}function sRt(t,e,r){const i=uce(r);if(i==null)return;const n=r.graphics3DGraphic.layers[0];switch(n!=null?n.getCenterObjectSpace(t.translation):se(t.translation,0,0,0),i.type){case"icon":case"text":oRt(t,e,r,n);break;case"object":hce(t,e,n)}}function oRt(t,e,r,i){const{graphics3DGraphic:n}=r,s=i!=null?i.getScreenSize():null;if(n.isDraped||s==null)t.hasLabelVerticalOffset||t.anchor==="center"||(Gf[r.labelClass.labelPlacement]&&RD().warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=aRt(r);t.screenOffset[0]=s[0]/2*(e.normalizedOffset[0]-o[0]);const a=s[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function aRt(t,e=uRt){const{graphics3DGraphic:r}=t,i=r.layers[0],n=(i==null?void 0:i.stageObject.geometries[0].material)??null;if(n&&n instanceof yA){const s=n.parameters.anchorPosition;e[0]=2*(s[0]-.5),e[1]=2*(s[1]-.5)}else e[0]=0,e[1]=0;return e}function hce(t,e,r){const i=r!=null?r.getBoundingBoxObjectSpace(KI):KI,n=Ce(i[3]-i[0],i[4]-i[1],i[5]-i[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);t.centerOffset[0]=s/2*e.normalizedOffset[0];const o=t.translation[2],a=n[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Te(n);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function lRt(t){return t==="above-center"}function cRt(t){const e=t.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=t,n=cce(i.graphics3DSymbol),s=(n==null?void 0:n.symbol.type)==="point-3d"?n.symbol:null,o=Gf[e]||nV(t);return s!=null&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Gve(s.verticalOffset),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||s!=null&&s.supportsCallout()&&s.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&lRt(o.placement)?{placement:"above-center",verticalOffset:Gve(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(RD().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function Gve(t){const{screenLength:e,minWorldLength:r,maxWorldLength:i}=t;return{screenLength:e,minWorldLength:r,maxWorldLength:i}}const Gf={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},jve={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in jve){const e=jve[t],r=Gf[t];e.forEach(i=>{Gf[i]=r})}Object.freeze&&(Object.freeze(Gf),Object.keys(Gf).forEach(t=>{var e;Object.freeze(Gf[t]),Object.freeze((e=Gf[t])==null?void 0:e.normalizedOffset)}));const uRt=[0,0],KI=Ds();let Hve=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,r){this._materials.set(e,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}},qve=class{constructor(e,r){this.labelingContext=e,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.addedToTextureAtlas=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},hRt=class{constructor(e,r,i,n,s){this.labelClass=e,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=n,this.labelFunction=s,this.calloutSymbolLayerIndex=0}},dRt=class{constructor(e,r,i,n,s,o,a,l){this.layer=r,this.graphics3DCore=i,this.scaleVisibility=n,this.emptySymbolLabelSupported=s,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new YFe(e,{pickable:!0,disableOctree:!0},r.uid)}destroy(){this.stageLayer.destroy()}},eS=class extends Pe{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([pe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),pe(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(Ct.LABELER,this)]),this._textTextureAtlas=new tT({view:this.view}),this._hudMaterialCollection=new Hve(this.view._stage),this._calloutMaterialCollection=new Hve(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=wt(this._textTextureAtlas),this._hudMaterialCollection=wt(this._hudMaterialCollection),this._calloutMaterialCollection=wt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),Fp.graphic=null,Fp.renderingInfo=null,Fp.layer=null}_activateLabelingContext(e){e.graphics.forEach((r,i)=>{const n=new qve(e,r);this._labels.set(i,n),e.labelsToInitialize.set(i,n),r.setVisibilityFlag(Uo.LABEL,Da.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((r,i)=>{r.setVisibilityFlag(Uo.LABEL,Da.USER,!1),this.setLabelGraphicVisibility(r,!1),r.clearLabelGraphics(),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i&&(this._textTextureAtlas.addTextTexture(i,r.stageObject),e.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i!=null&&(this._textTextureAtlas.removeTextTexture(i,r.stageObject),e.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),pa}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const r of this._labelingContexts)if(r.active)if(MW(r))this._dirty=!0;else if(RW(r.labelClassContexts)){if(r.labelClassContexts===null){this._deactivateLabelingContext(r);continue}this._createLabelClassContext(r),this._dirty=!0}else Hd(r.labelsToInitialize,(i,n)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(n,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(r.labelsToInitialize.delete(n),e.madeProgress()),e.done))&&(this._dirty=!0);this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a;const r=(o=e.labelClassAbortController)==null?void 0:o.signal;e.layer.when&&await e.layer.when(),dt(r),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,n=i.layer,s=(a=n.labelingInfo)==null?void 0:a.filter(l=>!!l.symbol);!s||s.length===0||(await dB(s,async(l,c)=>{const u=l.symbol,h=cce(i.getOrCreateGraphics3DSymbol(u));if(h==null)return void K.getLogger(this).error("Failed to create Graphics3DSymbol for label");await h.load(),dt(r);let p=null;Joe(u)&&u.hasVisibleCallout()&&(p=iwt(u,i.symbolCreationContext),await p.load(),dt(r));const f=await op(mvt(l,e.layer.fieldsIndex,this.view.spatialReference));if(dt(r),f.ok===!0){const g=await this._createTextRenderParameters(h.symbol);dt(r),e.labelClassContexts[c]=new hRt(l,h,p,g,f.value)}else K.getLogger(this).error(`Label expression failed to evaluate: ${f.error}`)}),dt(r))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(r=>{if(on(r))throw r;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const r=e.symbolLayers.at(0);return(r==null?void 0:r.type)!=="text"?null:X8e.fromSymbol(r,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const r=e.labelClassAbortController;e.labelClassAbortController=new AbortController,Ql(r),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,r,i,n,s,o){const a=new Y8e(i,j1e(i.anchor),b3t(i.anchor),e.text,mr(e.displayWidth,e.displayHeight));return Fp.graphic=r,Fp.renderingInfo=null,Fp.layer=n,s.createLabel(Fp,a,this._hudMaterialCollection,this._textTextureAtlas,()=>{const l=Vve(o);return l?l.elevationOffset:null})}_createLineCalloutGraphic(e,r,i,n,s){Fp.graphic=e,Fp.layer=s;const o=n.screenOffset[0];return Fp.renderingInfo=new twt(null,r,n.translation,n.centerOffset,o,n.centerOffsetUnits,n.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(Fp)}_ensureGraphics3DResources(e){var c;if(e.hasGraphics3DResources)return!1;const r=e.graphics3DGraphic;if(r.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,n=i.labelClassContexts;if(RW(n)||!i.emptySymbolLabelSupported&&r.layers.length===0)return!1;let s=!1;const o=r.graphic,a=i.layer,l=jF(i.layer);for(let u=0;u<n.length;u++){const h=e.textRenderers[u],p=e.textLabelPlacements[u];if(h==null||p==null)continue;const f=n[u],g=f.graphics3DSymbol,y=g.symbol&&g.symbol.type==="label-3d"?g.symbol:null,v=g.symbolLayers[0];if(!v)continue;v.setElevationInfoOverride(i.elevationInfoOverride);const b=new eRt(r,y,f.labelClass),w=this._createTextSymbolGraphic(h,o,p,a,v,b);if(w==null)return!1;w._labelClass=f.labelClass,w._labelIndex=u,r.addLabelGraphic(w,i.stageLayer),r.deconflictionPriority=((c=f.textRenderParameters)==null?void 0:c.definition.size)??0,r.setVisibilityFlag(Uo.LABEL,Da.USER,l),r.setVisibilityFlag(Uo.LABEL,Da.SCALE_RANGE,!0),r.setVisibilityFlag(Uo.LABEL,Da.DECONFLICTION,!1),s=!0;const x=f.graphics3DCalloutSymbolLayer;if(x&&p.hasLabelVerticalOffset){x.setElevationInfoOverride(i.elevationInfoOverride);const S=this._createLineCalloutGraphic(o,y,x,p,a);S!=null&&(f.calloutSymbolLayerIndex=r.labelLayers.length,r.addLabelGraphic(S,i.stageLayer))}break}return i.scaleVisibility&&s&&i.scaleVisibility.updateGraphicLabelScaleVisibility(r),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const r=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const n=r[i._labelIndex].graphics3DSymbol.symbolLayers[0];n==null||n.onRemoveGraphic(i)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var s;if(e.textInitialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(RW(i))return;const n=e.graphics3DGraphic.graphic;for(let o=0;o<i.length;o++){const a=i[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,(a==null?void 0:a.textRenderParameters)==null)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const w=l.needsHydrationToEvaluate()?J1t(n,r.layer):n;c=l.evaluate(w)}catch{c=null}else c=l.evaluate(n);if(c==null||c===""||/^\s+$/.test(c))continue;const u=a.graphics3DSymbol,h=((s=u.symbol)==null?void 0:s.type)==="label-3d"?u.symbol:null;if(!u.symbolLayers[0])continue;const p=e.graphics3DGraphic,f=a.labelClass,g=r.disablePlacement,y=Vve({graphics3DGraphic:p,labelSymbol:h,labelClass:f,disablePlacement:g});if(y==null)continue;const v=j1e(y.anchor),b=z6e(v);e.textRenderers[o]=new k6e(c,b,a.textRenderParameters,tT.maxSize),e.textLabelPlacements[o]=y}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,r){const i=r.graphic.uid;if(e.graphics.set(i,r),e.active){const n=new qve(e,r);this._labels.set(i,n),e.labelsToInitialize.set(i,n)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,r){const i=r.graphic.uid,n=this._labels.get(i);e.graphics.delete(i),n&&(this._destroyGraphic(n,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,r){this._labels.delete(r),e.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,r){if(!r)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of r){const n=e.graphics.get(i);n&&(this._removeGraphic(e,n),this._addGraphic(e,n))}}_globalPropertyChanged(e,r){for(const i of r.labelClassContexts){const n=new Map;r.graphics.forEach(o=>n.set(o.graphic.uid,o));const s=o=>o.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,n,s),i.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,n,o)}}}_visibilityInfoChange(e){const r=jF(e.layer);r&&!e.active&&this._activateLabelingContext(e),!r&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((r,i)=>{const n=this._labels.get(i);n&&(this._destroyGraphic(n,i),n.visible=!1,e.labelsToInitialize.set(i,n))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const r of this._labelingContexts)if(r.graphics3DCore===e)return r;return null}addGraphicsOwner(e,r,i){const n=i&&i.emptySymbolLabelSupported||!1,s=(i==null?void 0:i.elevationInfoOverride)||null,o=(i==null?void 0:i.disablePlacement)||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new dRt(this.view._stage,a,e,r,n,s,o,jF(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>jF(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const r=this._findLabelingContext(e);if(!r)return;const i=this._labelingContexts.indexOf(r);this._labelingContexts.splice(i,1),r.graphics.forEach(n=>this._removeGraphic(r,n)),r.destroy(),this.setDirty()}setLabelGraphicVisibility(e,r){const i=e.graphic.uid,n=this._labels.get(i);n&&n.visible!==r&&(r&&!n.addedToTextureAtlas?(this._addLabelTextureToAtlas(n),n.textInitialized||n.labelingContext.labelsToInitialize.set(i,n)):!r&&n.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(n),n.visible=r,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(r=>MW(r))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((r,i)=>r+(MW(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function MW(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function RW(t){return!t||t.length===0}function jF(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(r=>!!r.symbol))}d([m({constructOnly:!0})],eS.prototype,"view",void 0),d([m({constructOnly:!0})],eS.prototype,"deconflictor",void 0),d([m()],eS.prototype,"_textTextureAtlas",void 0),d([m({type:Boolean,readOnly:!0})],eS.prototype,"updating",null),eS=d([F("esri.views.3d.layers.graphics.Labeler")],eS);const Fp=new rwt(null,null,null);let E$=class SC{constructor(e,r,i,n=null){this.lij=[0,0,0],this.extent=Ht(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Ec.VISIBLE_ON_SURFACE,screenRect:Ht(),distance:0,shouldSplit:!1},this.used=!1,n&&this.acquire(e,r,i,n)}acquire(e,r,i,n){this.tilingScheme=n,this.id=SC.id(e,r,i),this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,n.getExtent(e,r,i,this.extent),this.resolution=n.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const r=this.lij[0]+1,i=2*this.lij[1],n=2*this.lij[2];return e?(e[0].acquire(r,i,n,this.tilingScheme),e[1].acquire(r,i+1,n,this.tilingScheme),e[2].acquire(r,i,n+1,this.tilingScheme),e[3].acquire(r,i+1,n+1,this.tilingScheme),e):[new SC(r,i,n,this.tilingScheme),new SC(r,i+1,n,this.tilingScheme),new SC(r,i,n+1,this.tilingScheme),new SC(r,i+1,n+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,c_(e.measures.screenRect,this.measures.screenRect)}static id(e,r,i){return`${e}/${r}/${i}`}};var Ec;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Ec||(Ec={}));function pRt(t,e,r,i,n,s,o=1){const a=Pb(e,n,WB);if(a==null)return!1;if(a===qi){if(t===i&&r===s)return!0;const c=r+o;for(let u=r,h=s;u<c;++u,++h)he(i[h],t[u]);return!0}const l=r+o;for(let c=r,u=s;c<l;++c,++u)a(t[c],0,i[u],0);return!0}const tUe=.5*Math.PI,fRt=tUe/Math.PI*180;let mRt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:C(),direction:C()};for(let r=0;r<4;r++)this._extent[r]={origin:C(),direction:C(),cap:{next:null,direction:C()}},this._planes[r]=Yr();this._planes[fi.NEAR]=Yr(),this._planes[fi.FAR]=Yr(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,r,i,n=!0){const s=this._extent;this._toRenderBoundingExtent(e,r,i),ge(this._center.origin,s[0].origin,s[2].origin),oe(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),n||oe(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=s[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=s[o===3?0:o+1];a.cap.next=l.origin,x_(a.cap.direction,a.origin,l.origin),YL(a.direction,a.cap.direction,a.origin,this._planes[o]),n||oe(a.direction,a.direction,-1)}YL(s[0].cap.direction,s[1].cap.direction,s[0].origin,this._planes[fi.NEAR]),n?QZ(this._planes[fi.NEAR],this._planes[fi.FAR]):(BB(this._planes[fi.FAR],this._planes[fi.NEAR]),QZ(this._planes[fi.NEAR],this._planes[fi.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*zr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,r,i=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Fe.Global){const s=this._maxSpanSpatialReference.isGeographic?fRt:tUe*r;if(this._maxSpan>s)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const s=this._extent[0];return!(i||!e.intersectsRay(Wh(s.origin,s.direction)))}for(let s=0;s<this._extent.length;s++){const o=this._extent[s];if(!i&&e.intersectsRay(Wh(o.origin,o.direction))||e.intersectsLineSegment(pT(o.origin,o.cap.next,yRt),o.cap.direction))return!0}const n=i?this._planes:this._planesWithoutFar;for(let s=0;s<e.lines.length;s++){const o=e.lines[s];if(dgt(n,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,r,i){tse(e,kp),kp[2]=i,Ua(r,kp,$W,this._renderCoordsHelper.spatialReference),us(Wve,$W),zi(Jc);for(const{x0:s,x1:o,y0:a,y1:l}of gRt)for(let c=0;c<5;c++){const u=c/4;kp[0]=Dt(e[s],e[o],u),kp[1]=Dt(e[a],e[l],u),kp[2]=i,ga(kp,r,kp,this._renderCoordsHelper.spatialReference),ze(kp,kp,Wve),um(Jc,kp)}se(this._extent[0].origin,Jc[0],Jc[1],Jc[2]),se(this._extent[1].origin,Jc[3],Jc[1],Jc[2]),se(this._extent[2].origin,Jc[3],Jc[4],Jc[2]),se(this._extent[3].origin,Jc[0],Jc[4],Jc[2]);for(let s=0;s<4;++s)ze(this._extent[s].origin,this._extent[s].origin,$W)}_toRenderBoundingExtentLocal(e,r,i){v7(e,r,By,this._renderCoordsHelper.spatialReference),se(this._extent[0].origin,By[0],By[1],i),se(this._extent[1].origin,By[2],By[1],i),se(this._extent[2].origin,By[2],By[3],i),se(this._extent[3].origin,By[0],By[3],i)}_toRenderBoundingExtent(e,r,i){switch(this._renderCoordsHelper.viewingMode){case Fe.Global:this._toRenderBoundingExtentGlobal(e,r,i);break;case Fe.Local:this._toRenderBoundingExtentLocal(e,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(Ci(e.planes[fi.NEAR],this._center.origin)<0&&fe(this._center.direction,e.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(Ci(e.planes[fi.NEAR],i.origin)<0&&fe(i.direction,e.direction)<0)return!0}return!1}};const gRt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],kp=C(),$W=xe(),Wve=xe(),Jc=Ds(),By=Ht(),yRt=bm();let _Rt=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustumBoundingSphereCenter=C(),this._frustumBoundingSphereRadius=0,this._frustum=new Av(e),this._extendedFrustum=new Av(e),this._intersector=new mRt({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>r,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e),this._updateFrustumBoundingSphere()}end(){this._cache.clear()}calculate(e){const r=this._renderCoordsHelper.viewingMode===Fe.Global&&e.lij[0]>=vRt&&e.lij[0]<bRt,i=this._getOrCalculateSingleTileVisibility(e,!r);return i!==Ec.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const r=Av.nearFarLineIndices,i=e.mutablePoints;for(const n of r){const[s,o]=n,a=i[s],l=i[o];_e(sh,l,a),oe(sh,sh,xRt),ge(i[o],a,sh)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let r=Ec.INVISIBLE;const i=this._cache.get(e.id);if(i!=null)return i;const n=Jve.acquire();e.getChildren(n);for(const s of n){const o=this.calculate(s);if(o!==Ec.INVISIBLE&&(r=o,o===Ec.VISIBLE_ON_SURFACE))break}return Jve.release(n),this._cache.set(e.id,r),r}_getOrCalculateSingleTileVisibility(e,r){const i=this._cache.get(e.id);if(i!=null)return i;const n=this._calculateSingleTileVisibility(e);return r&&this._cache.set(e.id,n),n}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Fe.Global&&e.lij[0]<wRt?this._calculateSingleTileVisibilitySided(e,!1)===Ec.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_isTileVisibleInFrustum(e){return this._renderCoordsHelper.viewingMode===Fe.Local?this._isTileVisibleInFrustumLocal(e):this._isTileVisibleInFrustumGlobal(e)}_updateFrustumBoundingSphere(){const e=this._frustum,r=e.origin,i=LRt;me(i,e.direction);const n=e.points,s=DRt;rn(s,n[4],r);const o=.5*fe(s,s)/fe(i,s),a=this._frustumBoundingSphereCenter;ho(a,r,i,o);const l=1+o;this._frustumBoundingSphereRadius=l}_isTileVisibleInFrustumLocal(e){const r=e.tilingScheme.spatialReference,i=e.extent,n=this._renderCoordsHelper.spatialReference,s=PRt;if(s[0]=i[0],s[1]=i[1],s[2]=0,s[3]=i[2],s[4]=i[3],s[5]=0,!an(s,r,0,s,n,0,2))return!1;const o=Kve;se(o[0],s[0],s[1],0),se(o[1],s[3],s[1],0),se(o[2],s[3],s[4],0),se(o[3],s[0],s[4],0);const a=ebe;se(a,.5*(s[0]+s[3]),.5*(s[1]+s[4]),.5*(s[2]+s[5]));const l=ARt;se(l,0,0,1);const c=.5*B0(o[0],o[2]),u=this._frustum,h=this._frustumBoundingSphereRadius,p=this._frustumBoundingSphereCenter,f=FRt;rn(f,p,a);const g=fe(l,f),y=NRt;if(ho(y,a,l,g),B0(y,p)>c+h)return!1;const v=CRt,b=g+h,w=g-h;for(let x=0;x<4;++x)ho(v[x],o[x],l,b),ho(v[x+4],o[x],l,w);return!Ste(u.planes,v,8)}_isTileVisibleInFrustumGlobal(e){const r=e.tilingScheme.spatialReference,i=e.extent,n=this._renderCoordsHelper.spatialReference;if(e.lij[0]<rUe)return!0;const s=Kve,o=.5*(i[0]+i[2]);if(se(s[0],i[0],i[1],0),se(s[1],i[2],i[1],0),se(s[2],i[2],i[3],0),se(s[3],i[0],i[3],0),se(s[4],o,i[1],0),se(s[5],o,i[3],0),!pRt(s,r,0,s,n,0,6))return!1;const a=s[0][2]>0,l=s[3][2]<0,c=a||l,u=zr(n).radius;if(c){const I=Ce(0,0,1),k=ORt;J1(k,I,s[0]);const j=MRt;if(J1(j,I,s[1]),a){const q=tbe,Q=s[4],ie=rbe;J1(ie,Q,I),J1(q,ie,Q);const ye=s[0];it(ye,k,q),PM(ye,u);const Ae=s[1];it(Ae,j,q),PM(Ae,u)}else if(l){const q=tbe,Q=s[5],ie=rbe;J1(ie,Q,I),J1(q,Q,ie);const ye=s[3];it(ye,q,k),PM(ye,u);const Ae=s[2];it(Ae,q,j),PM(Ae,u)}}const h=ebe;{const I=VRt;rn(I,s[3],s[0]),me(I,I);const k=BRt;ge(k,s[0],s[3]),oe(k,k,.5);const j=-fe(k,I),q=GRt,Q=jRt;ge(q,s[0],s[1]),oe(q,q,.5),ge(Q,s[2],s[3]),oe(Q,Q,.5);const ie=HRt;rn(ie,Q,q),me(ie,ie);const ye=-(j+fe(I,q))/fe(I,ie);ho(h,q,ie,ye),PM(h,u)}const p=this._frustumBoundingSphereRadius,f=this._frustumBoundingSphereCenter,g=this._frustum,y=g.planes;if(s.some(I=>g.intersectsPoint(I))||g.intersectsPoint(h))return!0;const v=RRt;me(v,h);const b=kRt;rn(b,f,ibe);const w=fe(b,v);if(w<-p)return!1;const x=IRt;me(x,s[0]);const S=fe(x,v);if(S<=0)return!0;const E=$Rt;oe(E,v,w);const P=B0(E,f),M=r.isWGS84,L=e.lij,U=M&&L[2]===2**L[0]-1,z=M&&L[2]===0,W=z?t$t:U?KRt:JRt,V=z?r$t:U?e$t:QRt,J=g.points;{const I=s,k=i$t,j=qRt,q=WRt,Q=ibe;for(const ie of W){const ye=I[ie];if(Qve(j,I[(ie+1)%4],ye),Qve(q,Q,ye),J1(k,q,j),ERt(k,J,1))return!1}}let Y=null;if(w<2*p){const I=2.5*p;if(P>S*I+p)return!1;const k=zRt,j=I/S;for(let q=0;q<4;++q)oe(k[q],s[q],j/u);se(k[4],0,0,0),Y=k}else{const I=(w+p)/S,k=(w-p)/S,j=URt;for(let q=0;q<4;++q){const Q=s[q];oe(j[q+4],Q,k/u),oe(j[q],Q,I/u)}Y=j}if(Ste(y,Y,Y.length))return!1;const X=g.lines,le=YRt,D=XRt;for(const I of V){me(le,s[I]);for(const k of X)if(me(D,k.direction),a$t(D,le,Y,J))return!1}return!0}_calculateSingleTileVisibilitySided(e,r){if(this._isTileVisibleInFrustum(e)){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,r);const i=zr(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._frustum,i,!0)?Ec.VISIBLE_ON_SURFACE:Ec.VISIBLE_WHEN_EXTENDED}return Ec.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(e.eye,sh);this._aboveGround||ua(r,r);const i=_o(-fe(r,e.viewForward));if(this._hasExtendedFrustum=i>e.fovY/2,!this._hasExtendedFrustum)return;const n=this._extendedFrustumParameters(),s=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=n.pointIndices[o],l=s[a],c=this._renderCoordsHelper.getAltitude(l);if(n.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,sh),a){case ut.FAR_BOTTOM_LEFT:case ut.FAR_TOP_LEFT:case ut.NEAR_BOTTOM_LEFT:case ut.NEAR_TOP_LEFT:KZ(this._extendedFrustum.planes[fi.LEFT],sh,sh);break;case ut.FAR_BOTTOM_RIGHT:case ut.FAR_TOP_RIGHT:case ut.NEAR_BOTTOM_RIGHT:case ut.NEAR_TOP_RIGHT:KZ(this._extendedFrustum.planes[fi.RIGHT],sh,sh)}oe(sh,sh,n.direction),this._renderCoordsHelper.intersectInfiniteManifold(Wh(l,sh),n.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(s),rl(s[ut.NEAR_BOTTOM_LEFT],s[ut.NEAR_BOTTOM_RIGHT],s[ut.NEAR_TOP_RIGHT],Xve),rl(s[ut.NEAR_BOTTOM_RIGHT],s[ut.NEAR_TOP_RIGHT],s[ut.NEAR_TOP_LEFT],Zve),fe(Xve,Zve)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[ut.NEAR_BOTTOM_LEFT],o[ut.NEAR_BOTTOM_RIGHT]]=[o[ut.NEAR_BOTTOM_RIGHT],o[ut.NEAR_BOTTOM_LEFT]]:[o[ut.NEAR_TOP_LEFT],o[ut.NEAR_TOP_RIGHT]]=[o[ut.NEAR_TOP_RIGHT],o[ut.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-Yve;return{zWithMargin:e,pointIndices:Av.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+Yve;return{zWithMargin:e,pointIndices:Av.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<e}}};const vRt=2,bRt=6,wRt=12,xRt=.95,Yve=1,sh=C(),Xve=Yr(),Zve=Yr(),Jve=new fa(Array,t=>{t.length!==4&&(t[0]=new E$,t[1]=new E$,t[2]=new E$,t[3]=new E$)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});function J1(t,e,r){return it(t,e,r),me(t,t),t}function Qve(t,e,r){return rn(t,e,r),me(t,t),t}function PM(t,e){return oe(t,t,e/uu(t)),t}const SRt=[fi.LEFT,fi.RIGHT,fi.BOTTOM,fi.TOP,fi.FAR];function TRt(t,e,r){for(let i=0;i<r;++i)if(Ci(t,e[i])<0)return!1;return!0}function Ste(t,e,r){for(const i of SRt)if(TRt(t[i],e,r))return!0;return!1}const rUe=3;function ERt(t,e,r){for(const i of e)if(fe(i,t)<r)return!1;return!0}const CRt=[C(),C(),C(),C(),C(),C(),C(),C()],PRt=[0,0,0,0,0,0],Kve=[C(),C(),C(),C(),C(),C()],ebe=C(),ARt=C(),tbe=C(),ORt=C(),MRt=C(),rbe=C(),RRt=C(),$Rt=C(),IRt=C(),LRt=C(),DRt=C(),NRt=C(),FRt=C(),ibe=Ce(0,0,0),kRt=C(),URt=[C(),C(),C(),C(),C(),C(),C(),C()],zRt=[C(),C(),C(),C(),C()],VRt=C(),BRt=C(),GRt=C(),jRt=C(),HRt=C(),qRt=C(),WRt=C(),YRt=C(),XRt=C(),ZRt=C(),JRt=[0,1,2,3],QRt=[0,1,2,3],KRt=[0,1,3],e$t=[0,1,3],t$t=[1,2,3],r$t=[1,2,3],i$t=C();function n$t(t,e,r){let i=1/0,n=-1/0;for(const s of r){const o=fe(e,s);i=Math.min(i,o),n=Math.max(n,o)}t[0]=i,t[1]=n}function s$t(t,e,r,i){let n=1/0,s=-1/0;for(const o of i){const a=fe(r,o);if(n=Math.min(n,a),s=Math.max(s,a),n<=e&&s>=t)return!1}return!0}const o$t=[0,0];function a$t(t,e,r,i){const n=ZRt;J1(n,t,e);const s=o$t;return n$t(s,n,r),s$t(s[0],s[1],n,i)}let l$t=class{constructor(e){this._camera=new st,this._focusOnMap=[0,0],this._screenRect=Ht(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new _Rt(e.renderCoordsHelper)}begin(e,r,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,OB(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=DJe(e.extent,this._focusOnMap),e.measures.visibility!==Ec.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const r=c$t,i=1<<r,n=e.measures.screenRect;kc(n);let s=0;const o=e.lij,a=o[0],l=a+r,c=o[1]<<r,u=o[2]<<r,h=this._tileSizeWithBias(e),p=h*h,f=this._camera,{frustum:g,viewport:y}=f;if(this._renderCoordsHelper.viewingMode===Fe.Local||a>rUe){const v=nbe;this._tilingScheme.getExtent(o[0],o[1],o[2],v);const b=RE,w=d$t,x=kc();for(let P=0;P<4;++P)this._toRenderCoords(v,abe[P][0],abe[P][1],w[P]),f.projectToScreen(w[P],b[P]),U3(x,b[P]);const S=Ste(g,w,4),E=x[0]>y[2]||x[1]>y[3]||x[2]<y[0]||x[3]<y[1];if(S||E)return void(e.measures.shouldSplit=!1)}for(let v=0;v<i;v++)for(let b=0;b<i;b++)if(s+=this._computeScreenArea(l,c+v,u+b,n),s>p)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Ec.VISIBLE_WHEN_EXTENDED?this._tileSize*u$t:this._tileSize}_computeScreenArea(e,r,i,n){this._tilingScheme.ensureMaxLod(e);const s=nbe;this._tilingScheme.getExtent(e,r,i,s);const o=h$t;return this._toRenderCoords(s,0,3,o[0]),this._toRenderCoords(s,2,3,o[1]),this._toRenderCoords(s,2,1,o[2]),this._toRenderCoords(s,0,1,o[3]),this._computeTriangleScreenArea([o[0],o[1],o[2]],n)+this._computeTriangleScreenArea([o[2],o[1],o[3]],n)}_computeTriangleScreenArea(e,r){const i=this._camera.frustum[fi.NEAR];let n=0,s=-1,o=-1;for(let a=0;a<3;++a)Ci(i,e[a])>0?(n++,s===-1&&(s=a)):o===-1&&(o=a);if(n===0)return this._computeTriangleScreenAreaInside(e,r);if(n===1){const a=obe,l=(s+1)%3,c=(s+2)%3,u=s;he(a[0],e[l]),he(a[1],e[c]),qF(a[2],e[c],e[u],i);const h=this._computeTriangleScreenAreaInside(a,r);return qF(a[1],e[l],e[u],i),h+this._computeTriangleScreenAreaInside(a,r)}if(n===2){const a=obe,l=o;he(a[0],e[l]);const c=(o+1)%3,u=(o+2)%3;return qF(a[1],e[l],e[c],i),qF(a[2],e[l],e[u],i),this._computeTriangleScreenAreaInside(a,r)}return 0}_computeTriangleScreenAreaInside(e,r){for(let i=0;i<3;i++)this._camera.projectToRenderScreen(e[i],sbe),this._camera.renderToScreen(sbe,RE[i]),ab(r,RE[i],r);return WKe(RE[0],RE[1],RE[2])}_toRenderCoords(e,r,i,n){return HF[0]=e[r],HF[1]=e[i],HF[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(HF,this._tilingScheme.spatialReference,n),n}};const c$t=2,u$t=5,RE=[Sn(),Sn(),Sn(),Sn()],nbe=Ht(),HF=C(),h$t=[C(),C(),C(),C()],sbe=Na(),obe=[C(),C(),C()];function qF(t,e,r,i){const n=Ci(i,e),s=Ci(i,r),o=Math.abs(s-n);oe(t,e,Math.abs(s)/o),ho(t,t,r,Math.abs(n)/o)}const d$t=[C(),C(),C(),C()],abe=[[0,3],[2,3],[2,1],[0,1]];function Oor(t,e,r){if(t==null||r==null)return!1;let i=!0;return qs[0]=t.xmin!=null?t.xmin:0,qs[1]=t.ymin!=null?t.ymin:0,qs[2]=t.zmin!=null?t.zmin:0,i=i&&an(qs,t.spatialReference,0,e,r,0,1),qs[0]=t.xmax!=null?t.xmax:0,qs[1]=t.ymax!=null?t.ymax:0,qs[2]=t.zmax!=null?t.zmax:0,i=i&&an(qs,t.spatialReference,0,e,r,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),i}function iUe(t,e,r){if(t==null||r==null)return!1;let i=!0;return qs[0]=t.xmin!=null?t.xmin:0,qs[1]=t.ymin!=null?t.ymin:0,qs[2]=t.zmin!=null?t.zmin:0,i=i&&an(qs,t.spatialReference,0,qs,r,0,1),e[0]=qs[0],e[1]=qs[1],qs[0]=t.xmax!=null?t.xmax:0,qs[1]=t.ymax!=null?t.ymax:0,qs[2]=t.zmax!=null?t.zmax:0,i=i&&an(qs,t.spatialReference,0,qs,r,0,1),e[2]=qs[0],e[3]=qs[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),i}const qs=C();let ea=class extends Pe{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void K.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const r=this._get("filterExtent");if(r===e||r!=null&&e&&r.equals(e))return;const i=e!=null?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=Ht();return iUe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new St,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new jt}initialize(){this.addHandles([pe(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),ei),pe(()=>{var e,r,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(r=this.viewState)==null?void 0:r.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),li)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(Ct.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Pi(this._frameWorker)}addClient(){const e=Dh();return this._clients.add(e),this._clients.size===1&&this._setDirty(),ri(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Xl))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=Ct.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=Ct.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new l$t({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(r=>new E$(r[0],r[1],r[2],e))}_purgeHorizonTiles(e){if(e.sort((r,i)=>{const n=r.measures.screenRect,s=i.measures.screenRect;return n[1]+n[3]-(s[1]+s[3])}),!(e.length>f$t))return e.toArray();kc(WF);for(let r=0;r<e.length;r++)if(ab(WF,e.data[r].measures.screenRect,WF),Mc(WF)>p$t)return e.data.slice(r,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:r}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!lN(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==Ec.INVISIBLE&&(i.measures.shouldSplit?(r.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const n of this.tiles.items)n.used=!1;const r=e.filter(n=>{const s=this._idToTile.get(n.id);return s?(s.copyMeasurementsFrom(n),s.used=!0):this._idToTile.set(n.id,n),!s}),i=this.tiles.items.filter(n=>!n.used&&(this._idToTile.delete(n.id),!0));this.tiles.removeMany(i),this.tiles.addMany(r),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,r)=>e.measures.visibility!==r.measures.visibility?e.measures.visibility===Ec.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-r.measures.distance),this.tiles.forEach((e,r)=>e.loadPriority=r)}};d([m({constructOnly:!0})],ea.prototype,"scheduler",void 0),d([m({constructOnly:!0})],ea.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],ea.prototype,"tilingSchemeOwner",void 0),d([m({constructOnly:!0})],ea.prototype,"cameraOnSurface",void 0),d([m({constructOnly:!0})],ea.prototype,"focus",void 0),d([m({constructOnly:!0})],ea.prototype,"viewState",void 0),d([m({constructOnly:!0})],ea.prototype,"terrain",void 0),d([m()],ea.prototype,"tiles",void 0),d([m()],ea.prototype,"tileSize",void 0),d([m({readOnly:!0})],ea.prototype,"tilingScheme",null),d([m()],ea.prototype,"filterExtent",null),d([m({readOnly:!0})],ea.prototype,"_filterExtentRect",null),d([m({readOnly:!0})],ea.prototype,"_rootTileIds",null),d([m({value:!1})],ea.prototype,"suspended",null),d([m({readOnly:!0})],ea.prototype,"updating",null),ea=d([F("esri.views.3d.layers.support.FeatureTileTree3D")],ea);const WF=Ht(),p$t=10,f$t=50;let Mn=class extends Pe{constructor(){super(...arguments),this._propertiesPool=new f_({camera:st},this),this._lastSeenCameraProjectionValues=new st,this.mode=Xr.ANIMATING,this._cssCamera=new st,this._camera=new st,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Xn,this.viewingMode=Fe.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,r){this._set("viewingMode",e),this._set("spatialReference",r),this._set("constraints",new s0({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new f_({camera:st},this)}destroy(){var e;this.cameraController=null,(e=this._propertiesPool)==null||e.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Fe.Global){const e=zr(this.spatialReference).radius;this.camera=new st({eye:Ce(4*e,0,0),center:Ce(e,0,0),up:Ce(0,0,1)})}else this.camera=new st({eye:Ce(0,0,100),center:Ce(0,0,0),up:Ce(0,1,0)})}get animation(){return this.cameraController instanceof gD&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:r,width:i,pixelRatio:n}=this.camera;return e.pixelRatio=1,e.height=Math.round(r/n),e.width=Math.round(i/n),e}get camera(){return this._camera}set camera(e){e!==od&&od.copyFrom(e),od.computeUp(this.viewingMode),this.events.emit("before-camera-change",od);const r=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,od)&&(this._lastSeenCameraProjectionValues.copyFrom(od),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!r.equals(od)&&(this._camera=this._propertiesPool.get("camera").copyFrom(od),this._cameraChanged=!r.almostEquals(od),this._cameraChanged)){const i=fCe(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Xr.IDLE}get updating(){return this.mode!==Xr.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Fe.Global}get isLocal(){return this.viewingMode===Fe.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var r;this.stopActiveCameraController()?((r=this.cameraController)==null||r.destroy(),e&&(this.removeHandles(lbe),this.addHandles(up(()=>e.state===dn.Finished||e.state===dn.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),lbe),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=dn.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==dn.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();od.copyFrom(this._get("camera")),e(od),this.camera=od,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,r){return e.fov!==r.fov||e.fullViewport[0]!==r.fullViewport[0]||e.fullViewport[1]!==r.fullViewport[1]||e.fullViewport[2]!==r.fullViewport[2]||e.fullViewport[3]!==r.fullViewport[3]||e.padding[or.TOP]!==r.padding[or.TOP]||e.padding[or.RIGHT]!==r.padding[or.RIGHT]||e.padding[or.BOTTOM]!==r.padding[or.BOTTOM]||e.padding[or.LEFT]!==r.padding[or.LEFT]}};d([m()],Mn.prototype,"mode",void 0),d([m({readOnly:!0,type:aA})],Mn.prototype,"animation",null),d([m({type:st})],Mn.prototype,"cssCamera",null),d([m()],Mn.prototype,"_cssCamera",void 0),d([m({type:st})],Mn.prototype,"camera",null),d([m()],Mn.prototype,"_camera",void 0),d([m({readOnly:!0})],Mn.prototype,"pixelRatio",null),d([m()],Mn.prototype,"rasterPixelRatio",void 0),d([m()],Mn.prototype,"contentPixelRatio",void 0),d([m({readOnly:!0})],Mn.prototype,"alignPixelEnabled",null),d([m({readOnly:!0})],Mn.prototype,"updating",null),d([m({})],Mn.prototype,"_contentCamera",void 0),d([m({type:st})],Mn.prototype,"contentCamera",null),d([m({readOnly:!0})],Mn.prototype,"fixedContentCamera",null),d([m({readOnly:!0})],Mn.prototype,"constraints",void 0),d([m({readOnly:!0})],Mn.prototype,"events",void 0),d([m({readOnly:!0})],Mn.prototype,"isGlobal",null),d([m({readOnly:!0})],Mn.prototype,"isLocal",null),d([m({readOnly:!0})],Mn.prototype,"viewingMode",void 0),d([m({readOnly:!0})],Mn.prototype,"spatialReference",void 0),d([m()],Mn.prototype,"navigating",null),d([m()],Mn.prototype,"stationary",null),d([m()],Mn.prototype,"_cameraChanged",void 0),d([m()],Mn.prototype,"cameraController",null),Mn=d([F("esri.views.3d.state.ViewState")],Mn);const m$t=Mn,od=new st,lbe="ViewStateHandles";function nUe(t){return t?T$t:E$t}function g$t(t,e){return e!=null&&e.mode?e.mode:nUe(t).mode}function y$t(t,e){return e??nUe(t)}function _$t(t,e){return g$t(t!=null&&t.hasZ,e)}function $or(t,e){return y$t(t!=null&&!!t.hasZ,e)}function Ior(t){const e=v$t(t),r=_$t(t.geometry,e);return{mode:r,offset:e!=null&&r!=="on-the-ground"?aUe(e):0}}function v$t(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}function sUe(t,e){if(!(t!=null&&t.offset))return 0;const{offset:r,unit:i}=t;if(i==="decimal-degrees")return 0;const n=i!=="unknown"&&i?i:"meters",s=KYe(e);return s?Lo(r,n,s):0}function Lor(t,e,r,i=null){return oUe(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,r,i)}function Dor(t,e,r,i,n=null){return oUe(t,e[0],e[1],e.length>2?e[2]:0,r,i,n)}function oUe(t,e,r,i,n,s,o=null){if(s==null)return;const a=o!=null?o.mode:"absolute-height";if(a==="on-the-ground")return 0;const{absoluteZ:l}=b$t(e,r,i,n,t,s);return w$t(l,e,r,i,n,t,o,a)}function b$t(t,e,r,i,n,s){const o=sUe(s,i);switch(s.mode){case"absolute-height":return{absoluteZ:r+o,elevation:0};case"on-the-ground":{const a=n.elevationProvider.getElevation(t,e,0,i,"ground")??0;return{absoluteZ:a,elevation:a}}case"relative-to-ground":{const a=n.elevationProvider.getElevation(t,e,r,i,"ground")??0;return{absoluteZ:r+a+o,elevation:a}}case"relative-to-scene":{const a=n.elevationProvider.getElevation(t,e,r,i,"scene")??0;return{absoluteZ:r+a+o,elevation:a}}}}function w$t(t,e,r,i,n,s,o,a){const l=sUe(o,n);switch(a){case"absolute-height":return t-l;case"relative-to-ground":return t-((s.elevationProvider.getElevation(e,r,i,n,"ground")??0)+l);case"relative-to-scene":return t-((s.elevationProvider.getElevation(e,r,i,n,"scene")??0)+l)}}function Nor(t,e){if(e==null)return!1;const{mode:r}=e;return r!=null&&(t==="scene"&&r==="relative-to-scene"||t==="ground"&&r!=="absolute-height")}function For(t,e,r){return r&&r.mode!==e?`${t} only support ${e} elevation mode`:null}function x$t(t,e,r){return(r==null?void 0:r.mode)===e?`${t} do not support ${e} elevation mode`:null}function S$t(t,e){return(e==null?void 0:e.featureExpressionInfo)!=null&&e.featureExpressionInfo.expression!=="0"?`${t} do not support featureExpressionInfo`:null}function cbe(t,e){e&&t.warn(".elevationInfo=",e)}function aUe(t){return((t==null?void 0:t.offset)??0)*i5e(t==null?void 0:t.unit)}const T$t={mode:"absolute-height",offset:0},E$t={mode:"on-the-ground",offset:null},C$t="OBJECTID";let kor=class extends xN{constructor(e,r,i,n){super(r,i),this.point=e,this.createGraphic=n}};function lUe(t){return _p(t)&&t.intersector===Yi.PCL&&!!t.target}let zor=class extends h$e{constructor(e,r,i,n,s){super(e),this.layerUid=e,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=n,this.triangleNr=s}},Bor=class extends xN{constructor(e,r,i){super(r,null),this.point=e,this.createVoxelGraphic=i}},jor=class extends xN{constructor(e,r){super(e,null),this.createTiles3DGraphic=r}};function CG(t){return _p(t)&&t.intersector===Yi.I3S&&!!t.target}function cUe(t){return _p(t)&&t.intersector===Yi.VOXEL&&!!t.target}function P$t(t){return _p(t)&&t.intersector===Yi.TILES3D&&!!t.target}function uUe(t,e){var r,i;return P7(t)||A7(t)?$D((r=t.target)==null?void 0:r.object,e):zSt(t)?(i=e.map)==null?void 0:i.ground:lUe(t)||CG(t)||vke(t)||cUe(t)?$D(t.target,e):null}function qor(t,e){const r=dce(t,e);return r!=null&&r.type==="graphic"?r.graphic:null}function dce(t,e){var r;if(t==null)return null;if(P7(t)||A7(t))return ube((r=t.target)==null?void 0:r.object,e);if(lUe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(cUe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(P$t(t)){const i=t.target.createTiles3DGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return vke(t)||sce(t)?ube(t.target,e):CG(t)?A$t(t.target,e):null}function ube(t,e){if((t==null?void 0:t.graphicUid)==null)return null;const r=$D(t,e);if(r==null)return null;if(r===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const i=e.allLayerViews.find(n=>n.layer===r);return!i||i.suspended||t.graphicUid==null?null:"getHit"in i?i.getHit(t.graphicUid):null}function A$t(t,e){const r=$D(t,e);if(r==null)return null;const i=e.allLayerViews.find(n=>n.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?M$t(i.getGraphicFromIntersectorTarget(t)):null}function O$t(t,e){const r=$D(t,e);if(r==null)return null;const i=e.allLayerViews.find(n=>n.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(t):null}function M$t(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function $D(t,e){return(t==null?void 0:t.layerUid)==null?null:e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.allLayers.find(r=>r.uid===t.layerUid)}function Wor(t,e){if(P7(t)||A7(t))return H0(t.target.object.boundingVolumeWorldSpace.bounds);if(sce(t)){SB(YF,t.transformation);const r=Math.max(YF[0],YF[1],YF[2]);return t.target.baseBoundingSphere.radius*r}if(CG(t)){const r=O$t(t.target,e);return r?.5*LAe(r):null}return null}function Yor(t){return!P7(t)&&!A7(t)&&(sce(t)?t.target.numLodLevels>1:!!CG(t))}const YF=C();async function R$t(t,e,r,i){const n=r?dUe(t,r):i,s=Sn(e.x,e.y);n.requiresGroundFeedback=!0,n.enableDraped=!0;const o=pp(t.state.viewingMode);o.options.selectionMode=!0,o.options.store=ha.ALL,t.sceneIntersectionHelper.intersectIntersectorScreen(s,o,n);const a=I$t(t,o.results.all,n.graphics),l=o.results.ground,c=uUe(l,t),u=c!=null&&"type"in c&&BL(c.type)?c:null,h={screenPoint:e,results:a,ground:{mapPoint:eL(t,l),distance:_p(l)?l.distanceInRenderSpace:0,layer:u}};return Si.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=o),h}function $$t(t,e,r,i){const n=r?dUe(t,r):i,s=n.graphics!=null&&(n.graphics.include!=null||n.graphics.exclude!=null),o=$f(e);n.enableDraped=n.include&&!n.include.has(kb)||n.exclude&&n.exclude.has(kb);const a=t.sceneIntersectionHelper,l=pp(t.state.viewingMode);if(l.options.selectionMode=!0,l.options.store=s?ha.ALL:ha.MIN,l.options.hud=!(r!=null&&r.excludeHud),a.intersectIntersectorScreen(o,l,n),s){for(const c of l.results.all){const u=dce(c,t);if(u==null||u.type!=="graphic"||hUe(n.graphics,u.graphic))return eL(t,c)}return null}return eL(t,l.results.min)}function I$t(t,e,r){const i=new Array;let n=null;for(let s=0;s<e.length;s++){const o=e[s],a=uUe(o,t);if(a!=null&&(a===t.map.ground||"type"in a&&BL(a.type)))break;const l=dce(o,t);if(l==null)continue;if(l.type==="graphic"){if(n==null&&s!==e.length-1&&(n=new Set),n!=null){const h=pce(l.graphic);if(n.has(h))continue;n.add(h)}if(!hUe(r,l.graphic))continue}const c=eL(t,o),u=o.distanceInRenderSpace;if(l.type==="media"){const h=l.element.toSource(c);i.push({...l,mapPoint:c,distance:u,sourcePoint:h})}else i.push({...l,mapPoint:c,distance:u})}return i}function eL(t,e,r){return e.getIntersectionPoint(b3)?(r=Tte(t,b3,r),e.intersector===Yi.TERRAIN&&t.basemapTerrain&&(r.z=kg(t.basemapTerrain,r)??0),r):null}function pce(t){var n;const e=t.sourceLayer,r=t.layer,i=e&&"objectIdField"in e?e:r&&"objectIdField"in r?r:e;if(i){const s=i.objectIdField??C$t,o=(n=t.attributes)==null?void 0:n[s];if(o)return`o-${i.id}-${o}`}return`u-${t.uid}`}function hUe(t,e){const r=pce(e);return t==null||(t.include==null||t.include.has(r))&&(t.exclude==null||!t.exclude.has(r))}function Tte(t,e,r){let i=t.spatialReference||Ve.WGS84;return ga(e,t.renderSpatialReference,b3,i)?e=b3:(i=Ve.WGS84,ga(e,t.renderSpatialReference,b3,i)&&(e=b3)),r?(r.x=e[0],r.y=e[1],r.z=e[2],r.spatialReference=i):r=new He(e,i),r}function dUe(t,e){const r=Ete(t,e.include,ID.INCLUDE),i=Ete(t,e.exclude,ID.EXCLUDE);return{include:r.layerUids,exclude:i.layerUids,graphics:{include:r.graphicUids,exclude:i.graphicUids}}}function Ete(t,e,r,i={layerUids:void 0,graphicUids:void 0}){if(!e)return i;if(e instanceof Hu)L$t(i,pce(e)),r===ID.INCLUDE&&(t.graphicsView!=null&&e.layer===t?AM(i,t.graphicsView.processor.layer.id):e.layer&&AM(i,e.layer.uid));else if(WX(e))for(const n of e)n===t.graphics&&t.graphicsView!=null?AM(i,t.graphicsView.processor.layer.id):n===t.map.ground?AM(i,kb):Ete(t,n,r,i);else"uid"in e&&AM(i,e.uid);return i}function AM(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function L$t(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}const b3=C();var ID;(function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"})(ID||(ID={}));let D$t=class{constructor(e,r,i){this.viewingMode=e,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new jt,this._tolerance=nA,this._tmpRay=fo(),this._tmpRegion=Ht(),this._validateHUDIntersector=pp(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,r,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),hbe(this.viewingMode),r,i)}intersectScreenFreePointFallback(e,r,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),r,i)}intersectRayFreePointFallback(e,r,i){return this.intersectRay(e,hbe(this.viewingMode),r,i)||this._intersectRayFreePointLocal(e,r)}intersectRay(e,r,i,n){return r.options.selectionMode=!1,r.options.store=ha.MIN,this.computeIntersection(e,r,n),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,r,i=.5,n=.5){return e.getRenderCenter(ZF,i,n),ZF[0]+=.0466,ZF[1]-=.0123,Dae(e,ZF,r)}intersectIntersectorScreen(e,r,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),r,i)}intersectToolIntersectorScreen(e,r,i){const n=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(n,r,i)}intersectToolIntersectorRay(e,r,i){r.options.selectionMode=!0,this.computeIntersection(e,r,i);const n=r.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||_p(n)&&n.intersector!==Yi.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(e,r,i))}setTolerance(e=nA){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((r,i)=>r.type===Yi.TERRAIN?1:i.type===Yi.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===Yi.TERRAIN?1:i.type===Yi.TERRAIN?-1:0)}_getPickRay(e,r){const i=this._view.state.camera;return Lae(i,e,r)}_intersectRayFreePointLocal(e,r){return this.viewingMode!==Fe.Local||e==null||ge(r,e.origin,me(je.get(),e.direction)),!1}intersectElevationFromScreen(e,r,i=0,n=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),r,i,n)}_intersectElevation(e,r,i=0,n=null){if(e==null)return null;const s=this._view,{renderCoordsHelper:o}=s,a=zT(s.spatialReference),l=r!=null?r.mode:"absolute-height",c=aUe(r)/a,u=(l!=="on-the-ground"?c+i:0)*a/o.unitInMeters,{camera:h}=s.state;if(l==="absolute-height"){const S=o==null?void 0:o.getAltitude(h.eye),E=fe(me(OM,e.direction),o.worldUpAtPosition(h.eye,k$t));if(S<u&&E<0||S>=u&&E>0)return null;if(o.intersectInfiniteManifold(e,u,OM)){const P=Tte(s,OM);return P.z??(P.z=0),P.z-=c,P}return null}const p=je.get();h.projectToRenderScreen(e.origin,p);const f=new dbe(null,this._forEachLayer),{slicePlane:g}=s,y=g!=null?lme(g):null,v=pp(this.viewingMode);v.options.store=ha.MIN,v.options.verticalOffset=u;const b=e.origin,w=ge(je.get(),b,e.direction);v.reset(b,w,h),v.point=p;const x=n?"type"in n&&n.type==="graphics"?S=>S.layerUid!==n.uid:S=>S.graphicUid!==n.uid:null;switch(l){case"relative-to-scene":{const S=E=>(!x||x(E))&&!!E.lastValidElevationBB;v.intersect(f.layers,p,this._tolerance,null,S),this._externalIntersectionHandlers.forAll(E=>{if(E.type===Yi.I3S||E.type===Yi.TERRAIN||E.type===Yi.TILES3D){const P=E.slicePlaneEnabled?y:null;E.intersect(v,P,v.rayBegin,v.rayEnd,p)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(S=>{if(S.isGround){const E=S.slicePlaneEnabled?y:null;S.intersect(v,E,v.rayBegin,v.rayEnd,p)}})}if(v.results.min.getIntersectionPoint(OM)){const S=Tte(s,OM);return S.z=i,S}return null}computeIntersection(e,r,i,n){var y;if(e==null)return;const s=this._view.state.camera,o=je.get();s.projectToRenderScreen(e.origin,o);const a=new dbe(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const l=e.origin,c=ge(je.get(),e.origin,e.direction);r.reset(l,c,s),r.intersect(a.layers,o,this._tolerance);const u=this._view.slicePlane,h=u!=null?lme(u):null;r.intersect(a.sliceableLayers,o,this._tolerance,h);const p=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(v=>{const b=v.layerUid,w=Array.isArray(b),x=w?b:[b];w&&(r.options.filteredLayerUids=[]);let S=!1;for(const E of x)a.filterLayerUid(E)?S=!0:w&&r.options.filteredLayerUids.push(E);if(r.options.isFiltered=!S,v.isGround&&p||!r.options.isFiltered){const E=v.slicePlaneEnabled?h:null;v.intersect(r,E,l,c,o,n)}});const f=je.get(),g=this._view.basemapTerrain;if(i&&i.enableDraped&&g.spatialReference!=null&&r.results.ground.getIntersectionPoint(f)){const v=g.overlayManager.renderer,b=this._view.renderCoordsHelper.spatialReference,w=je.get();this._view.renderCoordsHelper.fromRenderCoords(f,w,g.spatialReference),w[2]=((y=this._view.elevationProvider)==null?void 0:y.getElevation(f[0],f[1],f[2],b,"ground"))??0,v.intersect(r,w,r.results.ground,x=>a.filterRenderGeometry(x))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(e){const r=e.results.hud;c_(this._tmpRegion,GZ);const i=this._view.state.camera,n=[],s=this._tmpRegion,o=b=>{const w=new F$t(b);i.projectToRenderScreen(b.target.center,w.screenPoint),w.screenPoint[0]=Math.floor(w.screenPoint[0]),w.screenPoint[1]=Math.floor(w.screenPoint[1]),n.push(w),U3(s,w.screenPoint)};e.sortResults(r.all),r.min.dist!=null&&o(r.min);for(const b of r.all)r.min.target.object!==b.target.object&&r.max.target.object!==b.target.object&&o(b);if(r.max.dist!=null&&r.max.target.object!==r.min.target.object&&o(r.max),!n.length)return;s[0]===s[2]&&(s[2]+=1),s[1]===s[3]&&(s[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,s[0]-C$),u=Math.max(0,s[1]-C$),h=Math.min(sl(s)+2*C$,a-c),p=Math.min(Mc(s)+2*C$,l-u);if(h<=0||p<=0)return;const f=new Uint8Array(h*p*4);this._view._stage.renderer.readHUDVisibility(c,u,h,p,f);let g=!0;const y=e.results.max.dist==null;let v=0;for(const b of n)for(const w of N$t){const x=4*(Math.min(b.screenPoint[0]+w[0],a)-s[0]+(Math.min(b.screenPoint[1]+w[1],l)-s[1])*h);if(!(x<0||x>=f.length)&&f[x]){g&&(e.results.min.copy(b.result),g=!1),y&&e.results.max.copy(b.result),e.options.store===ha.ALL&&e.results.all.splice(v++,0,b.result);break}}}};const C$=1,N$t=(()=>{const t=[],e=C$;for(let r=-e;r<=e;r++)for(let i=-e;i<=e;i++)t.push([i+e,r+e]);return t})();let F$t=class{constructor(e){this.result=e,this.screenPoint=Na()}},XF;function hbe(t){return XF&&XF.viewingMode===t||(XF=pp(t)),XF}let dbe=class{constructor(e,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(e){const{include:r,exclude:i}=this;return e==null?r==null&&i==null:(r==null||r.has(e))&&(i==null||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function pbe(t){return typeof t=="object"&&"intersect"in t}const OM=C(),k$t=C(),ZF=Na();let Qor=class{constructor(e,r){this.spatialReference=e,this._view=r}getElevation(e,r,i){return this._view.elevationProvider.getElevation(e,r,0,this.spatialReference,i)}async queryElevation(e,r,i,n,s){return this._view.elevationProvider.queryElevation(e,r,0,this.spatialReference,s,i,n)}},U$t=class{constructor(e,r,i,n){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...n,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(Ct.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(Xl);else for(const r of this._queries)r.result.reject(gr())}queryElevation(e,r,i,n=0){const s=ma(),o={x:e,y:r,minDemResolution:n,result:s,signal:i};return this._queries.push(o),la(i,()=>{sne(this._queries,o),s.reject(gr())}),s.promise}get running(){return this._queries.length>0}runTask(e){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(u=>u.result.reject()),void e.madeProgress();const n=r.map(u=>[u.x,u.y]),s=r.reduce((u,h)=>Math.min(u,h.minDemResolution),1/0),o=new VA({points:n,spatialReference:this.spatialReference}),a=r.length>1&&r.some(u=>!!u.signal)?new AbortController:null,l=a!=null?a.signal:r[0].signal;if(a!=null){let u=0;r.forEach(h=>la(h.signal,()=>{u++,h.result.reject(gr()),u===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:s,signal:l};i.queryElevation(o,c).then(u=>{r.forEach((h,p)=>{h.signal!=null&&h.signal.aborted?h.result.reject(gr()):h.result.resolve(u.geometry.points[p][2])})}).catch(u=>{r.forEach(h=>h.result.reject(u))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(Xl)}}},sV=class{constructor(e=1/0,r=-1/0){this.elevationRangeMin=e,this.elevationRangeMax=r}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,r){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,r)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}},P$=class extends Xn.EventedMixin(Pe){get spatialReference(){var e,r;return(r=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:r.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=Me(this._cachedQuery)}enableCache(e){e||(this.lastElevationQuery=null),this._cacheEnabled=e}getElevation(e,r,i,n,s){if(this._cacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&r===a.y&&i===a.z&&yo(n,a.spatialReference)&&s===a.queryContext)return a.result}let o=null;return o=JF(o,this._im,e,r,i,n,s),o==null&&(o=JF(o,this._ground,e,r,i,n,s)),s==="scene"&&(o=JF(o,this._scene,e,r,i,n,s)),this._cacheEnabled&&(this.lastElevationQuery={x:e,y:r,z:i,spatialReference:n,queryContext:s,result:o}),o}getSphereElevationBounds(e,r,i){const n=new sV;function s(o){for(const a of o)if(a.getSphereElevationBounds){const l=a.getSphereElevationBounds(e,r,i);l!=null&&n.expandElevationRangeValues(l.elevationRangeMin,l.elevationRangeMax)}}return s(this._ground),s(this._im),i==="scene"&&s(this._scene),n}getRootElevationBounds(){const e=new sV;for(const r of[this._im,this._ground,this._scene])r.forEach(i=>{if(i.getRootElevationBounds){const n=i.getRootElevationBounds();n!=null&&e.expandElevationRangeValues(n.elevationRangeMin,n.elevationRangeMax)}});return e}async queryElevation(e,r,i,n,s,o=null,a=0){const l=this._getElevationQuery(n);try{const c=await l.queryElevation(e,r,o,a);return s==="scene"?JF(c,this._scene,e,r,i,n,s):c}catch(c){return ko(c),this.getElevation(e,r,i,n,s)}}register(e,r){this.addHandles(r.on("elevation-change",i=>this.emit("elevation-change",i)),r),this._providersFromContext(e).push(r)}unregister(e){this.removeHandles(e);for(const r of[this._im,this._ground,this._scene]){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const r=this._cachedQuery;if(r!=null&&yo(e,r.spatialReference))return r;r==null||r.destroy({completeTasks:!0});const{wkid:i,wkt:n,wkt2:s,latestWkid:o}=e,a=new U$t(this.view.resourceController.scheduler,new Ve({wkid:i,wkt:n,wkt2:s,latestWkid:o}),()=>{var l;return(l=this.view.map)==null?void 0:l.ground},{maximumAutoTileRequests:4});return this._cachedQuery=a,a}};function JF(t,e,r,i,n,s,o){for(const a of e){const l=a.getElevation(r,i,n,s,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}d([m({constructOnly:!0})],P$.prototype,"view",void 0),d([m()],P$.prototype,"spatialReference",null),P$=d([F("esri.views.3d.support.CombinedElevationProvider")],P$);let LD=class Cte{static isValidProfile(e){return e in Cte.profiles}static getDefaultProfile(){return ne("esri-iPhone")?"low":"medium"}static apply(e,r){const i=Cte.profiles[e];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxNumberOfDrawCalls=i.graphics3D.maxNumberOfDrawCalls,r.graphics3D.maxTotalNumberOfVertices=i.graphics3D.maxTotalNumberOfVertices,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods,r.graphics3D.uncompressedTextureDownsamplingEnabled=i.graphics3D.uncompressedTextureDownsamplingEnabled;const n=r.sceneService.object,s=i.sceneService.object;n.lodFactor=s.lodFactor,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.vtlContentZoom=i.tiledSurface.vtlContentZoom,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.highResolutionAtmosphere=i.highResolutionAtmosphere,r.reflections=i.reflections,r.ambientOcclusion=i.ambientOcclusion,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}};LD.test={reset(){const t=pUe();for(const e of Object.keys(t))LD.profiles[e]=t[e]}};const MM={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function pUe(){const t=!!ne("esri-mobile"),e=!!ne("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+MM.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!ne("disable-feature:reduce-map-tile-levels")},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600+MM.GalaxyS20:750+MM.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!ne("disable-feature:reduce-map-tile-levels")},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900+MM.SurfacePro7:1500+MM.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}(function(t){t.profiles=pUe()})(LD||(LD={}));const C8=LD,fUe=new De([0,255,255]),mUe=1,gUe=.25,yUe=new De([0,0,0]),_Ue=.4,vUe=.2;let pg=class extends Pe{constructor(){super(...arguments),this.color=fUe.clone(),this.haloColor=null,this.haloOpacity=mUe,this.fillOpacity=gUe,this.shadowOpacity=_Ue,this.shadowColor=yUe.clone(),this.shadowDifference=vUe}};d([m({type:De})],pg.prototype,"color",void 0),d([m({type:De})],pg.prototype,"haloColor",void 0),d([m()],pg.prototype,"haloOpacity",void 0),d([m()],pg.prototype,"fillOpacity",void 0),d([m()],pg.prototype,"shadowOpacity",void 0),d([m({type:De})],pg.prototype,"shadowColor",void 0),d([m()],pg.prototype,"shadowDifference",void 0),pg=d([F("esri.views.3d.support.HighlightOptions")],pg);const bUe=pg;function z$t(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function D_(t){return typeof t=="string"?xs(t):ae(t)}function V$t(t,e,r){const i={};for(const n in t){if(n==="declaredClass")continue;const s=t[n];if(s!=null&&typeof s!="function")if(Array.isArray(s))i[n]=s.map(o=>V$t({item:o},e,r).item);else if(typeof s=="object")if(s.toJSON){const o=s.toJSON(r==null?void 0:r[n]);i[n]=e?o:JSON.stringify(o)}else i[n]=e?s:JSON.stringify(s);else i[n]=s}return i}function B$t(t){return{geometryType:BA(t[0]),geometries:t.map(e=>e.toJSON())}}function wUe(t,e,r){const i=YJe(e);return t.map(n=>{const s=i.fromJSON(n);return s.spatialReference=r,s})}let tS=class extends Se{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(n=>n.toJSON()),r=this.geometries[0],i={};return i.outSR=AP(this.outSpatialReference),i.inSR=AP(r.spatialReference),i.geometries=JSON.stringify({geometryType:BA(r),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};d([m()],tS.prototype,"geometries",void 0),d([m({json:{read:{source:"outSR"}}})],tS.prototype,"outSpatialReference",void 0),d([m()],tS.prototype,"transformation",void 0),d([m()],tS.prototype,"transformForward",void 0),tS=d([F("esri.rest.support.ProjectParameters")],tS);const fce=tS,G$t=to(fce);async function xUe(t,e,r){e=G$t(e);const i=D_(t),n={...i.query,f:"json",...e.toJSON()},s=e.outSpatialReference,o=BA(e.geometries[0]),a=z$t(n,r);return Vt(i.path+"/project",a).then(({data:{geometries:l}})=>wUe(l,o,s))}async function mce(t=null,e){var n,s;if(ai.geometryServiceUrl)return ai.geometryServiceUrl;if(!t)throw new B("internal:geometry-service-url-not-configured");let r;r="portal"in t?t.portal||Ho.getDefault():t,await r.load({signal:e});const i=(s=(n=r.helperServices)==null?void 0:n.geometry)==null?void 0:s.url;if(!i)throw new B("internal:geometry-service-url-not-configured");return i}async function j$t(t,e,r=null,i){const n=await mce(r,i),s=new fce;s.geometries=[t],s.outSpatialReference=e;const o=await xUe(n,s,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new B("internal:geometry-service-projection-failed")}const H$t=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:mce,projectGeometry:j$t},Symbol.toStringTag,{value:"Module"}));let q$t=class{constructor(e,r){this.spatialReference=r,this.unitInMeters=fl(this.spatialReference,zr(this.spatialReference).metersPerDegree);const i=e&&"portalItem"in e?e.portalItem:void 0;this._geometryServiceURLPromise=mce(i).catch(()=>{throw new B("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const r=await this._geometryServiceURLPromise;let i,n=!0;Array.isArray(e[0])&&typeof e[0]!="number"?i=e:(i=[e],n=!1);const s=i.map(l=>l instanceof He?l:new He(l,this.spatialReference)),o=new fce({geometries:s,outSpatialReference:Ve.WGS84}),a=(await xUe(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return n?a:a[0]}};var Zt;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(Zt||(Zt={}));const rS=[Zt.ELEVATION,Zt.MAP];async function W$t(t,e){if(t.type==="2d")return t.hitTest(e);const r=await t.hitTest(e);if(r.results.length===0)return r;const i=r.results[0],n=(i.distance??0)*(1+Y$t),s=r.results.findIndex(o=>(o.distance??0)>n);return s!==-1&&(r.results=r.results.slice(0,s)),i&&r.ground.distance>n&&(r.ground.mapPoint=null),r}const Y$t=.05;async function X$t(t,e){var p,f,g,y,v;const{results:r,ground:i}=await W$t(t,e),n=(!i.layer||!BL(i.layer.type))&&i.mapPoint,s=[],o=Q$t(t),a=n?Z$t(t,o):J$t;let l=0,c=0;const u=()=>{const b=a.layerViews[c];n&&b&&"fetchPopupFeaturesAtLocation"in b&&s.push({mapPoint:i.mapPoint,layerView:b}),++c};let h=null;for(;l<r.length||c<a.layerViews.length;){const b=r[l];if(b&&b.type!=="graphic")++l;else if(((p=b==null?void 0:b.layer)==null?void 0:p.type)!=="scene"||((f=b==null?void 0:b.layer)==null?void 0:f.parent)!==((g=t==null?void 0:t.map)==null?void 0:g.basemap))if(b){const w=(y=b.layer)==null?void 0:y.uid,x=a.layerUids.has(w)&&b.distance===i.distance,S=o.get((v=b.layer)==null?void 0:v.uid);if(h??(h=b.mapPoint),c<a.layerViews.length&&(x||(b.distance??0)>i.distance)&&a.layerViews[c]!==S){u();continue}s.push({graphic:b.graphic,layerView:S}),++l}else u();else++l}return h??(h=i.mapPoint),{hits:s,location:h}}function Z$t(t,e){const r=new Set,i=[];for(let s=t.basemapTerrain.numLayers(Zt.MAP)-1;s>=0;s--){const o=t.basemapTerrain.layerViewByIndex(s,Zt.MAP);r.add(o.layer.uid),i.push(o)}const n=t.basemapTerrain.overlayManager.renderer.layers;for(const{uid:s}of n){const o=e.get(s);o&&(r.add(s),i.push(o))}return i.reverse(),{layerUids:r,layerViews:i}}const J$t={layerUids:new Set,layerViews:[]};function Q$t(t){const e=new Map;for(const r of t.allLayerViews){const i=r.layer.uid;e.set(i,r)}return e}let yh=class extends Pe{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};d([m()],yh.prototype,"minTotalNumberOfFeatures",void 0),d([m()],yh.prototype,"maxTotalNumberOfFeatures",void 0),d([m()],yh.prototype,"maxNumberOfDrawCalls",void 0),d([m()],yh.prototype,"maxTotalNumberOfVertices",void 0),d([m()],yh.prototype,"snapshotAvailable",void 0),d([m()],yh.prototype,"polygonLodFactor",void 0),d([m()],yh.prototype,"polylineLodFactor",void 0),d([m()],yh.prototype,"skipHighSymbolLods",void 0),d([m()],yh.prototype,"uncompressedTextureDownsamplingEnabled",void 0),yh=d([F("esri.views.3d.support.QualitySettings.Graphics3DSettings")],yh);let jf=class extends Pe{constructor(){super(...arguments),this.lodFactor=1}};d([m()],jf.prototype,"lodFactor",void 0),jf=d([F("esri.views.3d.support.QualitySettings.LoDFactorSettings")],jf);let w0=class extends Pe{constructor(){super(...arguments),this.object=new jf,this.point=new jf,this.integratedMesh=new jf,this.pointCloud=new jf,this.uncompressedTextureDownsamplingEnabled=!1}};d([m({type:jf})],w0.prototype,"object",void 0),d([m({type:jf})],w0.prototype,"point",void 0),d([m({type:jf})],w0.prototype,"integratedMesh",void 0),d([m({type:jf})],w0.prototype,"pointCloud",void 0),d([m()],w0.prototype,"uncompressedTextureDownsamplingEnabled",void 0),w0=d([F("esri.views.3d.support.QualitySettings.SceneServiceSettings")],w0);let bv=class extends Pe{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.reduceTileLevelDifferences=!0}};d([m()],bv.prototype,"lodBias",void 0),d([m()],bv.prototype,"angledSplitBias",void 0),d([m()],bv.prototype,"vtlContentZoom",void 0),d([m()],bv.prototype,"reduceTileLevelDifferences",void 0),bv=d([F("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],bv);let w3=class extends Pe{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};d([m()],w3.prototype,"pixelRatio",void 0),d([m()],w3.prototype,"maxTotalNumberOfFeatures",void 0),w3=d([F("esri.views.3d.support.QualitySettings.HeatmapSettings")],w3);let Sa=class extends Pe{constructor(){super(...arguments),this.graphics3D=new yh,this.sceneService=new w0,this.tiledSurface=new bv,this.heatmap=new w3,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};d([m({type:yh})],Sa.prototype,"graphics3D",void 0),d([m({type:w0})],Sa.prototype,"sceneService",void 0),d([m({type:bv})],Sa.prototype,"tiledSurface",void 0),d([m({type:w3})],Sa.prototype,"heatmap",void 0),d([m()],Sa.prototype,"fadeDuration",void 0),d([m()],Sa.prototype,"antialiasingEnabled",void 0),d([m()],Sa.prototype,"physicallyBasedRenderingEnabled",void 0),d([m()],Sa.prototype,"highQualityTransparency",void 0),d([m()],Sa.prototype,"highResolutionAtmosphere",void 0),d([m()],Sa.prototype,"reflections",void 0),d([m()],Sa.prototype,"ambientOcclusion",void 0),d([m()],Sa.prototype,"memoryLimit",void 0),d([m()],Sa.prototype,"additionalCacheMemory",void 0),d([m()],Sa.prototype,"frameRate",void 0),d([m()],Sa.prototype,"maximumPixelRatio",void 0),Sa=d([F("esri.views.3d.support.QualitySettings.QualitySettings")],Sa);const fbe=Sa;let K$t=class Pte{constructor(e,r,i,n){this.viewingMode=e,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=n,this._tmpCoordinateSystem=Kst(n),this.referenceEllipsoid=zr(r),this.sphericalPCPF=Kl(r)}set extent(e){e&&eot(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return lot(this._coordinateSystem,e)}setAltitude(e,r,i=e){return VRe(this._coordinateSystem,i,r,e)}setAltitudeOfTransformation(e,r){cot(this._coordinateSystem,r,e,r)}worldUpAtPosition(e,r){return not(this._coordinateSystem,e,r)}worldBasisAtPosition(e,r,i){return sot(this._coordinateSystem,e,r,i)}basisMatrixAtPosition(e,r){const i=this.worldBasisAtPosition(e,wn.X,je.get()),n=this.worldBasisAtPosition(e,wn.Y,je.get()),s=this.worldBasisAtPosition(e,wn.Z,je.get());return _y(r,i[0],i[1],i[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1),r}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,je.get()),n=this.worldBasisAtPosition(e,wn.Y,je.get()),s=_Ae(r,n,i);return ul(s)}intersectManifoldClosestSilhouette(e,r,i){return nH(this._coordinateSystem,r,this._tmpCoordinateSystem),aot(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,r,i){nH(this._coordinateSystem,r,this._tmpCoordinateSystem);const n=je.get();return oot(this._tmpCoordinateSystem,e,n)?he(i,n):null}intersectInfiniteManifold(e,r,i){if(this.viewingMode===Fe.Global)return this.intersectManifold(e,r,i);nH(this._coordinateSystem,r,this._tmpCoordinateSystem);const n=this._tmpCoordinateSystem.value,s=je.get();return v2(n.plane,e,s)?he(i,s):null}toRenderCoords(e,r,i){return Kz(e)?Cn(e,r,this.spatialReference):ga(e,r,i,this.spatialReference)}fromRenderCoords(e,r,i=null){return Kz(r)?(i!=null&&(r.spatialReference=i),uy(e,this.spatialReference,r)?r:null):ga(e,this.spatialReference,r,i)?r:null}static create(e,r){switch(e){case Fe.Local:return new Pte(Fe.Local,r,fl(r),iot());case Fe.Global:return new Pte(Fe.Global,r,1,rot(r))}}static renderUnitScaleFactor(e,r){return TZ(e)/TZ(r)}};var Dg;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(Dg||(Dg={}));const eIt=(()=>{const t=new Array;return t[Dg.ELEVATION]=10,t[Dg.BASEMAP]=10,t[Dg.I3S_INDEX]=10,t[Dg.I3S_DATA]=10,t[Dg.SYMBOLOGY]=5,t})(),tIt=30;function rIt(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function iIt(t){return new Dl({view:t})}const mbe=.1,QF=1,IW=1,nIt=.75,sIt=.6,gbe=1.3;let Dl=class extends Pe{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new Ske,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(FT({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(QF),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,r){return new XSt(e,this._cacheStorage,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();this._memoryPredicted<sIt&&this._canFastRecover?(this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(QF)):e?(this._memoryPredicted>1.1*IW||this._usedMemory>IW)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>mbe&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/gbe),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1)):(this._downscaleMemoryUsed=0,this._usedMemory>IW?(this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/gbe),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(this._usedMemory<nIt&&this._quality<QF?(this._stableQuality=this._quality,e=this._updateQuality(this._quality+.05)):this._quality<1&&(this._canFastRecover=!0))),this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,mbe),QF))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var a,l,c,u,h;if(!this.view)return;(l=(a=this.view._stage)==null?void 0:a.renderer)==null||l.tick();const e=(u=(c=this.view._stage)==null?void 0:c.renderer)==null?void 0:u.usedMemory;let r=(((h=this.view.basemapTerrain)==null?void 0:h.usedMemory)??0)+(e?e.fbos+e.edges+e.plugins:0),i=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(p=>{if(rIt(p)){const f=p.ignoresMemoryFactor?this._quality:1;r+=p.usedMemory*f,i+=p.unloadedMemory*f}});const n=this._warnMemoryUsage==null||Math.round(10*r)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(r>s&&n){this._warnMemoryUsage=r;const p=g=>(g/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",f=Math.round(100*this._quality);K.getLogger(this).warn(`Memory Limit exceeded! Limit: ${p(s)} Current: ${p(r)} Projected: ${p(r+i)} Quality: ${f}%`)}this._usedMemory=r/s,this._memoryPredicted=(r+i)/s;const o=s-r;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=e._numQualityChanges;return e._numQualityChanges=0,r},disableMemCache:()=>e.disableMemCache()}}};d([m({constructOnly:!0})],Dl.prototype,"view",void 0),d([m()],Dl.prototype,"maxMemory",null),d([m()],Dl.prototype,"additionalCacheMemory",null),d([m({readOnly:!0})],Dl.prototype,"memoryFactor",null),d([m({readOnly:!0})],Dl.prototype,"updating",null),d([m({readOnly:!0})],Dl.prototype,"usedMemory",null),d([m({readOnly:!0})],Dl.prototype,"usedCacheMemory",null),d([m()],Dl.prototype,"_quality",void 0),d([m()],Dl.prototype,"_usedMemory",void 0),d([m()],Dl.prototype,"_updating",void 0),d([m()],Dl.prototype,"_stableQuality",void 0),d([m()],Dl.prototype,"_maxMemory",void 0),d([m()],Dl.prototype,"_additionalCacheMemory",void 0),Dl=d([F("esri.views.3d.support.MemoryController")],Dl);let oIt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},aIt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new lIt}},lIt=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},cIt=class{constructor(e,r,i,n){this._workerFunc=e,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=n.map(s=>new aIt(s))}destroy(){this._clients.length=0}hasQuota(e){const r=this._clients[e];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(e){const r=this._clients[e.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(i,n)=>this._taskCallback(i,n))):r.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const r=this._clients[e.client];this._totalNumWorkers--,r&&(r.numWorkers--,r.statistics.requests++,r.statistics.size+=e.size||0,r.statistics.duration+=e.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,_t(r.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,r){e._cancelled||(this._callbackFunc(e,r),this._taskFinished(e))}getStatsForType(e){const r=this._clients[e];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const e=this;return{set workerFunc(r){e._workerFunc=r}}}},P8=class extends Pe{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,r,i){this._loadQueue=new cIt((n,s)=>this._startLoading(n,s),(n,s)=>this._doneLoadingCB(n,s),e,r),i&&(this._frameTask=i.registerTask(Ct.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Pi(this._frameTask),this._tasks.forEach(e=>Ql(e.abortController)),this._loadQueue=Me(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,r,i,n={}){const s=ma();s.__signal=n!=null?n.signal:null;const o=this._createOrUpdateTask(e,r,i,n,s);return la(n,()=>this._cancelRequest(o,s)),s.promise}_createTask(e,r,i,n,s,o){const a=new pIt(e,r,i,n,s);return this._updateTask(a,o),this._tasks.set(s,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,r){var i;RL(e.resolvers,r),r.reject(gr()),e.resolvers.length===0&&(e.status===Ed.DOWNLOADING&&(e.status=Ed.CANCELLED,this._loadQueue.cancel(e),(i=e.abortController)==null||i.abort(),e.request=null,e.abortController=null),e.status=Ed.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,r){e.resolvers.push(r)}_createOrUpdateTask(e,r,i,n,s){const o=fIt((n==null?void 0:n.uid)||e,r,i),a=this._tasks.get(o);return a?(this._updateTask(a,s),a):this._createTask(e,n,r,i,o,s)}_doneLoadingCB(e,r){this._loadQueue&&(_t(e.status===Ed.DOWNLOADING),e.status=Ed.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:r}):this._doneLoading(e,r))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const r=this._onLoadQueue.shift();dt(r.task.abortController),r.task.abortController=null,r.callback(r.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const r=this._doneQueue.shift();r.task.status!==Ed.DOWNLOADED&&(r.err=r.err||gr()),this._doneLoading(r.task,r.err),e.madeProgress()}}_doneLoading(e,r){if(r&&!on(r)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const n of e.resolvers)if(r)on(r)?n.reject(r):n.reject(new B("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${r}`,{url:e.url,error:r}));else{--i;const s=i>0?ae(e.result):e.result;n.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,r){if(e.status===Ed.CANCELLED)return!1;let i,n;switch(e.startTime=performance.now(),e.status=Ed.DOWNLOADING,e.docType){case"binary":n="array-buffer",i=0;break;case"image":n="image";break;case"image+type":n="array-buffer";break;default:n="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=Vt(e.url,{...e.options,responseType:n,timeout:i,signal:s});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:r,task:e}):(e.abortController=null,r(e))},l=c=>{e.status===Ed.DOWNLOADING&&r(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const u=c.data,h=hIt(u);if(n="image",e.size=u.byteLength,h==="unknown")return e.request=Vt(e.url,{responseType:n,timeout:i,signal:s}),void e.request.then(g=>a(g.data),l);const p=new Blob([u],{type:h}),f=window.URL.createObjectURL(p);o=()=>window.URL.revokeObjectURL(f),e.request=Vt(f,{responseType:n,timeout:i,signal:s}),e.request.then(g=>a(new gce(g.data,h,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};d([m({readOnly:!0})],P8.prototype,"updating",void 0),P8=d([F("esri.views.3d.support.StreamDataLoader")],P8);const uIt={numRetries:0};function hIt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let gce=class{constructor(e,r,i){this.image=e,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}};function dIt(t){return"image"in t&&"type"in t}let pIt=class extends oIt{constructor(e,r,i,n,s){super(n),this.url=e,this.options=r,this.docType=i,this.key=s,this.result=null,this.status=Ed.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=uIt.numRetries}};function fIt(t,e,r){return`${t}:${e}:${r}`}var Ed;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Ed||(Ed={}));let A8=class extends Pe{constructor(){super(...arguments),this.updating=!1}};function mIt(t){return new rf({view:t})}d([m({readOnly:!0})],A8.prototype,"updating",void 0),A8=d([F("esri.views.3d.support.ResourceControllerMain")],A8);let rf=class extends A8{constructor(){super(...arguments),this._immediateTask=uA,this._normalTask=uA,this._updatingObjects=Zg([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=Gft(),this._memoryController=iIt(this.view),this._streamDataLoader=new P8,this._streamDataLoader.setup(tIt,eIt,this._scheduler),this.addHandles([pe(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},ei),pe(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=FT({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(Ct.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(Ct.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Pi(this._frameTask),this._streamDataLoader=Me(this._streamDataLoader),this._memoryController=Me(this._memoryController),this._scheduler=Me(this._scheduler),this.view=null}get updating(){var e,r,i,n;return!!((e=this._memoryController)!=null&&e.updating||(r=this._streamDataLoader)!=null&&r.updating||(i=this._immediateTask)!=null&&i.updating)||((n=this._updatingObjects)==null?void 0:n.value.some(s=>s.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const r=this._streamDataLoader;return{request:(i,n,s)=>r.request(i,n,e,s),get busy(){return!r.hasDownloadSlots(e)}}}addUpdatingObject(e){const r=this._updatingObjects;return r.value=[...r.value,e],ri(()=>{r.value=r.value.filter(i=>i!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(mne(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};d([m()],rf.prototype,"view",void 0),d([m()],rf.prototype,"_scheduler",void 0),d([m()],rf.prototype,"_memoryController",void 0),d([m()],rf.prototype,"_streamDataLoader",void 0),d([m()],rf.prototype,"_immediateTask",void 0),d([m()],rf.prototype,"_normalTask",void 0),d([m()],rf.prototype,"_updatingObjects",void 0),d([m({readOnly:!0})],rf.prototype,"updating",null),rf=d([F("esri.views.3d.support.ResourceControllerImpl")],rf);var oV;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(oV||(oV={}));let Sar=class{constructor(e,r=0,i=0,n=0,s=0,o=null){this.usedMemory=e,this.displayedFeatures=r,this.totalFeatures=i,this.maximumFeatures=n,this.nodes=s,this.core=o}};function gIt(t){return"performanceInfo"in t}let yIt=class{constructor(e){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer;const r=e.performanceInfo;this.memory=r.usedMemory,this.displayedNumberOfFeatures=r.displayedFeatures,this.maximumNumberOfFeatures=r.maximumFeatures,this.totalNumberOfFeatures=r.totalFeatures}},_It=class{constructor(e){var r;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const i=e.resourceController.memoryController;this.totalMemory=(i.maxMemory??0)*oV.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=i.usedCacheMemory}this.terrainMemory=((r=e.basemapTerrain)==null?void 0:r.usedMemory)??0,this.edgesMemory=e._stage.renderer.usedMemory.edges??0,this.fboMemory=e._stage.renderer.usedMemory.fbos??0,e.allLayerViews.items.forEach(i=>{gIt(i)&&this.layerPerformanceInfos.push(new yIt(i))}),this.layerPerformanceInfos.sort((i,n)=>n.memory-i.memory)}},vIt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,r,i){const n=i?`gltfPBR:${e}`:`gltf:${e}`,s=this._gltfMemCache.get(n);return s!=null?Promise.resolve(s):this._loadOnce(this._gltfLoading,this._gltfMemCache,n,o=>o8e(new n8e(o.streamDataRequester),e,o,i),r)}loadWOSR(e,r){const i=`wosr:${e}:${r.disableTextures}`,n=this._wosrMemCache.get(i);return n!=null?Promise.resolve(n):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,s=>a8e(e,s),r)}async _loadOnce(e,r,i,n,s){dt(s);const o=la(s,()=>this._abortLoad(e,i));let a=e.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:n({...s,signal:l.signal})},e.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),e.delete(i),dt(s),l}finally{Pi(o)}}_abortLoad(e,r){const i=e.get(r);i!=null&&--i.refCount>0||(e.delete(r),i!=null&&i.abortController.abort())}},x3=class extends Pe{constructor(e,r){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r==null?void 0:r.registerTask(Ct.TEXTURE_UNLOAD))??uA}normalizeCtorArgs(){return{}}destroy(){var e,r,i;super.destroy(),(e=this._frameTask)==null||e.remove(),(r=this._textureRequests)==null||r.forEach(n=>this._releaseTextureRequest(n)),(i=this._textureRequests)==null||i.clear()}get updating(){return this._frameTask.updating}fromData(e,r){const i=this.makeUid(e);let n=this._textureRequests.get(i);if(!n){const s=new TUe;s.texture=r(),this._stage&&(s.texture.load(this._stage.renderView.renderingContext),this._stage.add(s.texture)),this._textureRequests.set(i,s),n=s}return n.referenceCount++,new SUe(i,n.texture,()=>this._release(i))}_release(e){const r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){var i;if(!this._textureRequests)return;const r=this._textureRequests.get(e);!r||r.referenceCount>0||((i=r.texture)==null||i.unload(),this._releaseTextureRequest(r),this._textureRequests.delete(e))}_releaseTextureRequest(e){var r;e.texture?(r=this._stage)==null||r.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,r=null){return r!=null?`${e}.${r}px`:e}};d([m()],x3.prototype,"_frameTask",void 0),d([m()],x3.prototype,"updating",null),x3=d([F("esri.views.3d.support.TextureCollection")],x3);let SUe=class{constructor(e,r,i){this.uid=e,this.texture=r,this.release=i}},TUe=class{constructor(){this.referenceCount=0}},bIt=class extends x3{constructor(e,r,i){super(r,i),this._streamDataRequester=e}async fromUrl(e,r,i){dt(i);const n=i==null?void 0:i.signal,s=this.makeUid(e,r);let o=this._textureRequests.get(s);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:s,signal:a.signal});o=new TUe,o.abortController=a;const c=o;this._textureRequests.set(s,o),o.textureAsync=l.then(async u=>{const h=this._createTexture(e,u,r);return c.texture=h,c.abortController=null,await h.load(this._stage.renderView.renderingContext),this._stage.add(h),new SUe(s,h,()=>this._release(s))},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await ff(o.textureAsync,n)}catch(a){throw this._release(s),a}}_createTexture(e,r,i){var s;const n={width:r.width,height:r.height,wrap:{s:nr.CLAMP_TO_EDGE,t:nr.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(HCe(e)){if(i||r.width===0&&r.height===0){const o=r.width?r.height/r.width:1;i=i||64,o>1?(r.width=Math.round(i/o),r.height=i):(r.width=i,r.height=Math.round(i*o))}(s=this._stage.renderView)!=null&&s.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return new Zb(r,n)}},wIt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(Dg.SYMBOLOGY),this.objectResourceCache=new vIt((i,n)=>e.resourceController.memoryController.newCache(i,n)),this.textures=new bIt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const r=zr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=o4e(e.viewingMode,r),this.screenSizePerspectiveSettingsLabels=L_t(e.viewingMode,r)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return ri();this._graphicsOwners.push(e);const r=pe(()=>{var i;return(i=e.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),ri(()=>{r.remove(),RL(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new iw;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([pe(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,ei),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Me(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;KF.distance=e.centerOnSurfaceInfrequent.distance,KF.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(KF),this.screenSizePerspectiveSettingsLabels.update(KF),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const KF={distance:0,fovY:0};let TC=class{constructor(e,r,i=""){this.graphics=e,this._symbol=new Gv({symbolLayers:new St([new Bv({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new A2({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})])})}show(e,r){if(r==null)return;this.hide();const i=new He({x:e[0],y:e[1],z:e[2],spatialReference:r});this._graphic=new Hu({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},Mv=class extends Pe{constructor(e){super(e)}};d([m({constructOnly:!0})],Mv.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],Mv.prototype,"surface",void 0),d([m({constructOnly:!0})],Mv.prototype,"state",void 0),Mv=d([F("esri.views.3d.support.PointOfInterest")],Mv);const xIt=Array;let nf=class extends Mv{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new f_({location:He,renderLocation:xIt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=C(),this._tmpPoint=new He}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(jo(()=>{var r,i;return(i=(r=this.map)==null?void 0:r.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Me(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){const e=this._camera,r=Bi(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return e2(i,r,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){var n;if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!((n=this.map)!=null&&n.ground))return this._updateSurfaceAltitude(0),pa;const e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const r=(this._tmpPoint.z??0)>SIt&&this.renderCoordsHelper.viewingMode===Fe.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:r?TIt:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{on(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,pa}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(LW,this._estimatedSurfaceAltitude,this._camera.eye),aa(this._get("renderLocation"),LW)||(this._set("renderLocation",he(this._propertiesPool.get("renderLocation"),LW)),this.notifyChange("renderLocation"))}};d([m({constructOnly:!0})],nf.prototype,"scheduler",void 0),d([m({constructOnly:!0})],nf.prototype,"cache",void 0),d([m({constructOnly:!0})],nf.prototype,"task",void 0),d([m()],nf.prototype,"location",null),d([m({constructOnly:!0})],nf.prototype,"map",void 0),d([m()],nf.prototype,"renderLocation",void 0),d([m()],nf.prototype,"scale",null),d([m()],nf.prototype,"updating",null),nf=d([F("esri.views.3d.support.CameraOnSurface")],nf);const LW=C(),SIt=1e5,TIt=1e6,EIt=Array;let Cd=class extends Mv{constructor(e){super(e),this._propertiesPool=new f_({location:He,renderLocation:EIt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=C(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Pi(this._frameWorker),this._propertiesPool=Me(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,pa}_updateRenderLocation(){const e=PIt;let r=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!r&&i&&(r=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),r&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const n=AIt;r&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,n)&&(he(e,n),this._currentSurfaceAltitude=this._latestSurfaceAltitude),r?this.distance=Bi(this._camera.eye,e):(oe(e,this._camera.viewForward,this._get("distance")),ge(e,e,this._camera.eye)),aa(this._get("renderLocation"),e)||this._set("renderLocation",he(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,r){var n,s;const i=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(i.ray,e,r))return!1;if(this.state.isGlobal){const o=zr(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=nl(i.eye),c=l<a*a,u=Bi(i.eye,r);if(c&&u>o/4){const h=a-Math.sqrt(l);return oe(r,i.viewForward,h),ge(r,r,i.eye),!0}}else{const o=(n=this.surface)!=null&&n.ready?this.surface.extent:null;o!=null&&v7(o,(s=this.surface)==null?void 0:s.spatialReference,RM,this.renderCoordsHelper.spatialReference)&&(r[0]=we(r[0],RM[0],RM[2]),r[1]=we(r[1],RM[1],RM[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,r){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,r)){if(Si.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,n=Bi(i,e),s=Bi(i,r);if(Math.abs(s-n)/n>CIt)return!0}return!1}};d([m({constructOnly:!0})],Cd.prototype,"scheduler",void 0),d([m({constructOnly:!0})],Cd.prototype,"task",void 0),d([m()],Cd.prototype,"distance",void 0),d([m({constructOnly:!0})],Cd.prototype,"estimateSurfaceAltitudeAtCenter",void 0),d([m({readOnly:!0})],Cd.prototype,"location",null),d([m({readOnly:!0})],Cd.prototype,"renderLocation",void 0),d([m()],Cd.prototype,"updating",void 0),Cd=d([F("esri.views.3d.support.CenterOnSurface")],Cd);const CIt=.05,PIt=C(),AIt=C(),RM=Ht();let OIt=class{constructor(e){this._handles=new iw,this.events=new Xn,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Me(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),e.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",MIt)}};const MIt={},RIt=Array;let sf=class extends Mv{constructor(e){super(e),this._propertiesPool=new f_({location:He,renderLocation:RIt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([pe(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),pe(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(Ct.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Me(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){const{camera:e,contentPixelRatio:r}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/r)}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,n=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(r,ybe);const s=Math.max(0,(Math.acos(fe(ybe,n.viewForward))-.5*Math.PI)*(n.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!HT(e,r)){const c=this._propertiesPool.get("renderLocation");he(c,r),this._set("renderLocation",c)}return pa}const o=1-we(s/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(_be);const l=this._propertiesPool.get("renderLocation");return pi(l,r,_be,a),e&&HT(e,l)||this._set("renderLocation",l),pa}_calculateScreenHorizontalEdgeOnSurface(e){const r=this.state.contentCamera,i=r.getRenderCenter(Na());if(i[1]=r.aboveGround?r.padding[or.BOTTOM]:r.fullHeight-r.padding[or.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const n=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(r.unprojectFromRenderScreen(i,$M)){_e($M,$M,r.eye);const s=me($M,$M);if(this.renderCoordsHelper.intersectInfiniteManifold(Wh(r.eye,s),n,e))return e}return this.renderCoordsHelper.setAltitude(e,n,r.eye)}updateRenderLocation(){this._dirty=!0}};d([m()],sf.prototype,"_dirty",void 0),d([m({constructOnly:!0})],sf.prototype,"scheduler",void 0),d([m({constructOnly:!0})],sf.prototype,"centerOnSurface",void 0),d([m({constructOnly:!0})],sf.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),d([m()],sf.prototype,"updating",null),d([m()],sf.prototype,"location",null),d([m()],sf.prototype,"renderLocation",void 0),d([m()],sf.prototype,"worldUnitsPerContentPixel",null),sf=d([F("esri.views.3d.support.pointsOfInterest.Focus")],sf);const ybe=C(),$M=C(),_be=C();let a0=class extends Pe{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=C();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([pe(()=>{var e,r;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(r=this.surfaceView)==null?void 0:r.extent]},()=>this._update()),jo(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}_update(){var i;if(this._updateController&&(this._updateController.abort(),this._updateController=null),((i=this.surfaceView)==null?void 0:i.extent)==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=tse(this.surfaceView.extent),r=new He({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(n=>{this._updateController=null,this._set("location",n.geometry)}).catch(n=>{on(n)||n&&n.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",n)})):this._set("location",r)}};d([m({constructOnly:!0})],a0.prototype,"view",void 0),d([m({constructOnly:!0})],a0.prototype,"cache",void 0),d([m()],a0.prototype,"surface",null),d([m()],a0.prototype,"surfaceView",null),d([m({readOnly:!0})],a0.prototype,"location",void 0),d([m({readOnly:!0})],a0.prototype,"renderLocation",null),a0=d([F("esri.views.3d.terrain.StableSurfaceCenter")],a0);let l0=class extends Pe{constructor(e){super(e),this._tileGeometryUpdateExtent=kc(),this._tileGeometryUpdateSpatialReference=null,this.events=new Xn,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(Ct.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",$It),kc(this._tileGeometryUpdateExtent),this._set("updating",!1)),pa}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,ab(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const i=this.centerOnSurfaces[r];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,r){const i=this.state.contentCamera.eye,n=IIt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,sx,r),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,ox,r),sx[0]<ox[0]?(n[0]=sx[0],n[2]=ox[0]):(n[0]=ox[0],n[2]=sx[0]),sx[1]<ox[1]?(n[1]=sx[1],n[3]=ox[1]):(n[1]=ox[1],n[3]=sx[1]),lN(n,e)}};d([m({constructOnly:!0})],l0.prototype,"state",void 0),d([m({constructOnly:!0})],l0.prototype,"centerOnSurfaces",void 0),d([m({constructOnly:!0})],l0.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],l0.prototype,"scheduler",void 0),d([m({constructOnly:!0})],l0.prototype,"surface",void 0),d([m({readOnly:!0})],l0.prototype,"updating",void 0),l0=d([F("esri.views.3d.support.SurfaceGeometryUpdates")],l0);const $It={},sx=C(),ox=C(),IIt=kc();let wc=class extends Pe{constructor(e){super(e),this.renderPointOfView=C(),this._pois=new Array,this._debugCenters=new Map,this._tmpRay=fo(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new f_({renderPointOfView:LIt},this)}initialize(){var u;const{state:e,basemapTerrain:r,renderCoordsHelper:i,map:n}=this.view;this._surfaceIntersector=pp(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=ha.MIN,this._contentIntersector=pp(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(u=this.view.basemapTerrain)==null?void 0:u.elevationQueryCache,l={state:e,scheduler:o,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new Cd({...l,task:Ct.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new Cd({...l,task:Ct.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new Cd({...l,task:Ct.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new nf({...l,cache:a,task:Ct.POINT_OF_INTEREST_INFREQUENT,map:n})),this._set("surfaceGeometryUpdates",new l0({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new OIt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new a0({cache:a,view:this.view})),this._set("focus",new sf({state:e,scheduler:o,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new TC(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new TC(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new TC(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new TC(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new TC(c,"green","Focus")),this.addHandles([pe(()=>e.contentCamera,h=>this._cameraChanged(h),ei),pe(()=>r.extent,()=>this._updateCenterPointsOfInterest()),up(()=>!r.updating,()=>this._updateCenterPointsOfInterest(),ei),jo(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),jo(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),up(()=>Si.SHOW_POI,h=>this._setDebug(h),mi)]),this._cameraChanged(this.view.state.contentCamera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(r=>r.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,$E,NIt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude($E):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const r=e.origin,i=ge($E,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,r,i),this._surfaceIntersector.results.min.getIntersectionPoint($E)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude($E)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,r,i){const n=Dae(r,e,DIt);if(n==null)return null;const s=n.origin,o=ge($E,n.origin,n.direction);return this._surfaceIntersector.resetWithRay(n,r),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,o),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const r=e.eye;aa(this.renderPointOfView,r)||this._set("renderPointOfView",he(this._propertiesPool.get("renderPointOfView"),r))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(r=>r.hide()),void this.removeHandles("debug");for(const r of this._pois)this.addHandles(pe(()=>r.renderLocation,i=>{var n;return(n=this._debugCenters.get(r))==null?void 0:n.show(i,r.renderCoordsHelper.spatialReference)},mi),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};d([m()],wc.prototype,"centerOnContent",void 0),d([m()],wc.prototype,"centerOnSurfaceFrequent",void 0),d([m()],wc.prototype,"centerOnSurfaceInfrequent",void 0),d([m()],wc.prototype,"cameraOnSurface",void 0),d([m()],wc.prototype,"focus",void 0),d([m()],wc.prototype,"renderPointOfView",void 0),d([m()],wc.prototype,"surfaceOrigin",void 0),d([m()],wc.prototype,"contentGeometryUpdates",void 0),d([m()],wc.prototype,"surfaceGeometryUpdates",void 0),d([m({constructOnly:!0})],wc.prototype,"view",void 0),d([m()],wc.prototype,"updating",null),wc=d([F("esri.views.3d.support.PointsOfInterest")],wc);const LIt=Array,$E=C(),DIt=fo(),NIt={exclude:new Set([kb])},gp=(t=>t)(["operational-layers","basemap","ground"]),qv=new St,tL=new WeakMap;function FIt(t){UIt(t)&&qv.push(new WeakRef(t))}function kIt(t){const e=qv.find(r=>r.deref()===t);e&&qv.remove(e)}function UIt(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function EUe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:EUe(e,t%e):0}let DW=0,ek=0;function zIt(){const t=Date.now();let e=!1;for(const r of qv){const i=r.deref();i?i.refreshInterval&&t-(tL.get(i)??0)+5>=6e4*i.refreshInterval&&(tL.set(i,t),i.refresh(t)):e=!0}if(e)for(let r=qv.length-1;r>=0;r--)qv.at(r).deref()||qv.removeAt(r)}hCe(()=>{const t=Date.now();let e=0;for(const r of qv){const i=r.deref();i&&(e=EUe(Math.round(6e4*i.refreshInterval),e),i.refreshInterval?tL.get(i)||tL.set(i,t):tL.delete(i))}if(e!==ek){if(ek=e,clearInterval(DW),ek===0)return void(DW=0);DW=setInterval(zIt,ek)}});function VIt(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const vbe=.1,BIt=t=>{let e=class extends t{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=fne(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||FIt(this)},()=>{})}destroy(){kIt(this)}castRefreshInterval(r){return r>=vbe?r:r<=0?0:vbe}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){IL(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{K.getLogger(this).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}get test(){const r=this;return{set refreshInterval(i){r._set("refreshInterval",i)}}}};return d([m({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:gp}}}}})],e.prototype,"refreshInterval",void 0),d([Dr("refreshInterval")],e.prototype,"castRefreshInterval",null),d([m({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),d([m({readOnly:!0})],e.prototype,"refreshParameters",null),e=d([F("esri.layers.mixins.RefreshableLayer")],e),e};let GIt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,r){this._store.put(e,r,r.values.byteLength+256)}},jIt=class{constructor(e,r,i,n){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=r,this.height=i,this.noDataValue=n)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:r}=this;let i=1/0,n=-1/0,s=!0;for(const o of r)o===e?this._hasNoDataValues=!0:(i=o<i?o:i,n=o>n?o:n,s=!1);s?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=n>-3e38?n:0)}},CUe=class{constructor(e,r,i,n,s={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=_st(e,{...s,schedule:n}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>K.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,r){const i={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),ri(()=>{i.removed=!0,sne(this._listeners,i),this._thread&&i.threadHandle!=null&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,r){return this.invokeMethod(this._mainMethod,e,r)}invokeMethod(e,r,i){if(this._thread){const n=this._transferLists[e],s=n?n(r):[];return this._thread.invoke(e,r,{transferList:s,signal:i})}return this._promise?this._promise.then(()=>(dt(i),this.invokeMethod(e,r,i))):Promise.reject(null)}broadcast(e,r){return this._thread?Promise.all(this._thread.broadcast(r,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,r)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(r=>{e.removed||(e.threadHandle=r)})}},bbe=class extends CUe{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(rL.forEach((e,r)=>{e===this&&rL.delete(r)}),this.destroy())}};const rL=new Map;function HIt(t=null){let e=rL.get(t);return e||(t!=null?(e=new bbe(r=>t.immediate.schedule(r)),rL.set(t,e)):(e=new bbe,rL.set(null,e))),++e.ref,e}function ey(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function qIt(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function WIt(t,e,r,i,n,s,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=n,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c}function YIt(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:qIt,create:ey,createView:YIt,fromValues:WIt},Symbol.toStringTag,{value:"Module"}));var gu,wbe,xbe;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(gu||(gu={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(wbe||(wbe={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(xbe||(xbe={}));let __=class iS{static getId(e,r,i,n){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${r}/${i}/${n}`}constructor(e,r,i,n){this.set(e,r,i,n)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|e<<8|i}acquire(e,r,i,n){this.set(e,r,i,n)}contains(e){const r=e.level-this.level;return r>=0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}containsChild(e){const r=e.level-this.level;return r>0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new iS(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,r,i,n){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[s,o,a,l]=e.split("/");this.level=parseFloat(s),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+r,this.col=+i,this.world=+n||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new iS(this.level-1,this.row>>1,this.col>>1,this.world)}getNeighborId(e,r){return`${this.level}/${this.row+r}/${this.col+e}/${this.world}`}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,n=this.world;return[new iS(e,r,i,n),new iS(e,r,i+1,n),new iS(e,r+1,i,n),new iS(e,r+1,i+1,n)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};__.pool=new fa(__,null,null,25,50);function S1(t,e){return[t,e]}function ax(t,e,r){return t[0]=e,t[1]=r,t}function XIt(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}const Up=new __("0/0/0/0");let ZIt=class PUe{static create(e,r,i=null){const n=Qf(e.spatialReference),s=r.origin||S1(e.origin.x,e.origin.y),o=S1(e.size[0]*r.resolution,e.size[1]*r.resolution),a=S1(-1/0,-1/0),l=S1(1/0,1/0),c=S1(1/0,1/0);i!=null&&(ax(a,Math.max(0,Math.floor((i.xmin-s[0])/o[0])),Math.max(0,Math.floor((s[1]-i.ymax)/o[1]))),ax(l,Math.max(0,Math.floor((i.xmax-s[0])/o[0])),Math.max(0,Math.floor((s[1]-i.ymin)/o[1]))),ax(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:u,rows:h}=r;let p,f,g,y;return!i&&u&&h&&(ax(a,u[0],h[0]),ax(l,u[1],h[1]),ax(c,u[1]-u[0]+1,h[1]-h[0]+1)),e.isWrappable?(p=S1(Math.ceil(Math.round((n.valid[1]-n.valid[0])/r.resolution)/e.size[0]),c[1]),f=S1(Math.floor((n.origin[0]-s[0])/o[0]),a[1]),g=S1(p[0]+f[0]-1,l[1]),y=!0):(f=a,g=l,p=c,y=!1),new PUe(r.level,r.resolution,r.scale,s,a,l,c,o,f,g,p,y)}constructor(e,r,i,n,s,o,a,l,c,u,h,p){this.level=e,this.resolution=r,this.scale=i,this.origin=n,this.first=s,this.last=o,this.size=a,this.norm=l,this.worldStart=c,this.worldEnd=u,this.worldSize=h,this.wrap=p}normalizeCol(e){if(!this.wrap)return e;const r=this.worldSize[0];return e<0?r-1-Math.abs((e+1)%r):e%r}denormalizeCol(e,r){return this.wrap?this.worldSize[0]*r+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,r,i=!1){Up.set(r);const n=i?Up.col:this.denormalizeCol(Up.col,Up.world),s=Up.row;return XIt(e,this.getXForColumn(n),this.getYForRow(s+1),this.getXForColumn(n+1),this.getYForRow(s)),e}getTileCoords(e,r,i=!1){Up.set(r);const n=i?Up.col:this.denormalizeCol(Up.col,Up.world);return Array.isArray(e)?ax(e,this.getXForColumn(n),this.getYForRow(Up.row)):(e.x=this.getXForColumn(n),e.y=this.getYForRow(Up.row)),e}},Ate=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:r,colFrom:i,colTo:n}of this.spans)for(let s=i;s<=n;s++){const o=e.getWorldForColumn(s);yield new __(e.level,r,e.normalizeCol(s),o)}}forEach(e,r){const{spans:i,lodInfo:n}=this,{level:s}=n;if(i.length!==0)for(const{row:o,colFrom:a,colTo:l}of i)for(let c=a;c<=l;c++)e.call(r,s,o,n.normalizeCol(c),n.getWorldForColumn(c))}};Ate.pool=new fa(Ate);let NW=class{constructor(e,r,i){this.row=e,this.colFrom=r,this.colTo=i}};const Zn=new __("0/0/0/0");let JIt=class AUe{static create(e,r){e[1]>r[1]&&([e,r]=[r,e]);const[i,n]=e,[s,o]=r,a=s-i,l=o-n,c=l!==0?a/l:0,u=(Math.ceil(n)-n)*c,h=(Math.floor(n)-n)*c;return new AUe(i,Math.floor(n),Math.ceil(o),c,a<0?u:h,a<0?h:u,a<0?s:i,a<0?i:s)}constructor(e,r,i,n,s,o,a,l){this.x=e,this.ymin=r,this.ymax=i,this.invM=n,this.leftAdjust=s,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const oh=[[0,0],[0,0],[0,0],[0,0]],QIt=1e-6;let Yar=class{constructor(e,r=null,i=e.lods[0].level,n=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=r,this.scales=[],this._infoByScale={},this._infoByLevel={};const s=e.lods.filter(a=>a.level>=i&&a.level<=n);this.minScale=s[0].scale,this.maxScale=s[s.length-1].scale;const o=this._lodInfos=s.map(a=>ZIt.create(e,a,r));s.forEach((a,l)=>{this._infoByLevel[a.level]=o[l],this._infoByScale[a.scale]=o[l],this.scales[l]=a.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,r,i=!1){Zn.set(r);const n=this._infoByLevel[Zn.level];return n?n.getTileBounds(e,Zn,i):e}getTileCoords(e,r,i=!1){Zn.set(r);const n=this._infoByLevel[Zn.level];return n?n.getTileCoords(e,Zn,i):e}getTileCoverage(e,r=192,i=!0,n="closest"){if(!i&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const s=n==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),o=Ate.pool.acquire(s),a=this._wrap;let l,c,u,h=1/0,p=-1/0;const f=o.spans;oh[0][0]=oh[0][1]=oh[1][1]=oh[3][0]=-r,oh[1][0]=oh[2][0]=e.size[0]+r,oh[2][1]=oh[3][1]=e.size[1]+r;for(const b of oh)e.toMap(b,b),b[0]=s.getColumnForX(b[0]),b[1]=s.getRowForY(b[1]);const g=[];let y=3;for(let b=0;b<4;b++){if(oh[b][1]===oh[y][1]){y=b;continue}const w=JIt.create(oh[b],oh[y]);h=Math.min(w.ymin,h),p=Math.max(w.ymax,p),g[w.ymin]===void 0&&(g[w.ymin]=[]),g[w.ymin].push(w),y=b}if(h==null||p==null||p-h>100)return null;let v=[];for(l=h;l<p;){g[l]!=null&&(v=v.concat(g[l])),c=1/0,u=-1/0;for(let b=v.length-1;b>=0;b--){const w=v[b];c=Math.min(c,w.getLeftCol()),u=Math.max(u,w.getRightCol())}if(c=Math.floor(c),u=Math.floor(u),l>=s.first[1]&&l<=s.last[1])if(a)if(s.size[0]<s.worldSize[0]){const b=Math.floor(u/s.worldSize[0]);for(let w=Math.floor(c/s.worldSize[0]);w<=b;w++)f.push(new NW(l,Math.max(s.getFirstColumnForWorld(w),c),Math.min(s.getLastColumnForWorld(w),u)))}else f.push(new NW(l,c,u));else c>s.last[0]||u<s.first[0]||(c=Math.max(c,s.first[0]),u=Math.min(u,s.last[0]),f.push(new NW(l,c,u)));l+=1;for(let b=v.length-1;b>=0;b--){const w=v[b];w.ymax>=l?w.incrRow():v.splice(b,1)}}return o}getTileParentId(e){Zn.set(e);const r=this._infoByLevel[Zn.level],i=this._lodInfos.indexOf(r)-1;return i<0?null:(this._getTileIdAtLOD(Zn,this._lodInfos[i],Zn),Zn.id)}getTileResolution(e){const r=this._infoByLevel[typeof e=="object"?e.level:e];return r?r.resolution:-1}getTileScale(e){const r=this._infoByLevel[e.level];return r?r.scale:-1}intersects(e,r){Zn.set(r);const i=this._infoByLevel[Zn.level],n=e.lodInfo;if(n.resolution>i.resolution){this._getTileIdAtLOD(Zn,n,Zn);const o=n.denormalizeCol(Zn.col,Zn.world);for(const a of e.spans)if(a.row===Zn.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(n.resolution<i.resolution){const[o,a,l,c]=e.spans.reduce((y,v)=>(y[0]=Math.min(y[0],v.row),y[1]=Math.max(y[1],v.row),y[2]=Math.min(y[2],v.colFrom),y[3]=Math.max(y[3],v.colTo),y),[1/0,-1/0,1/0,-1/0]),u=i.denormalizeCol(Zn.col,Zn.world),h=n.getColumnForX(i.getXForColumn(u)),p=n.getRowForY(i.getYForRow(Zn.row)),f=n.getColumnForX(i.getXForColumn(u+1))-1,g=n.getRowForY(i.getYForRow(Zn.row+1))-1;return!(h>c||f<l||p>a||g<o)}const s=n.denormalizeCol(Zn.col,Zn.world);return e.spans.some(o=>o.row===Zn.row&&o.colFrom<=s&&o.colTo>=s)}normalizeBounds(e,r,i){if(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],this._wrap){const n=Qf(this.tileInfo.spatialReference),s=-i*(n.valid[1]-n.valid[0]);e[0]+=s,e[2]+=s}return e}getSmallestInfoForScale(e){const r=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>r[0])return this._infoByScale[r[0]];for(let i=1;i<r.length-1;i++)if(e>r[i]+QIt)return this._infoByScale[r[i-1]];return this._infoByScale[r[r.length-1]]}getClosestInfoForScale(e){const r=this.scales;return this._infoByScale[e]||(e=r.reduce((i,n)=>Math.abs(n-e)<Math.abs(i-e)?n:i,r[0])),this._infoByScale[e]}scaleToLevel(e){const r=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let i=r.length-1;i>=0;i--)if(e<r[i])return i===r.length-1?this._infoByScale[r[r.length-1]].level:this._infoByScale[r[i]].level+(r[i]-e)/(r[i]-r[i+1]);return this._infoByScale[r[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,r,i){const n=this._infoByLevel[i.level];return e.set(i),r.resolution<n.resolution?null:(r.resolution===n.resolution||(e.level=r.level,e.col=Math.floor(i.col*n.resolution/r.resolution+.01),e.row=Math.floor(i.row*n.resolution/r.resolution+.01)),e)}},KIt=class{constructor(e,r){this.item=e,this.controller=r,this.promise=null}},eLt=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new q6,this._controllers=new q6,this._processingItems=new q6,this._pausedSignal=Zg(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new zz(e.peeker),this.process=e.process;const r=e.scheduler;e.priority&&r&&(this._task=r.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=Pi(this._schedule),this._task=Pi(this._task)}get updating(){var e;return!!((e=this._task)!=null&&e.updating)||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const r=this._controllers.get(e);r&&r.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(r=>e.push(r)),this._controllers.clear(),e.forEach(r=>r.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((r,i)=>e(i))}get(e){const r=this._deferreds.get(e);return r?r.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,r){const i=this.get(e);if(i)return i;const n=new AbortController;let s=null;r&&(s=la(r,()=>n.abort()));const o=()=>{const u=this._processingItems.get(e);u&&u.controller.abort(),a(),c.reject(gr())},a=()=>{l.remove(),s!=null&&s.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=iB(n.signal,o),c=ma();return this._deferreds.set(e,c),this._controllers.set(e,n),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){var r;const e=this._queue.popLast();return e&&((r=this._deferreds.get(e))==null||r.reject(gr("Removed from queue")),this._removeItem(e)),e}reset(){const e=[];this._processingItems.forEach(r=>e.push(r)),this._processingItems.clear();for(const r of e)this._queue.push(r.item),r.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=m2(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,r){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(r))}_processError(e,r){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(r))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let r;const i=new AbortController,n=new KIt(e,i);this._processingItems.set(e,n);try{r=this.process(e,i.signal)}catch(s){this._processError(n,s)}Xu(r)?(n.promise=r,r.then(s=>this._processResult(n,s),s=>this._processError(n,s))):this._processResult(n,r)}get test(){return{update:e=>this.runTask(e)}}};function tLt(t,e){return t.length=0,e.forEach(r=>t.push(r)),t}const FW=new Set,tk=[],IE=new Map,Sbe=[0,0];let lx=class extends Pe{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:r,strategy:i}=this;this._queue=new eLt({concurrency:e,process:(n,s)=>{const o=this._keyToItem.get(n);return r(o,{signal:s})},peeker:i==="scale-first"?n=>this._peekByScaleFirst(n):n=>this._peekByCenterFirst(n)})}destroy(){this.clear(),this._queue=Me(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(e){const r=typeof e=="string"?e:e.id;this._queue.abort(r)}clear(){this._queue.clear(),this._keyToItem.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const r=typeof e=="string"?e:e.id;return this.has(r)&&this._queue.isOngoing(r)}pause(){this._queue.pause()}push(e){const r=e.key.id;if(this._queue.has(r))return this._queue.get(r);const i=this._queue.push(r),n=()=>{this._keyToItem.delete(r)};return this._keyToItem.set(r,e),i.then(n,n),i}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const r=this.tileInfoView;let i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;e.forEach(u=>{const h=this._keyToItem.get(u),p=this.tileInfoView.getTileScale(h.key);IE.has(p)||(IE.set(p,[]),i=Math.max(p,i),n=Math.min(p,n)),IE.get(p).push(h.key),FW.add(p)});let s=this.state.scale;IE.has(s)||(tLt(tk,FW),tk.sort((u,h)=>u-h),s=tk.reduce((u,h)=>Math.abs(h-s)<Math.abs(u-s)?h:u,tk[0])),s=Math.min(s,i),s=Math.max(s,n);const o=IE.get(s),a=r.getClosestInfoForScale(s),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((u,h)=>{const p=a.denormalizeCol(u.col,u.world),f=a.denormalizeCol(h.col,h.world);return Math.sqrt((l-p)*(l-p)+(c-u.row)*(c-u.row))-Math.sqrt((l-f)*(l-f)+(c-h.row)*(c-h.row))}),FW.clear(),IE.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const r=this.tileInfoView,i=this.state.center;let n,s=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);r.getTileCoords(Sbe,a.key);const l=$b(Sbe,i);l<s&&(s=l,n=a.key)}),n.id}};d([m({constructOnly:!0})],lx.prototype,"concurrency",void 0),d([m({constructOnly:!0})],lx.prototype,"process",void 0),d([m()],lx.prototype,"state",void 0),d([m({constructOnly:!0})],lx.prototype,"strategy",void 0),d([m({constructOnly:!0})],lx.prototype,"tileInfoView",void 0),lx=d([F("esri.views.2d.tiling.TileQueue")],lx);new __(0,0,0,0);let rLt=class{constructor(e,r){this.sourceTile=r,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},elr=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function rlr(t,e,r,i,n,s){const o=r-n;if(o>=0)return(e>>o)+(i-(s<<o))*(t>>o);const a=-o;return e-(s-(i<<a))*(t>>a)<<a}let ilr=class{constructor(e,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(let s=0;s<this._columns;s++)this.cells[n][s]=[]}}getCell(e,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),n=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][n]||null}getCellSpan(e,r,i,n){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function iLt(t,e,r,i,n,s,o){const a=e[i++];for(let l=0;l<a;l++){const c=new rLt(s,o);c.xTile=e[i++],c.yTile=e[i++],c.hash=e[i++],c.priority=e[i++],c.featureIndex=e[i++];const u=e[i++];for(let f=0;f<u;f++){const g=e[i++],y=e[i++],v=e[i++],b=e[i++],w=!!e[i++],x=e[i++],S=r[i++],E=r[i++],P=e[i++],M=e[i++];c.colliders.push({xTile:g,yTile:y,dxPixels:v,dyPixels:b,hard:w,partIndex:x,width:P,height:M,minLod:S,maxLod:E})}const h=t[i++];for(let f=0;f<h;f++)c.textVertexRanges.push([t[i++],t[i++]]);const p=t[i++];for(let f=0;f<p;f++)c.iconVertexRanges.push([t[i++],t[i++]]);n.push(c)}return i}function slr(t,e,r){for(const[i,n]of t.symbols)nLt(t,e,r,n,i)}function nLt(t,e,r,i,n){const s=t.layerData.get(n);if(s.type===gu.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],u=c.startOpacity,h=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&h===0;const p=r?Math.floor(127*u)|h<<7:h?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.iconVertexRanges)for(let h=c;h<c+u;h+=4)s.iconOpacity[h/4]=l;if(o.selectedForRendering){const c=a.parts[1],u=c.startOpacity,h=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&h===0;const p=r?Math.floor(127*u)|h<<7:h?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.textVertexRanges)for(let h=c;h<c+u;h+=4)s.textOpacity[h/4]=l}s.lastOpacityUpdate=e,s.opacityChanged=!0}}function olr(t,e,r,i){const n=t.colliders;let s,o,a,l;for(const c of n)if(t.unique.show&&t.unique.parts[c.partIndex].show&&(s=c.xScreen-i[0]+c.dxScreen,o=c.yScreen-i[1]+c.dyScreen,a=s+c.width,l=o+c.height,dCt(r,e.x,e.y,s,o,a,l)))return!0;return!1}let PG=class{constructor(e,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let i=1;const n=new Uint32Array(e);this.layerUIDs=[];const s=n[i++];for(let o=0;o<s;o++)this.layerUIDs[o]=n[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},sLt=class extends PG{constructor(e,r){super(e,r),this.type=gu.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.lineIndexStart=i[n++],this.lineIndexCount=i[n++];const s=i[n++];if(s>0){this.patternMap=new Map;for(let o=0;o<s;o++){const a=i[n++],l=i[n++],c=i[n++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=n}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.usedMemory)??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=wt(this.vao)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=ti.createVertex(e,Lr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=ti.createIndex(e,Lr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=this.layer.lineMaterial;this.vao=new fp(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}},oLt=class extends PG{constructor(e,r){super(e,r),this.type=gu.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.fillIndexStart=i[n++],this.fillIndexCount=i[n++],this.outlineIndexStart=i[n++],this.outlineIndexCount=i[n++];const s=i[n++];if(s>0){this.patternMap=new Map;for(let o=0;o<s;o++){const a=i[n++],l=i[n++],c=i[n++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=n}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.fillVAO)==null?void 0:r.usedMemory)??0)+(((i=this.outlineVAO)==null?void 0:i.usedMemory)??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=wt(this.fillVAO),this.outlineVAO=wt(this.outlineVAO)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=ti.createVertex(e,Lr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=ti.createIndex(e,Lr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=n[i++],h=ti.createVertex(e,Lr.STATIC_DRAW,new Int32Array(s.buffer,4*i,u));i+=u;const p=n[i++],f=ti.createIndex(e,Lr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,p));i+=p;const g=this.layer,y=g.fillMaterial,v=g.outlineMaterial;this.fillVAO=new fp(e,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new fp(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:h},f)}},aLt=class extends PG{constructor(e,r,i){super(e,r),this.type=gu.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const n=new Uint32Array(e),s=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!n[a++];const l=n[a++],c=n[a++],u=n[a++],h=new __(l,c,u,0),p=n[a++];for(let v=0;v<p;v++){const b=n[a++],w=n[a++],x=n[a++];this.iconPerPageElementsMap.set(b,[w,x])}const f=n[a++];for(let v=0;v<f;v++){const b=n[a++],w=n[a++],x=n[a++];this.glyphPerPageElementsMap.set(b,[w,x])}const g=n[a++],y=n[a++];this.iconOpacity=new Int32Array(g),this.textOpacity=new Int32Array(y),a=iLt(n,s,o,a,this.symbols,i,h),this.bufferDataOffset=a}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.iconVAO)==null?void 0:r.usedMemory)??0)+(((i=this.textVAO)==null?void 0:i.usedMemory)??0)+i_(this.iconOpacity)+i_(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[r,i]of this.iconPerPageElementsMap)e+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){this.iconVAO=wt(this.iconVAO),this.textVAO=wt(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,r=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===r.usedMemory&&r.setSubData(e,0,0,e.length);const i=this.textOpacity,n=this.textVAO.vertexBuffers.opacity;i.length>0&&i.byteLength===n.usedMemory&&n.setSubData(i,0,0,i.length)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=ti.createVertex(e,Lr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=ti.createIndex(e,Lr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=n[i++],h=ti.createVertex(e,Lr.STATIC_DRAW,new Int32Array(s.buffer,4*i,u));i+=u;const p=n[i++],f=ti.createIndex(e,Lr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,p));i+=p;const g=ti.createVertex(e,Lr.STATIC_DRAW,this.iconOpacity.buffer),y=ti.createVertex(e,Lr.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,b=v.iconMaterial,w=v.textMaterial;this.iconVAO=new fp(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a,opacity:g},c),this.textVAO=new fp(e,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:h,opacity:y},f)}},lLt=class extends PG{constructor(e,r){super(e,r),this.type=gu.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.circleIndexStart=i[n++],this.circleIndexCount=i[n++],this.bufferDataOffset=n}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.usedMemory)??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=wt(this.vao)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=ti.createVertex(e,Lr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=ti.createIndex(e,Lr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=this.layer.circleMaterial;this.vao=new fp(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}};const dlr=!0,plr=32,Tbe=200,Ebe=ne("mapview-transitions-duration")===0?0:1/ne("mapview-transitions-duration");let cLt=class extends Xn{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var i;if(this._stage===e)return;const r=this._stage;this._stage=e,e?(i=this._stage)!=null&&i.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r==null||r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=ma(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=ma(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,r;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(r=this._fadeOutResolver)==null||r.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,r){if(this.fadeTransitionEnabled&&Ebe!==0){const i=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===i)this.computedVisible=this.visible;else{const s=e*Ebe;this.computedOpacity=n>i?Math.max(i,n-s):Math.min(i,n+s),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},OUe=class extends cLt{constructor(e,r,i,n,s,o,a=s,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new __(e),this.resolution=r,this.x=i,this.y=n,this.width=s,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;Ese(i,o,0,0,0,a,0,n,s,1),XP(this.transforms.displayViewScreenMat3,e.displayViewMat3,i)}get destroyed(){return this._destroyed}},kW=class MUe extends OUe{constructor(e,r,i,n,s,o,a,l=null){super(e,r,i,n,s,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<Tbe}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<Tbe)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){var i,n;let r=!1;for(const s of e){const o=this.layerData.get(s);o&&(this._memoryUsedByLayerData-=o.memoryUsed,o.type===gu.SYMBOL&&this.symbols.delete(s)&&(r=!0),o.destroy(),this.layerData.delete(s))}(i=this._memCache)==null||i.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&((n=this.featureIndex)==null||n.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){this.status!=="unloaded"&&(this.featureIndex=null,RUe.delete(this),MUe._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(e){var i,n;(i=this.featureIndex)==null||i.clear();let r=!1;if(e){const{bucketsWithData:s,emptyBuckets:o}=e,a=this._createRenderBuckets(s);if(o&&o.byteLength>0){const l=new Uint32Array(o);for(const c of l)this._deleteLayerData(c)}for(const[l,c]of a)this._deleteLayerData(l),c.type===gu.SYMBOL&&(this.symbols.set(l,c.symbols),r=!0),this._memoryUsedByLayerData+=c.memoryUsed,this.layerData.set(l,c);(n=this._memCache)==null||n.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const[s,o]of this.layerData)o.type===gu.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*r,n=this.height/this.rangeY*r,s=[0,0];e.toScreen(s,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;Cse(o),$z(o,o,s),Pse(o,o,Math.PI*e.rotation/180),qB(o,o,[i,n,1])}_createTransforms(){return{displayViewScreenMat3:ey(),tileMat3:ey(),tileUnitsToPixels:ey()}}static _destroyRenderBuckets(e){if(!e)return;const r=new Set;for(const i of e.values())r.has(i)||(i.destroy(),r.add(i));e.clear()}_createRenderBuckets(e){const r=new Map,i=new Map;for(const n of e){const s=this._deserializeBucket(n,i);for(const o of s.layerUIDs)r.set(o,s)}return r}_deserializeBucket(e,r){let i=r.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case gu.FILL:i=new oLt(e,this.styleRepository);break;case gu.LINE:i=new sLt(e,this.styleRepository);break;case gu.SYMBOL:i=new aLt(e,this.styleRepository,this);break;case gu.CIRCLE:i=new lLt(e,this.styleRepository)}return r.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const r=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(e)}};const RUe=new Map;function uLt(){RUe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(r=>console.log(r)),console.log("========"),t[1].forEach(r=>console.log(r))})}let hLt=class{constructor(e="scene"){this.context=e,this.extent=kc()}};const ylr={value:.5,readOnly:!0},dLt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let S3=class{constructor(e=0,r=0){this.min=e,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},pLt=class{constructor(e,r){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(r[2]-r[0]),this.dy=(e.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}},fLt=class{constructor(e,r,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=r,this.samplerData=new pLt(i,r)}computeMinMaxValue(e,r,i,n){n.min=1/0,n.max=-1/0,n.hasNoDataValues=!1;const s=e-this.level;if(s<=0)return n;const o=2**s;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return n;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,h=.5*sD;let p=(c-1)/o,f=(i-this.j*o)*p,g=(r-this.i*o)*p;if(p<1){const y=Math.floor(f),v=Math.floor(g),b=y+v*c,w=u[b],x=u[b+1],S=u[b+c],E=u[b+c+1];if(w+x+S+E<h){const P=f-y,M=g-v,L=V4(w,x,S,E,P,M),U=V4(w,x,S,E,P+p,M),z=V4(w,x,S,E,P,M+p),W=V4(w,x,S,E,P+p,M+p);return n.min=Math.min(L,U,z,W),n.max=Math.max(L,U,z,W),n}f=y,g=v,p=1}else f=Math.floor(f),g=Math.floor(g),p=Math.ceil(p);for(let y=f;y<=f+p;y++)for(let v=g;v<=g+p;v++){const b=u[y+v*c];b<h?(a=Math.min(a,b),l=Math.max(l,b)):n.hasNoDataValues=!0}return n.min=a,n.max=l,n}};const mLt=.5*sD;function xn(t,e,r){if(r==null)return null;for(const i of r){if(!i)continue;const n=i.safeWidth;let s=we(i.dy*(i.y1-e),0,n),o=we(i.dx*(t-i.x0),0,n);const a=Math.floor(s),l=Math.floor(o),c=i.data.width,u=a*c+l,h=i.data.values,p=h[u],f=h[u+1],g=u+c,y=h[g],v=h[g+1];if(p+y+f+v<mLt){s-=a,o-=l;const b=p+(f-p)*o;return b+(y+(v-y)*o-b)*s}}return null}var el,bt;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(el||(el={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(bt||(bt={}));const LE=C(),gLt=C(),Gy=C(),jy=C();function yLt(t,e,r=0){const i=t.extent;if(i==null)return!1;if(r===0)return CPe(i,e);const n=Math.min(i[2]-i[0],i[3]-i[1]);return LJe(i,e,r*n)}function rk(t,e,r,i){he(LE,r),LE[i]=e[i];const n=_e(LE,LE,e),s=_e(gLt,t,e),o=fe(s,n),a=fe(n,n);let l;l=o<=0?e:a<=o?r:ge(LE,e,oe(n,n,o/a));const c=_e(LE,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function _Lt(t,e,r){const i=t.extent;if(i==null)return 0;Gy[0]=i[0],Gy[1]=i[1],Gy[2]=r,jy[0]=i[2],jy[1]=i[3],jy[2]=r;let n=1/0,s=1/0;return e[0]<Gy[0]?n=rk(e,Gy,jy,0):e[0]>jy[0]&&(n=rk(e,jy,Gy,0)),e[1]<Gy[1]?s=rk(e,Gy,jy,1):e[1]>jy[1]&&(s=rk(e,jy,Gy,1)),Math.min(n,s)}function vLt(t,e,r){if(t==null)return Noe();if(t.spatialReference.isGeographic&&!Rb(t.spatialReference))return new B("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=wu.checkUnsupported(t);if(i!=null)return i;if(r==null)return new B("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const n=bLt(t,r);if(n)return n;const s=t.spatialReference;return e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new B("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function bLt(t,e){const r=t.lods,i=r[0].resolution*2**r[0].level,n=[i*t.size[0],i*t.size[1]],s=[t.origin.x,t.origin.y],o=EPe(e),a=Ht();wu.computeRowColExtent(o,n,s,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>s3){const c=r[0].scale*2**r[0].level;let u=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/i;const h=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**h)*10**h,new B("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:s3})}return null}const wLt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:vLt,isInsideExtent:yLt,tiltToExtentEdge:_Lt},Symbol.toStringTag,{value:"Module"}));function xLt(){return!0}function SLt(){return 0}function TLt(t,e){if(t==null)return Noe();const r=t.lods.length-1,i=t.spatialReference,n=Rb(i)||nw(i)||sw(i);if(i.isWebMercator){if(!wu.makeWebMercatorAuxiliarySphere(r).compatibleWith(t))return new B("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n)return new B("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!wu.makeGCSWithTileSize(t.spatialReference,t.size[0],r).compatibleWith(t))return t.spatialReference.isWGS84?new B("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new B("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new B("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const ELt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:TLt,isInsideExtent:xLt,tiltToExtentEdge:SLt},Symbol.toStringTag,{value:"Module"})),CLt={[Fe.Global]:ELt,[Fe.Local]:wLt};function Vs(t,e){t||console.warn("Terrain: "+e)}let uo=!1,aV=!1;function PLt(t){aV=t,uo=uo||t}function ALt(t){uo=t}function $e(t,e){var r;if(uo&&!t){const i=(r=new Error().stack)==null?void 0:r.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function Ote(t){return AG(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function lV(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function AG(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function yce(t){return(t==null?void 0:t.type)==="tile-3d"}function CT(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function $Ue(t){return(t==null?void 0:t.type)==="wmts-3d"}function Mte(t){return(t==null?void 0:t.type)==="elevation-3d"}function IM(t){return(t==null?void 0:t.type)==="group"}function DD(t){return t&&(yce(t)||$Ue(t)||AG(t)||CT(t))}function Rte(t){return t&&(yce(t)||AG(t)||CT(t)||$Ue(t))}function $te(t){return Rte(t)||Mte(t)}function OLt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function MLt(t){return IUe(t==null?void 0:t.sourceLayerInfo)||!!(t!=null&&t.isVTLBackground)}function RLt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function $Lt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e instanceof HTMLImageElement||e instanceof gce||e instanceof HTMLCanvasElement||e instanceof ImageData}function IUe(t){return(t==null?void 0:t.data)!=null&&"type"in t.data&&t.data.type==="vector-tile"}function dP(t){return t!=null&&"release"in t&&t.release(),null}function Cbe(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function _ce(t,e,r,i){return CLt[i].checkIfTileInfoSupportedForViewSR(t,r,e)}function OG(t,e,r){let i=null,n=null;if((t==null?void 0:t.type)==="wmts"){const s=ILt(t,e,r);i=s.tileInfo,n=s.fullExtent}else{n=lV(t)?t.getCompatibleFullExtent(e):t.fullExtent;const s=r===Fe.Local;if(lV(t))i=t.getCompatibleTileInfo(e,n,s);else if((t==null?void 0:t.type)==="vector-tile"){const o=s&&!LLt(e)||DLt.force512VTL,a=t.tileInfo.spatialReference.isGeographic;i=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=t.tileInfo}return i!=null&&n!=null&&_ce(i,n,e,r)==null?{tileInfo:i,fullExtent:n}:null}function ILt(t,e,r){const i=ZXe(t);if(i!=null){if(!St.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const n=i.find(s=>_ce(s.tileInfo,s.fullExtent,e,r)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function LLt(t){return t.isWGS84||t.isWebMercator||h3e(t)||!kL(t)}const DLt={force512VTL:!1};function Pbe(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function Hy(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function zd(t,e,r=kLt){return Math.abs(t-e)<r}function cV(t){return t===bt.NORTH_EAST?bt.SOUTH_WEST:t===bt.NORTH_WEST?bt.SOUTH_EAST:t===bt.SOUTH_WEST?bt.NORTH_EAST:bt.NORTH_WEST}function vce(t){return t===bt.NORTH?bt.SOUTH:t===bt.EAST?bt.WEST:t===bt.SOUTH?bt.NORTH:bt.EAST}function NLt(t){return t===bt.NORTH_WEST||t===bt.SOUTH_WEST}function FLt(t){return t===bt.NORTH_WEST||t===bt.NORTH_EAST}function Abe(t){return t===bt.NORTH_WEST||t===bt.WEST||t===bt.SOUTH_WEST}function Obe(t){return t===bt.NORTH_EAST||t===bt.EAST||t===bt.SOUTH_EAST}function Mbe(t){return t===bt.SOUTH_EAST||t===bt.SOUTH||t===bt.SOUTH_WEST}function Rbe(t){return t===bt.NORTH_EAST||t===bt.NORTH||t===bt.NORTH_WEST}const Hf=[bt.NORTH,bt.EAST,bt.SOUTH,bt.WEST],uV=[bt.NORTH_EAST,bt.SOUTH_EAST,bt.SOUTH_WEST,bt.NORTH_WEST],kLt=1e-5;let Td=class extends Pe{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(r=>{const i=r.layer;if(XXe(i.operationalLayerType)&&this.viewSpatialReference!=null){const n=LUe(i.fullExtent,this.viewSpatialReference);n!=null&&e.push(EPe(n))}}),e}};function ULt(t,e){return t===Fe.Global?new Ite(e):new Lte(e)}d([m({readOnly:!0})],Td.prototype,"layerViewsExtent",null),d([m({readOnly:!0})],Td.prototype,"tiledLayersExtent",null),d([m({readOnly:!0})],Td.prototype,"stencilEnabledExtents",null),d([m()],Td.prototype,"viewSpatialReference",void 0),d([m()],Td.prototype,"tilingScheme",void 0),d([m()],Td.prototype,"defaultTiledLayersExtent",void 0),d([m({constructOnly:!0})],Td.prototype,"layers",void 0),d([m({constructOnly:!0})],Td.prototype,"layerViews",void 0),Td=d([F("esri.views.3d.terrain.ExtentHelper")],Td);let Ite=class extends Td{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?sIe:ect}};Ite=d([F("esri.views.3d.terrain.ExtentHelperGlobal")],Ite);let Lte=class extends Td{_computeLayerViewsExtent(){const e=kc(),r=this.viewSpatialReference;this.layerViews.forEach(s=>{const o=s.layer;if(s.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=LUe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,r);ab(e,a,e)}});const i=zZ(e)?e:null,n=this._get("layerViewsExtent");return hT(i,n)?n:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const r=this.viewSpatialReference,i=kc();this.layers.forEach(o=>{if(o.loaded&&fI(o)){const a=OG(o,r,Fe.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a;l!=null&&c!=null&&(lV(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&ab(i,c,i)}}),ab(i,this.defaultTiledLayersExtent,i);const n=zZ(i)?i:null,s=this._get("tiledLayersExtent");return hT(n,s)?s:n}};function LUe(t,e){return t==null||t.spatialReference.equals(e)?t:xI(t,t.spatialReference,e)}Lte=d([F("esri.views.3d.terrain.ExtentHelperLocal")],Lte);function DUe(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const r=Object.keys(t);for(const i of r)i.includes(".glsl")&&delete t[i]}}const NUe=1.3,zLt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let T1,vc=class extends Pe{constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=ne("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){const e=this.view;this.renderer=new vd({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.plugins.add(this.renderer);const r=()=>this.setDrawTexturesDirty();this._groundIntersector=pp(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([pe(()=>this.renderer.hasHighlights,r),this.renderer.events.on("has-water",i=>{var n;return(n=e._stage)==null?void 0:n.renderer.setParameters({hasOverlayWater:i})}),this.renderer.events.on("content-changed",r),pe(()=>e.state.camera.pixelRatio,r),pe(()=>e.state.alignPixelEnabled,r),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),pe(()=>{var i,n,s;return[(i=e.pointsOfInterest)==null?void 0:i.renderPointOfView,(s=(n=e.pointsOfInterest)==null?void 0:n.centerOnSurfaceFrequent)==null?void 0:s.location]},()=>this.setPlacementDirty()),pe(()=>{var i,n;return[(i=e.state)==null?void 0:i.pixelRatio,(n=e.state)==null?void 0:n.contentPixelRatio]},()=>this.setPlacementDirty(),ei),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(Ct.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",i=>{this._updateOverlays(Xl,i.camera,Hn.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(Hn.BACKGROUND,i)})]),e._stage.renderer.renderOverlay=i=>this._renderOverlay(i)}destroy(){var e;(e=this.view)!=null&&e._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{}),T1&&(T1.hide(),T1=null),this.renderer=Me(this.renderer)}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Si.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?zr(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return NUe/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}_renderOverlay(e){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._dispatchAnimationUpdate(e),this._drawOverlays(Hn.UPDATE,this.view.state)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const r=this.view.renderSpatialReference;e!=null&&r!=null?(this._renderSR=r,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Lb(-20037508342787e-6,20037508342787e-6):new Lb(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,r,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this.renderer.createDrapeSourceRenderer(e,r,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),n}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,mh)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,Hn.UPDATE)}_updateOverlays(e,r,i){if(!this._spatialReference)return pa;const n=this._computeOverlayResolution(r);this._computeOverlayExtents(r,n,Hm),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,Hm.stretch);const s=this._updateOverlay(Cs.INNER,Hm.inner,n,1*Hm.pixelRatioAdjustment,Hm.mapUnitsPerPixel),o=sl(Hm.inner)/sl(Hm.outer),a=this._updateOverlay(Cs.OUTER,Hm.outer,n,o*Hm.pixelRatioAdjustment,Hm.mapUnitsPerPixel);s!==xg.EXTENT&&a!==xg.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(i)),s===xg.NONE&&a===xg.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const r=this.view.state.contentPixelRatio*this.view.resolutionScale,i=e.fullWidth/e.pixelRatio*r,n=e.fullHeight/e.pixelRatio*r,s=Math.ceil(1.5*Math.max(i,n));return Math.min(vT(s),this._maxResolution)}_updateOverlay(e,r,i,n,s){if(this.renderer.overlays.length===0)return xg.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=s,o.pixelRatio=n,VLt(r,o.extent)&&i===o.resolution)return a===s?xg.NONE:xg.RERENDER_ONLY;c_(o.extent,r),o.resolution=i;const l=tse(o.extent);return o.renderLocalOrigin=U9(l[0],l[1],0,"OV_"+this._latestOriginId++),xg.EXTENT}setTileParameters(e){const r=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[Cs.INNER],n=this.renderer.overlays[Cs.OUTER],s=e.extent;this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,n.extent)?(this._setTileOverlayData(s,Cs.INNER,r),this._setTileOverlayData(s,Cs.OUTER,r)):(this._clearTileOverlayData(Cs.INNER,r),this._clearTileOverlayData(Cs.OUTER,r))}else this._clearTileOverlayData(Cs.INNER,r),this._clearTileOverlayData(Cs.OUTER,r)}overlayPixelSizeInMapUnits(e,r){if(this.renderer.overlays.length===0)return r();const i=this.renderer.overlays[Cs.INNER],n=this.renderer.overlays[Cs.OUTER],s=this._pointIsInExtent(e,i.extent)?i:n;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,r,i){if(this.renderer.overlays.length===0)return;const n=this.renderer.overlays[r].extent,s=sl(n),o=Mc(n);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(n[0],a);const l=this._longitudeCyclical.minimalMonotonic(n[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(r,sl(e)/s,Mc(e)/o),i.setOffset(r,(a-n[0])/s,(e[1]-n[1])/o)}_clearTileOverlayData(e,r){r.setScale(e,-1,-1),r.setOffset(e,-1,-1)}async reloadShaders(){DUe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(Xl)}_dispatchAnimationUpdate(e){const r=e-this._animationTimeLast;if(r>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=r/this.surface.view._stage.renderer.animationTimeDilation,n=new P4e(this.view.state.camera,i,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(n)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,r,i,n){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,HLt,r,i);if(s==null)return!1;const o=s.origin,a=ge(ik,s.origin,s.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(n)}_findHorizonBasedPointOfInterest(e,r){let i=.5;const n=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=we(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+a,e.aboveGround?s-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const u=ik;QA(x7(S7,zr(this.view.spatialReference).radius+l),Wh(e.eye,e.viewForward),u),_e(u,u,e.eye);const h=Db.normalize(_Ae(e.viewForward,u,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:n;i=c?p*h:h+p*(1-h)}else{const u=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(u),p=Xt(0,h,1,0),f=Mu(p,p,e.projectionMatrix)[1],g=we(.5+.5*f,0,1);i=g===1||g===0?.5:c?g*n:1-(1-g)*n}return!!this._intersectGroundFromView(e,.5,i,r)&&GL(r,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,r,i){const n=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=C();this._findHorizonBasedPointOfInterest(e,s)||he(s,n),Si.OVERLAY_SHOW_CENTER?(T1==null&&(T1=new TC(this.view.graphics,"red")),T1.show(s,this._renderSR)):T1!=null&&T1.hide();const o=Math.max(.1,Bi(e.eye,s)),a=Gb(this.view.renderCoordsHelper,n,e.eye);this._overlaySREqualsRenderSR||ga(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference&&this._spatialReference.isGeographic,u=c&&this._spatialReference?1/zr(this._spatialReference).metersPerDegree:1,h=this.view.state.contentPixelRatio,p=e.perScreenPixelRatio/h*o*u;i.mapUnitsPerPixel=p/this._worldToPCSRatio,i.stretch=this._overlayStretch;let f=r*p/2*i.stretch,g=!1,y=c?90:1/0;this._isSpherical&&l&&this._spatialReference&&(this._spatialReference.isWebMercator?(f/=Math.cos(fz(s[1])),y=l[3]):(g=!0,f/=zr(this._spatialReference).metersPerDegree,y=90),f>=y&&(f=y,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let v=1;g&&(v=1/Math.max(.2,Math.cos(Math.abs(Ut(s[1])))),f*v>180&&(v=180/f),i.mapUnitsPerPixel*=v);const b=Math.log(2)/12;f=Math.exp(Math.round(Math.log(f)/b)*b);const w=f*v,x=32,S=.5*r/(x*w),E=.5*r/(x*f);s[0]=Math.round(s[0]*S)/S,s[1]=Math.round(s[1]*E)/E;const P=i.inner;P[0]=s[0]-w,P[1]=s[1]-f,P[2]=s[0]+w,P[3]=s[1]+f,this._isSpherical&&this._shiftExtentToFitBounds(P,1/0,y);const M=i.outer;if(6*w>sl(l))c_(M,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)M[0]=P[0]-w,M[1]=P[1]-f,M[2]=P[2]+w,M[3]=P[3]+f;else{ga(e.eye,this._renderSR,ik,this._spatialReference),Ag(cx,s,ik);let U=-Math.atan2(cx[1],cx[0])+.125*Math.PI;U<0&&(U+=2*Math.PI);const z=Math.floor(U/(.25*Math.PI));WT(cx,zLt[z],2*f),cx[0]*=v,cx[2]*=v,ose(M,P,cx)}if(this._isSpherical)M[0]=this._longitudeCyclical.clamp(M[0]),M[2]=this._longitudeCyclical.clamp(M[2]),M[1]=Math.max(M[1],-y),M[3]=Math.min(M[3],y);else{const U=VZ(P,l,GLt),z=VZ(M,l,jLt);ope(U,z)&&(M[2]=M[0],M[3]=M[1])}const L=Math.abs(P[2]-P[0])/r;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,L),i.pixelRatioAdjustment=i.mapUnitsPerPixel/L}_drawOverlays(e,r){if(!this.renderer.hasOverlays)return;if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const i=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const n=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(r),n!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(Hn.UPDATE),i?(this.surface.requestRender(e),e===Hn.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Hn.BACKGROUND),this.renderer}_rectanglesOverlap(e,r){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(r[0],r[2],e[0])||this._longitudeCyclical.contains(r[0],r[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],r[0]))&&!(e[1]>r[3]||e[3]<r[1]):lN(e,r))}_rectInsideRect(e,r){return r!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],r[0])&&this._longitudeCyclical.contains(e[0],e[2],r[2])&&r[1]>e[1]&&r[3]<e[3]:ope(e,r))}_pointIsInExtent(e,r){if(this._longitudeCyclical)return this._longitudeCyclical.contains(r[0],r[2],e.x)&&e.y>=r[1]&&e.y<=r[3];const i=e.x,n=e.y;return i>r[0]&&i<r[2]&&n>r[1]&&n<r[3]}_shiftExtentToFitBounds(e,r,i){let n=0,s=0;e[0]<-r?n=e[0]+r:e[2]>r&&(n=r-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),Sz(e,n,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask(Xl)}}};function VLt(t,e){const i=Si.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i}d([m()],vc.prototype,"_spatialReference",void 0),d([m({readOnly:!0})],vc.prototype,"running",null),d([m()],vc.prototype,"_placementDirty",void 0),d([m()],vc.prototype,"_contentUpdated",void 0),d([m()],vc.prototype,"_isSpherical",null),d([m()],vc.prototype,"_worldToPCSRatio",null),d([m()],vc.prototype,"renderer",void 0),d([m({constructOnly:!0})],vc.prototype,"view",void 0),d([m({constructOnly:!0})],vc.prototype,"surface",void 0),d([m()],vc.prototype,"suspended",null),d([m()],vc.prototype,"updating",null),d([m({type:Boolean})],vc.prototype,"rendersOccludedDraped",null),vc=d([F("esri.views.3d.terrain.OverlayManager")],vc);let BLt=class{constructor(){this.inner=Ht(),this.outer=Ht(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=NUe}};const cx=tr(),ik=C(),Hm=new BLt,GLt=Ht(),jLt=Ht(),HLt=fo();var xg;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(xg||(xg={}));let qLt=class{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=zi(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=lr(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,zi(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(e){return this.outerEdgesOffsetAndLength[2*e]}getEdgeCount(e){return this.outerEdgesOffsetAndLength[2*e+1]}getEdgeVertexIndex(e,r){return this.getEdgeAttributeIndex(e,r)}getEdgeVertexPosition(e,r,i,n){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(e,n),r),ge(r,r,i)}getEdgeNormal(e,r,i){const{typedBuffer:n,typedBufferStride:s}=this.vertexAttributes.normalCompressed;uTt(r,n,this.getEdgeAttributeIndex(e,i),s)}setEdgeNormalFromValues(e,r,i,n,s){this._setNormal(this.getEdgeAttributeIndex(e,r),i,n,s)}setEdgeVertexFromValuesRawPositionUV(e,r,i,n,s,o,a){const l=this.getEdgeAttributeIndex(e,r);this.vertexAttributes.position.setValues(l,i,n,s),this._setUV(l,o,a)}setEdgeVertexFromValuesRawPositionUVNormal(e,r,i,n,s,o,a,l,c,u){const h=this.getEdgeAttributeIndex(e,r);this.vertexAttributes.position.setValues(h,i,n,s),this._setUV(h,o,a),this._setNormal(h,l,c,u)}_getEdgeVertexRaw(e,r){this.vertexAttributes.position.getVec(e,r)}_setNormal(e,r,i,n){const{typedBuffer:s,typedBufferStride:o}=this.vertexAttributes.normalCompressed;_m(s,e,r,i,n,o)}_setUV(e,r,i){im(this.vertexAttributes.uv0,e,r,i)}getEdgeAttributeIndex(e,r){return $e(0<=r&&r<this.getEdgeCount(e)),this.getEdgeFirstVertexIndex(e)+r}};const $be=16384;function im(t,e,r,i){t.setValues(e,r*$be,i*$be)}let WLt=class{constructor(){this.sinLonLUT=new Array(uR+1),this.cosLonLUT=new Array(uR+1),this.sinLatLUT=new Array(uR+1),this.cosLatLUT=new Array(uR+1)}update(e,r,i){const n=r[0],s=r[2];for(let o=0;o<=e;o++){const a=o/e,l=n*(1-a)+s*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},YLt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}},FUe=class O8{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Me(this._current),this._next=Me(this._next),this._waiting=Me(this._waiting),this._delayed=Me(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let e=O8.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,fb.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const r=this._fadeDuration,i=this._current!=null&&this._next.texture===this._current.texture,n=this._next.type!==Os.FADING,s=e-this._fadeStart>=r;(i||n||s)&&(Me(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=O8.test.fadeMoment||performance.now(),r=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return this._next!=null||this._delayed!=null}push(e,r=fb.Immediate){this._delayed=Me(this._delayed),this._push(e,r)}_push(e,r){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const i=O8.test.fadeMoment||performance.now();return r!==fb.Immediate?(this._delayed=e,void(this._delayedTime=i+r)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(e!=null&&(Me(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const r=this._getFadeDuration();return e+r-e%r}get _isFadingEnabled(){return this._getFadeDuration()>0}};var fb;FUe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(fb||(fb={}));var xA;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(xA||(xA={}));let kUe=class{constructor(){this._queue=new jt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var r;const e=(r=this._last)==null?void 0:r.children;return e!=null&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},XLt=class{constructor(){this._q=new jt}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}};function iL(t,e,r){if((e==null?void 0:e.fullExtent)==null)return!1;const i=e.fullExtent,n=t.extent;if(r){if(n[0]<i.xmin||n[1]<i.ymin||n[2]>i.xmax||n[3]>i.ymax)return!1}else if(i.xmin>n[2]||i.ymin>n[3]||i.xmax<n[0]||i.ymax<n[1])return!1;const s=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&s>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&s<.99999999*a)}function Q0(t,e){const r=t.lij,i=e.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function UUe(t,e,r=null){r==null||r.length===0?t===xA.BACK_TO_FRONT?e.sort(ZLt):e.sort(JLt):e.sort((i,n)=>QLt(i,n,t,r))}function ZLt(t,e){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function JLt(t,e){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function zUe(t,e,r){const i=t.screenDepth,n=e.screenDepth;return i<n?-r:i>n?r:Q0(t,e)}function QLt(t,e,r,i){return Ibe(t,i)===Ibe(e,i)?zUe(t,e,r):t?r:-r}function Ibe(t,e){for(const r of e)if(t.intersectsExtent(r))return!0;return!1}function KLt(t,e){const r=t.distanceToPOI-e.distanceToPOI;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function eDt(t,e){const r=t.length;for(let i=0;i<r;++i)t.at(i).updateDistanceToPOI(e);t.sort(KLt)}function tDt(t,e,r){let i=1,n=0,s=0;for(;t!==e;)if(i*=.5,n*=.5,s*=.5,1&t.lij[2]&&(n+=.5),!(1&t.lij[1])&&(s+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(e,n,s,i)}function rDt(t){for(let e=0;e<t.length;e++){const r=t[e],i=r.parent;if(i)for(let n=0;n<4;n++){const s=i.children[n];if(s&&s!==r)return!0}}return!1}function Rlr(t,e){if(!t||!e||t[0]===e[0])return!1;const r=t[0]<e[0],i=r?t:e,n=r?e:t,s=1<<n[0]-i[0];return Math.floor(n[1]/s)===i[1]&&Math.floor(n[2]/s)===i[2]}let bce=class{get updating(){return!!this._tileRequested}init(e,r,i,n){this.tile=e,this._layerIdx=r,this._layerClass=i,this._suspended=n,this._tileLayerInfo=e.getLayerInfo(r,i),this._tileRequested=null;const s=this._findAncestorWithData();this._setUpsampleTile(s)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,r){this._setUpsampleTile(e,r),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,Os.FADING,r):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(e,r),n=Ote(i),{minLevel:s,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?iL:()=>!0;let u=this.tile;const h=u.level;let p;const f=this._tileLayerInfo.upsampleInfo,g=f!=null?f.tile.level:-1,y=f!=null&&g-h>=a,v=n==null?void 0:n.tilemapCache,b=i.type==="vector-tile-3d"?i.schemaHelper:null;for(;u&&c(u,n,!1)&&u.level>=s;){const w=u.level,x=h-w,S=u.layerInfo[r][e];if(S.data&&x>=a){(!y||w>g)&&this._setUpsampleTile(u),S.dataInvalidated&&(p=u);break}const E=(b==null?void 0:b.getLevelRowColumn(u.lij))??u.lij;if((v==null?void 0:v.getAvailability(E[0],E[1],u.lij[2]))!=="unavailable"&&w<=o&&!S.data&&!S.dataMissing&&((!p||u.level===s||w%nIe==0||h-p.level<a)&&(p=u),x>=l))break;u=u.parent}if(p!=null&&h-p.level<a)if(f)p=null;else{const w=this._findAncestorWithData();w!=null&&(this._setUpsampleTile(w),p=w.layerInfo[r][e].dataInvalidated?w:null)}return p}_findAncestorWithData(){const e=this.tile.elevationLevel,r=this._desiredMinLevelDelta;let i;for(let n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(e-n.level>=r)return n;i=n}return i}_setUpsampleTile(e,r){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,Os.FADING,r)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},iDt=class extends bce{get _desiredMinLevelDelta(){throw Lbe}get _progressiveLevelModulo(){throw Lbe}dispose(){}};const Lbe=new Error("Abstract method called on TileAgent"),Qc=new iDt;let VUe=class extends bce{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return _Q(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},BUe=class extends bce{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return nIe}};var PT,c2;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(PT||(PT={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(c2||(c2={}));function nDt(t){t.fragment.uniforms.add(new ft("u_colormap",e=>e.u_colormap),new Ie("u_colormapOffset",e=>e.colormap.u_colormapOffset),new Ie("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new Ie("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(T`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function sDt(t){t.fragment.uniforms.add(new ft("u_transformGrid",e=>e.u_transformGrid),new ci("u_transformSpacing",e=>e.common.u_transformSpacing),new ci("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(T`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let GUe=class extends Li{constructor(){super(...arguments),this.scale=1,this.offset=u_}};function jUe(t){t.attributes.add(R.POSITION,"vec2"),t.attributes.add(R.UV0,"vec2"),t.vertex.uniforms.add(new Ie("scale",e=>e.scale)),t.vertex.uniforms.add(new ci("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(T`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let oDt=class extends GUe{constructor(e,r,i){super(),this.common=e,this.u_image=r,this.u_transformGrid=i}};function aDt(t,e){t.include(sDt),t.fragment.uniforms.add(new ft("u_image",i=>i.u_image),new Qg("u_flipY",i=>i.common.u_flipY),new Qg("u_applyTransform",i=>i.common.u_applyTransform));const{requireBilinearWithNN:r}=e;r&&t.fragment.uniforms.add(new ci("u_srcImageSize",i=>i.common.u_srcImageSize)),t.fragment.code.add(T`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),r?t.fragment.code.add(T`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(T`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var Ne;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Ne||(Ne={}));const Dte={normal:Ne.Normal,average:Ne.Average,lighten:Ne.Lighten,lighter:Ne.Lighter,screen:Ne.Screen,plus:Ne.Plus,"color-dodge":Ne.ColorDodge,darken:Ne.Darken,multiply:Ne.Multiply,"color-burn":Ne.ColorBurn,overlay:Ne.Overlay,"soft-light":Ne.SoftLight,"hard-light":Ne.HardLight,"vivid-light":Ne.VividLight,hue:Ne.Hue,saturation:Ne.Saturation,luminosity:Ne.Luminosity,color:Ne.Color,difference:Ne.Difference,exclusion:Ne.Exclusion,minus:Ne.Minus,invert:Ne.Invert,reflect:Ne.Reflect,"destination-over":Ne.DestinationOver,"destination-atop":Ne.DestinationAtop,"destination-in":Ne.DestinationIn,"destination-out":Ne.DestinationOut,"source-atop":Ne.SourceAtop,"source-in":Ne.SourceIn,"source-out":Ne.SourceOut,xor:Ne.Xor};function lDt(t){return t===Ne.DestinationOver||t===Ne.DestinationAtop||t===Ne.DestinationIn||t===Ne.DestinationOut||t===Ne.SourceAtop||t===Ne.SourceIn||t===Ne.SourceOut||t===Ne.Xor}function wce(t){t.code.add(T`
    float lineFactorAtPosition(float value) {
      float pos = value * ${T.float(257)};
      if(pos < 0.5 || pos > ${T.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function cDt(t,e){const r=e.blendMode;r!==Ne.Normal&&(r===Ne.Reflect&&t.code.add(T`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==Ne.ColorDodge&&r!==Ne.VividLight||t.code.add(T`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==Ne.ColorBurn&&r!==Ne.VividLight||t.code.add(T`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===Ne.Overlay&&t.code.add(T`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===Ne.HardLight&&t.code.add(T`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===Ne.SoftLight&&t.code.add(T`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===Ne.VividLight&&t.code.add(T`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==Ne.Hue&&r!==Ne.Saturation&&r!==Ne.Color&&r!==Ne.Luminosity||(t.code.add(T`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==Ne.Hue&&r!==Ne.Saturation||t.code.add(T`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(T`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===Ne.Multiply?T`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Average?T`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Lighten?T`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Darken?T`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Lighter?T`return vec4(cl * ol + cb * ob, ol + ob);`:r===Ne.Plus?T`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===Ne.Minus?T`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===Ne.Screen?T`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Difference?T`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Invert?T`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Ne.DestinationOver?T`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===Ne.DestinationAtop?T`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===Ne.DestinationOut?T`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===Ne.SourceAtop?T`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Ne.SourceOut?T`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===Ne.Xor?T`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===Ne.DestinationIn?T`return vec4(cb * ob * ol, ol * ob);`:r===Ne.SourceIn?T`return vec4(cl * ol * ob, ol * ob);`:r===Ne.Hue?T`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Saturation?T`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Color?T`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Luminosity?T`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Exclusion?T`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Reflect?T`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.ColorDodge?T`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.ColorBurn?T`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.Overlay?T`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.SoftLight?T`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.HardLight?T`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ne.VividLight?T`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:T``}
    }
  `))}var As,Za,Ef;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(As||(As={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(Za||(Za={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(Ef||(Ef={}));function HUe(t,e){const r=e.output===As.GridComposite,i=e.output===As.ColorComposite,n=e.output===As.GroupBackgroundComposite,s=e.output===As.Composite;r&&t.fragment.include(wce),i&&t.fragment.uniforms.add(new zt("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===Za.Required;o&&t.fragment.uniforms.add(new Ie("baseOpacity",c=>c.baseOpacity)),s&&t.fragment.uniforms.add(new ft("fboColor",c=>c.fboTexture));const a=e.blendMode!==Ne.Normal,l=e.premultipliedSource===Ef.On;t.fragment.include(cDt,e),t.fragment.code.add(T`
    vec4 getBackground(vec2 uv) {
      return ${o?T`baseOpacity *`:""} ${n?T`vec4(0.0, 0.0, 0.0, 0.0)`:i?T`vec4(backgroundColor, 1.0)`:r?T`vec4(gridColor(uv), 1.0)`:T`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?T`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:T`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(s&&!o||n)?T`colorLayer * opacity;`:T`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let YN=class extends oDt{constructor(e,r,i,n,s,o){super(e,n,s),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=Yn,this.fboTexture=null,this.baseOpacity=1}},qUe=class extends YN{},WUe=class extends YN{};function YUe(t){const e=new Fr;return e.include(jUe),e.include(aDt,t),e.include(nDt,t),e.include(HUe,t),e.fragment.code.add(T`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===PT.Stretch?hDt(e,t):t.colorizerType===PT.Lut?uDt(e):t.colorizerType===PT.Hillshade&&dDt(e,t),e}function uDt(t){t.fragment.code.add(T`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function hDt(t,e){t.fragment.uniforms.add(new kN("u_bandCount",i=>i.symbolizer.u_bandCount),new Oc("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new Oc("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new Oc("u_factor",i=>i.symbolizer.u_factor,3),new Ie("u_minOutput",i=>i.symbolizer.u_minOutput),new Ie("u_maxOutput",i=>i.symbolizer.u_maxOutput),new Qg("u_useGamma",i=>i.symbolizer.u_useGamma),new Oc("u_gamma",i=>i.symbolizer.u_gamma,3),new Oc("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new Ie("u_opacity",i=>i.common.u_opacity)),t.fragment.code.add(T`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?T`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:T`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(T`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===c2.Noop?T`
        fragColor = applyBackgroundBlend(currentPixel);`:T`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function dDt(t,e){const r=t.fragment;r.uniforms.add(new ft("u_image",n=>n.u_image),new kN("u_hillshadeType",n=>n.symbolizer.u_hillshadeType),new Oc("u_sinZcosAs",n=>n.symbolizer.u_sinZcosAs,6),new Oc("u_sinZsinAs",n=>n.symbolizer.u_sinZsinAs,6),new Oc("u_cosZs",n=>n.symbolizer.u_cosZs,6),new Oc("u_weights",n=>n.symbolizer.u_weights,6),new ci("u_factor",n=>n.symbolizer.u_factor),new Ie("u_minValue",n=>n.symbolizer.u_minValue),new Ie("u_maxValue",n=>n.symbolizer.u_maxValue),new ci("u_srcImageSize",n=>n.common.u_srcImageSize)),r.include(Ty),r.code.add(T`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(T`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=e.applyColormap?T`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:T`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(T`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const pDt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:WUe,ColorizerStretchUniforms:qUe,ColorizerUniforms:YN,build:YUe},Symbol.toStringTag,{value:"Module"}));function fDt(t,e,r="nearest",i=!1){var c;const n=!(i&&e.pixelType==="u8"),s=n?Ks.FLOAT:Ks.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:n?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l=new ui;return l.width=e.width,l.height=e.height,l.internalFormat=n?at.RGBA32F:Ot.RGBA,l.samplingMode=!a||r!=="bilinear"&&r!=="cubic"?Kt.NEAREST:Kt.LINEAR,l.dataType=s,l.wrapMode=nr.CLAMP_TO_EDGE,new Mr(t,l,o)}function mDt(t,e){const{spacing:r,offsets:i,coefficients:n,size:[s,o]}=e,a=r[0]>1,l=new ui;l.width=a?4*s:s,l.height=o,l.internalFormat=at.RGBA32F,l.dataType=Ks.FLOAT,l.samplingMode=Kt.NEAREST,l.wrapMode=nr.CLAMP_TO_EDGE;const c=new Float32Array(a?s*o*16:2*i.length);if(a&&n!=null)for(let u=0,h=0;u<n.length;u++)c[h++]=n[u],u%3==2&&(c[h++]=1);else for(let u=0;u<o;u++)for(let h=0;h<s;h++){const p=4*(u*s+h),f=2*(h*o+u);c[p]=i[f],c[p+1]=i[f+1],c[p+3]=i[f]===-1?0:1}return new Mr(t,l,c)}function Dbe(t,e){const r=new ui;return r.internalFormat=Ot.RGBA,r.width=e.length/4,r.height=1,r.samplingMode=Kt.NEAREST,r.wrapMode=nr.CLAMP_TO_EDGE,new Mr(t,r,e)}function gDt(t,e,r,i=1,n=!0){return{u_flipY:n,u_applyTransform:!!t,u_opacity:i,u_transformSpacing:t?t.spacing:u_,u_transformGridSize:t?t.size:u_,u_targetImageSize:e,u_srcImageSize:r}}function yDt(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function _Dt(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function vDt(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const Nbe={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let bDt=class{constructor(e,r,i=null,n=null){this.lij=e,this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.opacity=1,this.source=r,this.width=i||r.width,this.height=n||r.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=wt(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...Nbe,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||Nbe}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((r,i)=>{var n;return!!((n=this._bandIds)!=null&&n[i])&&r===this._bandIds[i]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const r=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(r==="bilinear"?Kt.LINEAR:Kt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=wt(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=mDt(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:r,width:i,height:n,opacity:s}=this,o=gDt(r,[i,n],[this.source.width,this.source.height],s),a=yDt(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?_Dt(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?vDt(this.symbolizerParameters):null;return new YN(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(r=>r!=null?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=wt(this._rasterTexture),this._transformGridTexture=wt(this._transformGridTexture),this._colormapTexture=wt(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=wt(this._rasterTexture));const n=r==null&&this.bandIds==null||r!=null&&this.bandIds!=null&&r.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&n)return;this._rasterTexture=wt(this._rasterTexture);const s=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=fDt(e,i,s,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((n,s)=>n!==r[s])?(this._colormapTexture=wt(this._colormapTexture),this._colormapTexture=Dbe(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=Dbe(e,i),void(this._colormap=i)):(this._colormapTexture=wt(this._colormapTexture),void(this._colormap=null))}},M8=class{constructor(){this.waitingAgents=new jt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const r=UW.acquire();return r._init(e),r}release(){this.dispose(),R8.delete(this),UW.release(this)}dispose(){this.loadingAgent=wt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=dP(this._data)}static prune(){UW.prune(0)}_init(e){this.waitingAgents.clear(),this._data=dP(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Ql(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,r){if(e!==r&&r!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),tDt(e,r,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){dP(this._data),this._data=e}};const UW=new fa(M8,null,()=>{}),R8=new Map;function wDt(){R8.size>0&&(console.log(`${R8.size} live TilePerLayerInfo allocations:`),R8.forEach(t=>console.log(t,`
`)))}let A$=class{constructor(e,r){this._texture=e,this._cache=r,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,this._refCount===0)if(this._cache){const e=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(e,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}};var pt;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.GEOMETRY=8]="GEOMETRY",t[t.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=32]="TEXTURE_FADING"})(pt||(pt={}));const xDt=.1;let xce=class{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Ht(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=Ht(),this.centerAtSeaLevel=C(),this._center=[C(),hs(),C()],this.up=qne(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=C(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}static prune(){Sce.prune(0),Tce.prune(0),M8.prune()}get _isCached(){return!this.isLeaf&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[_s.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,r=(e==null?void 0:e.frustumVisibility)??el.INTERSECTS;this._frustumVisibility=r===el.INSIDE?el.INSIDE:r===el.OUTSIDE?el.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==el.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}init(e,r,i,n,s){this._lij[0]=e,this._lij[1]=r,this._lij[2]=i,this.ellipsoid=zr(s.tilingScheme.spatialReference),s.tilingScheme.getExtent(e,r,i,this.extent),s.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,s.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[_s.MIDDLE][3]=0,this.elevationLevel=e,n&&!Number.isNaN(n.elevationBoundsMin)?(this._elevationBoundsMin=n.elevationBoundsMin,this._elevationBoundsMax=n.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=n,this.unsetChildren(),this._surface=s,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const o of rS){const a=s.numLayers(o),l=this.layerInfo[o];for(const c of l)c.release();l.length=a;for(let c=0;c<a;c++)l[c]=M8.acquire(this._surface.upsampleInfoPool),o===Zt.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(s.tilingScheme.pixelSize,uR)}dispose(){Vs(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of rS){for(const r of this.layerInfo[e])r.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Zt.MAP].reduce((e,r)=>e+(r instanceof kW?r.usedMemory/r.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){var i;if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=this._baseUsedMemory,this._mapTileMemoryInternal=0;let e=0;for(const{data:n}of this.layerInfo[Zt.MAP])n instanceof kW?e+=this._getTerrainDataMemory(n):this._mapTileMemoryInternal+=this._getTerrainDataMemory(n);const r=this._cpuImageMemorySize;for(const n of this.layerInfo[Zt.ELEVATION])this._usedMemory+=n.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=((i=this.renderData.texture)==null?void 0:i.usedMemory)??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,r){const i=this.layerInfo[e][r];return i!=null&&i.data?e===Zt.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):e===Zt.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof A$?e.texture.usedMemory:e instanceof HTMLImageElement||e instanceof gce?this._cpuImageMemorySize:e instanceof bDt?e.memoryUsage:e instanceof kW?e.usedMemory/e.referenced:0}updateScreenDepth(e){const r=this._center[_s.MIDDLE],i=e,n=r[0],s=r[1],o=r[2],a=i[2]*n+i[6]*s+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*n+i[7]*s+i[11]*o+i[15])}shouldSplit(e,r,i){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===el.OUTSIDE))return pt.NONE;const n=this.level;_e(sk,this._center[_s.MIDDLE],r);let s=nl(sk),o=sk,a=this._center[_s.MIDDLE];_e(zW,this._center[_s.TOP],r);const l=nl(zW);l<s&&(s=l,o=zW,a=this._center[_s.TOP]),_e(VW,this._center[_s.BOTTOM],r);const c=nl(VW);if(c<s&&(s=c,o=VW,a=this._center[_s.BOTTOM]),this._edgeLen2>s&&n<e.maxLod)return pt.SPLIT;const u=Math.sqrt(s),h=e.fovX*u*2,p=this._edgeLen/h,f=()=>{if(n<e.maxLod)return this.elevationLevel=n,pt.NONE;const M=n+Math.ceil(-Math.log2(e.relativeWidthLimit/p));return M!==this.elevationLevel?(this.elevationLevel=M,pt.ELEVATION):pt.NONE},g=i!=null?i-n:1/0;if(g<=.5)return f();const y=fe(this.up,sk),v=this._elevationBoundsMax-this._elevationBoundsMin,b=v/this.edgeLen;if(e.aboveGround&&y>0&&b<.001&&y/u-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return pt.NONE;const w=i!=null?3-Math.min(g,2):1;if(p*w<e.relativeWidthLimit||n>=e.maxLod)return f();if(n<7)return pt.SPLIT;oe(Xo,this.up,y),_e(Xo,Xo,o);const x=nl(Xo);if(x<=this.radius*this.radius)return pt.SPLIT;oe(Xo,Xo,this.radius/Math.sqrt(x)),ge(Xo,Xo,a),_e(Xo,r,Xo);const S=Math.min(1,(Math.abs(fe(Xo,this.up))+.5*v+this._curvatureHeight)/Te(Xo)),E=xDt/e.angledSplitBias,P=e.fovY*u*2;return S*(this._edgeLen/P*w)<E*e.relativeHeightLimit?pt.NONE:pt.SPLIT}setChildren(e,r,i,n){Vs(!!(e&&r&&i&&n),"Null child passed");const s=this._children;return s[0]=e,s[1]=r,s[2]=i,s[3]=n,s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of rS)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const r of rS){const i=this.layerInfo[r];for(const n of i)n.loadingAgent&&n.loadingAgent!==Qc&&(nk(n.loadingAgent),n.loadingAgent=null),n.pendingUpdates=0}this.resetPendingUpdate(pt.GEOMETRY),this.resetPendingUpdate(pt.TEXTURE_NOFADING),this.resetPendingUpdate(pt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[Zt.MAP];for(const r of e)r.loadingAgent&&r.loadingAgent!==Qc&&(nk(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(hT(e,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const n=i&&this._isWithinClippingArea,s=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||n||s||this.setPendingUpdate(pt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,r){return this.layerInfo[r][e]}hasLayerData(e,r){const i=this.layerInfo[r][e];return!(!(i!=null&&i.data)||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of rS){const r=this.layerInfo[e];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==Qc&&i.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(pt.SPLIT)||e!==Zt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){const r=this._pendingUpdates;return this._pendingUpdates|=e,e===pt.SPLIT||e===pt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),r!==this._pendingUpdates}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,r,i){const n=this.layerInfo[r][e];if(n.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),i.tile.lij.toString(),r,e),!0;if(n.waitingAgents.push(i),n.data&&!n.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),i.tile.lij.toString(),r,e);const a=n.data&&"type"in n.data&&n.data.type==="vector-tile";return i.dataArrived(this,a),!0}if(n.requestPromise)return!0;Ql(n.requestAbort),n.requestAbort=new AbortController;const s=this._surface.requestTileData(this,e,r,n.requestAbort);if(!s)return n.requestAbort=null,!1;const o=()=>{n.requestPromise===s&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=s,s.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this._lij[0]===e[0]&&this._lij[1]===e[1]&&this._lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const r=this._children;return r[0]?r[0].findByLij(e)||r[1].findByLij(e)||r[2].findByLij(e)||r[3].findByLij(e):null}distanceToSquared(e){return nl(_e(Xo,this._center[_s.MIDDLE],e))}containsPoint(e){const r=this.extent;return e[0]>=r[0]&&e[1]>=r[1]&&e[0]<=r[2]&&e[1]<=r[3]}containsPointXY(e,r){const i=this.extent;return e>=i[0]&&r>=i[1]&&e<=i[2]&&r<=i[3]}unrequestLayerData(e,r,i){const n=this.layerInfo[r][e],s=n.waitingAgents,o=s.removeUnordered(i)!=null;Vs(o,"agent has not requested this piece of map data"),s.length<1&&(n.abortRequest(),this.setMemoryDirty())}dataArrived(e,r,i){const n=i!=null&&"type"in i&&i.type==="vector-tile",s=this.layerInfo[r][e];s.data=i,s.dataInvalidated=!1,s.waitingAgents.forAll(o=>o.dataArrived(this,n)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,r,i){i.notInTilemap||console.error(`Tile ${this._lij.toString()} layer ${r}/${e} error ${i}`);const n=this.layerInfo[r][e];n.dataMissing=!0,n.waitingAgents.forAll(s=>s.dataMissing()),n.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,r,i){switch(i&&this.forEachLoadedNeighbor(n=>n.updateRenderData(e,r)),e){case Zt.MAP:return this._updateTexture(r);case Zt.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===Os.FADING?pt.TEXTURE_NOFADING:pt.TEXTURE_FADING),this.setPendingUpdate(e===Os.FADING?pt.TEXTURE_FADING:pt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(pt.GEOMETRY);for(const e of this.layerInfo[Zt.ELEVATION])e.pendingUpdates|=pt.GEOMETRY}invalidateLayerData(e,r){this.layerInfo[r][e].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const e=this._elevationBoundsMin,r=this._elevationBoundsMax;let i=1/0,n=-1/0;const s=this.layerInfo[Zt.ELEVATION];let o=!0;for(const a of s)a.elevationBounds!=null&&(i=Math.min(i,a.elevationBounds.min),n=Math.max(n,a.elevationBounds.max),a.elevationBounds.hasNoDataValues||(o=!1));o&&(i=Math.min(i,0),n=Math.max(n,0)),e===i&&r===n||(this._elevationBoundsMin=i,this._elevationBoundsMax=n,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBoundsMin,r=this._elevationBoundsMax,i=.5*(e+r),n=this._center;oe(Xo,this.up,i),ge(n[_s.MIDDLE],this.centerAtSeaLevel,Xo),oe(Xo,this.up,e),ge(n[_s.TOP],this.centerAtSeaLevel,Xo),oe(Xo,this.up,r),ge(n[_s.BOTTOM],this.centerAtSeaLevel,Xo)}findElevationBoundsForLayer(e,r){const i=this.layerInfo[Zt.ELEVATION][e],n=_Q(this.level),s=Math.max(this.elevationLevel-n,0),o=i.elevationBounds;if(o!=null&&o.level>=r&&o.level<=s)return;const a=this._surface.layerViewByIndex(e,Zt.ELEVATION),l=Ote(a);if(!iL(this,l,!1))return;const c=TDt;let u=!1;const h=i.data;if(h&&h.level<=s){const p=i.data;c.min=p.samplerData.data.minValue,c.max=p.samplerData.data.maxValue,c.hasNoDataValues=p.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let p,f,g=0;for(let y=this._parent;y&&(!f||g<n)&&(g=this.elevationLevel-y.level,p=f||p,f=y.layerInfo[Zt.ELEVATION][e].data,!(!f&&p&&y.level<=s));y=y.parent);f=f||p,f&&(f.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],c),c.min!==1/0&&(c.level=f.level,u=!0))}u&&(i.elevationBounds==null&&(i.elevationBounds=new S3),i.elevationBounds.copyFrom(c))}modifyLayers(e,r,i){const n=this.layerInfo[i];for(const a of n)a.loadingAgent&&a.loadingAgent!==Qc&&(nk(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<n.length;++a)e[a]===void 0&&n[a].release();const s=new Array(...n),o=r.length;n.length=o;for(let a=0;a<o;a++){const l=r[a];n[a]=l>-1?s[l]:M8.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,Os.FADING))}updateAgents(e){if(this.renderData){const r=this.layerInfo[e];for(const i of r)i.loadingAgent===Qc&&(i.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of rS){const r=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==Qc&&(i.loadingAgent.setSuspension(r),i.loadingAgent===Qc&&this.updateRenderData(e,Os.FADING))}}removeLayerAgent(e,r){const i=this.layerInfo[r][e];i.loadingAgent&&i.loadingAgent!==Qc&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,r){const i=this.layerInfo[r][e];i.loadingAgent=Qc,i.data||i.upsampleInfo!=null||this._createOrUpdateAgents(e+1,r)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||IP(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,r,i){var n,s,o;for(let a=e;a<r;++a){const l=this._surface.layerViewByIndex(a,i);if(DD(l)&&((n=l==null?void 0:l.layer)==null?void 0:n.blendMode)!=="normal"||IP((s=l==null?void 0:l.layer)==null?void 0:s.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,r){const i=this.layerInfo[r];if(i.length===0)return;const n=this._isSuspended(r);for(let s=e;s<i.length;++s){const o=i[s];let a=!1;const l=this._surface.layerViewByIndex(s,r),c=Ote(l);if(o.loadingAgent?iL(this,c,!1)?(o.loadingAgent!==Qc&&o.loadingAgent.setSuspension(n),o.loadingAgent!==Qc&&(a=o.loadingAgent.update())):o.dispose():iL(this,c,!1)&&(o.loadingAgent=SDt(this,s,r,n),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Qc&&this.setPendingUpdate(pt.GEOMETRY):(nk(o.loadingAgent),o.loadingAgent=Qc)),o.loadingAgent===Qc&&this.updateRenderData(r,Os.FADING),!this._hasBlendModes(e,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(e){const r=this.extent;return r[0]>=e[0]&&e[2]>=r[2]&&r[1]>=e[1]&&e[3]>=r[3]}intersectsExtent(e){const r=this.extent;return r[2]>=e[0]&&e[2]>=r[0]&&r[3]>=e[1]&&e[3]>=r[1]}getElevationVerticesPerSide(e){const r=this.elevationLevel-this.level,i=Math.max(this.level-e,_Q(this.level)-r),n=we(1+(this.maxTesselation>>i),2,this.maxTesselation+1),s=this.getDefaultVerticesPerSide();return Math.max(n,s)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,r){if(!e)return null;const i=this.surface.rootTiles;if(i!=null){for(const n of i)if(EDt(n,e)){let s=n,o=e[0]-s.level-1;for(;o>=0&&!s.isLeaf&&!r(s);){const a=e[1]>>o&1,l=e[2]>>o&1;s=s.children[2*a+l],o--}return r(s)?s:null}}return null}findNeighborTile(e,r){const i=this._lij,n=this.getNeighborLIJ(i,e);return n?$8(i,n)?r(this)?this:null:this._findLIJ(n,r):null}findCorner(e,r){const i=e===bt.NORTH_EAST?1:e===bt.NORTH_WEST?0:e===bt.SOUTH_WEST?2:3;let n=this;for(;n.children[0]&&(!r||!r(n));)n=n.children[i];return n}findNeighborCornerTileExact(e,r){var i;return((i=this.findNeighborTile(e,n=>r(n)||n.level===this.level))==null?void 0:i.findCorner(cV(e),r))||null}forAllSubtreeOnSide(e,r){const i=e===bt.NORTH?[0,1]:e===bt.NORTH_EAST?[1]:e===bt.EAST?[1,3]:e===bt.SOUTH_EAST?[3]:e===bt.SOUTH?[2,3]:e===bt.SOUTH_WEST?[2]:e===bt.WEST?[0,2]:[0],n=s=>{const o=s.children;!r(s)&&o[0]&&i.forEach(a=>n(o[a]))};n(this)}getNeighborEdgeStartVertexIndex(e,r){if(!r)return 0;const i=this.level-r.level;if($e(!uo||i>=0),i===0)return 0;const n=2**i,s=(1&e)==1,o=s?0:1,a=r.lij[o+1]*n,l=this._lij[o+1],c=l-a,u=s?n-1-c:c;return uo&&($e(a<=l&&l<a+n),$e(0<=u&&u<n)),u}forEachLoadedNeighbor(e){const r=this.level,i=n=>n.level===r||n.isLoaded;Hf.forEach(n=>{const s=this.findNeighborTile(n,i);s!=null&&s!==this&&s.forAllSubtreeOnSide(vce(n),o=>!!o.isLoaded&&(e(o,n),!0))}),uV.forEach(n=>{var o;const s=(o=this.findNeighborTile(n,i))==null?void 0:o.findCorner(cV(n),a=>a.isLoaded);$e(!s||Nte(this,s,n)),s!=null&&s.isLoaded&&e(s,n)})}getNeighborLIJ(e,r){const i=Rbe(r)?-1:Mbe(r)?1:0,n=Abe(r)?-1:Obe(r)?1:0,s=[e[0],e[1]+i,e[2]+n];return s[1]<0?null:this.surface.isGlobal?this.wrapLIJ(s):s[2]<0?null:s}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this._lij[2]===0}get isNorthEnd(){return this._lij[1]===0}get isSouthEnd(){const e=this.surface.extent,r=(e==null?void 0:e[1])??null;return r!=null&&this.extent[1]+ml()>=r}checkGeometryWaterproofness(){var e;aV&&($e(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const r=this.extent,i=this.surface.rootTilesExtent,n=.25*(r[2]-r[0]);if(Rbe(e)&&r[3]+n>=i[3]||Mbe(e)&&r[1]-n<=i[1])return!1;const s=this.surface.isGlobal;return!(!s&&Abe(e)&&r[0]-n<=i[0])&&!(!s&&Obe(e)&&r[2]+n>=i[2])}updateDistanceToPOI(e){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return;he(this._lastPOI,e);const i=this._center[_s.MIDDLE],n=e[0]-i[0],s=e[1]-i[1],o=e[2]-i[2];this.distanceToPOI=n*n+s*s+o*o}};function SDt(t,e,r,i){const n=r===Zt.ELEVATION?Tce.acquire():Sce.acquire();return n.init(t,e,r,i),n}function nk(t){t.dispose(),t instanceof VUe?Tce.release(t):t instanceof BUe&&Sce.release(t)}const Sce=new fa(BUe),Tce=new fa(VUe),TDt=new S3;var _s;function EDt(t,e){const r=t.lij,i=e[0]-r[0];return!(i<0)&&e[1]>>i===r[1]&&e[2]>>i===r[2]}function $8(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function CDt(t,e,r){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&r===bt.EAST||t.isWestEnd&&e.isEastEnd&&r===bt.WEST))return!0;const i=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(r){case bt.NORTH:return zd(t.extent[3],e.extent[1],i);case bt.SOUTH:return zd(t.extent[1],e.extent[3],i);case bt.EAST:return zd(t.extent[2],e.extent[0],i)||zd(t.extent[2],-e.extent[0],i);case bt.WEST:return zd(t.extent[0],e.extent[2],i)||zd(t.extent[0],-e.extent[2],i)}}function Nte(t,e,r){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?Fbe(t,e,r):Fbe(e,t,cV(r)))}function Fbe(t,e,r){$e(t.level>=e.level);const i=NLt(r),n=FLt(r),s=t.extent,o=e.extent,a=[i?s[0]:s[2],n?s[3]:s[1]],l=[i?o[2]:o[0],n?o[1]:o[3]],c=1e-5*(s[2]-s[0]),u=zd(a[0],l[0],c)||t.surface.isGlobal&&zd(a[0],-l[0],c),h=zd(a[1],l[1],c);if(u&&h)return!0;if(t.level===e.level||!u&&!h)return $e(!1),!1;const p=u?kbe(o[1],o[3],s[1],s[3],c):kbe(o[0],o[2],s[0],s[2],c);return $e(p),p}function kbe(t,e,r,i,n){return t-n<=r&&r<=i&&i<=e+n}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(_s||(_s={}));const sk=C(),zW=C(),VW=C(),Xo=C();let PDt=class{constructor(){this._scales=Xt(-1,-1,-1,-1),this._offsets=Xt(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,r,i){this._scales[2*e]=r,this._scales[2*e+1]=i}setOffset(e,r,i){this._offsets[2*e]=r,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}};function ADt(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(T`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}var jg;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(jg||(jg={}));let ODt=class extends dle{constructor(){super(...arguments),this.overlayOpacity=1}};function MDt(t,e){const{vertex:r,fragment:i,varyings:n}=t;n.add("vtc","vec2"),r.uniforms.add(new Ube("texOffsetAndScale")),i.uniforms.add(new zbe("tex")),i.uniforms.add(new BW("textureOpacities"));const s=e.textureFadingEnabled&&!e.renderOccluded;s&&(r.uniforms.add(new Ube("nextTexOffsetAndScale")),n.add("nvtc","vec2"),i.uniforms.add(new zbe("texNext")),i.uniforms.add(new BW("nextTexOpacities")),i.uniforms.add(new RDt("fadeFactor")));const o=e.tileBlendInput===jg.ColorComposite,a=e.tileBlendInput===jg.GridComposite;a&&i.include(wce),o&&i.uniforms.add(new BW("backgroundColor")),r.code.add(T`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${s?T`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:T``}
  }`),i.code.add(T`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?T`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?T`backgroundColor`:T`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:T`return color;`}
    }`),s?i.code.add(T`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(T`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let RDt=class extends Pn{constructor(e){super(e,"float")}},BW=class extends Pn{constructor(e){super(e,"vec3")}},Ube=class extends Pn{constructor(e){super(e,"vec4")}},zbe=class extends Pn{constructor(e){super(e,"sampler2D")}},Ece=class extends ODt{};function XUe(t){const e=new Fr,{vertex:r,fragment:i,varyings:n}=e;e.include(RN),e.include(lO,t),e.include(Jg,t);const s=()=>{e.include(MD,t),r.code.add(T`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};Uu(r,t),e.include($c,t);const o=t.overlayMode!==Vg.Disabled,a=o&&t.invisible;switch(t.output){case G.Color:{e.include(MDt,t),e.include(s2,t),o&&e.include(mM,{...t,pbrMode:t.pbrMode===ht.Simplified?ht.TerrainWithWater:ht.Water});const l=t.overlayMode===Vg.EnabledWithWater;l&&e.include(ADt,t),n.add("vnormal","vec3"),n.add("vpos","vec3"),n.add("vup","vec3"),s(),t.screenSizePerspective&&hA(r);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(nO,t),t.screenSizePerspective&&(n.add("screenSizeDistanceToCamera","float"),n.add("screenSizeCosAngle","float")),r.code.add(T`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?T`forwardVertexTangent(vnormal);`:T``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?T`setOverlayVTC(uv);`:""}
          ${t.tileBorders?T`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?T`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?T`forwardLinearDepth();`:""}

        }
      `),e.include(Wn,t),e.include(s2,t),e.include(UN,t),e.include(_A,t),mm(i,t),zN(i),uO(i),i.uniforms.add(r.uniforms.get("localOrigin"),new zt("viewDirection",(u,h)=>me(Vbe,se(Vbe,h.camera.viewMatrix[12],h.camera.viewMatrix[13],h.camera.viewMatrix[14])))),l&&i.uniforms.add(new ft("ovWaterTex",(u,h)=>{var p;return(p=h.overlay)==null?void 0:p.getTexture(Wi.WaterNormal)}),new GDe("view",(u,h)=>Fc($Dt,h.camera.viewMatrix,u.origin))),i.code.add(T`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),R_(i),by(i),i.code.add(T`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?T`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?T`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===ht.Simplified||t.pbrMode===ht.TerrainWithWater?T`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:T`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?T`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?T`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?T`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:T`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?T`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case G.LinearDepth:a&&e.include(mM,t),e.include(g_,t),Bb(e),r2(e),r.code.add(T`
              void main(void) {
                ${a?T`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(T`
              void main() {
                ${a?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:e.include(g_,t),Bb(e),r2(e),r.code.add(T`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(T`void main() {
outputDepth(linearDepth);
}`);break;case G.Normal:a&&e.include(mM,t),n.add("vnormal","vec3"),hA(r),s(),r.code.add(T`
        void main(void) {
          ${a?T`setOverlayVTC(getUV0());`:""}
          gl_Position = transformPosition(proj, view, position);
          vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
        }
      `),i.code.add(T`
        void main() {
          ${a?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) {
            normal = -normal;
          }
          fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
        }
      `);break;case G.Highlight:o&&e.include(mM,t),r.code.add(T`
          void main() {
            ${o?T`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(gw,t),i.code.add(T`
          void main() {
            ${o?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===G.ObjectAndLayerIdColor&&(o?(e.include(mM,{...t,pbrMode:ht.Disabled}),r.code.add(T`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(T`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(r.code.add(T`void main(void) {}`),i.code.add(T`void main() {
fragColor = vec4(0.0);
}`))),e}const $Dt=xe(),Vbe=C(),IDt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Ece,build:XUe},Symbol.toStringTag,{value:"Module"}));let ZUe=class JUe extends Zr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,r){r.spherical=e.viewingMode===Fe.Global}initializeProgram(e){return new Br(e.rctx,JUe.shader.get().build(this.configuration),QUe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Bt({blending:r.renderOccluded?qu(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA):null,culling:i?nae:null,depthTest:r.renderOccluded?null:{func:si.LESS},depthWrite:r.renderOccluded?null:Wu,colorWrite:rr,stencilTest:e?ebt(Lc.IntegratedMeshMaskExcluded):null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};ZUe.shader=new Vr(IDt,()=>re(()=>Promise.resolve().then(()=>zjt),void 0));const QUe=new Map([[R.POSITION,0],[R.UV0,1],[R.NORMALCOMPRESSED,2]]);let LDt=class{constructor(){this.geometry=new qLt,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureRef=new FUe(()=>this.tile.surface.fadeDuration),this.overlay=new PDt,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(e,r){this.clear(),this._tile=e,this.geometry.reset(),this.intersectionData=null,this.geometryState=new YLt,this._localOrigin=r,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),uo&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)$e(this.geometry.getEdgeCount(r)===this.geometryState.edgeResolutions[r]+1)}_calculateEdgeResolution(e,r){var l;const i=this.tile,n=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const c=i.surface.extent;if(c!=null&&(e===0&&i.extent[3]>c[3]||e===1&&i.extent[2]>c[2]||e===2&&i.extent[1]<c[1]||e===3&&i.extent[0]<c[0]))return n}const s=i.level,o=Hf[e];if(!r)return $e(((l=i.surface)==null?void 0:l.rootTiles)==null||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),n;if(r.isLoaded){const c=r,u=c.renderData.geometryState,h=s-c.level;if($e(h>=0),h===0){const g=u.numVerticesPerSide-1;return Math.max(g,n)}const p=2**h,f=u.edgeResolutions[(e+2)%4]/p;return Math.max(1,f)}$e(!r.isLeaf);let a=n;return r.forAllSubtreeOnSide(vce(o),c=>c===i||(c.isLoaded?(a=Math.max(a,2**(c.level-s)),!0):($e(!c.isLeaf),!1))),a}updateNeighborData(){var o;const e=this.tile;if(!e.intersectsClippingArea)return;const r=e.renderData.geometryState,i=a=>(a.isLoaded||a.level===e.level)&&(a==null?void 0:a.intersectsClippingArea),n=r.edgePeerNeighbors,s=r.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const l=e.findNeighborTile(Hf[a],i),c=$S(e,l),u=((o=c==null?void 0:c.renderData)==null?void 0:o.geometryState.samplerDataVersion)??-1,h=n[a],p=c!==$S(e,h),f=s[a]!==u;uo&&l&&($e(e.level>=l.level),$e(e.level-l.level<=Hs)),n[a]=l,(p||f)&&(s[a]=u,this._markEdgeDirty(a));const g=r.edgeResolutions[a],y=this._calculateEdgeResolution(a,l);$e(jL(y)),$e(y>=1),r.edgeResolutions[a]=y,g!==y&&this._markEdgeResolutionDirty(a)}for(let a=0;a<4;++a){const l=e.findNeighborTile(uV[a],i);r.cornerPeerNeighbors[a]=l;const c=$S(e,n[a]),u=$S(e,n[(a+1)%4]),h=$S(e,l);zp[a]=h,zp[(a+1)%4]=u,zp[(a+2)%4]=e,zp[(a+3)%4]=c,$e(zp.some(y=>(y==null?void 0:y.isLoaded)||y===e));const p=zp.reduce((y,v)=>Math.min(y,(v==null?void 0:v.level)??1/0),1/0);zp.forEach((y,v)=>{y&&(y==null?void 0:y.level)>p&&(zp[v]=null)}),$e(zp.some(y=>(y==null?void 0:y.isLoaded)||y===e));const f=r.cornerNeighborCornerTiles,g=r.cornerNeighborCornerTileSamplerVersions;for(let y=0;y<4;++y){const v=zp[y],b=(v==null?void 0:v.renderData.geometryState.samplerDataVersion)??-1,w=4*a+y,x=f[w]!==v,S=!x&&g[w]!==b;(x||S)&&(f[w]=v,g[w]=b,this._markCornerDirty(a))}uo&&$e(Cce.some(y=>{var v;return((v=f[4*a+y])==null?void 0:v.isLoaded)||f[4*a+y]===e}))}uo&&$e(this.geometryState.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)zp[a]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;uo&&$e(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(f=>f>0)),this.intersectionData=null;const{tile:r,_vao:i,geometry:n,geometryState:s}=this,o=!i||!1||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,a=this.dirtyEdgeResolutions!==0,l=s.edgeResolutions.reduce((f,g)=>f+g+1,0),c=o||a&&l>((n==null?void 0:n.maxEdgeVertexCount)??0),u=!c&&a,h=!u&&(this.dirtyEdges!==0||a),p=!h&&this.dirtyCorners!==0;c?(this.releaseGeometry(),this._createGeometry(e)):u?r.updateEdgeElevationsAndResolutions():h||p?r.updateEdgeElevations():p?r.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=wt(this._vao),this.geometry.release(),!0)}ensureTexture(e,r,i){const n=r?Ot.RGBA:Ot.RGB;return this._texture==null||this._texture.descriptor.width===e&&this._texture.descriptor.pixelFormat===n||this.releaseTexture(),this._texture==null&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}get numVerticesPerSideChanged(){return(this._modifiedFlags&NDt)!=0}get samplerDataChanged(){return(this._modifiedFlags&FDt)!=0}get clippingAreaChanged(){return(this._modifiedFlags&kDt)!=0}get wireframeChanged(){return(this._modifiedFlags&UDt)!=0}get dirtyEdges(){return this._modifiedFlags>>GW&15}get dirtyCorners(){return this._modifiedFlags>>jW&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>HW&15}_markCornerDirty(e){const r=1<<e<<jW;this._modifiedFlags|=r}_markEdgeDirty(e){const r=1<<e<<GW;this._modifiedFlags|=r,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const r=1<<e<<HW;this._modifiedFlags|=r,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<jW|15<<GW|15<<HW}updateGeometryState(){const e=this._getElevationInfo(),r=this.tile,i=e.samplerData?r.getElevationVerticesPerSide(e.maxTileLevel):r.getDefaultVerticesPerSide(),n=Math.max(i,5);let s=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(s=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==n&&(this._modifiedFlags|=1,o.numVerticesPerSide=n,o.samplerDataVersion++,a=!0),e.changed&&(this._modifiedFlags|=2,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),ny(o.clippingArea,s)||(this._modifiedFlags=4,o.clippingArea=s,a=!0);const l=r.surface.wireframe;return o.wireframe!==l&&(this._modifiedFlags=8,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const r=this.geometry.vertexAttributes,i=this.geometry.indices,n=e.gl;this._vao=new wm(e,QUe,{geometry:Ju(r.layout)},{geometry:ti.createVertex(e,n.STATIC_DRAW,r.buffer)},ti.createIndex(e,n.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,r=fb.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,r=this.tile.layerInfo[Zt.ELEVATION],i=r.length,n=new Array(i);let s=0,o=0,a=!1;for(let u=0;u<i;u++){const h=r[u];if(h.upsampleInfo!=null){const p=h.upsampleInfo.tile,f=p.layerInfo[Zt.ELEVATION][u].data,g=f&&f.samplerData;e&&e[s]===g||(a=!0),n[s++]=g,o=Math.max(o,p.lij[0])}else if(h.data){const p=this.tile.surface.layerViewByIndex(u,Zt.ELEVATION);if(iL(this.tile,p.layer,!1)){const f=h.data;e&&e[s]===f.samplerData||(a=!0),n[s++]=f.samplerData,o=this.tile.level}}}e!=null&&e.length!==s&&(a=!0);const l=s>0,c=l?n:null;return l&&(n.length=s),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var r,i,n;const e=((r=this.intersectionData)==null?void 0:r.estimatedMemoryUsage)??0;return(((i=this.geometry.indices)==null?void 0:i.byteLength)??0)+(((n=this.geometry.vertexAttributes)==null?void 0:n.byteLength)??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!uo)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void $e(e==null?void 0:e.isLoaded);const r=e.surface.extent;if(r!=null&&!e.intersectsExtent(r))return;const i=Hf.map((a,l)=>r!=null&&(l<2?-1:1)*(e.extent[3-l]-r[3-l])<0),n=e.level;$e(this.dirtyCorners===0),$e(this.dirtyEdges===0),$e(this.dirtyEdgeResolutions===0),$e(!this.numVerticesPerSideChanged),$e(!this.samplerDataChanged),$e(!this.clippingAreaChanged),$e(!this.wireframeChanged);const s=uV.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a!=null&&a.intersectsClippingArea?a:null),o=this.geometryState;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=s[a];$e(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}Hf.forEach((a,l)=>{if(i[l])return;const c=e.findNeighborTile(a,q=>(q.level===n||(q==null?void 0:q.isLoaded))&&(q==null?void 0:q.intersectsClippingArea));if(!c){const q=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void $e(!q)}$e(c.isLoaded||c.level===e.level),$e(c===this.geometryState.edgePeerNeighbors[l]);const u=n-c.level;if(!c.isLoaded)return $e(!c.isLeaf),void $e(u===0);const h=c.renderData;$e(CDt(e,c,a)),$e(u>=0);const p=2**u;if(u<0)return void $e(!1);const f=e.renderData,g=f.geometry,y=f.localOrigin,v=g.getEdgeCount(l),b=g.numVerticesPerSide-1,w=h.geometry;if(!w)return void $e(!1);const x=h.localOrigin,S=this.geometryState.edgePeerNeighbors[l];if(S!=null&&S.isLoaded){const q=S.renderData;$e(f.geometryState.edgePeerNeighborSamplerVersions[l]===q.geometryState.samplerDataVersion),$e(this.geometryState.edgePeerNeighborSamplerVersions[l]===q.geometryState.samplerDataVersion)}const E=(l+2)%4,P=w.getEdgeCount(E),M=v-1,L=P-1;$e(M*p===L,`Tile[${e.lij}]:e${l},res=${M} edgeRes mismatch with Neighbor[${c.lij}]:e${E},res=${L} (expected:${M*p})`);const U=e.extent,z=a===bt.NORTH||a===bt.SOUTH,W=P-1,V=W>>u,J=v-1;if(V<1)return void $e(J===1);$e(V===J),$e(jL(V));const Y=w.numVerticesPerSide-1;$e(u>0||V===Math.max(Y,b));const X=e.getNeighborEdgeStartVertexIndex(l,c);$e(0<=X&&X<p);const le=X*V;$e(0<=le&&le<=W-V);let D=0,I=le;g.getEdgeVertexPosition(l,qm,y,0),g.getEdgeVertexPosition(l,Wm,y,v-1);const k=Bi(qm,Wm),j=Math.max(DDt,1e-4*k);for(let q=0;q<=V;++q){g.getEdgeVertexPosition(l,qm,y,D),w.getEdgeVertexPosition(E,Wm,x,I);const Q=q/V,ie=z?U[0]+Q*(U[2]-U[0]):a===bt.WEST?U[0]:U[2],ye=z?a===bt.SOUTH?U[1]:U[3]:U[1]+Q*(U[3]-U[1]),Ae=e.surface.extent;if(Ae==null||RB(Ae,ie,ye)){const Ze=B0(qm,Wm),Et=uu(qm)-ni.radius,xt=uu(Wm)-ni.radius,Qe=Ze<j;if(!Qe){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${D}/${v}] and [${c.lij}].edge${E}[${I}/${P}]`),Ae!=null&&console.warn("  surface extent= ",Ae," x,y=",ie,",",ye);const Jt=C();_e(Jt,f.localOrigin,h.localOrigin),uu(Jt)>0&&console.warn(`   localOrigins: ${f.localOrigin} vs ${h.localOrigin} d=${uu(Jt)} [${Jt}]`),(()=>{const Be=nn(qm),wr=nn(Wm);e.updateEdgeElevations(),c.updateEdgeElevations(),g.getEdgeVertexPosition(l,qm,y,D),w.getEdgeVertexPosition(E,Wm,x,I);const Re=C();rn(Re,qm,Be),uu(Re)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${Be} vs ${qm} d=${uu(Re)} [${Re}]`),rn(Re,Wm,wr),uu(Re)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${wr} vs ${Wm} d=${uu(Re)} [${Re}]`)})();const Rr=g.getEdgeCount(l),Gi=w.getEdgeCount(P);$e(Qe,`Mismatch in tile [${e.lij}].edge[${l}][${D}/${Rr}] vs neighbor [${c.lij}].edge[${E}][${I}/${Gi}] ${Hy(qm)} vs ${Hy(Wm)}  dist=${Ze} h(t|n|d)=${Et}|${xt}|${xt-Et}`)}g.getEdgeNormal(l,DE,D),w.getEdgeNormal(E,NE,I),me(Bbe,DE),me(Gbe,NE);const Ke=fe(Bbe,Gbe),Ge=1-Ke<.01||!1||e===c;if(!Ge){const Jt=C();rn(Jt,DE,NE);const Rr=()=>`Mismatch in tile edge normal ${Pbe(e.lij)} (${D}/${v-1}) edge ${l} vs neighbor ${Pbe(c.lij)}  (${I}/${P-1}) nedge ${E} :${Hy(DE)} vs ${Hy(NE)}  dot = ${Ke} : ${Hy(Jt)}`;console.warn("Mismatch in tile edge normal: ",Rr());{e.updateEdgeElevations(),c.updateEdgeElevations();const Gi=C(),Be=C();g.getEdgeNormal(l,Gi,D),w.getEdgeNormal(E,Be,I),HT(DE,Gi)||console.warn("Missing update in tile normal: ",Hy(DE)," => ",Hy(Gi)),HT(NE,Be)||console.warn("Missing update in neighbor normal: ",Hy(NE)," => ",Hy(Be))}$e(Ge,Rr())}}D+=1,I+=1}})}};const qm=C(),Wm=C(),DE=C(),NE=C(),Bbe=C(),Gbe=C(),DDt=1,zp=[null,null,null,null];function $S(t,e){return e!=null&&e.isLoaded||e===t?e:null}const NDt=1,FDt=2,kDt=4,UDt=8,GW=4,jW=8,HW=12,Cce=[0,1,2,3],zDt=65536;function VDt(t,e){const{tile:r,geometry:i,geometryState:n}=t,{extentInRadians:s,surface:o}=r,{isWebMercator:a,renderer:l}=o,{numVerticesPerSide:c,wireframe:u}=n,h=c-1,p=(c-2)**2,f=a&&(e===Ud.HAS_SOUTH_POLE||e===Ud.HAS_BOTH_POLES),g=a&&(e===Ud.HAS_NORTH_POLE||e===Ud.HAS_BOTH_POLES),y=((f?1:0)+(g?1:0))*I8*c,v=pze(n),b=p+y+4*v,w=l.tileGeometryCache.acquire(b);i.numVerticesPerSide=c,i.vertexAttributes=w,i.maxEdgeVertexCount=v;const{boundingBox:x}=i;zi(x);const S=Ace(t);ta.update(h,s,S),GDt(t),i.poleVerticesStartIndex=p;const E=BDt(t,f,g);i.edgeVerticesStartIndex=p+y,Mce(t),Pce(t),sze(i,E,u),t.intersectionData=null}function BDt(t,e,r){const{tile:i,localOrigin:n,geometry:s}=t,{extent:o,ellipsoid:a}=i,{boundingBox:l,numVerticesPerSide:c,vertexAttributes:u,poleVerticesStartIndex:h}=s,p=c-1,f=n[0],g=n[1],y=n[2],v=a.radius,b=o[1],w=o[3],x=[];let S=h;const E=(P,M)=>{const L=M*c;tp(-f,-g,P*v-y,l),x.push({connectedRowOffset:L,connectedOuterEdgeOffset:P===1?0:2,rowOffset:S,latitudeResolution:I8});const U=tze(P===-1?b:w,v),z=P*Math.PI/2-U,W=.99*(P===1?1:-1),V=v+0,{position:J,uv0:Y}=u,{typedBuffer:X,typedBufferStride:le}=u.normalCompressed;for(let D=1;D<=I8;++D){const I=U+z*(D/I8),k=Math.cos(I),j=Math.sin(I);for(let q=0;q<=p;q++){const Q=q/p,ie=ta.sinLonLUT[q],ye=ta.cosLonLUT[q]*k,Ae=ie*k,Ze=j,Et=ye*V-f,xt=Ae*V-g,Qe=Ze*V-y;tp(Et,xt,Qe,l),J.setValues(S,Et,xt,Qe),im(Y,S,Q,W),_m(X,S,ye,Ae,Ze,le),++S}}};return e&&E(-1,0),r&&E(1,p),x}function GDt(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:r,geometryState:i,localOrigin:n}=t,{numVerticesPerSide:s,samplerData:o}=i,a=s-2,l=s-1,{vertexAttributes:c,boundingBox:u}=r,h=c.position,p=c.uv0,{typedBuffer:f,typedBufferStride:g}=c.normalCompressed,{extent:y}=e,v=y[0],b=y[2],w=y[1],x=y[3],S=e.ellipsoid.radius,E=n[0],P=n[1],M=n[2],L=h.typedBuffer,U=h.typedBufferStride,z=1/l;let W=0;if(1<=a){const V=z,J=w*(1-V)+x*V,Y=ta.sinLatLUT[1],X=ta.cosLatLUT[1];for(let le=1;le<=a;le++){const D=le*z,I=v*(1-D)+b*D,k=ta.sinLonLUT[le],j=ta.cosLonLUT[le],q=S+xn(I,J,o),Q=q*j*X-E,ie=q*k*X-P,ye=q*Y-M;tp(Q,ie,ye,u);const Ae=(le-1)*U;L[Ae]=Q,L[Ae+1]=ie,L[Ae+2]=ye,im(p,le-1,D,V)}}for(let V=1;V<=a;V++){const J=V*z,Y=w*(1-J)+x*J,X=ta.sinLatLUT[V],le=ta.cosLatLUT[V],D=V+1,I=D*z,k=w*(1-I)+x*I,j=ta.sinLatLUT[D],q=ta.cosLatLUT[D],Q=ta.sinLonLUT[0],ie=ta.cosLonLUT[0],ye=S+xn(v,Y,o);let Ae=ie*le*ye-E,Ze=Q*le*ye-P,Et=X*ye-M;const xt=W*U;let Qe=L[xt],Ke=L[xt+1],Ge=L[xt+2];for(let Jt=1;Jt<=a;Jt++){const Rr=Jt*z,Gi=v*(1-Rr)+b*Rr,Be=ta.sinLonLUT[Jt],wr=ta.cosLonLUT[Jt];let Re=0,qe=0,At=0;if(Jt<a){const _r=(W+1)*U;Re=L[_r],qe=L[_r+1],At=L[_r+2]}else{const _r=ta.sinLonLUT[l],ji=ta.cosLonLUT[l],Nn=S+xn(b,Y,o);Re=ji*le*Nn-E,qe=_r*le*Nn-P,At=X*Nn-M}const Gt=Ae,Je=Ze,$t=Et;Ae=Qe,Ze=Ke,Et=Ge,Qe=Re,Ke=qe,Ge=At;const Le=Re-Gt,ot=qe-Je,It=At-$t;let _i=0,Jr=0,Di=0;if(V>1){const _r=(W-a)*U;_i=L[_r],Jr=L[_r+1],Di=L[_r+2]}else{const _r=ta.sinLatLUT[0],ji=ta.cosLatLUT[0],Nn=S+xn(Gi,w,o);_i=wr*ji*Nn-E,Jr=Be*ji*Nn-P,Di=_r*Nn-M}const Gr=S+xn(Gi,k,o),ii=wr*q*Gr-E,xr=Be*q*Gr-P,jr=j*Gr-M;if(V<a){const _r=W+a,ji=_r*U;L[ji]=ii,L[ji+1]=xr,L[ji+2]=jr,tp(ii,xr,jr,u),im(p,_r,Rr,I)}const Cr=_i-ii,oi=Jr-xr,Mt=Di-jr;let pr=wr*le,Pr=Be*le,vi=X;vi*vi<.999&&(pr=It*oi-ot*Mt,Pr=Le*Mt-It*Cr,vi=ot*Cr-Le*oi);const ps=1/Math.sqrt(pr*pr+Pr*Pr+vi*vi);_m(f,W,pr*ps,Pr*ps,vi*ps,g),++W}}}function jDt(t){t.tile.intersectsClippingArea&&(Pce(t),fO(t),t.intersectionData=null)}function HDt(t){t.tile.intersectsClippingArea&&(lze(t),Pce(t),fO(t),hze(t),t.intersectionData=null)}function qDt(t){t.tile.intersectsClippingArea&&(eze(t),KUe(t,!0),fO(t),t.intersectionData=null)}function Pce(t){t.tile.intersectsClippingArea&&(eze(t),KUe(t))}function KUe(t,e=!1){const{geometry:r,geometryState:i,tile:n,localOrigin:s}=t,{level:o,extent:a,extentInRadians:l,ellipsoid:c}=n,u=c.radius,h=l[0],p=l[2],f=l[1],g=l[3],{samplerData:y}=i,v=a[0],b=a[2],w=a[1],x=a[3],S=Ace(t),{boundingBox:E,vertexAttributes:P}=r,M=s[0],L=s[1],U=s[2],z=P.position,W=z.typedBuffer,V=z.typedBufferStride,J=P.uv0;for(let Y=0;Y<4;++Y){const X=Y===1||Y===3,le=i.edgeResolutions[Y];$e(jL(le));const D=le+1,I=$S(n,i.edgePeerNeighbors[Y]);if(dze(n,I,Y)){cze(t,Y,I);continue}const k=I!=null;$e(!k||I.level===n.level),$e(!k||Q0(n,I)<=0);const j=I==null?void 0:I.renderData,q=j==null?void 0:j.geometryState;if(uo){const Le=n.surface;if(!I&&Le&&!Le.updatingRootTiles){const ot=Hf[Y],It=n.findNeighborTile(ot,_i=>_i.isLoaded||_i.isLeaf||_i.level===n.level);It?It.intersectsClippingArea&&($e(!It.isLoaded),$e(!It.isLeaf),$e(It.level===o)):$e((Le==null?void 0:Le.rootTiles)==null||!n.shouldHaveNeighbor(ot))}}const Q=Y===1?a[2]:a[0],ie=I==null?void 0:I.extent,ye=ie&&X?Y===1?ie[0]:ie[2]:Q,Ae=Y===0?a[3]:a[1],Ze=Y===1?1:0,Et=Y===0?1:0,xt=Y===1?p:h,Qe=Y===0?g:f,Ke=Math.sin(xt),Ge=Math.cos(xt),Jt=Math.sin(Qe),Rr=Math.cos(Qe),Gi=q==null?void 0:q.samplerData,Be=k?(Le,ot,It)=>.5*(xn(Le,ot,y)+xn(It,ot,Gi)):(Le,ot,It)=>xn(Le,ot,y),wr=r.outerEdgesOffsetAndLength[2*Y+0],Re=e&&D>3?D-3:1,qe=y!=null&&y.some(Le=>Le!=null),At=Gi!=null&&Gi.some(Le=>Le!=null),Gt=qe||At,Je=1/le,$t=wr;$e(!ie||zd(ie[2]-ie[0],a[2]-a[0])),(()=>{const Le=Y===1?-1:Y===3?1:0,ot=Y===0?-1:Y===2?1:0,It=(a[2]-a[0])*Je,_i=Le*It,Jr=ot*It,Di=X?Le*((p-h)*Je):0,Gr=X?0:ot*Je,ii=Et,xr=X?xt+Di:xt,jr=X?Math.sin(xr):Ke,Cr=X?Math.cos(xr):Ge,oi=X?xt-Di:xt,Mt=X?Math.sin(oi):Ke,pr=X?Math.cos(oi):Ge,Pr=X?Qe:S(ii+Gr),vi=X?Jt:Math.sin(Pr),ps=X?Rr:Math.cos(Pr),_r=X?Qe:S(ii-Gr),ji=X?Jt:Math.sin(_r),Nn=X?Rr:Math.cos(_r);let qo=0,yl=0,_l=0;{const Sr=0*Je,Ji=X?Q:v*(1-Sr)+b*Sr,Fs=X?ye:Ji,bo=X?w*(1-Sr)+x*Sr:Ae,ue=X?xt:h*(1-Sr)+p*Sr,Qr=X?Ke:Math.sin(ue),Tp=X?Ge:Math.cos(ue),wo=X?S(Sr):Qe,Ep=X?Math.sin(wo):Jt,mt=X?Math.cos(wo):Rr,Hc=u+Be(Ji,bo,Fs);qo=Tp*mt*Hc,yl=Qr*mt*Hc,_l=Ep*Hc}let Wo=0,Ss=0,Fn=0;{const Sr=1*Je,Ji=X?Q:v*(1-Sr)+b*Sr,Fs=X?ye:Ji,bo=X?w*(1-Sr)+x*Sr:Ae,ue=X?xt:h*(1-Sr)+p*Sr,Qr=X?Ke:Math.sin(ue),Tp=X?Ge:Math.cos(ue),wo=X?S(Sr):Qe,Ep=X?Math.sin(wo):Jt,mt=X?Math.cos(wo):Rr,Hc=u+Be(Ji,bo,Fs);Wo=Tp*mt*Hc,Ss=Qr*mt*Hc,Fn=Ep*Hc}for(let Sr=1;Sr<D-1;Sr+=Re){let Ji=0,Fs=0,bo=0;{const vl=(Sr+1)*Je,qc=X?Q:v*(1-vl)+b*vl,Sm=X?ye:qc,So=X?w*(1-vl)+x*vl:Ae,An=X?xt:h*(1-vl)+p*vl,z_=X?Ke:Math.sin(An),Tw=X?Ge:Math.cos(An),Ew=X?S(vl):Qe,N2=X?Math.sin(Ew):Jt,Cw=X?Math.cos(Ew):Rr,V_=u+Be(qc,So,Sm);Ji=Tw*Cw*V_,Fs=z_*Cw*V_,bo=N2*V_}const ue=Ji,Qr=Fs,Tp=bo,wo=Wo,Ep=Ss,mt=Fn;Wo=ue,Ss=Qr,Fn=Tp;{const vl=$t+Sr,qc=vl*V,Sm=wo-M,So=Ep-L,An=mt-U;W[qc]=Sm,W[qc+1]=So,W[qc+2]=An,tp(Sm,So,An,E);const z_=Sr*Je;im(J,vl,X?Ze:z_,X?z_:Et)}const Hc=qo,xo=yl,ww=_l;qo=wo,yl=Ep,_l=mt;const xw=wo,rc=Ep,Ay=mt,Sw=1/Math.sqrt(xw*xw+rc*rc+Ay*Ay),sr=Ay*Sw;let k_=0,Oy=0,U_=0;if(Gt&&sr*sr<.999){let vl=0,qc=0,Sm=0;{const So=Y===0?-1:1;vl=So*(ue-Hc),qc=So*(Qr-xo),Sm=So*(Tp-ww)}{const So=Sr*Je,An=X?Q:v*(1-So)+b*So,z_=X?ye:An,Tw=X?w*(1-So)+x*So:Ae,Ew=X?xt:h*(1-So)+p*So,N2=X?Ke:Math.sin(Ew),Cw=X?Ge:Math.cos(Ew),V_=X?S(So):Qe,l4=X?Math.sin(V_):Jt,ic=X?Math.cos(V_):Rr;let vO=xw,bO=rc,Z=Ay;if(k){const ve=u+xn(z_-_i,Tw-Jr,Gi),Oe=X?ic:Nn;vO=(X?pr:Cw)*Oe*ve,bO=(X?Mt:N2)*Oe*ve,Z=(X?l4:ji)*ve}{const ve=u+xn(An+_i,Tw+Jr,y),Oe=X?ic:ps,Tr=(X?Cr:Cw)*Oe*ve,Ts=(X?jr:N2)*Oe*ve,Ni=(X?l4:vi)*ve;k||(vO=2*xw-Tr,bO=2*rc-Ts,Z=2*Ay-Ni);const bl=Y===3?-1:1,Pw=bl*(vO-Tr),Vue=bl*(bO-Ts),Bue=bl*(Z-Ni);k_=Sm*Vue-qc*Bue,Oy=vl*Bue-Sm*Pw,U_=qc*Pw-vl*Vue;const ZG=1/Math.sqrt(k_*k_+Oy*Oy+U_*U_);k_*=ZG,Oy*=ZG,U_*=ZG}}}else k_=xw*Sw,Oy=rc*Sw,U_=Ay*Sw;r.setEdgeNormalFromValues(Y,Sr,k_,Oy,U_)}})()}}function eze(t){uze(t)}function tze(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function WDt(t,e,r,i){return tze(t*(1-i)+e*i,r)}function YDt(t,e,r){return t*(1-r)+e*r}function Ace(t){const{tile:e}=t;if(e.surface.isWebMercator){const i=e.extent,n=e.ellipsoid.radius;return s=>WDt(i[1],i[3],n,s)}const r=e.extentInRadians;return i=>YDt(r[1],r[3],i)}function XDt(t,e){const{tile:r,geometryState:i,geometry:n}=t,{extent:s,surface:o}=r,{wireframe:a}=i,l=s[0],c=s[1],u=s[2]-l,h=s[3]-c,{numVerticesPerSide:p,clippingArea:f}=i,g=f!=null?Math.max(0,(f[0]-l)/u):0,y=f!=null?Math.max(0,(f[1]-c)/h):0,v=f!=null?Math.min(1,(f[2]-l)/u):1,b=f!=null?Math.min(1,(f[3]-c)/h):1,w=(p-2)**2,x=pze(i),S=w+4*x,E=o.renderer.tileGeometryCache.acquire(S),{boundingBox:P}=n;zi(P),n.numVerticesPerSide=p,n.vertexAttributes=E,n.maxEdgeVertexCount=x,n.minu=g,n.minv=y,n.maxu=v,n.maxv=b,ZDt(t),n.edgeVerticesStartIndex=w,Mce(t),Oce(t),sze(n,[],a),t.intersectionData=null}function ZDt(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:r,geometryState:i,localOrigin:n}=t,{samplerData:s,clippingArea:o,numVerticesPerSide:a}=i,{surface:l,extent:c,ellipsoid:u}=e,{isWebMercatorOnPlateCarree:h}=l,p=o??Rce,f=c[0],g=c[1],y=c[2],v=c[3],b=Math.max(f,p[0]),w=Math.min(y,p[2]),x=Math.max(g,p[1]),S=Math.min(v,p[3]),E=u.radius,P=e.horizontalScale,M=a-1,L=a-2,{minu:U,minv:z,maxu:W,maxv:V,boundingBox:J,vertexAttributes:Y}=r,X=Y.position,le=Y.uv0,{typedBuffer:D,typedBufferStride:I}=Y.normalCompressed,k=n[0],j=n[1],q=n[2],Q=X.typedBuffer,ie=X.typedBufferStride;let ye=0;const Ae=we(g,x,S),Ze=h?(Math.PI/2-2*Math.atan(Math.exp(-Ae/E)))*E:Ae*P,Et=1/M,xt=we(g*(1-Et)+v*Et,x,S);let Qe=Ze,Ke=h?(Math.PI/2-2*Math.atan(Math.exp(-xt/E)))*E:xt*P;for(let Ge=1;Ge<=L;Ge++){const Jt=Ge/M,Rr=we(g*(1-Jt)+v*Jt,x,S),Gi=we(Jt,z,V),Be=Ke,wr=(Ge-1)/M,Re=we(g*(1-wr)+v*wr,x,S),qe=Qe,At=(Ge+1)/M,Gt=we(g*(1-At)+v*At,x,S),Je=h?(Math.PI/2-2*Math.atan(Math.exp(-Gt/E)))*E:Gt*P,$t=we(At,z,V);Qe=Ke,Ke=Je;const Le=we(f,b,w);let ot=Le*P,It=xn(Le,Rr,s);const _i=1/M,Jr=we(_i,U,W),Di=we(f*(1-Jr)+y*Jr,b,w);let Gr=Jr,ii=Di,xr=Di*P,jr=xn(Di,Rr,s);if(Ge===1){const Cr=xr-k,oi=Qe-j,Mt=jr-q,pr=0*ie;Q[pr]=Cr,Q[pr+1]=oi,Q[pr+2]=Mt,tp(Cr,oi,Mt,J);const Pr=we(_i,U,W);im(le,ye,Pr,Gi)}for(let Cr=1;Cr<=L;Cr++){const oi=xr,Mt=jr,pr=(Cr+1)/M,Pr=we(pr,U,W),vi=we(f*(1-pr)+y*pr,b,w),ps=ii;ii=vi;{const Ss=ye+1,Fn=Ss*ie;if(Ge===1||Cr===L){const Sr=vi*P,Ji=xn(vi,Rr,s);if(Ge===1&&Cr<L){const Fs=Sr-k,bo=Be-j,ue=Ji-q;Q[Fn]=Fs,Q[Fn+1]=bo,Q[Fn+2]=ue,tp(Fs,bo,ue,J),im(le,Ss,Pr,Gi)}xr=Sr,jr=Ji}else xr=Q[Fn]+k,jr=Q[Fn+2]+q}const _r=xr,ji=jr,Nn=ot,qo=It;ot=oi,It=Mt;const yl=(ye-L)*ie,_l=Ge===1?xn(ps,Re,s):Q[yl+2]+q,Wo=xn(ps,Gt,s);if(Ge<L){const Ss=ye+L,Fn=Ss*ie,Sr=oi-k,Ji=Je-j,Fs=Wo-q;Q[Fn]=Sr,Q[Fn+1]=Ji,Q[Fn+2]=Fs,tp(Sr,Ji,Fs,J);const bo=Gr;Gr=Pr,im(le,Ss,bo,$t)}{const Ss=_r-Nn,Fn=qe-Je,Sr=Fn*(ji-qo),Ji=Ss*(_l-Wo),Fs=-Fn*Ss,bo=Sr*Sr+Ji*Ji+Fs*Fs;if(bo===0)_m(D,ye,0,0,1,I);else{const ue=1/Math.sqrt(bo);_m(D,ye,Sr*ue,Ji*ue,Fs*ue,I)}}++ye}}}function JDt(t,e){t.tile.intersectsClippingArea&&(ize(t),rze(t,!0),fO(t),t.intersectionData=null)}function QDt(t,e){t.tile.intersectsClippingArea&&(lze(t),Oce(t),fO(t),hze(t),t.intersectionData=null)}function KDt(t,e){t.tile.intersectsClippingArea&&(Oce(t),fO(t),t.intersectionData=null)}function Oce(t,e){t.tile.intersectsClippingArea&&(ize(t),rze(t,!1))}function rze(t,e){const{geometry:r,geometryState:i,tile:n,localOrigin:s}=t,{surface:o,extent:a}=n,{clippingArea:l,samplerData:c}=i,u=l??Rce,h=a[0],p=a[2],f=a[1],g=a[3],y=[g>u[3],p>u[2],f<u[1],h<u[0]],v=n.horizontalScale,b=nze(o.isWebMercatorOnPlateCarree,n.ellipsoid.radius,v),{minu:w,minv:x,maxu:S,maxv:E,boundingBox:P}=r,M=Math.max(h,u[0]),L=Math.min(p,u[2]),U=Math.max(f,u[1]),z=Math.min(g,u[3]),W=s[0],V=s[1],J=s[2];for(let Y=0;Y<4;++Y){const X=Y===1||Y===3,le=i.edgeResolutions[Y];$e(jL(le));const D=le+1,I=y[Y],k=$S(n,i.edgePeerNeighbors[Y]);if(!I&&dze(n,k,Y)){cze(t,Y,k);continue}const j=k!=null&&!I,q=k==null?void 0:k.renderData,Q=q==null?void 0:q.geometryState;if(uo&&($e(!j||k.level===n.level),$e(!j||Q0(n,k)<=0),n&&!k&&!o.updatingRootTiles)){const Je=Hf[Y],$t=n.findNeighborTile(Je,Le=>Le.isLoaded||Le.isLeaf||Le.level===n.level);o.updatingRootTiles||($t?$t.intersectsClippingArea&&($e(!$t.isLoaded),$e(!$t.isLeaf),$e($t.level===n.level)):$e((o==null?void 0:o.rootTiles)==null||!n.shouldHaveNeighbor(Je)))}const ie=we(Y===1?p:h,M,L),ye=we(Y===0?g:f,U,z),Ae=Q==null?void 0:Q.samplerData,Ze=e&&D>3?D-3:1,Et=we(Y===1?1:0,w,S),xt=we(Y===0?1:0,x,E),Qe=j?(Je,$t)=>.5*(xn(Je,$t,Ae)+xn(Je,$t,c)):(Je,$t)=>xn(Je,$t,c),Ke=(p-h)/le,Ge=X?Y===1?Ke:-Ke:0,Jt=X?0:Y===0?Ke:-Ke,Rr=-Ge,Gi=-Jt;let Be=0,wr=0,Re=0;{const Je=0/le,$t=X?ie:we(h*(1-Je)+p*Je,M,L),Le=X?we(f*(1-Je)+g*Je,U,z):ye,ot=Qe($t,Le);Be=$t*v,wr=b(Le),Re=ot}let qe=0,At=0,Gt=0;{const Je=1/le,$t=X?ie:we(h*(1-Je)+p*Je,M,L),Le=X?we(f*(1-Je)+g*Je,U,z):ye,ot=Qe($t,Le);qe=$t*v,At=b(Le),Gt=ot}for(let Je=1;Je<D-1;Je+=Ze){const $t=Je/le,Le=qe,ot=At,It=Gt;{const Mt=X?Et:we($t,w,S),pr=X?we($t,x,E):xt,Pr=Le-W,vi=ot-V,ps=It-J;tp(Le,vi,ps,P),r.setEdgeVertexFromValuesRawPositionUV(Y,Je,Pr,vi,ps,Mt,pr)}{const Mt=(Je+1)/le,pr=X?ie:we(h*(1-Mt)+p*Mt,M,L),Pr=X?we(f*(1-Mt)+g*Mt,U,z):ye,vi=Qe(pr,Pr);qe=pr*v,At=b(Pr),Gt=vi}const _i=qe,Jr=Gt,Di=Be,Gr=wr,ii=Re;Be=Le,wr=ot,Re=It;let xr=0,jr=0,Cr=0;if(X){const Mt=At-ot,pr=Jr-It,Pr=Gr-ot,vi=ii-It,ps=we(f*(1-$t)+g*$t,U,z),_r=ie+Rr,ji=_r*v-Le,Nn=xn(_r,ps,c)-It,qo=Y===3?-1:1;if(xr=qo*(-Pr+Mt)*Nn,jr=qo*ji*(-vi+pr),Cr=-qo*ji*(-Pr+Mt),j){const yl=ie+Ge,_l=yl*v-Le;xr=(-Pr+Mt)*(Nn-(xn(yl,ps,Ae)-It)),jr=(ji-_l)*(-vi+pr),Cr=-(ji-_l)*(-Pr+Mt)}}else{const Mt=_i-Le,pr=Jr-It,Pr=Di-Le,vi=ii-It,ps=we(h*(1-$t)+p*$t,M,L),_r=ye+Gi,ji=xn(ps,_r,c)-It,Nn=b(_r)-ot,qo=Y===2?-1:1;if(xr=qo*Nn*(-vi+pr),jr=qo*(-Pr+Mt)*ji,Cr=-qo*Nn*(-Pr+Mt),j){const yl=ps,_l=ye+Jt,Wo=b(_l)-ot;xr=(-Nn+Wo)*(-vi+pr),jr=(-Pr+Mt)*(-ji+(xn(yl,_l,Ae)-It)),Cr=-(-Nn+Wo)*(-Pr+Mt)}}const oi=1/Math.sqrt(xr*xr+jr*jr+Cr*Cr);r.setEdgeNormalFromValues(Y,Je,xr*oi,jr*oi,Cr*oi)}}}function ize(t,e){uze(t)}function eNt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function tNt(t,e){return t*e}function nze(t,e,r){return t?i=>eNt(i,e):i=>tNt(i,r)}function sze(t,e,r){const{numVerticesPerSide:i,vertexAttributes:n,maxEdgeVertexCount:s}=t,o=i-1,a=n.count,l=2*(i-3)*(i-3),c=4*(o+s-3),u=Cce.reduce((y,v)=>y+(o+t.getEdgeCount(v)-3),0),h=e.reduce((y,v)=>y+o*(2*(v.latitudeResolution-1)+1),0),p=3*(r?2:1),f=(l+c+h)*p,g=a>=zDt?new Uint32Array(f):new Uint16Array(f);for(let y=0;y<f;++y)g[y]=0;t.indices=g,t.indexCount=(l+u+h)*p,t.poleIndicesStartIndex=l*p,t.edgeIndicesStartIndex=(l+h)*p,r?(nNt(t),sNt(t,e),aze(t)):(rNt(t),iNt(t,e),oze(t))}function rNt(t){const{numVerticesPerSide:e,indices:r,vertexAttributes:i}=t,{position:n}=i,{typedBuffer:s,typedBufferStride:o}=n,a=e-2,l=e-3,c=0,u=e-3;let h=0;for(let p=0;p<l;++p){const f=p*a;for(let g=c;g<u;++g){const y=f+g,v=y+1,b=v+a,w=b-1;fze(y,v,b,w,o,s)?(r[h]=y,r[h+1]=v,r[h+2]=b,r[h+3]=b,r[h+4]=w,r[h+5]=y):(r[h]=y,r[h+1]=v,r[h+2]=w,r[h+3]=w,r[h+4]=v,r[h+5]=b),h+=6}}}function iNt(t,e){const{numVerticesPerSide:r,indices:i,poleIndicesStartIndex:n}=t,s=r-1;let o=n;for(const a of e){let l=t.getEdgeVertexIndex(a.connectedOuterEdgeOffset,0),c=1;for(let u=0;u<a.latitudeResolution;++u){const h=u===0?a.rowOffset:l+r;for(let p=0;p<s;p++){const f=h+p;i[o]=l,i[o+1]=l+1,i[o+2]=f,u<a.latitudeResolution-1?(i[o+3]=l+1,i[o+4]=f+1,i[o+5]=f,o+=6):o+=3,l+=c}l=h,c=1}}}function oze(t){const{indices:e,numVerticesPerSide:r,edgeIndicesStartIndex:i}=t,n=r-1,s=n-2;let o=i;for(let a=0;a<4;++a){const l=$ce[a];let c=0,u=0;const h=t.getEdgeCount(a),p=l.count;$e(p===n-1);const f=a===1||a===2,g=f?1:2,y=f?2:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<h-1||u<p-1;){const S=w+u*x,E=v+c*b,P=c<h-1,M=u<p-1,L=P&&(!M||(P?0+n*(c+.5)/(h-1):0)<=(M?1+s*(u+.5)/(p-1):0));L?++c:++u;const U=L?E+b:S+x;e[o]=S,e[o+g]=E,e[o+y]=U,o+=3}}t.indexCount=o}function nNt(t){const{indices:e,numVerticesPerSide:r,vertexAttributes:i}=t,{position:n}=i,{typedBuffer:s,typedBufferStride:o}=n,a=r-2;let l=0;for(let c=0;c<r-3;++c){const u=c*a;for(let h=0;h<r-3;++h){const p=c*a+h,f=p+1,g=f+a,y=g-1,v=u+h,b=v+1,w=b+a;fze(v,b,w,w-1,o,s)?(T3(e,l,p,f,g),l+=6,T3(e,l,g,y,p)):(T3(e,l,p,f,y),l+=6,T3(e,l,y,g,f)),l+=6}}}function sNt(t,e){const{indices:r,numVerticesPerSide:i,poleIndicesStartIndex:n}=t,s=i-1;let o=n;for(const a of e){const l=a.connectedOuterEdgeOffset;let c=t.getEdgeVertexIndex(l,0),u=1;for(let h=0;h<a.latitudeResolution;++h){const p=h===0?a.rowOffset:c+i;for(let f=0;f<s;f++)T3(r,o,c,c+1,p+f),o+=6,h<a.latitudeResolution-1&&(T3(r,o,c+1,p+f+1,p+f),o+=6),c+=u;c=p,u=1}}}function aze(t){const{indices:e,numVerticesPerSide:r,edgeIndicesStartIndex:i}=t,n=r-1,s=n-2;let o=i;for(let a=0;a<4;++a){const l=$ce[a];let c=0,u=0;const h=t.getEdgeCount(a),p=l.count;$e(p===n-1);const f=a===1||a===2,g=f?1:3,y=f?3:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<h-1||u<p-1;){const S=w+u*x,E=v+c*b,P=c<h-1,M=u<p-1,L=P&&(!M||(P?0+n*(c+.5)/(h-1):0)<=(M?1+s*(u+.5)/(p-1):0));L?++c:++u;const U=L?E+b:S+x;e[o]=S,e[o+g]=E,e[o+g+1]=E,e[o+y]=U,e[o+y+1]=U,e[o+5]=S,o+=6}}t.indexCount=o}function Mce(t){const{geometry:e,geometryState:r}=t,{edgeResolutions:i}=r,{numVerticesPerSide:n,edgeVerticesStartIndex:s}=e,o=n-2;let a=s;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?o-1:0)*o+(l===1?o-1:0),h=(c?0:1)*o+(c?1:0),p=$ce[l];p.vertex0Index=u,p.stride=h,p.count=o}{const c=i[l]+1;e.outerEdgesOffsetAndLength[2*l+0]=a,e.outerEdgesOffsetAndLength[2*l+1]=c,a+=c}}}function lze(t){Mce(t),t.geometryState.wireframe?aze(t.geometry):oze(t.geometry)}function cze(t,e,r){const i=(e+2)%4,{geometryState:n,geometry:s,tile:o,localOrigin:a}=t,l=o.level-r.level,c=e===1||e===3,u=n.edgeResolutions[e];$e(jL(u));const h=u+1,{boundingBox:p,minu:f,minv:g,maxu:y,maxv:v,vertexAttributes:b}=s,w=we(e===1?1:0,f,y),x=we(e===0?1:0,g,v),S=r.renderData,E=S.geometryState,P=S.geometry,M=P.getEdgeCount(i),L=o.getNeighborEdgeStartVertexIndex(e,r)*u,U=u*2**l;$e(E.edgeResolutions[i]===U),$e(M-1===U);const z=S.localOrigin[0]-a[0],W=S.localOrigin[1]-a[1],V=S.localOrigin[2]-a[2],J=s.getEdgeFirstVertexIndex(e),Y=b.position,X=Y.typedBuffer,le=Y.typedBufferStride,D=b.normalCompressed,I=D.typedBuffer,k=D.typedBufferStride,j=b.uv0,q=P.vertexAttributes,Q=P.getEdgeFirstVertexIndex(i),ie=q.position.typedBuffer,ye=q.position.typedBufferStride,Ae=q.normalCompressed.typedBuffer,Ze=q.normalCompressed.typedBufferStride;for(let Et=1;Et<h-1;++Et){const xt=J+Et,Qe=Q+(L+Et),Ke=xt*le,Ge=Qe*ye,Jt=ie[Ge]+z,Rr=ie[Ge+1]+W,Gi=ie[Ge+2]+V;X[Ke]=Jt,X[Ke+1]=Rr,X[Ke+2]=Gi,tp(Jt,Rr,Gi,p);const Be=xt*k,wr=Qe*Ze;I[Be]=Ae[wr],I[Be+1]=Ae[wr+1];const Re=Et/u,qe=c?w:we(Re,f,y),At=c?we(Re,g,v):x;im(j,xt,qe,At)}}function uze(t){var Gi;const{geometry:e,geometryState:r,localOrigin:i,tile:n}=t,{clippingArea:s,samplerData:o}=r,{minu:a,minv:l,maxu:c,maxv:u,boundingBox:h,vertexAttributes:p}=e,{surface:f,ellipsoid:g,extent:y,extentInRadians:v,horizontalScale:b}=n,w=((Gi=f.view)==null?void 0:Gi.viewingMode)==="local",x=g.radius;let S=0,E=0,P=0;const M=(Be,wr,Re)=>{const qe=v[wr===0?1:3],At=v[Be===0?0:2],Gt=Math.cos(qe),Je=Math.sin(qe),$t=Math.sin(At),Le=Math.cos(At),ot=x+Re;S=Le*Gt*ot,E=$t*Gt*ot,P=Je*ot},L=w?(()=>{const Be=s,wr=Be!=null&&(y[3]>Be[3]||y[2]>Be[2]||y[1]<Be[1]||y[0]<Be[0]),Re=nze(f.isWebMercatorOnPlateCarree,x,b);return(qe,At,Gt)=>{const Je=qe===0?y[0]:y[2],$t=At===0?y[1]:y[3],Le=wr?we(Je,Be[0],Be[2]):Je,ot=wr?we($t,Be[1],Be[3]):$t,It=Gt;S=Le*b,E=Re(ot),P=It}})():M;let U=0,z=0,W=0,V=0,J=0,Y=0,X=0,le=0,D=0;const I=w&&f.isWebMercatorOnPlateCarree,k=(Be,wr,Re,qe,At)=>{let Gt=0,Je=0,$t=0;if(w){const Le=wr*b,ot=I?(Math.PI/2-2*Math.atan(Math.exp(-Re/x)))*x:Re*b;Gt=Le-S,Je=ot-E,$t=qe-P}else{const Le=Ace(Be),ot=Be.tile,It=ot.extent,_i=ot.extentInRadians,Jr=(wr-It[0])/(It[2]-It[0]),Di=(Re-It[1])/(It[3]-It[1]),Gr=_i[0]*(1-Jr)+_i[2]*Jr,ii=Le(Di),xr=Math.cos(ii),jr=Math.sin(ii),Cr=Math.sin(Gr),oi=Math.cos(Gr),Mt=x+qe;Gt=oi*xr*Mt-S,Je=Cr*xr*Mt-E,$t=jr*Mt-P}switch(At){case 0:X+=Gt,le+=Je,D+=$t;break;case 1:V-=Gt,J-=Je,Y-=$t;break;case 2:X-=Gt,le-=Je,D-=$t;break;case 3:V+=Gt,J+=Je,Y+=$t}},j=s??Rce,q=y[0],Q=y[2],ie=y[1],ye=y[3],Ae=[ye>j[3],Q>j[2],ie<j[1],q<j[0]],Ze=Math.max(q,j[0]),Et=Math.min(Q,j[2]),xt=Math.max(ie,j[1]),Qe=Math.min(ye,j[3]),Ke=Be=>Math.max(j[0],Math.min(j[2],Be)),Ge=Be=>Math.max(j[1],Math.min(j[3],Be)),Jt=Be=>{const wr=r.cornerNeighborCornerTiles;U=0,z=0,W=1,V=0,J=0,Y=0,X=0,le=0,D=0;let Re=1/0;for(let Le=0;Le<4;++Le){const ot=wr[4*Be+Le];Re=Math.min(Re,(ot==null?void 0:ot.level)??1/0)}for(let Le=0;Le<4;++Le){const ot=wr[4*Be+Le];LM[Le]=(ot==null?void 0:ot.level)===Re?ot:null}let qe=1,At=0;for(let Le=0;Le<4;++Le){const ot=LM[Le];ot&&(qe=Math.max(qe,ot==null?void 0:ot.renderData.geometryState.numVerticesPerSide),At=ot.extent[2]-ot.extent[0])}const Gt=At,Je=qe;$e(Je>1);const $t=Gt/Je;for(let Le=0;Le<4;++Le){const ot=LM[(Le+3)%4],It=LM[Le%4];if(!ot&&!It)continue;const _i=Le===0?1:Le===1?2:Le===2?3:0,Jr=Le===0?2:Le===1?3:Le===2?0:1;if(ot&&It){const Di=qW[Le][0]*$t,Gr=qW[Le][1]*$t,ii=ot.extent,xr=Ke(ii[_i===0||_i===1?2:0]+Di),jr=Ge(ii[_i===0||_i===3?3:1]+Gr),Cr=It.extent,oi=Ke(Cr[Jr===0||Jr===1?2:0]+Di),Mt=Ge(Cr[Jr===0||Jr===3?3:1]+Gr),pr=ot.renderData,Pr=It.renderData,vi=xn(xr,jr,pr.geometryState.samplerData),ps=xn(oi,Mt,Pr.geometryState.samplerData);k(pr,xr,jr,.5*(vi+ps),Le)}else{const Di=ot??It,Gr=ot?_i:Jr,ii=Di.extent,xr=qW[Le],jr=Ke(ii[Gr===0||Gr===1?2:0]+xr[0]*$t),Cr=Ge(ii[Gr===0||Gr===3?3:1]+xr[1]*$t),oi=Di.renderData,Mt=xn(jr,Cr,oi.geometryState.samplerData);k(oi,jr,Cr,Mt,Le)}}if(!w){const Le=Math.sqrt(S*S+E*E+P*P);U=S/Le,z=E/Le,W=P/Le}if(w||W*W<.999){const Le=Math.sqrt(V*V+J*J+Y*Y);V/=Le,J/=Le,Y/=Le;const ot=Math.sqrt(X*X+le*le+D*D);X/=ot,le/=ot,D/=ot,U=Y*le-J*D,z=V*D-Y*X,W=J*X-V*le;const It=1/Math.sqrt(U*U+z*z+W*W);U*=It,z*=It,W*=It}},Rr=r.cornerNeighborCornerTiles;for(let Be=0;Be<4;++Be){const wr=Be,Re=(Be+1)%4,qe=Be===0||Be===1?1:0,At=Be===0||Be===3?1:0,Gt=we(qe,a,c),Je=we(At,l,u),$t=e.getEdgeFirstVertexIndex(wr),Le=e.getEdgeCount(wr),ot=Be===0||Be===3?Le-1:0,It=e.getEdgeFirstVertexIndex(Re),_i=e.getEdgeCount(Re),Jr=Be===0||Be===1?_i-1:0;let Di=-1;for(let xr=0;xr<4;++xr){const jr=Rr[4*Be+xr],Cr=Rr[4*Be+Di];jr&&(Di===-1||Q0(Cr,jr)>0)&&(Di=xr)}const Gr=Di,ii=Rr[4*Be+Gr];if(ii!==n){const xr=n.level-ii.level,jr=2**xr,Cr=[ii.lij[0]+xr,ii.lij[1]*jr,ii.lij[2]*jr],oi=[Cr[1]+jr===n.lij[1],Be===0&&(Gr===1||Gr===0&&ii!==Rr[4*Be+3])||Be===1&&(Gr===0||Gr===1&&ii!==Rr[4*Be+2]),Cr[1]===n.lij[1]+1,Be===2&&(Gr===3||Gr===2&&ii!==Rr[4*Be+1])||Be===3&&(Gr===2||Gr===3&&ii!==Rr[4*Be+0])],Mt=oi.reduce((_r,ji)=>_r+(ji?1:0),0);$e(Mt===1||Mt===2);let pr=-1,Pr=-1;const vi=ii.renderData;if(Mt===1){const _r=oi.findIndex(Nn=>Nn);$e(0<=_r&&_r<=3),pr=(_r+2)%4;const ji=r.edgeResolutions[_r];Pr=n.getNeighborEdgeStartVertexIndex(_r,ii)*ji+ji*(_r===0&&Be===0||_r===1&&Be===0||_r===2&&Be===1||_r===3&&Be===3?1:0)}else{$e(oi[1]||oi[3]),pr=oi[1]?3:1;const _r=vi.geometryState.edgeResolutions[pr];Pr=Be===0||Be===3?0:_r}const ps=vi.geometry;{const _r=$t+ot,ji=It+Jr,Nn=ps.getEdgeFirstVertexIndex(pr)+Pr,qo=ps.vertexAttributes,yl=vi.localOrigin;{const Wo=qo.position,Ss=Wo.typedBuffer,Fn=Nn*Wo.typedBufferStride,Sr=Ss[Fn]+yl[0]-i[0],Ji=Ss[Fn+1]+yl[1]-i[1],Fs=Ss[Fn+2]+yl[2]-i[2];tp(Sr,Ji,Fs,h);const bo=p.position,ue=bo.typedBuffer;{const Qr=_r*bo.typedBufferStride;ue[Qr]=Sr,ue[Qr+1]=Ji,ue[Qr+2]=Fs}{const Qr=ji*bo.typedBufferStride;ue[Qr]=Sr,ue[Qr+1]=Ji,ue[Qr+2]=Fs}}const _l=p.uv0;im(_l,_r,Gt,Je),im(_l,ji,Gt,Je);{const Wo=qo.normalCompressed.typedBuffer,Ss=Nn*qo.normalCompressed.typedBufferStride,Fn=p.normalCompressed,Sr=Fn.typedBuffer;{const Ji=_r*Fn.typedBufferStride;Sr[Ji]=Wo[Ss],Sr[Ji+1]=Wo[Ss+1]}{const Ji=ji*Fn.typedBufferStride;Sr[Ji]=Wo[Ss],Sr[Ji+1]=Wo[Ss+1]}}}}else{const xr=Ae[wr],jr=Ae[Re];let Cr;if(xr||jr){const Pr=we(q*(1-qe)+Q*qe,Ze,Et),vi=we(ie*(1-At)+ye*At,xt,Qe);Cr=xn(Pr,vi,o)}else Cr=oNt(Rr,Be);L(qe,At,Cr),Jt(Be);const oi=S-i[0],Mt=E-i[1],pr=P-i[2];tp(oi,Mt,pr,h),e.setEdgeVertexFromValuesRawPositionUVNormal(wr,ot,oi,Mt,pr,Gt,Je,U,z,W),e.setEdgeVertexFromValuesRawPositionUVNormal(Re,Jr,oi,Mt,pr,Gt,Je,U,z,W)}}for(let Be=0;Be<4;++Be)LM[Be]=null}function oNt(t,e){var a,l;const r=4*e,i=Cce.reduce((c,u)=>{var h;return Math.min(c,((h=t[r+u])==null?void 0:h.level)??1/0)},1/0);uo&&($e(!t[r+0]||!t[r+2]||Nte(t[r+0],t[r+2],bt.SOUTH_WEST)),$e(!t[r+1]||!t[r+3]||Nte(t[r+1],t[r+3],bt.NORTH_WEST)));let n=0,s=0;for(let c=0;c<4;++c){const u=t[r+c];if(u&&u.level===i){const h=c===0||c===1,p=c===0||c===3,f=u.extent,g=f[h?0:2],y=f[p?1:3],v=(l=(a=u.renderData)==null?void 0:a.geometryState)==null?void 0:l.samplerData;s+=xn(g,y,v),n++}}const o=n?s/n:0;return $e(o!=null),o}function fO(t){const{vao:e,geometry:r}=t,{vertexAttributes:i,edgeVerticesStartIndex:n}=r,s=i.position.typedBuffer;e.vertexBuffers.geometry.setSubData(s,n,n,s.length)}function hze(t){const{vao:e,geometry:r}=t,{indices:i,indexCount:n,edgeIndicesStartIndex:s}=r;e.indexBuffer.setSubData(i,s,s,n)}const qW=[[0,1],[1,0],[0,-1],[-1,0]],ta=new WLt,Rce=OB(-1/0,-1/0,1/0,1/0),LM=[null,null,null,null];function dze(t,e,r){if(!e)return!1;const i=Q0(t,e);return i>0||i===0&&r>=2}let ok=class{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(e){return $e(0<=e&&e<this.count),this.vertex0Index+this.stride*e}};const $ce=[new ok,new ok,new ok,new ok];function tp(t,e,r,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}function pze(t){const{edgeResolutions:e,numVerticesPerSide:r}=t,i=1+Math.max(...e);return Math.max(r,i)}function fze(t,e,r,i,n,s){const o=t*n,a=s[o],l=s[o+1],c=s[o+2],u=e*n,h=s[u],p=s[u+1],f=s[u+2],g=r*n,y=s[g],v=s[g+1],b=s[g+2],w=i*n,x=s[w],S=s[w+1],E=s[w+2];return(h-x)*(h-x)+(p-S)*(p-S)+(f-E)*(f-E)>(a-y)*(a-y)+(l-v)*(l-v)+(c-b)*(c-b)}function T3(t,e,r,i,n){t[e]=r,t[e+1]=i,t[e+2]=i,t[e+3]=n,t[e+4]=n,t[e+5]=r}const I8=6;let aNt=class extends xce{constructor(e,r,i,n,s){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Ht(),this._baseUsedMemory=900,this.init(e,r,i,n,s)}init(e,r,i,n,s){super.init(e,r,i,n,s);const o=s.view.renderSpatialReference,a=s.spatialReference,l=o!=null&&zL(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const{isWebMercatorOnPlateCarree:c}=s,u=this._extentInRenderSR,h=this.extent;if(c){const p=Ce(h[0],h[1],0);ga(p,Ve.WebMercator,p,Ve.PlateCarree);const f=Ce(h[2],h[3],0);ga(f,Ve.WebMercator,f,Ve.PlateCarree),u[0]=p[0],u[1]=p[1],u[2]=f[0],u[3]=f[1]}else for(let p=0;p<4;++p)u[p]=h[p]*l;this.centerAtSeaLevel[0]=.5*(u[0]+u[2]),this.centerAtSeaLevel[1]=.5*(u[1]+u[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(u[2]-u[0],u[3]-u[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,r=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),n=Math.sqrt(r*r+i*i),s=.5*(this.elevationBoundsMax-this.elevationBoundsMin),o=Math.max(n,s);this._center[_s.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const r=this._aabb(),i=r[0],n=r[1],s=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let u=0;u<6;u++){const h=e[u],p=h[0],f=h[1],g=h[2],y=h[3];if(p*(p>0?i:o)+f*(f>0?n:a)+g*(g>0?s:l)+y>=0)return el.OUTSIDE;c=c&&p*(p<0?i:o)+f*(f<0?n:a)+g*(g<0?s:l)+y<=0}return c?el.INSIDE:el.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return pet(e[0],e[1],this.elevationBoundsMin,e[2],e[3],this.elevationBoundsMax)}intersectsRay(e,r,i,n){return ak[0]=1/r[0],ak[1]=1/r[1],ak[2]=1/r[2],Zae(this._aabb(),e,ak,i,n)}createGeometry(){XDt(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){JDt(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){KDt(this.renderData,this._horizontalScaleFactor)}updateEdgeElevationsAndResolutions(){QDt(this.renderData,this._horizontalScaleFactor)}get horizontalScale(){return this._horizontalScaleFactor}};const ak=C();let lNt=class{constructor(){this.extent=tr(),this.minLevel=0,this.maxLevel=0,this.callback=null}},L8=class extends Pe{constructor(){super(...arguments),this._queries=new jt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new jt({initialSize:30}),this._queryPool=new fa(lNt)}queryVisibleLevelRange(e,r,i,n){const s=this._queryPool.acquire();qd(s.extent,e),s.minLevel=r??-Number.MAX_VALUE,s.maxLevel=i??Number.MAX_VALUE,s.callback=n,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const r=this._queries.data[e];this._queryPool.release(r),r.callback(e>=this._queriesInvPtr),r.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const r=e.level;let i=0;for(;i<this._queriesInvPtr;){const n=this._queries.data[i],s=n.extent;r>=n.minLevel&&r<=n.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};d([m()],L8.prototype,"updating",null),L8=d([F("esri.views.3d.terrain.ScaleRangeQueries")],L8);function cNt(t,e,r,i){const n=Math.cos(r);t[0]=Math.cos(e)*n*i,t[1]=Math.sin(e)*n*i,t[2]=Math.sin(r)*i}let uNt=class extends xce{constructor(e,r,i,n,s){super(),this._convexHull=new Array(24),this._boundingSphere=hs(),this._baseUsedMemory=1816,this.init(e,r,i,n,s)}init(e,r,i,n,s){super.init(e,r,i,n,s);const o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],u=this.extentInRadians[3],h=Dt(l,u,.5),p=Dt(a,c,.5),f=e===0?0:Math.min(Math.abs(l),Math.abs(u));this._edgeLen=(c-a)*Math.cos(f)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),cNt(this.centerAtSeaLevel,p,h,this.ellipsoid.radius),me(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)se(e[_s.MIDDLE],0,0,0),se(e[_s.TOP],0,0,0),se(e[_s.BOTTOM],0,0,0),e[_s.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const r=e[_s.MIDDLE],i=this.convexHull;let n=0;for(let s=0;s<8;++s)n=Math.max(n,hNt(r,i,3*s));e[_s.MIDDLE][3]=Math.sqrt(n)}}_calculateFrustumVisibilityStatus(e){if(!jv(e,this._boundingSphere))return el.OUTSIDE;if(this.lij[0]<10)return el.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let n=!0;for(let s=0;s<rO;s++){const o=s===fi.NEAR,a=e[s],l=a[0],c=a[1],u=a[2],h=a[3]-(o?i:0);let p=!1;for(let f=0;f<8;++f){const g=3*f;if(l*r[g]+c*r[g+1]+u*r[g+2]+h<0){if(p=!0,!n)break}else n=!1}if(!p)return el.OUTSIDE}return n?el.INSIDE:el.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){VDt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),uo&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,r=e,i=this.elevationBoundsMin,n=this.elevationBoundsMax,s=this.ellipsoid.radius,o=n;if(this.level===0)se(r,0,0,0),e[3]=s+o;else{const a=this.extentInRadians,l=.5*(a[0]+a[2]),c=a[1],u=a[3];ux(qbe,l,c,s),ux(Wbe,l,u,s),ge(r,qbe,Wbe),oe(r,r,(s+.5*(i+n))/uu(r));const h=this.convexHull;let p=0;const f=(y,v)=>{const b=y[0]-h[3*v],w=y[1]-h[3*v+1],x=y[2]-h[3*v+2];return Math.sqrt(b*b+w*w+x*x)};for(let y=0;y<8;++y){const v=f(r,y);p=Math.max(p,v)}const g=p;e[3]=g+2}}_updateConvexHull(){const e=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBoundsMin,n=this.elevationBoundsMax,s=this._getPatchType(),o=this.surface.isWebMercator,a=o&&s===Ud.HAS_NORTH_POLE,l=o&&s===Ud.HAS_SOUTH_POLE,c=l||a,u=Math.PI/2,h=e[0],p=e[2],f=l?-u:e[1],g=a?u:e[3],y=.5*(h+p),v=i,b=r+(c?Math.min(0,v-1):v),w=(D,I,k)=>ux(D,I,k,b),x=C(),S=C(),E=C(),P=C();w(x,h,f),w(S,h,g),w(E,p,g),w(P,p,f);const M=(D,I)=>{for(let k=0;k<3;++k)this._convexHull[3*I+k]=D[k]};M(x,0),M(S,1),M(E,2),M(P,3);const L=n,U=r+(c?Math.max(0,L+1):L),z=C(),W=C(),V=C();ux(W,y,g,b),ux(V,y,f,b),ge(z,W,V),me(z,z);const J=C(),Y=C(),X=(D,I)=>{rn(Y,D,I),me(Y,Y);const k=-fe(D,J)/fe(Y,J);$e(k>=0),oe(Y,Y,k),ge(D,D,Y)};if(2**this.lij[0]>2*this.lij[1]){const D=V,I=C();it(I,Hbe,D),me(I,I),it(J,D,I),me(J,J),$e(zd(fe(J,D)/uu(D),0)),X(x,S),X(P,E),M(x,0),M(P,3)}else if(2**this.lij[0]!==2*this.lij[1]){const D=W,I=C();it(I,Hbe,D),me(I,I),it(J,I,D),me(J,J),X(S,x),X(E,P),M(S,1),M(E,2)}const le=(D,I)=>{const k=U/fe(I,z);for(let j=0;j<3;++j)this._convexHull[3*D+j]=I[j]*k};le(4,x),le(5,S),le(6,E),le(7,P)}_getPatchType(){const e=this.lij[1],r=e===0,i=e===(1<<this.level)-1;return r?i?Ud.HAS_BOTH_POLES:Ud.HAS_NORTH_POLE:i?Ud.HAS_SOUTH_POLE:Ud.REGULAR}intersectsRay(e,r,i,n){const s=this._boundingSphere,o=s[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=s[0]-e[0],c=s[1]-e[1],u=s[2]-e[2],h=(l*r[0]+c*r[1]+u*r[2])/a,p=r[0]*h-l,f=r[1]*h-c,g=r[2]*h-u;return p*p+f*f+g*g<o*o}getDefaultVerticesPerSide(){return this.level<jbe.length?jbe[this.level]+1:2}updateCornerElevations(){qDt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){jDt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){HDt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var wr;if(!uo||this.level<=2)return;const e=this._boundingSphere,r=e[3],i=e,n=C(),s=this.ellipsoid.radius,o=this.elevationBoundsMin,a=this.elevationBoundsMax,l=s+o,c=1,u=0,h=this._center[_s.MIDDLE][3],p=this.convexHull,f=(Re,qe)=>{for(let At=0;At<3;++At)Re[At]=p[3*qe+At]};{const Re=C(),qe=C(),At=C(),Gt=C(),Je=C(),$t=(Le,ot,It,_i)=>{f(qe,Le),f(At,ot),f(Gt,It),rn(qe,qe,At),rn(Gt,Gt,At),it(Re,qe,Gt),me(Re,Re);const Jr=fe(Re,At);f(Je,_i);const Di=fe(Re,Je),Gr=Math.abs(Di-Jr);$e(zd(Gr,0),`Non coplanar ${Le},${ot},${It},${_i} diff = ${Gr}`)};$t(0,1,2,3),$t(4,5,6,7),$t(0,1,4,5),$t(1,2,5,6),$t(2,3,6,7),$t(3,0,7,4)}const g=Go(24),y=(Re,qe,At)=>{const Gt=4*Re;for(let Je=0;Je<3;++Je)g[Gt+Je]=qe[Je];g[Gt+3]=At},v=C(),b=C(),w=C(),x=C(),S=(Re,qe,At,Gt)=>{f(v,qe),f(b,At),f(w,Gt),rn(v,v,b),me(v,v),rn(w,w,b),me(w,w),it(x,v,w),me(x,x);const Je=fe(x,b);y(Re,x,Je)};S(0,0,1,2),S(1,1,0,4),S(2,1,5,2),S(3,3,2,6),S(4,4,0,3),S(5,4,6,5);const E=1,P=(Re,qe,At,Gt)=>{const Je=4*Re;return g[Je]*qe+g[Je+1]*At+g[Je+2]*Gt-g[Je+3]},M=(Re,qe,At,Gt)=>P(Re,qe,At,Gt)>=-E,L=(Re,qe)=>M(Re,qe[0],qe[1],qe[2]),U=2**this.lij[0]>2*this.lij[1],z=(Re,qe,At)=>Math.sqrt(mze(Re,qe,At,i[0],i[1],i[2]))<r,W=Re=>z(Re[0],Re[1],Re[2]),V=(Re,qe)=>z(Re[qe],Re[qe+1],Re[qe+2]),J=this.extentInRadians,Y=.5*(J[0]+J[2]),X=J[1],le=J[3],D=C(),I=C();ux(D,Y,le,l),ux(I,Y,X,l);const k=U?"Upper":"Lower";let j=!0;for(let Re=0;Re<6;++Re){for(let qe=0;qe<8;++qe){const At=3*qe,Gt=M(Re,p[At],p[At+1],p[At+2]);j&&(j=Gt),$e(Gt,`Tile[${this.lij}] Convex hull point ${qe} outside of plane ${Re}`)}$e(L(Re,I),`Tile[${this.lij}] (${k}) bottom mid outside of plane ${Re}`),$e(L(Re,D),`Tile[${this.lij}] (${k}) top mid outside of plane ${Re}`)}$e(j,"Not all convex hull points are inside  convex hull polyhedron"),$e(W(I),`Tile[${this.lij}] (${k}) bottom mid outside of bounding sphere`),$e(W(D),`Tile[${this.lij}] (${k}) top mid outside of bounding sphere`);for(let Re=0;Re<8;++Re){const qe=V(p,3*Re);$e(qe,`Tile[${this.lij}] Convex hull point ${Re} outside of bounding sphere`)}for(let Re=0;Re<6;++Re)for(let qe=0;qe<8;++qe){const At=3*qe;M(Re,p[At],p[At+1],p[At+2])||console.error(`Tile[${this.lij}] Convex hull point ${qe} outside of plane ${Re}`)}const{extentInRadians:q}=this,Q=Math.max(q[2]-q[0],q[3]-q[1]),ie=Math.round(Q*s),{renderData:ye}=this;if(!ye)return;const{geometry:Ae,geometryState:Ze,localOrigin:Et}=ye,xt=(wr=Ae.vertexAttributes)==null?void 0:wr.position;if(!xt)return;const Qe=C(),Ke=Ae.numVerticesPerSide-2,{indices:Ge,indexCount:Jt,edgeVerticesStartIndex:Rr,poleVerticesStartIndex:Gi}=Ae;if(!Ge)return;const Be=new Set;for(let Re=0;Re<Jt;++Re){const qe=Ge[Re];if(Be.has(qe))continue;Be.add(qe);const At=qe<Gi,Gt=qe>=Rr;let Je=!1,$t=-1;if(Gt){let Mt=Rr;for(let pr=0;pr<4;++pr){const Pr=Ze.edgeResolutions[pr];if(qe===Mt||qe===Mt+Pr-1){Je=!0;break}if(Mt+=Pr,qe<Mt){$t=pr;break}}}const Le=Gt?Ze.edgePeerNeighbors[$t]:null,ot=Gt&&Le&&Q0(this,Le)>0;xt.getVec(qe,n),ge(Qe,n,Et);const It=uu(Qe)-s;let _i=0,Jr=!1;const Di=o-It,Gr=It-a,ii=Di>c,xr=Gr>c,jr=ii||xr,Cr=()=>{const Mt=At?"internal":Gt&&!Je?"edge":Je?"corner":"pole";return`Tile[${this.lij}].vertex[${qe}]:${Mt}`+(ii?"(below)":xr?"(above)":"")+(ot?"(Neighbor)":"")},oi=B0(Qe,i);if(oi>=r+u){const Mt=oi-r;jr||(console.error(`${Cr()} is out of the bounding sphere by ${Mt.toFixed(0)} / ${r.toFixed(0)}[tol=${u}] h=${It.toFixed(0)} / [${o.toFixed(0)}..${a.toFixed(0)}] (${(Mt/r).toFixed(0)})`),Jr=!0)}for(let Mt=0;Mt<6;++Mt)if(!M(Mt,Qe[0],Qe[1],Qe[2])){const pr=P(Mt,Qe[0],Qe[1],Qe[2]),Pr=qe%Ke,vi=(qe-Pr)/Ke;Mt===0&&Di||Mt===5&&Gr||(console.error(`${Cr()} (${Pr},${vi})|${Ke}] is out of the bounding trapezoid plane ${Mt} h=${Math.round(It)} / [${Math.round(o)}..${Math.round(a)}] dist=${Math.round(pr)} radii = ${Math.round(r)}/${Math.round(h)}} : maxL = ${ie}`),++_i)}if(Jr||_i>0)break}}get convexHull(){return this._convexHull}};const jbe=[128,64,64,32,16,8,8,4];function hNt(t,e,r){return mze(t[0],t[1],t[2],e[r],e[r+1],e[r+2])}function mze(t,e,r,i,n,s){const o=i-t,a=n-e,l=s-r;return o*o+a*a+l*l}const ux=(t,e,r,i)=>{const n=Math.cos(e),s=Math.sin(e),o=Math.cos(r),a=Math.sin(r);t[0]=i*o*n,t[1]=i*o*s,t[2]=i*a},Hbe=[0,0,1],qbe=C(),Wbe=C();let of=class extends Pe{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};d([m()],of.prototype,"fovX",void 0),d([m()],of.prototype,"fovY",void 0),d([m()],of.prototype,"relativeWidthLimit",void 0),d([m()],of.prototype,"relativeHeightLimit",void 0),d([m()],of.prototype,"maxLod",void 0),d([m()],of.prototype,"angledSplitBias",void 0),d([m()],of.prototype,"aboveGround",void 0),d([m()],of.prototype,"frustum",void 0),of=d([F("esri.views.3d.terrain.SplitLimits")],of);const dNt=ln().vec3f(R.POSITION).vec2i16(R.UV0).vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0});let pNt=class{constructor(e){this._storage=new jN((r,i)=>e.newCache(r,i),"TileGeometry")}acquire(e){const i=Math.ceil(e/4)*4,n=this._storage,s=fNt(i),o=n.pop(s);if(o)return o;const a=dNt.createBuffer(i);return a.release=()=>n.put(s,a),a}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function fNt(t){return t.toString()}let gze=class extends jc{constructor(){super(...arguments),this.blendMode=Ne.Normal}};d([H({count:Ne.COUNT})],gze.prototype,"blendMode",void 0);let nL=class extends gze{constructor(){super(...arguments),this.output=As.Composite,this.baseOpacityMode=Za.NotRequired,this.premultipliedSource=Ef.Off}};d([H({count:As.COUNT})],nL.prototype,"output",void 0),d([H({count:Za.COUNT})],nL.prototype,"baseOpacityMode",void 0),d([H()],nL.prototype,"premultipliedSource",void 0);var Jb;function yze(t){const e=new Fr;if(e.include(jUe),t.background===Jb.Only){const r=t.output===As.ColorComposite;return r?e.fragment.uniforms.add(new zt("backgroundColor",i=>i.backgroundColor)):e.fragment.include(wce),e.fragment.code.add(T`
    void main() {
      fragColor = vec4(${r?T`backgroundColor`:T`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(HUe,t),e.fragment.uniforms.add(new ft("tex",r=>r.texture)),e.fragment.uniforms.add(new Ie("opacity",r=>r.opacity)),e.fragment.code.add(T`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(Jb||(Jb={}));const mNt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Jb},build:yze},Symbol.toStringTag,{value:"Module"}));let gNt=class extends GUe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Yn}},_ze=class vze extends Zr{initializeProgram(e){return new Br(e.rctx,vze.shader.get().build(this.configuration),Nr)}initializePipeline(){return Bt({blending:qu(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:rr})}};_ze.shader=new Vr(mNt,()=>re(()=>Promise.resolve().then(()=>Vjt),void 0));let bze=class extends nL{constructor(){super(...arguments),this.background=Jb.BelowLayer}};d([H()],bze.prototype,"background",void 0);let WW=class{constructor(e,r,i,n,s,o){this.texture=e,this.type=r,e.retain(),this.offsetAndScale=Xt(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Ce(n,s,o)}destroy(){this.texture.release()}};function sL(){return[1,0,0,1,0,0]}function yNt(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function _Nt(t,e,r,i,n,s){return[t,e,r,i,n,s]}function vNt(t,e){return new Float64Array(t,e,6)}const bNt=sL();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:bNt,clone:yNt,create:sL,createView:vNt,fromValues:_Nt},Symbol.toStringTag,{value:"Module"}));function wNt(t){return t instanceof Float32Array&&t.length>=2}function xNt(t){return Array.isArray(t)&&t.length>=2}function lk(t){return wNt(t)||xNt(t)}const ck={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Ff({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ve.WebMercator}),minus180Line:new Ff({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ve.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Ff({paths:[[[180,-180],[180,180]]],spatialReference:Ve.WGS84}),minus180Line:new Ff({paths:[[[-180,-180],[-180,180]]],spatialReference:Ve.WGS84})}};function rT(t,e){return Math.ceil((t-e)/(2*e))}function wze(t,e){const r=oL(t);for(const i of r)for(const n of i)n[0]+=e;return t}function oL(t){return ol(t)?t.rings:t.paths}async function SNt(t,e,r,i){const n=D_(t),s=e[0].spatialReference,o={...i,responseType:"json",query:{...n.query,f:"json",sr:AP(s),target:JSON.stringify({geometryType:BA(e[0]),geometries:e}),cutter:JSON.stringify(r)}},a=await Vt(n.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(u=>{const h=Sb(u);return h.spatialReference=s,h})}}async function TNt(t,e,r){const i=typeof t=="string"?xs(t):t,n=e[0].spatialReference,s=BA(e[0]),o={...r,query:{...i.query,f:"json",sr:AP(n),geometries:JSON.stringify(B$t(e))}},{data:a}=await Vt(i.path+"/simplify",o);return wUe(a.geometries,s,n)}const xze=()=>K.getLogger("esri.geometry.support.normalizeUtils");function ENt(t){return t.type==="polygon"}function CNt(t){return t[0].type==="polygon"}function PNt(t){return t[0].type==="polyline"}function ANt(t,e){if(!(t instanceof Ff||t instanceof ku)){const n="straightLineDensify: the input geometry is neither polyline nor polygon";throw xze().error(n),new B(n)}const r=oL(t),i=[];for(const n of r){const s=[];i.push(s),s.push([n[0][0],n[0][1]]);for(let o=0;o<n.length-1;o++){const a=n[o][0],l=n[o][1],c=n[o+1][0],u=n[o+1][1],h=Math.sqrt((c-a)*(c-a)+(u-l)*(u-l)),p=(u-l)/h,f=(c-a)/h,g=h/e;if(g>1){for(let w=1;w<=g-1;w++){const x=w*e,S=f*x+a,E=p*x+l;s.push([S,E])}const y=(h+Math.floor(g-1)*e)/2,v=f*y+a,b=p*y+l;s.push([v,b])}s.push([c,u])}}return ENt(t)?new ku({rings:i,spatialReference:t.spatialReference}):new Ff({paths:i,spatialReference:t.spatialReference})}function Ybe(t,e,r){if(e){const i=ANt(t,1e6);t=QC(i,!0)}return r&&(t=wze(t,r)),t}function Xbe(t,e,r){if(Array.isArray(t)){const i=t[0];if(i>e){const n=rT(i,e);t[0]=i+n*(-2*e)}else if(i<r){const n=rT(i,r);t[0]=i+n*(-2*r)}}else{const i=t.x;if(i>e){const n=rT(i,e);t=t.clone().offset(n*(-2*e),0)}else if(i<r){const n=rT(i,r);t=t.clone().offset(n*(-2*r),0)}}return t}function ONt(t,e){let r=-1;for(let i=0;i<e.cutIndexes.length;i++){const n=e.cutIndexes[i],s=e.geometries[i],o=oL(s);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let u=0;for(let p=0;p<l.length;p++){const f=l[p][0];u=f>u?f:u}u=Number(u.toFixed(9));const h=-360*rT(u,180);for(let p=0;p<l.length;p++){const f=s.getPoint(a,p);s.setPoint(a,p,f.clone().offset(h,0))}return!0}})}if(n===r){if(CNt(t))for(const a of oL(s))t[n]=t[n].addRing(a);else if(PNt(t))for(const a of oL(s))t[n]=t[n].addPath(a)}else r=n,t[n]=s}return t}async function Sze(t,e,r){if(!Array.isArray(t))return Sze([t],e);e&&typeof e!="string"&&xze().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i=typeof e=="string"?e:(e==null?void 0:e.url)??ai.geometryServiceUrl;let n,s,o,a,l,c,u,h,p=0;const f=[],g=[];for(const S of t)if(S!=null)if(n||(n=S.spatialReference,s=Qf(n),o=n.isWebMercator,c=o?102100:4326,a=ck[c].maxX,l=ck[c].minX,u=ck[c].plus180Line,h=ck[c].minus180Line),s)if(S.type==="mesh")g.push(S);else if(S.type==="point")g.push(Xbe(S.clone(),a,l));else if(S.type==="multipoint"){const E=S.clone();E.points=E.points.map(P=>Xbe(P,a,l)),g.push(E)}else if(S.type==="extent"){const E=S.clone()._normalize(!1,!1,s);g.push(E.rings?new ku(E):E)}else if(S.extent){const E=S.extent,P=rT(E.xmin,l)*(2*a);let M=P===0?S.clone():wze(S.clone(),P);E.offset(P,0),E.intersects(u)&&E.xmax!==a?(p=E.xmax>p?E.xmax:p,M=Ybe(M,o),f.push(M),g.push("cut")):E.intersects(h)&&E.xmin!==l?(p=E.xmax*(2*a)>p?E.xmax*(2*a):p,M=Ybe(M,o,360),f.push(M),g.push("cut")):g.push(M)}else g.push(S.clone());else g.push(S);else g.push(S);let y=rT(p,a),v=-90;const b=y,w=new Ff;for(;y>0;){const S=360*y-180;w.addPath([[S,v],[S,-1*v]]),v*=-1,y--}if(f.length>0&&b>0){const S=ONt(f,await SNt(i,f,w,r)),E=[],P=[];for(let U=0;U<g.length;U++){const z=g[U];if(z!=="cut")P.push(z);else{const W=S.shift(),V=t[U];V!=null&&V.type==="polygon"&&V.rings&&V.rings.length>1&&W.rings.length>=V.rings.length?(E.push(W),P.push("simplify")):P.push(o?ib(W):W)}}if(!E.length)return P;const M=await TNt(i,E,r),L=[];for(let U=0;U<P.length;U++){const z=P[U];z!=="simplify"?L.push(z):L.push(o?ib(M.shift()):M.shift())}return L}const x=[];for(let S=0;S<g.length;S++){const E=g[S];if(E!=="cut")x.push(E);else{const P=f.shift();x.push(o===!0?ib(P):P)}}return x}function MNt(t,e,r){const i=Qf(r);if(i==null)return t;const[n,s]=i.valid,o=2*s;let a=0,l=0;e>s?a=Math.ceil(Math.abs(e-s)/o):e<n&&(a=-Math.ceil(Math.abs(e-n)/o)),t>s?l=Math.ceil(Math.abs(t-s)/o):t<n&&(l=-Math.ceil(Math.abs(t-n)/o));let c=t+(a-l)*o;const u=c-e;return u>s?c-=o:u<n&&(c+=o),c}const RNt=96,$Nt=39.37;function Ice(t,e){return e.type?yr(t,e.x,e.y):vo(t,e)}function INt(t){return fl(t)}function LNt(t,e){const r=t.targetGeometry,i=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const DNt=function(){const t=Ye();return function(e,r,i){const n=r.targetGeometry;Ice(t,n);const s=.5*MG(r);return e.xmin=t[0]-s*i[0],e.ymin=t[1]-s*i[1],e.xmax=t[0]+s*i[0],e.ymax=t[1]+s*i[1],e.spatialReference=n.spatialReference,e}}();function MG(t){return t.scale*NNt(t.targetGeometry)}function NNt(t){return t!=null&&Ng(t.spatialReference)?1/(INt(t.spatialReference)*$Nt*RNt):1}function FNt(t){return vB(t.rotation)||0}const Lce=function(){const t=Ye(),e=Ye(),r=Ye();return function(i,n,s,o,a,l){return Use(t,n),Eu(e,s,.5*l),yr(r,1/o*l,-1/o*l),Hle(i,e),a&&Gle(i,i,a),_6e(i,i,r),jle(i,i,t),i}}(),kNt=function(){const t=Ye();return function(e,r,i,n){const s=MG(r),o=FNt(r);return Ice(t,r.targetGeometry),Lce(e,t,i,s,o,n)}}(),UNt=function(){const t=Ye();return function(e,r,i,n){const s=MG(r);return Ice(t,r.targetGeometry),Lce(e,t,i,s,0,n)}}();function zNt(t){const e=Qf(t);return e?e.valid[1]-e.valid[0]:0}function VNt(t,e){return Math.round(zNt(t)/e)}var Fte;const El=[0,0];let Q1=Fte=class extends Se{constructor(t){super(t),this._viewpoint2D={center:Ye(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new br,this.id=0,this.inverseTransform=sL(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=sL(),this.transformNoRotation=sL(),this.displayMat3=ey(),this.displayViewMat3=ey(),this.viewMat3=ey(),this.viewMat2d=b6e(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,r=t.targetGeometry;e.center[0]=r.x,e.center[1]=r.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=r.spatialReference}this._update()}copy(t){const e=this.size,r=this.viewpoint;return r&&e?(this.viewpoint=LNt(r,t.viewpoint),this._set("size",vo(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new Fte({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,r){return lk(e)?$1(t,e,this.inverseTransform):(El[0]=e,El[1]=r,$1(t,El,this.inverseTransform))}toScreen(t,e,r){return lk(e)?$1(t,e,this.transform):(El[0]=e,El[1]=r,$1(t,El,this.transform))}toScreenNoRotation(t,e,r){return lk(e)?$1(t,e,this.transformNoRotation):(El[0]=e,El[1]=r,$1(t,El,this.transformNoRotation))}toScreenClosest(t,e,r){lk(e)?(El[0]=e[0],El[1]=e[1]):(El[0]=e,El[1]=r);const[i]=El,{center:n,extent:s,spatialReference:o,transform:a}=this;return(i<s.xmin||i>s.xmax)&&(El[0]=MNt(i,n[0],o)),$1(t,El,a)}getScreenTransform(t,e){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,n=this._get("size");return Lce(t,r,n,e,0,i),t}_update(){const{center:t,spatialReference:e,scale:r,rotation:i}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size"),o=new dm({targetGeometry:new He(t[0],t[1],e),scale:r,rotation:i});if(this._set("viewpoint",o),!s||!e||!r)return;this.resolution=MG(o),this.rotation=i,this.scale=r,this.spatialReference=e,vo(this.center,t);const a=s[0]!==0?2/s[0]:0,l=s[1]!==0?-2/s[1]:0;Ese(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=Cse(this.viewMat3),u=kd(s[0]/2,s[1]/2),h=kd(-s[0]/2,-s[1]/2),p=vB(i);$z(c,c,u),Pse(c,c,p),$z(c,c,h),XP(this.displayViewMat3,this.displayMat3,c);const f=Hle(this.viewMat2d,u);return Gle(f,f,p),jle(f,f,h),DNt(this.extent,o,s),kNt(this.transform,o,s,n),g6e(this.inverseTransform,this.transform),UNt(this.transformNoRotation,o,s,n),this.worldScreenWidth=VNt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};d([m({readOnly:!0})],Q1.prototype,"id",void 0),d([m({value:1,json:{write:!0}})],Q1.prototype,"pixelRatio",null),d([m({json:{write:!0}})],Q1.prototype,"size",null),d([m()],Q1.prototype,"spatialReference",void 0),d([m({type:dm,json:{write:!0}})],Q1.prototype,"viewpoint",null),Q1=Fte=d([F("esri.views.2d.ViewState")],Q1);const BNt=Q1;var kte,IS,Ute,hV,zte,dV,Vte,LS,Bte;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(kte||(kte={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(IS||(IS={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(Ute||(Ute={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(hV||(hV={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(zte||(zte={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(dV||(dV={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(Vte||(Vte={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(LS||(LS={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(Bte||(Bte={}));let Vp=class{};Vp.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:IS.VISIBLE}},Vp.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:IS.VISIBLE}},Vp.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:IS.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:rte.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:ite.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},Vp.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:IS.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:Ute.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:dV.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:hV.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:dV.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:zte.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:hV.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:Vte.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[Bte.HORIZONTAL]}},Vp.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:IS.VISIBLE}},Vp.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},Vp.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:LS.MAP}},Vp.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:LS.MAP},"line-width":{type:"number",minimum:0,default:1}},Vp.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:LS.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:LS.MAP}},Vp.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},Vp.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:LS.MAP}};let GNt=class extends OUe{_createTransforms(){return{displayViewScreenMat3:ey(),tileMat3:ey()}}},jNt=class{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const r=[];for(const i of this._candidateTiles)e>0?(i.reshuffle(),e--):r.push(i);this._candidateTiles=r}};const HNt=.125;let qNt=class{constructor(){this._renderParams={reshuffleManager:new jNt,context:null,drawPhase:1,state:new BNt({viewpoint:new dm({targetGeometry:new He(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new GNt(new __(0,0,0,0),0,0,0,512,512,4096,4096)}dispose(){this._renderParams=null}renderBackground(e,r,i,n,s,o,a,l,c,u){const h=this._backgroundTile;this._updateRenderParameters(e,r,h,i,s,o,a,l,c,u),this._renderParams.stencilSymbols=!1,i.drawBackground(this._renderParams,h,n)}renderContent(e,r,i,n,s,o,a,l,c,u,h,p){this._stencilSymbols(e,r,i,n,s,o,a,Math.round(1/l),c,u,h,p);let f=1;i.stencilRef=f++,e.setStencilFunction(si.EQUAL,i.stencilRef,255),this._render(e,r,i,s,o,a,l,c,u,h,p),n.forAll(g=>{g.sourceLayerInfo.data.stencilRef=f++,this._renderSymbols(e,g.sourceLod,g.sourceLayerInfo.data,s,o,a,Math.round(1/l),g.offset,u,h,p)})}_stencilSymbols(e,r,i,n,s,o,a,l,c,u,h,p){let f=1;i.stencilRef=f++,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(vn.KEEP,vn.KEEP,vn.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(si.ALWAYS,i.stencilRef,255),this._stencilTileSymbols(e,r,i,s,o,a,l,c,u,h,p);for(const g of n.toArray()){const{sourceLod:y,offset:v,sourceLayerInfo:b}=g;b.data.stencilRef=f++,e.setStencilFunction(si.ALWAYS,b.data.stencilRef,255),this._stencilTileSymbols(e,y,b.data,s,o,a,l,v,u,h,p)}e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,r,i,n,s,o,a,l,c,u,h){e.setStencilFunction(si.EQUAL,i.stencilRef,255),this._render(e,r,i,n,s,o,a,l,c,u,h,kte.SYMBOL)}_render(e,r,i,n,s,o,a,l,c,u,h,p){this._updateRenderParameters(e,r,i,n,o,a,l,c,u,h),this._renderParams.stencilSymbols=!1,n.drawTile(this._renderParams,i,s,p)}_stencilTileSymbols(e,r,i,n,s,o,a,l,c,u,h){this._updateRenderParameters(e,r,i,n,o,a,l,c,u,h),this._renderParams.stencilSymbols=!0,i.triangleCount=0,n.drawSymbols(this._renderParams,i,s)}_updateRenderParameters(e,r,i,n,s,o,a,l,c,u){"type"in i&&i.type==="vector-tile"&&!i.stage&&i.attachWithContext(e);const h=r[0]-s.getLevelShift(r[0]),p=this._renderParams;p.context=e,p.painter=n,p.glyphMosaic=n.glyphMosaic,p.spriteMosaic=n.spriteMosaic,p.pixelRatio=c*u,p.displayLevel=h,p.requiredLevel=h;const f=s.getScale(r[0]),[g,y]=s.getOffset(r,o*f),v=HNt*o*f/l,b=i.transforms.displayViewScreenMat3;b[0]=v,b[4]=-v,b[6]=-1-g-a[0]*o*2,b[7]=1+y+(1-a[1])*o*2-2,p.state.size[0]=l/u,p.state.size[1]=l/u,p.state.pixelRatio=u}},Tze=class Eze extends Zr{initializeProgram(e){return new Br(e.rctx,Eze.shader.get().build(this.configuration),Nr)}initializePipeline(){return Bt({blending:qu(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:rr})}};Tze.shader=new Vr(pDt,()=>re(()=>Promise.resolve().then(()=>Bjt),void 0));let O$=class extends nL{constructor(){super(...arguments),this.colorizerType=PT.Stretch,this.stretchType=c2.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};d([H({count:PT.COUNT})],O$.prototype,"colorizerType",void 0),d([H({count:c2.COUNT})],O$.prototype,"stretchType",void 0),d([H()],O$.prototype,"applyColormap",void 0),d([H()],O$.prototype,"requireBilinearWithNN",void 0);let Zbe=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const r=this._fbos.get(e);if(r)return r;const i=new xm(this._rctx,new ui(e),new TDe(Ia.DEPTH24_STENCIL8,e));return this._fbos.set(e,i),i}};const WNt=()=>K.getLogger("esri.views.3d.terrain");let YNt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new qNt,this._bindParameters=new q7(null,null),this._blendLayersTechniqueConfig=new bze,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Sy(this._rctx,ON)}dispose(){this._fbos.forEach(wt),this._fbos=null,this._vtFBO=wt(this._vtFBO),this._vaoQuad=wt(this._vaoQuad),this._vectorTileHelper=wt(this._vectorTileHelper),this._backgroundTechnique=lr(this._backgroundTechnique),this._applyOpacityTechnique=lr(this._applyOpacityTechnique),this._blendLayersTechnique=lr(this._blendLayersTechnique)}_getBlendLayersTechnique(e,r,i,n=Ef.Off,s=Jb.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=n,this._blendLayersTechniqueConfig.background=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(_ze,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const i=this._getBlendLayersTechnique(Ne.Normal,r?As.ColorComposite:As.GridComposite,Za.NotRequired,Ef.Off,Jb.Only),n=this._rctx.bindTechnique(i,this._bindParameters,e);this._render(n)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(dr.TRIANGLE_STRIP,0,q0(this._vaoQuad,"geometry"))}drawGroup(e,r,i,n,s=Ef.On){r===As.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const o=e.baseOpacity<1?Za.Required:Za.NotRequired,a=this._getBlendLayersTechnique(n,r,o,s),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawRasterData(e,r,i,n,s=Ef.Off){if(e.texture==null)return;const o=e.baseOpacity<1?Za.Required:Za.NotRequired;e.fboTexture=r===As.GroupBackgroundComposite||n===Ne.Normal&&o===Za.NotRequired&&s===Ef.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(n,r,o,s),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawImageryTileData(e,r,i,n,s){const o=s.sourceLayerInfo.data;if(!o.source||(s.tile.surface.layerViewByIndex(s.layerIndex,Zt.MAP).ensureSymbolizerParameters(o),!o.bind(this._rctx)))return;const a=e.baseOpacity<1?Za.Required:Za.NotRequired;e.fboTexture=n===Ne.Normal&&a===Za.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(o,r,n,a);o.opacity=e.opacity;const c=o.getUniforms();c.scale=s.scale,c.offset=s.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const u=this._rctx.bindTechnique(l,null,c);this._render(u)}_getRasterColorizerTechnique(e,r,i,n){const s=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(s.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new O$,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=n,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?c2.Noop:c2.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(Tze,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,i,n,s,o,a,l){const c=this._rctx,u=s.sourceLayerInfo.data,h=s.tile.surface.layerViewByIndex(s.layerIndex,Zt.MAP),p=e.baseOpacity<1?Za.Required:Za.NotRequired,f=p===Za.Required||e.opacity<1||n!==Ne.Normal||r!==As.Composite,g=f?Ef.On:Ef.Off,y=this._getBlendLayersTechnique(n,r,p,g);c.setPipelineState(y.getPipeline());let v=null,b=null;f?(b=this.currentFBO(i),this._vtFBO==null&&(this._vtFBO=new Zbe(this._rctx)),v=this._vtFBO.get(i),c.bindFramebuffer(v),this._clearCurrentFBO()):l&&c.clearSafe(Mi.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(c,s.sourceLod,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/s.scale),s.offset,a,o,h.contentZoom),u&&this._vectorTileHelper.renderContent(c,s.sourceLod,u,s.vtlNeighborInfos,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/s.scale),s.offset,a,o,h.contentZoom)}catch(w){WNt().warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return v==null||(c.bindFramebuffer(b),e.texture=v.colorTexture,e.offset=u_,e.scale=1,this.drawRasterData(e,r,i,n,g),l)}copyFBOToTexture(e){const r=this._rctx,i=r.bindTexture(e.texture,Mr.TEXTURE_UNIT_FOR_UPDATES),n=e.descriptor;r.gl.copyTexImage2D(In.TEXTURE_2D,0,n.pixelFormat,0,0,n.width,n.height,0),e.generateMipmap(),r.bindTexture(i,Mr.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clearSafe(Mi.COLOR_BUFFER_BIT|Mi.DEPTH_BUFFER_BIT|Mi.STENCIL_BUFFER_BIT)}_initFBO(e,r,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let n=this._fbos.length;n<=r;n++)this._fbos.push(new Zbe(this._rctx));this._initFBO(this._fbos[r].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const r=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const r=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},XNt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new jt({allocator:e=>e||new ZNt})}},ZNt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},JNt=class{constructor(e,r,i,n,s,o){this.start=e,this.end=r,this.blendMode=i,this.opacity=n,this.output=s,this.baseOpacity=o}},QNt=class{constructor(e,r,i,n){this._rctx=e,this.tileSize=r,this._techniques=i,this._cache=n,this._passParameters=new gNt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new YNt(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=wt(this._composition),this._backgroundTexture=lr(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,r){if(!e.renderData)return;const i=e.surface,n=i.baseOpacity;let s=0,o=0,a=this.tileSize,l=!1,c=!1;const u=i.view.state.contentPixelRatio;let h=!1;pV.clear(),FE.length=0;const p=e.layerInfo[Zt.MAP];let f=0,g=null;for(;f<p.length;f++){const b=i.layerViewByIndex(f,Zt.MAP),w=b.layer.opacity,x=b.fullOpacity;if(c=c||o6(b.layer),DD(b)){let P=b.layer.blendMode!=="normal";if(IP(b.layer.parent)){const M=Gte(b.layer.parent);M!=null&&M!==""&&(P=Cze(b.layer.parent)||P)}P&&(h=P,l=!1)}if(w===0&&!h){p[f].pendingUpdates&=~(pt.TEXTURE_NOFADING&pt.TEXTURE_FADING);continue}++o;const S=CT(b),E=YW(e,f,S);if(E){if(p[f].pendingUpdates&=~(pt.TEXTURE_NOFADING&pt.TEXTURE_FADING),IP(b.layer.parent)){const P=Gte(b.layer.parent);P!=null&&P!==""&&Pze(b.layer.parent,f)}S?a=Math.max(a,this.tileSize*u):n===1&&x===1&&(b.isOpaque||this._dataToTexture(E)&&E.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++s,g===null&&(g=f)}}const y=a/this.tileSize,v=this._ensureBackgroundTexture(this.tileSize);s!==0&&g!==null?s===1&&!h&&this._useLayerTexture(e,g)||this._composeMapLayers(e,r,f-1,c,a,y,!l||h,pV,h):this._useBackgroundTexture(e,o,v,r!==Os.FADING)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=u_,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useBackgroundTexture(e,r,i,n){const s=e.renderData,o=!n&&s.textureReference!=null&&(e.surface.view.layerViewManager.updating||r>0)?fb.Delayed:fb.Immediate;s.setTextureReference(new WW(i,Os.FADING,Jbe,e.surface.baseOpacity,0,1),o)}_useLayerTexture(e,r){const i=e.surface.layerViewByIndex(r,Zt.MAP),n=o6(i.layer),s=n?e.surface.baseOpacity:1,o=n?1:e.surface.baseOpacity,a=i.fullOpacity,l=YW(e,r,!1);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new WW(l.sourceLayerInfo.data,Os.FADING,l,s,o,a)),!0)}_composeMapLayers(e,r,i,n,s,o,a,l,c){this._composition.ensureBuffer(s);const u=e.surface.baseOpacity;let h=!1,p=Kt.LINEAR_MIPMAP_LINEAR,f=!1,g=0;for(let w=i;w>=0;w--){const x=e.surface.layerViewByIndex(w,Zt.MAP),S=CT(x),E=YW(e,w,S),P=x.layer.opacity;if(!E||P===0&&!c)continue;const M=!o6(x.layer)&&!h;M&&(h=!0);let L=!1;l.forEach(V=>{V.start===w&&(V.output=n?As.Composite:a&&M?this.backgroundIsGrid?As.GridComposite:As.ColorComposite:As.Composite,V.baseOpacity=M?u:1,FE.push(V),this._composition.openGroup(s),L=!0)}),this._passParameters.baseOpacity=M&&!L&&u<1?u:1;const U=g===0,z=L?As.GroupBackgroundComposite:a&&U?this.backgroundIsGrid?As.GridComposite:As.ColorComposite:As.Composite,W=Dte[DD(x)?x.layer.blendMode:"normal"];for(this._passParameters.opacity=P,MLt(E)?f=this._composition.drawVectorData(this._passParameters,z,s,W,E,o,this.tileSize,f):OLt(E)?(this._composition.drawImageryTileData(this._passParameters,z,s,W,E),this._hasNearestInterpolation(E)&&(p=Kt.NEAREST)):this._dataToTexture(E)&&(this._passParameters.texture=E.sourceLayerInfo.data.texture,this._passParameters.offset=E.offset,this._passParameters.scale=E.scale,this._composition.drawRasterData(this._passParameters,z,s,W));FE.length>0&&FE[FE.length-1].end===w;){const V=FE.pop();this._passParameters.baseOpacity=V.baseOpacity,this._passParameters.opacity=V.opacity,this._passParameters.offset=u_,this._passParameters.scale=1,this._composition.drawGroup(this._passParameters,V.output,s,Dte[V.blendMode])}g++}const y=e.renderData,v=c||h&&u<1,b=y.ensureTexture(s,v,()=>this._buildTexture(s,v,p));this._composition.copyFBOToTexture(b),this._composition.unbind(),y.setTextureReference(new WW(b,r,Jbe,h?1:u,0,1))}_hasNearestInterpolation(e){const r=e.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(e){if($Lt(e)){const r=e.sourceLayerInfo;r.data=this._buildTexture(r.data,!0),e.tile.setMemoryDirty()}return RLt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,r,i=Kt.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const n=new ui;n.wrapMode=nr.CLAMP_TO_EDGE,n.samplingMode=i,n.maxAnisotropy=this._maxAnisotropy,n.preMultiplyAlpha=!0,n.flipped=!0,n.hasMipmap=!0,r||(n.pixelFormat=Ot.RGB);const s=this._rctx;let o;if(typeof e=="number"){n.width=n.height=e;const l=`${e} ${n.pixelFormat}`;o=this._cache.pop(l),o?o.retain():o=new A$(new Mr(s,n),this._cache)}else if(dIt(e)){n.isOpaque=e.isOpaque,n.isOpaque&&(n.pixelFormat=Ot.RGB);const l=`${e} ${n.pixelFormat}`;o=this._cache.pop(l),o?(o.retain(),o.texture.setData(e.image)):o=new A$(new Mr(s,n,e.image),this._cache),e.release()}else try{n.width=e.width,n.height=e.height,o=new A$(new Mr(s,n,e))}catch{o=new A$(nDe(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=s.bindTexture(o.texture,Mr.TEXTURE_UNIT_FOR_UPDATES);return o.generateMipmap(),s.bindTexture(a,Mr.TEXTURE_UNIT_FOR_UPDATES),o}get test(){return{backgroundTexture:this._backgroundTexture}}};function YW(t,e,r){ja.layerIndex=e,ja.vtlNeighborInfos.clear();const i=t.layerInfo[Zt.MAP][e];if(yr(ja.offset,0,0),ja.tile=t,ja.scale=1,ja.sourceLod=t.lij,ja.sourceLayerInfo=i,ja.isVTLBackground=r,i.data)return r&&t.forEachLoadedNeighbor((s,o)=>{if(s.level!==t.level)return;const a=s.layerInfo[Zt.MAP][e];if(!IUe(a)||i.data===a.data)return;const l=ja.vtlNeighborInfos.pushNew();l.offset=c0[o],l.sourceLod=s.lij,l.sourceLayerInfo=a}),ja;const n=i.upsampleInfo;if(n){const s=n.tile.layerInfo[Zt.MAP][e];return ja.tile=n.tile,vo(ja.offset,n.offset),ja.scale=n.scale,ja.sourceLod=n.tile.lij,ja.sourceLayerInfo=s,ja}return r?ja:null}function Gte(t){return t.uid}function Cze(t){let e=t.blendMode!=="normal";return IP(t.parent)&&(e=Cze(t.parent)||e),e}function Pze(t,e){IP(t.parent)&&Pze(t.parent,e);const r=Gte(t);if(r!=null&&r!==""){const i=pV.get(r);i?i.start=e:pV.set(r,new JNt(e,e,t.blendMode,t.opacity,As.Composite,1))}}const pV=new Map,FE=new Array,ja=new XNt,Jbe={offset:[0,0],scale:1},c0=new Array;c0[bt.NORTH]=[0,-1],c0[bt.NORTH_EAST]=[-1,-1],c0[bt.EAST]=[-1,0],c0[bt.SOUTH_EAST]=[-1,1],c0[bt.SOUTH]=[0,1],c0[bt.SOUTH_WEST]=[1,1],c0[bt.WEST]=[1,0],c0[bt.NORTH_WEST]=[1,-1];const Aze=200,XW=40,KNt=.8,e4t=10,M$=1e-6;function t4t(t,e,r){const i=e,n=r;let s=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(i[a]<l){if(n[a]<=M$)return!1;const c=(l-i[a])/n[a];s=Math.max(s,c)}else if(n[a]<=-M$){const c=(l-i[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}{const l=t[a+3];if(i[a]>l){if(n[a]>=-M$)return!1;const c=(l-i[a])/n[a];s=Math.max(s,c)}else if(n[a]>=M$){const c=(l-i[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}}return!0}let Qbe=class{constructor(e,r,i,n,s){this.aabb=e,this.axis=r,this.d=i,this.midStartIndex=n,this.rightStartIndex=s}},Dce=class jte{constructor(e,r,i,n){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=r,this.positions=n,this._rayDirection=C(),this.bspNodeTree=new Array;const s=i-r,o=s<=Oze?new Uint16Array(s):new Uint32Array(s);this.indices=o;for(let a=0;a<s;++a)o[a]=a;{const a=o4t(e,r,i,n.data,n.stride),l=we(Math.log2(s/XW),2,e4t),c=(u,h,p)=>{const f=n4t(o,a,u,h),g=h-u;if(g<=XW){const S=new Qbe(f,void 0,0,u,h);return this.bspNodeTree.push(S),S}const{axis:y,midValue:v}=s4t(f),b=i4t(o,a,u,h,y,v),w=(S,E)=>{if(p>l)return;const P=E-S;return P<XW||P>=KNt*g?void 0:c(S,E,p+1)},x=new Qbe(f,y,v,b.next,b.mid);return this.bspNodeTree.push(x),x.leftNode=w(u,b.next),x.rightNode=w(b.mid,h),x};c(0,s,0),this.triangleVertexIndices=a4t(o,e,r,i)}}intersectRayTriangleRange(e,r){if(e>=r)return;const i=this.triangleVertexIndices,n=this.positions.data,s=this.positions.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],u=this._rayDirection,h=u[0],p=u[1],f=u[2];for(let g=e,y=3*e;g<r;++g){const v=i[y]*s,b=n[v],w=n[v+1],x=n[v+2],S=i[y+1]*s,E=n[S],P=n[S+1],M=n[S+2],L=i[y+2]*s;y+=3;const U=E-b,z=P-w,W=M-x,V=n[L]-b,J=n[L+1]-w,Y=n[L+2]-x,X=p*Y-J*f,le=f*V-Y*h,D=h*J-V*p,I=U*X+z*le+W*D;if(Math.abs(I)<=Number.EPSILON)continue;const k=a-b,j=l-w,q=c-x,Q=k*X+j*le+q*D;if(I>0){if(Q<0||Q>I)continue}else if(Q>0||Q<I)continue;const ie=j*W-z*q,ye=q*U-W*k,Ae=k*z-U*j,Ze=h*ie+p*ye+f*Ae;if(I>0){if(Ze<0||Q+Ze>I)continue}else if(Ze>0||Q+Ze<I)continue;const Et=(V*ie+J*ye+Y*Ae)/I;if(Et>=0){const xt=this.indices[g]+this.firstTriangleIndex,Qe=Yae(U,z,W,V,J,Y,r4t);this._callback(Et,Qe,xt,!1)}}jte.numFacesTested+=r-e}intersectRay(e,r,i){jte.numFacesTested=0;const n=e,s=r,o=s[0]-n[0],a=s[1]-n[1],l=s[2]-n[2];if(o*o+a*a+l*l<M$)return;this._rayOrigin=n;const c=this._rayDirection;c[0]=o,c[1]=a,c[2]=l;const u=this.triangleVertexIndices.length/3;this._callback=i;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,u)}intersectRayBSP(e,r,i){const n=this._rayOrigin,s=this._rayDirection;if(!t4t(e.aabb,n,s))return;const o=e.axis,a=e.d;if(n[o]<a||s[o]<0){const l=r,c=e.midStartIndex;if(l<c){const u=e.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),n[o]>a||s[o]>0){const l=e.rightStartIndex,c=i;if(l<c){const u=e.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};Dce.numFacesTested=0;const r4t=C(),kE=[1/0,1/0,1/0],UE=[-1/0,-1/0,-1/0];function i4t(t,e,r,i,n,s){let o=r,a=i;for(;o<a;){const c=t[o];e[6*c+n+3]<=s?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=i;l<a;){const c=t[a-1];e[6*c+n]>=s?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function n4t(t,e,r,i){if(i<=r)return JT(NaN,NaN,NaN,NaN,NaN,NaN);{const n=6*t[r];for(let s=0;s<3;++s)kE[s]=e[n+0+s],UE[s]=e[n+3+s]}for(let n=r+1;n<i;++n){const s=6*t[n];for(let o=0;o<3;++o)kE[o]=Math.min(kE[o],e[s+0+o]),UE[o]=Math.max(UE[o],e[s+3+o])}return JT(kE[0],kE[1],kE[2],UE[0],UE[1],UE[2])}function s4t(t){const e=t[3]-t[0],r=t[4]-t[1],i=t[5]-t[2],n=e>r?e>i?0:r>i?1:2:r>i?1:i>e?2:0;return{axis:n,midValue:(t[n]+t[n+3])/2}}function o4t(t,e,r,i,n){const s=r-e,o=new Float32Array(6*s);for(let a=0;a<s;++a){const l=3*(a+e),c=t[l]*n,u=t[l+1]*n,h=t[l+2]*n;for(let p=0;p<3;++p){const f=i[c+p],g=i[u+p],y=i[h+p];o[6*a+p]=Math.min(f,g,y),o[6*a+3+p]=Math.max(f,g,y)}}return o}function a4t(t,e,r,i){const n=i-r;let s=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)s=Math.max(e[3*a+l],s);const o=s<=Oze?new Uint16Array(3*n):new Uint32Array(3*n);for(let a=0;a<n;++a){const l=3*(t[a]+r);for(let c=0;c<3;++c){const u=e[l+c];o[3*a+c]=u}}return o}const Oze=65535;let es=class extends Zl{constructor(){super(...arguments),this.output=G.Color,this.overlayMode=Vg.Disabled,this.tileBlendInput=jg.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=ht.Simplified}};d([H({count:G.COUNT})],es.prototype,"output",void 0),d([H({count:Vg.COUNT})],es.prototype,"overlayMode",void 0),d([H({count:jg.COUNT})],es.prototype,"tileBlendInput",void 0),d([H()],es.prototype,"spherical",void 0),d([H()],es.prototype,"doublePrecisionRequiresObfuscation",void 0),d([H()],es.prototype,"receiveShadows",void 0),d([H()],es.prototype,"hasSlicePlane",void 0),d([H()],es.prototype,"backfaceCullingEnabled",void 0),d([H()],es.prototype,"textureFadingEnabled",void 0),d([H()],es.prototype,"renderOccluded",void 0),d([H()],es.prototype,"hasScreenSpaceReflections",void 0),d([H()],es.prototype,"hasCloudsReflections",void 0),d([H()],es.prototype,"invisible",void 0),d([H()],es.prototype,"tileBorders",void 0),d([H()],es.prototype,"visualizeNormals",void 0),d([H()],es.prototype,"screenSizePerspective",void 0),d([H()],es.prototype,"receiveAmbientOcclusion",void 0),d([H({count:ht.COUNT})],es.prototype,"pbrMode",void 0),d([H({constValue:Ur.Compressed})],es.prototype,"normalType",void 0),d([H({constValue:mn.Compressed})],es.prototype,"textureCoordinateType",void 0),d([H({constValue:!1})],es.prototype,"highStepCount",void 0),d([H({constValue:!1})],es.prototype,"useCustomDTRExponentForWater",void 0),d([H({constValue:!1})],es.prototype,"useFillLights",void 0),d([H({constValue:!0})],es.prototype,"hasColorTexture",void 0);const ZW=7,l4t=10,JW=Ds();var ql;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(ql||(ql={}));let wd=class extends dNe{get _isGlobal(){return this._stage.viewingMode===Fe.Global}get _techniques(){return this._context.techniqueRepository}get _rctx(){return this._context.renderContext.rctx}constructor(e,r,i,n,s){super({}),this._overlayRenderer=e,this._stage=r,this._allTiles=i,this._ellipsoidRadius=n,this.type=Yi.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new es,this._passParameters=new Ece,this._drawParameters=new Qee,this._renderDataPool=new fa(LDt),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new kUe,this._transparencyState=ql.Opaque,this._castShadows=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=Wr.Occlude,this.produces=new Map([[de.OPAQUE_TERRAIN,()=>this._produces()],[de.TRANSPARENT_TERRAIN,()=>this._produces()],[de.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileTextureCache=new jN((o,a)=>s.newCache(o,a),"TileTexture"),this.tileGeometryCache=new pNt(s)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(pe(()=>this._overlayRenderer.rendersOccludedDraped,e=>{this.renderOccludedFlags=e?H9:Wr.Occlude,this.setNeedsRender()},ei))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?cNe:X7}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===ql.TransparentWithDraped||e===ql.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return kb}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e,this._getLocalOriginOfTile(e)))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,pt.TEXTURE_FADING)}updateTileTexture(e,r){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,r===pt.TEXTURE_FADING?Os.FADING:Os.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(r))}updateTileGeometryState(e){for(const i of e.layerInfo[Zt.ELEVATION])i.pendingUpdates&=~pt.GEOMETRY;e.resetPendingUpdate(pt.GEOMETRY);const r=e.renderData.updateGeometryState();return r&&this.setDirty(),r}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const r=e.renderData;r&&(r.releaseGeometry(),this._renderDataPool.release(r),r.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const r=l4t-ZW,i=Math.max(0,Math.floor((e.level-r)/ZW)*ZW);if(this._isGlobal&&i===0)return Yn;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=Hn.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=Hn.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=Hn.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new QNt(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=nDe(this._rctx)}uninitializeRenderContext(){this._emptyTex=wt(this._emptyTex),this._tileRenderer=wt(this._tileRenderer)}intersect(e,r,i,n){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==ql.Opaque)return;const s=c4t,o=u4t;_e(s,n,i),se(o,1/s[0],1/s[1],1/s[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,u=e.options.store===ha.MIN,h=!!e.results.ground.target,p=llt(e.verticalOffset),f=e.tolerance;let g,y=u&&a.dist!=null?a.dist:1/0;const v=w=>{const x=w.renderData;if(!(x!=null&&x.vao))return;const S=x.geometry;HB(JW,S.boundingBox);const E=x.localOrigin;p!=null&&(p.localOrigin=E,p.applyToAabb(JW));const P=JW;if(zE[0]=i[0]-E[0],zE[1]=i[1]-E[1],zE[2]=i[2]-E[2],!Zae(P,zE,o,f,y))return;const M=(le,D,I)=>{le.set(this.type,w,D,I,fn),y=u&&a.dist!=null?a.dist:1/0},L=(le,D)=>{if(D!=null&&le>=0&&(e.options.backfacesTerrain||fe(D,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||r==null||r(i,n,le))){if((c.dist==null||le<c.dist)&&M(c,le,D),e.options.isFiltered)return;e.options.store===ha.ALL&&(g==null?(g=Moe(e.ray),M(g,le,D),e.results.all.push(g)):le<g.dist&&M(g,le,D)),(a.dist==null||le<a.dist)&&M(a,le,D),e.options.store!==ha.MIN&&(l.dist==null||le>l.dist)&&M(l,le,D)}},U=h4t;_e(U,n,E);const{indices:z,indexCount:W}=S,V=S.vertexAttributes,J=V.getField(R.POSITION,mo),Y=new jA(J.typedBuffer,3,V.stride/4),X=W/3;if(!p&&X>Aze){const le=w.renderData;le.intersectionData==null&&(le.intersectionData=new Dce(z,0,X,Y)),le.intersectionData.intersectRay(zE,U,L)}else LN(zE,U,0,X,z,Y,null,p,L)},b=this._rootTiles;b!=null&&(()=>{const w=this._tileIterator;w.reset(b);const x=e.options.invisibleTerrain;for(let S=w.next();S;S=w.next())!(S.visible||x&&S.intersectsClippingArea)||p==null&&!S.intersectsRay(i,s,f,y)||h&&this._useStencilForTile(S)?w.skipSubtree():v(S)})()}processScaleRangeQueries(e,r){var i;if(!r.done)for(this._updatePatchGroups();e.updating&&!r.done;){e.prepare();for(const n of this._visiblePatchesByOrigin.values())for(const s of n)((i=s.renderData)==null?void 0:i.textureReference)!=null&&e.queriesForTile(s);e.process(),r.madeProgress()}}prepareTechnique(e){const r=ne("enable-feature:terrain-shadows")&&e.bindParameters.shadowMap.enabled;if(r!==this._castShadows&&(this._castShadows=r,this._patchesByOriginDirty=!0),e.bindParameters.slot===de.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&H9))return null}else{const i=this.transparency===ql.Opaque?de.OPAQUE_TERRAIN:de.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==i)return null}if(this.transparency===ql.Empty)return null;switch(e.output){case G.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.lastFrameColor!=null,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssao!=null,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(G.Color,e.bindParameters.slot===de.OCCLUDED_TERRAIN);case G.Shadow:case G.ShadowExcludeHighlight:return this._castShadows?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.Shadow,!1)):null;case G.LinearDepth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.LinearDepth,!1);case G.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.Normal,!1);case G.ObjectAndLayerIdColor:return this._updateTechnique(G.ObjectAndLayerIdColor,!1);case G.Highlight:return this._overlayRenderer.hasHighlights?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.Highlight,!1)):null}return null}renderNode(e,r){switch(this._updatePatchGroups(),r.useStencil=!1,e.output){case G.Color:{const i=e.bindParameters.slot===de.OCCLUDED_TERRAIN?Wi.Occluded:Wi.Color;this._renderMaterialPass(e,r,i);break}case G.LinearDepth:case G.Normal:this._renderAuxiliaryPass(e,r,Wi.Color,this._visiblePatchesByOrigin);break;case G.Highlight:this._renderAuxiliaryPass(e,r,Wi.Highlight,this._visiblePatchesByOrigin);break;case G.Shadow:case G.ShadowExcludeHighlight:this._renderAuxiliaryPass(e,r,null,this._allPatchesByOrigin);break;case G.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,r,Wi.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;const r=this._tileRenderer;let i;if(e!=null){const n=De.toUnitRGBA(e);i=Ce(n[0]||0,n[1]||0,n[2]||0)}r.setBackground(i),this._allTiles.forAll(n=>r.updateTileTexture(n,Os.FADING)),this._techniqueConfiguration.tileBlendInput=r.backgroundIsGrid?jg.GridComposite:r.backgroundColor!=null?jg.ColorComposite:jg.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==xA.NONE){const e=Array.from(this._visiblePatchesByOrigin.values()),r=this._stencilEnabledLayerExtents;for(const i of e)UUe(this.renderOrder,i,r);e.sort((i,n)=>zUe(i[0],n[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var r;const e=this._rootTiles;if(e!=null){(r=e[0])==null||r.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const r=this._tileIterator;for(r.resetOne(e);!r.done;){const i=r.next(),n=i.renderData;if(!n){this._numTilesCulled++;continue}const s=n.localOrigin;if(this._castShadows){let a=this._allPatchesByOrigin.get(s);a||(a=[],this._allPatchesByOrigin.set(s,a)),a.push(i)}if(!i.visible){this._numTilesCulled++,r.skipSubtree();continue}let o=this._visiblePatchesByOrigin.get(s);o||(o=[],this._visiblePatchesByOrigin.set(s,o)),o.push(i),r.skipSubtree()}}_useStencilForTile(e){for(const r of this._stencilEnabledLayerExtents)if(e.intersectsExtent(r))return!0;return!1}_renderAuxiliaryPass(e,r,i,n){const s=e.rctx;this._passParameters.overlayContent=i,s.bindTechnique(r,e.bindParameters,this._passParameters);const o=this._stencilEnabledLayerExtents.length>0;n.forEach(a=>{this._drawParameters.origin=a[0].renderData.localOrigin,r.program.bindDraw(this._drawParameters,e.bindParameters,this._passParameters);for(let l=0;l<a.length;l++)this._renderPatch(e,r,a[l],dr.TRIANGLES,o,i)}),e.rctx.bindVAO(null)}_renderMaterialPass(e,r,i){var p;const{rctx:n}=e;this._passParameters.overlayContent=i,n.bindTechnique(r,e.bindParameters,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const s=e.bindParameters.camera,o=r.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const f=o4e(this._stage.viewingMode,this._ellipsoidRadius),g=this.pointsOfInterest.centerOnSurfaceFrequent.distance;f.update({distance:g,fovY:s.fovY})}const a=this._stencilEnabledLayerExtents.length>0,l=i===Wi.Occluded;l&&(o.bindTexture("tex",this._emptyTex),o.setUniform3fv("textureOpacities",Yn),o.setUniform4fv("texOffsetAndScale",Fh));const c=((p=this._tileRenderer)==null?void 0:p.backgroundColor)!=null?this._tileRenderer.backgroundColor:Yn;this._techniqueConfiguration.tileBlendInput===jg.ColorComposite&&o.setUniform3fv("backgroundColor",c);const u=this.wireframe?dr.LINES:dr.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&o.bindTexture("texNext",this._emptyTex);const h=this._visiblePatchesByOrigin;for(const f of h.values()){const g=f[0].renderData.localOrigin;r.program.bindDraw(new Qee(g),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const y of f){const v=y.renderData,b=v.textureReference;if(b!=null){if(!l){o.setUniform4fv("texOffsetAndScale",b.offsetAndScale),o.bindTexture("tex",b.texture.texture);const w=v.textureFadeFactor,x=w<1?v.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&x!=null&&w<1?(o.setUniform1f("fadeFactor",w),o.setUniform4fv("nextTexOffsetAndScale",x.offsetAndScale),o.setUniform3fv("nextTexOpacities",x.opacities),o.bindTexture("texNext",x.texture.texture)):o.setUniform1f("fadeFactor",1),v.textureIsFading&&this.setNeedsRender(),o.setUniform3fv("textureOpacities",b.opacities)}this._renderPatch(e,r,y,u,a,i),y.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,r,i,n,s,o){const a=i.renderData,l=a.vao,c=l==null?void 0:l.indexBuffer;if(!l||c==null)return void(uo&&console.error("Rendered tile with no indices: ",i.lij," : ",a));const u=r.program;o==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(u,a.overlay),s&&(r.useStencil=this._useStencilForTile(i),e.rctx.setPipelineState(r.getPipeline()));const h=a.geometry.indexCount;e.rctx.bindVAO(l),u.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(n,h,c.indexType,0)}_bindOverlayPatchData(e,r){e.setUniform4fv("overlayTexOffset",r.offsets),e.setUniform4fv("overlayTexScale",r.scales)}_updateTechnique(e,r){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=r,this._shaderTechnique=this._techniques.releaseAndAcquire(ZUe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};d([m({readOnly:!0})],wd.prototype,"_isGlobal",null),d([m()],wd.prototype,"renderOccludedFlags",void 0),d([m({value:!1})],wd.prototype,"renderingDisabled",null),d([m({value:!0})],wd.prototype,"visible",null),d([m()],wd.prototype,"renderPatchBorders",null),d([m()],wd.prototype,"visualizeNormals",null),d([m()],wd.prototype,"cullBackFaces",null),d([m({value:xA.FRONT_TO_BACK})],wd.prototype,"renderOrder",null),d([m()],wd.prototype,"wireframe",null),wd=d([F("esri.views.3d.terrain.TerrainRenderer")],wd);const c4t=C(),u4t=C(),zE=C(),h4t=C();let d4t=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},fg=class extends Pe{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),pe(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(r=>!(!fI(r)||r.isRejected())&&!(r.isFulfilled()&&!p4t(r,this.viewSpatialReference,this.viewingMode))&&(e=r,!((r==null?void 0:r.type)==="vector-tile"||lV(r)))),e)if(e.isResolved()){const r=OG(e,this.viewSpatialReference,this.viewingMode);if(r!=null){const i=new wu(r.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const r=e.when().catch(()=>{}).then(()=>{r!==this._waitTask||this.destroyed||this._update()});this._waitTask=r}_lockTilingScheme(e){if(this.viewingMode===Fe.Global){const r=e.levels.length-1;e.spatialReference.isWebMercator?e=wu.makeWebMercatorAuxiliarySphere(r):Rb(e.spatialReference)&&(e=wu.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(pe(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Fe.Global){const e=this.extentHelper.viewSpatialReference,r=Rb(e)||nw(e)||sw(e);e.isWebMercator?this.tilingScheme=wu.WebMercatorAuxiliarySphere:r&&(this.tilingScheme=wu.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||hT(e,this.extent)||(this.tilingScheme=wu.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function p4t(t,e,r){return OG(t,e,r)!=null}d([m()],fg.prototype,"tilingScheme",void 0),d([m({readOnly:!0})],fg.prototype,"extent",void 0),d([m({value:!1})],fg.prototype,"tilingSchemeLocked",void 0),d([m({constructOnly:!0})],fg.prototype,"viewSpatialReference",void 0),d([m({constructOnly:!0})],fg.prototype,"layers",void 0),d([m({constructOnly:!0})],fg.prototype,"extentHelper",void 0),d([m({constructOnly:!0})],fg.prototype,"viewingMode",void 0),fg=d([F("esri.views.3d.terrain.TilingSchemeLogic")],fg);let f4t=class{constructor(){this.offset=Ye(),this.scale=0,this.tile=null}init(e,r,i,n){this.tile=e,this.offset[0]=r,this.offset[1]=i,this.scale=n}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}};var D8;let er=D8=class extends Xn.EventedMixin(Pe){constructor(t){var e,r,i;super(t),this._scaleRangeQueries=new L8,this._iteratorPool=new fa(kUe,n=>n.remove=()=>this._iteratorPool.release(n)),this._postorderIterator=new XLt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new d4t,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=C(),this._eyePosSurfaceSR=C(),this._splitLimits=new of,this._frustum=pD(),this._viewProjectionMatrix=xe(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new em,this._frameTask=uA,this._allTiles=new jt,this._upsampleInfoPool=new fa(f4t),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=Ht(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Ve.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new S3(1/0,-1/0),this.rootTileElevationBounds=new S3(1/0,-1/0),this._sebProjectorMap=new Map,this._sebProjectorCache=$se(),this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new vc({...t,surface:this}),this._isGlobal=!((r=(e=t.view)==null?void 0:e.state)!=null&&r.isLocal),this._isGeographic=((i=this._spatialReference)==null?void 0:i.isGeographic)??!1,this._tileConstructor=this._isGlobal?uNt:aNt}initialize(){const t=this.view,e=t.resourceController;this._lercDecoder=HIt(e);const r=e.memoryController;this._tileCache=new jN((l,c)=>r.newCache(l,c),"terrain-tile"),this._upsampleMapCache=r.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new GIt(r.newCache("elevation-query"));const i=this.overlayManager;this._renderer=new wd(i.renderer,t._stage,this._allTiles,zr(t.spatialReference).radius,r),this.addHandles([pe(()=>i.renderer.isEmpty,()=>this._evaluateTransparency()),pe(()=>this.renderer.visible,l=>this.suspended=!l)],"overlayManager"),this.addHandles([pe(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?Os.UNFADED:Os.IMMEDIATE)},li),pe(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?Os.UNFADED:Os.IMMEDIATE),li),pe(()=>this.backgroundColor,(l,c)=>{l!=null&&l.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},ei),pe(()=>this.snapLevel,()=>this._viewChanged=!0,ei),pe(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),pe(()=>Si.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?re(()=>import("./TerrainTileTree3DDebugger-Y8opW-sa.js"),__vite__mapDeps([162,163])).then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&Si.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:t}))}):l||(this._treeDebugger=Me(this._treeDebugger))},mi)]);const{spatialReference:n}=t;this._extentHelper=ULt(this.viewingMode,{layers:t.map.allLayers,layerViews:t.allLayerViews,viewSpatialReference:n});const s=new FP({getCollections:()=>{var l,c;return(c=(l=t.defaultsFromMap)==null?void 0:l.mapCollections)==null?void 0:c.map(({layers:u})=>u)},getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new fg({layers:s,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:n});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(Dg.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(Dg.BASEMAP);const a=e.scheduler;this._frameTask=a.registerTask(Ct.TERRAIN_SURFACE,this),this.addHandles([pe(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),mi),pe(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),ei),pe(()=>this.extent,()=>this._updateRootTiles(),mi),t.on("resize",()=>this._viewChangeUpdate()),pe(()=>{const l=t.state;return[this._lodBias,this.lodSnapping,t.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),li),pe(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.fadeDuration},l=>this._renderer.textureFadingEnabled=l>0,mi),pe(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.physicallyBasedRenderingEnabled},l=>this._renderer.pbrMode=l?ht.Simplified:ht.Disabled,mi),pe(()=>this._userClippingExtent,()=>this._updateClippingExtent(),ei)]),this.addHandles(t.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._lercDecoder=lr(this._lercDecoder),this._removeAllTiles(),this._set("tilingSchemeLogic",Me(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((t,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Me(this.overlayManager)),this._tileCache=Me(this._tileCache),xce.prune(),this._treeDebugger=Me(this._treeDebugger),this._renderer=Me(this._renderer),this._iteratorPool=Me(this._iteratorPool),this._upsampleMapCache=Me(this._upsampleMapCache),this._elevationQueryCache=Me(this._elevationQueryCache),this._set("view",null),this._extentHelper=Me(this._extentHelper),this._upsampleInfoPool=Me(this._upsampleInfoPool),uLt(),wDt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var t,e;if(this.lodSnapping===GI.ON){const r=this.view,i=this.tilingScheme,n=(e=(t=r.pointsOfInterest)==null?void 0:t.cameraOnSurface)==null?void 0:e.scale;if(i&&n){const s=r.state.contentCamera;let o=R7(r,s.eye,s.viewForward,s.up).tilt;o>90&&(o=180-o);const a=2*(o/90)**2,l=i.levelAtScale(n)-a,c=Math.min(l+r.qualitySettings.tiledSurface.lodBias,this._splitLimits.maxLod||1/0);return c<=0?null:c}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?GI.ON:GI.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:t}=this,{clippingArea:e}=this.view;if(e==null||t==null)return null;const r=Ht(),i=iUe(e,r,t)?r:null,n=this._get("extent");return hT(i,n)?n:i}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const t=VZ(this.groundExtent,this._userClippingExtent,Ht()),e=this._get("extent");return hT(t,e)?e:t}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var t;return(t=this.tilingSchemeLogic)==null?void 0:t.extent}get updating(){var t,e;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(t=this._watchUpdatingTracking)!=null&&t.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(e=this.overlayManager)!=null&&e.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var t,e,r;return((r=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:r.opacity)??1}set baseOpacity(t){this.view.map.ground.opacity=t}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(t){this._renderer.renderOrder=t,this._set("renderOrder",t)}get rootTiles(){return this._rootTiles}get spatialReference(){var t;return((t=this.tilingScheme)==null?void 0:t.spatialReference)??null}get backgroundColor(){var t,e,r;return(r=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:r.surfaceColor}set backgroundColor(t){this.view.map.ground.surfaceColor=t}set slicePlaneEnabled(t){this._renderer.slicePlaneEnabled=t,this._set("slicePlaneEnabled",t),this._evaluateTransparency()}get tilingSchemeLocked(){var t;return((t=this.tilingSchemeLogic)==null?void 0:t.tilingSchemeLocked)??!1}get wireframe(){var t;return(t=this._renderer)==null?void 0:t.wireframe}set wireframe(t){t!==this._renderer.wireframe&&(this._renderer.wireframe=t,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===ql.Opaque}set suspended(t){this._set("suspended",t),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(t,e,r,i){this._renderer.intersect(t,e,r,i)}getElevation(t,e,r,i){const n=this._rootTiles;if(!(n!=null&&n.length)||n[0].layerInfo[Zt.ELEVATION].length===0)return null;let s=this._elevationProjectorCache.get(i);if(s===void 0&&(s=Pb(i,this._spatialReference)??null,this._elevationProjectorCache.set(i,s)),s==null)return K.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const o=se(DM,t,e,r);return s(o,0,o,0),Kbe(n,o[0],o[1])}getElevations(t,e,r){const i=this._rootTiles,n=i?i[0].layerInfo[Zt.ELEVATION].length:0;if(i!=null&&i.length&&n!==0)for(let s=0;s<e;++s){const o=3*s;r(s,Kbe(i,t[o],t[o+1]))}else for(let s=0;s<e;++s)r(s,null)}getScale(t){if(!this.tilingScheme)return null;if(!Cn(t,DM,this.spatialReference))return K.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const r of e)if(r!=null&&r.containsPoint(DM)){let i=r;for(;i.children[0]&&!i.rendered;){const n=i.children[0].extent;let s=0;DM[0]>n[2]&&(s+=1),DM[1]<n[1]&&(s+=2),i=i.children[s]}return this._getLodBiasCorrectedScale(i.level)}}return 1/0}_ensureSEBProject(t){const e=this._sebProjectorMap.get(t);if(e)return e;const r=Pb(t,this._tilingSchemeSpatialReference,this._sebProjectorCache)??null;return this._sebProjectorMap.set(t,r),r}getSphereElevationBounds(t,e){const r=this._ensureSEBProject(e);if(r==null)return K.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;KT(t,VE);const i=VE;r(i,0,i,0);const n=new sV,s=this._rootTiles;if(s!=null){const o=[];for(const l of s)o.push(l);let a=0;for(;a<o.length;){const l=o[a];if(++a,!spe(l.extent,VE))continue;const c=l.children;if(c[0]==null||l.rendered)n.expandElevationRangeValues(l.elevationBoundsMin,l.elevationBoundsMax);else for(const u of c)o.push(u)}}return n}getRootElevationBounds(){return new sV(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getSphereScale(t,e){if(!this.tilingScheme)return null;if(!Cn(t,VE,this.spatialReference))return K.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;VE[3]=e;let r=null;const i=s=>{if(s&&spe(s.extent,VE)){const o=s.children;if(o[0]&&!s.rendered)for(const a of o)i(a);else{const a=this._getLodBiasCorrectedScale(s.level);r=r==null?a:Math.min(r,a)}}},n=this._rootTiles;if(n!=null)for(const s of n)i(s);return r}queryVisibleScaleRange(t,e,r,i){const n=e?this.tilingScheme.levelAtScale(e):0,s=r?this.tilingScheme.levelAtScale(r):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(t,n+o,s+o,i)}_evaluateTransparency(){var s,o;const t=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,r=this._renderer.transparency,i=this._allSurfaceLayersTransparent()?e?ql.Empty:ql.TransparentWithDraped:t>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?ql.Opaque:ql.Semitransparent,n=r!==i;return n&&(this._renderer.transparency=i,(o=(s=this.view)==null?void 0:s._stage)==null||o.renderer.setParameters({terrainTransparency:this._renderer.transparency})),n}_updateTilingScheme(){var r,i,n,s;const t=this.tilingSchemeLogic.tilingScheme;if(t===this.tilingScheme)return;Vs(!!t,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((i=(r=this.view)==null?void 0:r.state)!=null&&i.isLocal),this.tilingScheme&&this._removeAllTiles();const e=(t==null?void 0:t.spatialReference)??Ve.WebMercator;this._spatialReference=e,this._isWebMercator=!!(e!=null&&e.isWebMercator),this._isWebMercatorOnPlateCarree=this._isWebMercator&&zL((n=this.view)==null?void 0:n.renderSpatialReference),this._isGeographic=(e==null?void 0:e.isGeographic)??!1,this._set("tilingScheme",t),this._tilingSchemeSpatialReference=(s=this.tilingScheme)==null?void 0:s.spatialReference,this._sebProjectorMap.clear(),this._updateClippingExtent(),t&&(this._updateTiledLayers(),this._renderer.setTileSize(t.pixelSize),this.overlayManager.setSpatialReference(t.spatialReference),this._updateRootTiles())}_acquireTile(t,e,r,i){const n=this._tileCache.pop(D8._tileMemcacheKey);return n?(n.init(t,e,r,i,this),n):new this._tileConstructor(t,e,r,i,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:t,tilingScheme:e}=this;if(!e)return;const r=g4t;let i=e.rootTilesInExtent(t,r,5*s3);if(this._rootTiles!=null){if(i.length>s3)return void K.getLogger(this).warn(tct);const n=this._rootTiles.map(o=>o.lij),s=jX(n,i,$8);if(this._updatingRootTiles=!0,s.removed.length>0||s.added.length>0){const o=this._rootTiles.filter(a=>!(s.removed.findIndex(l=>$8(l,a.lij))>-1)||(this._purgeTile(a),!1));s.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,i.length>s3&&(K.getLogger(this).warn(rct),i=e.rootTilesInExtent(t,r,s3)),this._setRootTiles(i.map(n=>this._newRootTile(n)));hT(r,this._rootTilesExtent)||(this._rootTilesExtent=Ht(r)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const t=this._allTiles.filter(e=>e.isLoaded&&e.intersectsClippingArea);t.forEach(e=>this._renderer.updateTileGeometryState(e)),t.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(t),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(t){if(t.length===0)return;t.sort(Q0);const e=this.renderer;t.forEach(r=>e.updateGeometryIfNeeded(r)),t.forEach(r=>this._pendingTilesForElevationUpdateEvent.add(r))}_shouldSplit(t){return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===pt.SPLIT}_newRootTile(t){const e=this._acquireTile(0,t[1],t[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(pt.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(t){if(this._rootTiles=t,this._allTiles.clear(),t!=null){const e=this._iteratorPool.acquire();for(e.reset(t);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(t)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(t){t.updateClippingStatus(this.extent)&&t.resetPendingUpdate(pt.GEOMETRY)&&this._updateTileGeometryState(t)}_updateTilesVisibility(t){if(t==null)return;const e=rDt(t),r=this.visibleElevationBounds;let i=e?r.min:1/0,n=e?r.max:-1/0;const s=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(t);!a.done;){const l=a.next();l.updateClippingStatus(s)&&l.resetPendingUpdate(pt.GEOMETRY)&&this._updateTileGeometryState(l),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(i=Math.min(l.elevationBoundsMin,i),n=Math.max(l.elevationBoundsMax,n))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(i)&&isFinite(n)&&(r.min!==i||r.max!==n)&&(this.visibleElevationBounds=new S3(i,n))}_updateRootTileElevationBounds(){let t=1/0,e=-1/0;const r=this._rootTiles;r!=null&&r.forEach(({elevationBoundsMin:n,elevationBoundsMax:s})=>{t=Math.min(t,n),e=Math.max(e,s)});const i=this.rootTileElevationBounds;i.min===t&&i.max===e||(this.rootTileElevationBounds=new S3(t,e))}_updateViewDependentParameters(){const{camera:t,contentCamera:e}=this.view.state,r=Math.tan(.5*e.fovX),i=Math.tan(.5*e.fovY),n=this.tilingScheme.pixelSize,s=2**-this._lodBias*t.pixelRatio;this._splitLimits.aboveGround=t.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=i,this._splitLimits.relativeWidthLimit=n/t.width*this.maxTextureScale*s,this._splitLimits.relativeHeightLimit=n/t.height*this.maxTextureScale*s,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=d9(this._splitLimits.frustum??pD(),e.frustum):this._splitLimits.frustum=null,d9(this._frustum,t.frustum),Kr(this._viewProjectionMatrix,e.projectionMatrix,e.viewMatrix),he(this._eyePosRenderSR,e.eye),ga(t.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(t){t.updateVisibility(),this._renderer.updateTileGeometryState(t)&&this._markTileToUpdate(t),this._usedMemory=null}_markAllTileNeighborsForUpdate(t){t.forEachLoadedNeighbor(e=>{this._layerViews[Zt.MAP].some(CT)&&e.setPendingUpdate(pt.TEXTURE_FADING),this._pendingTilesToUpdate.add(e)})}_updateTileTexture(t,e){const r=t.resetPendingUpdate(pt.TEXTURE_FADING)?pt.TEXTURE_FADING:!!t.resetPendingUpdate(pt.TEXTURE_NOFADING)&&pt.TEXTURE_NOFADING;r&&(this._renderer.updateTileTexture(t,r),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const t=KW.extent;kc(t),this._pendingTilesForElevationUpdateEvent.forEach(e=>ab(t,e.extent,t)),this._pendingTilesForElevationUpdateEvent.clear(),KW.spatialReference=this.spatialReference,this.emit("elevation-change",KW),this._shouldEmitChangeEvent=!1}runTask(t){this._handleLayerViewChanges(t),this._frameTask.processQueue(t),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,t),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(t),this._sortTiles(t);const e=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(t,e),this._updateElevation(t),this._updateTextures(t),e||this._mergeAndSplit(t,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),t.done&&t.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),uo&&this._checkTileInvariant(),!t.hasProgressed)return pa}_checkTileInvariant(){const t=new Map;this._allTiles.forAll(e=>t.set(e,new Set)),this._allTiles.forAll(e=>{var r;if(Vs(e.rendered===e.isLeaf,` rendered ${e.rendered} != ${e.isLeaf} leaf`),!e.isLeaf){const i=s=>s.unmergableChildCount===0&&s.maxLevelDeltaNeighborCount===0,n=e.children.reduce((s,o)=>s+(i(o)?0:1),0);if(Vs(e.unmergableChildCount===n,` Tile[${e.lij.toString()}] unmergeable child count mismatch: actual ${e.unmergableChildCount} vs ${n}`),e.hasPendingUpdate(pt.MERGE)){Vs(!e.hasPendingUpdate(pt.SPLIT),"Tile can be both split and merge at the same time");for(const s of e.children)Vs(s.isLeaf||s.hasPendingUpdate(pt.MERGE),"Child of tile to merge must also merge")}}for(let i=0;i<4;++i){if(e.rendered){const a=(r=e.renderData)==null?void 0:r.geometryState.edgePeerNeighbors[i];if(a!=null){{const l=e.level-a.level<=Hs;l||(console.log(`tile level delta [${e.lij.toString()}] vs [${a.lij.toString()}] > ${Hs}  (edge[${i}])`),Vs(l,`tile level delta [${e.level}] vs [${a.level}] > ${Hs}`))}Vs(e.level-a.level<=Hs,`Max tile lod delta exceeded: [${e.lij.toString()}] vs [${a.lij.toString()}]`)}}const n=e.level-Hs,s=a=>a.isLeaf||a.level===e.level,o=e.findNeighborTile(Hf[i],s);if(o!=null){if(e.isLeaf&&e.level>=Hs){let a=o;for(;e.level-a.level<Hs;)a=a.parent;const l=[n,e.lij[1]>>Hs,e.lij[2]>>Hs];if(!$8(l,a.lij)){const c=t.get(a);Vs(!c.has(e),"Cannot already have neighbor"),c.add(e)}}Vs(o.rendered||o.level===e.level,"Non-same-level-neighbor of rendered must be rendered"),Vs(e.level-o.level<=Hs,`Tile level delta [${e.level}] vs [${o.level}] > ${Hs}`)}}}),this._allTiles.forAll(e=>{const r=e.maxLevelDeltaNeighborCount,i=t.get(e);Vs(r===i.size,`Tile[${e.lij.toString()}] merge-blocker mismatch: actual ${r} vs ${i.size}`)})}_updateAllTilesStatus(t){if(!this._viewChanged||!this._rootTiles||t.done)return;this._viewChanged=!1;const e=new y4t(this._allTiles.length);e.pushAll(this._rootTiles);const r=this.snapLevel,i=this._splitLimits,n=this._eyePosRenderSR;this._allTiles.forAll(o=>{o.maxLevelDeltaNeighborCount=0,o.unmergableChildCount=0});const s=this._viewProjectionMatrix;for(;!e.empty;){const o=e.pop(),a=o.parent,l=a!=null&&a.hasPendingUpdate(pt.MERGE),c=l?pt.MERGE:o.shouldSplit(i,n,r),u=c===pt.SPLIT;o.isLeaf?eY(o,u):e.pushAll(o.children),l?(o.resetPendingUpdate(pt.SPLIT),o.isLeaf||o.setPendingUpdate(pt.MERGE),this._updateClippingStatus(o),o.updateVisibility(),o.updateScreenDepth(s)):u?(o.resetPendingUpdate(pt.MERGE),o.isLeaf&&o.setPendingUpdate(pt.SPLIT)):(o.resetPendingUpdate(pt.SPLIT)&&o.updateAgentSuspension(),c===pt.ELEVATION&&o.updateAgents(Zt.ELEVATION),o.isLeaf||(o.setPendingUpdate(pt.MERGE),o.resetPendingUpdate(pt.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),t.madeProgress()}_sortTiles(t){t.done||this._allTilesSorted||(eDt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),t.madeProgress())}_markTileToUpdate(t){$e(t.isLoaded),t.intersectsClippingArea&&(this._pendingTilesToUpdate.add(t),this._markAllTileNeighborsForUpdate(t))}_updatePendingTileGeometries(){const t=this._pendingTilesToUpdate,e=Array.from(t.keys()).filter(n=>n.isLoaded&&n.intersectsClippingArea);if(e.length===0)return void t.clear();const r=(n,s)=>{!(s!=null&&s.isLoaded)||!s.intersectsClippingArea||s.level<n.level||t.has(s)||(t.add(s),e.push(s),s.renderData.updateNeighborData())};e.sort(Q0);const i=e.length;for(let n=0;n<i;++n){const s=e[n];$e(s.isLoaded),$e(s.intersectsClippingArea);const o=s.renderData;o.updateNeighborData();const a=o.dirtyEdgeResolutions,l=o.geometryState,c=u=>{var p;const h=uV[u];r(s,(p=l.cornerPeerNeighbors[u])==null?void 0:p.findCorner(cV(h),f=>f.isLoaded))};for(let u=0;u<4;++u)if(a&1<<u){const h=o.geometryState.edgePeerNeighbors[u];h&&(h==null?void 0:h.level)>=s.level&&h.forAllSubtreeOnSide(vce(Hf[u]),p=>!(!p.isLoaded||!p.intersectsClippingArea)&&($e(t.has(p)||Q0(s,p)<0),r(s,p),!0)),c((u+1)%4),c(u)}}t.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,uo&&aV&&this.checkAllTilesWaterproofness()}_mergeAndSplit(t,e){if(this.suspended||t.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let r=!1;const i=this.view.state.fixedContentCamera;let n=!1;for(;!t.done;){n=!0;let s=!1;const o=!this._allTiles.some(a=>{if(!r&&!i&&!a.visible)return t.done;let l=a;if(a.hasPendingUpdate(pt.MERGE)){if(!e||a.unmergableChildCount>0)return t.done;for(a.resetPendingUpdate(pt.MERGE);l.parent!=null&&l.parent.unmergableChildCount===0&&l.parent.resetPendingUpdate(pt.MERGE);)l=l.parent;this._mergeTile(l),s=!0,t.madeProgress()}else if(a.resetPendingUpdate(pt.SPLIT)){let c=!0;const u=a.level;if(u>=Hs){const h=p=>p.isLeaf||u-p.level<Hs;for(let p=0;p<4;++p){const f=a.findNeighborTile(Hf[p],h);f!=null&&u-f.level===Hs&&(c=!1,uo&&($e(f.isLeaf),$e(f.hasPendingUpdate(pt.SPLIT))))}}c?(this._splitTile(a),t.madeProgress(),s=!0):a.setPendingUpdate(pt.SPLIT)}return t.done});if(s&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!r){r=!0;continue}if(!s)break}else this._allTilesDirty=!0}n?t.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(t)}_updateElevation(t){t.done||(this._allTiles.some(e=>(e.resetPendingUpdate(pt.GEOMETRY)&&(this._updateTileGeometryState(e),this._shortBatches&&this._updatePendingTileGeometries(),t.madeProgress()),t.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(t){t.done||this._allTiles.some(e=>(this._updateTileTexture(e,t),t.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Hn.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const t=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-t)*Klt}_getLodBiasCorrectedScale(t){const e=this.tilingScheme.levels,r=we(t-this._lodBias,0,e.length-1),i=r-Math.floor(r);return e[Math.floor(r)].scale*(1-i)+e[Math.ceil(r)].scale*i}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(t=>this._purgeTile(t)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeDescendantTiles(t){if(!t.children[0])return;const e=t.children.slice();t.unsetChildren();for(let r=0;r<4;++r)this._purgeTile(e[r])}_purgeTile(t){t.isLeaf?ewe(t):this._purgeDescendantTiles(t),this._allTiles.removeUnordered(t),this._unloadTile(t),this._tileCache.put(D8._tileMemcacheKey,t)}_unloadTile(t){this._pendingTilesToUpdate.delete(t),this._pendingTilesForElevationUpdateEvent.delete(t),t.unload(this._renderer)}_splitTile(t){Vs(t.isLeaf,"Tile that is already split should not be split again!"),Vs(t.rendered,"Tile marked to split is not rendered"),ewe(t);const e=t.level+1,r=2*t.lij[1],i=2*t.lij[2],n=t.setChildren(this._createTile(e,r,i,t),this._createTile(e,r,i+1,t),this._createTile(e,r+1,i,t),this._createTile(e,r+1,i+1,t));this._allTiles.pushArray(n),t.updateAgentSuspension(),Vs(t.rendered,"parent should be rendered"),this._unloadTile(t),n.forEach(s=>this._loadTile(s)),n.forEach(s=>this._pendingTilesToUpdate.add(s)),this._markAllTileNeighborsForUpdate(t),this._emitTileScaleChange(t,t.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),n.forEach(s=>eY(s,s.hasPendingUpdate(pt.SPLIT))),++this._performanceInfo.numSplit}_emitTileScaleChange(t,e=t.level){uk.spatialReference=this.spatialReference,uk.extent=t.extent,uk.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",uk)}_createTile(t,e,r,i){Vs(!!i,"_createTile sanity check");const n=this._acquireTile(t,e,r,i);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(pt.SPLIT),n}get _shortBatches(){return this.view.state.mode!==Xr.IDLE}_mergeTile(t){Vs(!t.hasPendingUpdate(pt.SPLIT),"_mergeTile sanity check"),Vs(!t.isLeaf,"Cannot merge a leaf"),t.isLeaf||(this._purgeDescendantTiles(t),Vs(!t.renderData,"_mergeTile sanity check"),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t),this._shortBatches&&this._updatePendingTileGeometries(),eY(t,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(t){t.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(t)}_elevationDataArrived(t,e,r){const i=new fLt(t.lij,t.extent,r);t.dataArrived(e,Zt.ELEVATION,i);const n=[t],s=t.level,o=this._iteratorPool.acquire();for(o.reset(n);!o.done;){const a=o.next();a.findElevationBoundsForLayer(e,s),a.computeElevationBounds()}s===0&&this._updateRootTileElevationBounds(),o.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(t=Xl){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const r=new Set;let i=-1;for(let n=this.view.allLayerViews.length-1;n>=0;n--){const s=this.view.allLayerViews.items[n];if(r.add(s.uid),$te(s)||IM(s))if(this._basemapLayerViewHandles.has(s.uid)&&!IM(s)){const o=this._layerClassFromLayerView(s),a=this._getLayerIdxByUID(o,s.uid);a!=null&&((a<i||i==null)&&(e=!0),i=a)}else this._registerTiledLayerView(s),s.layer.loaded&&(e=!0)}this._basemapLayerViewHandles.forEach((n,s)=>{r.has(s)||(this._unregisterTiledLayerView(s),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),t.madeProgress()}_allSurfaceLayersTransparent(){var e,r;let t=((r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.opacity)===0;for(const i of this.view.allLayerViews.items)if(Rte(i)&&!o6(i.layer)&&i.fullOpacity!==0)return t=!1,t;return t}_hasCompositeBlendMode(){for(const t of this.view.allLayerViews.items)if((DD(t)||IM(t))&&lDt(Dte[t.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(t){return Mte(t)?Zt.ELEVATION:Zt.MAP}_registerTiledLayerView(t){const e=[];if((DD(t)||IM(t))&&e.push(pe(()=>t.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Os.UNFADED)})),!IM(t)){const r=this._layerClassFromLayerView(t);e.push(pe(()=>t.suspended,()=>this._updateTiledLayers())),e.push(pe(()=>t.fullOpacity,()=>this._updateTileTextures(Os.UNFADED))),e.push(pe(()=>"effectiveScaleRange"in t.layer?t.layer.effectiveScaleRange:null,()=>this._restartAllAgents(r))),e.push(t.on("data-changed",()=>{const i=this._getLayerIdxByUID(r,t.uid);i!=null&&this._invalidateLayerData(i,r)}))}this._unregisterTiledLayerView(t.uid),this._basemapLayerViewHandles.set(t.uid,e)}_unregisterTiledLayerView(t){const e=this._basemapLayerViewHandles.get(t);if(e){for(const r of e)r.remove();this._basemapLayerViewHandles.delete(t)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const t=this.view.allLayerViews,e=[[],[]];let r=null;t.forEach(i=>{if(!i.layer||i.suspended||!$te(i)||!i.fullExtent)return;const n=this._layerClassFromLayerView(i);if(n===Zt.MAP){const s=i.displayLevelRange.maxLevel;s!==1/0&&(r===null||s>r)&&(r=s)}e[n].push(i)});for(const i of rS){const n=this._layerViews[i],s=e[i];s.reverse();const o=s.length;let a=n.length!==o;const l=new Array(o),c=new Array(n.length);this._layerIndexByUid[i].clear();for(let u=0;u<o;u++){const h=s[u].uid;this._layerIndexByUid[i].set(h,u);const p=n.indexOf(s[u]);l[u]=p,u!==p&&(a=!0),p>-1&&(c[p]=u)}if(a){const u=this._postorderIterator;for(u.reset(this._rootTiles);!u.done;)u.next().modifyLayers(c,l,i);this._layerViews[i]=s,this._restartAllAgents(i),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&this._viewChangeUpdate()}_restartAllAgents(t){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const r=e.next();r.restartAgents(t),t===Zt.ELEVATION&&r.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(t,e){return this._layerViews[e][t]}numLayers(t){return this._layerViews[t].length}_updateTileTextures(t){this._allTiles.forAll(e=>{e.updateAgents(Zt.MAP),t===Os.IMMEDIATE?this.renderer.updateTileTexture(e,pt.TEXTURE_NOFADING):e.updateRenderData(Zt.MAP,t)}),this._evaluateTransparency()}_invalidateLayerData(t,e){this._allTiles.forAll(r=>r.removeLayerAgent(t,e)),this._allTiles.forAll(r=>r.invalidateLayerData(t,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(t=Hn.UPDATE){this.renderer.setNeedsRender(t)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(t,e,r,i){const n=this.layerViewByIndex(e,r),s=n.layer;return!s.tilemapCache||CT(n)?this._requestTileData(t,r,n,i):(++this._asyncWorkItems,s.tilemapCache.fetchAvailability(t.lij[0],t.lij[1],t.lij[2],{...i,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,dt(i),on(o)||this._dataMissing(t,r,n,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(t,r,n,i),i.signal)))}_requestTileData(t,e,r,i){return e===Zt.ELEVATION?Mte(r)?this._requestElevationTileData(t,r,i):Promise.reject():Rte(r)?this._requestMapTileData(t,r,i):Promise.reject()}_requestElevationTileData(t,e,r){++this._asyncWorkItems;const i=o=>{if(Ms(r))return;const a=this._layerIndexByUid[Zt.ELEVATION].get(e.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(t,a,o)):K.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Zt.ELEVATION,t.lij.toString())},n=o=>{on(o)||(this._dataMissing(t,Zt.ELEVATION,e,o),this.requestUpdate())};if(Cbe(e.layer))return e.layer.fetchTile(t.lij[0],t.lij[1],t.lij[2],{noDataValue:sD,signal:r.signal}).then(o=>{if(!Ms(r))return this._frameTask.schedule(()=>i(o),r.signal,n);K.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},n).finally(()=>{--this._asyncWorkItems});const s=e.getTileUrl(t.lij[0],t.lij[1],t.lij[2]);return this._elevationDataRequester.request(s,"binary",r).then(o=>this._lercDecoder.decode(o,{noDataValue:sD},r.signal)).then(o=>{o?i(new jIt(o)):n(new Error("LERC decoding failed"))},n).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(t,e,r){++this._asyncWorkItems;const i=(c,u)=>{--this._asyncWorkItems,dP(u),Ms(r)||(this._dataMissing(t,Zt.MAP,e,c),this.requestUpdate())},n=c=>u=>i(u,c),s=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Ms(r)?dP(c):this._mapTileDataArrived(t,e,c)},r.signal,n(c)).catch(n(c)),o=(c,u=null)=>this._frameTask.schedule(()=>i(c,u));if(CT(e)){const c=e.schemaHelper.getLevelRowColumn(t.lij);return e.fetchTile(c[0],c[1],c[2],r).then(s,o)}if(AG(e))return e.fetchTile(t.lij[0],t.lij[1],t.lij[2],r).then(s,o);if(yce(e)&&Cbe(e.layer))return e.layer.fetchTile(t.lij[0],t.lij[1],t.lij[2],r).then(c=>{if(Ms(r))return K.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(gr());s(c)},o);let a=e.getTileUrl(t.lij[0],t.lij[1],t.lij[2]);VIt(e.layer)&&e.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${e.layer.refreshTimestamp}`);const l=e.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,r).then(s,o)}_mapTileDataArrived(t,e,r){const i=this._getLayerIdxByUID(Zt.MAP,e.uid);i!=null?t.dataArrived(i,Zt.MAP,r):(dP(r),K.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(t,e){return this._layerIndexByUid[t].get(e)}_dataMissing(t,e,r,i){const n=this._getLayerIdxByUID(e,r.uid);n!=null?t.dataMissing(n,e,i):K.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(t){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(t))}get performanceInfo(){const t=this._performanceInfo;return t.numNodes=this._allTiles.length,t.numLeaves=t.numVisible=t.numRendered=t.numLoadedPerLevel.length=t.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.isLeaf&&t.numLeaves++;const r=e.level;e.renderData&&(t.numLoadedPerLevel[r]=(t.numLoadedPerLevel[r]||0)+1),e.visible&&(t.numVisible++,e.rendered&&(t.numRenderedPerLevel[r]=(t.numRenderedPerLevel[r]||0)+1,t.numRendered++))}),t}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((t,e)=>t+e.usedMemory,0)):null}getUsedMemoryForLayerView(t){let e=0;const r=this._layerClassFromLayerView(t),i=this._getLayerIdxByUID(r,t.uid);return i!=null&&this._allTiles.forAll(n=>e+=n.getUsedMemoryForLayer(r,i)),e}getTile(t){if(t==null||this._rootTiles==null)return null;const e=t.split("/").map(o=>+o);if(e[0]===0)return this._rootTiles.find(o=>o.lij[1]===e[1]&&o.lij[2]===e[2]);const r=e[0],i=e[1]>>r,n=e[2]>>r;let s;if(this._rootTiles.some(o=>o.lij[1]===i&&o.lij[2]===n&&(s=o,!0)),s){let o=1<<e[0]-1;for(;s.lij[0]<e[0];){let a=e[1]&o?2:0;if((e[2]&o)>0&&a++,!s.children[a])return null;s=s.children[a],o>>=1}return Vs(s.lij[0]===e[0]&&s.lij[1]===e[1]&&s.lij[2]===e[2],"not the right tile?"),s}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(t){this._renderer.renderPatchBorders=t}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(t){this._renderer.visualizeNormals=t}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(t){this._renderer.renderingDisabled=t}get test(){const t=this;return{renderer:t._renderer,lercDecoder:t._lercDecoder,forceReload:()=>{t._rootTiles!=null&&t._rootTiles.length>0&&(t._mergeTile(t._rootTiles[0]),t._viewChangeUpdate())},getTiles:()=>t._allTiles.toArray(),getRenderedTiles(){QW.clear(),t._allTiles.forAll(r=>{r.visible&&r.rendered&&QW.push(r)});const e=QW.toArray();return UUe(t.renderOrder,e),e},lockTilingScheme(e,r){t._extentHelper.defaultTiledLayersExtent=r,t.tilingSchemeLogic.test.lockTilingScheme(e)}}}checkAllTilesWaterproofness(){if(!aV)return;const t=this._rootTiles;if(t==null)return;const e=s=>{var o,a,l;return((l=(a=(o=s==null?void 0:s.renderData)==null?void 0:o.geometry)==null?void 0:a.indices)==null?void 0:l.length)>0},r=(s,o)=>{e(s)&&console.error("Tile[",s.lij,"] has geometry although parent[",o.lij,"] has geom")},i=s=>{var o,a;if(s.intersectsClippingArea)if(s.renderData&&!s.renderData.geometryState&&console.error("Tile[",s.lij,"] has renderData but not geometryState"),s.renderData&&!s.renderData.geometry&&console.error("Tile[",s.lij,"] has renderData but not geometryInfo"),!((o=s.renderData)!=null&&o.geometry)||(((a=s.renderData.geometry.indices)==null?void 0:a.length)??0)>0||console.error("Tile[",s.lij,"] has renderData but no indices - geometryInfo: ",s.renderData.geometry),e(s)){s.checkGeometryWaterproofness();for(const l of s.children)r(l,s)}else if(s.isLeaf)console.error("Tile[",s.lij,"] has no geometry and no children, from root to leaf");else for(const l of s.children)i(l)},n=s=>{var c;const o=((c=s.parent)==null?void 0:c.visible)??!0,a=s.visible;s.computeVisibility();const l=s.visible;if(a!==l&&o&&console.error(" Tile[",s.lij,"] has out of date visibility: ",a," instead of ",l),!s.isLeaf)for(const u of s.children)n(u)};for(const s of t)i(s),n(s)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(t){return this._isGlobal&&t[2]===this.lijEastEnd(t[0])-1}isWestEndWrap(t){return this._isGlobal&&t[2]===0}lijEastEnd(t){return 1<<t+(this._isGeographic?1:0)}wrapEastWest(t){const e=this.lijEastEnd(t[0]),r=t[2];if(0<=r&&r<e)return t;if(!this._isGlobal)return null;const i=(r+(r<0?e:0))%e;return[t[0],t[1],i]}enableInternalChecks(t){ALt(t)}enableWaterproofnessChecks(t){PLt(t)}};er._tileMemcacheKey="TerrainTileMemcache",d([m()],er.prototype,"_renderer",void 0),d([m({constructOnly:!0})],er.prototype,"_scaleRangeQueries",void 0),d([m({constructOnly:!0})],er.prototype,"view",void 0),d([m({constructOnly:!0})],er.prototype,"overlayManager",void 0),d([m()],er.prototype,"_hasPendingUpdates",void 0),d([m()],er.prototype,"_asyncWorkItems",void 0),d([m()],er.prototype,"_allTilesDirty",void 0),d([m()],er.prototype,"_allTilesSorted",void 0),d([m()],er.prototype,"_viewChanged",void 0),d([m()],er.prototype,"_splitLimits",void 0),d([m({readOnly:!0})],er.prototype,"_watchUpdatingTracking",void 0),d([m()],er.prototype,"_frameTask",void 0),d([m({readOnly:!0})],er.prototype,"snapLevel",null),d([m({readOnly:!0})],er.prototype,"lodSnapping",null),d([m()],er.prototype,"_userClippingExtent",null),d([m()],er.prototype,"_rootTilesExtent",void 0),d([m({readOnly:!0})],er.prototype,"extent",null),d([m({readOnly:!0})],er.prototype,"groundExtent",null),d([m({readOnly:!0})],er.prototype,"_tilingSchemeExtent",null),d([m({readOnly:!0})],er.prototype,"updating",null),d([m({readOnly:!0})],er.prototype,"running",null),d([m(dLt)],er.prototype,"updatingProgress",void 0),d([m({readOnly:!0})],er.prototype,"updatingProgressValue",null),d([m()],er.prototype,"_maxNumUpdating",void 0),d([m()],er.prototype,"baseOpacity",null),d([m()],er.prototype,"hasCompositeBlendMode",void 0),d([m({readOnly:!0})],er.prototype,"viewingMode",null),d([m()],er.prototype,"maxTextureScale",void 0),d([m({readOnly:!0})],er.prototype,"ready",null),d([m({value:xA.FRONT_TO_BACK})],er.prototype,"renderOrder",null),d([m({readOnly:!0})],er.prototype,"rootTiles",null),d([m()],er.prototype,"_rootTiles",void 0),d([m({readOnly:!0})],er.prototype,"spatialReference",null),d([m({type:De})],er.prototype,"backgroundColor",null),d([m({value:!1})],er.prototype,"slicePlaneEnabled",null),d([m({readOnly:!0})],er.prototype,"tilingScheme",void 0),d([m({readOnly:!0})],er.prototype,"tilingSchemeLocked",null),d([m({readOnly:!0})],er.prototype,"tilingSchemeLogic",void 0),d([m()],er.prototype,"wireframe",null),d([m({value:!1})],er.prototype,"suspended",null),d([m()],er.prototype,"fadeDuration",null),d([m()],er.prototype,"visibleElevationBounds",void 0),d([m()],er.prototype,"rootTileElevationBounds",void 0),d([m()],er.prototype,"_layerViewsDirty",void 0),d([m()],er.prototype,"renderPatchBorders",null),d([m()],er.prototype,"visualizeNormals",null),d([m()],er.prototype,"renderingDisabled",null),er=D8=d([F("esri.views.3d.terrain.TerrainSurface")],er);const m4t=er,DM=C(),VE=hs(),g4t=Ht(),QW=new jt,KW=new hLt("ground"),uk={spatialReference:null,extent:null,scale:0};function Kbe(t,e,r){var i;for(const n of t){if(!n.containsPointXY(e,r))continue;let s=n;for(;s&&!s.renderData;){const a=(e>s.extentMidX?1:0)+(r<s.extentMidY?2:0);s=s.children[a]}const o=((i=s==null?void 0:s.renderData)==null?void 0:i.geometryState.samplerData)??null;return xn(e,r,o)}return null}class y4t{constructor(e){this.capacity=e,this._head=0,this._tail=0,this._data=new Array(e)}push(e){const r=this._tail;if(!(r<this.capacity))throw new Error("Queue full");this._data[r]=e,this._tail=r+1}pushAll(e){const r=e.length;if(r===0)return;const i=this._tail;if(!(i+r<=this.capacity))throw new Error("Queue full");for(let n=0;n<r;++n)this._data[i+n]=e[n];this._tail=i+r}pop(){const e=this._head;if(e<this._tail){const r=this._data[e];return this._head=e+1,r}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}}function eY(t,e){!t.isLeaf||t.level<Hs||Nce(t,r=>{e&&Mze(r);const i=Hte(r);if(r.maxLevelDeltaNeighborCount++,i){let n=r.parent;for(;n;){const s=Hte(n);if(n.unmergableChildCount++,!s)break;n=n.parent}}})}function Mze(t){if(t.hasPendingUpdate(pt.SPLIT))return;let e=t.parent;for(;e&&e.resetPendingUpdate(pt.MERGE);)e=e.parent;t.resetPendingUpdate(pt.MERGE),t.isLeaf&&t.setPendingUpdate(pt.SPLIT),t.level<Hs||Nce(t,r=>{Mze(r)})}function ewe(t){t.level<Hs||Nce(t,e=>{if(e.maxLevelDeltaNeighborCount--,e.maxLevelDeltaNeighborCount===0&&e.unmergableChildCount===0){let r=e.parent;for(;r&&(r.unmergableChildCount--,Hte(r));)r=r.parent}})}function Hte(t){return t.maxLevelDeltaNeighborCount===0&&t.unmergableChildCount===0}function Nce(t,e){if(t.level<Hs)return;const r=t.level-Hs,i=t.lij[1]>>Hs,n=t.lij[2]>>Hs,s=o=>o.isLeaf||o.level===r;for(let o=0;o<4;++o){const a=t.findNeighborTile(Hf[o],s);if(!a||a.level!==r)continue;const l=a.lij;l[1]===i&&l[2]===n||e(a)}}let _4t=class{constructor(e,r,i,n){this.operation=e,this.geometry=r,this.states=i,this.sync=n}},R$=class extends Pe{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,r){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((n,s)=>{const o=this._ensureGeomRecord(e,s);n.forEach(({geometry:a,operation:l,states:c},u)=>{let h=!1;if(l===un.UPDATE){const p=o.get(u);if(p){if(c&Zs.TRANSFORMATION){const f=this.model.getObject(s);this.model.updateRenderGeometryTransformation(f,a,p)&&(h=!0)}h||r.updates.push({renderGeometry:p,updateType:c})}else _t(!1,"ModelDirtySet.commitLayer: invalid update")}if(l===un.REMOVE||h){const p=o.get(u);p?(r.removes.push(p),o.delete(u)):l===un.REMOVE&&_t(!1,"ModelDirtySet.commitLayer: invalid remove")}if(l===un.ADD||h){const p=this.model.getObject(s);if(p!=null){const f=this.model.getRenderGeometry(p,a);r.adds.push(f),o.set(u,f)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(e,r){const i=this._dirtyGeomRecords.get(e);i&&i.forEach((n,s)=>{const o=this._ensureGeomRecord(e,s);n.forEach(({geometry:a,operation:l,states:c,sync:u},h)=>{let p=!1;if(l===un.UPDATE&&u){const f=o.get(h);if(f){if(c&Zs.TRANSFORMATION){const g=this.model.getObject(s);this.model.updateRenderGeometryTransformation(g,a,f)&&(p=!0)}p||r.updates.push({renderGeometry:f,updateType:c})}else _t(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,r){const i=this._residentGeomRecords.get(e);i&&i.forEach(n=>n.forEach(s=>r.push(s)))}_objectStateChanged(e,r){for(const i of r.geometries)this._updateOrCreateDirtyRecord(r,i,null,un.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Zs.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Zs.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Zs.OCCLUDEE,e)}attributesChanged({object:e,geometry:r,sync:i}){this._updateOrCreateDirtyRecord(e,r,null,un.UPDATE,Zs.GEOMETRY,i)}layerAdded(e){e.objects.forAll(r=>this._layerObjectAdded(e,r))}layerRemoved(e){e.objects.forAll(r=>this._layerObjectRemoved(e,r))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,r){const i=e.id;for(const n of r.geometries)this._geometryAdded(r,n,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const r of e.objects)this._layerObjectAdded(e.layer,r)}layerObjectsRemoved(e){for(const r of e.objects)this._layerObjectRemoved(e.layer,r)}_layerObjectRemoved(e,r){const i=e.id;for(const n of r.geometries)this._geometryRemoved(r,n,i)}transformationChanged(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(n=>{this._updateOrCreateDirtyRecord(e,n.geometry,r,un.UPDATE,Zs.TRANSFORMATION)})}shaderTransformationChanged(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(n=>{n.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,un.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,un.REMOVE)}_updateOrCreateDirtyRecord(e,r,i,n,s=Zs.NONE,o=!1){i=i??this._getParentLayerId(e);const a=e.id,l=r.id,c=this._ensureDirtyRecord(i,a),u=c.get(l);if(u){const h=u.operation;h===un.REMOVE&&n===un.ADD&&u.states!==Zs.NONE?u.operation=un.UPDATE:h===un.REMOVE&&n===un.ADD||h===un.ADD&&n===un.REMOVE?c.delete(l):h!==un.UPDATE||n!==un.REMOVE&&n!==un.UPDATE?(_t((h===un.REMOVE||h===un.ADD)&&n===un.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),u.states|=s):(u.operation=n,u.states|=s),u.sync=u.sync||o}else c.set(l,new _4t(n,r,s,o));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,r){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let n=i.get(r);return n||(n=new Map,i.set(r,n)),n}get _hasDirtyGeometryRecords(){return Hd(this._dirtyGeomRecords,e=>Hd(e,r=>r&&r.size>0))}_ensureDirtyRecord(e,r){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let n=i.get(r);return n||(n=new Map,i.set(r,n)),n}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:xqe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let r="";return this._dirtyGeomRecords.forEach((i,n)=>{i.forEach((s,o)=>{r.length>0&&(r+=`
`),r+=n+"."+o;const a=[];s.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){r+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)r+=a[l][c]+", "}})}),r}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((r,i)=>r+i.size,0)},commit:r=>e._dirtyGeomRecords.forEach((i,n)=>e.commitLayer(n,r))}}};d([m({constructOnly:!0})],R$.prototype,"model",void 0),d([m()],R$.prototype,"dirty",void 0),R$=d([F("esri.views.3d.webgl-engine.lib.ModelDirtySet")],R$);const v4t=R$;let N8=class extends Pe{constructor(){super(...arguments),this.dirtySet=new v4t({model:this}),this._content=new Map,this._originFactory=new Ile(null)}getObject(e){return this._content.get(e)}add(e){const r=e.id;_t(!this._content.has(r),"Model/Stage already contains object to be added"),this._content.set(r,e),V9(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),V9(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const r of e)r&&(_t(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(e){for(const r of e)r&&(_t(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id))}has(e){return this._content.has(e.id)}forEachOfType(e,r){this._content.forEach(i=>{i.type===e&&r(i)})}getRenderGeometry(e,r){const i=new wA(r,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});i.transformation=e.getCombinedStaticTransformation(r,twe);const{localOrigin:n}=r;return i.localOrigin=n??this._originFactory.getOrigin(i.boundingSphere),i}updateRenderGeometryTransformation(e,r,i){if(e==null)return!1;i.transformation=e.getCombinedStaticTransformation(r,twe);const n=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==n}getStats(){const e={},r=Array.from(this._content.values());for(let i=0;i<Ln.COUNT;++i)e[i]=r.filter(n=>n.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};d([m({constructOnly:!0})],N8.prototype,"dirtySet",void 0),N8=d([F("esri.views.3d.webgl-engine.parts.Model")],N8);const twe=xe();let b4t=class{constructor(e){this._totalCount=e,this._componentCountCache=-1,this._indexRanges=[0,e]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return this._indexRanges.length===0}isVisible(e){if(e<0||e>=this._totalCount)return!1;if(this.allVisible())return!0;{const r=this._indexRanges;let i=0,n=r.length/2;if(e<r[2*i]||e>r[2*n]+r[2*n+1])return!1;for(;n-i>0;){const s=Math.floor(.5*(i+n)),o=r[2*s];if(e<o){if(n-i==1)return!1;n=s;continue}if(e<o+r[2*s+1])return!0;if(n-i==1)return!1;i=s+1}return!1}}get componentCount(){if(this._componentCountCache===-1){const e=this._indexRanges;let r=0;for(let i=0;i<e.length;i+=2)r+=e[i+1];this._componentCountCache=r}return this._componentCountCache}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=w4t(e),this._componentCountCache=-1}forEachComponent(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i],s=n+r[i+1];for(let o=n;o<s;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i];if(!e(n,n+r[i+1]))return!1}return!0}computeOffsetRanges(e){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let n=0;n<i.length;n+=2){const s=i[n],o=s+i[n+1],a=e[s],l=e[o];r[n]=a,r[n+1]=l-a}return r}};function w4t(t){const e=new Array;if(t.length===0)return e;let r=t[0],i=1;for(let n=1;n<t.length;n++){const s=t[n];r+i===s?i+=1:(e.push(r),e.push(i),r=s,i=1)}return e.push(r),e.push(i),e}let x4t=class{constructor(e,r){this.offsets=r,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const i=this.count;this.visibility=new b4t(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let n=0;n<i;n++)this.materialDataIndices[n]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:r}=S4t(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=r}}};function S4t(t,e,r){const i=[],n=[];let s=r.length,o=r.length;return e.forEachComponent(a=>(t[a]>0?(s!==a-1&&(i.length&&i.push(r[s+1]-i[i.length-1]),i.push(r[a])),s=a):(o!==a-1&&(n.length&&n.push(r[o+1]-n[n.length-1]),n.push(r[a])),o=a),!0)),i.length&&i.push(r[s+1]-i[i.length-1]),n.length&&n.push(r[o+1]-n[n.length-1]),{highlightRanges:i,defaultRanges:n}}let T4t=class{constructor(e,r,i,n,s,o){this.transform=e,this.toMapSpace=r,this.obb=i,this.components=n,this.renderable=s,this.intersectionGeometry=o,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=Me(this.intersectionGeometry),this.renderable=Me(this.renderable),this.components=Me(this.components)}};function E4t(t,e,r,i){if(r>=e)return t;t==null&&(t=C4t());const n=t.isVisibleBit;let s=t.data;const o=Rze(s),a=r/o|0,l=r-o*a,c=(e-1)/o|0,u=s,h=i===n;if(!(r<u.length*o)&&h){const p=a+1,f=Math.ceil(u.length*YV),g=c+1;let y=Math.max(p,f);y=Math.min(y,g),s=new Uint32Array(y),s.set(u)}return a<s.length&&(s[a]=A4t(s[a],l,h)),t.data=s,t}function qte(t,e){if(t==null)return!0;const{isVisibleBit:r,data:i}=t,n=Rze(i);return e<i.length*n?P4t(r,i,e,n):!t.isVisibleBit}function C4t(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function P4t(t,e,r,i){const n=r/i|0,s=r-n*i;return O4t(e[n],s)===t}function Rze(t){return t.BYTES_PER_ELEMENT*8}function A4t(t,e,r){return t&~(1<<e)|(r?1:0)<<e}function O4t(t,e){return(t&1<<e)!=0}let M4t=class{constructor(e,r,i){this.viewingMode=e,this.positionData=r,this._components=i,this._planetCenter=C(),this._planetNorth=C(),this._componentIndicesForBsp=null,this._componentBspNodes=[],this._aabb=[0,0,0,0,0,0],this._indices=r.indices?Yg(r.indices):_2(r.positions.length/3),this._positions=r.positions,this._componentIntersectionData=new Array(i.count)}destroy(){this._positions=null,this._indices=null,this._componentIntersectionData.length=0,this._perComponentAabbs=null}getComponentAabb(e,r){const i=this._ensureComponentAabbs(),n=6*e;return r[0]=i[n],r[1]=i[n+1],r[2]=i[n+2],r[3]=i[n+3],r[4]=i[n+4],r[5]=i[n+5],r}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(e,r){r.indices=this._indices,r.data=this._positions,r.stride=3,r.startIndex=this._components.offsets[e],r.endIndex=this._components.offsets[e+1]}intersect(e,r,i,n,s,o,a,l){const{position:c}=a,u=rn(I4t,e,c),h=rn(L4t,r,c),p=x2(D4t,a.rotationScale);po(u,u,p),po(h,h,p);const f=hp(N4t,p),g=new jA(this._positions,3),y=this._indices,v=this._components.offsets,b=S4e(u,h,R4t);if(this.viewingMode===Fe.Global){const P=this._planetCenter;ua(P,c),po(P,P,p);const M=this._planetNorth;se(M,0,0,1),po(M,M,p),me(M,M)}const w=he(F4t,u),x=he(k4t,h),S=rn(U4t,h,u);me(S,S);const E=P=>{const M=this.getComponentAabb(P,$4t);if(s!=null){const W=s[P];n==null||l?(u[2]=w[2]-W,h[2]=x[2]-W):n.componentOffset=W}if(n==null||l||n.applyToAabb(M),!Xae(M,u,b,i))return;const L=v[P]/3,U=v[P+1]/3,z=(W,V,J)=>o(P,W,po(V,V,f),J);(n==null||l)&&U-L>Aze?(this._componentIntersectionData[P]==null&&(this._componentIntersectionData[P]=new Dce(this._indices,L,U,g)),this._componentIntersectionData[P].intersectRay(u,h,z)):LN(u,h,L,U,y,g,void 0,n,z)};this._intersectComponents(E,l,u,h)}_intersectComponents(e,r,i,n){const s=this._components.pickability,o=this._components.visibility;if(this._components.visibility.componentCount<H4t){const u=h=>(qte(s,h)&&e(h),!0);return void o.forEachComponent(u)}this._componentBspNodes.length===0&&this._generateComponentBspRoot();const a=this._componentIndicesForBsp,l=u=>{qte(s,u)&&o.isVisible(u)&&e(u)},c=(u,h)=>{for(let p=u;p<h;++p)l(a[p])};if(r){let u=0;for(;u>=0;){const h=this._componentBspNodes[u],p=h.plane;if(!p||h.child0===-1&&h.child1===-1){c(h.minComponentIndexIndex,h.maxComponentIndexIndex);break}{c(h.minMidComponentIndexIndex,h.maxMidComponentIndexIndex);const f=fe(p,i)-p[3];if(f<0){if(h.child0===-1){c(h.minComponentIndexIndex,h.minMidComponentIndexIndex);break}u=h.child0}else{if(!(f>0))break;if(h.child1===-1){c(h.maxMidComponentIndexIndex,h.maxComponentIndexIndex);break}u=h.child1}}}}else{const u=q4t;rn(u,n,i),me(u,u);const h=this._componentBspNodes,p=f=>{const g=h[f],y=g.plane;if(!y||g.child0===-1&&g.child1===-1)c(g.minComponentIndexIndex,g.maxComponentIndexIndex);else{const v=fe(y,i)-y[3],b=fe(y,u);g.minComponentIndexIndex<g.minMidComponentIndexIndex&&(v<=0||b<0)&&(g.child0!==-1?p(g.child0):c(g.minComponentIndexIndex,g.minMidComponentIndexIndex)),c(g.minMidComponentIndexIndex,g.maxMidComponentIndexIndex),g.maxMidComponentIndexIndex<g.maxComponentIndexIndex&&(v>=0||b>0)&&(g.child1!==-1?p(g.child1):c(g.maxMidComponentIndexIndex,g.maxComponentIndexIndex))}};p(0)}}_generateComponentBspRoot(){const e=this._components.count,r=new Uint16Array(e);this._componentIndicesForBsp=r;for(let b=0;b<e;++b)r[b]=b;const i=this._ensureComponentAabbs(),n=this._planetCenter,s=this._planetNorth,o=B4t;ua(o,n),me(o,o),it(G4t,s,o);const a=this._aabb,l=a[2],c=[];let u=0;const h=this._componentBspNodes;h.length=0;const p=(b,w)=>{const x=6*b,S=i[x],E=i[x+1],P=i[x+2],M=i[x+3],L=i[x+4],U=i[x+5],z=se(iwe,.5*(S+M),.5*(E+L),.5*(P+U)),W=.5*(M-S),V=.5*(L-E),J=.5*(U-P),Y=Math.sqrt(W*W+V*V+J*J),X=w,le=w[3],D=fe(X,z)-le;return Math.abs(D)>Y?Math.sign(D):0},f=(b,w,x)=>{let S=1/0,E=1/0,P=1/0,M=-1/0,L=-1/0,U=-1/0;for(let z=w;z<x;++z){const W=6*r[z];S=Math.min(S,i[W]),M=Math.max(M,i[W+3]),E=Math.min(E,i[W+1]),L=Math.max(L,i[W+4]),P=Math.min(P,i[W+2]),U=Math.max(U,i[W+5])}b[0]=S,b[1]=E,b[2]=P,b[3]=M,b[4]=L,b[5]=U},g=this.viewingMode===Fe.Local;let y=!1;if(!g){const b=se(iwe,.5*(a[0]+a[3]),.5*(a[1]+a[4]),.5*(a[2]+a[5])),w=B0(n,b);y=l>.5*w}const v=(b,w,x,S,E)=>{const P=h.length;let M;if(y||x>=j4t||w-b<tY)M=new rwe(b,w,w,w,null);else{f(BE,b,w);const L=BE[0],U=BE[1],z=BE[2],W=BE[3],V=BE[4],J=W-L,Y=V-U,X=tr(),le=X;if(g)J>=Y?(se(le,1,0,0),X[3]=-.5*(L+W)):(se(le,0,1,0),X[3]=-.5*(U+V));else{const k=z4t,j=V4t;se(k,.5*(L+W),.5*(U+V),z),rn(k,k,n),me(k,k),it(j,k,s),me(j,j),J>=Y?he(le,j):(it(le,j,k),me(le,le)),X[3]=fe(le,n)}let D,I;{let k=b,j=w;for(;k<j;){const Q=r[k];p(Q,X)<0?++k:(--j,r[k]=r[j],r[j]=Q)}D=k;let q=k;for(j=w;q<j;){const Q=r[j-1];p(Q,X)>0?--j:(r[j-1]=r[q],r[q]=Q,++q)}I=j}M=new rwe(b,D,I,w,X),D>=b+tY&&c.push(()=>v(b,D,x+1,P,!0)),w>=I+tY&&c.push(()=>v(I,w,x+1,P,!1))}if(h.push(M),S!==-1){const L=h[S];E?L.child0=P:L.child1=P}};for(c.push(()=>v(0,e,0,-1,!1));u<c.length;)(0,c[u])(),++u}_computePerComponentAabbs(){const e=this._components.count,r=Tn(6*e),i=this._indices,n=this._positions,s=this._components.offsets;let o=0,a=1/0,l=1/0,c=1/0,u=-1/0,h=-1/0,p=-1/0;for(let f=0;f<e;f++){const g=s[f],y=s[f+1];let v=1/0,b=1/0,w=1/0,x=-1/0,S=-1/0,E=-1/0;for(let P=g;P<y;P++){const M=3*i[P],L=n[M],U=n[M+1],z=n[M+2];v=Math.min(v,L),b=Math.min(b,U),w=Math.min(w,z),x=Math.max(x,L),S=Math.max(S,U),E=Math.max(E,z)}r[o++]=v,r[o++]=b,r[o++]=w,r[o++]=x,r[o++]=S,r[o++]=E,a=Math.min(a,v),l=Math.min(l,b),c=Math.min(c,w),u=Math.max(u,x),h=Math.max(h,S),p=Math.max(p,E)}return this._aabb[0]=a,this._aabb[1]=l,this._aabb[2]=c,this._aabb[3]=u,this._aabb[4]=h,this._aabb[5]=p,r}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}},rwe=class{constructor(e,r,i,n,s){this.minComponentIndexIndex=e,this.minMidComponentIndexIndex=r,this.maxMidComponentIndexIndex=i,this.maxComponentIndexIndex=n,this.plane=s,this.child0=-1,this.child1=-1}};const R4t=C(),$4t=Ds(),BE=[0,0,0,0,0,0],I4t=C(),L4t=C(),D4t=gi(),N4t=gi(),F4t=C(),k4t=C(),U4t=C(),z4t=C(),V4t=C(),B4t=C(),G4t=C(),iwe=C(),tY=5,j4t=10,H4t=7,q4t=C();let W4t=class{constructor(e,r,i){this.material=e,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}},Y4t=class{constructor(e,r,i,n){this.vao=e,this.primitiveType=r,this.parameters=i,this.indexed=n}dispose(){this.vao.dispose()}},Fce=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function X4t(t,e){return{near:t,far:e}}function XN(t){return t?ND(t,1/0,-1/0):X4t(1/0,-1/0)}function ND(t,e,r){return t.near=e,t.far=r,t}function SA(t,e){e!=null&&(t.near=Math.min(t.near,e.near),t.far=Math.max(t.far,e.far))}function hk(t,e){return t.near<=e&&e<=t.far}const Wte={near:0,far:0};function Z4t(t,e){const r=XN(),{eye:i,frustum:n,viewForward:s}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=fe(rn(dh,a.center,i),s),c=a.projectedRadius(s);if(hk(r,l-c)&&hk(r,l+c))return;const u=t5t(a,n);if(u===-1)return;if(u===0)return qy.far=l+c,qy.near=l-c,void SA(r,qy);const h=dk.pushNew();h.near=l-c,h.far=l+c,h.mask=u,h.object=o});for(let o=0;o<dk.length;o++){const a=dk.data[o];if(hk(r,a.near)&&hk(r,a.far))continue;qy.far=a.far,qy.near=1/0,e5t(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,i,J4t,c=>{let u=Q4t;for(let h=0;h<$ze&&c.length>0;h++){if(!(a.mask&1<<h))continue;K4t(n[h],c,u);const p=c;c=u,u=p}for(let h=0;h<c.length;h+=3){se(xc,c.data[h],c.data[h+1],c.data[h+2]);const p=fe(rn(xc,xc,i),s);qy.near=Math.min(qy.near,p)}})===0&&(qy.near=0),SA(r,qy)}return dk.length=0,r}const dk=new jt({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),qy=XN(),xc=C(),hx=C(),J4t=new jt({deallocator:null}),Q4t=new jt({deallocator:null});function K4t(t,e,r){r.length=0;const i=e.length-3;rY(xc,e,i);const n=Ci(t,xc);n<=0&&(r.push(xc[0]),r.push(xc[1]),r.push(xc[2]));let s=0,o=n;for(;s<i;s+=3){rY(hx,e,s);const a=Ci(t,hx);o*a<0&&(pi(xc,hx,xc,a/(a-o)),Sc(r,xc)),a<=0&&Sc(r,hx),o=a,he(xc,hx)}o*n<0&&(rY(hx,e,i),pi(xc,hx,xc,n/(n-o)),Sc(r,xc))}function rY(t,e,r){return se(t,e.data[r],e.data[r+1],e.data[r+2])}function Sc(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function e5t(t,e,r,i){lb(swe,t.quaternion),rn(dh,e,t.center),pu(dh,dh,swe);const n=t.halfSize,s=8*((dh[0]<-n[0]?-1:dh[0]>n[0]?1:0)+3*(dh[1]<-n[1]?-1:dh[1]>n[1]?1:0)+9*(dh[2]<-n[2]?-1:dh[2]>n[2]?1:0)+13),o=nwe[s];if(o===0)return o;ZL(pk,t.quaternion),qB(pk,pk,t.halfSize);const a=(l,c)=>{const u=nwe[s+c+1];return se(l,((1&u)<<1)-1,(2&u)-1,((4&u)>>1)-1),po(l,l,pk),ge(l,t.center,l)};return r.length=0,Sc(r,a(iY,0)),Sc(r,a(owe,1)),Sc(r,a(dh,2)),Sc(r,a(awe,3)),i(r),o===1||(r.length=0,Sc(r,iY),Sc(r,awe),Sc(r,a(dh,4)),Sc(r,a(lwe,5)),i(r),o===2||(r.length=0,Sc(r,iY),Sc(r,lwe),Sc(r,a(dh,6)),Sc(r,owe),i(r))),o}const nwe=(()=>{const t=new Array(216);let e=0;const r=i=>{for(let n=0;n<i.length;n++)t[e+n]=i[n];e+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),t})(),$ze=4;function t5t(t,e){let r=0;for(let i=0;i<$ze;i++){const n=t.intersectPlane(e[i]);if(n>0)return-1;n===0&&(r|=1<<i)}return r}const pk=gi(),swe=Gc(),dh=C(),iY=C(),owe=C(),awe=C(),lwe=C();let r5t=class{constructor(e){this._objects=e}submit(e,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(e,r,i))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?Z4t(e,this._objects.visibleObjects):null}};function i5t(t){const e=ln().vec3f(R.POSITION);return t.hasNormals&&e.vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===mn.Default?e.vec2f(R.UV0):t.textureCoordinates===mn.Atlas&&(e.vec2f(R.UV0),e.vec4u16(R.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(R.COLOR,{glNormalized:!0}),e}let n5t=class{constructor(){this.externalColor=tr(),this.externalColorMixMode=ws.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},s5t=class extends Pn{constructor(e,r){super(e,"int",kr.Draw,(i,n,s)=>i.setUniform1i(e,r(n,s)))}};var ty;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(ty||(ty={}));const kce=429496.7296;function Ize(t,e){ED(t/kce*.5+.5,e)}function o5t(t,e){switch(e.componentData){case ty.Varying:return a5t(t,e);case ty.Uniform:return l5t(t,e);case ty.COUNT:return;default:e.componentData}}function a5t(t,e){const{vertex:r,fragment:i}=t;r.include(bp),r.uniforms.add(new Kd("componentColorTex",s=>s.componentParameters.texture.texture)),t.attributes.add(R.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const n=e.output===G.ObjectAndLayerIdColor;n&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(O5e),r.constants.add("elevationScale","float",2*kce),r.constants.add("stride","float",ne("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(T`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(T`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${n?T`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:T`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(T`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?T`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function l5t(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new z9("externalColor",s=>s.componentParameters.externalColor)),i.uniforms.add(new s5t("externalColorMixMode",s=>s.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),r.code.add(T`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const n=e.output===G.ObjectAndLayerIdColor;i.code.add(T`
  void readExternalColor(out vec4 color, out int colorMixMode) {
    color = vExternalColor;
    colorMixMode = externalColorMixMode;
  }

  void outputObjectAndLayerIdColor() {
    ${n?T`fragColor = vec4(0,0,0,0);`:""}
 }
`)}var Rh;function c5t(t,e){const r=t.vertex;switch(r.code.add(T`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case Rh.None:r.code.add(T`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Rh.Opaque:r.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Rh.Transparent:r.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Rh.COUNT:break;default:e.vertexDiscardMode}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(Rh||(Rh={}));var ry;function Bcr(t){return t&&nw(t)?ry.Mars:t&&sw(t)?ry.Moon:ry.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(ry||(ry={}));var Gd;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(Gd||(Gd={}));let hr=class extends jc{constructor(){super(...arguments),this.output=G.Color,this.textureCoordinateType=mn.None,this.componentData=ty.Uniform,this.cullFace=$i.Back,this.vertexDiscardMode=Rh.None,this.doubleSidedMode=En.WindingOrder,this.alphaDiscardMode=xi.Opaque,this.integratedMeshMode=Gd.None,this.transparencyPassType=vt.NONE,this.ellipsoidMode=ry.Earth,this.pbrMode=ht.Disabled,this.normalType=Ur.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.hasNormalTextureTransform=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};d([H({count:G.COUNT})],hr.prototype,"output",void 0),d([H({count:mn.COUNT})],hr.prototype,"textureCoordinateType",void 0),d([H({count:ty.COUNT})],hr.prototype,"componentData",void 0),d([H({count:$i.COUNT})],hr.prototype,"cullFace",void 0),d([H({count:Rh.COUNT})],hr.prototype,"vertexDiscardMode",void 0),d([H({count:En.COUNT})],hr.prototype,"doubleSidedMode",void 0),d([H({count:xi.COUNT})],hr.prototype,"alphaDiscardMode",void 0),d([H({count:Gd.COUNT})],hr.prototype,"integratedMeshMode",void 0),d([H({count:vt.COUNT})],hr.prototype,"transparencyPassType",void 0),d([H({count:ry.COUNT})],hr.prototype,"ellipsoidMode",void 0),d([H({count:ht.COUNT})],hr.prototype,"pbrMode",void 0),d([H({count:Ur.COUNT})],hr.prototype,"normalType",void 0),d([H()],hr.prototype,"spherical",void 0),d([H()],hr.prototype,"doublePrecisionRequiresObfuscation",void 0),d([H()],hr.prototype,"hasVertexColors",void 0),d([H()],hr.prototype,"hasNormals",void 0),d([H()],hr.prototype,"hasSlicePlane",void 0),d([H()],hr.prototype,"hasColorTexture",void 0),d([H()],hr.prototype,"receiveAmbientOcclusion",void 0),d([H()],hr.prototype,"receiveShadows",void 0),d([H()],hr.prototype,"blendingEnabled",void 0),d([H()],hr.prototype,"hasScreenSpaceReflections",void 0),d([H()],hr.prototype,"hasPolygonOffset",void 0),d([H()],hr.prototype,"hasMetallicRoughnessTexture",void 0),d([H()],hr.prototype,"hasEmissionTexture",void 0),d([H()],hr.prototype,"hasOcclusionTexture",void 0),d([H()],hr.prototype,"hasNormalTexture",void 0),d([H()],hr.prototype,"hasOccludees",void 0),d([H()],hr.prototype,"multipassEnabled",void 0),d([H()],hr.prototype,"cullAboveGround",void 0),d([H()],hr.prototype,"hasNormalTextureTransform",void 0),d([H()],hr.prototype,"hasCloudsReflections",void 0),d([H()],hr.prototype,"snowCover",void 0),d([H()],hr.prototype,"objectAndLayerIdColor",void 0),d([H({constValue:!1})],hr.prototype,"occlusionPass",void 0),d([H({constValue:kr.Draw})],hr.prototype,"pbrTextureBindType",void 0),d([H({constValue:!0})],hr.prototype,"hasSliceHighlight",void 0),d([H({constValue:!1})],hr.prototype,"hasSliceInVertexProgram",void 0),d([H({constValue:!1})],hr.prototype,"useCustomDTRExponentForWater",void 0),d([H({constValue:!1})],hr.prototype,"hasVertexTangents",void 0),d([H({constValue:!0})],hr.prototype,"supportsTextureAtlas",void 0),d([H({constValue:!1})],hr.prototype,"highStepCount",void 0),d([H({constValue:!1})],hr.prototype,"instancedDoublePrecision",void 0),d([H({constValue:!1})],hr.prototype,"hasModelTransformation",void 0),d([H({constValue:!0})],hr.prototype,"useFillLights",void 0),d([H({constValue:!1})],hr.prototype,"objectAndLayerIdColorInstanced",void 0);function cwe(t,e){t.include(L2,e),t.fragment.include(wD);const r=t.fragment;r.uniforms.add(new z9("baseColor",i=>i.baseColor)),r.uniforms.add(new ST("objectOpacity",i=>i.objectOpacity)),e.hasVertexColors?r.code.add(T`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(T`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(T`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function uwe(t,e){const r=t.fragment;switch(e.doubleSidedMode){case En.None:r.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case En.View:t.include(rP,e),r.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case En.WindingOrder:r.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case En.COUNT:}switch(e.normalType){case Ur.Attribute:case Ur.Compressed:t.include(pG,e),r.code.add(T`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Ur.ScreenDerivative:t.include(rP,e),r.code.add(T`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Ur.Ground:e.spherical?(t.include(rP,e),r.code.add(T`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(T`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),r.code.add(T`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case Ur.COUNT:}}function u5t(t,e){const r=t.fragment;if(e.hasColorTexture&&(e.output===G.Color||e.alphaDiscardMode!==xi.Opaque)){t.include(uae,e);const i=e.textureCoordinateType===mn.Atlas;r.uniforms.add(new Kd("baseColorTexture",n=>n.texture)),i?(t.include(cDe),r.code.add(T`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):r.code.add(T`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else r.code.add(T`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function Lze(t){const e=new Fr;e.include(rP,t),e.include(pG,t),e.include(L2,t),e.include(Jg,t),e.include(nO,t),e.include(o5t,t),e.include(obt,t),e.include(d1t,t),e.include(u5t,t),e.include(c5t,t);const{vertex:r,fragment:i}=e;t.pbrMode!==ht.Normal&&t.pbrMode!==ht.Schematic||(e.include(dae,t),t.hasNormalTexture&&e.include(L5e,t));const n=t.output===G.Shadow||t.output===G.ShadowHighlight||t.output===G.ShadowExcludeHighlight;n&&t.componentData===ty.Varying?r.code.add(T`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(T`#define discardShadows(castShadows) {}`);const s=t.integratedMeshMode===Gd.ColorOverlay||t.integratedMeshMode===Gd.ColorOverlayWithWater,o=s&&t.output===G.Color&&t.pbrMode===ht.WaterOnIntegratedMesh;return s&&(e.include(s2,t),e.include(pxt,t),t.spherical?r.code.add(T`
      const float invEllipsoidRadius = ${T.float(1/(t.ellipsoidMode===ry.Earth?ni.radius:t.ellipsoidMode===ry.Mars?Jf.radius:o_.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(T`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),r.code.add(T`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===G.ObjectAndLayerIdColor?T`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${T.float(sa)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===G.ObjectAndLayerIdColor?T`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?T`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:T`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?T`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===G.Alpha&&(i.include(dy),e.include(Yu,t),e.include(cwe,t),s&&i.uniforms.add(new ft("ovColorTex",(a,l)=>Yee(a,l))),i.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?T`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?T`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===G.Color&&(i.include(dy),e.include(Yu,t),e.include(cwe,t),e.include(uwe,t),e.include(s2,t),t.receiveShadows?(e.include(VN,t),i.code.add(T`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(T`float evaluateShadow() { return 0.0; }`),s&&i.uniforms.add(new ft("ovColorTex",(a,l)=>Yee(a,l))),i.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?T`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?T`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===ht.Normal||t.pbrMode===ht.Schematic||t.pbrMode===ht.Simplified?(by(i),i.code.add(T`
        ${t.pbrMode===ht.Normal?T`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?i.code.add(T`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(T`vec3 shadingNormal = normalVertex;`),i.code.add(T`${t.spherical?T`vec3 normalGround = normalize(positionWorld());`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(T`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        ${t.pbrMode===ht.Simplified?T` float ssao = 1.0 - evaluateAmbientOcclusionInverse();`:T` float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();`}
        ${t.snowCover?T`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                ssao = mix(ssao, 0.5 * ssao, snow);
                shadingNormal = mix(shadingNormal, surfaceNormal, snow);`:""}

        ${s?T` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        ${t.pbrMode===ht.Simplified?T` vec4 shadedColor = vec4(evaluatePBRSimplifiedLighting(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround), materialColor.a);`:"vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);"}
        `)):(t.receiveShadows?i.code.add(T`float shadow = evaluateShadow();`):t.spherical?(uO(i),i.code.add(T`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(T`float shadow = 0.0;`),o&&i.uniforms.add(new ft("ovNormalTex",(a,l)=>{var c;return(c=l.overlay)==null?void 0:c.getTexture(Wi.WaterNormal)})),t.snowCover&&i.code.add(T`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),i.code.add(T`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?T` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?T`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(T`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===vt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===G.LinearDepth||n)&&(e.include(g_,t),i.code.add(T`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===G.Normal&&(e.include(uwe,t),i.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${t.normalType===Ur.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===G.ObjectAndLayerIdColor&&e.fragment.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?T`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===G.Highlight&&(e.include(gw),i.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?T`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}const h5t=Object.freeze(Object.defineProperty({__proto__:null,build:Lze},Symbol.toStringTag,{value:"Module"}));let Dze=class Nze extends Zr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Fe.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Br(e.rctx,Nze.shader.get().build(this.configuration),Fze)}_setPipelineState(e){const r=this.configuration,i=r.integratedMeshMode!==Gd.None,n=e===vt.NONE,s=e===vt.FrontFace;return Bt({blending:r.output!==G.Color&&r.output!==G.Alpha||!r.blendingEnabled?null:n?Bh:$_(e),culling:j7(r.cullFace),depthTest:{func:yw(e)},depthWrite:n||s?Wu:null,colorWrite:rr,stencilWrite:i||r.hasOccludees?gy:null,stencilTest:i?tbt(Lc.IntegratedMeshMaskExcluded):r.hasOccludees?_w:null,polygonOffset:n||s?r.hasPolygonOffset?{factor:2,units:2}:null:lG})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};Dze.shader=new Vr(h5t,()=>re(()=>Promise.resolve().then(()=>Gjt),void 0));const Fze=new Map([[R.POSITION,0],[R.NORMAL,1],[R.NORMALCOMPRESSED,1],[R.COLOR,2],[R.UV0,3],[R.UVREGION,4],[R.COMPONENTINDEX,5]]);let d5t=class extends Li{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},Uce=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function Rn(t={}){return(e,r)=>{const i=e._parameterCount??0;if(e._parameterCount=i+1,t.vectorOps){const n=t.vectorOps;Object.defineProperty(e,r,{get(){return this[i]},set(s){const o=this[i];if(o==null)this[i]=s;else{if(n.equals(o,s))return;n.copy(o,s)}this._setDirty()}})}else Object.defineProperty(e,r,{get(){return this[i]},set(n){this[i]!==n&&(t.dispose&&this[i]&&this[i].dispose(),this[i]=n,this._setDirty())}})}}function hwe(){return(t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}let RG=class{constructor(e){this._low=C(),this._high=C(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){he(this._low,he(dwe,e));const r=rn(dwe,e,this._low);he(this._high,r)}get(e){return ge(e,this._low,this._high)}getLowScaled(e){return oe(e,this._low,1)}};const dwe=xu();let Oo=class extends d5t{constructor(e,r){super(),this.toMapSpace=r,this.baseColor=Xt(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Ka(fG),this.emissiveFactor=Ce(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new F8,this.componentParameters=new aL,this.textureAlphaCutoff=I9,this.alphaDiscardMode=xi.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=ry.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new hr;const i=new RG(e.position),n=HPe(e.rotationScale);x2(n,n),hp(n,n),this.transformNormalGlobalFromModel=n,this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=lr(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,r,i,n){const s=this._techniqueConfiguration;s.hasVertexColors=n.colors,s.hasNormals=n.hasNormals,s.textureCoordinateType=n.textureCoordinates,s.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,s.hasEmissionTexture=this.emissionTexture!=null,s.hasOcclusionTexture=this.occlusionTexture!=null,s.hasNormalTexture=this.normalTexture!=null,s.transparencyPassType=r.identifier===Cu.Material&&i.transparencyPassType!=null?i.transparencyPassType:vt.NONE,s.multipassEnabled=r.identifier===Cu.Material&&i.multipassEnabled,s.cullAboveGround=r.identifier===Cu.Material&&i.multipassTerrain.cullAboveGround,s.ellipsoidMode=this.ellipsoidMode,s.componentData=this.componentParameters.type,s.cullFace=this.commonMaterialParameters.cullFace,s.doubleSidedMode=this.commonMaterialParameters.doubleSided?En.View:En.None,s.hasColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();if(s.blendingEnabled=o===kl.Transparent||o===kl.OpaqueAndTransparent,s.alphaDiscardMode=this.alphaDiscardMode,s.integratedMeshMode=this.isIntegratedMesh?m5t(i)?f5t(i)?Gd.ColorOverlayWithWater:Gd.ColorOverlay:Gd.NoOverlay:Gd.None,s.hasPolygonOffset=this.polygonOffsetEnabled,s.pbrMode=s.integratedMeshMode===Gd.ColorOverlayWithWater?ht.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?ne("enable-feature:im-shading")&&this.isIntegratedMesh?ht.Simplified:ht.Schematic:ht.Normal:ht.Disabled,s.normalType=n.needsNormals?s.hasNormals?Ur.Compressed:Ur.ScreenDerivative:Ur.Ground,s.hasSlicePlane=i.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,r.identifier===Cu.ShadowMap)s.output=G.Shadow,s.vertexDiscardMode=Rh.None;else if(r.identifier===Cu.Highlight)s.output=G.Highlight,s.vertexDiscardMode=Rh.None;else{switch(o===kl.OpaqueAndTransparent?s.vertexDiscardMode=r.transparent?Rh.Opaque:Rh.Transparent:s.vertexDiscardMode=Rh.None,s.output=r.output,s.receiveAmbientOcclusion=!1,s.receiveShadows=!1,r.output){case G.Color:s.receiveAmbientOcclusion=i.ssao!=null,s.hasOccludees=i.hasOccludees,s.receiveShadows=i.shadowMap.ready,s.hasScreenSpaceReflections=i.ssr.lastFrameColor!=null,s.hasCloudsReflections=i.cloudsFade.data!=null;break;case G.Alpha:s.hasOccludees=i.hasOccludees;break;case G.ObjectAndLayerIdColor:s.objectAndLayerIdColor=!0}s.snowCover=this.hasSnowCover(i)}return this._technique=e.releaseAndAcquire(Dze,s,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,r,i){if(this.objectOpacity===0)return;const n=i.renderable.geometry,s=i.components,o=i.renderable.meta.cameraDepthSquared,a=s.geometryRanges,l=s.highlightRanges,c=s.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case kl.Opaque:e.materialOpaque.submitDraw(this,n,a,o);break;case kl.Transparent:e.materialTransparent.submitDraw(this,n,a,o);break;case kl.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,n,a,o),e.materialTransparent.submitDraw(this,n,a,o);break;case kl.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,n,a,o),p5t(r)&&e.highlightIntegratedMesh.submitDraw(this,n,a,o)}const u=this.componentParameters.castShadows!==lo.None;u&&e.shadowMap.submitDraw(this,n,a,o),l!=null&&(e.highlight.submitDraw(this,n,l,o),u&&e.highlightShadowMap.submitDraw(this,n,l,o)),u&&c!=null&&e.defaultShadowMap.submitDraw(this,n,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?kl.IntegratedMesh:this.objectOpacity<1?kl.Transparent:this.componentParameters.opaqueOverride===lo.All?kl.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===xi.Blend||this.alphaDiscardMode===xi.MaskBlend?kl.Transparent:this.componentParameters.transparent===lo.None?kl.Opaque:this.componentParameters.transparent===lo.All?kl.Transparent:kl.OpaqueAndTransparent}};var kl,lo;d([Rn({vectorOps:QPe})],Oo.prototype,"baseColor",void 0),d([Rn()],Oo.prototype,"usePBR",void 0),d([Rn()],Oo.prototype,"hasParametersFromSource",void 0),d([Rn({vectorOps:Qde})],Oo.prototype,"mrrFactors",void 0),d([Rn({vectorOps:Qde})],Oo.prototype,"emissiveFactor",void 0),d([Rn({dispose:!0})],Oo.prototype,"baseColorTexture",void 0),d([Rn({dispose:!0})],Oo.prototype,"metallicRoughnessTexture",void 0),d([Rn({dispose:!0})],Oo.prototype,"emissionTexture",void 0),d([Rn({dispose:!0})],Oo.prototype,"occlusionTexture",void 0),d([Rn({dispose:!0})],Oo.prototype,"normalTexture",void 0),d([Rn()],Oo.prototype,"objectOpacity",void 0),d([hwe()],Oo.prototype,"commonMaterialParameters",void 0),d([hwe()],Oo.prototype,"componentParameters",void 0),d([Rn()],Oo.prototype,"textureAlphaCutoff",void 0),d([Rn()],Oo.prototype,"alphaDiscardMode",void 0),d([Rn()],Oo.prototype,"isIntegratedMesh",void 0),d([Rn()],Oo.prototype,"polygonOffsetEnabled",void 0),d([Rn()],Oo.prototype,"ellipsoidMode",void 0),d([Rn()],Oo.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(kl||(kl={}));let F8=class extends Uce{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=$i.Back,this.hasSlicePlane=!0}};d([Rn()],F8.prototype,"doubleSided",void 0),d([Rn()],F8.prototype,"cullFace",void 0),d([Rn()],F8.prototype,"hasSlicePlane",void 0);let aL=class extends Uce{constructor(){super(...arguments),this.externalColor=Xt(1,1,1,1),this.externalColorMixMode=ws.Multiply,this.castShadows=lo.All}get transparent(){return this.externalColor[3]<1?lo.All:lo.None}get opaqueOverride(){return this.externalColorMixMode===ws.Replace&&this.externalColor[3]===1?lo.All:lo.None}get visible(){return this.externalColor[3]>0?lo.All:lo.None}get type(){return ty.Uniform}};d([Rn({vectorOps:QPe})],aL.prototype,"externalColor",void 0),d([Rn()],aL.prototype,"externalColorMixMode",void 0),d([Rn()],aL.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(lo||(lo={}));let $$=class extends Uce{constructor(){super(...arguments),this.texture=null,this.transparent=lo.None,this.opaqueOverride=lo.None,this.castShadows=lo.None}get type(){return ty.Varying}};function p5t(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(Wi.Highlight))!=null}function f5t(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(Wi.WaterNormal))!=null}function m5t(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(Wi.ColorNoRasterImage))!=null}d([Rn()],$$.prototype,"texture",void 0),d([Rn()],$$.prototype,"transparent",void 0),d([Rn()],$$.prototype,"opaqueOverride",void 0),d([Rn()],$$.prototype,"castShadows",void 0);const fV=ln().vec3f(R.POSITION).u16(R.COMPONENTINDEX),kze=ln().vec2u8(R.SIDENESS),g5t=Ju(kze),Yte=ln().vec3f(R.POSITION0).vec3f(R.POSITION1).vec2i16(R.NORMALCOMPRESSED).u16(R.COMPONENTINDEX).u8(R.VARIANTOFFSET,{glNormalized:!0}).u8(R.VARIANTSTROKE).u8(R.VARIANTEXTENSION,{glNormalized:!0}),Xte=ln().vec3f(R.POSITION0).vec3f(R.POSITION1).vec2i16(R.NORMALCOMPRESSED).vec2i16(R.NORMAL2COMPRESSED).u16(R.COMPONENTINDEX).u8(R.VARIANTOFFSET,{glNormalized:!0}).u8(R.VARIANTSTROKE).u8(R.VARIANTEXTENSION,{glNormalized:!0}),Uze=new Map([[R.POSITION0,0],[R.POSITION1,1],[R.COMPONENTINDEX,2],[R.VARIANTOFFSET,3],[R.VARIANTSTROKE,4],[R.VARIANTEXTENSION,5],[R.NORMALCOMPRESSED,6],[R.NORMAL2COMPRESSED,7],[R.SIDENESS,8]]);function pwe(t,e,r){const i=e/3,n=new Uint32Array(r+1),s=new Uint32Array(r+1),o=(b,w)=>{b<w?n[b+1]++:s[w+1]++};for(let b=0;b<i;b++){const w=t[3*b],x=t[3*b+1],S=t[3*b+2];o(w,x),o(x,S),o(S,w)}let a=0,l=0;for(let b=0;b<r;b++){const w=n[b+1],x=s[b+1];n[b+1]=a,s[b+1]=l,a+=w,l+=x}const c=new Uint32Array(6*i),u=n[r],h=(b,w,x)=>{if(b<w){const S=n[b+1]++;c[2*S]=w,c[2*S+1]=x}else{const S=s[w+1]++;c[2*u+2*S]=b,c[2*u+2*S+1]=x}};for(let b=0;b<i;b++){const w=t[3*b],x=t[3*b+1],S=t[3*b+2];h(w,x,b),h(x,S,b),h(S,w,b)}const p=(b,w)=>{const x=2*b,S=w-b;for(let E=1;E<S;E++){const P=c[x+2*E],M=c[x+2*E+1];let L=E-1;for(;L>=0&&c[x+2*L]>P;L--)c[x+2*L+2]=c[x+2*L],c[x+2*L+3]=c[x+2*L+1];c[x+2*L+2]=P,c[x+2*L+3]=M}};for(let b=0;b<r;b++)p(n[b],n[b+1]),p(u+s[b],u+s[b+1]);const f=new Int32Array(3*i),g=(b,w)=>b===t[3*w]?0:b===t[3*w+1]?1:b===t[3*w+2]?2:-1,y=(b,w)=>{const x=g(b,w);f[3*w+x]=-1},v=(b,w,x,S)=>{const E=g(b,w);f[3*w+E]=S;const P=g(x,S);f[3*S+P]=w};for(let b=0;b<r;b++){let w=n[b];const x=n[b+1];let S=s[b];const E=s[b+1];for(;w<x&&S<E;){const P=c[2*w],M=c[2*u+2*S];P===M?(v(b,c[2*w+1],M,c[2*u+2*S+1]),w++,S++):P<M?(y(b,c[2*w+1]),w++):(y(M,c[2*u+2*S+1]),S++)}for(;w<x;)y(b,c[2*w+1]),w++;for(;S<E;)y(c[2*u+2*S],c[2*u+2*S+1]),S++}return f}let zze=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?_5t:y5t}write(e,r,i){const n=this._edgeHashFunction(i);fk.seed=n;const s=fk.getIntRange(0,255),o=fk.getIntRange(0,this.settings.variants-1),a=.7,l=fk.getFloat(),c=255*(.5*v5t(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(r,i.position0),e.position1.setVec(r,i.position1),e.componentIndex.set(r,i.componentIndex),e.variantOffset.set(r,s),e.variantStroke.set(r,o),e.variantExtension.set(r,c)}trim(e,r){return e.slice(0,r)}};const zce=new Float32Array(6),mV=new Uint32Array(zce.buffer),Wv=new Uint32Array(1);function y5t(t){const e=zce;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],Wv[0]=5381;for(let r=0;r<mV.length;r++)Wv[0]=31*Wv[0]+mV[r];return Wv[0]}function _5t(t){const e=zce;e[0]=GE(t.position0[0]),e[1]=GE(t.position0[1]),e[2]=GE(t.position0[2]),e[3]=GE(t.position1[0]),e[4]=GE(t.position1[1]),e[5]=GE(t.position1[2]),Wv[0]=5381;for(let r=0;r<mV.length;r++)Wv[0]=31*Wv[0]+mV[r];return Wv[0]}const fwe=1e4;function GE(t){return Math.round(t*fwe)/fwe}function v5t(t,e){const r=t<0?-1:1;return Math.abs(t)**e*r}let gV=class{constructor(){this._commonWriter=new zze}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return Yte.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),ge(jE,i.faceNormal0,i.faceNormal1),me(jE,jE);const{typedBuffer:n,typedBufferStride:s}=e.normalCompressed;_m(n,r,jE[0],jE[1],jE[2],s)}trim(e,r){return this._commonWriter.trim(e,r)}};gV.Layout=Yte,gV.glLayout=Ju(Yte,1);let yV=class{constructor(){this._commonWriter=new zze}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return Xte.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i);{const{typedBuffer:n,typedBufferStride:s}=e.normalCompressed;_m(n,r,i.faceNormal0[0],i.faceNormal0[1],i.faceNormal0[2],s)}{const{typedBuffer:n,typedBufferStride:s}=e.normal2Compressed;_m(n,r,i.faceNormal1[0],i.faceNormal1[1],i.faceNormal1[2],s)}}trim(e,r){return this._commonWriter.trim(e,r)}};yV.Layout=Xte,yV.glLayout=Ju(Xte,1);const jE=C(),fk=new lT,nS=-1;var _V;function b5t(t,e,r,i=C5t){const n=t.vertices.position,s=t.vertices.componentIndex,o=Ut(i.anglePlanar),a=Ut(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),u=Zte.edge,h=u.position0,p=u.position1,f=u.faceNormal0,g=u.faceNormal1,y=E5t(t),v=T5t(t),b=v.length/4,w=e.allocate(b);let x=0;const S=b,E=r.allocate(S);let P=0,M=0,L=0;const U=pHe(0,b),z=new Float32Array(b);z.forEach((X,le,D)=>{n.getVec(v[4*le],h),n.getVec(v[4*le+1],p),D[le]=Bi(h,p)}),U.sort((X,le)=>z[le]-z[X]);const W=new Array,V=new Array;for(let X=0;X<b;X++){const le=U[X],D=z[le],I=v[4*le],k=v[4*le+1],j=v[4*le+2],q=v[4*le+3],Q=q===nS;if(n.getVec(I,h),n.getVec(k,p),Q)se(f,y[3*j],y[3*j+1],y[3*j+2]),he(g,f),u.componentIndex=s.get(I),u.cosAngle=fe(f,g);else{if(se(f,y[3*j],y[3*j+1],y[3*j+2]),se(g,y[3*q],y[3*q+1],y[3*q+2]),u.componentIndex=s.get(I),u.cosAngle=fe(f,g),x5t(u,c))continue;u.cosAngle<-.9999&&he(g,f)}M+=D,L++,Q||w5t(u,l)?(e.write(w,x++,u),W.push(D)):S5t(u,o)&&(r.write(E,P++,u),V.push(D))}const J=new Float32Array(W.reverse()),Y=new Float32Array(V.reverse());return{regular:{instancesData:e.trim(w,x),lodInfo:{lengths:J}},silhouette:{instancesData:r.trim(E,P),lodInfo:{lengths:Y}},averageEdgeLength:M/L}}function w5t(t,e){return t.cosAngle<e}function x5t(t,e){return t.cosAngle>e}function S5t(t,e){const r=_o(t.cosAngle),i=Zte.fwd,n=Zte.ortho;return x_(i,t.position1,t.position0),r*(fe(it(n,t.faceNormal0,t.faceNormal1),i)>0?-1:1)>e}function T5t(t){const e=t.faces.length/3,r=t.faces,i=t.neighbors;let n=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],h=r[3*a],p=r[3*a+1],f=r[3*a+2];n+=l===nS||h<p?1:0,n+=c===nS||p<f?1:0,n+=u===nS||f<h?1:0}const s=new Int32Array(4*n);let o=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],h=r[3*a],p=r[3*a+1],f=r[3*a+2];(l===nS||h<p)&&(s[o++]=h,s[o++]=p,s[o++]=a,s[o++]=l),(c===nS||p<f)&&(s[o++]=p,s[o++]=f,s[o++]=a,s[o++]=c),(u===nS||f<h)&&(s[o++]=f,s[o++]=h,s[o++]=a,s[o++]=u)}return s}function E5t(t){const e=t.faces.length/3,r=t.vertices.position,i=t.faces,n=nY.v0,s=nY.v1,o=nY.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=i[3*l],u=i[3*l+1],h=i[3*l+2];r.getVec(c,n),r.getVec(u,s),r.getVec(h,o),_e(s,s,n),_e(o,o,n),it(n,s,o),me(n,n),a[3*l]=n[0],a[3*l+1]=n[1],a[3*l+2]=n[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(_V||(_V={}));const Zte={edge:{position0:C(),position1:C(),faceNormal0:C(),faceNormal1:C(),componentIndex:0,cosAngle:0},ortho:C(),fwd:C()},nY={v0:C(),v1:C(),v2:C()},C5t={anglePlanar:4,angleSignificantEdge:35};function P5t(t){const e=A5t(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return mwe.updateSettings(t.writerSettings),gwe.updateSettings(t.writerSettings),b5t(e,mwe,gwe)}function A5t(t,e,r,i){if(e){const o=pwe(r,i,t.count);return new O5t(r,i,o,t)}const n=ZZ(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:i}),s=pwe(n.indices,i,n.uniqueCount);return{faces:n.indices,facesLength:n.indices.length,neighbors:s,vertices:fV.createView(n.buffer)}}let O5t=class{constructor(e,r,i,n){this.faces=e,this.facesLength=r,this.neighbors=i,this.vertices=n}};const mwe=new gV,gwe=new yV,tur=ln().vec3f(R.POSITION0).vec3f(R.POSITION1),M5t=ln().vec3f(R.POSITION0).vec3f(R.POSITION1).u16(R.COMPONENTINDEX);let R5t=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},$5t=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0;const i=new ui(this.textureWidth,1);i.samplingMode=Kt.NEAREST,i.wrapMode=nr.CLAMP_TO_EDGE,this._texture=new Mr(this._rctx,i),this._data=new dl(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,r,i,n,s,o){const a=e*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,n),this._data.set(a,2,s),this._data.set(a,3,o)}setDataElement(e,r,i,n){const s=e*this._fieldCount+r;this._dirty=!0,this._data.set(s,i,n)}getDataElement(e,r,i){const n=e*this._fieldCount+r;return this._dirty=!0,this._data.get(n,i)}resizeToFit(e){const r=(e+1)*this._fieldCount;if(r>this._data.count){const i=Math.ceil(r/this.textureWidth)*this.textureWidth,n=new dl(new ArrayBuffer(4*i));n.typedBuffer.set(this._data.typedBuffer),this._data=n}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>e*r&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const Vze=65536;let I5t=class{constructor(e,r=1){this.textureBuffer=new $5t(e,r),this._indexManager=new R5t(Vze)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},Bze=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const i of this._buffers)if(i.availableCount>=e)return i;if(e>Vze)return null;const r=new I5t(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const ywe=()=>K.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let L5t=class{constructor(e,r){this._renderManager=e,this._viewingMode=r,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._visible=new jt,this._hidden=new jt,this._renderSubmit=new r5t(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=ne("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new Bze(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){_t(this._hidden.length===0&&this._visible.length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll(e=>e.destroy()),this._hidden.forAll(e=>e.destroy()),this._visible.clear(),this._hidden.clear()}createObject(e){const r=e.geometry,i=new x4t(this._componentBufferManager,Yg(r.componentOffsets)),n=this._createRenderable(e,i),s=new M4t(this._viewingMode,r.positionData,i),o=new T4t(e.transform,e.toMapSpace,e.obb.clone(),i,n,s);return(o.visible?this._visible:this._hidden).push(o),o}destroyObject(e){const r=e;(r.visible?this._visible:this._hidden).removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(e,r){const i=e;r!==i.visible&&(r?(this._hidden.removeUnordered(i),this._visible.push(i)):(this._visible.removeUnordered(i),this._hidden.push(i)),i.visible=r,this._notifyDirty())}preSubmit(e){const r=e.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=ca(r,i.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,r){const i=e.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,r){const i=e;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,r){return e.components.visibility.forEachComponent(r)}getComponentCount(e){const r=e,i=r.components.visibility.componentCount;return{visible:i,invisible:r.components.count-i}}setComponentData(e,r){const i=e,n=i.renderable.material,s=i.components,o=s.materialDataBuffer,a=s.materialDataIndices,l=new n5t,c=o.textureBuffer,u=new Uint8Array(4),h=new Uint32Array(u.buffer);let p=0,f=0,g=0,y=s.verticalOffsets,v=1/0,b=-1/0,w=!1,x=!1,S=0;for(let E=0;E<s.count;E++){r(E,l),p+=+(l.externalColor[3]<1),f+=+(l.externalColorMixMode===ws.Replace&&l.externalColor[3]===1),g+=+l.castShadows,A5e(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[E],0,u[0],u[1],u[2],u[3]),w||(w=E>0&&S!==h[0]),S=h[0],x||(x=l.elevationOffset!==0),x&&y==null&&(y=new Array(E).fill(0)),y!=null&&(y[E]=l.elevationOffset),v=Math.min(v,l.elevationOffset),b=Math.max(b,l.elevationOffset),Ize(l.elevationOffset,u),c.setData(a[E],1,u[0],u[1],u[2],u[3]);const P=l.objectAndLayerIdColor;P!=null&&c.setData(a[E],2,P[0],P[1],P[2],P[3]),l.pickable!==qte(s.pickability,E)&&(s.pickability=E4t(s.pickability,s.count,E,l.pickable))}s.verticalOffsets=x?y:null,i.offsetObb=x?y$e(i.obb,v,b,this._viewingMode,i.offsetObb??i.obb.clone()):null,w||x||this._hasObjectAndLayerId?(n.componentParameters=new $$,n.componentParameters.castShadows=sY(g,s.count),n.componentParameters.transparent=sY(p,s.count),n.componentParameters.opaqueOverride=sY(f,s.count),n.componentParameters.texture=c,c.updateTexture()):(n.componentParameters=new aL,n.componentParameters.castShadows=l.castShadows?lo.All:lo.None,n.componentParameters.externalColor=l.externalColor,n.componentParameters.externalColorMixMode=l.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(e,r,i,n=!1){e.intersectionGeometry.getComponentAabb(r,i);const s=e,o=s.components.verticalOffsets;if(n||o==null)return i;const a=o[r];if(this._viewingMode===Fe.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=_me(a);return l.localOrigin=s.transform.position,l.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,r,i){return e.intersectionGeometry.getComponentPositions(r,i)}expandRangeWithComponentObjectElevationRange(e,r,i,n){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==r||n.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const s=e,o=s.components,a=o.count,l=o.verticalOffsets,c=s.intersectionGeometry,u=this._viewingMode===Fe.Local,h=c.getComponentAabbs(),p=N5t;let f=1/0,g=-1/0;for(let y=0;y<a;y++){const v=6*y,b=(l==null?void 0:l[y])??0;let w=1/0,x=-1/0;if(u)w=h[v+2]+b+r,x=h[v+5]+b+r;else{if(p[0]=h[v],p[1]=h[v+1],p[2]=h[v+2],p[3]=h[v+3],p[4]=h[v+4],p[5]=h[v+5],b!==0){const M=_me(b);M.localOrigin=s.transform.position,M.applyToAabb(p)}const S=Math.max(Math.abs(p[3]),Math.abs(p[0])),E=Math.max(Math.abs(p[4]),Math.abs(p[1])),P=r+p[5]+i;n.expandElevationRangeValues(r+p[2],Math.sqrt(S*S+E*E+P*P)-i)}n.expandElevationRangeValues(w,x),f=Math.min(f,w),g=Math.max(g,x)}this._elevationRangeCacheVerticalOffset=r,this._elevationRangeCacheMin=f,this._elevationRangeCacheMax=g}intersect(e,r,i,n,s,o,a){const l=e,{transform:c}=l,{position:u}=c;return s!=null&&(s.localOrigin=u),l.intersectionGeometry.intersect(r,i,n,s,l.components.verticalOffsets,o,c,a??!1)}addEdges(e,r,i,n){const s=e,{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets;return r.addComponentObject(s,a,o,l,i,n)}async extractEdgeInformation(e,r,i){const n=e,s=n.components.visibility;if(s.allInvisible())return{buffer:M5t.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets,c=fV.createBuffer(a.length/3);WN(c.position.typedBuffer,a,c.position.typedBufferStride,3),pAe(c.position,c.position,n.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,h=this._computeVisibilityIndices(o,s,l,u);return{origin:nn(n.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:h,indicesLength:h.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,r,i){let n=0;for(let s=0;s<i.length-1;s++){const o=i[s],a=i[s+1];for(let l=o;l<a;l++){const c=r?r[l]:l;e.set(c,n)}n++}}_computeVisibilityIndices(e,r,i,n){if(e&&r.allVisible())return e;let s=0;r.forEachComponentRange((l,c)=>(s+=i[c]-i[l],!0));const o=np(e)?new Array(s):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||n<=65536?new Uint16Array(s):new Uint32Array(s);let a=0;return r.forEachComponentRange((l,c)=>{const u=i[l],h=i[c];for(let p=u;p<h;p++)o[a++]=e?e[p]:p;return!0}),o}addComponentHighlight(e,r){const i=e.components;i.highlightCounts==null&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,r){const i=e.components;if(i.highlightCounts==null)return void ywe().warn("Removing non-existing highlight.");const n=i.highlightCounts[r],s=i.highlightCounts[i.count];if(n!==0){if(n>1)return i.highlightCounts[r]=n-1,void(i.highlightCounts[i.count]=s-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),s===1?i.highlightCounts=null:i.highlightCounts[i.count]=s-1}else ywe().warn("Removing non-existing highlight.")}clearHighlights(e){const r=e.components;r.highlightCounts!=null&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(e,r){const i=this._renderManager.rctx,n=e.geometry,s=n.vertices.layoutParameters,o=ti.createVertex(i,Lr.STATIC_DRAW,n.vertices.data),a=n.indices?ti.createIndex(i,Lr.STATIC_DRAW,n.indices):null,l=Ju(i5t(s)),c=new Uint16Array(n.vertices.count);for(let y=0;y<r.count;y++){const v=r.offsets[y],b=r.offsets[y+1],w=r.materialDataIndices[y];if(n.indices!=null)for(let x=v;x<b;x++)c[n.indices[x]]=w;else for(let x=v;x<b;x++)c[x]=w}const u=ti.createVertex(i,Lr.STATIC_DRAW,c.buffer),h=new Oo(e.transform,e.toMapSpace),p=new fp(i,Fze,{data:l,componentIndices:D5t},{data:o,componentIndices:u},a),f=new Y4t(p,dr.TRIANGLES,s,a!=null),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.usedMemory+u.usedMemory+(a!=null?a.usedMemory:0)};return new W4t(h,f,g)}_notifyDirty(){this._renderManager.notifyDirty()}};const D5t=Ju(ln().u16(R.COMPONENTINDEX));function sY(t,e){return t===e?lo.All:t===0?lo.None:lo.Some}const N5t=Ds();let $G=class extends Li{constructor(){super(...arguments),this.opacity=1}};function Gze(t){const e=new Fr;return e.include(gl),e.fragment.uniforms.add(new ft("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Ie("opacity",r=>r.opacity)),e.fragment.code.add(T`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const F5t=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:$G,build:Gze},Symbol.toStringTag,{value:"Module"}));var tl;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(tl||(tl={}));let vV=class extends jc{constructor(){super(...arguments),this.alphaMode=tl.None,this.hasOpacityFactor=!1}};d([H({count:tl.COUNT})],vV.prototype,"alphaMode",void 0),d([H()],vV.prototype,"hasOpacityFactor",void 0);let Vce=class jze extends Zr{initializeProgram(e){return new Br(e.rctx,jze.shader.get().build(this.configuration),Nr)}initializePipeline(){switch(this.configuration.alphaMode){case tl.None:return Bt({colorWrite:rr});case tl.Alpha:return Bt({blending:ya(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:rr});case tl.PremultipliedAlpha:case tl.COUNT:return Bt({blending:qu(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:rr})}}};Vce.shader=new Vr(F5t,()=>re(()=>Promise.resolve().then(()=>jjt),void 0));let Bce=class extends Li{};function Hze(){const t=new Fr;return t.include(gl),t.fragment.uniforms.add(new ft("tex",e=>e.texture)),t.fragment.code.add(T`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const k5t=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Bce,build:Hze},Symbol.toStringTag,{value:"Module"}));let qze=class Wze extends Zr{initializeProgram(e){return new Br(e.rctx,Wze.shader.get().build(),Nr)}initializePipeline(){return Bt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};qze.shader=new Vr(k5t,()=>re(()=>Promise.resolve().then(()=>Hjt),void 0));let Gce=class extends Li{};function Yze(){const t=new Fr;return t.include(gl),t.fragment.uniforms.add(new ft("colorTexture",e=>e.colorTexture),new ft("alphaTexture",e=>e.alphaTexture),new ft("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(T`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb / srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const U5t=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:Gce,build:Yze},Symbol.toStringTag,{value:"Module"}));let Xze=class Zze extends Zr{initializeProgram(e){return new Br(e.rctx,Zze.shader.get().build(),Nr)}initializePipeline(){return Bt({blending:ya(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:rr})}};Xze.shader=new Vr(U5t,()=>re(()=>Promise.resolve().then(()=>qjt),void 0));let z5t=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._configuration=new vV,this._passParameters=new $G,this._oitParameters=new Gce,this._hudParameters=new Bce}compositeOIT(e,r,i,n){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=n;const s=this._techniqueRepository.acquire(Xze);this._rctx.bindTechnique(s,e,this._oitParameters),this._rctx.screen.draw(),s.release()}compositeHUD(e,r){this._hudParameters.texture=r;const i=this._techniqueRepository.acquire(qze);this._rctx.bindTechnique(i,e,this._hudParameters),this._rctx.screen.draw(),i.release()}composite(e,r,i=tl.None,n=1){this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=n!==1,this._passParameters.texture=r,this._passParameters.opacity=n;const s=this._techniqueRepository.acquire(Vce,this._configuration);this._rctx.bindTechnique(s,e,this._passParameters),this._rctx.screen.draw(),s.release()}};const V5t=1e4,Jte=100,B5t=500,G5t=500,j5t=.1;function H5t(t,e,r){return Ale(e,t)*(r[1]-r[0])+r[0]}function q5t(t,e,r){let i=0;if(!e.some(s=>!!s.materialReference&&(i+=s.numGeometries,i>=V5t)))return eFt.compute(t,e);const n=XN();return r.forAll(s=>SA(n,W5t(t,s))),n}function W5t(t,e){if(!e.visible)return;const r=XN(),i=e.getSpatialQueryAccelerator();return i?Y5t(r,t,i):X5t(r,t,e.objects),r}function Y5t(t,e,r){const i=e.eye,n=e.viewForward,s=e.frustum,o=l=>l.visible,a=r.objectCount;if(a<B5t)ND(Od,e.near,Math.min(t.near,e.far)),r.forEachInDepthRange(i,n,Bf.DepthOrder.FRONT_TO_BACK,Od,(l,c)=>{Qte(t,e,l),Od.far=t.near,c.setRange(Od)},s,o),ND(Od,Math.max(t.far,e.near),e.far),r.forEachInDepthRange(i,n,Bf.DepthOrder.BACK_TO_FRONT,Od,(l,c)=>{Qte(t,e,l),Od.near=t.far,c.setRange(Od)},s,o);else{const l=Math.max(Math.min(a,G5t),Math.ceil(a*j5t)),c=r.findClosest(n,Bf.DepthOrder.FRONT_TO_BACK,s,o,l),u=r.findClosest(n,Bf.DepthOrder.BACK_TO_FRONT,s,o,l);c&&u&&(_we(t,e,c.boundingVolumeWorldSpace.bounds),_we(t,e,u.boundingVolumeWorldSpace.bounds))}}function X5t(t,e,r){HE.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&HE.add(i)}),HE.empty||(HE.sort(e),ND(Od,e.near,Math.min(t.near,e.far)),HE.forEachInDepthRange(Od,Bf.DepthOrder.FRONT_TO_BACK,(i,n)=>{n<t.near&&Qte(t,e,i)}),ND(Od,Math.max(t.far,e.near),e.far),HE.forEachInDepthRange(Od,Bf.DepthOrder.BACK_TO_FRONT,(i,n,s)=>{t.far=Math.max(t.far,s)}))}function Qte(t,e,r){if(!r.visible||!jv(e.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,n=K5t;r.geometries.forEach(s=>{Kr(n,i,s.transformation);const o=WP(n);Jze(t,e,s.boundingInfo,n,o)})}function Jze(t,e,r,i,n){if(r==null)return;ze(Gl,r.center,i);const{eye:s,viewForward:o}=e,a=o[0]*(Gl[0]-s[0])+o[1]*(Gl[1]-s[1])+o[2]*(Gl[2]-s[2]);if(Gl[3]=r.radius*n,!(a-Gl[3]>t.near&&a+Gl[3]<t.far)&&jv(e.frustum,Gl))if(r.radius>Jte&&r.getChildren())for(const l of r.getChildren())Jze(t,e,l,i,n);else Kte.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function _we(t,e,r){const i=e.eye,n=e.viewForward,s=(r[0]-i[0])*n[0]+(r[1]-i[1])*n[1]+(r[2]-i[2])*n[2];t.near=Math.min(t.near,s-r[3]),t.far=Math.max(t.far,s+r[3])}let Z5t=class{constructor(){this._items=new jt({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const r=e.eye,i=e.viewForward;this._items.forAll(n=>{const s=n.object.boundingVolumeWorldSpace.bounds,o=(s[0]-r[0])*i[0]+(s[1]-r[1])*i[1]+(s[2]-r[2])*i[2];n.distance=o,n.near=o-s[3],n.far=o+s[3]}),this._items.sort((n,s)=>n.distance-s.distance)}forEachInDepthRange(e,r,i){if(r===Bf.DepthOrder.FRONT_TO_BACK)for(let n=0;n<this._items.length;++n){const s=this._items.data[n];s.far<e.near||s.near>e.far||i(s.object,s.near,s.far)}else for(let n=this._items.length-1;n>=0;--n){const s=this._items.data[n];s.far<e.near||s.near>e.far||i(s.object,s.near,s.far)}}},J5t=class{constructor(){this._view=xe(),this._viewProj=xe(),this._frustum=pD(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,r){this._reset(),cs(this._view,e.viewMatrix),Kr(this._viewProj,e.projectionMatrix,this._view),d9(this._frustum,e.frustum);const i=this._view,n=i[2],s=i[6],o=i[10],a=i[14];r.forAll(p=>{p.materialReference&&p.forEachGeometry&&p.forEachGeometry(f=>{if(!f.visible||!f.castShadow)return;const g=f.boundingSphere,y=n*g[0]+s*g[1]+o*g[2]+a,v=y-g[3],b=y+g[3];this._geometries.push(f),this._near.push(-b),this._far.push(-v)})});const l=new Fce;if(this._geometries.length===0)return l;for(let p=0;p<this._geometries.length;++p)this._near[p]>l.far&&(l.far=this._near[p]),this._near[p]>2&&this._far[p]<l.near&&(l.near=this._far[p]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,h=0;for(let p=0;p<this._geometries.length;++p)this._near[p]<l.near&&(this._near[p]>=c.near?l.near=this._near[p]:this._nearCandidates[u++]=p),this._far[p]>l.far&&(this._far[p]<=c.far?l.far=this._far[p]:this._farCandidates[h++]=p);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((p,f)=>this._near[p]<this._near[f]?-1:this._near[p]>this._near[f]?1:0),this._farCandidates.sort((p,f)=>this._far[p]<this._far[f]?1:this._far[p]>this._far[f]?-1:0);for(let p=0;p<this._nearCandidates.length;++p){const f=this._nearCandidates[p];if(this._near[f]<l.near){const g=this._geometries[f],y=g.boundingInfo;this._includeNearBoundingInfoRec(y,g.shaderTransformation,l)}}for(let p=0;p<this._farCandidates.length;++p){const f=this._farCandidates[p];if(this._far[f]>l.far){const g=this._geometries[f],y=g.boundingInfo;this._includeFarBoundingInfoRec(y,g.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,r,i){if(e==null)return;const n=e.center;ze(Gl,n,r);const s=WP(r),o=Gl[0],a=Gl[1],l=Gl[2],c=e.radius*s,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const h=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],p=h+c;if(!(-(h-c)<2||-p>=i.near))if(-p>this._looseRange.near)i.near=-p;else{if(c>Jte){const f=e.getChildren();if(f!==void 0){for(const g of f)this._includeNearBoundingInfoRec(g,r,i);return}}Kte.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,r,i){if(e==null)return;let n=e.radius;const s=e.center;ze(Gl,s,r);const o=WP(r),a=Gl[0],l=Gl[1],c=Gl[2];n*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>n||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>n||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>n||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>n)return;const h=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-n;if(!(-h<=i.far))if(-h<this._looseRange.far)i.far=-h;else{if(n>Jte){const p=e.getChildren();if(p!==void 0){for(const f of p)this._includeFarBoundingInfoRec(f,r,i);return}}Kte.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}},Q5t=class{constructor(){this._modelViewProj=xe(),this._clipPosition=[tr(),tr(),tr(),tr(),tr(),tr(),tr(),tr()]}unionDepthRangeWithAABB(e,r,i,n,s){const o=this._modelViewProj;Kr(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?n[0]:s[0],h=l===0||l===1||l===4||l===5?n[1]:s[1],p=l<4?n[2]:s[2];c[0]=o[0]*u+o[4]*h+o[8]*p+o[12],c[1]=o[1]*u+o[5]*h+o[9]*p+o[13],c[2]=o[2]*u+o[6]*h+o[10]*p+o[14],c[3]=o[3]*u+o[7]*h+o[11]*p+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[oY[l][0]],u=this._clipPosition[oY[l][1]],h=this._clipPosition[oY[l][2]],p=this._clipTriangle(c,u,h);let f=!0;for(let g=0;g<p.length;++g)if(p[g][3]>=2){f=!1;break}if(!f){a=!0;for(let g=0;g<p.length;++g){const y=p[g][3];Number.isFinite(y)&&(e.near=Math.min(y,e.near),e.far=Math.max(y,e.far))}}}return a}_inside(e,r){return r===0?e[0]>=-e[3]:r===1?e[1]>=-e[3]:r===2?e[0]<=e[3]:r===3?e[1]<=e[3]:void _t(!1)}_intersect(e,r,i){let n=0;return i===0?n=(-e[3]-e[0])/(r[0]-e[0]+r[3]-e[3]):i===1?n=(-e[3]-e[1])/(r[1]-e[1]+r[3]-e[3]):i===2?n=(e[3]-e[0])/(r[0]-e[0]-r[3]+e[3]):i===3&&(n=(e[3]-e[1])/(r[1]-e[1]-r[3]+e[3])),NB(tr(),e,r,n)}_clipTriangle(e,r,i){let n=[e,r,i];for(let s=0;s<4;++s){const o=n;n=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,s)?(this._inside(l,s)||n.push(this._intersect(l,c,s)),n.push(c)):this._inside(l,s)&&n.push(this._intersect(l,c,s))}}return n}};const oY=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Gl=hs(),K5t=xe(),Od=XN(),HE=new Z5t,eFt=new J5t,Kte=new Q5t;let tFt=class{},rFt=class extends Li{constructor(){super(...arguments),this.textures=new tFt}};function iFt(){const t=new Fr;return t.attributes.add(R.POSITION,"vec2"),t.vertex.uniforms.add(new Or("drawPosition",(e,r)=>nFt(e,r))),t.varyings.add("vUV","vec2"),t.vertex.code.add(T`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new ft("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new ft("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new ft("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new Qg("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new Qg("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(T`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function nFt(t,e){const r=e.camera.pixelRatio,i=t.magnifier.offset.x*r,n=t.magnifier.offset.y*r;$f(t.magnifier.position,vwe);const s=e.camera.screenToRender(vwe,sFt),o=Math.ceil(r*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return pn(oFt,(s[0]+i)/a*2-1,(s[1]-n)/l*2-1,o/a*2,o/l*2)}const vwe=Sn(),sFt=J3e(),oFt=tr();async function aFt(t){const e=re(()=>import("./mask-svg-cNit2NTT.js"),__vite__mapDeps([])),r=re(()=>import("./overlay-svg-DioSRl-7.js"),__vite__mapDeps([])),i=y_((await e).default,{signal:t}),n=y_((await r).default,{signal:t}),s={mask:await i,overlay:await n};return dt(t),s}let EC=class extends Pe{constructor(){super(...arguments),this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new rFt,this.events=new Xn,this.attributeLocations=new Map([[R.POSITION,0]]),this._tmpScreenPoint=Sn(),this._tmpRenderPoint=J3e()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const r=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this.addHandles(pe(()=>{var i;return(i=this._magnifier)==null?void 0:i.version},r)),r()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,r){const i=this._validMagnifier;if(i==null)return;const n=r.camera.pixelRatio,s=Math.ceil(n*i.size);if(this._updateResources(e,s),this._resources==null)return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*s);o.input.resize(a,a),$f(i.position,this._tmpScreenPoint);const l=r.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=r.camera.fullWidth,u=r.camera.fullHeight,h=.5*a,p=.5*a;l[0]=we(l[0],h,c-h-1),l[1]=we(l[1],p,u-p-1);const f=Math.floor(l[0]-h),g=Math.floor(l[1]-p),y=this._resources.program;y.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,f,g,a,a,0),this._passParameters.magnifier=i,e.useProgram(y),y.bindPass(this._passParameters,r),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(dr.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const r=e.maskUrl,i=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===r&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:r,overlayUrl:i,task:b_(async n=>{const s=r==null||i==null?aFt(n):null,o=r!=null?y_(r,{signal:n}):s.then(l=>l.mask),a=i!=null?y_(i,{signal:n}):s.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,r){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==r){const n=this._createTextureResources(e,r);if(n==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=n}return}const i=this._createTextureResources(e,r);i!=null&&(this._resources={program:this._createProgram(e),vao:Sy(e,sae,this.attributeLocations,0,1),pipelineState:Bt({blending:qu(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:rr})},this._passParameters.textures=i)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,r){if(this._imageSources==null)return null;this._imageSources.overlay.width=r,this._imageSources.overlay.height=r,this._imageSources.mask.width=r,this._imageSources.mask.height=r;const i=new ui;i.internalFormat=Ot.RGBA,i.wrapMode=nr.CLAMP_TO_EDGE,i.flipped=!0,i.preMultiplyAlpha=!HCe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const n=new Mr(e,i,this._imageSources.overlay);i.pixelFormat=i.internalFormat=Ot.ALPHA,i.preMultiplyAlpha=!1;const s=new Mr(e,i,this._imageSources.mask);return i.pixelFormat=i.internalFormat=Ot.RGBA,i.flipped=!1,{input:new Mr(e,i),mask:s,overlay:n,size:r}}_createProgram(e){return new Br(e,iFt(),this.attributeLocations)}};d([m()],EC.prototype,"_imageSources",void 0),d([m()],EC.prototype,"_imageLoadTask",void 0),d([m({readOnly:!0})],EC.prototype,"updating",null),EC=d([F("esri/views/3d/webgl-engine/lib/MagnifierHelper")],EC);let lFt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new dl(new ArrayBuffer(4)),this._layerToOidToColor=new Hb,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Hb,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,i,n,s,o=null,a=null,l=null){e&&r&&i&&n&&(this._layerUidToId.set(n,i),this._layerUidToPopupEnabled.set(n,s),s&&this._layerUidToGraphicsUidToObjectId.set(n,r,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l}))}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return Xt(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){var o;if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(r===void 0)return K.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(r===!1)return this.colorZero;const i=(o=this._layerUidToGraphicsUidToObjectId.get(e.layerUid,e.graphicUid))==null?void 0:o.objectId;if(!i)return this.colorZero;let n=this._layerToOidToColor.get(e.layerUid,i);if(!n){for(;!n;){const a=Math.floor(16777214*Math.random())+1;this._colorToUID.has(a)||(n=a)}if(n>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerUid,i,n),this._colorToUID.set(n,e)}const s=new ArrayBuffer(4);return new DataView(s).setUint32(0,n,!1),new dl(s)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,i]of this._colorToUID.entries()){const n=this._layerUidToGraphicsUidToObjectId.get(i.layerUid,i.graphicUid);n||K.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid);const s=this._layerUidToId.get(i.layerUid);s||K.getLogger(this).warn("no layerId found for uid "+i.layerUid),n&&s&&e.set(r,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:s,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:s})}return e}},Qze=class{constructor(e,r){this.key=e,this.free=r,this.incarnation=0,this._refCount=1}retain(){++this._refCount}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this.free(),!0))}};var TA;(function(t){t[t.FBO=0]="FBO",t[t.DEPTH=1]="DEPTH",t[t.COLOR=2]="COLOR"})(TA||(TA={}));let Kze=class extends Qze{constructor(e,r,i){super(e,i),this.attachment=r,this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}},cFt=class extends Kze{constructor(e,r,i){super(e,r,i),this.attachment=r,this.type=TA.COLOR}},bwe=class extends Kze{constructor(){super(...arguments),this.type=TA.DEPTH}},uFt=class extends Qze{constructor(e,r,i,n,s,o){super(e,o),this.type=TA.FBO,this._colors=new Map,this._name="composite-color",this.acquireDepth=null,this.acquireColor=null,this._name=r,this.fbo=i,this.acquireDepth=n,this.acquireColor=s}dispose(){this.fbo.dispose()}get usedMemory(){return this.fbo.usedMemory}get name(){return this._name}setName(e){this._name=e}getTexture(e=Vl.COLOR_ATTACHMENT0){var r,i;return e===cA?(r=this.fbo)==null?void 0:r.depthStencilTexture:(i=this.fbo)==null?void 0:i.getColorTexture(e)}getAttachment(e=Vl.COLOR_ATTACHMENT0){return e===cA?this._depth:this._colors.get(e)}attachDepth(e){return e==null||e.retain(),this.detachDepth(),e&&this.fbo.attachDepthStencil(e.attachment),this._depth=e,this}detachDepth(){this.fbo.detachDepthStencilTexture(),this.fbo.detachDepthStencilBuffer(),this._depth=lr(this._depth)}attachColor(e,r){return e.retain(),this.detachColor(r),this.fbo.attachColorTexture(e.attachment,r),this._colors.set(r,e),this}detachColor(e){this.fbo.detachColorTexture(e);const r=this._colors.get(e);this._colors.delete(e),r==null||r.release()}detachAll(){this._colors.forEach((e,r)=>this.detachColor(r)),this.detachDepth()}},aY=class{constructor(e,r){this._last=new jt,this._incarnation=0,this._cache=new jN(e,r)}destroy(){var e;(e=this._last)==null||e.forAll(r=>r.dispose()),this._last=null,this._cache.destroy()}set interactive(e){var r;e&&!this._last?this._last=new jt:e||((r=this._last)==null||r.forAll(i=>i.dispose()),this._last=null)}clean(){var e;(e=this._last)==null||e.filterInPlace(r=>!(r.incarnation<this._incarnation)||(this._cache.put(r.key,r),!1))}frame(){++this._incarnation}pop(e){if(this._last){const r=this._last.find(i=>i.key===e);if(r)return this._last.removeUnordered(r),r}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){var e;return((e=this._last)==null?void 0:e.reduce((r,i)=>r+i.usedMemory,0))??0}},hFt=class{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new aY(e.newCache,"FBOCache"),this._depthCache=new aY(e.newCache,"DepthAttachmentCache"),this._colorCache=new aY(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback&&this.debugCallback()}frameEnd(){const e=this.debugCallback;e&&this._acquired.forEach(r=>r.type===TA.FBO&&e(r.name,r.fbo))}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,r)=>{var i;return e+("getTexture"in r?((i=r.getTexture())==null?void 0:i.usedMemory)??0:r.usedMemory)},this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,r,i,n=tn.RGBA){const s=lY(n,e,r);let o=this._cache.pop(s);return o?(o.retain(),o.setName(i)):o=new uFt(s,i,new xm(this.rctx,{...wwe[n],width:e,height:r}),a=>{a??(a=Ra.DEPTH_STENCIL_TEXTURE);const l=this._acquireDepth(a,o.fbo.width,o.fbo.height,`${o.name} depth`);return o.attachDepth(l),l.release(),o},(a,l)=>{l??(l=tn.RGBA);const c=this._acquireColor(l,e,r,`${o.name} color ${a}`);return o.attachColor(c,a),c.release(),o},()=>{this.debugCallback&&this.debugCallback(o.name,o.fbo),this._acquired.delete(o),o.detachAll(),this._cache.put(o)}),this._trackHandle(o)}acquireDepth(e,r,i,n){return this._acquireDepth(e,r,i,n)}_acquireDepth(e,r,i,n){const s=lY(e,r,i),o=this._depthCache.pop(s);if(o)return o.retain(),o.name=n,this._trackHandle(o);const a=e===Ra.DEPTH_STENCIL_TEXTURE?new bwe(s,new Mr(this.rctx,{...xwe[e],width:r,height:i}),()=>{this._acquired.delete(a),this._depthCache.put(a)}):new bwe(s,new EDe(this.rctx,{...xwe[e],width:r,height:i}),()=>{this._acquired.delete(a),this._depthCache.put(a)});return a.name=n,this._trackHandle(a)}_acquireColor(e,r,i,n){const s=lY(e,r,i),o=this._colorCache.pop(s);if(o)return o.retain(),o.name=n,this._trackHandle(o);const a=new cFt(s,new Mr(this.rctx,{...wwe[e],width:r,height:i}),()=>{this._acquired.delete(a),this._colorCache.put(a)});return a.name=n,this._trackHandle(a)}_trackHandle(e){return this._acquired.add(e),e}};function lY(t,e,r){return`${t}x${e}x${r}`}const k8=new ui;k8.pixelFormat=Ot.RED,k8.internalFormat=at.R8,k8.wrapMode=nr.CLAMP_TO_EDGE;const U8=new ui;U8.pixelFormat=Ot.RG,U8.internalFormat=at.RG8,U8.wrapMode=nr.CLAMP_TO_EDGE;const z8=new ui;z8.internalFormat=at.RGBA4,z8.dataType=Ks.UNSIGNED_SHORT_4_4_4_4,z8.wrapMode=nr.CLAMP_TO_EDGE;const e9e=new ui;e9e.wrapMode=nr.CLAMP_TO_EDGE;const I$=new ui;I$.wrapMode=nr.CLAMP_TO_EDGE,I$.samplingMode=Kt.LINEAR_MIPMAP_LINEAR,I$.hasMipmap=!0,I$.maxAnisotropy=8;const L$=new ui;L$.pixelFormat=Ot.RED,L$.dataType=Ks.HALF_FLOAT,L$.internalFormat=at.R16F,L$.samplingMode=Kt.NEAREST;const V8=new ui;V8.dataType=Ks.HALF_FLOAT,V8.internalFormat=at.RGBA16F,V8.samplingMode=Kt.NEAREST;const wwe={[tn.RED]:k8,[tn.RG]:U8,[tn.RGBA4]:z8,[tn.RGBA]:e9e,[tn.RGBA_MIPMAP]:I$,[tn.R16F]:L$,[tn.RGBA16F]:V8},D$=new ui;D$.pixelFormat=Ot.DEPTH_STENCIL,D$.dataType=Ks.UNSIGNED_INT_24_8,D$.samplingMode=Kt.NEAREST,D$.wrapMode=nr.CLAMP_TO_EDGE;const xwe={[Ra.DEPTH_STENCIL_TEXTURE]:D$,[Ra.DEPTH16_BUFFER]:new TDe(Ia.DEPTH_COMPONENT16,4)};var FD;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(FD||(FD={}));let E1=class{constructor(e,r,i=FD.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new jt({initialSize:32,allocator:n=>n||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,r,i,n){const s=this._draws.pushNew();s.geometry=r,s.geometryRanges=i,s.material=e,s.depthSquaredHint=n,s.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}prepare(e,r){return this._draws.map(i=>i.material.prepareTechnique(this._techniqueRepository,e,r,i.geometry.parameters))}dispatch(e,r,i){const n=this._rctx;this._previouslyBoundDraw.clear();let s=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=i[a];l===s&&l.configuration.transparencyPassType===vt.NONE||(n.bindTechnique(l,r,e),s=l);const c=this._draws.data[a],u=c.geometry;n.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,e),this._previouslyBoundDraw.set(l,c.material));const h=c.geometryRanges,p=h.length;if(c.indexType!==0){const f=B8.get(c.indexType);for(let g=0;g<p;g+=2){const y=h[g],v=h[g+1];n.drawElements(u.primitiveType,v,c.indexType,y*f)}}else for(let f=0;f<p;f+=2){const g=h[f],y=h[f+1];n.drawArrays(u.primitiveType,g,y)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===FD.FrontToBack?1:-1;this._draws.sort((r,i)=>{const n=e*(r.depthSquaredHint-i.depthSquaredHint);return n!==0?n:r.geometry.vao.byteSize-i.geometry.vao.byteSize})}get count(){return this._draws.length}};const B8=new Map;B8.set(et.UNSIGNED_BYTE,1),B8.set(et.UNSIGNED_SHORT,2),B8.set(et.UNSIGNED_INT,4);let ere=class extends Ymt{constructor(){super({}),this._passes=null,this.produces=new Map([[de.OPAQUE_MATERIAL,e=>this._produces(e)],[de.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[de.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new axt,this._shadowPassParameters=new lxt,this._highlightPassParameters=new cxt,this._systems=new Set}initializeRenderContext(e){this._context=e;const r=e.renderContext.rctx,i=e.techniqueRepository;this._passes={materialOpaque:new E1(r,i),materialTransparent:new E1(r,i,FD.BackToFront),materialIntegratedMesh:new E1(r,i),shadowMap:new E1(r,i),highlight:new E1(r,i),highlightIntegratedMesh:new E1(r,i),highlightShadowMap:new E1(r,i),defaultShadowMap:new E1(r,i)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return this._systems.size!==0&&this._passes!==null&&(e===G.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==G.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!==null){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,e.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this._context.techniqueRepository.frameUpdate()}}prepareTechniques(e){if(this._systems.size===0)return null;const r=e.output===G.Shadow||e.output===G.ShadowHighlight||e.output===G.ShadowExcludeHighlight?this._shadowPassParameters:e.output===G.Highlight?this._highlightPassParameters:this._materialPassParameters,i=e.bindParameters;return this._updateParameters(i.camera,r,i.slot===de.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,(n,s)=>n.prepare(s,e.bindParameters))}renderNode(e,r){this._invoke(e,(i,n)=>i.dispatch(n,e.bindParameters,r))}_invoke(e,r){if(this._passes===null)return null;switch(e.bindParameters.slot){case de.OPAQUE_MATERIAL:switch(e.output){case G.Color:case G.LinearDepth:case G.Normal:case G.ObjectAndLayerIdColor:return r(this._passes.materialOpaque,this._materialPassParameters);case G.Highlight:return r(this._passes.highlight,this._highlightPassParameters);case G.Shadow:return r(this._passes.shadowMap,this._shadowPassParameters);case G.ShadowHighlight:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case G.ShadowExcludeHighlight:return r(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case de.TRANSPARENT_MATERIAL:switch(e.output){case G.Color:case G.Alpha:case G.LinearDepth:case G.Normal:case G.ObjectAndLayerIdColor:return r(this._passes.materialTransparent,this._materialPassParameters)}break;case de.INTEGRATED_MESH:switch(e.output){case G.Color:case G.LinearDepth:case G.Normal:case G.ObjectAndLayerIdColor:return r(this._passes.materialIntegratedMesh,this._materialPassParameters);case G.Highlight:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const r=new Fce;return this._systems.forEach(i=>SA(r,i.queryShadowCasterDepthRange(e))),r}_updateParameters(e,r,i){const n=e.viewInverseTransposeMatrix;se(cY,n[3],n[7],n[11]),uY.set(cY),he(r.transformWorldFromViewTH,uY.high),he(r.transformWorldFromViewTL,uY.low),he(r.slicePlaneLocalOrigin,cY),jh(r.transformViewFromCameraRelativeRS,e.viewMatrix),cs(r.transformProjFromView,e.projectionMatrix),r.identifier===Cu.Material&&(this._materialPassParameters.transparent=i,hp(Swe,r.transformViewFromCameraRelativeRS),x2(r.transformNormalViewFromGlobal,Swe))}};ere=d([F("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],ere);const cY=C(),Swe=gi(),uY=new RG;let dFt=class{constructor(e){this._context=e,this._nodes=new jt}destroy(){this._nodes.forEach(e=>e.destroy()),this._nodes.clear()}add(e){this._nodes.push(e),c9&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:r})=>r).join(", ")}`)}remove(e){this._nodes.remove(e),c9&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:r})=>r).join(", ")}`)}produces(e){return this._nodes.some(({produces:r})=>r===e)}require(e,r){return this._nodes.reduce((i,{consumes:n,produces:s})=>i+(n.required.includes(e)&&s===r?1:0),0)}optional(e,r){return this._nodes.reduce((i,{consumes:n,produces:s})=>{var o;return i+((o=n.optional)!=null&&o.includes(e)&&s===r?1:0)},0)}updateAnimation(){return this._nodes.reduce((e,r)=>r.updateAnimation()||e,!1)}render(e,r,i){const n=e.name,s=this._nodes.filter(({produces:o})=>o===n);return s.length===0||(s.forEach(o=>{const a=[e];for(const l of o.consumes.required){if(l===n)continue;const c=r.get(l);if(!c)return void i(a);a.push(c)}if(o.consumes.optional)for(const l of o.consumes.optional){if(l===n)continue;const c=r.get(l);c&&a.push(c)}try{const l=o.doRender(a,this._context);l&&l!==e&&(e.release(),e=l,r.set(n,e))}catch(l){K.getLogger(o).errorOnce(l)}i(a)}),this._context.rctx.enforceState()),e}},pFt=class{constructor(e){this._context=e,this._renderPlugins=new jt,this._slots=new Array,this._renderVersion=Zg(0);for(let r=0;r<de.MAX_SLOTS;++r)this._slots[r]=[]}destroy(){this._renderPlugins.forEach(e=>e.destroy()),this._renderPlugins.clear()}get plugins(){return this._renderPlugins}add(e,r){const i=()=>{if(r!=null&&r.aborted)throw e.uninitializeRenderContext(),gr();this._renderPlugins.push(e),e.produces.forEach((s,o)=>{this._slots[o].push(e)}),this._context.requestRender(),this._renderVersion.value++},n=e.initializeRenderContext(this._context,r);if(Xu(n))return n.then(i);i()}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==e);e.uninitializeRenderContext(),this._context.requestRender(),this._renderVersion.value++}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(e)||r)}),r}renderFeatureChanged(){this._renderPlugins.forAll(e=>{e.renderFeatureChanged&&e.renderFeatureChanged()})}prepare(e){this._context.renderContext.bindParameters.slot=e,this._slots[e].forEach(r=>{const i=r.produces.get(e);i&&i(G.Color)&&(vee(r)&&r.prepareTechnique(this._context.renderContext),sye(r)&&r.prepareTechniques(this._context.renderContext))})}_getRenderables(e){this._context.renderContext.bindParameters.slot=e;const r=this._context.renderContext.output??G.Color,i=new Map;return this._slots[e].forEach(n=>{const s=n.produces.get(e);if(s&&s(r)&&(!n.isDecoration||this._context.renderContext.bindParameters.decorations!==Ac.OFF))if(vee(n)){const o=n.prepareTechnique(this._context.renderContext);o!=null&&i.set(n,o)}else if(sye(n)){const o=n.prepareTechniques(this._context.renderContext);o!=null&&i.set(n,o)}else i.set(n,null)}),i}render(e,r=null,i=null){return this._getRenderables(e).forEach((n,s)=>i=s.renderNode(this._context.renderContext,n,r,i)),i}queryDepthRange(e){const r=new Fce;return this._renderPlugins.forAll(i=>{var s;const n=(s=i.queryDepthRange)==null?void 0:s.call(i,e);SA(r,n)}),r}get updating(){return this._renderVersion.value>=0&&this._renderPlugins.some(e=>e.running)}produces(e,r=G.Color){return this._slots[e].some(i=>{const n=i.produces.get(e);return!!n&&n(r)})}consumes(e){return this._renderPlugins.some(r=>r.consumes().required.includes(e))}getMaterialRenderer(e){return this._renderPlugins.find(r=>r.materialReference===e)}removeEmptyMaterialRenderers(){this._renderPlugins.filterInPlace(e=>!e.materialReference||e.numGeometries!==0||(e.destroy(),!1))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get hasOccludees(){return this._renderPlugins.some(e=>e.hasOccludees)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,r)=>e|r.renderOccludedFlags,Wr.None)}get usedMemory(){return this._renderPlugins.reduce((e,r)=>r.materialReference!==null?e:e+(r.usedMemory??0),0)}get test(){return{plugins:this._renderPlugins}}},CC=class extends R2{constructor(e){super(e),this._context=null,this.opacity=1,this.alphaMode=tl.None,this._blitConfiguration=new vV,this._blitParameters=new $G,this.produces=new Map([[de.BLIT,()=>this._context!=null]])}consumes(){return uNe}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){this._context=null}destroy(){}renderNode(e,r,i,n){var a;const s=(a=i==null?void 0:i.get("composite-color"))==null?void 0:a.getTexture();if(!this._context||!s)return n;const o=this._context.techniqueRepository.acquire(Vce,this._blitConfiguration);return o!=null&&o.compiled?(e.rctx.bindFramebuffer(n==null?void 0:n.fbo),this._blitParameters.texture=s,this._blitParameters.opacity=this.opacity,e.rctx.bindTechnique(o,e.bindParameters,this._blitParameters),e.rctx.screen.draw(),o.release(),n):(this._context.requestRender(),n)}};d([m()],CC.prototype,"_context",void 0),d([m()],CC.prototype,"opacity",void 0),d([m()],CC.prototype,"alphaMode",void 0),CC=d([F("esri.views.3d.webgl-engine.effects.blit.Blit")],CC);let jce=class extends Li{};function t9e(){const t=new Fr,{outputs:e,fragment:r}=t;return t.include(gl),r.uniforms.add(new Kd("textureInput",i=>i.input)),r.constants.add("sampleArea","int",Math.ceil(kD/2)),e.add("fragGrid","vec2"),r.code.add(T`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${T.int(gf)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -sampleArea; x < cellSize + sampleArea; x += 2) {
        for(int y = -sampleArea; y < cellSize + sampleArea; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`),t}const gf=32,kD=9,Hce=.4,fFt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:jce,blurSize:Hce,build:t9e,gridCellPixelSize:gf,outlineSize:kD},Symbol.toStringTag,{value:"Module"}));function r9e(){const t=new Fr,{vertex:e,fragment:r}=t,i=e.code,n=r.code;return t.attributes.add(R.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(R.UV0,"vec2"),e.uniforms.add(new ft("coverageTex",s=>s.coverageTexture),new ci("coverageRounding",s=>s.coverageRounding)),i.add(T`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new ft("tex",s=>s.blurTexture),new ft("highlightTexture",s=>s.highlightTexture),new Or("uColor",s=>s.color),new Or("haloColor",s=>s.haloColor),new Or("opacities",s=>pn(mFt,s.haloOpacity,s.haloOpacityOccluded,s.fillOpacity,s.fillOpacityOccluded))),r.constants.add("inner","float",1-(kD-Hce)/kD),n.add(T`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const mFt=tr(),gFt=Object.freeze(Object.defineProperty({__proto__:null,build:r9e},Symbol.toStringTag,{value:"Module"}));let i9e=class n9e extends Zr{initializeProgram(e){return new Br(e.rctx,n9e.shader.get().build(),Nr)}initializePipeline(){return Bt({blending:ya(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:rr})}};i9e.shader=new Vr(gFt,()=>re(()=>Promise.resolve().then(()=>Wjt),void 0));let qce=class extends Li{constructor(){super(...arguments),this.blurSize=Ye()}};function s9e(){const t=new Fr,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(R.POSITION,"vec2"),e.add(R.UV0,"vec2"),r.add("blurCoordinate","vec3"),i.uniforms.add(new ft("coverageTex",s=>s.coverageTexture),new ci("coverageRounding",s=>s.coverageRounding)),i.code.add(T`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`),n.uniforms.add(new N5e("blurSize",s=>s.blurSize),new Kd("tex",s=>s.blurInputTexture)),n.code.add(T`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const yFt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:qce,build:s9e},Symbol.toStringTag,{value:"Module"}));let o9e=class a9e extends Zr{initializeProgram(e){return new Br(e.rctx,a9e.shader.get().build(),Nr)}initializePipeline(){return Bt({colorWrite:rr})}};o9e.shader=new Vr(yFt,()=>re(()=>Promise.resolve().then(()=>Yjt),void 0));let l9e=class c9e extends Zr{initializeProgram(e){return new Br(e.rctx,c9e.shader.get().build(),Nr)}initializePipeline(){return Bt({colorWrite:rr})}};l9e.shader=new Vr(fFt,()=>re(()=>Promise.resolve().then(()=>Xjt),void 0));let _Ft=class extends Li{constructor(){super(...arguments),this.color=Xt(1,0,1,1),this.haloColor=Xt(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.coverageRounding=mr(1,1)}},N$=class extends R2{constructor(e){super(e),this._context=null,this._passParameters=new _Ft,this._downsampleDrawParameters=new jce,this._blurDrawParameters=new qce,this._blurColorFormat=ne("mac")?tn.RGBA:tn.RGBA4,this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0},this.produces=new Map([[de.HIGHLIGHT,()=>!0]])}consumes(){return hNe}initializeRenderContext(e){this._context=e,this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(o9e)),this._downsampleTechnique==null&&(this._downsampleTechnique=this._context.techniqueRepository.acquire(l9e)),this._applyTechnique==null&&(this._applyTechnique=this._context.techniqueRepository.acquire(i9e)),this.addHandles([pe(()=>this.view.highlightOptions.color,r=>{this._passParameters.color=dD(r??fUe),this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color),this._context.requestRender()},li),pe(()=>this.view.highlightOptions.haloColor,r=>{this._passParameters.haloColor=r!=null?dD(r):this._passParameters.color,this._context.requestRender()},li),pe(()=>this.view.highlightOptions.haloOpacity,r=>{this._passParameters.haloOpacity=r??mUe,this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity,this._context.requestRender()},li),pe(()=>this.view.highlightOptions.fillOpacity,r=>{this._passParameters.fillOpacity=r??gUe,this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity,this._context.requestRender()},li)])}uninitializeRenderContext(){this._context=null}dispose(){this._blurTechnique=lr(this._blurTechnique),this._downsampleTechnique=lr(this._downsampleTechnique),this._applyTechnique=lr(this._applyTechnique),this._grid.coverage=lr(this._grid.coverage),this._grid.vao=wt(this._grid.vao)}renderNode(e,r,i,n){var S,E;const s=(S=i==null?void 0:i.get("highlights"))==null?void 0:S.getTexture();if(!this._context||!s)return;if(!(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled))return void this._context.requestRender();const o=e.bindParameters.camera,a=o.fullWidth,l=o.fullHeight,c=o.pixelRatio,u=Math.ceil(a/c),h=Math.ceil(l/c),p=this._context.fbos,f=p.rctx;this._gridUpdateResources(s),this._gridComputeCoverage(s,e.bindParameters),this._passParameters.highlightTexture=s,this._passParameters.coverageTexture=(E=this._grid.coverage)==null?void 0:E.getTexture();const{width:g,height:y}=s.descriptor;yr(this._passParameters.coverageRounding,g/(Math.ceil(g/gf)*gf),y/(Math.ceil(y/gf)*gf));const v=this._grid.vao;f.bindVAO(v);const b=p.acquire(u,h,"highlight blur",this._blurColorFormat);f.unbindTexture(b.fbo.colorTexture),f.bindFramebuffer(b.fbo),f.setClearColor(0,0,0,0),f.clearSafe(Mi.COLOR_BUFFER_BIT),f.setViewport(0,0,u,h),this._blurDrawParameters.blurInputTexture=s,yr(this._blurDrawParameters.blurSize,1/u,0);const w=f.bindTechnique(this._blurTechnique,e.bindParameters,this._passParameters,this._blurDrawParameters);f.drawArrays(this._blurTechnique.primitiveType,0,q0(v,"geometry"));const x=p.acquire(u,h,"highlight blur",this._blurColorFormat);f.unbindTexture(x.fbo.colorTexture),f.bindFramebuffer(x.fbo),f.setClearColor(0,0,0,0),f.clearSafe(Mi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=b.getTexture(),yr(this._blurDrawParameters.blurSize,0,1/h),w.bindDraw(this._blurDrawParameters,e.bindParameters,this._passParameters),f.drawArrays(this._blurTechnique.primitiveType,0,q0(v,"geometry")),f.bindFramebuffer(n==null?void 0:n.fbo),f.setViewport4fv(o.fullViewport),this._passParameters.blurTexture=x.getTexture(),f.bindTechnique(this._applyTechnique,e.bindParameters,this._passParameters),f.drawArrays(this._applyTechnique.primitiveType,0,q0(v,"geometry")),b.release(),x.release()}_gridUpdateResources(e){var p;if(!this._context)return;const r=this._context.fbos.rctx,i=this._grid,n=Math.ceil(e.descriptor.height/gf),s=Math.ceil(e.descriptor.width/gf);if(i.vao&&i.verticalCellCount===n&&i.horizontalCellCount===s)return;i.verticalCellCount=n,i.horizontalCellCount=s;const o=n+1,a=s+1,l=1/n,c=1/s,u=new Float32Array(6*4*o*a);let h=0;for(let f=0;f<o;f++)for(let g=0;g<a;g++)u[h++]=(g-.5)*c*2-1,u[h++]=(f-.5)*l*2-1,u[h++]=g*c,u[h++]=f*l,u[h++]=(g+.5)*c*2-1,u[h++]=(f-.5)*l*2-1,u[h++]=g*c,u[h++]=f*l,u[h++]=(g-.5)*c*2-1,u[h++]=(f+.5)*l*2-1,u[h++]=g*c,u[h++]=f*l,u[h++]=(g-.5)*c*2-1,u[h++]=(f+.5)*l*2-1,u[h++]=g*c,u[h++]=f*l,u[h++]=(g+.5)*c*2-1,u[h++]=(f-.5)*l*2-1,u[h++]=g*c,u[h++]=f*l,u[h++]=(g+.5)*c*2-1,u[h++]=(f+.5)*l*2-1,u[h++]=g*c,u[h++]=f*l;(p=i.vao)==null||p.dispose(),i.vao=new wm(r,Nr,{geometry:ON},{geometry:ti.createVertex(r,Lr.STATIC_DRAW,u)})}_gridComputeCoverage(e,r){var l;if(!this._context)return;const i=this._context.fbos.rctx,n=this._grid,s=e.descriptor,o=Math.ceil(s.width/gf),a=Math.ceil(s.height/gf);this._downsampleDrawParameters.input=e,(l=n.coverage)==null||l.release(),n.coverage=this._context.fbos.acquire(o,a,"highlight coverage",tn.RG),i.unbindTexture(n.coverage.fbo.colorTexture),i.bindFramebuffer(n.coverage.fbo),i.bindTechnique(this._downsampleTechnique,r,this._passParameters,this._downsampleDrawParameters),i.setViewport(0,0,o,a),i.screen.draw()}get test(){return{coverage:this._grid.coverage}}};d([m()],N$.prototype,"_context",void 0),d([m()],N$.prototype,"view",void 0),N$=d([F("esri.views.3d.webgl-engine.effects.highlight.Highlight")],N$);let Wce=class extends jc{constructor(){super(...arguments),this.receiveShadows=!0}};d([H()],Wce.prototype,"receiveShadows",void 0);const vFt=.99999,bFt=.025;function u9e(t){const e=new Fr;e.include(VN,t),e.include(mG),e.include(gl);const r=e.fragment;return r.include(bp),r.include(dy),r.uniforms.add(new ft("defaultDepthTex",(i,n)=>n.shadowMap.getSnapshot(l2.ExcludeHighlight)),new ft("highlightDepthTex",(i,n)=>n.shadowMap.getSnapshot(l2.Highlight)),new ft("depthMap",(i,n)=>{var s;return(s=n.linearDepth)==null?void 0:s.getTexture()}),new ft("highlightTexture",i=>i.highlight),new Or("uColor",i=>i.shadowColor),new ci("nearFar",(i,n)=>n.camera.nearFar),new Ie("opacity",i=>i.shadowOpacity),new Ie("occludedOpacity",i=>i.occludedShadowOpacity),new Ie("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new zt("lightingMainDirectionView",(i,n)=>me(Ewe,ze(Ewe,n.lighting.mainLight.direction,n.camera.viewInverseTransposeMatrix))),new _n("inverseViewMatrix",(i,n)=>us(Twe,Fc(Twe,n.camera.viewMatrix,n.camera.center)))),r.constants.add("unoccludedHighlightFlag","vec4",ele),r.code.add(T`
    vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, ivec2 iuv) {
      float leftPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(-1, 0), 0), nearFar);
      float rightPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(1, 0), 0), nearFar);
      float bottomPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, -1), 0), nearFar);
      float topPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, 1), 0), nearFar);

      bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
      bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);

      vec3 fragCoordHorizontal = pickLeft
                                  ? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
                                  : vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
      vec3 fragCoordVertical = pickBottom
                                  ? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
                                  : vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);

      vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
      vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);

      vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
      // Flip normal depending on triangle winding order for consistency
      return pickLeft == pickBottom ? normal : -normal;
    }

    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${T.float(vFt)}) {
        discard;
      }

      ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
      float depth = rgba2float(texelFetch(depthMap, iuv, 0));
      // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth == 0.0) {
        discard;
      }

      float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        discard;
      }

      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);
      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;
      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, iuv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${T.float(bFt)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `),e}const Twe=xe(),Ewe=C(),wFt=Object.freeze(Object.defineProperty({__proto__:null,build:u9e},Symbol.toStringTag,{value:"Module"}));let xFt=class extends dle{constructor(){super(...arguments),this.shadowColor=Xt(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},h9e=class d9e extends Zr{constructor(e){super(e,new Wce,()=>this.destroy())}initializeProgram(e){return new Br(e.rctx,d9e.shader.get().build(this.configuration),Nr)}initializePipeline(){return Bt({blending:ya(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:rr,depthTest:null,depthWrite:null})}get primitiveType(){return dr.TRIANGLE_STRIP}};h9e.shader=new Vr(wFt,()=>re(()=>Promise.resolve().then(()=>Zjt),void 0));const SFt=.001953125,TFt=4e4,EFt=5e4;let PC=class extends R2{constructor(e){super(e),this._maxOpacity=1,this._passParameters=new xFt,this._shadowDifference=.2,this._context=null,this.produces=new Map([[de.SHADOW_HIGHLIGHT,()=>this._isVisible]])}consumes(){return hNe}initializeRenderContext(e){this._context=e,this.addHandles([pe(()=>this.view.highlightOptions.shadowOpacity,r=>{this._passParameters.shadowOpacity=r??_Ue,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},li),pe(()=>this.view.highlightOptions.shadowDifference,r=>{this._shadowDifference=r??vUe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},li),pe(()=>this.view.highlightOptions.shadowColor,r=>{this._passParameters.shadowColor=dD(r??yUe),this._updateMaxOpacity()},li)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}uninitializeRenderContext(){this._context=null}enable(){this._context&&this._technique==null&&(this._technique=this._context.techniqueRepository.acquire(h9e))}renderNode(e,r,i,n){var l,c;const s=(l=i==null?void 0:i.get("highlights"))==null?void 0:l.getTexture();if(!this._context||!s||!this._isVisible)return;if(!((c=this._technique)!=null&&c.compiled))return void this._context.requestRender();const o=e.bindParameters;if(!o.shadowMap.enabled||!o.linearDepth)return;this._passParameters.highlight=s,this._passParameters.origin=o.camera.center;const a=e.rctx;a.bindFramebuffer(n==null?void 0:n.fbo),a.bindTechnique(this._technique,o,this._passParameters),a.screen.draw()}updateParameters(e,r){this._passParameters.opacityElevation=1-HL(TFt,EFt,e.relativeElevation);const i=this.viewingMode===Fe.Global?me(Cwe,e.center):se(Cwe,0,0,1),n=fe(i,r);this._passParameters.dayNightTerminator=HL(0,1,we(30*n,0,1)),this._isVisible&&this.enable()}get _isVisible(){const{opacityElevation:e,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*e*r>=SFt}};d([m()],PC.prototype,"_context",void 0),d([m()],PC.prototype,"view",void 0),d([m()],PC.prototype,"viewingMode",void 0),PC=d([F("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],PC);const Cwe=C(),qE={maxSearchSteps:8,maxDistanceAreaTex:16};function p9e(){const t=new Fr;return t.include(gl),t.fragment.uniforms.add(new ft("edgesTexture",e=>e.inputTexture),new ft("areaTexture",e=>e.areaTexture),new ft("searchTexture",e=>e.searchTexture)),t.fragment.code.add(T`
    #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
    #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

    vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
      return texture(tex, coord + offset.x * resolution, 0.0);
    }

    float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture( searchTex, e, 0.0 ).r;
    }

    float searchLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${T.int(qE.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${T.int(qE.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
      return texcoord.x;
    }

    float searchUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${T.int(qE.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
      return texcoord.y;
    }

    float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${T.int(qE.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
      return texcoord.y;
    }

    vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
      vec2 texcoord = float( ${T.int(qE.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
      texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
      texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
      return texture( areaTex, texcoord, 0.0 ).rg;
    }

    void main() {
      vec2 size = vec2(textureSize(edgesTexture, 0));
      vec2 resolution = 1.0 / size;
      vec2 pixelCoord = uv * size;
      vec4 offsets[2];
      offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
      offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
      vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${T.int(qE.maxSearchSteps)} );

      ivec4 subsampleIndices = ivec4(0.0);
      vec4 weights = vec4(0.0);
      vec2 e = texture( edgesTexture, uv ).rg;
      if ( e.g > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.x = searchLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
        coords.y = offsets[1].y;
        d.x = coords.x;
        float e1 = texture( edgesTexture, coords, 0.0 ).r;
        coords.x = searchRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
        d.y = coords.x;
        d = d * size.x - pixelCoord.x;
        vec2 sqrt_d = sqrt( abs(d) );
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
        weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
      }

      if ( e.r > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.y = searchUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
        coords.x = offsets[0].x;
        d.x = coords.y;
        float e1 = texture( edgesTexture, coords, 0.0 ).g;
        coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
        d.y = coords.y;
        d = d * size.y - pixelCoord.y;
        vec2 sqrt_d = sqrt(abs(d));
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
        weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

        // for some reason the following lines are necessary to prevent
        // texture lookup precision issues on some Intel integrated graphics chips
        vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
        weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
      }
      fragColor = weights;
    }`),t}const CFt=Object.freeze(Object.defineProperty({__proto__:null,build:p9e},Symbol.toStringTag,{value:"Module"}));let f9e=class m9e extends Zr{initializeProgram(e){return new Br(e.rctx,m9e.shader.get().build(),Nr)}initializePipeline(){return Bt({colorWrite:rr})}};f9e.shader=new Vr(CFt,()=>re(()=>Promise.resolve().then(()=>Jjt),void 0));function g9e(){const t=new Fr;return t.include(gl),t.fragment.uniforms.add(new ft("blendWeightsTexture",e=>e.inputTexture),new ft("colorTexture",e=>e.color)),t.fragment.code.add(T`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const PFt=Object.freeze(Object.defineProperty({__proto__:null,build:g9e},Symbol.toStringTag,{value:"Module"}));let y9e=class _9e extends Zr{initializeProgram(e){return new Br(e.rctx,_9e.shader.get().build(),Nr)}initializePipeline(){return Bt({colorWrite:rr})}};y9e.shader=new Vr(PFt,()=>re(()=>Promise.resolve().then(()=>Qjt),void 0));const Pwe={threshold:.05,localConstrastAdaption:2};function v9e(){const t=new Fr;return t.include(gl),t.fragment.uniforms.add(new ft("colorTexture",e=>e.color)),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(T`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${T.float(Pwe.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${T.float(Pwe.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `),t}const AFt=Object.freeze(Object.defineProperty({__proto__:null,build:v9e},Symbol.toStringTag,{value:"Module"}));let b9e=class w9e extends Zr{initializeProgram(e){return new Br(e.rctx,w9e.shader.get().build(),Nr)}initializePipeline(){return Bt({colorWrite:rr})}};b9e.shader=new Vr(AFt,()=>re(()=>Promise.resolve().then(()=>Kjt),void 0));let OFt=class extends Li{},sS=class extends R2{constructor(e){super(e),this._context=null,this._areaTexture=null,this._searchTexture=null,this._isEnabled=!1,this._smaaParameters=new OFt,this.produces=new Map([[de.ANTIALIASING,()=>this._isEnabled&&this._context!=null]])}consumes(){return uNe}get updating(){return this._abortController!=null}initializeRenderContext(e){this._context=e,this.addHandles([pe(()=>this.view.qualitySettings.antialiasingEnabled,()=>this.renderFeatureChanged(),li)])}renderFeatureChanged(){var e;this.view.qualitySettings.antialiasingEnabled||(e=this._context)!=null&&e.isFeatureEnabled(Ys.Antialiasing)?this.enable():this.disable()}uninitializeRenderContext(){this.disable(),this._context=null}async enable(){var r;if(this._isEnabled||!this._context||this._abortController)return;if(this._edgeTechnique??(this._edgeTechnique=this._context.techniqueRepository.acquire(b9e)),this._blendTechnique??(this._blendTechnique=this._context.techniqueRepository.acquire(f9e)),this._blurTechnique??(this._blurTechnique=this._context.techniqueRepository.acquire(y9e)),this._areaTexture&&this._searchTexture)return void(this._isEnabled=!0);this._abortController=new AbortController;const e=this._abortController.signal;try{const i=await re(()=>import("./SMAAData-DCEZ61Cs.js"),__vite__mapDeps([]));await this._loadTextures(this._context,i,e),(r=this._context)==null||r.requestRender()}catch{}this._abortController=null}async _loadTextures(e,r,i){if(dt(i),!e)throw gr();const[n,s]=await Promise.allSettled([y_(r.areaTexture,{signal:i}),y_(r.searchTexure,{signal:i})]);dt(i),n.status==="fulfilled"&&s.status==="fulfilled"&&(this._areaTexture=Awe(e.fbos.rctx,Kt.LINEAR,Ot.RGB,n.value),this._searchTexture=Awe(e.fbos.rctx,Kt.NEAREST,Ot.LUMINANCE,s.value),this._isEnabled=!0)}_disposeTextures(){this._areaTexture=wt(this._areaTexture),this._searchTexture=wt(this._searchTexture)}disable(){this._abortController=Ql(this._abortController),this._isEnabled=!1}destroy(){this.disable(),this._disposeTextures()}renderNode(e,r,i,n){var p,f,g,y;const s=(p=i==null?void 0:i.get("composite-color"))==null?void 0:p.getTexture();if(!(this._isEnabled&&this._context&&i&&s))return n;if(!((f=this._edgeTechnique)!=null&&f.compiled&&((g=this._blendTechnique)!=null&&g.compiled)&&((y=this._blurTechnique)!=null&&y.compiled)))return this._context.requestRender(),n;const o=s.descriptor.width,a=s.descriptor.height,l=this._context.fbos,c=e.rctx;c.setViewport(0,0,o,a);const u=l.acquire(o,a,"smaa edges",tn.RG);c.unbindTexture(u.fbo.colorTexture),c.bindFramebuffer(u.fbo),c.setClearColor(0,0,0,1),c.clear(Mi.COLOR_BUFFER_BIT),this._smaaParameters.color=s,c.bindTechnique(this._edgeTechnique,null,this._smaaParameters),c.screen.draw();const h=l.acquire(o,a,"smaa blend");return c.unbindTexture(h.fbo.colorTexture),c.bindFramebuffer(h.fbo),c.setClearColor(0,0,1,1),c.clear(Mi.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=u.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,c.bindTechnique(this._blendTechnique,null,this._smaaParameters),c.screen.draw(),c.bindFramebuffer(n==null?void 0:n.fbo),u.release(),c.setClearColor(0,1,0,1),c.clear(Mi.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=h.getTexture(),c.bindTechnique(this._blurTechnique,null,this._smaaParameters),c.screen.draw(),h.release(),n}};function Awe(t,e,r,i){const n=new ui;return n.pixelFormat=r,n.wrapMode=nr.CLAMP_TO_EDGE,n.width=i.width,n.height=i.height,n.samplingMode=e,new Mr(t,n,i)}d([m()],sS.prototype,"view",void 0),d([m()],sS.prototype,"_context",void 0),d([m()],sS.prototype,"_abortController",void 0),d([m({readOnly:!0})],sS.prototype,"updating",null),sS=d([F("esri.views.3d.webgl-engine.effects.smaa.SMAA")],sS);let MFt=class{constructor(){this._step=Rwe,this._dilation=1,this._firstIdleTime=0}frame(e,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,ne("disable-feature:high-quality-idle"))this._dilation=1;else{const n=r?performance.now()-this._firstIdleTime:0;if(n>=Owe+$Ft)return this._step=1/0,void(this._dilation=1);this._dilation=n>=Owe?IFt:1}const i=we(e/RFt,Rwe,DFt);this._step===1/0?this._step=i:this._step=this._step*Mwe+i*(1-Mwe)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const RFt=.5,Owe=12e4,$Ft=1e4,IFt=10,Mwe=.9,LFt=30,Rwe=1e3/1,DFt=1e3/LFt;let NFt=class{constructor(e,r){this._fbos=e,this.compositingHelper=r,this._width=4,this._height=4,this._clearColor=tr()}dispose(){this._color=lr(this._color),this.releaseBuffers()}get framebuffer(){return this.color.attachDepth(this.depth),this.color.fbo}get colorTexture(){return this.color.getTexture()}get depthTexture(){return this.depth.attachment}initializeFrame(e,r,i){this._fbos.interactive=i===Rf.Default;const n=this._fbos.rctx;this._width=e.fullWidth,this._height=e.fullHeight,QS(this,n.parameters.maxTextureSize);const s=this._color;return this._color=null,this.releaseBuffers(),qd(this._clearColor,r),s}releaseBuffers(){var e;(e=this._color)==null||e.detachDepth(),this._depth=lr(this._depth)}renderHUDVisibility(e,r,i){return(e==null?void 0:e.fbo.width)===this._width&&(e==null?void 0:e.fbo.height)===this._height||(e==null||e.release(),e=this._fbos.acquire(this._width,this._height,"hud visibility",tn.RGBA4)),e.attachDepth(i||this.depth),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(FFt),r(),e.detachDepth(),e}compositeToHUDVisibility(e,r){var i;this._fbos.rctx.bindFramebuffer((i=e.hudVisibility)==null?void 0:i.fbo),this.compositingHelper.compositeHUD(e,r)}renderOITPass(e,r,i){let n,s;const{_width:o,_height:a}=this;switch(r){case vt.Color:n=this._fbos.acquire(o,a,i?"oit hud color":"oit color",tn.RGBA16F),s=[0,0,0,0];break;case vt.Alpha:n=this._fbos.acquire(o,a,i?"oit hud alpha":"oit alpha",tn.R16F),s=[1,1,1,1];break;case vt.FrontFace:n=this._fbos.acquire(o,a,i?"oit hud front":"oit front"),s=[0,0,0,0]}return i?n.acquireDepth(Ra.DEPTH16_BUFFER):n.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(n.fbo),this._fbos.rctx.clearFramebuffer(s,i,i),e(),n.detachDepth(),n}compositeToFramebuffer(e,r,i,n){this.bindFbo(),this.compositingHelper.composite(e,r,i,n)}compositeTransparentOntoOpaque(e,r,i,n,s){s?(this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.setClearColor(0,0,0,1e-13),this._fbos.rctx.clearSafe(Mi.COLOR_BUFFER_BIT)):this.bindFbo(),this.compositingHelper.compositeOIT(e,r.getTexture(),i.getTexture(),n.getTexture())}renderDepthDetached(e){this._bindTarget(this.color),e(),this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,r,i,n,s=tn.RGBA,o=Ra.DEPTH16_BUFFER,a=this._width,l=this._height,c=null){return(e==null?void 0:e.fbo.width)===a&&(e==null?void 0:e.fbo.height)===l||(e=lr(e)),e=e??this._fbos.acquire(a,l,r,s),c==null||c.forEach(u=>e.acquireColor(u.attachment,u.format)),o!=null&&e.acquireDepth(o),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(n,!0,!0),i(),e}renderToTargets(e,r,i,n,s=!1,o=!1){this._bindTarget(r,i),this._fbos.rctx.clearFramebuffer(n,s,o),e(),r.detachDepth()}bindFbo(){const e=this._color==null;if(this._bindTarget(this.color,this.depth),e){const r=this._fbos.rctx;r.setClearStencil(0),r.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),r.clearSafe(Mi.COLOR_BUFFER_BIT|Mi.DEPTH_BUFFER_BIT|Mi.STENCIL_BUFFER_BIT)}}_bindTarget(e,r){e.attachDepth(r),this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._ensureColor()}_ensureColor(){return this._color||(this._color=this._fbos.acquire(this._width,this._height,"composite-color")),this._color}updateColor(e,r){const i=this._ensureColor();i.attachDepth(this.depth),i.setName(r),this._color=e(i)}get depth(){return this._depth||(this._depth=this._fbos.acquireDepth(Ra.DEPTH_STENCIL_TEXTURE,this._width,this._height,"depth")),this._depth}};const FFt=[0,1,0,1],ZN=255,kFt=1/ZN;function x9e(t){const e=new Fr,r=e.fragment;return r.include(bp),r.include(dy),e.include(mG),e.include(gl),e.include(VN,t),r.uniforms.add(new ft("shadowMap",(i,n)=>n.shadowMap.depthTexture),new ft("depthMap",(i,n)=>{var s;return(s=n.linearDepth)==null?void 0:s.getTexture()}),new _n("inverseViewMatrix",(i,n)=>us($we,Fc($we,n.camera.viewMatrix,n.camera.center))),new ci("nearFar",(i,n)=>n.camera.nearFar)),r.constants.add("sampleValue","float",kFt),e.outputs.add("sampleCount","float"),r.code.add(T`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`),e}const $we=xe(),UFt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:ZN,build:x9e},Symbol.toStringTag,{value:"Module"}));var EA;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(EA||(EA={}));let tre=class extends jc{constructor(){super(...arguments),this.visualization=EA.Gradient,this.bandsEnabled=!1}};d([H({count:EA.COUNT})],tre.prototype,"visualization",void 0),d([H()],tre.prototype,"bandsEnabled",void 0);let Yce=class extends Li{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=uN(zFt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const zFt=Xt(.01,0,.25,1);function S9e(t){const e=new Fr,r=e.fragment;r.include(bp),r.include(dy),e.include(mG),e.include(gl);const{visualization:i,bandsEnabled:n}=t;r.constants.add("inverseSampleValue","float",ZN),r.uniforms.add(new ft("shadowCastMap",a=>a.shadowCastMap),new Ie("sampleScale",a=>a.sampleScale),new Ie("opacityFromElevation",a=>a.opacityFromElevation),new Or("uColor",a=>a.color));const s=i===EA.Gradient,o=i===EA.Threshold;return s&&n?r.uniforms.add(new Ie("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new Ie("threshold",a=>a.threshold)),r.code.add(T`
    void main(void) {
      float record = texture(shadowCastMap, uv).r;
      float pixelSamples = record * inverseSampleValue;
      if (pixelSamples < 1.0) {
        discard;
      }

      float strength = pixelSamples * sampleScale;

      ${o?T`
          if (strength <= threshold) {
            discard;
          }`:""}

      ${s&&n?T`strength = ceil(strength / bandSize) * bandSize;`:""}

      fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${s?T`* strength`:""});
    }
  `),e}const VFt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:Yce,build:S9e},Symbol.toStringTag,{value:"Module"}));let T9e=class E9e extends Zr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Br(e.rctx,E9e.shader.get().build(this.configuration),Nr)}initializePipeline(){return Bt({blending:Bh,colorWrite:rr,depthTest:null,depthWrite:null})}get primitiveType(){return dr.TRIANGLE_STRIP}};T9e.shader=new Vr(VFt,()=>re(()=>Promise.resolve().then(()=>eHt),void 0));const BFt=4e4,GFt=5e4,C9e=1/512;let G8=class extends Pe{constructor(e,r,i,n){super({}),this._techniqueRepository=e,this._rctx=r,this._data=i,this._requestRender=n,this._passParameters=new Yce(this._data),this._techniqueConfig=new tre,this._enabled=!1,this._vao=Sy(r)}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=wt(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(T9e,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const r=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(r,e,this._passParameters),this._rctx.drawArrays(r.primitiveType,0,q0(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>C9e}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const r=this._passParameters.color;z3(e,r)||(qd(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};d([m()],G8.prototype,"opacityFromElevation",null),G8=d([F("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],G8);let P9e=class A9e extends Zr{constructor(e){super(e,new Wce,()=>this.destroy())}initializeProgram(e){return new Br(e.rctx,A9e.shader.get().build(this.configuration),Nr)}initializePipeline(){return Bt({blending:ya(Ee.ONE,Ee.ONE,Ee.ONE,Ee.ONE),colorWrite:rr,depthTest:null,depthWrite:null})}get primitiveType(){return dr.TRIANGLE_STRIP}};P9e.shader=new Vr(UFt,()=>re(()=>Promise.resolve().then(()=>tHt),void 0));let bc=class extends Pe{constructor(e,r,i,n,s,o){super({}),this.fbos=e,this._stage=i,this._prepareForShadowMapPass=n,this._renderToShadowMap=s,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new dle,this._cachedLightDirections=[],this._depthRange=Wte,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new q7(new Lle(e,i.viewingMode),null),this._bindParameters.shadowMap.enabled=!0,this._vao=Sy(this._rctx),this._accumulationRenderer=new G8(r,this._rctx,this,o);const a=this._stage.view.resourceController.scheduler;this.addHandles([a.registerTask(Ct.SHADOW_ACCUMULATOR,this),pe(()=>i.renderView,l=>{this.removeHandles(Iwe),l!=null&&this.addHandles(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),Iwe)},li),pe(()=>this._previewing,()=>this._requestRenderIfEnabled(),ei)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=wt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=wt(this._fbo),this._vao=wt(this._vao),this._accumulationTechniqueCached=lr(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new P9e(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){var e;return((e=this._bindParameters.linearDepth)==null?void 0:e.getTexture())!==null&&this._depthRange!==Wte&&this._opacityFromElevation>C9e}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const r=this._cachedLightDirections;if(ny(r,e,HT))return;const i=Math.min(ZN,e.length);r.length=i,this._sampleCount=i;for(let n=0;n<i;++n)r[n]=he(r[n]??C(),e[n]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,r,i,n){if(this._depthRange=r,this._updateCamera(i),this._bindParameters.contentCamera=n,this._bindParameters.linearDepth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(jFt,this._sampleCount-this._progress);for(let o=0;o<s;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const r=this._fbo!=null;e.enabled!==r&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,r){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||r<0||r>=this._fbo.height?0:(this._fbo.readPixels(e,r,1,1,Ot.RED,Ks.UNSIGNED_BYTE,Lwe),Lwe[0]/this._progress)}_enable(){this._progress=0;const e=new ui;e.pixelFormat=Ot.RED,e.internalFormat=at.R8,e.wrapMode=nr.CLAMP_TO_EDGE,this._fbo=new xm(this._rctx,e),this._requestRender()}_disable(){this._fbo=wt(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Mi.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,q0(this._vao,"geometry"))}_updateCamera(e){const r=this._fbo;if(r==null)return;const i=this._bindParameters.camera;e.equals(i)||i.copyFrom(e),r.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-HL(BFt,GFt,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};d([m()],bc.prototype,"_progress",void 0),d([m()],bc.prototype,"_sampleCount",void 0),d([m()],bc.prototype,"_fbo",void 0),d([m()],bc.prototype,"_depthRange",void 0),d([m()],bc.prototype,"_previewing",void 0),d([m()],bc.prototype,"_accumulationRenderer",void 0),d([m()],bc.prototype,"_isRefining",null),d([m()],bc.prototype,"_isActive",null),d([m()],bc.prototype,"canAccumulate",null),d([m()],bc.prototype,"_isDoneAccumulating",null),d([m()],bc.prototype,"_opacityFromElevation",null),d([m()],bc.prototype,"running",null),bc=d([F("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],bc);const jFt=6,Iwe="renderView",Lwe=new Uint8Array(1),Dwe=A_();let HFt=class{constructor(){this._plane=A_()}get isEnabled(){return!PRe(this.plane,Dwe)}get plane(){return this._plane}set plane(e){E2(e||Dwe,this._plane)}};function qFt(t,e){const r=-t[0],i=-t[1],n=-t[2],s=e[3],o=e[7],a=e[11],l=e[15];e[0]+=s*r,e[1]+=s*i,e[2]+=s*n,e[4]+=o*r,e[5]+=o*i,e[6]+=o*n,e[8]+=a*r,e[9]+=a*i,e[10]+=a*n,e[12]+=l*r,e[13]+=l*i,e[14]+=l*n}function WFt(t,e){const r=t[0],i=t[1],n=t[2];e[12]+=r*e[0]+i*e[4]+n*e[8],e[13]+=r*e[1]+i*e[5]+n*e[9],e[14]+=r*e[2]+i*e[6]+n*e[10],e[14]+=r*e[3]+i*e[7]+n*e[11]}let YFt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const r=this._originData.get(e.id)||new XFt(e);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(r=>{cs(r.viewMatrix,e),WFt(r.origin.vec3,r.viewMatrix)})}},XFt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=xe()}},ZFt=class extends qDe{constructor(e,r){super(),this.distanceFalloffFactor=e,this.transparency=r,this.transformNormalViewFromGlobal=gi()}},JFt=class extends WDe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=gi(),this.slicePlaneLocalOrigin=C(),this.transformNormalGlobalFromModel=gi()}};function QFt(t){const e=T`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const KFt=mr(.5,-4e-4);function ekt(t,e){const r=t.vertex;r.include(QFt),r.constants.add("depthBias","vec2",KFt),r.uniforms.add(new ci("inverseViewport",(i,n)=>n.inverseViewport)),e.legacy?(r.uniforms.add(new _n("proj",(i,n)=>n.camera.projectionMatrix)),r.code.add(T`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new Zh("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal),new _n("transformProjFromView",i=>i.transformProjFromView)),r.code.add(T`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(T`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function tkt(t){const e=t.fragment;e.constants.add("coverageTestThreshold","float",.01),e.code.add(T`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`)}function rkt(t,e){const r=t.vertex;e.silhouette?(r.code.add(T`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?r.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos, ComponentData data) {
vec3 viewNormalA = _modelToViewNormal(data.normal);
vec3 viewNormalB = _modelToViewNormal(data.normal2);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos, ComponentData data) {
vec3 worldNormalA = _modelToWorldNormal(data.normal);
vec3 worldNormalB = _modelToWorldNormal(data.normal2);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos, ComponentData data) {
return false;
}`)}function ikt(t,e){const r=t.vertex;r.include(bp),t.include(lO,e),r.uniforms.add(new Ie("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(T`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new Kd("componentDataTex",i=>i.componentDataTexture)),t.attributes.add(R.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*kce),r.code.add(T`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
      vec3 normal = normalModel();
      vec3 normal2 = ${e.silhouette?T`decompressNormal(normal2Compressed)`:T`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?r.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new m9("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(R.NORMAL2COMPRESSED,"vec2"),r.code.add(T`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):r.code.add(T`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),e.legacy?r.code.add(T`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(vae,e),r.uniforms.add(new Zh("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new m9("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Vh("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new Vh("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new zt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new zt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)),r.code.add(T`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?T`normalize(transformWorldFromModelTL + rotatedModelPosition);`:T`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new _n("transformProjFromView",(i,n)=>n.camera.projectionMatrix)),r.code.add(T`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(T`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function nkt(t){return t.mode===Qs.SKETCH||t.mode===Qs.MIXED}var Qs,DS;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(Qs||(Qs={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(DS||(DS={}));function Xce(t,e){const r=t.vertex;switch(t.attributes.add(R.SIDENESS,"vec2"),e.mode===Qs.MIXED?r.code.add(T`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(T`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case Qs.MIXED:r.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Qs.SKETCH:r.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Qs.SOLID:r.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Qs.COUNT:break;default:e.mode}}function skt(t,e){const r=t.vertex;switch(t.include(Xce,e),e.mode){case Qs.SOLID:r.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Qs.SKETCH:r.uniforms.add(new ST("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Qs.MIXED:r.uniforms.add(new ST("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function okt(t,e){t.include(Xce,e);const{vertex:r,fragment:i}=t;switch(nkt(e)&&(r.uniforms.add(new Kd("strokesTexture",n=>n.strokesTexture.texture)),r.uniforms.add(new ST("strokesLog2Resolution",n=>Math.log2(n.strokesTexture.resolution)),new ST("strokeVariants",n=>n.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),i.uniforms.add(new Kd("strokesTexture",n=>n.strokesTexture.texture),new ST("strokesNormalizationScale",n=>n.strokesTexture.normalizationScale)),r.code.add(T`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(bp),i.code.add(T`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case Qs.SOLID:r.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(T`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Qs.SKETCH:r.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(T`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Qs.MIXED:t.varyings.add("vType","float"),r.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(T`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function O9e(t){const e=new Fr,{vertex:r,fragment:i}=e;return t.legacy&&r.uniforms.add(new Nwe("model"),new Nwe("localView")),e.include(ekt,t),e.include(ikt,t),e.include(skt,t),e.include(Xce,t),e.include(okt,t),e.include(Wn,t),e.include(rkt,t),e.include(tkt,t),e.include(Yu,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),t.multipassEnabled&&e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add(new ci("pixelToNDC",(n,s)=>yr(akt,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new Or("viewport",(n,s)=>s.camera.fullViewport),new Ie("pixelRatio",(n,s)=>s.camera.pixelRatio)),e.attributes.add(R.POSITION0,"vec3"),e.attributes.add(R.POSITION1,"vec3"),e.attributes.add(R.VARIANTOFFSET,"float"),e.attributes.add(R.VARIANTSTROKE,"float"),e.attributes.add(R.VARIANTEXTENSION,"float"),r.code.add(T`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      ${t.multipassEnabled?"vViewPos = viewPos;":""}

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      const float aaPaddingPixels = 1.0;

      // Line size with padding
      float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
      float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===Qs.SKETCH?T`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===Qs.MIXED?T`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0, component)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(component), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(T`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.multipassEnabled?"terrainDepthTest(vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const akt=Ye();let Nwe=class extends Pn{constructor(e){super(e,"mat4")}};const lkt=Object.freeze(Object.defineProperty({__proto__:null,build:O9e},Symbol.toStringTag,{value:"Module"}));let M9e=class R9e extends Zr{initializeProgram(e){return new Br(e.rctx,R9e.shader.get().build(this.configuration),Uze)}initializePipeline(e){return Bt({blending:ya(Ee.ONE,Ee.ONE,Ee.ZERO,Ee.ONE,py.ADD,e.rctx.gl.MAX),depthTest:{func:si.LEQUAL},colorWrite:rr})}};M9e.shader=new Vr(lkt,()=>re(()=>Promise.resolve().then(()=>rHt),void 0));let af=class extends Zl{constructor(){super(...arguments),this.mode=Qs.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.doublePrecisionRequiresObfuscation=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.spherical=!1}};d([H({count:Qs.COUNT})],af.prototype,"mode",void 0),d([H()],af.prototype,"hasSlicePlane",void 0),d([H()],af.prototype,"silhouette",void 0),d([H()],af.prototype,"legacy",void 0),d([H()],af.prototype,"doublePrecisionRequiresObfuscation",void 0),d([H()],af.prototype,"multipassEnabled",void 0),d([H()],af.prototype,"cullAboveGround",void 0),d([H()],af.prototype,"spherical",void 0),d([H({constValue:!1})],af.prototype,"occlusionPass",void 0),d([H({constValue:Ur.Compressed})],af.prototype,"normalType",void 0);const ckt=8,hY=128,ukt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},hkt={solid:Qs.SOLID,sketch:Qs.SKETCH,uber:Qs.MIXED};let dY=class $9e{constructor(e,r,i){this._rctx=e,this._shaderTechniqueRepository=r,this._configuration=new af,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[ir.TRANSPARENT]:{[ir.TRANSPARENT]:new jt,[ir.OPAQUE]:new jt},[ir.OPAQUE]:{[ir.TRANSPARENT]:new jt,[ir.OPAQUE]:new jt}},this._renderablesDirty=!1,this._drawParameters=new JFt,this._settings={...ukt,...i},this.key=$9e.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const n=this._settings.strokesTexture.variants;this.writerSettings={variants:n,reducedPrecision:Si.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=hkt[this._settings.type],this._configuration.silhouette=!1,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=lr(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,r){this._renderablesDirty&&this._sortRenderables();const i=this._sortedRenderables[r];i[ir.TRANSPARENT].forAll(e),i[ir.OPAQUE].forAll(e)}updateTechnique(e,r){return this._configuration.multipassEnabled=!!e.multipassEnabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(M9e,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),r,e)}bindSilhouetteEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),r,e)}renderRegularEdges(e,r,i,n,s){this._render(e,r,r.regular.vao,i,n,s)}renderSilhouetteEdges(e,r,i,n,s){this._render(e,r,r.silhouette.vao,i,n,s)}_render(e,r,i,n,s,o){o>0&&(this._bindDraw(e,r,n,s),this._rctx.bindVAO(i),this._rctx.drawArraysInstanced(dr.TRIANGLE_FAN,0,4,o))}_bindDraw(e,r,i,n){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),e.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const s=new RG(r.transform.position),o=hp(Fwe,x2(Fwe,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=s.low,this._drawParameters.transformWorldFromModelTH=s.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=n.camera.viewInverseTransposeMatrix;se(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,n,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[ir.TRANSPARENT][ir.TRANSPARENT].clear(),this._sortedRenderables[ir.TRANSPARENT][ir.OPAQUE].clear(),this._sortedRenderables[ir.OPAQUE][ir.TRANSPARENT].clear(),this._sortedRenderables[ir.OPAQUE][ir.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==ir.INVISIBLE&&r.edgeTransparency!==ir.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const e=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[ir.TRANSPARENT][ir.TRANSPARENT].sort(e),this._sortedRenderables[ir.TRANSPARENT][ir.OPAQUE].sort(e),this._sortedRenderables[ir.OPAQUE][ir.TRANSPARENT].sort(e),this._sortedRenderables[ir.OPAQUE][ir.OPAQUE].sort(e)}static getKey(e,r,i){return`edges-t:${e}:${r}:${i}`}};const Fwe=ey();function Kur(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new omt(t.layout)}}function mk(t){return new JDe(t.layout).createView(t.buffer)}let dkt=class extends CUe{constructor(e){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},e)}async process(e,r,i){if(i)return P5t(e);const n=await this.invoke(new pY(e),r);return this._unpackOutput(n)}async extractEdgeLocations(e,r){const i=await this.invokeMethod("extractEdgeLocations",new pY(e),r);return mk(i)}async extractComponentsEdgeLocations(e,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new pY(e),r);return mk(i)}_unpackOutput(e){return{regular:{instancesData:mk(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:mk(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},pY=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=np(e.indices)?e.indices:e.indices.buffer,this.indicesType=np(e.indices)?"Array":KV(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function pkt(t){const r=NM.resolution,i=r/2,n=new Uint8Array(4*r*r),s=4*r*i,o=NM.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,u=NM.strokes.length;let h=(c-1)*u*l;for(const{distance:f,pressure:g}of NM.strokes){let y=f,v=g,b=h;for(let w=0;w<c;w++){w!==0&&(y=kwe(y,UD.DISTANCE),v=kwe(v,UD.PRESSURE));for(let x=0;x<NM.resolution;x++){const S=.5+(y?y[x%y.length]/a:0),E=v?v[x%v.length]:1;ED(S,n,b),ED(E,n,b+s),b+=4}b-=l*(u+1)}h+=l}const p=new Mr(t,new ui(r),n);return new mkt(r,a,o,u,p)}function kwe(t,e){if(!t)return null;const r=t.length/2,i=fkt*r,n=new Array(r);let s=0;const o=e===UD.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;n[s++]=o?Math.min(i,1-(1-l)*Uwe):Math.min(i,l*Uwe)}return n}var UD;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(UD||(UD={}));const fkt=.1,Uwe=.5;let mkt=class{constructor(e,r,i,n,s){this.resolution=e,this.normalizationScale=r,this.amplitude=i,this.variants=n,this.texture=s}dispose(){this.texture=wt(this.texture)}};const NM={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function zwe(t){let e=null;for(const r of t){const i=r.type;if(gkt(r)){if(e==null)e=i;else if(e!==i)return"uber"}}return e??"uber"}function Vwe(t){let e=ir.INVISIBLE;for(const{material:r}of t)if(I9e(r)){if(r.color[3]*r.opacity<1)return ir.TRANSPARENT;e=ir.OPAQUE}return e}function Bwe(t){let e=ir.INVISIBLE;for(const{material:r}of t)if(I9e(r)){switch(r.objectTransparency){case ir.TRANSPARENT:case ir.INVISIBLE:return ir.TRANSPARENT;case ir.OPAQUE:if(r.opacity<1)return ir.TRANSPARENT}e=ir.OPAQUE}return e}function I9e(t){return t.size*t.color[3]*t.opacity>0}function gkt(t){return t.size*t.color[3]>0}function Gwe(t,e,r,i){for(let n=0;n<t.length;n++){const s=t[n].index,o=e[n],a=e[n+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,s)}else for(let l=o;l<a;l++)r.set(l,s)}}let lf=class extends Pe{constructor(e){super(e),this._updatingHandles=new em,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=C(),this._localOrigins=new YFt(new Ile(e.renderSR))}initialize(){this._worker=new dkt(this.schedule),this._componentColorManager=new Bze(this.rctx,3);const e=kze.createBuffer(4);for(let r=0;r<4;r++)e.sideness.set(r,0,r===0||r===3?0:1),e.sideness.set(r,1,r===0||r===1?0:1);this._verticesBufferObject=ti.createVertex(this.rctx,Lr.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(e=>this._discardObjectEntry(e)),this._perObjectData.clear(),this._strokesTexture=wt(this._strokesTexture),this._componentColorManager=Me(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=wt(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",wkt))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(e,r,i,n,s,o){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let a;const l=new Hwe(new Promise(u=>a=u),e.obb.center,e.obb.radius);this._perObjectData.set(e,l);const c=await this._updatingHandles.addPromise(this._addComponentGeometry(e.transform,l,r,i,n,s,o));return this.setNeedsRender(),a(),c}async addOrUpdateObject3D(e,r,i,n){if(this.destroyed)return void K.getLogger(this).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(e);let o;(s==null?void 0:s.renderables.length)>0&&this._perObjectDataEvictionCache.add(s);const a=e.boundingVolumeWorldSpace.bounds,l=new Hwe(new Promise(u=>o=u),a,H0(a));this._perObjectData.set(e,l);const c=new Array;if(i.mergeGeometries&&e.geometries.length>1&&ykt(e))c.push(this._addObjectMergedGeometries(e,l,r,i,n));else for(let u=0;u<e.geometries.length;u++){const h=e.geometries[u];h.material.supportsEdges&&c.push(this._addGeometry(e,l,h,r[0],i,n))}await this._updatingHandles.addPromise(Promise.all(c)),this._perObjectDataEvictionCache.delete(l),this._discardObjectEntry(s),this.setNeedsRender(),o()}fastUpdateObject3DEdgesTransform(e){if(this.destroyed)return!1;const r=this._perObjectData.get(e);if(!r)return!1;const{geometries:i}=e,{renderables:n}=r;if(i.length===0||n.length===0)return!0;if(n.length>1)return!1;const[s]=n,o=s.transform;if(!(o instanceof fY))return!1;const[a]=i;if(a.localOrigin!==o.origin.origin)return!1;const l=xe(),c=this._computeModelTransformWithLocalOrigin(e,a,l);return s.transform=new fY(l,c),this.setNeedsRender(),!0}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(r=>this._removeRenderable(r)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this._perObjectData.has(e)}async updateAllComponentOpacities(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));if(i==null)return;const n=r instanceof Array?s=>r[s]:()=>r;i.renderables.forEach(s=>{const o=s.components.meta.length;for(let a=0;a<o;a++){const l=n(a),c=s.components.meta[a],u=c.index;c.material.opacity=l,s.components.buffer.textureBuffer.setDataElement(u,1,3,255*l)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(e){const r=await this._getObjectEntry(e);return r!=null?r.renderables.reduce((i,n)=>i+n.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(e,r,i,n){const s=e instanceof I_,o=!!i.hasSlicePlane,a=zwe(r),l=dY.getKey(a,o,s),c=await this._updatingHandles.addPromise(this._getObjectEntry(e));c!=null&&(c.renderables.forEach(u=>{if(l!==u.rendererKey){const h=this._renderers.get(u.rendererKey),p=this._acquireRenderer(a,o,s);h.removeRenderable(u),--h.refCount,u.rendererKey=l,p.addRenderable(u)}for(let h=0;h<r.length;h++)u.components.meta[h].material=r[h];n&&this._updateComponentBuffer(u.components),this._updateTransparency(u)}),this.setNeedsRender())}async updateAllVerticalOffsets(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));i!=null&&(i.renderables.forEach(n=>{const s=n.components.meta;for(let o=0;o<s.length;o++)n.components.meta[o].verticalOffset=(r==null?void 0:r[o])??0;this._updateComponentBuffer(n.components)}),this.setNeedsRender())}async updateObjectVisibility(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));i!=null&&(i.renderables.forEach(n=>n.visible=r),this.setNeedsRender())}removeObject(e){const r=this._perObjectData.get(e);r&&(this._perObjectData.delete(e),this._discardObjectEntry(r))}async _getObjectEntry(e){const r=this._perObjectData.get(e);if(!r)throw new Error("no object");return await r.loaded,r.loaded==null?null:r}render(e,r){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,n=C(),s=new RG;let o=0,a=0;if(this._renderers.forEach(c=>{if(c.refCount===0)return this._renderers.delete(c.key),void c.dispose();let u=!0,h=!0;c.forEachRenderable(p=>{p.visible&&(o+=p.statistics.averageEdgeLength,a++,u&&p.regular&&(c.updateTechnique(e,!1),u=!1),h&&p.silhouette&&(c.updateTechnique(e,!0),h=!1))},r)}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),a===0)return;const l=new ZFt(40*o/a,r);se(n,i[3],i[7],i[11]),s.set(n),he(l.transformWorldFromViewTH,s.high),he(l.transformWorldFromViewTL,s.low),jh(l.transformViewFromCameraRelativeRS,e.camera.viewMatrix),hp(Xwe,l.transformViewFromCameraRelativeRS),x2(l.transformNormalViewFromGlobal,Xwe),l.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this._renderers.forEach(c=>{this._renderRegularEdges(c,e,l),this._renderSilhouetteEdges(c,e,l)})}_updateTransparency(e){const r=Vwe(e.components.meta),i=Bwe(e.components.meta);r===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=r,e.objectTransparency=i,this._renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,r,i){e.getCombinedShaderTransformation(r,i);const n=r.localOrigin!=null?this._localOrigins.register(r.localOrigin):this._localOrigins.acquire(se(this._tmpModelPosition,i[12],i[13],i[14]));return r.localOrigin=n.origin,qFt(n.origin.vec3,i),n}_updateComponentBuffer(e){const{meta:r,buffer:i}=e,n=new Uint8Array(4);for(let s=0;s<r.length;s++){const o=r[s].material,a=r[s].index,l=we(Math.round(o.size*ckt),0,255),c=we(o.extensionLength,-hY,255-hY)+hY,u=o.type==="solid"?_V.SOLID:_V.SKETCH,h=255*o.opacity,p=o.color,f=255*p[0],g=255*p[1],y=255*p[2],v=255*p[3];i.textureBuffer.setData(a,0,f,g,y,v),i.textureBuffer.setData(a,1,l,c,u,h),Ize(r[s].verticalOffset,n),i.textureBuffer.setData(a,2,n[0],n[1],n[2],n[3])}}_createComponentBuffers(e){if(this._componentColorManager==null)return null;const r=new Array,i=this._componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const o=e[s],a=i.acquireIndex();r.push({index:a,verticalOffset:0,material:o})}const n=new _kt(i,r);return this._updateComponentBuffer(n),n}_extractEdges(e,r,i,n,s,o=s.length){return this._worker.process({data:r,indices:s,indicesLength:o,writerSettings:e,skipDeduplicate:i},this._workerAbort.signal,n)}_createRenderable(e,r,i,n,s){const o=u=>this._verticesBufferObject!=null?new vkt(new wm(this.rctx,Uze,{vertices:g5t,instances:u===DS.REGULAR?gV.glLayout:yV.glLayout},{vertices:this._verticesBufferObject,instances:ti.createVertex(this.rctx,Lr.STATIC_DRAW,u===DS.REGULAR?e.regular.instancesData.buffer:e.silhouette.instancesData.buffer)}),u===DS.REGULAR?e.regular.lodInfo:e.silhouette.lodInfo):null,a=e.regular.lodInfo.lengths.length>0?o(DS.REGULAR):null,l=e.silhouette.lodInfo.lengths.length>0?o(DS.SILHOUETTE):null,c=((a==null?void 0:a.vao.usedMemory)??0)+((l==null?void 0:l.vao.usedMemory)??0);return new bkt(a,l,{gpuMemoryUsage:c,externalMemoryUsage:s,averageEdgeLength:e.averageEdgeLength},i,Vwe(r.meta),Bwe(r.meta),r,n)}async _addGeometry(e,r,i,n,s,o){if(i.edgeIndicesLength<=0)return;const a=i.attributes.get(R.POSITION),l=xe(),c=this._computeModelTransformWithLocalOrigin(e,i,l),u=new Ywe(a,l,c);return this._addPositionData(r,u,i.edgeIndicesLength,n,s,o)}async _addPositionData(e,r,i,n,s,o=!1){if(e.loaded==null)return;const a=this._createComponentBuffers([n]);if(a==null)return;const l=this._acquireRenderer(n.type,!!s.hasSlicePlane,!0),{modelTransform:c,origin:u}=r,h=r.position.indices,p=r.position,f=p.data.length/p.size,g=fV.createBuffer(f);for(let b=0;b<f;b++)g.position.set(b,0,p.data[b*p.size]),g.position.set(b,1,p.data[b*p.size+1]),g.position.set(b,2,p.data[b*p.size+2]);Gwe(a.meta,[0,g.componentIndex.count],g.componentIndex);const y=await this._updatingHandles.addPromise(this._extractEdges(l.writerSettings,g,!1,o,h,i));if(e.loaded==null)return;const v=this._createRenderable(y,a,new fY(c,u),l.key,!1);e.renderables.push(v),l.addRenderable(v),this._gpuMemoryUsage+=v.statistics.gpuMemoryUsage}async _addComponentGeometry(e,r,i,n,s,o,a){if(r.loaded==null)return 0;const l=this._createComponentBuffers(o);if(l==null)return 0;const c=zwe(o),u=this._acquireRenderer(c,a.hasSlicePlane||!1,!1),h=fV.createBuffer(i.length/3);WN(h.position.typedBuffer,i,h.position.typedBufferStride,3),Gwe(l.meta,s,h.componentIndex,n);const p=!0,f=u.writerSettings,g=await this._updatingHandles.addPromise(this._extractEdges(f,h,p,!1,n));if(r.loaded==null)return 0;const y=this._createRenderable(g,l,e,u.key,!0);return r.renderables.push(y),u.addRenderable(y),y.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(e,r,i,n,s){const o=new Map;let a=0,l=null,c=0;const u=e.geometries.filter(x=>{if(x.edgeIndicesLength<=0||!x.material.supportsEdges)return!1;!l&&x.localOrigin&&(l=x);const S=x.attributes.get(R.POSITION);return c+=S.data.length/S.size,a+=x.edgeIndicesLength,!0});if(u.length===0)return;const h=c>=65536?Uint32Array:Uint16Array,p=a?new h(a):null,f=[];let g=0;u.forEach(x=>{const S=x.attributes.get(R.POSITION),E=S.indices;let P=o.get(S.data);if(P==null){P=f.length/3;for(let M=0;M<S.data.length;M+=S.size)f.push(S.data[M]),f.push(S.data[M+1]),f.push(S.data[M+2]);o.set(S.data,P)}for(let M=0;M<x.edgeIndicesLength;M++)p[g++]=P+E[M]});const y=l||e.geometries[0],v=xe(),b=this._computeModelTransformWithLocalOrigin(e,y,v);for(let x=0;x<e.geometries.length;x++)e.geometries[x].localOrigin=b.origin;const w=new Ywe(new tt(f,p,3),v,b);await this._updatingHandles.addPromise(this._addPositionData(r,w,p.length,i[0],n,s))}_acquireRenderer(e,r,i){const n=dY.getKey(e,r,i);let s=this._renderers.get(n);return this._strokesTexture==null&&(this._strokesTexture=pkt(this.rctx)),s||(s=new dY(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:r,strokesTexture:this._strokesTexture,legacy:i,spherical:this.viewingMode===Fe.Global}),this._renderers.set(n,s)),++s.refCount,s}_removeRenderable(e){jwe(e.regular),jwe(e.silhouette);const r=this._renderers.get(e.rendererKey);if(r){r.removeRenderable(e),--r.refCount,"origin"in e.transform&&this._localOrigins.release(e.transform.origin),this._gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const i of e.components.meta)e.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(e){const r=e.camera.eye,i=e.camera.viewForward,n=C(),s=o=>{rn(n,o.center,r);const a=fe(n,i),l=o.radius,c=a<-l?1/0:a<l?0:a-l;o.renderables.forEach(u=>u.distanceToCamera=c)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,r,i){const n=e.bindRegularEdges(i,r),s=i.transparency,o=r.camera.perScreenPixelRatio;e.forEachRenderable(a=>{if(!qwe(a)||!a.visible)return;const l=gk(a.regular.lod.lengths,a.distanceToCamera,o);e.renderRegularEdges(n,a,i,r,l)},s)}_renderSilhouetteEdges(e,r,i){const n=e.bindSilhouetteEdges(i,r),s=i.transparency,o=r.camera.perScreenPixelRatio;e.forEachRenderable(a=>{if(!Wwe(a)||!a.visible)return;const l=gk(a.silhouette.lod.lengths,a.distanceToCamera,o);e.renderSilhouetteEdges(n,a,i,r,l)},s)}get test(){return{hasRenderedPrimitives:e=>{let r=!1;const i=e.perScreenPixelRatio,n=(s,o)=>s.forEachRenderable(a=>{a.visible&&!r&&(qwe(a)&&(r=gk(a.regular.lod.lengths,a.distanceToCamera,i)>0),!r&&Wwe(a)&&(r=gk(a.silhouette.lod.lengths,a.distanceToCamera,i)>0))},o);return this._renderers.forEach(s=>{r||(n(s,ir.OPAQUE),n(s,ir.TRANSPARENT))}),r},getObjectData:e=>this._perObjectData.get(e)}}};function jwe(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.disposeVAOOnly(),t.vao=null)}function ykt(t){let e=null,r=null;for(let i=0;i<t.geometries.length;i++){const n=t.geometries[i];if(n.material.supportsEdges){if(e){if(!ny(e,n.transformation))return!1}else e=n.transformation;if(r||n.localOrigin==null){if((r==null?void 0:r.localOrigin)!=null&&n.localOrigin!=null&&r.localOrigin.id!==n.localOrigin.id)return!1}else r=n}}return!0}d([m({constructOnly:!0})],lf.prototype,"rctx",void 0),d([m({constructOnly:!0})],lf.prototype,"renderSR",void 0),d([m({constructOnly:!0})],lf.prototype,"viewingMode",void 0),d([m({constructOnly:!0})],lf.prototype,"techniqueRepository",void 0),d([m({constructOnly:!0})],lf.prototype,"setNeedsRender",void 0),d([m({constructOnly:!0})],lf.prototype,"schedule",void 0),d([m({readOnly:!0})],lf.prototype,"_updatingHandles",void 0),d([m({readOnly:!0})],lf.prototype,"updating",null),lf=d([F("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],lf);let Hwe=class{constructor(e,r,i){this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)}),this.center=nn(r)}},_kt=class{constructor(e,r){this.buffer=e,this.meta=r}},vkt=class{constructor(e,r){this.vao=e,this.lod=r}},fY=class{constructor(e,r){this.modelMatrix=e,this.origin=r}},bkt=class{constructor(e,r,i,n,s,o,a,l){this.regular=e,this.silhouette=r,this.statistics=i,this.transform=n,this.edgeTransparency=s,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}};function qwe(t){return t.regular!=null}function Wwe(t){return t.silhouette!=null}function gk(t,e,r){const i=e*r,n=TEe(t,i,!0);return n===-1?i<t[0]?t.length:0:t.length-n}let Ywe=class{constructor(e,r,i){this.position=e,this.modelTransform=r,this.origin=i}};const Xwe=gi(),wkt=()=>Promise.reject();let Zwe=class{constructor(e,r,i,n,s,o,a,l,c){this.createQuery=e,this.deleteQuery=r,this.resultAvailable=i,this.getResult=n,this.disjoint=s,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},u0=!1;function xkt(t,e){if(e.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r?new Zwe(()=>t.createQuery(),i=>{t.deleteQuery(i),u0=!1},i=>t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),i=>t.getQueryParameter(i,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{u0||(u0=!0,t.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{t.endQuery(r.TIME_ELAPSED_EXT),u0=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"),r?new Zwe(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),u0=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{u0||(u0=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),u0=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function Skt(t,e){const r=t.capabilities.disjointTimerQuery;return r==null?null:new Tkt(r,e)}let Tkt=class{constructor(e,r){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const n=this._timer.createQuery(),s=this._timer.createQuery();this._queryPool.push(n,s),this._queryResults.set(i,null)})}start(){u0||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(e);if(r==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var Fi;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.NORMALS="normals",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINES="laser lines",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(Fi||(Fi={}));const Jwe="Total";let Ekt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new D0(Jwe),this._cpuTimeSamplers=new Map(Object.values(Fi).map(r=>[r,new D0(r)])),this._enableGPUTimer=0,this._totalGPUTime=new D0("GPU"),this._gpuTimeSamplers=new Map(Object.values(Fi).map(r=>[r,new D0(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const r=[...Object.values(Fi),Jwe];this._gpuTimerPool=Skt(this._rctx,r)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=wt(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(e){const r=performance.now();if(this._cpuTimeSamplers.get(e).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,this._gpuTimerPool){const i=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(i),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const r=this._gpuTimerPool.stop(Fi.FINISH);this._gpuTimeSamplers.get(Fi.FINISH).record(r),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}},AC=class{constructor(e,r,i,n,s,o,a,l){this._stage=e,this._techniqueRepository=n,this._rctx=s,this._compositingHelper=o,this._magnifierHelper=a,this._requestRender=l,this._pluginsHas={hudElements:!1,water:!1},this._hasOverlayWater=!1,this.renderOverlay=c=>{},this._isRendering=!1,this._backgroundColor=Xt(0,0,0,1),this._sliceHelper=new HFt,this._state=Zg(Xr.IDLE),this._highQualityTransparencyEnabled=!0,this._terrainTransparency=ql.Opaque,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new MFt,this._reprojectionMatrixVersion=Zg(0),this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new Map,this._releaseNormals=c=>{var u;(u=c.find(({name:h})=>h==="normals"))!=null&&u.release()&&this._pluginInput.delete("normals")},this._debugLinearDepth=!1,this.fboCache=new hFt(s),this._renderStateFeatures=Zg(nq(!ne("disable-feature:high-quality-idle"),e.view.qualityProfile)),this._offscreen=new NFt(this.fboCache,this._compositingHelper),this.performanceInfo=new Ekt(this._rctx),this._shadowMap=new Lle(this.fboCache,e.viewingMode),this._highlight=new N$({view:e.view}),this._shadowHighlight=new PC({view:e.view,viewingMode:e.viewingMode}),this._shadowAccumulator=new bc(this.fboCache,n,e,c=>{const u=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(c.camera,c.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=u},(c,u,h)=>{const p=this._stage.view.qualitySettings.maximumPixelRatio;c.shadowMap.start(c.camera,u,h,!0,p),this._renderShadowCascades(G.Shadow,c.shadowMap),c.shadowMap.finish(),c.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(c.camera,c.contentCamera)},l),this._ssao=new QR({view:this._stage.view}),this._renderContext=new ISt(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper),this._nodes=new dFt(this._renderContext),this._plugins=new pFt({renderContext:this._renderContext,techniqueRepository:n,textureRepository:i,materialRepository:r,requestRender:l,controller:e,fbos:this.fboCache,isFeatureEnabled:c=>this.isFeatureEnabled(c)}),this.renderPassManager=new ere,this._plugins.add(this.renderPassManager),this._smaa=new sS({view:this._stage.view}),this._plugins.add(this._smaa),this._blit=new CC({opacity:1,alphaMode:tl.None}),this._plugins.add(this._blit),this._plugins.add(this._ssao),this._plugins.add(this._highlight),this._plugins.add(this._shadowHighlight),this._handles=[pe(()=>this._stage.view.state.camera,()=>l(),li),pe(()=>Si.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(ir.TRANSPARENT):()=>{},l()},mi),pe(()=>{var c;return(c=this._stage.view.environment.background)==null?void 0:c.color},c=>{const u=c?dD(c):Fh;pn(this._backgroundColor,u[0]*u[3],u[1]*u[3],u[2]*u[3],u[3]),l()},li)]}destroy(){this._handles.forEach(e=>e.remove()),this._gpuTimerHandle=Pi(this._gpuTimerHandle),this._nodes.destroy(),this._offscreen.dispose(),this._shadowMap.dispose(),this._highlight.dispose(),this._shadowAccumulator.dispose(),this._edgeView=Me(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),AAe.prune()}get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(e=null,r=!ne("disable-feature:high-quality-idle")){this._renderStateFeatures.value=nq(r,e),this._plugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(e,r=this._state.value){return this._renderStateFeatures.value.get(r,e)??!1}setFeatureEnabled(e,r,i){this._renderStateFeatures.mutate(n=>n.set(r,e,i)),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Ys.HighQualityTransparency)}get hasReflections(){return(this._pluginsHas.water||this._hasOverlayWater)&&(this._ssrEnabled||this.isFeatureEnabled(Ys.WaterReflection))}get hasDecorations(){return this._plugins.hasDecorations}get hasHighlights(){return this._plugins.produces(de.OPAQUE_MATERIAL,G.Highlight)||this._plugins.produces(de.TRANSPARENT_MATERIAL,G.Highlight)||this._plugins.produces(de.DRAPED_MATERIAL,G.Highlight)}get _magnifierEnabled(){return this._bindParameters.decorations===Ac.ON&&this._magnifierHelper.enabled}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(Ys.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=lr(this._bindParameters.ssr.lastFrameColor),this._bindParameters.multipassTerrain.linearDepth=lr(this._bindParameters.multipassTerrain.linearDepth),this._bindParameters.multipassGeometry.linearDepth=lr(this._bindParameters.multipassGeometry.linearDepth)}_disposeOffscreenBuffers(){this._offscreen.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.linearDepth=lr(this._bindParameters.linearDepth),this._bindParameters.hudVisibility=lr(this._bindParameters.hudVisibility)}get updating(){return this._smaa.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const e=this._stage.view.resourceController;this._edgeView=new lf({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:Ckt(e)}),this._handles.push(pe(()=>{var r;return(r=this._edgeView)==null?void 0:r.updating},()=>this._requestRender(),ei)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&EB(this._bindParameters.ssr.reprojectionMatrix,fn)}set _reprojectionMatrix(e){SEe(this._bindParameters.ssr.reprojectionMatrix,e)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setParameters(e){var n;const{_shadowMap:r,_bindParameters:i}=this;if(((n=e.qualitySettings)==null?void 0:n.reflections)!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&r.maxCascades!==e.shadowMapMaxCascades&&(r.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const s=e.environment.lighting.type!=="virtual";i.enableFillLights!==s&&(i.enableFillLights=s,this._requestRender())}e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get plugins(){return this._plugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,r){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:n,updates:s}=e;if(i.length===0&&n.length===0&&s.length===0)return;const o=bke(e);let a=!1;o.forEach((l,c)=>{if(r.done)return;let u=this._plugins.getMaterialRenderer(c);if(u==null&&l.adds.length>0){const h=new HI({material:c});h.initializeRenderContext(this._plugins._context),u=h,this._plugins.add(u)}u&&(u.modify(l),u.numGeometries===0&&(a=!0)),l.removes.forEach(h=>e.removes.removeUnordered(h)),l.adds.forEach(h=>e.adds.removeUnordered(h)),l.updates.forEach(h=>e.updates.removeUnordered(h)),r.madeProgress()}),a&&this._plugins.removeEmptyMaterialRenderers(),this._updateHasFlags(),this._requestRender()}_updateHasFlags(){const e=this._pluginsHas;e.hudElements=this._plugins.produces(de.LINE_CALLOUTS_HUD_DEPTH)||this._plugins.produces(de.HUD_MATERIAL)||this._plugins.produces(de.LABEL_MATERIAL),e.water=this._plugins.produces(de.DRAPED_WATER,G.Normal),this._bindParameters.hasOccludees=this._plugins.hasOccludees}updateAnimation(e){const r=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(e),this._hasAnimations=this._nodes.updateAnimation()||this._hasAnimations,this._hasAnimations!==r&&(this._gpuTimerHandle=r?Pi(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(e,r,i=Rf.Default,n=Ac.ON){this._isRendering=!0,this.performanceInfo.startFrame(),this.fboCache.frameStart(),this._disposeBindBuffers();const s=this._offscreen,{camera:o,contentCamera:a,mode:l,alignPixelEnabled:c}=e;this._state.value=l,this._bindParameters.overlay=this.renderOverlay(r),this.performanceInfo.advance(Fi.OVERLAY),this._renderContext.time=r,this._bindParameters.transparencyPassType=vt.NONE,this._bindParameters.alignPixelEnabled=c,this._bindParameters.decorations=n,this._bindParameters.mainColor=this._bindParameters.mainDepth=null;const u=A_(this._sliceHelper.plane);n===Ac.OFF&&(this._sliceHelper.plane=null),o.setGLViewport(this._rctx);const h=s.initializeFrame(o,this._backgroundColor,i);this.hasReflections?this._bindParameters.ssr.lastFrameColor=h:h==null||h.release(),this._ensureBindParametersCamera(o,a),this._plugins.prepareRender(),this.performanceInfo.advance(Fi.PREPARE);const p=this._computeDepthRange(o);this._renderShadowMap(o,this._bindParameters.lighting.mainLight.direction,p),this.performanceInfo.advance(Fi.SHADOW_MAP),this._ensureBindParametersCamera(o,a);const f=this._plugins.produces(de.OPAQUE_TERRAIN)&&(this._terrainTransparency===ql.Semitransparent||this._terrainTransparency===ql.TransparentWithDraped),g=this._highQualityTransparency&&f,y=this._plugins.produces(de.TRANSPARENT_MATERIAL,G.Color);this._prepareShaders(g,y),this._pluginInput.set("normals",this._renderNormals()),this.performanceInfo.advance(Fi.NORMALS),this._renderSSAO(),this.performanceInfo.advance(Fi.SSAO),this._renderLinearDepth(),this.performanceInfo.advance(Fi.LINEAR_DEPTH),this._renderShadowAccumulation(p,o,a),this.performanceInfo.advance(Fi.ACCUMULATED_SHADOWS),this._ensureBindParametersSSR(r),this._renderContext.output=G.Color,s.bindFbo(),this._bindParameters.mainColor=s.colorTexture,this._bindParameters.mainDepth=s.depthTexture,this._renderOpaqueGeometry(),this._offscreen.updateColor(M=>this._invokeRenderNodes(M),"opaque-color"),this._plugins.render(de.ENVIRONMENT_OPAQUE),this.performanceInfo.advance(Fi.OPAQUE),this.fboCache.debugCallback&&this.fboCache.debugCallback("opaque-color",this._offscreen.color.fbo),this._renderTerrainLinearDepth(g),this._setMultipassTerrain(g),this._renderEdges(ir.OPAQUE),this.performanceInfo.advance(Fi.OPAQUE_EDGES),s.bindFbo(),this._plugins.render(de.VOXEL),this.performanceInfo.advance(Fi.VOXEL),this._renderHiddenTransparentEdges(),y&&(this._oitEnabled?this._renderOITPass(E3.Geometry):this._renderTransparentMaterial()),this._offscreen.updateColor(M=>this._invokeRenderNodes(M),"transparent-color"),this.performanceInfo.advance(Fi.TRANSPARENT);const v=this._renderGeometryLinearDepth(g);this._renderHUDVisibility(v),g||this._plugins.render(de.LINE_CALLOUTS),this.performanceInfo.advance(Fi.HUD_VISIBILITY);const b=i===Rf.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;this.performanceInfo.advance(Fi.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(ir.TRANSPARENT,v),v==null||v.release(),this.performanceInfo.advance(Fi.TRANSPARENT_EDGES);const w=f?this._renderTransparentTerrain():null;w&&this._bindParameters.hudVisibility&&(g?this._renderLineCallouts(cu.Occluded):s.compositeToHUDVisibility(this._bindParameters,w.getTexture()),this._renderHUD(cu.Occluded,s.color),this.performanceInfo.advance(Fi.HUD_OCCLUDED)),this.performanceInfo.advance(Fi.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),w&&(s.compositeToFramebuffer(this._bindParameters,w.getTexture(),tl.PremultipliedAlpha,1),w.release(),g&&(this._renderEdges(ir.OPAQUE),this.performanceInfo.advance(Fi.OPAQUE_EDGES),y&&(this._oitEnabled?this._renderOITPass(E3.Geometry):this._renderTransparentMaterial()),this.performanceInfo.advance(Fi.TRANSPARENT),this._renderEdges(ir.TRANSPARENT),this.performanceInfo.advance(Fi.TRANSPARENT_EDGES))),this._bindParameters.ssao=lr(this._bindParameters.ssao),g&&this._renderLineCallouts(cu.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),s.bindFbo(),this._plugins.render(de.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._plugins.render(de.ENVIRONMENT_TRANSPARENT),this.performanceInfo.advance(Fi.ENVIRONMENT),this._renderLaserlines(),this.performanceInfo.advance(Fi.LASER_LINES),this._renderOccluded(),this.performanceInfo.advance(Fi.OCCLUDED);let x=this._renderHighlightPrepass();x&&this._renderShadowHighlights(x,this._bindParameters);const S=this._magnifierEnabled&&i===Rf.Default?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"magnifier"):null,E=i!==Rf.Default?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"screenshot"):null,P=this._renderComposite(S??E,x)??E;return this.performanceInfo.advance(Fi.ANTIALIASING),this._renderHUD(cu.NotOccluded,P),this.performanceInfo.advance(Fi.HUD),x&&(this._renderHighlights(P,x,this._bindParameters),x=lr(x)),this.performanceInfo.advance(Fi.HIGHLIGHTS),this._magnifierEnabled&&this._magnifierHelper.render(this._rctx,this._bindParameters),P!==E&&(this._rctx.bindFramebuffer(E==null?void 0:E.fbo),this._compositingHelper.composite(this._bindParameters,S==null?void 0:S.getTexture(),tl.None)),i===Rf.Default&&(S==null||S.release()),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),this._offscreen.releaseBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=u,this._isRendering=!1,this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),i!==Rf.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),{screen:E,oid:b}}_prepareShaders(e,r){this._renderContext.output=G.Color,this._prepareOpaqueGeometry(),this._setMultipassTerrain(e),this._plugins.prepare(de.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),e||this._plugins.prepare(de.LINE_CALLOUTS),r&&this._prepareTransparencySlots(),this._plugins.prepare(de.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._plugins.prepare(de.ENVIRONMENT_TRANSPARENT),this._plugins.prepare(de.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(){if(!ne("enable-feature:objectAndLayerId-rendering"))return;const e=this._renderContext.output,r=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oid");return r.acquireDepth(Ra.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(r.fbo),this.fboCache.rctx.clearFramebuffer([0,0,0,0],!0,!0),this._renderAllGeometry(G.ObjectAndLayerIdColor),this._rctx.bindFramebuffer(r.fbo),this.fboCache.rctx.clearFramebuffer(void 0,!0,!0),this._bindParameters.hudRenderStyle=cu.NotOccluded,this._plugins.render(de.HUD_MATERIAL),this._renderContext.output=e,r}finish(e){this._hasAnimations||this._animationTimestep.clear();const r=this.performanceInfo.gpuSamplingEnabled,i=e===Hn.BACKGROUND;if(i||r){const n=i?this.performanceInfo.elapsedTime:0,s=r?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),o=Math.max(n,s);this._animationTimestep.frame(o,i)}}readDepthPixels(e,r,i){var a;const n=(a=this._bindParameters.linearDepth)==null?void 0:a.fbo;if(n!=null&&n.colorTexture)return void n.readPixels(r[0],r[1],r[2],r[3],Ot.RGBA,Ks.UNSIGNED_BYTE,i);const s=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"depth").acquireDepth(Ra.DEPTH16_BUFFER);this._rctx.bindFramebuffer(s.fbo),this._ensureBindParametersCamera(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const o=Mi.COLOR_BUFFER_BIT|Mi.DEPTH_BUFFER_BIT|Mi.STENCIL_BUFFER_BIT;this._rctx.clearSafe(o),this._renderAllGeometry(G.LinearDepth),s.fbo.readPixels(r[0],r[1],r[2],r[3],Ot.RGBA,Ks.UNSIGNED_BYTE,i),s.release()}readHUDVisibility(e,r,i,n,s){var o;(o=this._bindParameters.hudVisibility)==null||o.fbo.readPixels(e,r,i,n,Ot.RGBA,Ks.UNSIGNED_BYTE,s)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassTerrain(e){this._setMultipassEnabled(e),this._setTerrainCulling(e)}_setMultipassEnabled(e){this._bindParameters.multipassEnabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderEdges(e,r){const i=this._edgeView;if(i!=null&&i.shouldRender()){const{width:n,height:s,depth:o}=this._offscreen,a=this.fboCache.acquire(n,s,"edges"),l=()=>i.render(this._bindParameters,e);this._offscreen.renderToTargets(l,a,r??o,Qwe),this._offscreen.compositeToFramebuffer(this._bindParameters,a.getTexture(),tl.Alpha,1),a.release()}}_renderShadowMap(e,r,i){const n=this._shadowMap;n.enabled&&(n.start(e,r,i,this.isFeatureEnabled(Ys.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(e,r),this._needsShadowHighlight?(this._renderShadowCascades(G.ShadowHighlight,this._shadowMap),n.moveSnapshot(l2.Highlight),this._renderShadowCascades(G.ShadowExcludeHighlight,this._shadowMap),n.copySnapshot(l2.ExcludeHighlight),this._renderShadowCascades(G.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(G.Shadow),n.finish(),e.setGLViewport(this._rctx))}_renderShadowCascades(e,r=this._shadowMap){for(const i of r.cascades)i.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(i.camera,i.camera),this._renderAllGeometry(e)}get _needsLinearDepth(){return this._plugins.consumes(G.LinearDepth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast||this._debugLinearDepth}_renderLinearDepth(){this._needsLinearDepth?(this._bindParameters.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.linearDepth,"linear-depth",()=>this._renderAllGeometry(G.LinearDepth),[0,0,0,0],tn.RGBA,Ra.DEPTH_STENCIL_TEXTURE),this._bindParameters.linearDepth.detachDepth()):this._bindParameters.linearDepth=lr(this._bindParameters.linearDepth)}_renderTerrainLinearDepth(e){if(e){const r=this._renderContext.output;this._renderContext.output=G.LinearDepth,this._bindParameters.multipassTerrain.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassTerrain.linearDepth,"terrain depth",()=>this._renderTransparentTerrain(),[-1e10,-1e10,-1e10,1]),this._bindParameters.multipassTerrain.linearDepth.detachDepth(),this._renderContext.output=r}else this._bindParameters.multipassTerrain.linearDepth=lr(this._bindParameters.multipassTerrain.linearDepth)}_renderGeometryLinearDepth(e){if(!e)return void(this._bindParameters.multipassGeometry.linearDepth=lr(this._bindParameters.multipassGeometry.linearDepth));const r=this._renderContext.output;this._bindParameters.multipassGeometry.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassGeometry.linearDepth,"geometry depth",()=>this._renderOpaqueGeometryAndTransparentMaterial(G.LinearDepth),[1,1,1,1]),this._renderContext.output=r;const i=this._bindParameters.multipassGeometry.linearDepth.getAttachment(cA);return i==null||i.retain(),this._bindParameters.multipassGeometry.linearDepth.detachDepth(),i}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return Wte;const r=q5t(e,this._plugins.plugins,this._stage.layers);return SA(r,this._plugins.queryDepthRange(e)),r.near=Math.max(e.near,r.near),r.far=Math.min(e.far,r.far),r}_renderNormals(){const e=this._plugins.produces(de.SSAO),r=this._nodes.require("normals","composite-color")+this._nodes.require("normals","opaque-color")+this._nodes.require("normals","transparent-color");let i=(e?1:0)+r+(e||r>0?this._nodes.optional("normals","composite-color")+this._nodes.optional("normals","opaque-color")+this._nodes.optional("normals","transparent-color"):0);if(i===0)return;const n=this._offscreen.renderToCachedFBO(null,"normals",()=>this._renderGeometryForSSAO(G.Normal),[0,0,0,0],tn.RGBA,Ra.DEPTH_STENCIL_TEXTURE);for(;--i>0;)n.retain();return n}_renderSSAO(){const e=this._pluginInput.get("normals");this._plugins.produces(de.SSAO)&&e&&(this._bindParameters.ssao=this._plugins.render(de.SSAO,this._pluginInput),e.detachDepth(),e.release()&&this._pluginInput.delete("normals"))}_renderAllGeometry(e){this._renderContext.output=e,this._plugins.prepare(de.TRANSPARENT_TERRAIN),this._renderOpaqueGeometryAndTransparentMaterial(e),this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(e){this._renderContext.output=e,this._plugins.prepare(de.TRANSPARENT_MATERIAL),this._plugins.prepare(de.TRANSPARENT_NO_SSAO_DEPTH),this._renderOpaqueGeometry(),this._renderTransparentMaterial()}_renderGeometryForSSAO(e){this._renderContext.output=e,this._plugins.render(de.INTEGRATED_MESH),this._plugins.render(de.OPAQUE_TERRAIN),this._plugins.render(de.OPAQUE_MATERIAL),this._plugins.render(de.TRANSPARENT_MATERIAL),this._renderTransparentTerrain()}_prepareOpaqueGeometry(){this._plugins.prepare(de.INTEGRATED_MESH),this._plugins.prepare(de.OPAQUE_TERRAIN),this._plugins.prepare(de.OPAQUE_MATERIAL),this._plugins.prepare(de.OPAQUE_NO_SSAO_DEPTH),this._plugins.prepare(de.ENVIRONMENT_OPAQUE)}_renderOpaqueGeometry(){this._plugins.render(de.INTEGRATED_MESH),this._plugins.render(de.OPAQUE_TERRAIN),this._plugins.render(de.OPAQUE_MATERIAL),this._plugins.render(de.OPAQUE_NO_SSAO_DEPTH)}_renderTransparentMaterial(){this._plugins.render(de.TRANSPARENT_MATERIAL),this._plugins.render(de.TRANSPARENT_NO_SSAO_DEPTH)}_renderTransparentTerrain(){if(!this._plugins.produces(de.TRANSPARENT_TERRAIN))return;const e=()=>this._plugins.render(de.TRANSPARENT_TERRAIN,null);if(this._renderContext.output!==G.Color)return void e();const{width:r,height:i,depth:n}=this._offscreen,s=this.fboCache.acquire(r,i,"transparent terrain");return this._offscreen.renderToTargets(e,s,n,[0,0,0,0]),s}_renderHUDVisibility(e){this._plugins.produces(de.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._plugins.render(de.OCCLUSION_PIXELS),e),this._offscreen.bindFbo()):this._bindParameters.hudVisibility=lr(this._bindParameters.hudVisibility)}_renderLineCallouts(e){if(this._bindParameters.hudRenderStyle=e,e===cu.Occluded){const r=()=>{this._plugins.render(de.LINE_CALLOUTS)},{width:i,height:n,color:s}=this._offscreen,o=this.fboCache.acquireDepth(Ra.DEPTH16_BUFFER,i,n,"line callouts");this._offscreen.renderToTargets(r,s,o,void 0,!0,!0),o.release()}else this._plugins.render(de.LINE_CALLOUTS)}_renderLaserlines(){if(this._plugins.render(de.LASERLINES),this._plugins.produces(de.LASERLINES_CONTRAST_CONTROL)){const e=this._offscreen,{width:r,height:i,depth:n}=e,s=this.fboCache.acquire(r,i,"laser lines"),o=()=>this._plugins.render(de.LASERLINES_CONTRAST_CONTROL);e.renderToTargets(o,s,n,Qwe),e.compositeToFramebuffer(this._bindParameters,s.getTexture(),tl.PremultipliedAlpha,1),s.release()}}_renderHUD(e,r){if(this._pluginsHas.hudElements)if(this._oitEnabled){const i=this._renderOITPass(E3.HUD,e);this._rctx.bindFramebuffer(r==null?void 0:r.fbo),this._compositingHelper.composite(this._bindParameters,i.getTexture(),tl.PremultipliedAlpha),i.release()}else if(e===cu.Occluded){this._renderContext.output=G.Color;const i=()=>this._renderHUDElements(e),{width:n,height:s,color:o}=this._offscreen,a=this.fboCache.acquireDepth(Ra.DEPTH16_BUFFER,n,s,"hud");this._offscreen.renderToTargets(i,o,a,void 0,!0,!0),a.release()}else this._renderContext.output=G.Color,this._rctx.bindFramebuffer(null),r==null||r.acquireDepth(Ra.DEPTH16_BUFFER),this._rctx.bindFramebuffer(r==null?void 0:r.fbo),this._renderHUDElements(e),r==null||r.detachDepth()}_renderHUDElements(e){this._bindParameters.hudRenderStyle=e,this._plugins.prepare(de.LINE_CALLOUTS_HUD_DEPTH),this._plugins.prepare(de.HUD_MATERIAL),this._plugins.prepare(de.LABEL_MATERIAL),this._plugins.render(de.LINE_CALLOUTS_HUD_DEPTH),this._plugins.render(de.HUD_MATERIAL),this._plugins.render(de.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._plugins.produces(de.SHADOW_HIGHLIGHT)&&this._plugins.produces(de.OPAQUE_MATERIAL,G.ShadowHighlight)}_renderHighlightPrepass(){if(!this.hasHighlights)return;const e=()=>{this._renderAllGeometry(G.Highlight),this._rctx.clearSafe(Mi.DEPTH_BUFFER_BIT),this._renderHUDElements(cu.Both)},r=this._offscreen.renderToCachedFBO(null,"highlights",e,[0,0,0,0],tn.RGBA4,Ra.DEPTH_STENCIL_TEXTURE);return r.detachDepth(),r}_renderShadowHighlights(e,r){this.hasHighlights&&r.decorations!==Ac.OFF&&this._needsShadowHighlight&&this._offscreen.updateColor(i=>(this._pluginInput.set("highlights",e),this._plugins.render(de.SHADOW_HIGHLIGHT,this._pluginInput,i),i),"transparent-color")}_renderHighlights(e,r,i){this.hasHighlights&&i.decorations!==Ac.OFF&&this._plugins.produces(de.HIGHLIGHT)&&(this._pluginInput.set("highlights",r),this._plugins.render(de.HIGHLIGHT,this._pluginInput,e))}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(e,r,i){var n;this._needsShadowCast&&((n=this._bindParameters.linearDepth)!=null&&n.getTexture())&&this._shadowAccumulator.renderAccumulation(this._bindParameters.linearDepth,e,r,i)}_prepareTransparencySlots(){this._renderContext.output=G.Alpha,this._bindParameters.transparencyPassType=vt.Alpha,this._plugins.prepare(de.TRANSPARENT_MATERIAL),this._renderContext.output=G.Color,this._bindParameters.transparencyPassType=vt.Color,this._plugins.prepare(de.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=vt.FrontFace,this._plugins.prepare(de.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=vt.NONE}_renderOITPass(e,r=cu.Both){const i=e===E3.HUD,n=i?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oit hud composite"):null,s=i?()=>this._renderHUDElements(r):()=>this._renderTransparentMaterial(),o=this._renderContext.output;this._renderContext.output=G.Alpha,this._bindParameters.transparencyPassType=vt.Alpha;const a=this._offscreen.renderOITPass(s,vt.Alpha,i);this._renderContext.output=G.Color,this._bindParameters.transparencyPassType=vt.Color;const l=this._offscreen.renderOITPass(s,vt.Color,i);this._bindParameters.transparencyPassType=vt.FrontFace;const c=this._offscreen.renderOITPass(s,vt.FrontFace,i);return this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,l,a,c,n),n==null||n.detachDepth(),c.release(),l.release(),a.release(),this._bindParameters.transparencyPassType=vt.NONE,this._renderContext.output=o,n}_renderOccluded(){let e=0;Bp.clear(),this._plugins.plugins.forAll(a=>{a.materialReference&&a.queryRenderOccludedState(Wr.OccludeAndTransparentStencil)&&(e|=Wr.OccludeAndTransparentStencil,Bp.push(a))});const r=this._offscreen,i=(a,l,c,u,h)=>{if(!(e&l))return;const{width:p,height:f,depth:g}=r,y=this.fboCache.acquire(p,f,"tmp color");r.renderToTargets(c,y,g,[0,0,0,0],u,h),r.compositeToFramebuffer(this._bindParameters,y.getTexture(),tl.PremultipliedAlpha,a),y.release()},n=(a,l)=>{this._bindParameters.slot=a,l.forAll(c=>{if(vee(c)){const u=c.prepareTechnique(this._renderContext);u&&c.renderNode(this._renderContext,u)}})};Bp.length!==0&&(n(de.OCCLUDER_MATERIAL,Bp),i(.5,Wr.OccludeAndTransparentStencil,()=>n(de.TRANSPARENT_OCCLUDER_MATERIAL,Bp),!1,!1)),Bp.clear(),this._plugins.plugins.forAll(a=>{if(!a.materialReference)return;const l=a.queryRenderOccludedState(Wr.OccludeAndTransparent),c=a.queryRenderOccludedState(Wr.Transparent),u=a.queryRenderOccludedState(Wr.Opaque);(l||c||u)&&(e|=l?Wr.OccludeAndTransparent:c?Wr.Transparent:Wr.Opaque,Bp.push(a))});const s=this._plugins.renderOccludedFlags;if(e|=s,!e)return;const o=a=>{this._renderContext.renderOccludedMask=a,s>Wr.Occlude&&this._plugins.render(de.OCCLUDED_TERRAIN),n(de.OPAQUE_MATERIAL,Bp),n(de.TRANSPARENT_MATERIAL,Bp),n(de.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Bp),this._renderContext.renderOccludedMask=G9};this._renderContext.output=G.Color,i(.5,Wr.OccludeAndTransparent,()=>o(Wr.OccludeAndTransparent),!0,Lc.OutlineVisualElementMask),i(.5,Wr.Transparent,()=>o(Wr.Transparent),!0,Lc.OutlineVisualElementMask),i(1,Wr.Opaque,()=>o(Wr.Opaque),!0,Lc.OutlineVisualElementMask),Bp.clear()}_invokeRenderNodes(e){return this._nodes.render(e,this._pluginInput,this._releaseNormals)}_renderComposite(e,r){this._offscreen.updateColor(n=>(this._pluginInput.set("highlights",r),n=this._nodes.render(n,this._pluginInput,this._releaseNormals),this._pluginInput.set(n.name,n),this._pluginInput.delete("highlights"),n),"composite-color");const i=this._plugins.produces(de.ANTIALIASING);return this._plugins.render(i?de.ANTIALIASING:de.BLIT,this._pluginInput,e)}_ensureBindParametersCamera(e,r){this._bindParameters.camera=e,this._bindParameters.contentCamera=r}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=fn:(us(exe,this._bindParameters.camera.viewMatrix),us(Kwe,this._bindParameters.camera.projectionMatrix),Kr(WE,exe,Kwe),Kr(WE,this._renderContext.lastFrameCamera.viewMatrix,WE),Kr(WE,this._renderContext.lastFrameCamera.projectionMatrix,WE),this._reprojectionMatrix=WE);const r=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=r>0?Math.min(r,e-this._ssrEnableTime)/r:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=fn,this._ssrEnableTime=null}addRenderNode(e){this._nodes.add(e),this._requestRender()}removeRenderNode(e){this._nodes.remove(e),this._requestRender()}get usedMemory(){var e;return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:((e=this.edgeView)==null?void 0:e.usedMemory)??0}}get test(){return{offscreen:this._offscreen,shadowMap:this._shadowMap,highlight:this._highlight,lighting:this._bindParameters.lighting,renderPlugins:this._plugins,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{this._renderStateFeatures.value=nq(),this._plugins.renderFeatureChanged(),this._requestRender()},getFramebufferTexture:e=>{var r,i;switch(e){case C3.Color:return this._offscreen.colorTexture;case C3.LinearDepth:return(r=this._bindParameters.linearDepth)==null?void 0:r.getTexture();case C3.ShadowMap:return this._shadowMap.depthTexture;case C3.HudVisibility:return(i=this._bindParameters.hudVisibility)==null?void 0:i.getTexture()}},debugLinearDepth:e=>{this._debugLinearDepth=e,this._requestRender()}}}};var E3,C3;d([m({readOnly:!0})],AC.prototype,"fullResolutionAtmosphere",null),d([m()],AC.prototype,"_smaa",void 0),d([m()],AC.prototype,"_blit",void 0),d([m()],AC.prototype,"_edgeView",void 0),d([m()],AC.prototype,"updating",null),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(E3||(E3={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.ShadowMap=2]="ShadowMap",t[t.HudVisibility=3]="HudVisibility"}(C3||(C3={}));const Qwe=[0,0,0,0],Bp=new jt,Kwe=xe(),exe=xe(),WE=xe();function Ckt(t){return e=>t.immediate.schedule(e)}let Pkt=class{constructor(e){this._rctx=e,this._vao=Akt(e)}destroy(){this._vao=wt(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(dr.TRIANGLES,0,3))}get test(){var e,r,i,n;return{cachedWebGLObjects:mY((e=this._vao)==null?void 0:e.glName)+mY((i=(r=this._vao)==null?void 0:r.indexBuffer)==null?void 0:i.glName)+mY((n=this._vao)==null?void 0:n.vertexBuffers.geometry)}}};function Akt(t,e=sae,r=Nr){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new wm(t,r,{geometry:e},{geometry:ti.createVertex(t,Lr.STATIC_DRAW,i)})}function mY(t){return t!=null?1:0}let L9e=class D9e{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=D9e.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return ti.createIndex(this._rctx,Lr.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Tt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(dr.POINTS,1,et.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){var e;return{cachedWebGLObjects:(e=this._indexBuffer)!=null&&e.glName?1:0}}},txe=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Ee.ONE,dstRGB:Ee.ZERO,srcAlpha:Ee.ONE,dstAlpha:Ee.ZERO},this.blendEquation={mode:py.ADD,modeAlpha:py.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Vf.BACK,this.frontFace=lA.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=si.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Vf.FRONT_AND_BACK,func:si.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Vf.FRONT_AND_BACK,fail:vn.KEEP,zFail:vn.KEEP,zPass:vn.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},Okt=class{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<ss.COUNT;)this._current.push(0)}increment(e,r,i=1){var n;this._current[e]+=i,(n=this._allocations)==null||n.add(r)}decrement(e,r,i=1){var n;this._current[e]-=i,(n=this._allocations)==null||n.remove(r)}get current(){return this._current}get total(){return this.current.reduce((e,r,i)=>e+(i<ss.UNCOUNTED?r:0),0)}get resourceInformation(){var r;let e="";if(this.total>0){e+=`Live objects:
`;for(let i=0;i<ss.COUNT;++i){const n=this._current[i];n>0&&(e+=`${ss[i]}: ${n}
`)}}return e+=(r=this._allocations)==null?void 0:r.resetLog(),e}},Mkt=class{constructor(e,r,i){const n=r.textureFilterAnisotropic,s=i.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=n?Math.min(e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY),s):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)}};const Rkt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var rxe,N9e={exports:{}};(rxe=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(N9e.exports=rxe);const $kt=hN(N9e.exports);var ixe,F9e={exports:{}};ixe=F9e,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(ixe.exports=e)}();const nxe=hN(F9e.exports);var k9e={exports:{}};(function(t){(function(e){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(t.exports=r)})()})(k9e);const Ikt=hN(k9e.exports);var Gp=999,sxe=9999,gY=0,yY=1,oxe=2,axe=3,lxe=4,yk=5,Lkt=6,Dkt=7,Nkt=8,cxe=9,Fkt=10,uxe=11,kkt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function Ukt(){var t,e,r,i=0,n=0,s=Gp,o=[],a=[],l=1,c=0,u=0,h=!1,p=!1,f="";return function(V){return a=[],V!==null?y(V.replace?V.replace(/\r\n/g,`
`):V):v()};function g(V){V.length&&a.push({type:kkt[s],data:V,position:u,line:l,column:c})}function y(V){var J;for(i=0,r=(f+=V).length;t=f[i],i<r;){switch(J=i,s){case gY:i=E();break;case yY:i=S();break;case oxe:i=x();break;case axe:i=P();break;case lxe:i=U();break;case uxe:i=L();break;case yk:i=z();break;case sxe:i=W();break;case cxe:i=w();break;case Gp:i=b()}J!==i&&(f[J]===`
`?(c=0,++l):++c)}return n+=i,f=f.slice(i),a}function v(V){return o.length&&g(o.join("")),s=Fkt,g("(eof)"),a}function b(){return o=o.length?[]:o,e==="/"&&t==="*"?(u=n+i-1,s=gY,e=t,i+1):e==="/"&&t==="/"?(u=n+i-1,s=yY,e=t,i+1):t==="#"?(s=oxe,u=n+i,i):/\s/.test(t)?(s=cxe,u=n+i,i):(h=/\d/.test(t),p=/[^\w_]/.test(t),u=n+i,s=h?lxe:p?axe:sxe,i)}function w(){return/[^\s]/g.test(t)?(g(o.join("")),s=Gp,i):(o.push(t),e=t,i+1)}function x(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,i+1):(g(o.join("")),s=Gp,i)}function S(){return x()}function E(){return t==="/"&&e==="*"?(o.push(t),g(o.join("")),s=Gp,i+1):(o.push(t),e=t,i+1)}function P(){if(e==="."&&/\d/.test(t))return s=yk,i;if(e==="/"&&t==="*")return s=gY,i;if(e==="/"&&t==="/")return s=yY,i;if(t==="."&&o.length){for(;M(o););return s=yk,i}if(t===";"||t===")"||t==="("){if(o.length)for(;M(o););return g(t),s=Gp,i+1}var V=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||V){for(;M(o););return s=Gp,i}return o.push(t),e=t,i+1}function M(V){for(var J,Y,X=0;;){if(J=nxe.indexOf(V.slice(0,V.length+X).join("")),Y=nxe[J],J===-1){if(X--+V.length>0)continue;Y=V.slice(0,1).join("")}return g(Y),u+=Y.length,(o=o.slice(Y.length)).length}}function L(){return/[^a-fA-F0-9]/.test(t)?(g(o.join("")),s=Gp,i):(o.push(t),e=t,i+1)}function U(){return t==="."||/[eE]/.test(t)?(o.push(t),s=yk,e=t,i+1):t==="x"&&o.length===1&&o[0]==="0"?(s=uxe,o.push(t),e=t,i+1):/[^\d]/.test(t)?(g(o.join("")),s=Gp,i):(o.push(t),e=t,i+1)}function z(){return t==="f"&&(o.push(t),e=t,i+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,i+1):/[^\d]/.test(t)?(g(o.join("")),s=Gp,i):(o.push(t),e=t,i+1)}function W(){if(/[^\d\w_]/.test(t)){var V=o.join("");return s=$kt.indexOf(V)>-1?Nkt:Ikt.indexOf(V)>-1?Dkt:Lkt,g(o.join("")),s=Gp,i}return o.push(t),e=t,i+1}}function zkt(t){var e=Ukt(),r=[];return r=(r=r.concat(e(t))).concat(e(null))}function Vkt(t){return zkt(t)}function Bkt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const _Y=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function Gkt(t,e="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of t)if(n.type==="preprocessor"){const s=i.exec(n.data);if(s){const o=s[1].replaceAll(/\s\s+/g," ");if(o===r)return o;if(o===e)return n.data="#version "+r,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function jkt(t,e){for(let r=e-1;r>=0;r--){const i=t[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function F$(t,e,r,i){i=i||r;for(const n of t)if(n.type==="ident"&&n.data===r)return i in e?e[i]++:e[i]=0,F$(t,e,i+"_"+e[i],i);return r}function U9e(t,e,r="afterVersion"){function i(l,c){for(let u=c;u<l.length;u++){const h=l[u];if(h.type==="operator"&&h.data===";")return u}return null}function n(l){let c=-1,u=0,h=-1;for(let p=0;p<l.length;p++){const f=l[p];if(f.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(f.data)?++u:/\#endif\s*.*/.test(f.data)&&--u),r!=="afterVersion"&&r!=="afterPrecision"||f.type==="preprocessor"&&f.data.startsWith("#version")&&(h=Math.max(h,p)),r==="afterPrecision"&&f.type==="keyword"&&f.data==="precision"){const g=i(l,p);if(g===null)throw new Error("precision statement not followed by any semicolons!");h=Math.max(h,g)}c<h&&u===0&&(c=p)}return c+1}const s={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=n(t);o(a-1)&&t.splice(a++,0,s);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,s)}function Hkt(t,e,r,i="lowp"){U9e(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function qkt(t,e,r,i,n="lowp"){U9e(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Wkt(t,e){let r,i,n=-1;for(let s=e;s<t.length;s++){const o=t[s];if(o.type==="operator"&&(o.data==="["&&(r=s),o.data==="]")){i=s;break}o.type==="integer"&&(n=parseInt(o.data,10))}return r&&i&&t.splice(r,i-r+1),n}function hxe(t,e){if(t.startsWith("#version 300"))return t;const r=Vkt(t);if(Gkt(r,"100","300 es")==="300 es")return t;let i=null,n=null;const s={},o={};for(let a=0;a<r.length;++a){const l=r[a];switch(l.type){case"keyword":e===Ph.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===Ph.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===Ph.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(i||(i=F$(r,s,"fragColor"),Hkt(r,i,"vec4")),l.data=i),e===Ph.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=Wkt(r,a+1),u=F$(r,s,"fragData");qkt(r,u,"vec4",c,"mediump"),l.data=u}else e===Ph.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(n||(n=F$(r,s,"gl_FragDepth")),l.data=n);break;case"ident":if(Rkt.includes(l.data)){if(e===Ph.VERTEX_SHADER&&jkt(r,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=F$(r,s,l.data)),l.data=o[l.data]}}}for(let a=r.length-1;a>=0;--a){const l=r[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&_Y.has(c[1].trim())){const p=r[a+1];r.splice(a,p&&p.type==="whitespace"?2:1)}const u=l.data.match(/\#ifdef\s+(.*)/);u&&u[1]&&_Y.has(u[1].trim())&&(l.data="#if 1");const h=l.data.match(/\#ifndef\s+(.*)/);h&&h[1]&&_Y.has(h[1].trim())&&(l.data="#if 0")}}return Ykt(t,Bkt(r))}function Ykt(t,e){return e}const Xkt=4294967295;let Zkt=class{constructor(e,r,i,n,s=new Map,o=[]){var c;this._context=e,this._locations=n,this._uniformBlockBindings=s,this._transformFeedbackVaryings=o,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),r=hxe(r,Ph.VERTEX_SHADER),i=hxe(i,Ph.FRAGMENT_SHADER),this._vShader=dxe(this._context,Ph.VERTEX_SHADER,r),this._fShader=dxe(this._context,Ph.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(ss.Shader,this),oee()&&(this.vertexShader=r,this.fragmentShader=i),this.usedMemory=r.length+i.length;const a=this._context.gl,l=a.createProgram();a.attachShader(l,this._vShader),a.attachShader(l,this._fShader),this._locations.forEach((u,h)=>a.bindAttribLocation(l,u,h)),(c=this._transformFeedbackVaryings)!=null&&c.length&&a.transformFeedbackVaryings(l,this._transformFeedbackVaryings,a.SEPARATE_ATTRIBS),a.linkProgram(l),oee()&&!a.getProgramParameter(l,a.LINK_STATUS)&&console.error(`Could not link shader
validated: ${a.getProgramParameter(l,a.VALIDATE_STATUS)}, gl error ${a.getError()}, vertex: ${a.getShaderParameter(this._vShader,a.COMPILE_STATUS)}, fragment: ${a.getShaderParameter(this._fShader,a.COMPILE_STATUS)}, info log: ${a.getProgramInfoLog(l)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[u,h]of this._uniformBlockBindings){const p=a.getUniformBlockIndex(l,u);p<Xkt&&a.uniformBlockBinding(l,p,h)}this._glName=l,this._context.instanceCounter.increment(ss.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get hasTransformFeedbackVaryings(){var e;return!!((e=this._transformFeedbackVaryings)!=null&&e.length)}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,r=this._context.instanceCounter;this._nameToUniformLocation.forEach(i=>i&&r.decrement(ss.Uniform,i)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(r.decrement(ss.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,r.decrement(ss.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,r.decrement(ss.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const r=this._nameToUniformLocation.get(e);if(r!==void 0)return r;if(this.glName){const i=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,i),i&&this._context.instanceCounter.increment(ss.Uniform,i),i}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,r){const i=this._nameToUniform1.get(e);i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(e),r),this._nameToUniform1.set(e,r))}setUniform1iv(e,r){Ym(this._nameToUniform1v,e,r)&&this._context.gl.uniform1iv(this._getUniformLocation(e),r)}setUniform2iv(e,r){Ym(this._nameToUniform2,e,r)&&this._context.gl.uniform2iv(this._getUniformLocation(e),r)}setUniform3iv(e,r){Ym(this._nameToUniform3,e,r)&&this._context.gl.uniform3iv(this._getUniformLocation(e),r)}setUniform4iv(e,r){Ym(this._nameToUniform4,e,r)&&this._context.gl.uniform4iv(this._getUniformLocation(e),r)}setUniform1f(e,r){const i=this._nameToUniform1.get(e);i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(e),r),this._nameToUniform1.set(e,r))}setUniform1fv(e,r){Ym(this._nameToUniform1v,e,r)&&this._context.gl.uniform1fv(this._getUniformLocation(e),r)}setUniform2f(e,r,i){const n=this._nameToUniform2.get(e);n===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),this._nameToUniform2.set(e,[r,i])):r===n[0]&&i===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),n[0]=r,n[1]=i)}setUniform2fv(e,r){Ym(this._nameToUniform2,e,r)&&this._context.gl.uniform2fv(this._getUniformLocation(e),r)}setUniform3f(e,r,i,n){const s=this._nameToUniform3.get(e);s===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,n),this._nameToUniform3.set(e,[r,i,n])):r===s[0]&&i===s[1]&&n===s[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,n),s[0]=r,s[1]=i,s[2]=n)}setUniform3fv(e,r){const i=this._getUniformLocation(e);i!=null&&Ym(this._nameToUniform3,e,r)&&this._context.gl.uniform3fv(i,r)}setUniform4f(e,r,i,n,s){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,n,s),this._nameToUniform4.set(e,[r,i,n,s])):o!==void 0&&r===o[0]&&i===o[1]&&n===o[2]&&s===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,n,s),o[0]=r,o[1]=i,o[2]=n,o[3]=s)}setUniform4fv(e,r){const i=this._getUniformLocation(e);i!=null&&Ym(this._nameToUniform4,e,r)&&this._context.gl.uniform4fv(i,r)}setUniformMatrix3fv(e,r,i=!1){const n=this._getUniformLocation(e);n!=null&&Ym(this._nameToUniformMatrix3,e,r)&&this._context.gl.uniformMatrix3fv(n,i,r)}setUniformMatrix4fv(e,r,i=!1){const n=this._getUniformLocation(e);n!=null&&Ym(this._nameToUniformMatrix4,e,r)&&this._context.gl.uniformMatrix4fv(n,i,r)}stop(){}};function dxe(t,e,r){const i=t.gl,n=i.createShader(e);return i.shaderSource(n,r),i.compileShader(n),oee()&&!i.getShaderParameter(n,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Ph.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(n)),console.error(Jkt(r))),n}function Jkt(t){let e=2;return t.replaceAll(`
`,()=>`
`+Qkt(e++)+":")}function Qkt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Ym(t,e,r){const i=t.get(e);if(!i)return t.set(e,Array.from(r)),!0;const n=r.length;if(i.length!==n)return t.set(e,Array.from(r)),!0;for(let s=0;s<n;++s){const o=r[s];if(i[s]!==o){for(i[s]=o;s<n;++s)i[s]=r[s];return!0}}return!1}let Kkt=class{constructor(e){this._rctx=e,this._store=new Hb}dispose(){this._store.forEach(e=>e.forEach(r=>r.dispose())),this._store.clear()}acquire(e,r,i,n){const s=this._store.get(e,r);if(s!=null)return s.ref(),s;const o=new Zkt(this._rctx,e,r,i,n);return o.ref(),this._store.set(e,r,o),o}get test(){let e=0;return this._store.forEach(r=>r.forEach(i=>e+=i.hasGLName?2:1)),{cachedWebGLProgramObjects:e}}},JN=class{constructor(){this._result=!1}dispose(){this._program=wt(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},e6t=class extends JN{constructor(e){super(),this._rctx=e,this._helperProgram=null,ne("mac")&&ne("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var e;super.dispose(),(e=this._helperProgram)==null||e.dispose(),this._helperProgram=null}_test(e){const r=this._rctx,i=r.getBoundFramebufferObject(),{x:n,y:s,width:o,height:a}=r.getViewport();r.resetState();const l=new ui(1);l.wrapMode=nr.CLAMP_TO_EDGE,l.samplingMode=Kt.NEAREST;const c=new xm(r,l),u=ti.createIndex(this._rctx,Lr.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(c),r.setViewport(0,0,1,1),r.useProgram(this._helperProgram),r.bindBuffer(u,Tt.ELEMENT_ARRAY_BUFFER),r.drawElements(dr.POINTS,1,et.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(dr.TRIANGLES,0,258);const h=new Uint8Array(4);return c.readPixels(0,0,1,1,Ot.RGBA,Ks.UNSIGNED_BYTE,h),r.setViewport(n,s,o,a),r.bindFramebuffer(i),c.dispose(),u.dispose(),h[0]===255}_prepareProgram(){const r=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${T.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${T.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareHelperProgram(){const e=L9e.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},t6t=class extends JN{constructor(e){super(),this._rctx=e,this._program=pxe(this._rctx,!1),this._obfuscated=pxe(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=wt(this._obfuscated)}_test(e){if(ne("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const r=this._rctx,i=r.getBoundFramebufferObject(),{x:n,y:s,width:o,height:a}=r.getViewport(),l=this._runProgram(e),c=this._runProgram(this._obfuscated);return r.setViewport(n,s,o,a),r.bindFramebuffer(i),l!==0&&(c===0||l/c>5)}_runProgram(e){const r=this._rctx;r.resetState();const i=new ui(1);i.wrapMode=nr.CLAMP_TO_EDGE,i.samplingMode=Kt.NEAREST;const n=new xm(r,i),s=ti.createVertex(r,Lr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new fp(r,new Map([["position",0]]),{geometry:[new da("position",2,et.UNSIGNED_SHORT,0,4)]},{geometry:s}),a=Ce(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Ce(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);tJ(a,c,3);const u=new Float32Array(6);tJ(l,u,3),r.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",u[0],u[2],u[4]),e.setUniform3f("u_lowB",u[1],u[3],u[5]),r.bindFramebuffer(n),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(dr.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);n.readPixels(0,0,1,1,Ot.RGBA,Ks.UNSIGNED_BYTE,h),o.dispose(),n.dispose();const p=(a[2]-l[2])/25,f=Ale(h);return Math.abs(p-f)}};function pxe(t,e){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `;return t.programCache.acquire(r,`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,new Map([["position",0]]))}let r6t=class extends JN{constructor(e){var n,s;if(super(),this._rctx=e,!e.gl||!((n=e.capabilities.colorBufferFloat)!=null&&n.textureFloat&&((s=e.capabilities.colorBufferFloat)!=null&&s.floatBlend)))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new ui(1);i.wrapMode=nr.CLAMP_TO_EDGE,i.dataType=Ks.FLOAT,i.internalFormat=at.RGBA32F,i.samplingMode=Kt.NEAREST;const n=new xm(r,i),s=ti.createVertex(r,Lr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new fp(r,new Map([["a_pos",0]]),{geometry:[new da("a_pos",2,et.UNSIGNED_SHORT,0,4)]},{geometry:s});r.useProgram(e);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:u,height:h}=r.getViewport();r.bindFramebuffer(n),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(dr.TRIANGLE_STRIP,0,4);const p=Bt({blending:G4e});r.setPipelineState(p),r.drawArrays(dr.TRIANGLE_STRIP,0,4);const f=r.gl.getError();return r.setViewport(l,c,u,h),r.bindFramebuffer(a),o.dispose(),n.dispose(),f!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},i6t=class extends JN{constructor(e){super(),this._rctx=e;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new ui(1);i.wrapMode=nr.CLAMP_TO_EDGE,i.samplingMode=Kt.NEAREST;const n=new xm(r,i),s=new Uint8Array(4),o=ti.createVertex(r,Lr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new fp(r,new Map([["a_position",0]]),{geometry:[new da("a_position",2,et.SHORT,0,4)]},{geometry:o});r.useProgram(e);const l=new Mr(r,i,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),r.bindTexture(l,0);const c=r.getBoundFramebufferObject();r.bindFramebuffer(n),r.useProgram(e);const{x:u,y:h,width:p,height:f}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(a),r.drawArrays(dr.TRIANGLE_STRIP,0,4),r.setViewport(u,h,p,f),n.readPixels(0,0,1,1,Ot.RGBA,Ks.UNSIGNED_BYTE,s),a.dispose(),n.dispose();const g=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return g&&K.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),r.bindFramebuffer(c),g}};new da("a_pos",2,et.BYTE,0,2);new da("a_pos",2,et.BYTE,0,4),new da("a_tex",2,et.BYTE,2,4);const n6t={geometry:[new da("a_pos",2,et.UNSIGNED_SHORT,0,4)]};let s6t=class extends JN{constructor(e){super(),this._rctx=e;const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const r=this._rctx;if(!r.gl)return e.dispose(),!0;const i=new ui(1);i.wrapMode=nr.CLAMP_TO_EDGE,i.samplingMode=Kt.NEAREST;const n=new xm(r,i),s=ti.createVertex(r,Lr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new fp(r,new Map([["a_pos",0]]),n6t,{geometry:s}),a=new ui;a.samplingMode=Kt.LINEAR,a.wrapMode=nr.CLAMP_TO_EDGE;const l=new Mr(r,a,k$);r.useProgram(e),r.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=r.getBoundFramebufferObject(),{x:u,y:h,width:p,height:f}=r.getViewport();r.bindFramebuffer(n),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(Mi.COLOR_BUFFER_BIT),r.bindVAO(o),r.drawArrays(dr.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return n.readPixels(0,0,1,1,Ot.RGBA,Ks.UNSIGNED_BYTE,g),o.dispose(),n.dispose(),l.dispose(),r.setViewport(u,h,p,f),r.bindFramebuffer(c),g[0]!==255}};const k$=new Image;k$.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",k$.width=5,k$.height=5,k$.decode();let o6t=class{constructor(e){this.rctx=e,this.floatBufferBlend=new r6t(e),this.svgPremultipliesAlpha=new s6t(e),this.doublePrecisionRequiresObfuscation=new t6t(e),this.ignoresSamplerPrecision=new i6t(e),this.drawArraysRequiresIndicesTypeReset=new e6t(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function a6t(t,e){if(e.compressedTextureETC)return null;const r=t.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function l6t(t,e){if(e.compressedTextureS3TC)return null;const r=t.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function c6t(t,e){if(e.textureFilterAnisotropic)return null;const r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function u6t(t,e){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!n,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}function fxe(t,e,r,i,n){if(i)return!0;if(e[r])return!1;for(const s of n)if(t.getExtension(s))return!0;return!1}function h6t(t,e){if(e.textureNorm16)return null;const r=t.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function d6t(t,e){const r=e.loseContext&&t.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}let p6t=class{constructor(e,r){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=a6t(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=l6t(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=c6t(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=xkt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){if(!this._textureFloat){const{textureFloatLinear:e}=this._disabledExtensions;this._textureFloat={textureFloatLinear:!e&&!!this._gl.getExtension("OES_texture_float_linear")}}return this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=u6t(this._gl,this._disabledExtensions)),this._colorBufferFloat}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=fxe(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=d6t(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=h6t(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=fxe(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},f6t=class{constructor(e,r){this.gl=e,this.instanceCounter=new Okt,this.programCache=new Kkt(this),this._transformFeedbackRequestInfo=null,this._state=new txe,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(r)}configure(e){this._capabilities=new p6t(this.gl,e),this._parameters=new Mkt(this.gl,this._capabilities,e),Mr.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new txe,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new Cpt({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const n=i.color;this.setBlendColor(n.r,n.g,n.b,n.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const n=i.function;this.setStencilFunction(n.func,n.ref,n.mask);const s=i.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)},setDrawBuffers:i=>{const{gl:n}=this;if(i)n.drawBuffers(i.buffers);else{const{drawFramebuffer:s}=this._state;s===null||s.colorAttachments.length===0?n.drawBuffers([nee.BACK]):n.drawBuffers([Vl.COLOR_ATTACHMENT0])}}}),this.enforceState(),wt(this._driverTest),this._driverTest=new o6t(this)}dispose(){wt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Tt.ARRAY_BUFFER),this.unbindBuffer(Tt.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(Tt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Tt.PIXEL_PACK_BUFFER),this.unbindBuffer(Tt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Tt.COPY_READ_BUFFER),this.unbindBuffer(Tt.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,wf()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,r){for(let i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,r,i,n){e===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&n===this._state.blendColor.a||(this.gl.blendColor(e,r,i,n),this._state.blendColor.r=e,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=n,this._stateTracker.invalidateBlending())}setBlendFunction(e,r){e===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,r,i,n){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===n||(this.gl.blendFuncSeparate(e,r,i,n),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=n,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,r){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(e,r),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(e,r,i,n){this._state.colorMask.r===e&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===n||(this.gl.colorMask(e,r,i,n),this._state.colorMask.r=e,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=n,this._stateTracker.invalidateColorWrite())}setClearColor(e,r,i,n){this._state.clearColor.r===e&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===n||(this.gl.clearColor(e,r,i,n),this._state.clearColor.r=e,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=n)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,r){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=r,this.gl.polygonOffset(e,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,r,i,n){this._state.scissorRect.x===e&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===n||(this.gl.scissor(e,r,i,n),this._state.scissorRect.x=e,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=n)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,r){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===r||(this.gl.depthRange(e,r),this._state.depthRange.zNear=e,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,r,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,r,i),this._state.stencilFunction.face=Vf.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,r,i,n){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===n||(this.gl.stencilFuncSeparate(e,r,i,n),this._state.stencilFunction.face=e,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,r,i){this._state.stencilOperation.face===Vf.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,r,i),this._state.stencilOperation.face=Vf.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,r,i,n){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===n||(this.gl.stencilOpSeparate(e,r,i,n),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,r=!1){const i=this._state.activeTexture;return e>=0&&(r||e!==this._state.activeTexture)&&(this.gl.activeTexture(PH+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,r=255){e&&(e&Mi.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&Mi.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Mi.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(e))}clearFramebuffer(e,r=!1,i=!1){let n=0;if(e){const o=Math.max(1e-13,e[3]);this.setClearColor(e[0],e[1],e[2],o),n|=Mi.COLOR_BUFFER_BIT}r&&(n|=Mi.DEPTH_BUFFER_BIT),i===!1?i=0:(i===!0&&(i=255),n|=Mi.STENCIL_BUFFER_BIT),n&&this.clearSafe(n,i)}drawArrays(e,r,i){var n,s;if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(((n=this._state.program)==null?void 0:n.hasTransformFeedbackVaryings)==null)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if(wf()){this._numOfDrawCalls++,this._numOfTriangles+=mxe(e,i);const o=this._state.textureUnitMap;for(let a=0;a<o.length;a++){const l=o[a];if(l!=null&&l===((s=this._state.drawFramebuffer)==null?void 0:s.colorTexture))throw new Error(`Detected readWrite. Texture already bound at index ${a}`)}}this.gl.drawArrays(e,r,i),Rg(this.gl)}drawArraysInstanced(e,r,i,n){this.gl.drawArraysInstanced(e,r,i,n),Rg(this.gl)}drawElements(e,r,i,n){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if(wf()&&(this._numOfDrawCalls++,this._numOfTriangles+=mxe(e,r)),this.gl.drawElements(e,r,i,n),wf()){const s=tDe(this);if(s){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},u={mode:e,count:r,type:i,offset:n},h=(a==null?void 0:a.size)??0,p=n+r,f=h<p?`. Buffer is too small. Attempted to draw index ${p} of ${h}`:"";console.error(`drawElements: ${s}${f}`,{args:u,vao:c})}}}logInfo(){wf()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){wf()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,r,i,n){i=Math.max(Math.round(i),1),n=Math.max(Math.round(n),1);const s=this._state.viewport;s.x===e&&s.y===r&&s.width===i&&s.height===n||(s.x=e,s.y=r,s.width=i,s.height=n,this.gl.viewport(e,r,i,n))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport({x:e,y:r,width:i,height:n}){this.setViewport(e,r,i,n)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var r;this._state.program!==e&&((r=this._state.program)==null||r.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const n=this._state.textureUnitMap[r];return(e==null?void 0:e.glName)==null?(n!=null&&(this.setActiveTexture(r,i),this.gl.bindTexture(n.descriptor.target,null)),this._state.textureUnitMap[r]=null,n):i||n!==e?(this.setActiveTexture(r,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[r]=e,n):(e.isDirty&&(this.setActiveTexture(r,i),e.applyChanges()),n)}unbindTexture(e){if(e!=null)for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===e&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(e,r=!1){if(r||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),e==null)return this.gl.bindFramebuffer(Ja.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(Ja.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,r,i=!1){const n=r===Ja.READ_FRAMEBUFFER,s=n?this._state.readFramebuffer:this._state.drawFramebuffer;(i||s!==e)&&(e==null?this.gl.bindFramebuffer(r,null):e.initializeAndBind(r),n?this._state.readFramebuffer=e??null:this._state.drawFramebuffer=e??null)}blitFramebuffer(e,r,i=0,n=0,s=e.width,o=e.height,a=0,l=0,c=r.width,u=r.height,h=Mi.COLOR_BUFFER_BIT,p=Kt.NEAREST){this.bindFramebufferSeparate(e,Ja.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,Ja.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,n,s,o,a,l,c,u,h,p)}bindBuffer(e,r){if(e)switch(r??(r=e.bufferType),r){case Tt.ARRAY_BUFFER:this._state.vertexBuffer=pc(this.gl,e,r,this._state.vertexBuffer);break;case Tt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=pc(this.gl,e,r,this._state.indexBuffer);break;case Tt.UNIFORM_BUFFER:this._state.uniformBuffer=pc(this.gl,e,r,this._state.uniformBuffer);break;case Tt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=pc(this.gl,e,r,this._state.pixelPackBuffer);break;case Tt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=pc(this.gl,e,r,this._state.pixelUnpackBuffer);break;case Tt.COPY_READ_BUFFER:this._state.copyReadBuffer=pc(this.gl,e,r,this._state.copyReadBuffer);break;case Tt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=pc(this.gl,e,r,this._state.copyWriteBuffer);break;case Tt.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=pc(this.gl,e,r,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const r=this.gl;e||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(r.bindRenderbuffer(r.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=e===Tt.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let n=i[r];return n==null&&(n={buffer:null,offset:0,size:0},i[r]=n),n}bindBufferBase(e,r,i){const n=this._getBufferBinding(e,r);n!=null&&(n.buffer===i&&n.offset===0&&n.size===0||(this.gl.bindBufferBase(e,r,i?i.glName:null),n.buffer=i,n.offset=0,n.size=0))}bindBufferRange(e,r,i,n,s){const o=this._getBufferBinding(e,r);o!=null&&(o.buffer===i&&o.offset===n&&o.size===s||(n%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(e,r,i.glName,n,s),o.buffer=i,o.offset=n,o.size=s):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,r,i,n){r!=null?(wf()&&(n??r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&n!==void 0?this.bindBufferRange(Tt.UNIFORM_BUFFER,e,r.buffer,i,n):this.bindBufferBase(Tt.UNIFORM_BUFFER,e,r.buffer)):this.bindBufferBase(Tt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const n=this._state.uniformBufferBindingPoints[r];n!=null&&n.buffer===e.buffer&&this.bindBufferBase(Tt.UNIFORM_BUFFER,r,null)}}unbindBuffer(e){switch(e){case Tt.ARRAY_BUFFER:this._state.vertexBuffer=pc(this.gl,null,e,this._state.vertexBuffer);break;case Tt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=pc(this.gl,null,e,this._state.indexBuffer);break;case Tt.UNIFORM_BUFFER:this._state.uniformBuffer=pc(this.gl,null,e,this._state.uniformBuffer);break;case Tt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=pc(this.gl,null,e,this._state.pixelPackBuffer);break;case Tt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=pc(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Tt.COPY_READ_BUFFER:this._state.copyReadBuffer=pc(this.gl,null,e,this._state.copyReadBuffer);break;case Tt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=pc(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(e){const{gl:r}=this;r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,r){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,e.glName),i.beginTransformFeedback(r),this._transformFeedbackRequestInfo={primitiveType:r}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(e=10){const{gl:r}=this,i=r.fenceSync(see.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let n;this.instanceCounter.increment(ss.Sync,i),r.flush();do await LL(e),n=r.clientWaitSync(i,0,0);while(n===l9.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(ss.Sync,i),r.deleteSync(i),n===l9.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=Ja.FRAMEBUFFER){return e===Ja.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Tt.ARRAY_BUFFER),this.unbindBuffer(Tt.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(Tt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Tt.PIXEL_PACK_BUFFER),this.unbindBuffer(Tt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Tt.COPY_READ_BUFFER),this.unbindBuffer(Tt.COPY_WRITE_BUFFER);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Ee.ONE,Ee.ZERO),this.setBlendEquation(py.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Vf.BACK),this.setFrontFace(lA.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(si.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(si.ALWAYS,0,0),this.setStencilOp(vn.KEEP,vn.KEEP,vn.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var i,n,s;const{gl:e}=this;e.bindVertexArray(null);for(let o=0;o<this.parameters.maxVertexAttributes;o++)e.disableVertexAttribArray(o);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(Tt.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(Tt.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(Tt.UNIFORM_BUFFER,null);for(let o=0;o<this._parameters.maxUniformBufferBindings;o++){const a=this._state.uniformBufferBindingPoints[o];if(a!=null){const{buffer:l,offset:c,size:u}=a;l!==null?c===0&&u===0?e.bindBufferBase(Tt.UNIFORM_BUFFER,o,l.glName):e.bindBufferRange(Tt.UNIFORM_BUFFER,o,l.glName,c,u):e.bindBufferBase(Tt.UNIFORM_BUFFER,o,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(Tt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(Tt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(Tt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(Tt.COPY_WRITE_BUFFER,null),e.bindFramebuffer(Ja.READ_FRAMEBUFFER,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(Ja.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),e.readBuffer(Vl.COLOR_ATTACHMENT0)),e.bindFramebuffer(Ja.DRAW_FRAMEBUFFER,((i=this._state.drawFramebuffer)==null?void 0:i.glName)??null),this._state.vertexArrayObject){const o=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(o)}e.useProgram(((n=this._state.program)==null?void 0:n.glName)??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,((s=this._state.renderbuffer)==null?void 0:s.glName)??null),this._state.blend===!0?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),this._state.faceCulling===!0?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let o=0;o<this.parameters.maxTextureImageUnits;o++){e.activeTexture(PH+o),e.bindTexture(In.TEXTURE_2D,null),e.bindTexture(In.TEXTURE_CUBE_MAP,null),e.bindTexture(In.TEXTURE_3D,null),e.bindTexture(In.TEXTURE_2D_ARRAY,null);const a=this._state.textureUnitMap[o];a!=null&&e.bindTexture(a.descriptor.target,a.glName)}e.activeTexture(PH+this._state.activeTexture);const r=this._state.viewport;e.viewport(r.x,r.y,r.width,r.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function pc(t,e,r,i){return e?i!==e&&t.bindBuffer(r,e.glName):t.bindBuffer(r,null),e}function mxe(t,e){switch(t){case dr.POINTS:return 2*e;case dr.TRIANGLES:return e/3;case dr.TRIANGLE_STRIP:case dr.TRIANGLE_FAN:return e-2;default:return 0}}let m6t=class extends f6t{constructor(e,r,i){super(e,r),this.gl=e,this.newCache=i,this._appleAmdDriverHelper=null,this._refCount=1,this.screen=new Pkt(this)}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var e;super.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose(),this.screen.destroy()}bindTechnique(e,r,i,n,s){return this.useProgram(e.program),this.setPipelineState(e.getPipeline(!!s)),e.program.bindPass(i,r),n&&e.program.bindDraw(n,r,i),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new L9e(this)),this._appleAmdDriverHelper.run())}get test(){var e;return{cachedWebGLObjects:this.programCache.test.cachedWebGLProgramObjects+this.screen.test.cachedWebGLObjects+(((e=this._appleAmdDriverHelper)==null?void 0:e.test.cachedWebGLObjects)??0)}}};function gxe(t){return!!t.frameUpdate}let OC=class extends Pe{constructor(e,r,i){super({}),this._stage=e,this._techniqueRepository=r,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Xn,this._frameTask=e.view.resourceController.scheduler.registerTask(Ct.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Ln.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(Nle,new Fle)),this._textureTechnique}acquire(e){const r=this._textures.get(e);return r?(r.ref(),r.loadingPromise??r):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(r=>{const i=r.texture.frameUpdate(r.previousToken);i>=0&&i!==r.previousToken&&(r.previousToken=i,e=!0)}),e&&this.events.emit("changed",Hn.BACKGROUND)}_createNewRef(e){const r=this._stage.getObject(e);if(r==null)return _t(r!==void 0),null;const i=r.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),n=new g6t(e,()=>{this._frameTask.schedule(()=>{n.isUnreferenced&&r.unload()})});return this._textures.set(e,n),n.ref(),r.glTexture?(this._updateGLTexture(n,r.glTexture),gxe(r)&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),n):(this._loadingCount++,n.loadingPromise=this._stage.schedule(()=>{const s=r.load(this._rctx),o=l=>(this._loadingCount--,n.loadingPromise=null,this._updateGLTexture(n,l),gxe(r)&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),n),a=l=>(this._loadingCount--,n.loadingPromise=null,on(l)||K.getLogger(this).error(l),null);return Xu(s)?s.then(o,a):o(s)}),n.loadingPromise)}_updateGLTexture(e,r){e.glTexture=r,this.events.emit("changed",Hn.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};d([m()],OC.prototype,"_loadingCount",void 0),d([m()],OC.prototype,"_frameTask",void 0),d([m()],OC.prototype,"updating",null),OC=d([F("esri.views.3d.webgl-engine.lib.TextureRepository")],OC);let g6t=class{constructor(e,r){this.id=e,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(K.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function y6t(t,e){return new ZFe(r=>xSt(r,t),r=>r,e)}let U$=class extends Pe{constructor(){super(...arguments),this._passParameters=new _6t,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=Ql(this._resourcesTask),this._passParameters.waveNormal=wt(this._passParameters.waveNormal),this._passParameters.wavePerturbation=wt(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=b_(async r=>{await Promise.allSettled([this._loadImageResource(e,di("esri/images/materials/water/normals.jpg"),i=>this._passParameters.waveNormal=i,r),this._loadImageResource(e,di("esri/images/materials/water/perturbation.jpg"),i=>this._passParameters.wavePerturbation=i,r)])})),this._resourcesTask.finished?Cb.LOADED:Cb.LOADING}async _loadImageResource(e,r,i,n){try{const s=await y_(r,{signal:n});dt(n);const o=new ui(s.width,s.height);o.pixelFormat=Ot.RGB,o.samplingMode=Kt.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,i(new Mr(e,o,s))}catch(s){K.getLogger(this).error("Failed to load water material normal texture.",s)}}};d([m()],U$.prototype,"_resourcesTask",void 0),d([m({type:Boolean,readOnly:!0})],U$.prototype,"updating",null),U$=d([F("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],U$);let _6t=class extends Li{};const yxe=2048,v6t=1.5,b6t=8;function w6t(t,e){const{format:r,quality:i,rotation:n,disableDecorations:s}=t||{},o=Zce(t,e.padding),a=A6t(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=P6t(t,a),u=R6t(r),h=N6t[u];return{format:u,quality:we(i??h,0,100),area:a,width:l,height:c,rotation:n,disableDecorations:!!s,ignoreBackground:!!(t!=null&&t.ignoreBackground),ignorePadding:!!(t!=null&&t.ignorePadding)}}function x6t(t,e){const r=w6t(t,e),i=r.area,n=r.width/i.width,s=Zce(r,e.padding),o=s.left+s.right,a=s.top+s.bottom,l=e.width-o,c=e.height-a,u=Math.floor(l*n+o),h=Math.floor(c*n+a),p=(t==null?void 0:t.layers)??[],f=r.ignoreBackground,g=r.ignorePadding;return{framebufferWidth:u,framebufferHeight:h,region:{x:Math.floor(i.x*n)+s.left,y:Math.floor(i.y*n)+s.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:n,layers:p,disableDecorations:r.disableDecorations,ignoreBackground:f,ignorePadding:g,objectAndLayerIdColor:!1}}function vY(t,e,r){const{ctx:i,canvas:n}=z9e(t,r),s=i.getImageData(0,0,t.width,t.height),o=T6t(n,e);return V9e(n),{dataUrl:o,data:s}}function bY(t,e){const{ctx:r,canvas:i}=z9e(t,e),n=r.getImageData(0,0,t.width,t.height);return V9e(i),n}function z9e(t,e){const r=S6t();e.premultipliedAlpha&&I6t(t),r.width=t.width,r.height=t.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(t,0,0),e.flipY&&$6t(i),{ctx:i,canvas:r}}function V9e(t){t.width=0,t.height=0}function S6t(){return wY==null&&(wY=document.createElement("canvas")),wY}let wY=null;function T6t(t,e){const r=L6t[e.format],i=e.quality/100;return t.toDataURL(r,i)}function E6t(t,e,r,i=0,n=0,s=t.width-i,o=t.height-n,a=!1){const{data:l}=t,{width:c,height:u,data:h}=e,p=s/c,f=o/u,g=Math.ceil(p/2),y=Math.ceil(f/2),v=t.width;for(let b=0;b<u;b++)for(let w=0;w<c;w++){const x=4*(w+(a?u-b-1:b)*c);let S=0,E=0,P=0,M=0,L=0,U=0;const z=(b+.5)*f;for(let W=Math.floor(b*f);W<(b+1)*f;W++){const V=Math.abs(z-(W+.5))/y,J=(w+.5)*p,Y=V*V;for(let X=Math.floor(w*p);X<(w+1)*p;X++){const le=Math.abs(J-(X+.5))/g,D=Math.sqrt(Y+le*le);if(D>=1)continue;let I=2*D*D*D-3*D*D+1;const k=4*(i+X+(n+W)*v);U+=I*l[k+3],E+=I,!r&&l[k+3]<255&&(I=I*l[k+3]/255),P+=I*l[k],M+=I*l[k+1],L+=I*l[k+2],S+=I}}h[x]=P/S,h[x+1]=M/S,h[x+2]=L/S,h[x+3]=U/E}return e}function C6t(t,e,r){if(!e)return t;const{framebufferWidth:i,framebufferHeight:n,pixelRatio:s,region:o}=t,a=Zce(t,r),l=a.left+a.right,c=a.top+a.bottom,u=i-l,h=n-c,p=Math.min(b6t,Math.min((yxe-l)/u,(yxe-c)/h));return p<v6t?t:{...t,framebufferWidth:Math.round(u*p)+l,framebufferHeight:Math.round(h*p)+c,pixelRatio:s*p,resample:{region:{x:Math.round((o.x-a.left)*p)+a.left,y:Math.round((o.y-a.top)*p)+a.top,width:Math.round(o.width*p),height:Math.round(o.height*p)},width:i,height:n}}}function P6t(t,e){if(!t)return e;const r=t.width,i=t.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return e;const n=e.width/e.height;return i==null?{width:Math.floor(r),height:Math.floor(r/n)}:{width:Math.floor(i*n),height:Math.floor(i)}}function A6t(t,e){const r={x:0,y:0,width:e.width,height:e.height};if(t!=null&&t.area){t.area.x!=null&&(r.x=Math.floor(t.area.x)),t.area.y!=null&&(r.y=Math.floor(t.area.y));const i=t.area.width!=null?Math.floor(t.area.width):null,n=t.area.height!=null?Math.floor(t.area.height):null;if(r.width=e.width-r.x,r.height=e.height-r.y,i!=null&&n!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,n);else if(i==null&&n!=null){const s=Math.min(r.width,i);r.height=s/r.width*r.height,r.width=s}else if(i!=null&&n==null){const s=Math.min(r.height,n);r.width=s/r.height*r.width,r.height=s}}return O6t(M6t(r,t),e)}function O6t(t,e){const r=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),n={x:r,y:i,width:Math.floor(Math.min(t.width,e.width-r)),height:Math.floor(Math.min(t.height,e.height-i))},s=n.width/n.height,o=t.width/t.height;if(o===s)return n;if(o>s){const c=Math.floor(n.width/o),u=n.height-c;return{x:n.x,y:Math.floor(n.y+u/2),width:n.width,height:c}}const a=Math.floor(n.height*o),l=n.width-a;return{x:Math.floor(n.x+l/2),y:n.y,width:a,height:n.height}}function M6t(t,e){if((e==null?void 0:e.width)==null||e.height==null)return t;const r=e.width/e.height,i=t.width/t.height;if(i===r)return t;if(i<r){const s=Math.floor(t.height*r);return t.x-=(s-t.width)/2,t.width=s,t}const n=Math.floor(t.width/r);return t.y-=(n-t.height)/2,t.height=n,t}function Zce(t,e){return!e||t&&t.ignorePadding?F6t:e}function R6t(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return D6t}}function $6t(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function I6t(t){const e=t.data,r=e.length;for(let i=0;i<r;i+=4){const n=e[i+3];if(n!==255&&n>0){const s=255/n;e[i]=e[i]*s,e[i+1]=e[i+1]*s,e[i+2]=e[i+2]*s}}}const L6t={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},_xe=98,D6t="png",N6t={png:100,jpg:_xe,jpeg:_xe},F6t={top:0,right:0,bottom:0,left:0};let k6t=class{constructor(e,r,i){this.parameters=e,this.frameHasDecorations=r,this.fbos=i}},U6t=class{constructor(e,r,i){this._rctx=e,this._renderFunctions=r,this._forceCameraHook=i,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(Hn.BACKGROUND);const r=ma();return this._screenshotQueue.push({settings:e,resolver:r}),r.promise}update(e,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const n={...i.settings,pixelRatio:i.settings.pixelRatio*e.parameters.camera.pixelRatio},s=this._renderScreenshot(e,n,r);i.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,r,i){e.width=r.width,e.height=r.height;const n=e.getContext("2d"),s=i.pixelRatio;return n.save(),n.translate(0,r.height),n.scale(1,-1),i.region&&n.translate(-i.region.x,-i.region.y),n.scale(s,s),r=this._renderFunctions.renderOverlay(e,i.disableDecorations?Ac.OFF:Ac.ON,r),n.restore(),r}_readbackScreenshot(e,r){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},r):this._readbackScreenshotImmediate(e,r)}_readbackScreenshotResampled(e,r){const{framebufferWidth:i,framebufferHeight:n,region:s,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=kj(i,n,a);this._rctx.gl.readPixels(0,0,i,n,Ot.RGBA,et.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=kj(s.width,s.height,a);return E6t(l,c,!0,o.region.x,n-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,r){const{framebufferHeight:i,region:n}=e,s=this._ensureScreenshotEncodeCanvas(),o=kj(n.width,n.height,s);return this._rctx.gl.readPixels(n.x,i-(n.y+n.height),n.width,n.height,Ot.RGBA,et.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(s,o,e)}_renderScreenshot(e,r,i){const n=e.parameters.camera,s={width:r.framebufferWidth,height:r.framebufferHeight};QS(s,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1;const a=r.disableDecorations&&e.frameHasDecorations,l=s.width!==n.fullWidth||s.height!==n.fullHeight,c=r.ignorePadding&&n.pixelRatio!==r.pixelRatio,u=l||a||c||r.objectAndLayerIdColor;let h=null,p=null;if(u){const v=n.clone();if(r.ignorePadding){const E=uN(v.padding);for(let P=0;P<4;P++)E[P]=Math.round(E[P]/v.pixelRatio*r.pixelRatio);v.padding=E}v.fullWidth=s.width,v.fullHeight=s.height,v.pixelRatio=r.pixelRatio;const b=n.fovX-v.fovX,w=n.fovY-v.fovY;b<0&&b<w?v.fovX=n.fovX:w<0&&w<b&&(v.fovY=n.fovY);const x={camera:v,contentCamera:v,mode:Xr.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(x),o=!0;const S=this._renderFunctions.renderScene(x,i,r.objectAndLayerIdColor?Rf.ObjectAndLayerID:Rf.Screenshot,r.disableDecorations?Ac.OFF:Ac.ON);p=S.screen,h=S.oid}const f=()=>{this._rctx.bindFramebuffer(null),p==null||p.release()};this._rctx.bindFramebuffer(p==null?void 0:p.fbo);const g=this._readbackScreenshot(r,f);let y=null;if(r.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),h==null||h.release()};this._rctx.bindFramebuffer(h==null?void 0:h.fbo),y=this._readbackScreenshot(r,v),this._rctx.bindFramebuffer(null)}if(u&&!this._rctx.contextAttributes.alpha)for(let v=3;v<g.data.length;v+=4)g.data[v]=255;if(y&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;return o&&this._forceCameraHook(e.parameters),[g,y]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}};function rre(t,e={}){return t.getContext("webgl2",e)||null}let Ko=class extends Pe{constructor(e){super({}),this.events=new Xn,this.waterTextures=new U$,this._magnifierHelper=new EC,this.objectAndLayerIdRenderHelper=ne("enable-feature:objectAndLayerId-rendering")?new lFt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode;try{this._initializeContext(e)}catch(n){return void console.error("Failed to initialize context",n)}this.addHandles([pe(()=>{var n;return(n=this.waterTextures)==null?void 0:n.updating},()=>this.requestRender(),mi),pe(()=>e.view.qualityProfile,n=>{var s;return(s=this.renderer)==null?void 0:s.updateRenderFeatures(n)},li),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:r}=e.view.resourceController;this.stippleTextures=Rxt(this._rctx,r),this.markerTextures=y6t(this._rctx,r),this._shaderTechniques=new jFe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this.stippleTextures,waterTextureRepository:this.waterTextures,markerTextureRepository:this.markerTextures}),this._textures=new OC(e,this._shaderTechniques,this._rctx),this.addHandles(this._textures.events.on("changed",n=>this.requestRender(n))),this._materialRepository=new HFe(this._textures,this._shaderTechniques,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new z5t(this._rctx,this._shaderTechniques),this.renderer=new AC(e,this._materialRepository,this._textures,this._shaderTechniques,this._rctx,this._compositingHelper,this._magnifierHelper,n=>this.requestRender(n));const i={renderScene:(n,s,o,a)=>this.renderer.render(n,s,o,a),requestRenderScene:n=>this.requestRender(n),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(n,s,o)=>e.options.screenshot.renderOverlay(n,s,o)};this._screenshotManager=new U6t(this._rctx,i,n=>this.events.emit("force-camera-for-screenshot",n)),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Pi(this._frameTask),this._shaderTechniques=Me(this._shaderTechniques),this._componentObjects=Me(this._componentObjects),this._screenshotManager=Me(this._screenshotManager),Me(this.renderer),this._textures=Me(this._textures),Me(this._magnifierHelper),Me(this.waterTextures),Me(this.markerTextures),Me(this.stippleTextures),this._canvas=null,this._container=null,this._rctx=Me(this._rctx)}requestRender(e=Hn.UPDATE){this._needsRender=!0,e===Hn.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating||this._magnifierHelper.updating}get textureRepository(){return this._textures}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(r=>r[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,r,i,n,s,o=s){const a=n.constrainWindowSize(r,i,s*n.pixelRatio,o*n.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(n,a,l);let c=Number.MAX_VALUE;for(let u=0;u<a[2]*a[3];u++){const h=H5t(4*u,l,n.nearFar);c>h&&h!==n.nearFar[0]&&h!==n.nearFar[1]&&(c=h)}if(e){const u=e.pickDepth(r*n.pixelRatio,i*n.pixelRatio,n);u!=null&&c>u&&u!==n.nearFar[0]&&u!==n.nearFar[1]&&(c=u)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const r=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<r)&&(this._tmpDepthBuffer=new Uint8Array(r)),this._tmpDepthBuffer}async reloadShaders(){DUe(),await this._shaderTechniques.reloadAll(),this.requestRender()}_registerFrameTask(e){const r=e.view.state;let i=!1,n=Hn.BACKGROUND,s=!1;const o={preRender:({time:a})=>{i=this.updating,n=this._needsUpdate?Hn.UPDATE:Hn.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||r.forcedAnimationTime!=null||i||this._needsRender){const c=l/this.renderer.animationTimeDilation,u=new P4e(r.camera,c,r.forcedAnimationTime);this.renderer.updateAnimation(u)&&this.requestRender(Hn.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&r.camera.fullWidth>0&&r.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(r,a),s=!0,l&&this.renderer.hasReflections&&(this.requestRender(Hn.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=this.renderer.hasSlicePlane||this._magnifierHelper.enabled||this.renderer.hasDecorations||this.renderer.hasHighlights,c=new k6t(r,l,this.renderer.fboCache);this._textures.update(),this._screenshotManager.update(c,a)},finish:()=>{s&&(this.renderer.finish(r.mode===Xr.IDLE?n:Hn.UPDATE),s=!1)}};this._frameTask=FT(o)}_initializeContext(e){const r=e.options;this._canvas=r.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:r.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:r.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:r.preserveDrawingBuffer??!1},n=rre(this._canvas,i);n!=null?(this._rctx=this._newRenderingContext(n,e),this._loadShaderOnlyExtensions(),!r.alpha&&this._rctx.contextAttributes.alpha&&K.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&ne("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):K.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(e,r){const i={disabledExtensions:r.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:r.options.debugWebGLExtensions||{},maxAnisotropy:8},n=(s,o)=>r.view.resourceController.memoryController.newCache(s,o);return new m6t(e,i,n)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjects==null&&(this._componentObjects=new L5t(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(e){this._componentObjects=e}};d([m({type:Boolean,readOnly:!0})],Ko.prototype,"updating",null),d([m()],Ko.prototype,"_rctx",void 0),d([m()],Ko.prototype,"_container",void 0),d([m()],Ko.prototype,"_canvas",void 0),d([m()],Ko.prototype,"stippleTextures",void 0),d([m()],Ko.prototype,"markerTextures",void 0),d([m()],Ko.prototype,"waterTextures",void 0),d([m()],Ko.prototype,"_magnifierHelper",void 0),d([m({readOnly:!0})],Ko.prototype,"objectAndLayerIdRenderHelper",void 0),d([m()],Ko.prototype,"_textures",void 0),d([m({readOnly:!0})],Ko.prototype,"renderer",void 0),d([m()],Ko.prototype,"_screenshotManager",void 0),d([m()],Ko.prototype,"componentObjectCollection",null),d([m()],Ko.prototype,"_componentObjects",void 0),d([m()],Ko.prototype,"_needsUpdate",void 0),d([m()],Ko.prototype,"_needsWaterReflectionUpdate",void 0),Ko=d([F("esri.views.3d.webgl-engine.parts.RenderView")],Ko);let ph=class extends Pe{constructor(e){super(e),this._model=new N8,this._layers=new jt,this._asyncChangeSet=new Jee,this._syncChangeSet=new Jee,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Ko(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(Ct.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),V9(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(V9(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var r,i;e!=null&&((r=this._model)==null||r.removeMany(e),(i=this.renderView)==null||i.requestRender())}forEachOfType(e,r){this._model.forEachOfType(e,r)}handleEvent(e,r){this.destroyed||(this._model.dirtySet[e](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),!e.hasProgressed)return pa}_commit(e){const r=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;const n=this._layerSyncSet.has(i.id)||i.updatePolicy===db.SYNC,s=n?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(i.id,s),this._layerSyncSet.delete(i.id),s.empty||(this.renderer.modify(s,n?Xl:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Xl),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==db.ASYNC||(r.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(r=>{this._layerSyncSet.has(r.id)||r.updatePolicy===db.SYNC?(e.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id)):e.commitSyncUpdates(r.id,this._syncChangeSet)});for(const r of this._layerSyncSet)e.commitLayer(r,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Xl),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Xl),this.renderView.requestRender())}schedule(e,r){return this._frameTask.schedule(e,r)}reschedule(e,r){return this._frameTask.reschedule(e,r)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Xl))}addRenderPlugin(e,r){const i=this.renderer.plugins.add(e,r),n=()=>{pbe(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(Xu(i))return i.then(n);n()}removeRenderPlugin(e){this.destroyed||(pbe(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){const e=this;return{getCount:r=>e._model.test.content.filter(i=>i.type===r).length,model:e._model}}};ph.DebugSettings={endFrameContentValidation:!1},d([m({constructOnly:!0})],ph.prototype,"view",void 0),d([m({constructOnly:!0})],ph.prototype,"options",void 0),d([m({readOnly:!0})],ph.prototype,"viewingMode",null),d([m({constructOnly:!0})],ph.prototype,"container",void 0),d([m({readOnly:!0})],ph.prototype,"updating",null),d([m({constructOnly:!0})],ph.prototype,"_model",void 0),d([m()],ph.prototype,"renderView",void 0),d([m({readOnly:!0})],ph.prototype,"renderer",null),d([m({readOnly:!0})],ph.prototype,"running",null),ph=d([F("esri.views.3d.webgl-engine.Stage")],ph);function khr(t){return t&&typeof t.highlight=="function"}function z6t(t){return t&&typeof t.maskOccludee=="function"}function Uhr(t,e,r){return t==null||t>r&&(e===0||t<e)}function zhr(t,e){return t!=null&&t>0||e!=null&&e>0}function Vhr(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}let xY;function V6t(){return xY||(xY=j6t()),xY}let B6t=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}};function G6t(t){if(typeof WebGL2RenderingContext>"u")return null;const e=document.createElement("canvas");if(!e)return null;let r=rre(e,{failIfMajorPerformanceCaveat:!0});if(r==null&&(r=rre(e),r!=null&&(t.majorPerformanceCaveat=!0)),r==null)return r;t.available=!0,t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const i=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return i&&(t.supportsHighPrecisionFragment=i.precision>0),r}function j6t(){const t=new B6t,e=G6t(t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function H6t(t){const e=V6t();return e.available?t==="3d"&&e.majorPerformanceCaveat?new B("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new B("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new B("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new B("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function q6t(t){return t&&"nodeType"in t}function W6t(t){return t&&typeof t.render=="function"}const vxe={component:"esri-component"};let oS=class extends Pe{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){var e,r;return this._get("id")??((e=this.widget)==null?void 0:e.id)??((r=this.node)==null?void 0:r.id)}set id(e){this._set("id",e)}set node(e){const r=this._get("node");e!==r&&(e&&e.classList.add(vxe.component),r&&r.classList.remove(vxe.component),this._set("node",e))}castNode(e){var r;return(r=this.widget)==null||r.destroy(),e?typeof e=="string"||q6t(e)?(this._set("widget",null),h7(e)):(W6t(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};d([m()],oS.prototype,"id",null),d([m()],oS.prototype,"node",null),d([Dr("node")],oS.prototype,"castNode",null),d([m({readOnly:!0})],oS.prototype,"widget",void 0),oS=d([F("esri.views.ui.Component")],oS);const j8=oS,B9e="calcite-mode-";function Y6t(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function X6t(){return Y6t().startsWith("dark")}function Z6t(){return`${B9e}${X6t()?"dark":"light"}`}function J6t(t){Q6t(t),t.classList.add(Z6t())}function Q6t(t){Array.from(t.classList).forEach(e=>{e.startsWith(B9e)&&t.classList.remove(e)})}const K6t={left:0,top:0,bottom:0,right:0},G9e={bottom:30,top:15,right:15,left:15},Wy="esri-ui",Kc={ui:Wy,corner:`${Wy}-corner`,innerContainer:`${Wy}-inner-container`,manualContainer:`${Wy}-manual-container`,cornerContainer:`${Wy}-corner-container`,topLeft:`${Wy}-top-left`,topRight:`${Wy}-top-right`,bottomLeft:`${Wy}-bottom-left`,bottomRight:`${Wy}-bottom-right`};function e8t(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function _k(t){return t===0?"0":`${t}px`}function SY(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function TY(t,{top:e,bottom:r,left:i,right:n}){t.style.top=e,t.style.bottom=r,t.style.left=i,t.style.right=n}let mg=class extends Xn.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=Nh(),this.view=null,this._applyViewPadding=()=>{const r=this.container;r&&TY(r,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const r=this._innerContainer;r&&TY(r,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([pe(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,mi),pe(()=>this.padding,this._applyUIPadding,mi),pe(()=>[this.container,this._locale],([e,r])=>{e&&e.setAttribute("lang",r)},mi),zne(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const r=this._get("container");e!==r&&(e&&(e.classList.add(Kc.ui),J6t(e),this._attachContainers(e)),r&&(r.classList.remove(Kc.ui),TY(r,{top:"",bottom:"",left:"",right:""}),sMe(r)),this._set("container",e))}get height(){var s;const e=((s=this.view)==null?void 0:s.height)??0;if(e===0)return e;const r=this._getViewPadding(),{top:i,bottom:n}=r;return Math.max(e-i-n,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...G9e,...e}}get width(){var s;const e=((s=this.view)==null?void 0:s.width)??0;if(e===0)return e;const r=this._getViewPadding(),{left:i,right:n}=r;return Math.max(e-i-n,0)}add(e,r){let i,n,s;if(Array.isArray(e))return void e.forEach(a=>this.add(a,r));const o=SY(e);o&&({index:i,position:r,component:e,key:n}=o),r&&typeof r=="object"&&({index:i,key:n,position:r,internal:s}=r),!e||r&&!this._isValidPosition(r)||this._add(e,r,i,n,s)}remove(e,r){var n;if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,r));const i=this._find(e);if(i){if(this._componentMap.has(i)&&((n=this._componentMap.get(i))==null?void 0:n.key)!==r)return;const s=this._components.indexOf(i),o=i.node.parentNode;return o==null||o.removeChild(i.node),this._componentMap.delete(i),this._components.splice(s,1)[0]}}empty(e,r={removeInternal:!1}){if(Array.isArray(e)){for(const s of e)this.empty(s,r);return}const i=this._positionNameToContainerLookup[e??"manual"],n=Array.prototype.slice.call(i.children).map(s=>this._findByNode(s)).filter(s=>{var o;return s==null?!1:!(((o=this._componentMap.get(s))==null?void 0:o.internal)??!1)||r.removeInternal});for(const s of n)this.remove(s)}move(e,r){if(Array.isArray(e)&&e.forEach(o=>this.move(o,r)),!e)return;let i;const n=SY(e)||SY(r);if(n&&(i=n.index,r=n.position,e=n.component||e),r&&!this._isValidPosition(r))return;const s=this.remove(e);s&&this.add(s,{position:r,index:i})}find(e){if(!e)return null;const r=this._findById(e);return r&&(r.widget||r.node)}getComponents(e,r={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(i=>this._getComponentsAtPosition(i,r)):this._getComponentsAtPosition(e,r):this._components.filter(i=>{var n;return r.includeInternal||!((n=this._componentMap.get(i))!=null&&n.internal)}).map(({widget:i,node:n})=>i??n)}getPosition(e){for(const r in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[r].contains(e))return r;return null}_add(e,r,i,n,s){e instanceof j8||(e=new j8({node:e})),this._place({component:e,position:r,index:i}),this._components.push(e),this._componentMap.set(e,{key:n,internal:s})}_find(e){return e?e instanceof j8?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){var e;return((e=this.view)==null?void 0:e.padding)??K6t}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Kc.innerContainer,Kc.cornerContainer);const r=document.createElement("div");r.classList.add(Kc.innerContainer,Kc.manualContainer);const i=document.createElement("div");i.classList.add(Kc.topLeft,Kc.corner),e.appendChild(i);const n=document.createElement("div");n.classList.add(Kc.topRight,Kc.corner),e.appendChild(n);const s=document.createElement("div");s.classList.add(Kc.bottomLeft,Kc.corner),e.appendChild(s);const o=document.createElement("div");o.classList.add(Kc.bottomRight,Kc.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=r;const a=pat();this._cornerNameToContainerLookup={"top-left":i,"top-right":n,"bottom-left":s,"bottom-right":o,"top-leading":a?n:i,"top-trailing":a?i:n,"bottom-leading":a?o:s,"bottom-trailing":a?s:o},this._positionNameToContainerLookup={manual:r,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const r=e.position??"manual",{component:i,index:n}=e,s=this._positionNameToContainerLookup[r],o=n!=null&&n>-1;if(e8t(i.widget)&&i.widget.startup(),!o)return void s.appendChild(i.node);const a=Array.from(s.children);if(n===0)return void(s.firstChild?efe(i.node,s.firstChild):s.appendChild(i.node));n>=a.length?s.appendChild(i.node):efe(i.node,a[n])}_toPixelPosition(e){return{top:_k(e.top),left:_k(e.left),right:_k(e.right),bottom:_k(e.bottom)}}_findByComponent(e){return this._components.find(r=>r===e)??null}_findById(e){return this._components.find(({id:r})=>r===e)??null}_findByNode(e){return this._components.find(({node:r})=>r===e)??null}_getComponentsAtPosition(e,r){const i=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(i.children).map(n=>this._findByNode(n)).filter(rw).filter(n=>{var s;return r.includeInternal||!((s=this._componentMap.get(n))!=null&&s.internal)}).map(({widget:n,node:s})=>n??s)}};d([m()],mg.prototype,"_locale",void 0),d([m()],mg.prototype,"container",null),d([m()],mg.prototype,"height",null),d([m({value:G9e})],mg.prototype,"padding",null),d([Dr("padding")],mg.prototype,"castPadding",null),d([m()],mg.prototype,"view",void 0),d([m()],mg.prototype,"width",null),mg=d([F("esri.views.ui.UI")],mg);const t8t=mg,r8t="randomUUID"in crypto;function QN(){if(r8t)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=r=>t[r].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function Hhr(){return`{${QN().toUpperCase()}}`}function i8t(){return`{${QN()}}`}const n8t={handleInterceptedEvent:(t,e,r,i)=>(t.scheduleRender(),e.properties[`on${i.type}`].apply(e.properties.bind||r,[i]))},s8t={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}},o8t=t=>({...s8t,...t}),a8t=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},l8t=(t,e)=>t.find(e),bxe=(t,e,r=!1)=>{let i=t;return e.forEach((n,s)=>{const o=i!=null&&i.children?l8t(i.children,a=>a.domNode===n):void 0;r&&!o&&s!==e.length-1||(i=o)}),i},c8t=t=>{let e;const r={...n8t,...t},i=o8t(r),n=i.performanceLogger;let s,o=!0,a=!1;const l=[],c=[],u=(p,f,g)=>{var b;let y;i.eventHandlerInterceptor=(w,x,S,E)=>function(P){let M;n("domEvent",P);const L=a8t(P.currentTarget,y.domNode),U=L.some(W=>{var V;return customElements.get((V=W==null?void 0:W.tagName)==null?void 0:V.toLowerCase())});if(P.eventPhase===Event.CAPTURING_PHASE||!U)L.reverse(),M=bxe(y.getLastRender(),L);else{const W=P.composedPath(),V=W.slice(W.indexOf(P.currentTarget),W.indexOf(y.domNode)).reverse();M=bxe(y.getLastRender(),V,!0)}let z;return M&&(z=r.handleInterceptedEvent(e,M,this,P)),n("domEventProcessed",P),z},(b=r.postProcessProjectionOptions)==null||b.call(r,i);const v=g();y=p(f,v,i),i.eventHandlerInterceptor=void 0,l.push(y),c.push(g),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(y,v)};let h=()=>{if(s=void 0,o){o=!1,n("renderStart",void 0);for(let p=0;p<l.length;p++){const f=c[p]();n("rendered",void 0),l[p].update(f),n("patched",void 0)}n("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(h=r.modifyDoRenderImplementation(h,l,c)),e={renderNow:h,scheduleRender:()=>{s||a||(s=requestAnimationFrame(h))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(p,f)=>{u(Vv.append,p,f)},insertBefore:(p,f)=>{u(Vv.insertBefore,p,f)},merge:(p,f)=>{u(Vv.merge,p,f)},replace:(p,f)=>{u(Vv.replace,p,f)},detach:p=>{for(let f=0;f<c.length;f++)if(c[f]===p)return c.splice(f,1),l.splice(f,1)[0];throw new Error("renderFunction was not found")}},e};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.6.0
 */const j9e="calcite-mode-auto",H9e="calcite-mode-dark",u8t="calcite-mode-light",qhr={autoMode:j9e,darkMode:H9e,lightMode:u8t,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"},NS={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,formAssociated:!1,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0,experimentalSlotFixes:!1};let MC,q9e,IG,W9e=!1,bV=!1,Jce=!1,Eh=!1,wxe=null,ire=!1;const h8t=t=>{const e=new URL(t,za.$resourcesUrl$);return e.origin!==e4.location.origin?e.href:e.pathname},d8t=t=>za.$resourcesUrl$=t,u2=(t,e="")=>()=>{},p8t="slot-fb{display:contents}slot-fb[hidden]{display:none}",xxe="http://www.w3.org/1999/xlink",Sxe={},f8t="http://www.w3.org/2000/svg",m8t="http://www.w3.org/1999/xhtml",g8t=t=>t!=null,Qce=t=>(t=typeof t,t==="object"||t==="function");function y8t(t){var e,r,i;return(i=(r=(e=t.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||r===void 0?void 0:r.getAttribute("content"))!==null&&i!==void 0?i:void 0}const Y9e=(t,e,...r)=>{let i=null,n=null,s=null,o=!1,a=!1;const l=[],c=h=>{for(let p=0;p<h.length;p++)i=h[p],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof t!="function"&&!Qce(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?wV(null,i):i),a=o)};if(c(r),e){e.key&&(n=e.key),e.name&&(s=e.name);{const h=e.className||e.class;h&&(e.class=typeof h!="object"?h:Object.keys(h).filter(p=>h[p]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,b8t);const u=wV(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=n,u.$name$=s,u},wV=(t,e)=>{const r={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return r.$attrs$=null,r.$key$=null,r.$name$=null,r},_8t={},v8t=t=>t&&t.$tag$===_8t,b8t={forEach:(t,e)=>t.map(Txe).forEach(e),map:(t,e)=>t.map(Txe).map(e).map(w8t)},Txe=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),w8t=t=>{if(typeof t.vtag=="function"){const r=Object.assign({},t.vattrs);return t.vkey&&(r.key=t.vkey),t.vname&&(r.name=t.vname),Y9e(t.vtag,r,...t.vchildren||[])}const e=wV(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},x8t=t=>Z8t.map(e=>e(t)).find(e=>!!e),S8t=(t,e)=>t!=null&&!Qce(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,T8t=t=>t,Whr=(t,e,r)=>{const i=T8t(t);return{emit:n=>E8t(i,e,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:n})}},E8t=(t,e,r)=>{const i=za.ce(e,r);return t.dispatchEvent(i),i},Exe=new WeakMap,C8t=(t,e,r)=>{let i=SV.get(t);K8t&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=e:i.replaceSync(e)):i=e,SV.set(t,i)},P8t=(t,e,r)=>{var i;const n=X9e(e,r),s=SV.get(n);if(t=t.nodeType===11?t:nm,s)if(typeof s=="string"){t=t.head||t;let o=Exe.get(t),a;if(o||Exe.set(t,o=new Set),!o.has(n)){{a=nm.createElement("style"),a.innerHTML=s;const l=(i=za.$nonce$)!==null&&i!==void 0?i:y8t(nm);l!=null&&a.setAttribute("nonce",l),t.insertBefore(a,t.querySelector("link"))}e.$flags$&4&&(a.innerHTML+=p8t),o&&o.add(n)}}else t.adoptedStyleSheets.includes(s)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,s]);return n},A8t=t=>{const e=t.$cmpMeta$,r=t.$hostElement$,i=e.$flags$,n=u2("attachStyles",e.$tagName$),s=P8t(r.shadowRoot?r.shadowRoot:r.getRootNode(),e,t.$modeName$);i&10&&(r["s-sc"]=s,r.classList.add(s+"-h"),i&2&&r.classList.add(s+"-s")),n()},X9e=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),Cxe=(t,e,r,i,n,s)=>{if(r!==i){let o=Rxe(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=Pxe(r),u=Pxe(i);l.remove(...c.filter(h=>h&&!u.includes(h))),l.add(...u.filter(h=>h&&!c.includes(h)))}else if(e==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?t.style.setProperty(l,i[l]):t.style[l]=i[l])}else if(e!=="key")if(e==="ref")i&&i(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n"){if(e[2]==="-"?e=e.slice(3):Rxe(e4,a)?e=a.slice(2):e=a[2]+e.slice(3),r||i){const l=e.endsWith(Z9e);e=e.replace(M8t,""),r&&za.rel(t,e,r,l),i&&za.ael(t,e,i,l)}}else{const l=Qce(i);if((o||l&&i!==null)&&!n)try{if(t.tagName.includes("-"))t[e]=i;else{const u=i??"";e==="list"?o=!1:(r==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),i==null||i===!1?(i!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(xxe,e):t.removeAttribute(e)):(!o||s&4||n)&&!l&&(i=i===!0?"":i,c?t.setAttributeNS(xxe,e,i):t.setAttribute(e,i))}}},O8t=/\s/,Pxe=t=>t?t.split(O8t):[],Z9e="Capture",M8t=new RegExp(Z9e+"$"),J9e=(t,e,r,i)=>{const n=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||Sxe,o=e.$attrs$||Sxe;for(i in s)i in o||Cxe(n,i,s[i],void 0,r,e.$flags$);for(i in o)Cxe(n,i,s[i],o[i],r,e.$flags$)},xV=(t,e,r,i)=>{var n;const s=e.$children$[r];let o=0,a,l,c;if(W9e||(Jce=!0,s.$tag$==="slot"&&(MC&&i.classList.add(MC+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)a=s.$elm$=nm.createTextNode(s.$text$);else if(s.$flags$&1)a=s.$elm$=nm.createTextNode("");else{if(Eh||(Eh=s.$tag$==="svg"),a=s.$elm$=nm.createElementNS(Eh?f8t:m8t,s.$flags$&2?"slot-fb":s.$tag$),Eh&&s.$tag$==="foreignObject"&&(Eh=!1),J9e(null,s,Eh),g8t(MC)&&a["s-si"]!==MC&&a.classList.add(a["s-si"]=MC),s.$children$)for(o=0;o<s.$children$.length;++o)l=xV(t,s,o,a),l&&a.appendChild(l);s.$tag$==="svg"?Eh=!1:a.tagName==="foreignObject"&&(Eh=!0)}return a["s-hn"]=IG,s.$flags$&3&&(a["s-sr"]=!0,a["s-fs"]=(n=s.$attrs$)===null||n===void 0?void 0:n.slot,a["s-cr"]=q9e,a["s-sn"]=s.$name$||"",c=t&&t.$children$&&t.$children$[r],c&&c.$tag$===s.$tag$&&t.$elm$&&zD(t.$elm$,!1)),a},zD=(t,e)=>{var r;za.$flags$|=1;const i=t.childNodes;for(let n=i.length-1;n>=0;n--){const s=i[n];s["s-hn"]!==IG&&s["s-ol"]&&(eVe(s).insertBefore(s,Kce(s)),s["s-ol"].remove(),s["s-ol"]=void 0,s["s-sh"]=void 0,s.nodeType===1&&s.setAttribute("slot",(r=s["s-sn"])!==null&&r!==void 0?r:""),Jce=!0),e&&zD(s,e)}za.$flags$&=-2},Q9e=(t,e,r,i,n,s)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===IG&&(o=o.shadowRoot);n<=s;++n)i[n]&&(a=xV(null,r,n,t),a&&(i[n].$elm$=a,o.insertBefore(a,Kce(e))))},K9e=(t,e,r)=>{for(let i=e;i<=r;++i){const n=t[i];if(n){const s=n.$elm$;iVe(n),s&&(bV=!0,s["s-ol"]?s["s-ol"].remove():zD(s,!0),s.remove())}}},R8t=(t,e,r,i,n=!1)=>{let s=0,o=0,a=0,l=0,c=e.length-1,u=e[0],h=e[c],p=i.length-1,f=i[0],g=i[p],y,v;for(;s<=c&&o<=p;)if(u==null)u=e[++s];else if(h==null)h=e[--c];else if(f==null)f=i[++o];else if(g==null)g=i[--p];else if(vk(u,f,n))RC(u,f,n),u=e[++s],f=i[++o];else if(vk(h,g,n))RC(h,g,n),h=e[--c],g=i[--p];else if(vk(u,g,n))(u.$tag$==="slot"||g.$tag$==="slot")&&zD(u.$elm$.parentNode,!1),RC(u,g,n),t.insertBefore(u.$elm$,h.$elm$.nextSibling),u=e[++s],g=i[--p];else if(vk(h,f,n))(u.$tag$==="slot"||g.$tag$==="slot")&&zD(h.$elm$.parentNode,!1),RC(h,f,n),t.insertBefore(h.$elm$,u.$elm$),h=e[--c],f=i[++o];else{for(a=-1,l=s;l<=c;++l)if(e[l]&&e[l].$key$!==null&&e[l].$key$===f.$key$){a=l;break}a>=0?(v=e[a],v.$tag$!==f.$tag$?y=xV(e&&e[o],r,a,t):(RC(v,f,n),e[a]=void 0,y=v.$elm$),f=i[++o]):(y=xV(e&&e[o],r,o,t),f=i[++o]),y&&eVe(u.$elm$).insertBefore(y,Kce(u.$elm$))}s>c?Q9e(t,i[p+1]==null?null:i[p+1].$elm$,r,i,o,p):o>p&&K9e(e,s,c)},vk=(t,e,r=!1)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:r?!0:t.$key$===e.$key$:!1,Kce=t=>t&&t["s-ol"]||t,eVe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,RC=(t,e,r=!1)=>{const i=e.$elm$=t.$elm$,n=t.$children$,s=e.$children$,o=e.$tag$,a=e.$text$;let l;a===null?(Eh=o==="svg"?!0:o==="foreignObject"?!1:Eh,o==="slot"||J9e(t,e,Eh),n!==null&&s!==null?R8t(i,n,e,s,r):s!==null?(t.$text$!==null&&(i.textContent=""),Q9e(i,null,e,s,0,s.length-1)):n!==null&&K9e(n,0,n.length-1),Eh&&o==="svg"&&(Eh=!1)):(l=i["s-cr"])?l.parentNode.textContent=a:t.$text$!==a&&(i.data=a)},tVe=t=>{const e=t.childNodes;for(const r of e)if(r.nodeType===1){if(r["s-sr"]){const i=r["s-sn"];r.hidden=!1;for(const n of e)if(n!==r){if(n["s-hn"]!==r["s-hn"]||i!==""){if(n.nodeType===1&&(i===n.getAttribute("slot")||i===n["s-sn"])){r.hidden=!0;break}}else if(n.nodeType===1||n.nodeType===3&&n.textContent.trim()!==""){r.hidden=!0;break}}}tVe(r)}},P0=[],rVe=t=>{let e,r,i;for(const n of t.childNodes){if(n["s-sr"]&&(e=n["s-cr"])&&e.parentNode){r=e.parentNode.childNodes;const s=n["s-sn"];for(i=r.length-1;i>=0;i--)if(e=r[i],!e["s-cn"]&&!e["s-nr"]&&e["s-hn"]!==n["s-hn"]&&!NS.experimentalSlotFixes)if(Axe(e,s)){let o=P0.find(a=>a.$nodeToRelocate$===e);bV=!0,e["s-sn"]=e["s-sn"]||s,o?(o.$nodeToRelocate$["s-sh"]=n["s-hn"],o.$slotRefNode$=n):(e["s-sh"]=n["s-hn"],P0.push({$slotRefNode$:n,$nodeToRelocate$:e})),e["s-sr"]&&P0.map(a=>{Axe(a.$nodeToRelocate$,e["s-sn"])&&(o=P0.find(l=>l.$nodeToRelocate$===e),o&&!a.$slotRefNode$&&(a.$slotRefNode$=o.$slotRefNode$))})}else P0.some(o=>o.$nodeToRelocate$===e)||P0.push({$nodeToRelocate$:e})}n.nodeType===1&&rVe(n)}},Axe=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",iVe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(iVe)},$8t=(t,e,r=!1)=>{var i,n,s,o;const a=t.$hostElement$,l=t.$cmpMeta$,c=t.$vnode$||wV(null,null),u=v8t(e)?e:Y9e(null,null,e);if(IG=a.tagName,l.$attrsToReflect$&&(u.$attrs$=u.$attrs$||{},l.$attrsToReflect$.map(([h,p])=>u.$attrs$[p]=a[h])),r&&u.$attrs$)for(const h of Object.keys(u.$attrs$))a.hasAttribute(h)&&!["key","ref","style","class"].includes(h)&&(u.$attrs$[h]=a[h]);u.$tag$=null,u.$flags$|=4,t.$vnode$=u,u.$elm$=c.$elm$=a.shadowRoot||a,MC=a["s-sc"],q9e=a["s-cr"],W9e=(l.$flags$&1)!==0,bV=!1,RC(c,u,r);{if(za.$flags$|=1,Jce){rVe(u.$elm$);for(const h of P0){const p=h.$nodeToRelocate$;if(!p["s-ol"]){const f=nm.createTextNode("");f["s-nr"]=p,p.parentNode.insertBefore(p["s-ol"]=f,p)}}for(const h of P0){const p=h.$nodeToRelocate$,f=h.$slotRefNode$;if(f){const g=f.parentNode;let y=f.nextSibling;{let v=(i=p["s-ol"])===null||i===void 0?void 0:i.previousSibling;for(;v;){let b=(n=v["s-nr"])!==null&&n!==void 0?n:null;if(b&&b["s-sn"]===p["s-sn"]&&g===b.parentNode&&(b=b.nextSibling,!b||!b["s-nr"])){y=b;break}v=v.previousSibling}}(!y&&g!==p.parentNode||p.nextSibling!==y)&&p!==y&&(!p["s-hn"]&&p["s-ol"]&&(p["s-hn"]=p["s-ol"].parentNode.nodeName),g.insertBefore(p,y),p.nodeType===1&&(p.hidden=(s=p["s-ih"])!==null&&s!==void 0?s:!1))}else p.nodeType===1&&(r&&(p["s-ih"]=(o=p.hidden)!==null&&o!==void 0?o:!1),p.hidden=!0)}}bV&&tVe(u.$elm$),za.$flags$&=-2,P0.length=0}},I8t=(t,e)=>{},eue=(t,e)=>(t.$flags$|=16,I8t(t,t.$ancestorComponent$),tUt(()=>L8t(t,e))),L8t=(t,e)=>{const r=t.$hostElement$,i=u2("scheduleUpdate",t.$cmpMeta$.$tagName$),n=r;let s;return e?s=pP(n,"componentWillLoad"):s=pP(n,"componentWillUpdate"),s=Oxe(s,()=>pP(n,"componentWillRender")),i(),Oxe(s,()=>N8t(t,n,e))},Oxe=(t,e)=>D8t(t)?t.then(e):e(),D8t=t=>t instanceof Promise||t&&t.then&&typeof t.then=="function",N8t=async(t,e,r)=>{const i=t.$hostElement$,n=u2("update",t.$cmpMeta$.$tagName$);i["s-rc"],r&&A8t(t);const s=u2("render",t.$cmpMeta$.$tagName$);F8t(t,e,i,r),s(),n(),k8t(t)},F8t=(t,e,r,i)=>{try{wxe=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(NS.hasRenderFn||NS.reflect)&&(NS.vdomRender||NS.reflect)&&(NS.hydrateServerSide||$8t(t,e,i))}catch(l){KN(l,t.$hostElement$)}return wxe=null,null},k8t=t=>{const e=t.$cmpMeta$.$tagName$,r=t.$hostElement$,i=u2("postUpdate",e),n=r;t.$ancestorComponent$,pP(n,"componentDidRender"),t.$flags$&64?(pP(n,"componentDidUpdate"),i()):(t.$flags$|=64,pP(n,"componentDidLoad"),i())},Yhr=t=>{{const e=mO(t),r=e.$hostElement$.isConnected;return r&&(e.$flags$&18)===2&&eue(e,!1),r}},pP=(t,e,r)=>{if(t&&t[e])try{return t[e](r)}catch(i){KN(i)}},U8t=(t,e)=>mO(t).$instanceValues$.get(e),z8t=(t,e,r,i)=>{const n=mO(t),s=t,o=n.$instanceValues$.get(e),a=n.$flags$,l=s;r=S8t(r,i.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){n.$instanceValues$.set(e,r);{if(i.$watchers$&&a&128){const h=i.$watchers$[e];h&&h.map(p=>{try{l[p](r,o,e)}catch(f){KN(f,s)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,e)===!1)return;eue(n,!1)}}}},V8t=(t,e,r)=>{var i;const n=t.prototype;if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const s=Object.entries(e.$members$);s.map(([o,[a]])=>{(a&31||a&32)&&Object.defineProperty(n,o,{get(){return U8t(this,o)},set(l){z8t(this,o,l,e)},configurable:!0,enumerable:!0})});{const o=new Map;n.attributeChangedCallback=function(a,l,c){za.jmp(()=>{var u;const h=o.get(a);if(this.hasOwnProperty(h))c=this[h],delete this[h];else{if(n.hasOwnProperty(h)&&typeof this[h]=="number"&&this[h]==c)return;if(h==null){const p=mO(this),f=p==null?void 0:p.$flags$;if(f&&!(f&8)&&f&128&&c!==l){const y=this,v=(u=e.$watchers$)===null||u===void 0?void 0:u[a];v==null||v.forEach(b=>{y[b]!=null&&y[b].call(y,c,l,a)})}return}}this[h]=c===null&&typeof this[h]=="boolean"?!1:c})},t.observedAttributes=Array.from(new Set([...Object.keys((i=e.$watchers$)!==null&&i!==void 0?i:{}),...s.filter(([a,l])=>l[0]&15).map(([a,l])=>{var c;const u=l[1]||a;return o.set(u,a),l[0]&512&&((c=e.$attrsToReflect$)===null||c===void 0||c.push([a,u])),u})]))}}return t},B8t=async(t,e,r,i)=>{let n;if(!(e.$flags$&32)&&(e.$flags$|=32,n=t.constructor,customElements.whenDefined(r.$tagName$).then(()=>e.$flags$|=128),n.style)){let o=n.style;typeof o!="string"&&(o=o[e.$modeName$=x8t(t)]);const a=X9e(r,e.$modeName$);if(!SV.has(a)){const l=u2("registerStyles",r.$tagName$);C8t(a,o,!!(r.$flags$&1)),l()}}e.$ancestorComponent$,eue(e,!0)},Mxe=t=>{},G8t=t=>{if(!(za.$flags$&1)){const e=mO(t),r=e.$cmpMeta$,i=u2("connectedCallback",r.$tagName$);e.$flags$&1?(nVe(t,e,r.$listeners$),e!=null&&e.$lazyInstance$?Mxe(e.$lazyInstance$):e!=null&&e.$onReadyPromise$&&e.$onReadyPromise$.then(()=>Mxe(e.$lazyInstance$))):(e.$flags$|=1,r.$flags$&12&&j8t(t),r.$members$&&Object.entries(r.$members$).map(([n,[s]])=>{if(s&31&&t.hasOwnProperty(n)){const o=t[n];delete t[n],t[n]=o}}),B8t(t,e,r)),i()}},j8t=t=>{const e=t["s-cr"]=nm.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},H8t=async t=>{if(!(za.$flags$&1)){const e=mO(t);e.$rmListeners$&&(e.$rmListeners$.map(r=>r()),e.$rmListeners$=void 0)}},Xhr=(t,e)=>{const r={$flags$:e[0],$tagName$:e[1]};r.$members$=e[2],r.$listeners$=e[3],r.$watchers$=t.$watchers$,r.$attrsToReflect$=[];const i=t.prototype.connectedCallback,n=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){X8t(this,r)},connectedCallback(){G8t(this),i&&i.call(this)},disconnectedCallback(){H8t(this),n&&n.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)})}}),t.is=r.$tagName$,V8t(t,r)},Zhr=(t,e)=>e,nVe=(t,e,r,i)=>{r&&r.map(([n,s,o])=>{const a=W8t(t,n),l=q8t(e,o),c=Y8t(n);za.ael(a,s,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>za.rel(a,s,l,c))})},q8t=(t,e)=>r=>{try{NS.lazyLoad||t.$hostElement$[e](r)}catch(i){KN(i)}},W8t=(t,e)=>e&4?nm:e&8?e4:e&16?nm.body:t,Y8t=t=>J8t?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,sVe=new WeakMap,mO=t=>sVe.get(t),X8t=(t,e)=>{const r={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return nVe(t,r,e.$listeners$),sVe.set(t,r)},Rxe=(t,e)=>e in t,KN=(t,e)=>(0,console.error)(t,e),SV=new Map,Z8t=[],e4=typeof window<"u"?window:{},nm=e4.document||{head:{}},Jhr=e4.HTMLElement||class{},za={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,r,i)=>t.addEventListener(e,r,i),rel:(t,e,r,i)=>t.removeEventListener(e,r,i),ce:(t,e)=>new CustomEvent(t,e)},J8t=(()=>{let t=!1;try{nm.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),Q8t=t=>Promise.resolve(t),K8t=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),nre=[],oVe=[],aVe=(t,e)=>r=>{t.push(r),ire||(ire=!0,e&&za.$flags$&4?eUt(sre):za.raf(sre))},$xe=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(r){KN(r)}t.length=0},sre=()=>{$xe(nre),$xe(oVe),(ire=nre.length>0)&&za.raf(sre)},eUt=t=>Q8t().then(t),Qhr=aVe(nre,!1),tUt=aVe(oVe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.6.0
 */function Ixe(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>t.contains(H9e)||t.contains(j9e)&&e?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),n=o=>{s!==o&&i(o),s=o};let s=r();i(s),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>n(o.matches?"dark":"light")),new MutationObserver(()=>n(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function rUt(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?Ixe():document.addEventListener("DOMContentLoaded",()=>Ixe(),{once:!0}))}const iUt=rUt;iUt();let lVe;function nUt(){try{h8t(".")}catch{d8t(Tu(di(lVe)))}}function tue(t){var r;const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push((r=t[i])==null?void 0:r.call(t));return e.length>0?Promise.all(e):null}lVe="components/assets";const cVe=Symbol("widget"),uVe=Symbol("widget-test-data"),sUt=[],oUt={},TV=new WeakMap;function hVe(t,e){let r=e.children;if(r!=null&&r.length)for(let n=0;n<r.length;++n)r[n]=hVe(t,r[n]);else r=sUt;const i=e.vnodeSelector;if(EV(i)){const n=e.properties||oUt,s=n.key||i;return{vnodeSelector:"div",properties:{key:s,afterCreate:aUt,afterUpdate:lUt,afterRemoved:dVe,parentWidget:t,widgetConstructor:i,widgetProperties:{...n,key:s,children:r}},children:void 0,text:void 0,domNode:null}}return e}function aUt(t,e,r,{parentWidget:i,widgetConstructor:n,widgetProperties:s}){var a;const o=new n(s);o.container=t,TV.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),i.addHandles(ri(()=>dVe(t))),queueMicrotask(()=>{o[uVe].projector.renderNow()})}function lUt(t,e,r,{widgetProperties:i}){var s;const n=TV.get(t);n&&(n.set(i),(s=n.afterUpdate)==null||s.call(n,n,t))}function dVe(t){var r;const e=TV.get(t);e&&((r=e.afterRemoved)==null||r.call(e,e,t),e.destroy(),TV.delete(t))}function EV(t){return typeof t=="function"&&t[cVe]}const t4={arrowDown:"esri-icon-arrow-down",arrowUp:"esri-icon-arrow-up",basemap:"esri-icon-basemap",bookmark:"esri-icon-bookmark",calendar:"esri-icon-calendar",checkMark:"esri-icon-check-mark",checkboxUnchecked:"esri-icon-checkbox-unchecked",close:"esri-icon-close",collapse:"esri-icon-collapse",defaultAction:"esri-icon-default-action",description:"esri-icon-description",directions:"esri-icon-directions",dockBottom:"esri-icon-dock-bottom",dockLeft:"esri-icon-dock-left",dockRight:"esri-icon-dock-right",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",download:"esri-icon-download",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",edit:"esri-icon-edit",elevationProfile:"esri-icon-elevation-profile",environmentSettings:"esri-icon-environment-settings",erase:"esri-icon-erase",error:"esri-icon-error",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",gear:"esri-icon-gear",handleHorizontal:"esri-icon-handle-horizontal",handleVertical:"esri-icon-handle-vertical",home:"esri-icon-home",icon:"esri-icon",launchLinkExternal:"esri-icon-launch-link-external",layerList:"esri-icon-layer-list",layers:"esri-icon-layers",left:"esri-icon-left",leftArrows:"esri-icon-left-arrow",leftTriangleArrow:"esri-icon-left-triangle-arrow",lineOfSight:"esri-icon-line-of-sight",link:"esri-icon-link",linkExternal:"esri-icon-link-external",linkHorizontal:"esri-icon-link-horizontal",loadingIndicator:"esri-icon-loading-indicator",locate:"esri-icon-locate",locateCircled:"esri-icon-locate-circled",locked:"esri-icon-locked",mapPin:"esri-icon-map-pin",maximize:"esri-icon-maximize",measure:"esri-icon-measure",measureArea:"esri-icon-measure-area",measureBuildingHeightShadow:"esri-icon-measure-building-height-shadow",measureLine:"esri-icon-measure-line",menu:"esri-icon-menu",minimize:"esri-icon-minimize",minus:"esri-icon-minus",nonVisible:"esri-icon-non-visible",northNavigation:"esri-icon-north-navigation",noticeTriangle:"esri-icon-notice-triangle",organization:"esri-icon-organization",pan:"esri-icon-pan",pan2:"esri-icon-pan2",partlyCloudy:"esri-icon-partly-cloudy",pause:"esri-icon-pause",play:"esri-icon-play",playCircled:"esri-icon-play-circled",plus:"esri-icon-plus",polyline:"esri-icon-polyline",printer:"esri-icon-printer",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",rightArrow:"esri-icon-right-arrow",rightTriangleArrow:"esri-icon-right-triangle-arrow",rotate:"esri-icon-rotate",save:"esri-icon-save",search:"esri-icon-search",settings2:"esri-icon-settings2",slice:"esri-icon-slice",swap:"esri-icon-swap",table:"esri-icon-table",timeClock:"esri-icon-time-clock",tracking:"esri-icon-tracking",trash:"esri-icon-trash",unlockedLinkHorizontal:"esri-icon-unlocked-link-horizontal",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",vertexGps:"esri-icon-vertex-gps",visible:"esri-icon-visible",zoomInFixed:"esri-icon-zoom-in-fixed",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomOutFixed:"esri-icon-zoom-out-fixed",zoomToObject:"esri-icon-zoom-to-object"},Lxe=new Set;function cUt(t){Lxe.add(t),t.finally(()=>Lxe.delete(t))}var pVe;const uUt="esri.widgets.Widget";let hUt=0;const dUt={widgetIcon:t4.checkboxUnchecked};function fVe(t,e){for(const r in e)t[r]!=null&&(typeof t[r]=="object"&&typeof e[r]=="object"?fVe(t[r],e==null?void 0:e[r]):t[r]=e[r]);return t}const pUt=c8t({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(i,n,s,o)=>{const a=e==null?void 0:e(i,n,s,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in s)||l){const c=i[2].toLowerCase()+i.slice(3),u=f=>a==null?void 0:a.call(s,f);s.addEventListener(c,u,l);const h=()=>s.removeEventListener(c,u,l),p=o.afterRemoved;o.afterRemoved=f=>{p==null||p(f),h()}}return a}},handleInterceptedEvent(t,e,r,i){const{eventPhase:n,type:s}=i,o=n===Event.CAPTURING_PHASE;let a=`on${s}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${s[0].toUpperCase()}${s.slice(1)}${o?"Capture":""}`,l&&a in l))&&(r$e(),t.scheduleRender(),l[a].call(l.bind||r,i))}});let EY=!1,Mo=class extends hB(Xn.EventedAccessor){constructor(e,r){super(e,r),this._attached=!1,this._projector=pUt,this._readyForTrueRender=!1,this.iconClass=dUt.widgetIcon,this.icon=null,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=fne(async()=>{var a;if((a=this._messageBundleProps)!=null&&a.length){const l=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:c,propertyName:u})=>{if(this.destroyed)return;let h=await jne(c);this.uiStrings&&Object.keys(this.uiStrings)&&(h=fVe(ae(h),this.uiStrings)),this[u]=h}));if(this.destroyed)return;for(const c of l)c.status==="rejected"&&K.getLogger(this).error("widget-intl:locale-error",this.declaredClass,c.reason)}await this.loadLocale()}),nUt();const i="esri-widget-uid-"+QN(),n=this.render.bind(this);this._trackingTarget=new sB(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const s=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;const a=n();let l=a.properties;l||(a.properties=l={});const{key:c}=l;if(c||(l.key=i),EV(a.vnodeSelector)){if(!this.visible)return{vnodeSelector:"div",properties:{key:`${i}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}}else this.visible?l.styles||(l.styles={}):(l.class="",l.styles={display:"none"}),l.styles.display||(l.styles.display="");let u=0;return(h=a.children)==null||h.forEach(p=>{if(EV(p.vnodeSelector))return;let{properties:f}=p;f||(p.properties=f={}),f.key||(f.key=`${this.id}--${u++}`)}),hVe(this,a)};this.render=()=>{if(EY)return s();let a=cat(this)??null;if(a)return a;this._trackingTarget.clear(),EY=!0;try{a=n_(this._trackingTarget,s)}catch(l){throw console.error(l),l}finally{EY=!1}return a&&uat(this,a),a};const o=this.beforeFirstRender();o?this._resourcesFetch=o.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),cUt(this._resourcesFetch)}normalizeCtorArgs(e,r){const i={...e};return r&&(i.container=r),i}postInitialize(){}beforeFirstRender(){var r;const e=this.loadDependencies();return(r=this._messageBundleProps)!=null&&r.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(fde):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(Me(this._trackingTarget),Me(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,aH(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return h7(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){var e;return this._get("id")||((e=this.container)==null?void 0:e.id)||Date.now().toString(16)+"-widget-"+hUt++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(pVe=cVe,uVe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(aH(this),this._projector.scheduleRender())}own(e){dne(K.getLogger(this),"`Widget.own()` is deprecated in favor of 'Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(e)}classes(...e){return dat.apply(this,e)}renderNow(){aH(this),this._projector.renderNow()}_postInitialize(){var r;if(this.destroyed)return;this.scheduleRender(),(r=this._delegatedEventNames)!=null&&r.length&&this.addHandles(pe(()=>this.viewModel,(i,n)=>{n&&this.removeHandles("delegated-events"),i&&tB(i)&&this.addHandles(this._delegatedEventNames.map(s=>NA(i,s,o=>{this.emit(s,o)})),"delegated-events")},li)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(fde),this.scheduleRender()};this.addHandles([zne(e),pe(()=>this.uiStrings,e),up(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var r;this._attached&&(this._projector.detach(this.render),this._attached=!1),(r=e==null?void 0:e.parentNode)==null||r.removeChild(e)}};Mo[pVe]=!0,d([m()],Mo.prototype,"_readyForTrueRender",void 0),d([m({value:null})],Mo.prototype,"container",null),d([Dr("container")],Mo.prototype,"castContainer",null),d([m()],Mo.prototype,"iconClass",void 0),d([m()],Mo.prototype,"icon",void 0),d([m()],Mo.prototype,"id",null),d([m()],Mo.prototype,"label",null),d([m()],Mo.prototype,"renderable",null),d([m()],Mo.prototype,"uiStrings",void 0),d([m()],Mo.prototype,"viewModel",void 0),d([m({value:!0})],Mo.prototype,"visible",null),d([m()],Mo.prototype,"key",void 0),d([m()],Mo.prototype,"children",void 0),d([m()],Mo.prototype,"afterCreate",void 0),d([m()],Mo.prototype,"afterUpdate",void 0),d([m()],Mo.prototype,"afterRemoved",void 0),Mo=d([F(uUt)],Mo);const LG=Mo;let H8,q8=null;const fP=new Map;async function edr(t){q8==null&&(H8==null&&(H8=re(()=>import("./Lyr3DWasmPerSceneView-CgUgWeHI.js"),__vite__mapDeps([164,60,61,98,99,100,101,53,78,102,103,104,105,106,107,81,108,26,20,21,71,88,22,23,24,15,25,8,9,10,11,18,19,93,83,109,70,85,86,110,52]))),q8=await H8);const e=t.view;let r=fP.get(e);return r||(r=new q8.default({view:e}),fP.set(e,r)),await r.initializeWasm(),r.add3DTilesLayerView(t)}function fUt(t){return fP.get(t)}function tdr(t){const e=t.view,r=fP.get(e);r&&r.remove3DTilesLayerView(t)<1&&(fP.delete(e),fP.size===0&&(H8=null,q8=null))}function Dxe(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function mUt(t,e){return t.length!==e.length||t.some((r,i)=>r.text!==e[i].text)}function FM(t,e,r){!r||!e||t.find(i=>i.layerView===e&&i.text===r)||t.push({text:r,layerView:e})}function gUt(t){return t.type==="bing-maps"}const Yy=[];let $C=class extends Pe{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new St,this.view=null,this._allLayerViewsChange=r=>{var n;this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const i=(n=this.view)==null?void 0:n.allLayerViews;i&&(this.addHandles(i.map(s=>pe(()=>{var o;return[s.suspended,(o=s.layer)==null?void 0:o.attributionVisible]},()=>this._updateAttributionItems())).toArray(),"suspension"),i.forEach(s=>{s.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(s.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),r!=null&&r.removed&&r.removed.forEach(s=>{this._pendingAttributions.delete(s),this._fetchedAttributionData.delete(s)}),this._updateAttributionItems()},this.addHandles([jo(()=>{var r;return(r=this.view)==null?void 0:r.allLayerViews},"change",r=>this._allLayerViewsChange(r),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),up(()=>{var r;return((r=this.view)==null?void 0:r.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var e;return(e=this.view)!=null&&e.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,r=e==null?void 0:e.allLayerViews;if(Yy.length=0,!e||!r)return void this._clear();r.forEach(n=>{var a,l;if(n.suspended||!((a=n.layer)!=null&&a.attributionVisible))return;const s=n.layer;if(Dxe(s,"user"))return void FM(Yy,n,s.copyright);if(s.hasAttributionData){if(this._fetchedAttributionData.has(n)){const c=this._fetchedAttributionData.get(n);return void(c?FM(Yy,n,this._getDynamicAttribution(c,e,s)):Dxe(s)&&FM(Yy,n,s.copyright))}return void this._fetchAttributionData(n)}const o="portalItem"in s?(l=s.portalItem)==null?void 0:l.accessInformation:void 0;FM(Yy,n,o||s.copyright)});const i=r.find(n=>{var s;return((s=n.layer)==null?void 0:s.type)==="integrated-mesh-3dtiles"});if(this.view&&i){const n=fUt(this.view);if(n){const s=n.getAttributionText();for(let o=0;o<s.length;++o)FM(Yy,i,s[o])}}mUt(this.items,Yy)&&(this.items.removeAll(),this.items.addMany(Yy)),Yy.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const r=await op(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=r.ok?this._createContributionIndex(r.value,gUt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,r){const i=e.contributors,n={};if(!i)return n;for(let s=0;s<i.length;s++){const o=i[s],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,u=l.zoomMin-(r&&l.zoomMin?1:0),h=l.zoomMax-(r&&l.zoomMax?1:0),p=new br({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:Ve.WGS84}),f={extent:ib(p),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:s};for(let g=u;g<=h;g++)n[g]??(n[g]=[]),n[g].push(f)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(e,r,i){var u;const{extent:n,scale:s}=r;let o=((u=i.tileInfo)==null?void 0:u.scaleToZoom(s))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!n||o==null||o<=-1)return"";const a=e[o],l=sN(n.center.clone().normalize(),r.spatialReference),c=new Set;return a?a.filter(h=>{const p=h.id,f=!c.has(p)&&l&&h.extent&&Une(h.extent,l);return f&&c.add(p),f}).sort((h,p)=>p.score-h.score||h.objectId-p.objectId).map(h=>h.attribution).join(", "):""}};d([m({readOnly:!0,type:St})],$C.prototype,"items",void 0),d([m({readOnly:!0})],$C.prototype,"state",null),d([m()],$C.prototype,"view",void 0),$C=d([F("esri.widgets.Attribution.AttributionViewModel")],$C);const mVe=$C,iy={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",disabledElement:"esri-disabled-element",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",noBookmarksIcon:"esri-widget__no-bookmark-icon",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function yUt(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:vUt(t[e])}}}function _Ut(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function vUt(t){return function(e,...r){_Ut(e)?yat(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...r)}}function DG(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}var bUt=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},gVe=function(t,e){for(var r=0,i=t.length;r<i;r++){var n=t[r];Array.isArray(n)?gVe(n,e):n!=null&&n!==!1&&(n.hasOwnProperty("vnodeSelector")||(n=bUt(n)),e.push(n))}},wUt=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:r[0],domNode:null};var n=[];return gVe(r,n),{vnodeSelector:t,properties:e||void 0,children:n,text:void 0,domNode:null}};function $u(t,e,...r){return typeof t!="function"||EV(t)?wUt(t,e,...r):t(e,...r)}function idr(...t){return t}const YE="esri-attribution",dx={base:YE,poweredBy:`${YE}__powered-by`,sources:`${YE}__sources`,open:`${YE}--open`,sourcesOpen:`${YE}__sources--open`,link:`${YE}__link`,widgetIcon:t4.description};let Nl=class extends LG{constructor(e,r){super(e,r),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:n})=>this._checkSourceTextOverflow(n))),this.iconClass=dx.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new mVe}initialize(){this.addHandles(jo(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,r)=>(e.includes(r.text)||e.push(r.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[dx.open]:this._isOpen};return $u("div",{bind:this,class:this.classes(dx.base,iy.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return $u("div",{class:dx.poweredBy},"Powered by"," ",$u("a",{class:dx.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,r=this._isInteractive,i=r?0:void 0,{attributionText:n}=this,s={[dx.sourcesOpen]:e,[iy.interactive]:r};return $u("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(dx.sources,s),innerHTML:n,tabIndex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let r=!1;const{clientHeight:i,clientWidth:n,scrollWidth:s}=e,o=s>n,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(r=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,r=!0)}r&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};d([m()],Nl.prototype,"_isOpen",void 0),d([m()],Nl.prototype,"_isInteractive",null),d([m()],Nl.prototype,"_attributionTextOverflowed",void 0),d([m()],Nl.prototype,"_prevSourceNodeHeight",void 0),d([m({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Nl.prototype,"attributionText",null),d([m()],Nl.prototype,"iconClass",void 0),d([m()],Nl.prototype,"icon",void 0),d([m()],Nl.prototype,"itemDelimiter",void 0),d([m()],Nl.prototype,"label",null),d([m(),DG("esri/widgets/Attribution/t9n/Attribution")],Nl.prototype,"messages",void 0),d([m()],Nl.prototype,"view",null),d([m({type:mVe})],Nl.prototype,"viewModel",void 0),d([yUt()],Nl.prototype,"_toggleState",null),Nl=d([F("esri.widgets.Attribution")],Nl);const xUt=Nl;function SUt(t){var e,r;return((e=t==null?void 0:t.spatialReference)==null?void 0:e.isWebMercator)||((r=t==null?void 0:t.spatialReference)==null?void 0:r.isGeographic)||!1}const TUt=t=>{let e=class extends t{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return JD(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return d([m()],e.prototype,"goToOverride",void 0),d([m()],e.prototype,"view",void 0),e=d([F("esri.widgets.support.GoTo")],e),e},EUt="esri.widgets.CompassViewModel";let aS=class extends TUt(Pe){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(pe(()=>this.view,this._updateRotationWatcher,mi))}destroy(){this.view=null}get canShowNorth(){return SUt(this.view)}get state(){var e;return!((e=this.view)!=null&&e.ready)||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){var r,i;if(!((r=this.view)!=null&&r.ready))return;const e={};((i=this.view)==null?void 0:i.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const r=-e.heading;this.orientation={x:0,y:0,z:r}}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?pe(()=>e==null?void 0:e.rotation,this._updateForRotation,mi):pe(()=>e==null?void 0:e.camera,this._updateForCamera,mi))}};d([m({readOnly:!0})],aS.prototype,"canShowNorth",null),d([m()],aS.prototype,"orientation",void 0),d([m({readOnly:!0})],aS.prototype,"state",null),d([m()],aS.prototype,"view",void 0),aS=d([F(EUt)],aS);const yVe=aS,Nxe="esri-compass",CY={base:Nxe,widgetIcon:t4.locateCircled,iconContainer:`${Nxe}__icon-container`};let gg=class extends LG{constructor(e,r){super(e,r),this.iconClass=CY.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new yVe,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=i=>({transform:`rotateZ(${i.z}deg)`})}loadDependencies(){return tue({button:()=>re(()=>import("./calcite-button-DFNuuqus.js"),__vite__mapDeps([165,166,167,168,169,170,171,172,173,174,175,176])),icon:()=>re(()=>import("./calcite-icon-BtuxP3ni.js"),__vite__mapDeps([177,175,167,168,174]))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:r}=this.viewModel,i=r==="rotation"?"arrow-up":"compass-needle",n=this.icon??i,{messages:s}=this;return $u("div",{class:this.classes(CY.base,iy.widget)},$u("calcite-button",{class:iy.widgetButton,disabled:r==="disabled",kind:"neutral",label:s.reset,onclick:this._reset,round:!0,scale:"s",title:s.reset},$u("div",{"aria-hidden":"true",class:CY.iconContainer,title:s.reset},$u("calcite-icon",{icon:n,scale:"m",styles:this._toRotationTransform(e)}))))}};d([m()],gg.prototype,"goToOverride",null),d([m()],gg.prototype,"iconClass",void 0),d([m()],gg.prototype,"icon",void 0),d([m()],gg.prototype,"label",null),d([m(),DG("esri/widgets/Compass/t9n/Compass")],gg.prototype,"messages",void 0),d([m()],gg.prototype,"view",null),d([m({type:yVe})],gg.prototype,"viewModel",void 0),gg=d([F("esri.widgets.Compass")],gg);const CUt=gg,Fxe="esri-navigation-toggle",PY={base:Fxe,widgetIcon:t4.pan2,isLayoutHorizontal:`${Fxe}--horizontal`};let IC=class extends Pe{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.addHandles(up(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e,r;return(e=this.view)!=null&&e.ready&&((r=this.view)==null?void 0:r.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){var r;const e=(r=this.view)==null?void 0:r.inputManager;e&&(e.primaryDragAction=this.navigationMode==="pan"?"pan":"rotate")}};d([m({readOnly:!0})],IC.prototype,"state",null),d([m()],IC.prototype,"navigationMode",void 0),d([m()],IC.prototype,"view",void 0),IC=d([F("esri.widgets.NavigationToggleViewModel")],IC);const _Ve=IC;let yg=class extends LG{constructor(e,r){super(e,r),this.iconClass=PY.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new _Ve,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{var n;const i=((n=this.viewModel)==null?void 0:n.navigationMode)==="pan"?this._rotateButton:this._panButton;i==null||i.setFocus(),this.toggle()}}loadDependencies(){return tue({button:()=>re(()=>import("./calcite-button-DFNuuqus.js"),__vite__mapDeps([165,166,167,168,169,170,171,172,173,174,175,176]))})}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var n,s;const e=((n=this.viewModel)==null?void 0:n.state)==="disabled",r=((s=this.viewModel)==null?void 0:s.navigationMode)==="pan",i=this.messages.toggle;return $u("div",{class:this.classes(PY.base,iy.widget,{[PY.isLayoutHorizontal]:this.layout==="horizontal"})},$u("calcite-button",{afterCreate:o=>{this._panButton=o},appearance:r?"outline-fill":"solid",class:iy.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:i,onclick:this._toggle,tabIndex:r?void 0:-1,title:i}),$u("calcite-button",{afterCreate:o=>{this._rotateButton=o},appearance:r?"solid":"outline-fill",class:iy.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:i,onclick:this._toggle,tabIndex:r?-1:void 0,title:i}))}};d([m()],yg.prototype,"iconClass",void 0),d([m()],yg.prototype,"icon",void 0),d([m()],yg.prototype,"label",null),d([m({value:"vertical"})],yg.prototype,"layout",null),d([m(),DG("esri/widgets/NavigationToggle/t9n/NavigationToggle")],yg.prototype,"messages",void 0),d([m()],yg.prototype,"view",null),d([m({type:_Ve})],yg.prototype,"viewModel",void 0),yg=d([F("esri.widgets.NavigationToggle")],yg);const PUt=yg;let lS=class extends Pe{get canZoomIn(){var i,n,s;if(!((i=this.view)==null?void 0:i.ready))return!1;const r=(s=(n=this.view)==null?void 0:n.constraints)==null?void 0:s.effectiveMaxScale;return r===0||this._scale>r}get canZoomOut(){var n;const{view:e}=this;if(!(e==null?void 0:e.ready))return!1;const i=(n=e.constraints)==null?void 0:n.effectiveMinScale;return i===0||this._scale<i}get _scale(){var r,i,n;const e=(i=(r=this.view)==null?void 0:r.animation)==null?void 0:i.target;return(e&&"then"in e||e==null?void 0:e.scale)??((n=this.view)==null?void 0:n.scale)??0}};d([m({readOnly:!0})],lS.prototype,"canZoomIn",null),d([m({readOnly:!0})],lS.prototype,"canZoomOut",null),d([m()],lS.prototype,"view",void 0),d([m()],lS.prototype,"_scale",null),lS=d([F("esri.widgets.Zoom.ZoomConditions2D")],lS);const AUt=lS;let LC=class extends Pe{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};d([m({readOnly:!0})],LC.prototype,"canZoomIn",null),d([m({readOnly:!0})],LC.prototype,"canZoomOut",null),d([m()],LC.prototype,"view",void 0),LC=d([F("esri.widgets.Zoom.ZoomConditions3D")],LC);const OUt=LC;let K1=class extends Pe{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new AUt({view:e}):e.type==="3d"&&(this._zoomConditions=new OUt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():IL(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():IL(e.goTo({zoomFactor:.5}))}};d([m()],K1.prototype,"_zoomConditions",void 0),d([m()],K1.prototype,"canZoomIn",null),d([m()],K1.prototype,"canZoomOut",null),d([m({readOnly:!0})],K1.prototype,"state",null),d([m()],K1.prototype,"view",null),K1=d([F("esri.widgets.Zoom.ZoomViewModel")],K1);const vVe=K1,AY={base:"esri-zoom",widgetIcon:t4.zoomInMagnifyingGlass,horizontalLayout:"esri-zoom--horizontal"};let _g=class extends LG{constructor(e,r){super(e,r),this.iconClass=AY.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new vVe,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return tue({button:()=>re(()=>import("./calcite-button-DFNuuqus.js"),__vite__mapDeps([165,166,167,168,169,170,171,172,173,174,175,176]))})}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[AY.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:r,canZoomOut:i}=this.viewModel,{zoomIn:n,zoomOut:s}=this.messages;return $u("div",{class:this.classes(AY.base,iy.widget,e)},$u("calcite-button",{class:iy.widgetButton,disabled:!r,iconStart:"plus",kind:"neutral",label:n,onclick:this.zoomIn,title:n}),$u("calcite-button",{class:iy.widgetButton,disabled:!i,iconStart:"minus",kind:"neutral",label:s,onclick:this.zoomOut,title:s}))}};d([m()],_g.prototype,"iconClass",void 0),d([m()],_g.prototype,"icon",void 0),d([m()],_g.prototype,"label",null),d([m({value:"vertical"})],_g.prototype,"layout",null),d([m(),DG("esri/widgets/Zoom/t9n/Zoom")],_g.prototype,"messages",void 0),d([m()],_g.prototype,"view",null),d([m({type:vVe})],_g.prototype,"viewModel",void 0),_g=d([F("esri.widgets.Zoom")],_g);const MUt=_g;function RUt(t){return(t==null?void 0:t.view)!==void 0}let W8=class extends t8t{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=r=>{this.components.forEach(i=>{const n=this._find(i),s=n==null?void 0:n.widget;RUt(s)&&(s.view=r)})},this._componentsWatcher=(r,i)=>{this._removeComponents(i),this._addComponents(r),this._adjustPadding(r)}}initialize(){this.addHandles([pe(()=>this.components,this._componentsWatcher,mi),pe(()=>this.view,this._updateViewAwareWidgets,mi)])}_add(e,r,i,n,s){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,r,i,n,s)}_removeComponents(e){e.forEach(r=>{const i=this._find(r);i&&(this.remove(i),i.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:r}=this.padding;this.padding=r}}_addComponents(e){this.constructed&&e.forEach(r=>this.add(this._createComponent(r),this._defaultPositionLookup[r]))}_createComponent(e){const r=this._createWidget(e);return new j8({id:e,node:r})}_createWidget(e){const{view:r}=this;switch(e){case"attribution":return new xUt({view:r});case"compass":return new CUt({view:r});case"navigation-toggle":return new PUt({view:r});case"zoom":return new MUt({view:r})}}};d([m()],W8.prototype,"components",void 0),W8=d([F("esri.views.ui.DefaultUI")],W8);const bVe=W8;let Y8=class extends bVe{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};d([m()],Y8.prototype,"components",void 0),Y8=d([F("esri.views.ui.3d.DefaultUI3D")],Y8);const wVe=Y8;let rt=class extends got(vct($at(fdt))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new f_({slicePlane:bRe},this),this._resourceController=mIt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new Uee({view:this}),this.labeler=new eS({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new rA,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new TS,this.environment=new vC,this.environmentManager=new ef,this.floors=new St,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new ydt({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new m$t,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new wVe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new bUe,yst();const e=(r=null)=>{r!=null&&r.type===Ei.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.addHandles([jo(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>e(r),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),pe(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new O_t({view:this}),this.stateManager=new fs({view:this})}initialize(){this.groundView=new oct({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(jo(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},mi),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},mi),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>pqe(e>0?1e3/Math.ceil(e):0),mi),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,li),this.updatingHandles.add(()=>{var e,r;return(r=(e=this.map)==null?void 0:e.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),li),this.addHandles(pe(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),ei))}destroy(){var t;this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Me(this.sharedSymbolResources),this._set("labeler",Me(this.labeler)),this._set("deconflictor",Me(this.deconflictor)),this._resourceController=Me(this._resourceController),this._set("stateManager",Me(this.stateManager)),this._set("inputManager",Me(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Me(this.environmentManager)),this._set("environment",Me(this.environment)),this.groundView=Me(this.groundView),this._exitBasemapTerrain(),(t=this._stage)==null||t.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;const t=this.map;let e=this._userClippingArea||sde(t,"clippingArea");return!this._userClippingArea&&!sde(t,"clippingEnabled")||e==null?(this._clippingArea=null,null):e instanceof br?this.spatialReference&&(e=bk(e,this.spatialReference),e==null)?(K.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),e.intersection(this._groundAndLayersExtent)==null&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(K.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?K.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===Fe.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:bk(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||Ve.WGS84,r=bk(this.clippingArea,e);r!=null&&(t=t!=null?t.intersection(r):r);const i=this._get("dataExtent");return t!=null&&t.equals(i)?i:t}get _groundAndLayersExtent(){const t=this.spatialReference||Ve.WGS84;let e;const r=s=>{const o=bk(s,t);o!=null&&(e!=null?e.union(o):e=o.clone())},i=this.basemapTerrain;if(i!=null&&i.spatialReference){const s=i.groundExtent;r(new br({xmin:s[0],ymin:s[1],zmin:0,xmax:s[2],ymax:s[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const s=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>s(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const n=this._get("_groundAndLayersExtent");return e.equals(n)?n:e}castEnvironment(t){var e;return t?t instanceof vC?t:t instanceof MLe?((e=this.environment)==null?void 0:e.cloneWithWebsceneEnvironment(t))??vC.fromWebsceneEnvironment(t):to(vC,t):new vC}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var t;return this.navigating||(((t=this.toolViewManager)==null?void 0:t.interacting)??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){C8.isValidProfile(t)&&(C8.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||C8.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");E2(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode&&this.stateManager.preinit(this.spatialReference)}get resolution(){return this.spatialReference!=null?hot(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?JA.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var n,s,o,a;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,r=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(l=>{if(l.isFulfilled()){if(l.updating){if(e=!0,l.suspended||$te(l))return;++r,t+=l.updatingProgress}}else++r});for(const l of this._updatingObjects)l!=null&&l.updating&&(r+=.1,t+=.5*.1);for(const l of this._updatingObjectsWithProgress)l!=null&&l.updating&&(++r,t+=l.updatingProgress);const i=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i||this._createGraphicsViewController||(n=this.inputManager)!=null&&n.updating||(o=(s=this.map)==null?void 0:s.allLayers)!=null&&o.some(l=>!l.isFulfilled())||(a=this.textures)!=null&&a.updating),e?(this._numUpdating=Math.max(r,this._numUpdating),t+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const l=performance.now();if(t<1){const c=Math.min((l-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-c)+t*c}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?l:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var r;const t=this._predeterminedViewingMode;if(t!=null)return uH(t);const e=this.spatialReference;return e?((r=this.defaultsFromMap)==null?void 0:r.viewingMode)!=null&&e.equals(this.defaultsFromMap.spatialReference)?uH(this.defaultsFromMap.viewingMode):mQ(e,Fe.Global)?"global":"local":"global"}set viewingMode(t){this.ready?K.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get quality(){var t,e;return((e=(t=this._resourceController)==null?void 0:t.memoryController)==null?void 0:e.memoryFactor)??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new _It(this)}on(t,e,r,i){return this.viewEvents.on(t,e,r,i)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return K.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=ege(t)?Kme(this,t):t;return $$t(this,r,e,this._defaultToMapOptions)}toScreen(t){if(!this.ready)return K.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?kg(this.elevationProvider,t):null)??0;return Cn(t,wk,this.renderSpatialReference,e),this.state.camera.projectToScreen(wk,OY),lp(OY[0],OY[1])}pixelSizeAt(t){return this.ready?t?(Cn(t,wk,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(wk)):0:(K.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t,()=>this.pixelSizeAt(t)):1}hitTest(t,e){if(!this.ready)return K.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=ege(t)?Kme(this,t):t;return R$t(this,r,e,this._defaultHitTestOptions)}async popupHitTest(t){return X$t(this,t)}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new B("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return vY(r,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return bY(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e);return[bY(r[0],this._pixelFormat()),bY(r[1],this._pixelFormat())]}_completeSettings(t){const e=x6t(t,this);return e.pixelRatio/=this.state.pixelRatio,C6t(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!ne("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e),i=vY(r[0],e,this._pixelFormat()),n=this._completeSettings(t);return n.format="png",[i,vY(r[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return lge.importLayerView(t)}hasLayerViewModule(t){return lge.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,r;return this.map&&"initialViewProperties"in this.map&&((t=this.map.initialViewProperties)==null?void 0:t.spatialReference)||((e=this.defaultsFromMap)==null?void 0:e.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=H6t(this.type);const e=ne("safari");if(e&&e<9&&(t=new B("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw K.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return t!=null?ame(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const r=this._predeterminedViewingMode;if(r!=null)return this._validateSpatialReferenceForViewingMode(t,e,r)?{constraints:this._makeSpatialReferenceConstraints(t,e,r)}:null;const i=this._validateSpatialReferenceForViewingMode(t,e,Fe.Local),n=this._validateSpatialReferenceForViewingMode(t,e,Fe.Global);return i||n?i&&n?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:i?{constraints:this._makeSpatialReferenceConstraints(t,e,Fe.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,Fe.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,r){return!!mQ(t,r)&&(e==null||!!Wde(e)||(!fI(e)||OG(e,t,r)!=null)&&(!qde(e)||r!==Fe.Global))}_makeSpatialReferenceConstraints(t,e,r){if(e==null)return[{spatialReference:t,viewingMode:r}];const i=t.isWebMercator,n=t.isWGS84;return Wde(e)&&(i||n)?!n||r===Fe.Local||_ce(e.tileInfo,e.fullExtent,t,Fe.Global)===null?[{spatialReference:t,viewingMode:r},{spatialReference:Ve.WebMercator,viewingMode:r}]:[{spatialReference:i?Ve.WGS84:Ve.WebMercator,viewingMode:r}]:fI(e)||qde(e)||!i&&!n?fI(e)&&i&&r!==Fe.Global?[{spatialReference:t,viewingMode:r},{spatialReference:Ve.WGS84,viewingMode:Fe.Local}]:[{spatialReference:t,viewingMode:r}]:[{spatialReference:t,viewingMode:r},{spatialReference:i?Ve.WGS84:Ve.WebMercator,viewingMode:r}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport({spatialReference:t})!=null,r=this._predeterminedViewingMode;return e||(r!=null?K.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${uH(r)} viewing mode.`):t.isGeographic&&K.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}trackGraphicState(t){if(!t.graphic)return K.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let r=null,i=!1;const n=s=>{var o;!i&&s!=null&&"processor"in s&&((o=s.processor)==null?void 0:o.type)==="graphics-3d"&&s.processor.graphicsCore&&(r=s.processor.graphicsCore.trackGraphicState(t))};return e!=null?n(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),ri(()=>{i=!0,r!=null&&(r.remove(),r=null)})}highlight(t){if(Array.isArray(t))return DT(t.map(r=>this.highlight(r)));if(St.isCollection(t))return DT(t.toArray().map(r=>this.highlight(r)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):ri()}maskOccludee(t){if(!t)return K.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let r=null,i=!1;const n=s=>{!i&&s!=null&&z6t(s)&&(r=s.maskOccludee(t))};return e!=null?n(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),ri(()=>{i=!0,r!=null&&(r.remove(),r=null)})}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await qT(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new B("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((r,i)=>{const n=this.map.allLayers.on("change",s=>{s.added.includes(t.layer)&&(n.remove(),this.whenLayerView(t.layer).then(r,i))})}):this.whenLayerView(t.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new m4t({view:this})),this._set("elevationProvider",new P$({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new wc({view:this})),this._set("featureTiles",new ea({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var r;const e=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?lw(MB(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>Si.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(re(()=>import("./FeatureTileTree3DDebugger-BtySMpTq.js"),__vite__mapDeps([178,163]))).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&Si.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):e||!this._featureTreeDebugger||Si.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},li),this.updatingHandles.add(()=>this.clippingArea,t,li),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,li)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new q$t(this.map,t));const e=this.state.isGlobal,r=uot(e,t);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",K$t.create(this.state.viewingMode,r)),e||this.addHandles(pe(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.extent},i=>{const n=this.renderCoordsHelper.spatialReference;i==null||i[0]===0&&i[1]===0&&i[2]===0&&i[3]===0||!v7(i,this.basemapTerrain.spatialReference,kxe,n)||(this.renderCoordsHelper.extent=kxe)},ei),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(nA/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===Ei.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(pe(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),ei),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e,r){if(!this.overlay||!this.overlay.hasVisibleItems)return r;const i=t.getContext("2d");return i.putImageData(r,0,0),this.overlay.renderCanvas(t,{disableDecorations:e===Ac.OFF}),i.getImageData(0,0,r.width,r.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(i,n,s)=>this._renderScreenshotOverlay(i,n,s)}},e=new D$t(this.state.viewingMode,i=>this._stage.layers.forAll(i),this);this._set("sceneIntersectionHelper",e);const r=h7(this.surface);this._stage=new ph({view:this,options:t,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,i=>this._stage.renderer.setParameters({highQualityTransparency:i}),mi),pe(()=>this.magnifier,i=>this._stage.renderView.magnifier=i,li),this.on("pointer-move",()=>{var i;return(i=this._stage)==null?void 0:i.renderer.resetAnimation()}),NA(this._stage.renderView.canvas,"webglcontextlost",i=>{this.fatalError=new B("webgl-context-lost",i.statusMessage)})],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(nA/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Me(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new wIt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await re(()=>import("./GraphicsView3D-BpEXIK9r.js"),__vite__mapDeps([179,117,108,26,20,21]))).default;dt(t),await qT(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){var i;const t=ame(this.viewingMode);t===Fe.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(jo(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded();const e=this.map&&"initialViewProperties"in this.map?(i=this.map.initialViewProperties)==null?void 0:i.environment:void 0;e&&gRe(this.environment,e),this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new x3(this._stage,this.resourceController.scheduler));const r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach(n=>n(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",Me(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(kb);for(const t of this.map.allLayers.items)BL(t.type)&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(kb);for(const t of this.map.allLayers.items)BL(t.type)&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}};function bk(t,e){return t!=null&&ju(t.spatialReference,e)?lw(t,e):null}rt.type="3d",d([m()],rt.prototype,"_userClippingArea",void 0),d([m()],rt.prototype,"_resourceController",void 0),d([m()],rt.prototype,"_stage",void 0),d([m({readOnly:!0})],rt.prototype,"deconflictor",void 0),d([m({readOnly:!0})],rt.prototype,"labeler",void 0),d([m(Hz(rA,"analyses"))],rt.prototype,"analyses",void 0),d([m({type:aA,readOnly:!0})],rt.prototype,"animation",null),d([m({readOnly:!0})],rt.prototype,"basemapTerrain",void 0),d([m({readOnly:!0})],rt.prototype,"elevationProvider",void 0),d([m()],rt.prototype,"camera",null),d([m({type:Hh})],rt.prototype,"contentCamera",null),d([m({readOnly:!0})],rt.prototype,"canvas",void 0),d([m({type:He})],rt.prototype,"center",null),d([m({type:br})],rt.prototype,"clippingArea",null),d([m({type:TS})],rt.prototype,"constraints",void 0),d([m({type:br,readOnly:!0})],rt.prototype,"renderDataExtent",null),d([m({type:br,readOnly:!0})],rt.prototype,"dataExtent",null),d([m({type:br,readOnly:!0})],rt.prototype,"_groundAndLayersExtent",null),d([m({type:vC})],rt.prototype,"environment",void 0),d([Dr("environment")],rt.prototype,"castEnvironment",null),d([m({readOnly:!0})],rt.prototype,"environmentManager",void 0),d([m({type:br})],rt.prototype,"extent",null),d([m()],rt.prototype,"floors",void 0),d([m()],rt.prototype,"screenCenter",null),d([m()],rt.prototype,"frustum",null),d([m({type:Number,readOnly:!0})],rt.prototype,"fullOpacity",void 0),d([m({readOnly:!0})],rt.prototype,"graphicsView",void 0),d([m({readOnly:!0})],rt.prototype,"analysisViewManager",void 0),d([m()],rt.prototype,"groundView",void 0),d([m({type:Boolean})],rt.prototype,"initialExtentRequired",null),d([m()],rt.prototype,"_defaultsFromMapSettings",null),d([m()],rt.prototype,"interacting",null),d([m()],rt.prototype,"stationary",null),d([m()],rt.prototype,"navigating",null),d([m()],rt.prototype,"map",void 0),d([m({readOnly:!0})],rt.prototype,"mapCoordsHelper",void 0),d([m()],rt.prototype,"padding",null),d([m({type:wc,readOnly:!0})],rt.prototype,"pointsOfInterest",void 0),d([m({type:ea,readOnly:!0})],rt.prototype,"featureTiles",void 0),d([m()],rt.prototype,"_featureTreeDebugger",void 0),d([m({type:Boolean})],rt.prototype,"screenSizePerspectiveEnabled",void 0),d([m({constructOnly:!0})],rt.prototype,"deactivatedWebGLExtensions",void 0),d([m({constructOnly:!0})],rt.prototype,"debugWebGLExtensions",void 0),d([m({constructOnly:!0})],rt.prototype,"renderCanvas",void 0),d([m({constructOnly:!0})],rt.prototype,"state",void 0),d([m({readOnly:!0})],rt.prototype,"inputManager",void 0),d([m({readOnly:!0})],rt.prototype,"stateManager",void 0),d([m({type:["low","medium","high"]})],rt.prototype,"qualityProfile",null),d([m({type:fbe,get(){let t=this._get("qualitySettings");return t||(t=new fbe,C8.apply(this.qualityProfile,t)),t}})],rt.prototype,"qualitySettings",void 0),d([m()],rt.prototype,"slicePlane",null),d([m({readOnly:!0})],rt.prototype,"typeSpecificPreconditionsReady",null),d([m({readOnly:!0})],rt.prototype,"renderCoordsHelper",void 0),d([m({readOnly:!0})],rt.prototype,"sceneIntersectionHelper",void 0),d([m({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],rt.prototype,"resolution",null),d([m({type:Number})],rt.prototype,"scale",null),d([m()],rt.prototype,"heightModelInfo",null),d([m()],rt.prototype,"spatialReference",void 0),d([m({type:Boolean,constructOnly:!0})],rt.prototype,"alphaCompositingEnabled",void 0),d([m({constructOnly:!0})],rt.prototype,"preserveDrawingBufferEnabled",void 0),d([m({type:Boolean})],rt.prototype,"supersampleScreenshotsEnabled",void 0),d([m({readOnly:!0})],rt.prototype,"type",void 0),d([m(),Dr(t=>t instanceof bVe?t:s_(wVe,t))],rt.prototype,"ui",void 0),d([m({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],rt.prototype,"updating",null),d([m()],rt.prototype,"_updatingObjects",null),d([m()],rt.prototype,"_updatingObjectsWithProgress",null),d([m({type:Number,readOnly:!0,dependsOn:["updating"]})],rt.prototype,"updatingProgress",void 0),d([m({type:["global","local"]})],rt.prototype,"viewingMode",null),d([m({type:dm})],rt.prototype,"viewpoint",null),d([m({type:Number})],rt.prototype,"zoom",null),d([m({type:bUe})],rt.prototype,"highlightOptions",void 0),d([m({readOnly:!0})],rt.prototype,"quality",null),d([m({readOnly:!0})],rt.prototype,"resolutionScale",null),d([m()],rt.prototype,"textures",void 0),rt=d([F("esri.views.SceneView")],rt);const wk=C(),OY=Sn(),kxe=Ht(),$Ut=rt,Uxe={read:{reader:WCt},write:{allowNull:!0,writer:YCt}},xVe=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return d([m({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),d([m({json:{read:!1,write:!1,origins:{"web-map":Uxe,"portal-item":Uxe}}})],e.prototype,"effect",void 0),e=d([F("esri.layers.mixins.BlendLayer")],e),e},rue=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&IUt(r,i.effectiveScaleRange);const n=this._get("effectiveScaleRange");return n&&n.minScale===r.minScale&&n.maxScale===r.maxScale?n:r}};return d([m({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),d([m({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=d([F("esri.layers.mixins.ScaleRangeLayer")],e),e};function IUt(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}var ore;let z$=ore=class extends Se{constructor(t){super(t)}async collectRequiredFields(t,e){return Uc(t,e,this.expression)}clone(){return new ore({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};d([m({type:String,json:{write:!0}})],z$.prototype,"expression",void 0),d([m({type:String,json:{write:!0}})],z$.prototype,"title",void 0),z$=ore=d([F("esri.layers.support.FeatureExpressionInfo")],z$);const zxe=z$;var are;const xk=tc()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Vxe=new Ii({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let h0=are=class extends Se{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,r,i){e[r]=t.write({},i),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new are({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&MHe(this.featureExpressionInfo,t.featureExpressionInfo)}};d([m({type:zxe,json:{write:!0}})],h0.prototype,"featureExpressionInfo",void 0),d([Xe("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],h0.prototype,"readFeatureExpressionInfo",null),d([nt("featureExpressionInfo",{featureExpressionInfo:{type:zxe},"featureExpression.value":{type:[0]}})],h0.prototype,"writeFeatureExpressionInfo",null),d([m({type:xk.apiValues,nonNullable:!0,json:{type:xk.jsonValues,read:xk.read,write:{writer:xk.write,isRequired:!0}}})],h0.prototype,"mode",null),d([m({type:Number,json:{write:!0}})],h0.prototype,"offset",void 0),d([m({type:$vt,json:{type:String,read:Vxe.read,write:Vxe.write}})],h0.prototype,"unit",null),h0=are=d([F("esri.layers.support.ElevationInfo")],h0);const SVe=h0;let d0=class extends xVe(rue(LB)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new _T,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,r){return super.on(e,r)}graphicChanged(e){this.emit("graphic-update",e)}};d([m({type:SVe})],d0.prototype,"elevationInfo",void 0),d([m(Hz(_T,"graphics"))],d0.prototype,"graphics",void 0),d([m({type:["show","hide"]})],d0.prototype,"listMode",void 0),d([m()],d0.prototype,"screenSizePerspectiveEnabled",void 0),d([m({readOnly:!0})],d0.prototype,"type",void 0),d([m({constructOnly:!0})],d0.prototype,"internal",void 0),d0=d([F("esri.layers.GraphicsLayer")],d0);const Bxe=d0;var lre;let V$=lre=class extends Se{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new lre({minValue:this.minValue,maxValue:this.maxValue})}};d([m({type:Number,json:{write:!0}})],V$.prototype,"minValue",void 0),d([m({type:Number,json:{write:!0}})],V$.prototype,"maxValue",void 0),V$=lre=d([F("esri.renderer.support.AuthoringInfoClassBreakInfo")],V$);var cre;let wv=cre=class extends Se{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new cre({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:ae(this.classBreakInfos)})}};d([m({type:String,json:{write:!0}})],wv.prototype,"field",void 0),d([m({type:String,json:{write:!0}})],wv.prototype,"normalizationField",void 0),d([m({type:String,json:{write:!0}})],wv.prototype,"label",void 0),d([m({type:[V$],json:{write:!0}})],wv.prototype,"classBreakInfos",void 0),wv=cre=d([F("esri.renderers.support.AuthoringInfoFieldInfo")],wv);var ure;const Sk=new Ii({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),Tk=new Ii({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),Gxe={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},jxe=["high-to-low","above-and-below","centered-on","extremes"],Hxe=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],qxe=["seconds","minutes","hours","days","months","years"];let tu=ure=class extends Se{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new ure({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};d([m({types:Gxe,json:{write:!0}})],tu.prototype,"endTime",void 0),d([Dr("endTime")],tu.prototype,"castEndTime",null),d([m({type:String,json:{write:!0}})],tu.prototype,"field",void 0),d([m({type:Number,json:{write:!0}})],tu.prototype,"maxSliderValue",void 0),d([m({type:Number,json:{write:!0}})],tu.prototype,"minSliderValue",void 0),d([m({types:Gxe,json:{write:!0}})],tu.prototype,"startTime",void 0),d([Dr("startTime")],tu.prototype,"castStartTime",null),d([m({type:Sk.apiValues,value:null,json:{type:Sk.jsonValues,read:Sk.read,write:Sk.write}})],tu.prototype,"style",null),d([m({type:Hxe,value:null,json:{type:Hxe,origins:{"web-scene":{type:jxe,write:{writer:(t,e)=>{jxe.includes(t)&&(e.theme=t)}}}},write:!0}})],tu.prototype,"theme",null),d([m({type:Tk.apiValues,json:{type:Tk.jsonValues,read:Tk.read,write:Tk.write}})],tu.prototype,"type",void 0),d([m({type:qxe,json:{type:qxe,write:!0}})],tu.prototype,"units",void 0),tu=ure=d([F("esri.renderers.support.AuthoringInfoVisualVariable")],tu);const LUt=tu;let X8=class extends Se{constructor(e){super(e),this.type=null}};d([m({readOnly:!0,json:{read:!1,write:!0}})],X8.prototype,"type",void 0),X8=d([F("esri.rest.support.ColorRamp")],X8);const iue=X8;var hre;let cS=hre=class extends iue{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new hre({fromColor:ae(this.fromColor),toColor:ae(this.toColor),algorithm:this.algorithm})}};d([gt({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],cS.prototype,"algorithm",void 0),d([m({type:De,json:{type:[Vi],write:!0}})],cS.prototype,"fromColor",void 0),d([m({type:De,json:{type:[Vi],write:!0}})],cS.prototype,"toColor",void 0),d([m({type:["algorithmic"]})],cS.prototype,"type",void 0),cS=hre=d([F("esri.rest.support.AlgorithmicColorRamp")],cS);const nue=cS;var dre;let B$=dre=class extends iue{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new dre({colorRamps:ae(this.colorRamps)})}};d([m({type:[nue],json:{write:!0}})],B$.prototype,"colorRamps",void 0),d([m({type:["multipart"]})],B$.prototype,"type",void 0),B$=dre=d([F("esri.rest.support.MultipartColorRamp")],B$);const TVe=B$,DUt={key:"type",base:iue,typeMap:{algorithmic:nue,multipart:TVe}};function NUt(t){return t!=null&&t.type?t.type==="algorithmic"?nue.fromJSON(t):t.type==="multipart"?TVe.fromJSON(t):null:null}var pre;const px=new Ii({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),Ek=new Ii({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Wxe=new Ii({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Yxe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],FUt=["high-to-low","above-and-below","above","below","90-10"],kUt=["flow-line","wave-front"],UUt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let Es=pre=class extends Se{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?NUt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){var t;return new pre({classificationMethod:this.classificationMethod,colorRamp:ae(this.colorRamp),fadeRatio:ae(this.fadeRatio),fields:(t=this.fields)==null?void 0:t.slice(0),field1:ae(this.field1),field2:ae(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};d([m({type:px.apiValues,value:null,json:{type:px.jsonValues,read:px.read,write:px.write,origins:{"web-document":{default:"manual",type:px.jsonValues,read:px.read,write:px.write}}}})],Es.prototype,"classificationMethod",null),d([m({types:DUt,json:{write:!0}})],Es.prototype,"colorRamp",void 0),d([Xe("colorRamp")],Es.prototype,"readColorRamp",null),d([m({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Es.prototype,"fadeRatio",void 0),d([m({type:[String],value:null,json:{write:!0}})],Es.prototype,"fields",null),d([m({type:wv,value:null,json:{write:!0}})],Es.prototype,"field1",null),d([m({type:wv,value:null,json:{write:!0}})],Es.prototype,"field2",null),d([m({type:kUt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Es.prototype,"flowTheme",null),d([m({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],Es.prototype,"focus",null),d([m({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],Es.prototype,"isAutoGenerated",void 0),d([m({type:Number,value:null,json:{type:Vi,write:!0}})],Es.prototype,"numClasses",null),d([m({type:Yxe,json:{type:Yxe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Es.prototype,"lengthUnit",void 0),d([m({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Es.prototype,"maxSliderValue",void 0),d([m({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Es.prototype,"minSliderValue",void 0),d([m({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Es.prototype,"statistics",null),d([m({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],Es.prototype,"standardDeviationInterval",null),d([m({type:Ek.apiValues,value:null,json:{type:Ek.jsonValues,read:Ek.read,write:Ek.write,origins:{"web-scene":{type:Wxe.jsonValues,write:{writer:Wxe.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],Es.prototype,"type",null),d([m({type:[LUt],json:{write:!0}})],Es.prototype,"visualVariables",void 0),d([m({type:UUt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Es.prototype,"univariateSymbolStyle",null),d([m({type:FUt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Es.prototype,"univariateTheme",null),Es=pre=d([F("esri.renderers.support.AuthoringInfo")],Es);const EVe=Es,MY=new Ii({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let G$=class extends Se{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const r=new Set;return await this.collectRequiredFields(r,e),Array.from(r).sort()}getSymbol(e,r){}async getSymbolAsync(e,r){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};d([m({type:EVe,json:{write:!0}})],G$.prototype,"authoringInfo",void 0),d([m({type:MY.apiValues,readOnly:!0,json:{type:MY.jsonValues,read:!1,write:{writer:MY.write,ignoreOrigin:!0}}})],G$.prototype,"type",void 0),G$=d([F("esri.renderers.Renderer")],G$);const N_=G$;function zUt(t){var e,r;return((r=(e=t.match(VUt))==null?void 0:e[1])==null?void 0:r.replace(/\\'/g,"'"))??null}const VUt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var fre;let mP=fre=class extends Se{constructor(){super(...arguments),this.title=null}clone(){return new fre({title:this.title})}};d([m({type:String,json:{write:!0}})],mP.prototype,"title",void 0),mP=fre=d([F("esri.renderers.support.LegendOptions")],mP);var mre;let Z8=mre=class extends mP{constructor(){super(...arguments),this.showLegend=null}clone(){return new mre({title:this.title,showLegend:this.showLegend})}};d([m({type:Boolean,json:{write:!0}})],Z8.prototype,"showLegend",void 0),Z8=mre=d([F("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],Z8);const CVe=Z8,RY=new Ii({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let cf=class extends Se{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(K.getLogger(this).error(".field: field must be a string value"),null):iN(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};d([m()],cf.prototype,"index",void 0),d([m({type:RY.apiValues,readOnly:!0,json:{read:RY.read,write:RY.write}})],cf.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],cf.prototype,"field",void 0),d([Dr("field")],cf.prototype,"castField",null),d([m({type:String,json:{write:!0}})],cf.prototype,"valueExpression",void 0),d([m({type:String,json:{write:!0}})],cf.prototype,"valueExpressionTitle",void 0),d([m({readOnly:!0})],cf.prototype,"arcadeRequired",null),d([m({type:CVe,json:{write:!0}})],cf.prototype,"legendOptions",void 0),cf=d([F("esri.renderers.visualVariables.VisualVariable")],cf);const r4=cf;var gre;let uS=gre=class extends Se{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,r){e[r]=t??0}clone(){return new gre({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};d([m({type:De,json:{type:[Vi],write:!0}})],uS.prototype,"color",void 0),d([m({type:String,json:{write:!0}})],uS.prototype,"label",void 0),d([m({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],uS.prototype,"value",void 0),d([nt("value")],uS.prototype,"writeValue",null),uS=gre=d([F("esri.renderers.visualVariables.support.ColorStop")],uS);const BUt=uS;var yre;let hS=yre=class extends r4{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){var t;return new yre({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};d([m({readOnly:!0})],hS.prototype,"cache",null),d([m({type:["color"],json:{type:["colorInfo"]}})],hS.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],hS.prototype,"normalizationField",void 0),d([m({type:[BUt],json:{write:!0}})],hS.prototype,"stops",null),hS=yre=d([F("esri.renderers.visualVariables.ColorVariable")],hS);const PVe=hS;var _re;let ev=_re=class extends Se{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return NP(e.transparency)}writeOpacity(t,e,r){e[r]=Jne(t)}clone(){return new _re({label:this.label,opacity:this.opacity,value:this.value})}};d([m({type:String,json:{write:!0}})],ev.prototype,"label",void 0),d([m({type:Number,json:{type:Vi,write:{target:"transparency"}}})],ev.prototype,"opacity",void 0),d([Xe("opacity",["transparency"])],ev.prototype,"readOpacity",null),d([nt("opacity")],ev.prototype,"writeOpacity",null),d([m({type:Number,json:{write:!0}})],ev.prototype,"value",void 0),ev=_re=d([F("esri.renderers.visualVariables.support.OpacityStop")],ev);const GUt=ev;var vre;let dS=vre=class extends r4{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){var t;return new vre({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};d([m({readOnly:!0})],dS.prototype,"cache",null),d([m({type:["opacity"],json:{type:["transparencyInfo"]}})],dS.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],dS.prototype,"normalizationField",void 0),d([m({type:[GUt],json:{write:!0}})],dS.prototype,"stops",null),dS=vre=d([F("esri.renderers.visualVariables.OpacityVariable")],dS);const AVe=dS;var bre;let p0=bre=class extends r4{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,r,i){if(i!=null&&i.messages){const n=`visualVariables[${this.index}]`;i.messages.push(new B("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpressionTitle",context:i}))}}clone(){var t;return new bre({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}};d([m({readOnly:!0})],p0.prototype,"cache",null),d([m({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],p0.prototype,"axis",void 0),d([m({type:["rotation"],json:{type:["rotationInfo"]}})],p0.prototype,"type",void 0),d([m({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],p0.prototype,"rotationType",void 0),d([m({type:String,json:{write:!0}})],p0.prototype,"valueExpressionTitle",void 0),d([nt("web-scene","valueExpressionTitle")],p0.prototype,"writeValueExpressionTitleWebScene",null),p0=bre=d([F("esri.renderers.visualVariables.RotationVariable")],p0);const OVe=p0;var wre;let tv=wre=class extends Se{constructor(t){super(t),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new wre({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};d([m({type:String,json:{write:!0}})],tv.prototype,"label",void 0),d([m({type:Number,cast:gn,json:{write:!0}})],tv.prototype,"size",void 0),d([m({type:Number,json:{write:!0}})],tv.prototype,"value",void 0),d([m({type:Boolean,json:{write:!1}})],tv.prototype,"useMinValue",void 0),d([m({type:Boolean,json:{write:!1}})],tv.prototype,"useMaxValue",void 0),tv=wre=d([F("esri.renderers.visualVariables.support.SizeStop")],tv);const jUt=tv;var xre;let J8=xre=class extends CVe{constructor(){super(...arguments),this.customValues=null}clone(){var t;return new xre({title:this.title,showLegend:this.showLegend,customValues:(t=this.customValues)==null?void 0:t.slice(0)})}};d([m({type:[Number],json:{write:!0}})],J8.prototype,"customValues",void 0),J8=xre=d([F("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],J8);const HUt=J8;var Sre;const Ck=new Ii({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),Tre=new Ii({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function Xxe(t){if(t!=null)return typeof t=="string"||typeof t=="number"?gn(t):t.type==="size"?p3(t)?t:(delete(t={...t}).type,new Ai(t)):void 0}function Zxe(t,e,r){if(typeof t!="object")return t;const i=new Ai;return i.read(t,r),i}let Ai=Sre=class extends r4{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&DFe.test(this.valueExpression)}}set expression(t){K.getLogger(this).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){p3(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),p3(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return LFe(this)}set maxDataValue(t){t&&this.stops&&(K.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(K.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return Xxe(t)}readMaxSize(t,e,r){return Zxe(t,e,r)}set minDataValue(t){t&&this.stops&&(K.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(K.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return Xxe(t)}readMinSize(t,e,r){return Zxe(t,e,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value):t&&(K.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return Bwt(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,r,i){if(t==="$view.scale"){if(i!=null&&i.messages){const n=this.index,s=typeof n=="string"?n:`visualVariables[${n}]`;i.messages.push(new B("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpression",context:i}))}}else e[r]=t}readValueUnit(t){return t?Tre.read(t):null}clone(){var t,e;return new Sre({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:p3(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:p3(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:(t=this.stops)==null?void 0:t.map(r=>r.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:(e=this.legendOptions)==null?void 0:e.clone()})}flipSizes(){if(this.transformationType===ia.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===ia.Stops){const t=this.stops;if(!t)return this;const e=t.map(i=>i.size).reverse(),r=t.length;for(let i=0;i<r;i++)t[i].size=e[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){var t;return(t=this.stops)==null?void 0:t.map(e=>e.value||0)}};d([m({readOnly:!0})],Ai.prototype,"cache",null),d([m({type:Ck.apiValues,json:{type:Ck.jsonValues,origins:{"web-map":{read:!1}},read:Ck.read,write:Ck.write}})],Ai.prototype,"axis",void 0),d([m({type:String,value:null,json:{read:!1}})],Ai.prototype,"expression",null),d([m()],Ai.prototype,"index",null),d([m({type:String,readOnly:!0})],Ai.prototype,"inputValueType",null),d([m({type:HUt,json:{write:!0}})],Ai.prototype,"legendOptions",void 0),d([m({type:Number,value:null,json:{write:!0}})],Ai.prototype,"maxDataValue",null),d([m({type:Number,value:null,json:{write:!0}})],Ai.prototype,"maxSize",null),d([Dr("maxSize")],Ai.prototype,"castMaxSize",null),d([Xe("maxSize")],Ai.prototype,"readMaxSize",null),d([m({type:Number,value:null,json:{write:!0}})],Ai.prototype,"minDataValue",null),d([m({type:Number,value:null,json:{write:!0}})],Ai.prototype,"minSize",null),d([Dr("minSize")],Ai.prototype,"castMinSize",null),d([Xe("minSize")],Ai.prototype,"readMinSize",null),d([m({type:String,json:{write:!0}})],Ai.prototype,"normalizationField",void 0),d([m({readOnly:!0})],Ai.prototype,"arcadeRequired",null),d([m({type:String})],Ai.prototype,"scaleBy",void 0),d([m({type:[jUt],value:null,json:{write:!0}})],Ai.prototype,"stops",null),d([m({type:["outline"],json:{write:!0}})],Ai.prototype,"target",void 0),d([m({type:String,readOnly:!0})],Ai.prototype,"transformationType",null),d([m({type:["size"],json:{type:["sizeInfo"]}})],Ai.prototype,"type",void 0),d([m({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Ai.prototype,"useSymbolValue",void 0),d([m({type:String,json:{write:!0}})],Ai.prototype,"valueExpression",void 0),d([Xe("valueExpression",["valueExpression","expression"])],Ai.prototype,"readValueExpression",null),d([nt("web-scene","valueExpression")],Ai.prototype,"writeValueExpressionWebScene",null),d([m({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Ai.prototype,"valueRepresentation",void 0),d([m({type:Tre.apiValues,json:{write:Tre.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],Ai.prototype,"valueUnit",void 0),d([Xe("valueUnit")],Ai.prototype,"readValueUnit",null),Ai=Sre=d([F("esri.renderers.visualVariables.SizeVariable")],Ai);const MVe=Ai,qUt={color:PVe,size:MVe,opacity:AVe,rotation:OVe},WUt=new Ii({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),YUt=/^\[([^\]]+)\]$/i;let Q8=class extends Pe{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e&&e.filter(r=>!!r),e==null?void 0:e.length){for(const r of e)switch(r.type){case"color":this.colorVariables.push(r);break;case"opacity":this.opacityVariables.push(r);break;case"rotation":this.rotationVariables.push(r);break;case"size":this.sizeVariables.push(r)}this.sizeVariables.length&&this.sizeVariables.some(r=>!!r.target)&&e.sort((r,i)=>{let n=null;return n=r.target===i.target?0:r.target?1:-1,n});for(let r=0;r<e.length;r++)e[r].index=r;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,r,i){const{rotationExpression:n,rotationType:s}=r,o=n==null?void 0:n.match(YUt),a=o==null?void 0:o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:a})),e)return e.map(l=>{const c=WUt.read(l.type),u=qUt[c];u||(K.getLogger(this).warn(`Unknown variable type: ${c}`),i!=null&&i.messages&&i.messages.push(new sp("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:i})));const h=new u;return h.read(l,i),h})}writeVariables(e,r){const i=[];for(const n of e){const s=n.toJSON(r);s&&i.push(s)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};d([m()],Q8.prototype,"visualVariables",null),Q8=d([F("esri.renderers.visualVariables.VisualVariableFactory")],Q8);const XUt=Q8,ZUt={base:r4,key:"type",typeMap:{opacity:AVe,color:PVe,rotation:OVe,size:MVe}},gO=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new XUt}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,n){return this._vvFactory.readVariables(r,i,n)}writeVisualVariables(r,i,n,s){i[n]=this._vvFactory.writeVariables(r,s)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const n=this.visualVariables;return n?n.filter(s=>s.type===r&&(typeof i=="string"?s.target===i:i!==!1||!s.target)):[]}async collectVVRequiredFields(r,i){let n=[];this.visualVariables&&(n=n.concat(this.visualVariables));for(const s of n)s&&(s.field&&Uh(r,i,s.field),s.normalizationField&&Uh(r,i,s.normalizationField),s.valueExpression&&(JUt(s.valueExpression,r,i)||await Uc(r,i,s.valueExpression)))}};return d([m({types:[ZUt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),d([Xe("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),d([nt("visualVariables")],e.prototype,"writeVisualVariables",null),e=d([F("esri.renderers.mixins.VisualVariablesMixin")],e),e};function JUt(t,e,r){const i=zUt(t);return i!=null&&(Uh(e,r,i),!0)}const NG={types:sLe,json:{write:{writer:tV},origins:{"web-scene":{types:jme,write:{writer:tV},read:{reader:FA({types:jme})}}}}},sue=cne({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},NG),RVe={types:{base:Zu,key:"type",typeMap:{"simple-fill":Q3.typeMap["simple-fill"],"picture-fill":Q3.typeMap["picture-fill"],"polygon-3d":Q3.typeMap["polygon-3d"]}},json:{write:{writer:tV},origins:{"web-scene":{type:PN,write:{writer:tV}}}}},K8={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var Ere;let rv=Ere=class extends Se{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new Ere({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};d([m({type:String,json:{write:!0}})],rv.prototype,"description",void 0),d([m({type:String,json:{write:!0}})],rv.prototype,"label",void 0),d([m({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],rv.prototype,"minValue",void 0),d([m({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],rv.prototype,"maxValue",void 0),d([m(sue)],rv.prototype,"symbol",void 0),rv=Ere=d([F("esri.renderers.support.ClassBreakInfo")],rv);const CV=rv;var Cre;const $Ve="log",eU="percent-of-total",tU="field",Pk=new Ii({esriNormalizeByLog:$Ve,esriNormalizeByPercentOfTotal:eU,esriNormalizeByField:tU}),QUt=to(CV);let Ro=Cre=class extends gO(N_){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,r){if(!Array.isArray(t))return;let i=e.minValue;return t.map(n=>{const s=new CV;return s.read(n,r),s.minValue==null&&(s.minValue=i),s.maxValue==null&&(s.maxValue=s.minValue),i=s.maxValue,s})}writeClassBreakInfos(t,e,r,i){const n=t.map(s=>s.write({},i));this._areClassBreaksConsecutive()&&n.forEach(s=>delete s.classMinValue),e[r]=n}castField(t){return t==null?t:typeof t=="function"?(K.getLogger(this).error(".field: field must be a string value"),null):iN(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,r=this.normalizationTotal!=null;return e||r?(t=e&&tU||r&&eU||null,e&&r&&K.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==tU&&t!==eU||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,r){let i=null;i=typeof t=="number"?new CV({minValue:t,maxValue:e,symbol:oLe(r)}):QUt(ae(t)),this.classBreakInfos.push(i),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const n=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(n[0]===t&&n[1]===e){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(t,e){return this.valueExpression&&(e==null?void 0:e.arcade)==null&&K.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let r=e;this.valueExpression&&(e==null?void 0:e.arcade)==null&&(r={...r,arcade:await Ub()});const i=this.getBreakIndex(t,r);return i!==-1?this.classBreakInfos[i]:null}getSymbol(t,e){if(this.valueExpression&&(e==null?void 0:e.arcade)==null)return void K.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(t,e);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(e==null?void 0:e.arcade)==null){const n=await Ub(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),r={...r,arcade:n}}const i=this.getBreakIndex(t,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((i,n)=>i+n.getMeshHash(),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){var t,e;return new Cre({field:this.field,backgroundFillSymbol:(t=this.backgroundFillSymbol)==null?void 0:t.clone(),defaultLabel:this.defaultLabel,defaultSymbol:(e=this.defaultSymbol)==null?void 0:e.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:ae(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:ae(this.visualVariables),legendOptions:ae(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),Uc(t,e,this.valueExpression)];Uh(t,e,this.field),Uh(t,e,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:n,arcade:s,timeZone:o}=e??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const c=s.arcadeUtils;if(!l){const h=c.createSyntaxTree(a);l=c.createFunction(h),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const u=c.executeFunction(l,c.createExecContext(t,c.getViewInfo({viewingMode:r,scale:i,spatialReference:n}),o));return this._getBreakIndexfromInfos(u)}_getBreakIndexForField(t){const e=this.field,r=t.attributes,i=this.normalizationType;let n=parseFloat(r[e]);if(i){const s=this.normalizationTotal,o=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if(i===$Ve)n=Math.log(n)*Math.LOG10E;else if(i!==eU||s==null||isNaN(s)){if(i===tU&&!isNaN(o)){if(isNaN(n)||isNaN(o))return-1;n/=o}}else n=n/s*100}return this._getBreakIndexfromInfos(n)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=t&&(e?t<=i[1]:t<i[1]))return r}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let r=1;r<e;r++)if(t[r-1].maxValue!==t[r].minValue)return!1;return!0}};d([m(RVe)],Ro.prototype,"backgroundFillSymbol",void 0),d([m({type:[CV]})],Ro.prototype,"classBreakInfos",void 0),d([Xe("classBreakInfos")],Ro.prototype,"readClassBreakInfos",null),d([nt("classBreakInfos")],Ro.prototype,"writeClassBreakInfos",null),d([m({type:String,json:{write:!0}})],Ro.prototype,"defaultLabel",void 0),d([m(NG)],Ro.prototype,"defaultSymbol",void 0),d([m({type:String,json:{write:!0}})],Ro.prototype,"field",void 0),d([Dr("field")],Ro.prototype,"castField",null),d([m({type:Boolean})],Ro.prototype,"isMaxInclusive",void 0),d([m({type:mP,json:{write:!0}})],Ro.prototype,"legendOptions",void 0),d([m({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],Ro.prototype,"minValue",null),d([m({type:String,json:{write:!0}})],Ro.prototype,"normalizationField",void 0),d([m({type:Number,cast:t=>Ld(t),json:{write:!0}})],Ro.prototype,"normalizationTotal",void 0),d([m({type:Pk.apiValues,value:null,json:{type:Pk.jsonValues,read:Pk.read,write:Pk.write}})],Ro.prototype,"normalizationType",null),d([gt({classBreaks:"class-breaks"})],Ro.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],Ro.prototype,"valueExpression",void 0),d([m({type:String,json:{write:!0}})],Ro.prototype,"valueExpressionTitle",void 0),Ro=Cre=d([F("esri.renderers.ClassBreaksRenderer")],Ro);const IVe=Ro;let FG=class{};function KUt(t){return t instanceof qA?t===FG.instance:(t==null?void 0:t.toString().toLowerCase())==="unknown"}function wdr(t){return KUt(t)?FG.instance:t}FG.instance=new qh("Etc/UTC");function ezt(t){return"timeZone"in t}function tzt(t){return"timeZone"in t}function rzt(t){return"dateFieldsTimeZone"in t}const izt=new Map;let kG=class rU{static fromJSON(e){return new rU(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new rU(e.fields??[],Qxe(e))}static fromLayerJSON(e){return new rU(e.fields??[],Qxe(e))}constructor(e=[],r){var n;this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=r?new Map(r):null;const i=[];for(const s of this.fields){const o=s==null?void 0:s.name,a=Jxe(o);if(o&&a){const l=FS(o);this._fieldsMap.set(o,s),this._fieldsMap.set(l,s),this._normalizedFieldsMap.set(a,s),i.push(`${l}:${s.type}:${(n=this._timeZoneByFieldName)==null?void 0:n.get(o)}`),vIe(s)?(this.dateFields.push(s),this._dateFieldsSet.add(s)):zoe(s)&&(this._numericFieldsSet.add(s),this.numericFields.push(s)),kme(s)||Ume(s)||(s.editable=s.editable==null||!!s.editable,s.nullable=s.nullable==null||!!s.nullable)}}i.sort(),this.uid=i.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)kme(e)||Ume(e)||e.nullable||tut(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===(e==null?void 0:e.uid)}has(e){return this.get(e)!=null}get(e){if(!e)return;let r=this._fieldsMap.get(e);return r||(r=this._fieldsMap.get(FS(e))??this._normalizedFieldsMap.get(Jxe(e)),r&&this._fieldsMap.set(e,r),r)}getTimeZone(e){const r=this.get(e&&typeof e!="string"?e.name:e);return r?this._timeZoneByFieldName?this._timeZoneByFieldName.get(r.name):r.type==="date"||r.type==="esriFieldTypeDate"?(K.getLogger("esri.layers.support.FieldsIndex").error(new B("getTimeZone:no-timezone-information",`no time zone information for field '${r.name}'`)),Fb):LVe.has(r.type)?QT:null:null}getLuxonTimeZone(e){const r=this.getTimeZone(e);return r?r===QT?FG.instance:r===Fb?al.utcInstance:rN(izt,r,()=>qh.create(r)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return fut(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){var r;return((r=this.get(e))==null?void 0:r.name)??void 0}toJSON(){return{fields:this.fields.map(e=>iz(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}};function FS(t){return t.trim().toLowerCase()}function Jxe(t){var e;return((e=Fct(t))==null?void 0:e.toLowerCase())??""}const LVe=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function Qxe(t){const e=new Map;if(!t.fields)return e;const r=t.datesInUnknownTimezone===!0,{timeInfo:i,editFieldsInfo:n}=t,s=(i?"startField"in i?i.startField:i.startTimeField:"")??"",o=(i?"endField"in i?i.endField:i.endTimeField:"")??"",a=rzt(t)?t.dateFieldsTimeZone??null:t.dateFieldsTimeReference?v6(t.dateFieldsTimeReference):null,l=n?ezt(n)?n.timeZone??a:n.dateFieldsTimeReference?v6(n.dateFieldsTimeReference):a??Fb:null,c=i?tzt(i)?i.timeZone??a:i.timeReference?v6(i.timeReference):a:null,u=new Map([[FS((n==null?void 0:n.creationDateField)??""),l],[FS((n==null?void 0:n.editDateField)??""),l],[FS(s),c],[FS(o),c]]);for(const{name:h,type:p}of t.fields)if(LVe.has(p))e.set(h,QT);else if(p!=="date"&&p!=="esriFieldTypeDate")e.set(h,null);else if(r)e.set(h,QT);else{const f=u.get(FS(h??""))??a;e.set(h,f)}return e}const Kxe="esri.renderers.support.DictionaryLoader",nzt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let DVe=class{constructor(e,r,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new Jle(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=r,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,r){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{i=await this._dictionaryPromise}catch(h){if(on(h))return this._dictionaryPromise=null,null}const n=this._dictionaryVersion&&this._dictionaryVersion.since(4,0),s={};if(this.fieldMap)for(const h of this._symbolFields){const p=Jke(this.fieldMap[h],this._fieldIndex);if(p){const f=e.attributes[p];s[h]=n?f:f!=null?""+e.attributes[p]:""}else s[h]=""}let o=null;try{o=i==null?void 0:i(s,r)}catch{return null}if(!o||typeof o!="string"||o==="invalid")return null;const a=o.split(";"),l=[],c=[];for(const h of a)if(h)if(h.includes("po:")){const p=h.substr(3).split("|");if(p.length===3){const f=p[0],g=p[1];let y=p[2];if(g==="DashTemplate")y=y.split(" ").map(v=>Number(v));else if(g==="Color"){const v=new De(y).toRgba();y=[v[0],v[1],v[2],255*v[3]]}else y=Number(y);c.push({primitiveName:f,propertyName:g,value:y,defaultValue:null})}}else if(h.includes("|")){for(const p of h.split("|"))if(this._itemNames.has(p)){l.push(p);break}}else this._itemNames.has(h)&&l.push(h);const u=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point";return this._cimPartsToCIMSymbol(e,l,c,u,r)}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void K.getLogger(Kxe).error("no valid URL!");const r=Vt(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:i}]=await Promise.all([r,Ub()]);if(!i)throw this._dictionaryPromise=null,new B("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:n,dictionary_version:s,expression:o,itemsNames:a}=i,l=o;let c=!1;s&&(this._dictionaryVersion=pO.parse(s),c=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=n.symbol;const u={};if(this.config){const f=this.config;for(const g in f)u[g]=f[g]}if(n.configuration)for(const f of n.configuration)u.hasOwnProperty(f.name)||(u[f.name]=f.value);const h=[];if(e!=null&&e.fields&&this.fieldMap)for(const f in this.fieldMap){const g=this.fieldMap[f],y=e.fields.filter(v=>v.name.toLowerCase()===(g==null?void 0:g.toLowerCase()));y.length>0&&h.push({...y[0],type:c?y[0].type:"esriFieldTypeString"})}h.length>0&&(this._fieldIndex=new kG(h));const p=Lct(l,e!=null?e.spatialReference:null,h,u).then(f=>{const g={scale:0};return(y,v)=>{if(f==null)return null;const b=f.repurposeFeature({geometry:null,attributes:y});return g.scale=v!=null?v.scale??void 0:void 0,f.evaluate({$feature:b,$view:g},f.services)}}).catch(f=>(K.getLogger(Kxe).error("Creating dictinoary expression failed:",f),null));return this._dictionaryPromise=p,p}async _cimPartsToCIMSymbol(e,r,i,n,s){const o=new Array(r.length);for(let c=0;c<r.length;c++)o[c]=this._getSymbolPart(r[c],s);let a=await Promise.all(o);const l=this.fieldMap;if(l){a=ae(a);for(const c of a)v3.applyDictionaryTextOverrides(c,e,l,this._fieldIndex,pte(c))}return new SN({data:this._combineSymbolParts(a,i,n)})}async _getSymbolPart(e,r){const i=this._symbolCache.get(e);if(i)return i;if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(o=>o.data);const n=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),s=Vt(n,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(e,s),s.finally(()=>this._ongoingRequests.delete(e));try{const o=await s;return this._symbolCache.put(e,o.data),o.data}catch(o){throw o}}_combineSymbolParts(e,r,i){if(!e||e.length===0)return null;const n={...e[0]};if(e.length>1){n.symbolLayers=[];for(const s of e){const o=s;n.symbolLayers.unshift(...o.symbolLayers)}}return i&&(n.callout=nzt),{type:"CIMSymbolReference",symbol:n,primitiveOverrides:r}}};var Pre;let uf=Pre=class extends gO(N_){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new DVe(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,r,i){i!=null&&i.origin||super.writeVisualVariables(t,e,r,i)}clone(){return new Pre({config:ae(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:ae(this.fieldMap),url:ae(this.url),visualVariables:ae(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await Uc(t,e,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];e.has(i)&&t.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};d([m({type:DVe})],uf.prototype,"_loader",null),d([m({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],uf.prototype,"config",void 0),d([m({type:Object,json:{write:!0}})],uf.prototype,"fieldMap",void 0),d([m({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],uf.prototype,"scaleExpression",void 0),d([nt("scaleExpression")],uf.prototype,"writeData",null),d([m({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],uf.prototype,"scaleExpressionTitle",void 0),d([m({type:String,json:{write:!0}})],uf.prototype,"url",void 0),d([nt("visualVariables")],uf.prototype,"writeVisualVariables",null),uf=Pre=d([F("esri.renderers.DictionaryRenderer")],uf);const szt=uf;var Are;let f0=Are=class extends Se{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(K.getLogger(this).error(".field: field must be a string value"),null):iN(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){var t;return new Are({color:(t=this.color)==null?void 0:t.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};d([m({type:De,json:{type:[Number],write:!0}})],f0.prototype,"color",void 0),d([m({type:String,json:{write:!0}})],f0.prototype,"field",void 0),d([Dr("field")],f0.prototype,"castField",null),d([m({type:String,json:{write:!0}})],f0.prototype,"label",void 0),d([m({type:String,json:{write:!0}})],f0.prototype,"valueExpression",void 0),d([m({type:String,json:{write:!0}})],f0.prototype,"valueExpressionTitle",void 0),f0=Are=d([F("esri.renderers.support.AttributeColorInfo")],f0);const NVe=f0;var Ore;let iU=Ore=class extends Se{constructor(){super(...arguments),this.unit=null}clone(){return new Ore({unit:this.unit})}};d([m({type:String,json:{write:!0}})],iU.prototype,"unit",void 0),iU=Ore=d([F("esri.renderers.support.DotDensityLegendOptions")],iU);const ozt=iU;var Mre;let ru=Mre=class extends gO(N_){constructor(t){super(t),this.attributes=null,this.backgroundColor=new De([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new vp,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new O2({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,r)=>e+r.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new Mre({attributes:ae(this.attributes),backgroundColor:ae(this.backgroundColor),dotBlendingEnabled:ae(this.dotBlendingEnabled),dotShape:ae(this.dotShape),dotSize:ae(this.dotSize),dotValue:ae(this.dotValue),legendOptions:ae(this.legendOptions),outline:ae(this.outline),referenceScale:ae(this.referenceScale),seed:ae(this.seed),visualVariables:ae(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(r=>r.field||r.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const r of this.attributes??[])r.valueExpression&&await Uc(t,e,r.valueExpression),r.field&&t.add(r.field)}};d([m({type:[NVe],json:{write:!0}})],ru.prototype,"attributes",void 0),d([m({type:De,json:{write:!0}})],ru.prototype,"backgroundColor",void 0),d([m({type:Boolean,json:{write:!0}})],ru.prototype,"dotBlendingEnabled",void 0),d([m({type:String,json:{write:!1}})],ru.prototype,"dotShape",void 0),d([m({type:Number,json:{write:!0}})],ru.prototype,"dotSize",void 0),d([m({type:ozt,json:{write:!0}})],ru.prototype,"legendOptions",void 0),d([m({type:vp,json:{default:null,write:!0}})],ru.prototype,"outline",void 0),d([m({type:Number,json:{write:!0}})],ru.prototype,"dotValue",void 0),d([m({type:Number,json:{write:!0}})],ru.prototype,"referenceScale",void 0),d([m({type:Number,json:{write:!0}})],ru.prototype,"seed",void 0),d([gt({dotDensity:"dot-density"})],ru.prototype,"type",void 0),ru=Mre=d([F("esri.renderers.DotDensityRenderer")],ru);const azt=ru;var Rre;let j$=Rre=class extends Se{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new Rre({color:this.color&&this.color.clone(),ratio:this.ratio})}};d([m({type:De,json:{type:[Vi],default:null,write:!0}})],j$.prototype,"color",void 0),d([m({type:Number,json:{write:!0}})],j$.prototype,"ratio",void 0),j$=Rre=d([F("esri.renderers.support.HeatmapColorStop")],j$);const nU=j$;let DC=class extends ds(Se){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};d([m({type:String,json:{write:!0}})],DC.prototype,"minLabel",void 0),d([m({type:String,json:{write:!0}})],DC.prototype,"maxLabel",void 0),d([m({type:String,json:{write:!0}})],DC.prototype,"title",void 0),DC=d([F("esri.renderers.support.HeatmapLegendOptions")],DC);const oue=2.4;function lzt(t){return hl(t*oue)}function czt(t){return bs(t)/oue}function uzt(t,e,r,i){let{color:n,ratio:s}=e,{color:o,ratio:a}=r;a===s&&(a===1?s-=1e-6:a+=1e-6);const l=we((i-s)/(a-s),0,1);NB(t,n.toArray(),o.toArray(),l)}function Tdr(t){const r=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return r;let i=t[0],n=t[0],s=1;const o=tr();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>n.ratio&&s<t.length;)i=n,n=t[s++];uzt(o,i,n,l),r.set(o,4*a)}return r}function Edr(t,e,r){const i=Math.sqrt(t**2+e**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function Cdr(t){return typeof t=="function"?t:t?e=>+e[t]:()=>1}var $re;function eSe(t){if(t!=null){const{maxDensity:e,minDensity:r,radius:i}=t;if(e!=null||r!=null||i!=null){const{blurRadius:n,maxPixelIntensity:s,minPixelIntensity:o,...a}=t;return a}}return t}let Ta=$re=class extends N_{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new nU({ratio:0,color:new De("rgba(255, 140, 0, 0)")}),new nU({ratio:.75,color:new De("rgba(255, 140, 0, 1)")}),new nU({ratio:.9,color:new De("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return eSe(t)}get blurRadius(){return czt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",lzt(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(oue**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||$s(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,m2(()=>{L0(K.getLogger(this),t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=eSe(t),super.read(t,e)}getSymbol(){return new pw}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const r=this.field,i=this.valueExpression;r&&typeof r=="string"&&Uh(t,e,r),i&&typeof i=="string"&&await Uc(t,e,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new $re({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:ae(this.colorStops),field:this.field,legendOptions:ae(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};d([m({type:EVe,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Ta.prototype,"authoringInfo",void 0),d([m({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ta.prototype,"blurRadius",null),d([m({type:[nU],json:{write:!0}})],Ta.prototype,"colorStops",void 0),d([m({type:String,json:{write:!0}})],Ta.prototype,"field",void 0),d([m({type:DC,json:{write:!0}})],Ta.prototype,"legendOptions",void 0),d([m({type:Number,json:{write:!0}})],Ta.prototype,"maxDensity",void 0),d([m({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ta.prototype,"maxPixelIntensity",null),d([m({type:Number,json:{write:!0}})],Ta.prototype,"minDensity",void 0),d([m({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ta.prototype,"minPixelIntensity",null),d([m({type:Number,cast:gn,json:{write:!0}})],Ta.prototype,"radius",void 0),d([m({type:Number,range:{min:0},json:{default:0,write:!0}})],Ta.prototype,"referenceScale",void 0),d([gt({heatmap:"heatmap"})],Ta.prototype,"type",void 0),d([m({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Ta.prototype,"valueExpression",void 0),d([m({type:String})],Ta.prototype,"valueExpressionTitle",void 0),d([m({readOnly:!0})],Ta.prototype,"_pixelIntensityToDensity",null),Ta=$re=d([F("esri.renderers.HeatmapRenderer")],Ta);const FVe=Ta;let kS=class extends ds(Se){constructor(){super(...arguments),this.color=new De([0,0,0,0]),this.label=null,this.threshold=0}};d([m({type:De,json:{write:!0}})],kS.prototype,"color",void 0),d([m({type:String,json:{write:!0}})],kS.prototype,"label",void 0),d([m({type:Number,range:{min:0,max:1},json:{write:!0}})],kS.prototype,"threshold",void 0),kS=d([F("esri.renderers.support.OthersCategory")],kS);let sU=class extends ds(Se){constructor(){super(...arguments),this.title=null}};d([m({type:String,json:{write:!0}})],sU.prototype,"title",void 0),sU=d([F("esri.renderers.support.PieChartLegendOptions")],sU);let fh=class extends gO(ds(N_)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new De([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new kS,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new pw({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(rw)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,r)=>e+r.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,r)=>e+JSON.stringify(r),"")}async collectRequiredFields(e,r){await this.collectVVRequiredFields(e,r);for(const i of this.attributes)i.valueExpression&&await Uc(e,r,i.valueExpression),i.field&&e.add(i.field)}};d([m({type:[NVe],json:{write:!0}})],fh.prototype,"attributes",void 0),d([m({type:O2,json:{default:null,write:!0}})],fh.prototype,"backgroundFillSymbol",void 0),d([m({type:De,json:{write:!0}})],fh.prototype,"defaultColor",void 0),d([m({type:String,json:{write:!0}})],fh.prototype,"defaultLabel",void 0),d([m({type:Number,range:{min:0,max:1},json:{write:!0}})],fh.prototype,"holePercentage",void 0),d([m({type:kS,json:{write:!0}})],fh.prototype,"othersCategory",void 0),d([m({type:sU,json:{write:!0}})],fh.prototype,"legendOptions",void 0),d([m({type:vp,json:{default:null,write:!0}})],fh.prototype,"outline",void 0),d([m({type:Number,cast:gn,json:{write:!0}})],fh.prototype,"size",void 0),d([gt({pieChart:"pie-chart"})],fh.prototype,"type",void 0),fh=d([F("esri.renderers.PieChartRenderer")],fh);const hzt=fh;var Ire;let pS=Ire=class extends gO(N_){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new Ire({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:ae(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};d([m({type:String,json:{write:!0}})],pS.prototype,"description",void 0),d([m({type:String,json:{write:!0}})],pS.prototype,"label",void 0),d([m(sue)],pS.prototype,"symbol",void 0),d([gt({simple:"simple"})],pS.prototype,"type",void 0),pS=Ire=d([F("esri.renderers.SimpleRenderer")],pS);const aue=pS,dzt=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function Lre(t){return t instanceof Pe}function tSe(t){return t instanceof St?Object.keys(t.items):Lre(t)?$s(t).keys():t?Object.keys(t):[]}function Ak(t,e){return t instanceof St?t.items[e]:t[e]}function pzt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function lL(t){return t?t.declaredClass:null}function kVe(t,e){var h;const r=t.diff;if(r&&typeof r=="function")return r(t,e);const i=tSe(t),n=tSe(e);if(i.length===0&&n.length===0)return;if(!i.length||!n.length||pzt(t,e))return{type:"complete",oldValue:t,newValue:e};const s=n.filter(p=>!i.includes(p)),o=i.filter(p=>!n.includes(p)),a=i.filter(p=>n.includes(p)&&Ak(t,p)!==Ak(e,p)).concat(s,o).sort(),l=lL(t);if(l&&dzt.has(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const u=Lre(t)&&Lre(e);for(const p of a){const f=Ak(t,p),g=Ak(e,p);let y;if((u||typeof f!="function"&&typeof g!="function")&&f!==g&&(f!=null||g!=null)){if(r&&r[p]&&typeof r[p]=="function")y=(h=r[p])==null?void 0:h.call(r,f,g);else if(f instanceof Date&&g instanceof Date){if(f.getTime()===g.getTime())continue;y={type:"complete",oldValue:f,newValue:g}}else y=typeof f=="object"&&typeof g=="object"&&lL(f)===lL(g)?kVe(f,g):{type:"complete",oldValue:f,newValue:g};y!=null&&(c!=null?c.diff[p]=y:c={type:"partial",diff:{[p]:y}})}}return c}function Mdr(t,e){return fzt(t,e)}function fzt(t,e){if(t==null)return!1;const r=e.split(".");let i=t;for(const n of r){if(i.type==="complete")return!0;if(i.type!=="partial")return!1;{const s=i.diff[n];if(!s)return!1;i=s}}return!0}function Rdr(t,e){if(!t)return!1;if(t.type==="partial"){const r=Object.keys(t.diff);return r.length===1&&r[0]===e}return!1}function mzt(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&lL(t)!==lL(e)?{type:"complete",oldValue:t,newValue:e}:kVe(t,e)}function Ok(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const r of e.added)if(!Ok(r))return!1;for(const r of e.removed)if(!Ok(r))return!1;for(const r of e.changed)if(!Ok(r))return!1;return!0}case"partial":for(const e in t.diff)if(!Ok(t.diff[e]))return!1;return!0}}let NC=class extends ds(Se){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};d([m(K8)],NC.prototype,"value",void 0),d([m(K8)],NC.prototype,"value2",void 0),d([m(K8)],NC.prototype,"value3",void 0),NC=d([F("esri.renderers.support.UniqueValue")],NC);const gP=NC;let iv=class extends ds(Se){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const r=typeof(e=Array.isArray(e)?e:[e])[0];return r==="string"||r==="number"?e.map(i=>new gP({value:i})):r==="object"?e[0]instanceof gP?e:e.map(i=>new gP(i)):null}};d([m({type:String,json:{write:!0}})],iv.prototype,"description",void 0),d([m({type:String,json:{write:!0}})],iv.prototype,"label",void 0),d([m(NG)],iv.prototype,"symbol",void 0),d([m({type:[gP],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new gP({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const r=[];for(const i of t){const n=[i.value,i.value2,i.value3].filter(rw).map(s=>s.toString());r.push(n)}e.values=r}}}})],iv.prototype,"values",void 0),d([Dr("values")],iv.prototype,"castValues",null),iv=d([F("esri.renderers.support.UniqueValueClass")],iv);const UVe=iv;let H$=class extends ds(Se){constructor(e){super(e),this.heading=null,this.classes=null}};d([m({type:String,json:{write:!0}})],H$.prototype,"heading",void 0),d([m({type:[UVe],json:{write:!0}})],H$.prototype,"classes",void 0),H$=d([F("esri.renderers.support.UniqueValueGroup")],H$);const Dre=H$;var Nre;let fS=Nre=class extends Se{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new Nre({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){var e;const t=JSON.stringify((e=this.symbol)==null?void 0:e.toJSON());return`${this.value}.${t}`}};d([m({type:String,json:{write:!0}})],fS.prototype,"description",void 0),d([m({type:String,json:{write:!0}})],fS.prototype,"label",void 0),d([m(sue)],fS.prototype,"symbol",void 0),d([m(K8)],fS.prototype,"value",void 0),fS=Nre=d([F("esri.renderers.support.UniqueValueInfo")],fS);const cL=fS;var q$;const zVe="esri.renderers.UniqueValueRenderer",C1=()=>K.getLogger(zVe),rSe="uvInfos-watcher",iSe="uvGroups-watcher",gzt=",",yzt=to(cL);function _zt(t){const{field1:e,field2:r,field3:i,fieldDelimiter:n,uniqueValueInfos:s,valueExpression:o}=t,a=!(!e||!r);return[{classes:(s??[]).map(l=>{var b;const{symbol:c,label:u,value:h,description:p}=l,[f,g,y]=a?((b=h==null?void 0:h.toString())==null?void 0:b.split(n||""))||[]:[h],v=[];return(e||o)&&v.push(f),r&&v.push(g),i&&v.push(y),{symbol:c,label:u,values:[v],description:p}})}]}let ts=q$=class extends gO(N_){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,r){if(!e&&!r)return;if(!e||!r)return{type:"complete",oldValue:e,newValue:r};let i=!1;const n={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let s=0;s<r.length;s++){const o=e.find(a=>a.value===r[s].value);o?mzt(o,r[s])?(n.changed.push({type:"complete",oldValue:o,newValue:r[s]}),i=!0):n.unchanged.push({oldValue:o,newValue:r[s]}):(n.added.push(r[s]),i=!0)}for(let s=0;s<e.length;s++)r.find(o=>o.value===e[s].value)||(n.removed.push(e[s]),i=!0);return i?n:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:iN(t)}writeField(t,e,r,i){typeof t=="string"?e[r]=t:i!=null&&i.messages?i.messages.push(new B("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):C1().error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,r){return r.portal||Ho.getDefault()}readStyleOrigin(t,e,r){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const i=a_(e.styleUrl,r);return Object.freeze({styleUrl:i})}}writeStyleOrigin(t,e,r,i){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=l_(t.styleUrl,i))}set uniqueValueGroups(t){this.styleOrigin?C1().error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?C1().error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){var i;if(this.styleOrigin)return void C1().error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r=typeof t=="object"?yzt(t):new cL({value:t,symbol:oLe(e)}),(i=this.uniqueValueInfos)==null||i.push(r),this._valueInfoMap[r.value]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void C1().error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e)for(let r=0;r<e.length;r++){const i=e[r];if(String(i.value)===String(t)){delete this._valueInfoMap[t],e.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let r=e;return this.valueExpression&&(e==null?void 0:e.arcade)==null&&(r={...r,arcade:await Ub()}),this._getUniqueValueInfo(t,r)}getSymbol(t,e){if(this.valueExpression&&(e==null?void 0:e.arcade)==null)return void C1().error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(t,e);return(r==null?void 0:r.symbol)||this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(r==null?void 0:r.arcade)==null){const n=await Ub(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),r={...r,arcade:n}}const i=this._getUniqueValueInfo(t,r);return(i==null?void 0:i.symbol)||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){var i;const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=(i=this.uniqueValueInfos)==null?void 0:i.reduce((n,s)=>n+s.getMeshHash(),"");return`${t}.${e}.${r}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new q$({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:ae(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:ae(this.visualVariables),legendOptions:ae(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:ae(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=ae(this.uniqueValueInfos),r=ae(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(ae(this.styleOrigin))),Object.freeze(e),Object.freeze(r)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",r),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),Uc(t,e,this.valueExpression)];Uh(t,e,this.field),Uh(t,e,this.field2),Uh(t,e,this.field3),await Promise.all(r)}populateFromStyle(){return tce(this.styleOrigin,{portal:this.portal}).then(t=>{var r;const e=[];return this._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(i=>{const n=new M2({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==t.data.defaultItem||(this.defaultSymbol=n,this._isDefaultSymbolDerived=!0);const s=new cL({value:i.name,symbol:n});e.push(s),this._valueInfoMap[i.name]=s}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((r=this.uniqueValueInfos)!=null&&r.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",gzt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(rSe);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const r of t)e.push(pe(()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description}),(i,n)=>{i!==n&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,rSe)}}_watchUniqueValueGroups(){this.removeHandles(iSe);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const r of t){e.push(pe(()=>({classes:r.classes}),(i,n)=>{i!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const i of r.classes??[])e.push(pe(()=>({symbol:i.symbol,values:i.values,label:i.label,description:i.description}),(n,s)=>{n!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,iSe)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:r,field3:i,fieldDelimiter:n,uniqueValueGroups:s,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!r);for(const l of s)for(const c of l.classes??[]){const{symbol:u,label:h,values:p,description:f}=c;for(const g of p??[]){const{value:y,value2:v,value3:b}=g,w=[y];r&&w.push(v),i&&w.push(b);const x=a?w.join(n||""):w[0];t.push(new cL({symbol:u,label:h,value:x,description:f}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:r,valueExpression:i,fieldDelimiter:n,uniqueValueInfos:s}=this;if(!e&&!i||!s.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!r),a=s.map(c=>{var b;const{symbol:u,label:h,value:p,description:f}=c,[g,y,v]=o?((b=p==null?void 0:p.toString())==null?void 0:b.split(n||""))||[]:[p];return new UVe({symbol:u,label:h,description:f,values:[new gP({value:g,value2:y,value3:v})]})}),l=[new Dre({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:n,arcade:s,timeZone:o}=e??{};let a=this._cache.compiledFunc;const l=s.arcadeUtils;if(!a){const u=l.createSyntaxTree(this.valueExpression);a=l.createFunction(u),this._cache.compiledFunc=a}const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:r,scale:i,spatialReference:n}),o));return this._valueInfoMap[c+""]}_getUnqiueValueInfoForFields(t){const e=this.field,r=t.attributes;let i;if(typeof e!="function"&&this.field2){const n=this.field2,s=this.field3,o=[];e&&o.push(r[e]),n&&o.push(r[n]),s&&o.push(r[s]),i=o.join(this.fieldDelimiter||"")}else typeof e=="function"?i=e(t):e&&(i=r[e]);return this._valueInfoMap[i+""]}static fromPortalStyle(t,e){const r=new q$(e==null?void 0:e.properties);r._set("styleOrigin",Object.freeze({styleName:t})),r._set("portal",(e==null?void 0:e.portal)||Ho.getDefault());const i=r.populateFromStyle();return i.catch(n=>{C1().error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",n)}),i}static fromStyleUrl(t,e){const r=new q$(e==null?void 0:e.properties);r._set("styleOrigin",Object.freeze({styleUrl:t}));const i=r.populateFromStyle();return i.catch(n=>{C1().error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",n)}),i}};d([m({readOnly:!0})],ts.prototype,"_cache",null),d([gt({uniqueValue:"unique-value"})],ts.prototype,"type",void 0),d([m(RVe)],ts.prototype,"backgroundFillSymbol",void 0),d([m({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],ts.prototype,"field",null),d([Dr("field")],ts.prototype,"castField",null),d([nt("field")],ts.prototype,"writeField",null),d([m({type:String,value:null,json:{write:!0}})],ts.prototype,"field2",null),d([m({type:String,value:null,json:{write:!0}})],ts.prototype,"field3",null),d([m({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],ts.prototype,"orderByClassesEnabled",void 0),d([m({type:String,value:null,json:{write:!0}})],ts.prototype,"valueExpression",null),d([m({type:String,json:{write:!0}})],ts.prototype,"valueExpressionTitle",void 0),d([m({type:mP,json:{write:!0}})],ts.prototype,"legendOptions",void 0),d([m({type:String,json:{write:!0}})],ts.prototype,"defaultLabel",void 0),d([m(cne({...NG},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],ts.prototype,"defaultSymbol",null),d([m({type:String,value:null,json:{write:!0}})],ts.prototype,"fieldDelimiter",null),d([m({type:Ho,readOnly:!0})],ts.prototype,"portal",void 0),d([Xe("portal",["styleName"])],ts.prototype,"readPortal",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],ts.prototype,"styleOrigin",void 0),d([Xe("styleOrigin",["styleName","styleUrl"])],ts.prototype,"readStyleOrigin",null),d([nt("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],ts.prototype,"writeStyleOrigin",null),d([m({type:[Dre],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,r)=>(e.uniqueValueGroups||_zt(e)).map(i=>Dre.fromJSON(i,r))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],ts.prototype,"uniqueValueGroups",null),d([m({type:[cL],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],ts.prototype,"uniqueValueInfos",null),ts=q$=d([F(zVe)],ts);const lue=ts,VVe={key:"type",base:N_,typeMap:{heatmap:FVe,simple:aue,"unique-value":lue,"class-breaks":IVe,"dot-density":azt,dictionary:szt,"pie-chart":hzt},errorContext:"renderer"},BVe={key:"type",base:N_,typeMap:{simple:aue,"unique-value":lue,"class-breaks":IVe,heatmap:FVe},errorContext:"renderer",validate:vzt};function vzt(t){switch(t.type){case"simple":return bzt(t);case"unique-value":return wzt(t);case"class-breaks":return xzt(t);case"heatmap":return t}}function bzt(t){if(t.symbol)return t;K.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function wzt(t){const e=t.uniqueValueInfos,r=e==null?void 0:e.filter(({symbol:i,label:n},s)=>(i||K.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${s}] ${n}) without a symbol from web scene.`),!!i));return(r==null?void 0:r.length)!==(e==null?void 0:e.length)&&(t.uniqueValueInfos=r),t}function xzt(t){const e=t.classBreakInfos,r=e==null?void 0:e.filter(({symbol:i,label:n},s)=>(i||K.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${s}] ${n}) without a symbol from web scene.`),!!i));return(r==null?void 0:r.length)!==(e==null?void 0:e.length)&&(t.classBreakInfos=r),t}function Ddr(t,e){return Tzt(t,null,e)}const Szt=FA({types:VVe});function Tzt(t,e,r){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(r!=null&&r.messages&&r.messages.push(new sp("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:r})),null):Szt(t,e,r):null}let Ezt=class GVe{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(ZX),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const r=new GVe,i=this._originStores[We.DEFAULTS];i&&i.forEach((n,s)=>{r.set(s,ae(n),We.DEFAULTS)});for(let n=We.SERVICE;n<ZX;n++){const s=this._originStores[n];s&&s.forEach((o,a)=>{e&&e.has(a)||r.set(a,ae(o),n)})}return r}get(e,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(e):void 0}keys(e){const r=e==null?this._values:this._originStores[e];return r?[...r.keys()]:[]}set(e,r,i=We.USER){let n=this._originStores[i];if(n||(n=new Map,this._originStores[i]=n),n.set(e,r),!this._values.has(e)||this._propertyOriginMap.get(e)<=i){const s=this._values.get(e);return this._values.set(e,r),this._propertyOriginMap.set(e,i),s!==r}return!1}delete(e,r=We.USER){const i=this._originStores[r];if(!i)return;const n=i.get(e);if(i.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===r){this._values.delete(e);for(let s=r-1;s>=0;s--){const o=this._originStores[s];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,s);break}}}return n}has(e,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(e)}revert(e,r){for(;r>0&&!this.has(e,r);)--r;const i=this._originStores[r],n=i==null?void 0:i.get(e),s=this._values.get(e);return this._values.set(e,n),this._propertyOriginMap.set(e,r),s!==n}originOf(e){return this._propertyOriginMap.get(e)||We.DEFAULTS}forEach(e){this._values.forEach(e)}};const jVe=t=>{let e=class extends t{constructor(...r){super(...r);const i=$s(this),n=i.store,s=new Ezt;i.store=s,$Ce(i,n,s)}read(r,i){LCe(this,r,i)}getAtOrigin(r,i){const n=$Y(this),s=Au(i);if(typeof r=="string")return n.get(r,s);const o={};return r.forEach(a=>{o[a]=n.get(a,s)}),o}originOf(r){return $L(this.originIdOf(r))}originIdOf(r){return $Y(this).originOf(r)}revert(r,i){const n=$Y(this),s=Au(i),o=$s(this);let a;a=typeof r=="string"?r==="*"?n.keys(s):[r]:r,a.forEach(l=>{o.invalidate(l),n.revert(l,s),o.commit(l)})}};return e=d([F("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function $Y(t){return $s(t).store}let nSe=class extends jVe(Pe){};nSe=d([F("esri.core.ReadOnlyMultiOriginJSONSupport")],nSe);const Czt=t=>{let e=class extends t{constructor(...r){super(...r)}clear(r,i="user"){return IY(this).delete(r,Au(i))}write(r,i){return NCe(this,r=r||{},i),r}setAtOrigin(r,i,n){$s(this).setAtOrigin(r,i,Au(n))}removeOrigin(r){const i=IY(this),n=Au(r),s=i.keys(n);for(const o of s)i.originOf(o)===n&&i.set(o,i.get(o,n),We.USER)}updateOrigin(r,i){const n=IY(this),s=Au(i),o=Yf(this,r);for(let a=s+1;a<ZX;++a)n.delete(r,a);n.set(r,o,s)}toJSON(r){return this.write({},r)}};return e=d([F("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function IY(t){return $s(t).store}const UG=t=>{let e=class extends Czt(jVe(t)){constructor(...r){super(...r)}};return e=d([F("esri.core.MultiOriginJSONSupport")],e),e};let sSe=class extends UG(Pe){};sSe=d([F("esri.core.MultiOriginJSONSupport")],sSe);const F_="upload-assets",vw=()=>new Error;let kdr=class extends B{constructor(){super(`${F_}:unsupported`,"Layer does not support asset uploads.",vw())}},zdr=class extends B{constructor(){super(`${F_}:no-glb-support`,"Layer does not support glb.",vw())}},Bdr=class extends B{constructor(){super(`${F_}:no-supported-source`,"No supported external source found",vw())}},jdr=class extends B{constructor(){super(`${F_}:not-base-64`,"Expected gltf data in base64 format after conversion.",vw())}},qdr=class extends B{constructor(){super(`${F_}:unable-to-prepare-options`,"Unable to prepare uploadAsset request options.",vw())}},Ydr=class extends B{constructor(e,r){super(`${F_}:bad-response`,`Bad response. Uploaded ${e} items and received ${r} results.`,vw())}},Zdr=class extends B{constructor(e,r){super(`${F_}-layer:upload-failed`,`Failed to upload mesh file ${e}. Error code: ${(r==null?void 0:r.code)??"-1"}. Error message: ${(r==null?void 0:r.messages)??"unknown"}`,vw())}},Qdr=class extends B{constructor(e){super(`${F_}-layer:unsupported-format`,`The service allowed us to upload an asset of FormatID ${e}, but it does not list it in its supported formats.`,vw())}},epr=class extends B{constructor(){super(`${F_}:convert3D-failed`,"convert3D failed.")}},Pzt=class extends B{constructor(){super("invalid-input:no-model","No supported model found")}},Azt=class extends B{constructor(){super("invalid-input:multiple-models","Multiple supported models found")}};function Ozt(t){return"portalItem"in t}const HVe=t=>{let e=class extends t{get apiKey(){var r;return this._isOverridden("apiKey")?this._get("apiKey"):Ozt(this)?(r=this.portalItem)==null?void 0:r.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return d([m({type:String})],e.prototype,"apiKey",null),e=d([F("esri.layers.mixins.APIKeyMixin")],e),e},qVe=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=fm(this.url);if(r!=null&&r.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",sdt(r,K.getLogger(this)))}};return d([m()],e.prototype,"title",null),d([m({type:String})],e.prototype,"url",null),e=d([F("esri.layers.mixins.ArcGISService")],e),e},WVe=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return d([m({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],e.prototype,"customParameters",void 0),e=d([F("esri.layers.mixins.CustomParametersMixin")],e),e},Mzt=i8t(),YVe=new Map,XVe=new Map;async function npr(t,e,r){if(!t||!r)return!1;if(!e)return!0;const i=new URL(t).host;let n=YVe.get(i);if(!n){const s=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");n=(await Vt(s,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return n===e}async function spr(t,e,r=!1){var s,o;if(!t||!e)return!0;const i=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),n=(s=XVe.get(i))==null?void 0:s.entries();if(n){for(const[a,l]of n)if(l.name===e){const c=!((o=l.stack)!=null&&o.hasForwardEdits());if(!c&&r){const[{deleteForwardEdits:u},{default:h}]=await Promise.all([re(()=>import("./deleteForwardEdits-YqZ3cZTw.js"),__vite__mapDeps([])),re(()=>import("./DeleteForwardEditsParameters-BI8SdT3B.js"),__vite__mapDeps([]))]);return u(i,a,new h({sessionId:Mzt,moment:l.moment}))}return c}}return!0}function Rzt(t,e){var n;if(!t)return!1;const r=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),i=(n=XVe.get(r))==null?void 0:n.entries();if(i){for(const[s,o]of i)if(o.name===e)return o.lockType==="edit"}return!1}const cue=new Xn.EventEmitter;function $zt(t){return cue.on("apply-edits",new WeakRef(t))}function Izt(t){return cue.on("update-moment",new WeakRef(t))}function opr(t,e,r=null,i=!1){const n=ma();return i=e==null||i,cue.emit("apply-edits",{serviceUrl:t,layerId:e,gdbVersion:r,mayReceiveServiceEdits:i,result:n.promise}),n}const ZVe="esri.layers.mixins.EditBusLayer",JVe=Symbol(ZVe);function apr(t){return t!=null&&typeof t=="object"&&JVe in t}function kM(t){return t!=null&&typeof t=="object"&&"gdbVersion"in t}function LY(t,e,r){const i=new URL(t).host,n=YVe.get(i),s=o=>!o||o===n;return s(e)&&s(r)||e===r}const Lzt=t=>{var e;let r=class extends t{constructor(...i){super(...i),this[e]=!0,this._applyEditsHandler=n=>{const{serviceUrl:s,layerId:o,gdbVersion:a,mayReceiveServiceEdits:l,result:c}=n,u=s===this.url,h=o!=null&&this.layerId!=null&&o===this.layerId,p=kM(this),f=kM(this)&&LY(s,a,this.gdbVersion);if(!u||p&&!f||!h&&!l)return;const g=c.then(y=>{var b;if(h&&(y.addedFeatures.length||y.updatedFeatures.length||y.deletedFeatures.length||y.addedAttachments.length||y.updatedAttachments.length||y.deletedAttachments.length))return this.emit("edits",ae(y)),y;const v=(b=y.editedFeatures)==null?void 0:b.find(({layerId:w})=>w===this.layerId);if(v){const{adds:w,updates:x,deletes:S}=v.editedFeatures,E={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:w?w.map(({attributes:P})=>({objectId:this.objectIdField&&P[this.objectIdField],globalId:this.globalIdField&&P[this.globalIdField]})):[],deletedFeatures:S?S.map(({attributes:P})=>({objectId:this.objectIdField&&P[this.objectIdField],globalId:this.globalIdField&&P[this.globalIdField]})):[],updatedFeatures:x?x.map(({current:{attributes:P}})=>({objectId:this.objectIdField&&P[this.objectIdField],globalId:this.globalIdField&&P[this.globalIdField]})):[],editedFeatures:ae(y.editedFeatures),exceededTransferLimit:!1,historicMoment:ae(y.historicMoment)};return this.emit("edits",E),E}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:ae(y.editedFeatures),exceededTransferLimit:!1,historicMoment:ae(y.historicMoment)}}).then(y=>("historicMoment"in this&&this.historicMoment!==y.historicMoment&&Rzt(s,a)&&(this.historicMoment=y.historicMoment),y));this.emit("apply-edits",{result:g})},this._updateMomentHandler=n=>{const{serviceUrl:s,gdbVersion:o,moment:a}=n,l=s===this.url,c=kM(this),u=kM(this)&&LY(s,o,this.gdbVersion),h=kM(this)&&!LY(s,this.gdbVersion,null);l&&c&&u&&h&&"historicMoment"in this&&this.historicMoment!==a&&(this.historicMoment=a)},this.when().then(()=>{this.addHandles($zt(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(Izt(this._updateMomentHandler))},()=>{})}};return e=JVe,r=d([F(ZVe)],r),r},oSe={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},aSe={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},lSe={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},Dzt={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0,IntegratedMesh3DTilesLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":oSe,"web-map/basemap":aSe,"web-map/tables":lSe,"link-chart/operational-layers":{...oSe,LinkChartLayer:!0},"link-chart/basemap":aSe,"link-chart/tables":lSe,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISImageServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,IntegratedMesh3DTilesLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0}};function Nzt(t){if(!t)return t;const{start:e,end:r}=t;return new hw({start:e!=null?gT(e,-e.getTimezoneOffset(),"minutes"):e,end:r!=null?gT(r,-r.getTimezoneOffset(),"minutes"):r})}function Fzt(t){if(!t)return t;const{start:e,end:r}=t;return new hw({start:e!=null?gT(e,e.getTimezoneOffset(),"minutes"):e,end:r!=null?gT(r,r.getTimezoneOffset(),"minutes"):r})}const kzt={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:gp}}},QVe={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,r){e[r]=!t}}}},Uzt={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:gp}}},KVe={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:xb}}},zzt={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:gp}}},Vzt={value:null,type:SVe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:gp}}};function lpr(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const eBe={write:{enabled:!0,layerContainerTypes:gp},read:!0},Fre={type:Number,json:{origins:{"web-document":eBe,"portal-item":{write:!0}}}},cpr={...Fre,json:{...Fre.json,origins:{"web-document":{...eBe,write:{enabled:!0,layerContainerTypes:gp,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,r)=>{var i;return r&&r.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?(i=e.layerDefinition)!=null&&i.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?NP(e.layerDefinition.drawingInfo.transparency):void 0:NP(e.drawingInfo.transparency)}}}},upr={type:hw,readOnly:!0,get(){var l,c,u;const t=((l=this.layer)==null?void 0:l.timeInfo)!=null?this.layer:((c=this.i3slayer)==null?void 0:c.timeInfo)!=null?this.i3slayer:null;if(t==null)return null;const{datesInUnknownTimezone:e,timeOffset:r,useViewTime:i}=t,n=(u=this.view)==null?void 0:u.timeExtent;let s=t.timeExtent;e&&(s=Fzt(s));let o=i?n&&s?n.intersection(s):n||s:s;if(!o||o.isEmpty||o.isAllTime)return o;r&&(o=o.offset(-r.value,r.unit)),e&&(o=Nzt(o));const a=this._get("timeExtent");return o.equals(a)?a:o}},hpr={type:br,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const r=br.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(r.spatialReference=Ve.fromJSON(e.spatialReference)),r}}}},read:!1}},tBe={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},dpr={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:gp}}},name:"layerDefinition.minScale",write:!0}},ppr={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:gp}}},name:"layerDefinition.maxScale",write:!0}},Bzt={json:{write:{ignoreOrigin:!0,layerContainerTypes:gp},origins:{"web-map":{read:!1,write:!1}}}},rBe=t=>{let e=class extends t{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(r,i,n){var s;return((s=n==null?void 0:n.portalItem)==null?void 0:s.type)==="Group Layer"?void 0:r}writeListMode(r,i,n,s){(s&&s.layerContainerType==="ground"||r&&bWe(this,n,{},s))&&(i[n]=r)}writeOperationalLayerType(r,i,n,s){r&&(s==null?void 0:s.layerContainerType)!=="tables"&&(i.layerType=r)}writeTitle(r,i){i.title=r??"Layer"}read(r,i){i&&(i.layer=this),yWe(this,r,n=>super.read(r,n),i)}write(r,i){var o,a;if(!this.persistenceEnabled)return null;if(i!=null&&i.origin){const l=`${i.origin}/${i.layerContainerType||"operational-layers"}`,c=Dzt[l];let u=!!(c!=null&&c[this.operationalLayerType]);if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(u=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(u=!1),!u)return(o=i.messages)==null||o.push(new B("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const n=super.write(r,{...i,layer:this}),s=!!i&&!!i.messages&&!!i.messages.filter(l=>l instanceof B&&l.name==="web-document-write:property-required").length;return vb(n==null?void 0:n.url)?((a=i==null?void 0:i.messages)==null||a.push(new B("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&s?null:n}beforeSave(){}};return d([m({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),d([Xe("id",["id"])],e.prototype,"readId",null),d([m(Bzt)],e.prototype,"listMode",void 0),d([nt("listMode")],e.prototype,"writeListMode",null),d([m({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:gp}}}}})],e.prototype,"operationalLayerType",void 0),d([nt("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),d([m(Fre)],e.prototype,"opacity",void 0),d([m({type:Boolean,readOnly:!1})],e.prototype,"persistenceEnabled",void 0),d([m({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),d([nt("title"),nt(["web-scene"],"title")],e.prototype,"writeTitle",null),d([m({type:Boolean,json:{origins:{"web-scene":{name:"visibility",write:{enabled:!0,layerContainerTypes:gp}}},name:"visibility",write:!0}})],e.prototype,"visible",void 0),e=d([F("esri.layers.mixins.OperationalLayer")],e),e};async function Gzt(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return QC(t);const r=Ve.WGS84;return await mN(e,r),lw(t,r)}function jzt(t,e){if(!iBe(t,e)){const r=t.typeKeywords;r?r.push(e):t.typeKeywords=[e]}}function iBe(t,e){var r;return!!((r=t.typeKeywords)!=null&&r.includes(e))}function cSe(t){return iBe(t,qzt.HOSTED_SERVICE)}function Hzt(t,e){const r=t.typeKeywords;if(r){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}function fpr(t,e,r){r?jzt(t,e):Hzt(t,e)}async function mpr(t){const e=t.clone().normalize();let r;if(e.length>1)for(const i of e)r?i.width>r.width&&(r=i):r=i;else r=e[0];return Gzt(r)}const qzt={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function uSe(t){var l;const{portal:e,isOrgItem:r,itemControl:i}=t,n=(l=e.user)==null?void 0:l.privileges;let s=!n||n.includes("features:user:edit"),o=!!r&&!!(n!=null&&n.includes("features:user:fullEdit"));const a=i==="update"||i==="admin";return a?o=s=!0:o&&(s=!0),{features:{edit:s,fullEdit:o},content:{updateItem:a}}}const nBe=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Me(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,i,n){if(i.itemId)return new nb({id:i.itemId,portal:n==null?void 0:n.portal})}writePortalItem(r,i){r!=null&&r.id&&(i.itemId=r.id)}async loadFromPortal(r,i){var n;if((n=this.portalItem)!=null&&n.id)try{const{load:s}=await re(()=>import("./layersLoader-Bu9k60dp.js"),__vite__mapDeps([180,6,4,3,2]));return dt(i),await s({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData,layerModuleTypeMap:r.layerModuleTypeMap},i)}catch(s){throw on(s)||K.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(i=>(ko(i),!0)))}async setUserPrivileges(r,i){if(!ai.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(i);if(this.url)try{const{features:{edit:n,fullEdit:s},content:{updateItem:o}}=await this._fetchUserPrivileges(r,i);this._set("userHasEditingPrivileges",n),this._set("userHasFullEditingPrivileges",s),this._set("userHasUpdateItemPrivileges",o)}catch(n){ko(n)}}async _fetchUserPrivileges(r,i){let n=this.portalItem;if(!r||!n||!n.loaded||n.sourceUrl)return this._fetchFallbackUserPrivileges(i);const s=r===n.id;if(s&&n.portal.user)return uSe(n);let o,a;if(s)o=n.portal.url;else try{o=await D3e(this.url,i)}catch(h){ko(h)}if(!o||!kWe(o,n.portal.url))return this._fetchFallbackUserPrivileges(i);try{const h=i!=null?i.signal:null;a=await(vr==null?void 0:vr.getCredential(`${o}/sharing`,{prompt:!1,signal:h}))}catch(h){ko(h)}const l=!0,c=!1,u=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:u}};try{if(s?await n.reload():(n=new nb({id:r,portal:{url:o}}),await n.load(i)),n.portal.user)return uSe(n)}catch(h){ko(h)}return{features:{edit:l,fullEdit:c},content:{updateItem:u}}}async _fetchFallbackUserPrivileges(r){let i=!0;try{i=await this._fetchUserHasEditingPrivileges(r)}catch(n){ko(n)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(r){const i=this.url?vr==null?void 0:vr.findCredential(this.url):null;if(!i)return!0;const n=Mk.credential===i?Mk.user:await this._fetchEditingUser(r);return Mk.credential=i,Mk.user=n,(n==null?void 0:n.privileges)==null||n.privileges.includes("features:user:edit")}async _fetchEditingUser(r){var u,h;const i=(h=(u=this.portalItem)==null?void 0:u.portal)==null?void 0:h.user;if(i)return i;const n=vr.findServerInfo(this.url??"");if(!(n!=null&&n.owningSystemUrl))return null;const s=`${n.owningSystemUrl}/sharing/rest`,o=Ho.getDefault();if(o&&o.loaded&&Xf(o.restUrl)===Xf(s))return o.user;const a=`${s}/community/self`,l=r!=null?r.signal:null,c=await op(Vt(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?Bne.fromJSON(c.value.data):null}read(r,i){i&&(i.layer=this),super.read(r,i)}write(r,i){var o;const n=i==null?void 0:i.portal,s=((o=this.portalItem)==null?void 0:o.id)&&(this.portalItem.portal||Ho.getDefault());return n&&s&&!VCe(s.restUrl,n.restUrl)?(i.messages&&i.messages.push(new B("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...i,layer:this})}};return d([m({type:nb})],e.prototype,"portalItem",null),d([Xe("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),d([nt("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),d([m({clonable:!1})],e.prototype,"resourceReferences",void 0),d([m({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),d([m({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),d([m({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=d([F("esri.layers.mixins.PortalLayer")],e),e},Mk={credential:null,user:null};function sBe(t){return t&&"getAtOrigin"in t&&"originOf"in t}function hSe(t){t!=null&&t.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:r,newOrigin:i})=>{sBe(e)&&i&&e.originOf(r)!==i&&e.updateOrigin(r,i)})}async function Wzt(t,e,r,i,n,s,o){let a=null;if(r!=null){const h=`${t}/nodepages/`,p=h+Math.floor(r.rootIndex/r.nodesPerPage);try{return{type:"page",rootPage:(await Vt(p,{query:{f:"json",...i,token:n},responseType:"json",signal:o})).data,rootIndex:r.rootIndex,pageSize:r.nodesPerPage,lodMetric:r.lodSelectionMetricType,urlPrefix:h}}catch(f){s!=null&&s.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",p,f),a=f}}if(!e)return null;const l=e==null?void 0:e.split("/").pop(),c=`${t}/nodes/`,u=c+l;try{return{type:"node",rootNode:(await Vt(u,{query:{f:"json",...i,token:n},responseType:"json",signal:o})).data,urlPrefix:c}}catch(h){throw new B("sceneservice:root-node-missing","Root node missing.",{pageError:a,nodeError:h,url:u})}}let Yzt=null;function Xzt(){return Yzt}function gpr(t,e){return{...oBe(t,e),readResourcePaths:[]}}function dSe(t,e,r){const i=xs(t.itemUrl);return{...oBe(t,e),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:i?{rootPath:i.path,writtenUrls:[]}:null,resources:r?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function oBe(t,e){return{origin:e,url:xs(t.itemUrl),portal:t.portal||Ho.getDefault(),portalItem:t}}async function Zzt(t,e={},r){await t.load(r);const i=Nc(t.itemUrl,"resources"),{start:n=1,num:s=10,sortOrder:o="asc",sortField:a="resource"}=e,l={query:{start:n,num:s,sortOrder:o,sortField:a,token:t.apiKey},signal:r==null?void 0:r.signal},c=await t.portal.request(i,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:u,size:h,resource:p})=>({created:new Date(u),size:h,resource:t.resourceFromPath(p)}))}}async function Jzt(t,e,r,i){const n=new Map;for(const{resource:o,content:a,compress:l,access:c}of e){if(!o.hasPath())throw new B(`portal-item-resource-${r}:invalid-path`,"Resource does not have a valid path");const[u,h]=aBe(o.path),p=`${u}/${l??""}/${c??""}`;n.has(p)||n.set(p,{prefix:u,compress:l,access:c,files:[]}),n.get(p).files.push({fileName:h,content:a})}await t.load(i);const s=Nc(t.userItemUrl,r==="add"?"addResources":"updateResources");for(const{prefix:o,compress:a,access:l,files:c}of n.values())for(let h=0;h<c.length;h+=25){const p=c.slice(h,h+25),f=new FormData;o&&o!=="."&&f.append("resourcesPrefix",o),a&&f.append("compress","true"),l&&f.append("access",l);let g=0;for(const{fileName:y,content:v}of p)f.append("file"+ ++g,v,y);f.append("f","json"),await t.portal.request(s,{method:"post",body:f,signal:i==null?void 0:i.signal})}}async function Qzt(t,e,r){if(!e.hasPath())throw new B("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(r);const i=Nc(t.userItemUrl,"removeResources");await t.portal.request(i,{method:"post",query:{resource:e.path},signal:r==null?void 0:r.signal}),e.portalItem=null}async function Kzt(t,e){await t.load(e);const r=Nc(t.userItemUrl,"removeResources");return t.portal.request(r,{method:"post",query:{deleteAll:!0},signal:e==null?void 0:e.signal})}function aBe(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function uue(t){const[e,r]=e9t(t),[i,n]=aBe(e);return[i,n,r]}function e9t(t){const e=One(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function oU(t){return t.type==="blob"?t.blob:t.type==="json"?new Blob([t.jsonString],{type:"application/json"}):(await Vt(t.url,{responseType:"blob"})).data}function t9t(t,e){if(!t.hasPath())return null;const[r,,i]=uue(t.path);return t.portalItem.resourceFromPath(Nc(r,e+i))}function lBe(t,e){if(!t.hasPath())return null;const[r,,i]=uue(t.path);return t.portalItem.resourceFromPath(Nc(r,e+i))}const P3=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResources:Jzt,contentToBlob:oU,fetchResources:Zzt,getSiblingOfSameType:t9t,getSiblingOfSameTypeI:lBe,removeAllResources:Kzt,removeResource:Qzt,splitPrefixFileNameAndExtension:uue},Symbol.toStringTag,{value:"Module"}));async function r9t(t,e,r){const i=await cBe(t,e,r);await uBe(i,e,r)}async function i9t(t,e,r,i,n){const s=await cBe(r,i,n);await t.update({data:e}),await uBe(s,i,n)}async function cBe(t,e,r){if(!(e!=null&&e.resources))return;const i=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const n=new Set(e.resources.toKeep.map(h=>h.resource.path)),s=new Set,o=[];n.forEach(h=>{i.delete(h),t.paths.push(h)});const a=[],l=[],c=[];for(const h of e.resources.toUpdate)if(i.delete(h.resource.path),n.has(h.resource.path)||s.has(h.resource.path)){const{resource:p,content:f,finish:g}=h,y=lBe(p,QN());t.paths.push(y.path),a.push({resource:y,content:await oU(f),compress:h.compress}),g&&c.push(()=>g(y))}else{t.paths.push(h.resource.path),l.push({resource:h.resource,content:await oU(h.content),compress:h.compress});const p=h.finish;p&&c.push(()=>p(h.resource)),s.add(h.resource.path)}for(const h of e.resources.toAdd)if(t.paths.push(h.resource.path),i.has(h.resource.path))i.delete(h.resource.path);else{a.push({resource:h.resource,content:await oU(h.content),compress:h.compress});const p=h.finish;p&&c.push(()=>p(h.resource))}if(a.length||l.length){const{addOrUpdateResources:h}=await re(()=>Promise.resolve().then(()=>P3),void 0);await h(e.portalItem,a,"add",r),await h(e.portalItem,l,"update",r)}if(c.forEach(h=>h()),o.length===0)return i;const u=await oqe(o);if(dt(r),u.length>0)throw new B("save:resources","Failed to save one or more resources",{errors:u});return i}async function uBe(t,e,r){if(!t||!e.portalItem)return;const i=[];for(const n of t){const s=e.portalItem.resourceFromPath(n);i.push(s.portalItem.removeResource(s,r))}await nB(i)}function pSe(t){if(ai.apiKey&&Rne(t.portal.url))throw new B("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${t.portal.url} when using an api key`)}async function ypr(t){const e=[];for(const r of t.allLayers)if("beforeSave"in r&&typeof r.beforeSave=="function"){const i=r.beforeSave();i&&e.push(i)}await Promise.allSettled(e)}const n9t=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function s9t(t,e,r){let i=(t.messages??[]).filter(({type:n})=>n==="error").map(({name:n,message:s,details:o})=>new B(n,s,o));if(t.blockedRelativeUrls&&(i=i.concat(t.blockedRelativeUrls.map(n=>new B("url:unsupported",`Relative url '${n}' is not supported`)))),r){const{ignoreUnsupported:n,supplementalUnsupportedErrors:s=[],requiredPropertyChecksDisabled:o}=r;n&&(i=i.filter(({name:a})=>!(n9t.has(a)||s.includes(a)))),o&&(i=i.filter(a=>a.name!=="web-document-write:property-required"))}if(i.length>0)throw new B(e.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:i})}const o9t=t=>{let e=class extends t{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=fne(async(r,i,n)=>{switch(r){case CA.SAVE:return this._save(i);case CA.SAVE_AS:return this._saveAs(n,i)}})}readSpatialReference(r,i){return this._readSpatialReference(i)}_readSpatialReference(r){if(r.spatialReference!=null)return Ve.fromJSON(r.spatialReference);const i=r.store,n=i.indexCRS||i.geographicCRS,s=n&&parseInt(n.substring(n.lastIndexOf("/")+1,n.length),10);return s!=null?new Ve(s):null}readFullExtent(r,i,n){if(r!=null&&typeof r=="object"){const a=r.spatialReference==null?{...r,spatialReference:this._readSpatialReference(i)}:r;return br.fromJSON(a,n)}const s=i.store,o=this._readSpatialReference(i);return o==null||(s==null?void 0:s.extent)==null||!Array.isArray(s.extent)||s.extent.some(a=>a<DY)?null:new br({xmin:s.extent[0],ymin:s.extent[1],xmax:s.extent[2],ymax:s.extent[3],spatialReference:o})}parseVersionString(r){const i={major:Number.NaN,minor:Number.NaN,versionString:r},n=r.split(".");return n.length>=2&&(i.major=parseInt(n[0],10),i.minor=parseInt(n[1],10)),i}readVersion(r,i){const n=i.store,s=n.version!=null?n.version.toString():"";return this.parseVersionString(s)}readTitlePortalItem(r){return this.sublayerTitleMode!=="item-title"?void 0:r}readTitleService(r,i){var o;const n=(o=this.portalItem)==null?void 0:o.title;if(this.sublayerTitleMode==="item-title")return ndt(this.url,i.name);let s=i.name;if(!s&&this.url){const a=fm(this.url);a!=null&&(s=a.title)}return this.sublayerTitleMode==="item-title-and-service-name"&&n&&(s=n+" - "+s),eae(s)}set url(r){const i=odt({layer:this,url:r,nonStandardUrlAllowed:!1,logger:K.getLogger(this)});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,n,s){adt(this,r,"layers",i,s)}get parsedUrl(){const r=this._get("url"),i=xs(r);return this.layerId!=null&&(i.path=`${i.path}/layers/${this.layerId}`),i}async _fetchIndexAndUpdateExtent(r,i){this.indexInfo=Wzt(this.parsedUrl.path,this.rootNode,r,this.customParameters,this.apiKey,K.getLogger(this),i),this.fullExtent==null||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(r){var i,n,s,o;if((r==null?void 0:r.type)==="page"){const a=r.rootIndex%r.pageSize,l=(n=(i=r.rootPage)==null?void 0:i.nodes)==null?void 0:n[a];if(((s=l==null?void 0:l.obb)==null?void 0:s.center)==null||l.obb.halfSize==null)throw new B("sceneservice:invalid-node-page","Invalid node page.");if(l.obb.center[0]<DY||this.fullExtent==null||this.fullExtent.hasZ)return;const c=l.obb.halfSize,u=l.obb.center[2],h=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);this.fullExtent.zmin=u-h,this.fullExtent.zmax=u+h}else if((r==null?void 0:r.type)==="node"){const a=(o=r.rootNode)==null?void 0:o.mbs;if(!Array.isArray(a)||a.length!==4||a[0]<DY)return;const l=a[2],c=a[3],{fullExtent:u}=this;u&&(u.zmin=l-c,u.zmax=l+c)}}async _fetchService(r){if(this.url==null)throw new B("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(this.layerId==null&&/SceneServer\/*$/i.test(this.url)){const i=await this._fetchFirstLayerId(r);i!=null&&(this.layerId=i)}return this._fetchServiceLayer(r)}async _fetchFirstLayerId(r){const i=await Vt(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:r});if(i.data&&Array.isArray(i.data.layers)&&i.data.layers.length>0)return i.data.layers[0].id}async _fetchServiceLayer(r){var o;const i=await Vt(((o=this.parsedUrl)==null?void 0:o.path)??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:r});i.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let n=!1;if(i.data.layerType&&i.data.layerType==="Voxel"&&(n=!0),n)return this._fetchVoxelServiceLayer();const s=i.data;this.read(s,this._getServiceContext()),this.validateLayer(s)}async _fetchVoxelServiceLayer(r){var n;const i=(await Vt(((n=this.parsedUrl)==null?void 0:n.path)+"/layer",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:r})).data;this.read(i,this._getServiceContext()),this.validateLayer(i)}_getServiceContext(){var r;return{origin:"service",portalItem:this.portalItem,portal:(r=this.portalItem)==null?void 0:r.portal,url:this.parsedUrl}}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&typeof this.beforeSave=="function"&&await this.beforeSave()}validateLayer(r){}_updateTypeKeywords(r,i,n){r.typeKeywords||(r.typeKeywords=[]);const s=i.getTypeKeywords();for(const o of s)r.typeKeywords.push(o);r.typeKeywords&&(r.typeKeywords=r.typeKeywords.filter((o,a,l)=>l.indexOf(o)===a),n===uL.newItem&&(r.typeKeywords=r.typeKeywords.filter(o=>o!=="Hosted Service")))}async _saveAs(r,i){var c;const n={...fSe,...i};let s=nb.from(r);if(!s)throw new B("sceneservice:portal-item-required","_saveAs() requires a portal item to save to");pSe(s),s.id&&(s=s.clone(),s.id=null);const o=s.portal||Ho.getDefault();await this._ensureLoadBeforeSave(),s.type=NY,s.portal=o;const a=dSe(s,"portal-item",!0),l={layers:[this.write({},a)]};return await Promise.all(a.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(l,a,n),s.url=this.url,s.title||(s.title=this.title),this._updateTypeKeywords(s,n,uL.newItem),await o.signIn(),await((c=o.user)==null?void 0:c.addItem({item:s,folder:n==null?void 0:n.folder,data:l})),await r9t(this.resourceReferences,a),this.portalItem=s,hSe(a),a.portalItem=s,s}async _save(r){const i={...fSe,...r};if(!this.portalItem)throw new B("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if(pSe(this.portalItem),this.portalItem.type!==NY)throw new B("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${NY}"`);await this._ensureLoadBeforeSave();const n=dSe(this.portalItem,"portal-item",!0),s={layers:[this.write({},n)]};return await Promise.all(n.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(s,n,i),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,i,uL.existingItem),await i9t(this.portalItem,s,this.resourceReferences,n),hSe(n),this.portalItem}async _validateAgainstJSONSchema(r,i,n){const s=n==null?void 0:n.validationOptions;s9t(i,{errorName:"sceneservice:save"},{ignoreUnsupported:s==null?void 0:s.ignoreUnsupported,supplementalUnsupportedErrors:["scenemodification:unsupported"]});const o=s==null?void 0:s.enabled,a=Xzt();if(o&&a){const l=(await a()).validate(r,n.portalItemLayerType);if(!l.length)return;const c=`Layer item did not validate:
${l.join(`
`)}`;if(K.getLogger(this).error(`_validateAgainstJSONSchema(): ${c}`),s.failPolicy==="throw"){const u=l.map(h=>new B("sceneservice:schema-validation",h));throw new B("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{validationErrors:u})}}}};return d([m(tBe)],e.prototype,"id",void 0),d([m({type:Ve})],e.prototype,"spatialReference",void 0),d([Xe("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readSpatialReference",null),d([m({type:br})],e.prototype,"fullExtent",void 0),d([Xe("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readFullExtent",null),d([m({readOnly:!0,type:JA})],e.prototype,"heightModelInfo",void 0),d([m({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],e.prototype,"minScale",void 0),d([m({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],e.prototype,"maxScale",void 0),d([m({readOnly:!0})],e.prototype,"version",void 0),d([Xe("version",["store.version"])],e.prototype,"readVersion",null),d([m({type:String,json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0),d([m({type:String,json:{read:!1}})],e.prototype,"sublayerTitleMode",void 0),d([m({type:String})],e.prototype,"title",void 0),d([Xe("portal-item","title")],e.prototype,"readTitlePortalItem",null),d([Xe("service","title",["name"])],e.prototype,"readTitleService",null),d([m({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],e.prototype,"layerId",void 0),d([m(KVe)],e.prototype,"url",null),d([nt("url")],e.prototype,"writeUrl",null),d([m()],e.prototype,"parsedUrl",null),d([m({readOnly:!0})],e.prototype,"store",void 0),d([m({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],e.prototype,"rootNode",void 0),e=d([F("esri.layers.mixins.SceneService")],e),e},DY=-1e38;var uL;(function(t){t[t.existingItem=0]="existingItem",t[t.newItem=1]="newItem"})(uL||(uL={}));const NY="Scene Service",fSe={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var CA;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(CA||(CA={}));const a9t=tc()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let W$=class extends ds(Se){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return xct(this.value,this.unit,"milliseconds")}};d([gt(a9t,{nonNullable:!0})],W$.prototype,"unit",void 0),d([m({type:Number,json:{write:!0},nonNullable:!0})],W$.prototype,"value",void 0),W$=d([F("esri.TimeInterval")],W$);const hue=W$;function mSe(t,e){return hue.fromJSON({value:t,unit:e})}let Fl=class extends ds(Se){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,r){if(!r.timeExtent||!Array.isArray(r.timeExtent)||r.timeExtent.length!==2)return null;const i=new Date(r.timeExtent[0]),n=new Date(r.timeExtent[1]);return new hw({start:i,end:n})}writeFullTimeExtent(e,r){(e==null?void 0:e.start)!=null&&e.end!=null?r.timeExtent=[e.start.getTime(),e.end.getTime()]:r.timeExtent=null}readInterval(e,r){return r.timeInterval&&r.timeIntervalUnits?mSe(r.timeInterval,r.timeIntervalUnits):r.defaultTimeInterval&&r.defaultTimeIntervalUnits?mSe(r.defaultTimeInterval,r.defaultTimeIntervalUnits):null}writeInterval(e,r){r.timeInterval=(e==null?void 0:e.toJSON().value)??null,r.timeIntervalUnits=(e==null?void 0:e.toJSON().unit)??null}};d([m({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],Fl.prototype,"cumulative",void 0),d([m({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],Fl.prototype,"endField",void 0),d([m({type:hw,json:{write:{enabled:!0,allowNull:!0}}})],Fl.prototype,"fullTimeExtent",void 0),d([Xe("fullTimeExtent",["timeExtent"])],Fl.prototype,"readFullTimeExtent",null),d([nt("fullTimeExtent")],Fl.prototype,"writeFullTimeExtent",null),d([m({type:Boolean,json:{write:!0}})],Fl.prototype,"hasLiveData",void 0),d([m({type:hue,json:{write:{enabled:!0,allowNull:!0}}})],Fl.prototype,"interval",void 0),d([Xe("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Fl.prototype,"readInterval",null),d([nt("interval")],Fl.prototype,"writeInterval",null),d([m({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],Fl.prototype,"startField",void 0),d([m(jnt("timeReference",!0))],Fl.prototype,"timeZone",void 0),d([m({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Fl.prototype,"trackIdField",void 0),d([m({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],Fl.prototype,"useTime",void 0),Fl=d([F("esri.layers.support.TimeInfo")],Fl);const l9t=Fl,c9t=t=>{let e=class extends t{get timeInfo(){var n;const r=(n=this.associatedLayer)==null?void 0:n.timeInfo;if(r==null)return r;const i=r.clone();return Fme(i,this.fieldsIndex),i}set timeInfo(r){Fme(r,this.fieldsIndex),this._override("timeInfo",r)}get timeExtent(){var r;return(r=this.associatedLayer)==null?void 0:r.timeExtent}set timeExtent(r){this._override("timeExtent",r)}get timeOffset(){var r;return(r=this.associatedLayer)==null?void 0:r.timeOffset}set timeOffset(r){this._override("timeOffset",r)}get useViewTime(){var r;return((r=this.associatedLayer)==null?void 0:r.useViewTime)??!0}set useViewTime(r){this._override("useViewTime",r)}get datesInUnknownTimezone(){var r;return((r=this.associatedLayer)==null?void 0:r.datesInUnknownTimezone)??!1}set datesInUnknownTimezone(r){this._override("datesInUnknownTimezone",r)}};return d([m({type:l9t})],e.prototype,"timeInfo",null),d([m({type:hw})],e.prototype,"timeExtent",null),d([m({type:hue})],e.prototype,"timeOffset",null),d([m({type:Boolean,nonNullable:!0})],e.prototype,"useViewTime",null),d([m({type:Boolean,nonNullable:!0})],e.prototype,"datesInUnknownTimezone",null),e=d([F("esri.layers.mixins.TemporalSceneLayer")],e),e};async function u9t(t,e){const r=fm(t);if(!r)throw new B("invalid-url","Invalid scene service url");const i={...e,sceneServerUrl:r.url.path,layerId:r.sublayer??void 0};if(i.sceneLayerItem??(i.sceneLayerItem=await h9t(i)),i.sceneLayerItem==null)return gSe(i.sceneServerUrl.replace("/SceneServer","/FeatureServer"),i);const n=await p9t(i);if(!(n!=null&&n.url))throw new B("related-service-not-found","Could not find feature service through portal item relationship");i.featureServiceItem=n;const s=await gSe(n.url,i);return s.portalItem=n,s}async function h9t(t){const e=(await hBe(t)).serviceItemId;if(!e)return null;const r=new nb({id:e,apiKey:t.apiKey}),i=await d9t(t);i!=null&&(r.portal=new Ho({url:i}));try{return r.load({signal:t.signal})}catch(n){return ko(n),null}}async function hBe(t){if(t.rootDocument)return t.rootDocument;const e={query:{f:"json",...t.customParameters,token:t.apiKey},responseType:"json",signal:t.signal};try{const r=await Vt(t.sceneServerUrl,e);t.rootDocument=r.data}catch{t.rootDocument={}}return t.rootDocument}async function d9t(t){const e=vr==null?void 0:vr.findServerInfo(t.sceneServerUrl);if(e!=null&&e.owningSystemUrl)return e.owningSystemUrl;const r=t.sceneServerUrl.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const i=(await Vt(r,{query:{f:"json"},responseType:"json",signal:t.signal})).data.owningSystemUrl;if(i)return i}catch(i){ko(i)}return null}async function gSe(t,e){var g,y,v;const r=fm(t);if(!r)throw new B("invalid-feature-service-url","Invalid feature service url");const i=r.url.path,n=e.layerId;if(n==null)return{serverUrl:i};const s=hBe(e),o=e.featureServiceItem?await e.featureServiceItem.fetchData("json"):null,a=(v=((g=o==null?void 0:o.layers)==null?void 0:g[0])||((y=o==null?void 0:o.tables)==null?void 0:y[0]))==null?void 0:v.customParameters,l=b=>{const w={query:{f:"json",...a},responseType:"json",authMode:b,signal:e.signal};return Vt(i,w)},c=l("anonymous").catch(()=>l("no-prompt")),[u,h]=await Promise.all([c,s]),p=h==null?void 0:h.layers,f=u.data&&u.data.layers;if(!Array.isArray(f))throw new Error("expected layers array");if(Array.isArray(p)){for(let b=0;b<Math.min(p.length,f.length);b++)if(p[b].id===n)return{serverUrl:i,layerId:f[b].id}}else if(n!=null&&n<f.length)return{serverUrl:i,layerId:f[n].id};throw new Error("could not find matching associated sublayer")}async function p9t({sceneLayerItem:t,signal:e}){if(!t)return null;try{const r=(await t.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:e})).find(n=>n.type==="Feature Service")||null;if(!r)return null;const i=new nb({portal:r.portal,id:r.id});return await i.load(),i}catch(r){return ko(r),null}}const f9t={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1,zDefault:void 0},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};async function m9t(t,e,r){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=dBe(t));const i=g9t(t),n=t.capabilities.query.supportsPagination;e.start=0,e.num=i;let s=null;for(;;){const o=await t.source.queryFeaturesJSON(e,r);if(s==null?s=o:s.features=s.features.concat(o.features),s.exceededTransferLimit=o.exceededTransferLimit,!n||!o.exceededTransferLimit)break;e.start+=i}return s}function g9t(t){return dBe(t)*y9t(t)}function y9t(t){return t.capabilities.query.maxRecordCount||2e3}function dBe(t){return t.capabilities.query.supportsMaxRecordCountFactor?ec.MAX_MAX_RECORD_COUNT_FACTOR:1}var kre;let Ea=kre=class extends Se{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new kre(ae({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};d([m({type:[String],json:{write:!0}})],Ea.prototype,"attachmentTypes",void 0),d([m({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Ea.prototype,"attachmentsWhere",void 0),d([m({type:Boolean,json:{write:!0}})],Ea.prototype,"cacheHint",void 0),d([m({type:[String],json:{write:!0}})],Ea.prototype,"keywords",void 0),d([m({type:[Number],json:{write:!0}})],Ea.prototype,"globalIds",void 0),d([m({json:{write:!0}})],Ea.prototype,"name",void 0),d([m({type:Number,json:{read:{source:"resultRecordCount"}}})],Ea.prototype,"num",void 0),d([m({type:[Number],json:{write:!0}})],Ea.prototype,"objectIds",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],Ea.prototype,"returnMetadata",void 0),d([m({type:[Number],json:{write:!0}})],Ea.prototype,"size",void 0),d([m({type:Number,json:{read:{source:"resultOffset"}}})],Ea.prototype,"start",void 0),d([nt("start"),nt("num")],Ea.prototype,"writeStart",null),d([m({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ea.prototype,"where",void 0),Ea=kre=d([F("esri.rest.support.AttachmentQuery")],Ea),Ea.from=to(Ea);const pBe=Ea;var Ure;let ys=Ure=class extends Se{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new Ure(ae({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};d([m({type:Boolean,json:{write:!0}})],ys.prototype,"cacheHint",void 0),d([m({type:mu,json:{write:!0}})],ys.prototype,"dynamicDataSource",void 0),d([m({type:String,json:{write:!0}})],ys.prototype,"gdbVersion",void 0),d([m({type:Number,json:{write:!0}})],ys.prototype,"geometryPrecision",void 0),d([m({type:Date})],ys.prototype,"historicMoment",void 0),d([nt("historicMoment")],ys.prototype,"_writeHistoricMoment",null),d([m({type:Number,json:{write:!0}})],ys.prototype,"maxAllowableOffset",void 0),d([m({type:[Number],json:{write:!0}})],ys.prototype,"objectIds",void 0),d([m({type:[String],json:{write:!0}})],ys.prototype,"orderByFields",void 0),d([m({type:[String],json:{write:!0}})],ys.prototype,"outFields",void 0),d([m({type:Ve,json:{read:{source:"outSR"},write:{target:"outSR"}}})],ys.prototype,"outSpatialReference",void 0),d([m({json:{write:!0}})],ys.prototype,"relationshipId",void 0),d([m({type:Number,json:{read:{source:"resultOffset"}}})],ys.prototype,"start",void 0),d([nt("start"),nt("num")],ys.prototype,"writeStart",null),d([m({type:Number,json:{read:{source:"resultRecordCount"}}})],ys.prototype,"num",void 0),d([m({json:{write:!0}})],ys.prototype,"returnGeometry",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ys.prototype,"returnM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],ys.prototype,"returnZ",void 0),d([m({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],ys.prototype,"where",void 0),ys=Ure=d([F("esri.rest.support.RelationshipQuery")],ys),ys.from=to(ys);const due=ys,ySe=Object.freeze(Object.defineProperty({__proto__:null,default:due},Symbol.toStringTag,{value:"Module"})),bpr=new Ii({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function wpr(t,e,r,i){const n=await bw(t);if(await pue(t,e,i),!n.addAttachment)throw new B(i,"Layer source does not support addAttachment capability");return n.addAttachment(e,r)}function pue(t,e,r){var s,o;const{attributes:i}=e,{objectIdField:n}=t;return(o=(s=t.capabilities)==null?void 0:s.data)!=null&&o.supportsAttachment?e?i?n&&i[n]?Promise.resolve():Promise.reject(new B(r,`feature is missing the identifying attribute ${n}`)):Promise.reject(new B(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new B(r,"A feature is required to add/delete/update attachments")):Promise.reject(new B(r,"this layer doesn't support attachments"))}async function xpr(t,e,r,i,n){const s=await bw(t);if(await pue(t,e,n),!s.updateAttachment)throw new B(n,"Layer source does not support updateAttachment capability");return s.updateAttachment(e,r,i)}async function Spr(t,e,r){const{applyEdits:i}=await re(()=>import("./editingSupport-C0lgLa5s.js"),__vite__mapDeps([])),n=await t.load(),{source:s,globalIdField:o}=n;let a=r;return n.type==="feature"&&n.infoFor3D&&e.deleteFeatures!=null&&o!=null&&(a={...a,globalIdToObjectId:await fBe(t,e.deleteFeatures,o)}),i(n,s,e,r)}async function Tpr(t,e,r){const{uploadAssets:i}=await re(()=>import("./editingSupport-C0lgLa5s.js"),__vite__mapDeps([])),n=await t.load();return i(n,n.source,e,r)}async function Epr(t,e,r,i){const n=await bw(t);if(await pue(t,e,i),!n.deleteAttachments)throw new B(i,"Layer source does not support deleteAttachments capability");return n.deleteAttachments(e,r)}async function Cpr(t,e,r){const i=(await t.load({signal:e==null?void 0:e.signal})).source;if(!i.fetchRecomputedExtents)throw new B(r,"Layer source does not support fetchUpdates capability");return i.fetchRecomputedExtents(e)}async function Ppr(t,e,r,i){var f,g;e=pBe.from(e),await t.load();const n=t.source,s=t.capabilities;if(!((f=s==null?void 0:s.data)!=null&&f.supportsAttachment))throw new B(i,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:u,start:h,where:p}=e;if(!((g=s==null?void 0:s.operations)!=null&&g.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(u==null?void 0:u.length)>0||c||h||p))throw new B(i,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a!=null&&a.length||l!=null&&l.length||p))throw new B(i,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!n.queryAttachments)throw new B(i,"Layer source does not support queryAttachments capability",e);return n.queryAttachments(e)}async function Apr(t,e,r,i){const n=await bw(t);if(!n.queryObjectIds)throw new B(i,"Layer source does not support queryObjectIds capability");return n.queryObjectIds(ec.from(e)??t.createQuery(),r)}async function Opr(t,e,r,i){const n=await bw(t);if(!n.queryFeatureCount)throw new B(i,"Layer source does not support queryFeatureCount capability");return n.queryFeatureCount(ec.from(e)??t.createQuery(),r)}async function Mpr(t,e,r,i){const n=await bw(t);if(!n.queryExtent)throw new B(i,"Layer source does not support queryExtent capability");return n.queryExtent(ec.from(e)??t.createQuery(),r)}async function Rpr(t,e,r,i){const n=await bw(t);if(!n.queryRelatedFeatures)throw new B(i,"Layer source does not support queryRelatedFeatures capability");return n.queryRelatedFeatures(due.from(e),r)}async function $pr(t,e,r,i){const n=await bw(t);if(!n.queryRelatedFeaturesCount)throw new B(i,"Layer source does not support queryRelatedFeaturesCount capability");return n.queryRelatedFeaturesCount(due.from(e),r)}async function Ipr(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:r,updates:i}=await e.refresh();if(i!=null&&(t.sourceJSON={...t.sourceJSON,...i},t.read(i,{origin:"service",url:t.parsedUrl})),r)return!0}catch{}if(t.definitionExpression)try{return(await Foe(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function Lpr(t){var o,a;const e=new ec,r=(o=t.capabilities)==null?void 0:o.data,i=(a=t.capabilities)==null?void 0:a.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),r&&(r.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),r.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:n,timeExtent:s}=t;return e.timeExtent=n!=null&&s!=null?s.offset(-n.value,n.unit):s||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function Dpr(t){const{globalIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeGlobalID")return i.name}}function Npr(t){const{objectIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeOID")return i.name}}function Fpr(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}async function bw(t){return(await t.load()).source}async function _9t(t,e){if(!vr||vr.findCredential(t))return;let r;try{const i=await D3e(t,e);i&&(r=await vr.checkSignInStatus(`${i}/sharing`))}catch{}if(r)try{const i=e!=null?e.signal:null;await vr.getCredential(t,{signal:i})}catch{}}async function kpr(t,e,r){var n;const i=(n=t.parsedUrl)==null?void 0:n.path;i&&t.authenticationTriggerEvent===e&&await _9t(i,r)}function v9t(t){var e;return!((e=t.sourceJSON)!=null&&e.isMultiServicesView)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const FY=FA({types:sLe});function Upr(t,e){var r;if(t.defaultSymbol)return(r=t.types)!=null&&r.length?new lue({defaultSymbol:FY(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(i=>({id:i.id,symbol:FY(i.symbol,i,e)}))}):new aue({symbol:FY(t.defaultSymbol,t,e)})}function zpr(t){var i,n,s;let e=(i=t.sourceJSON)==null?void 0:i.cacheMaxAge;if(!e)return!1;const r=(s=(n=t.editingInfo)==null?void 0:n.lastEditDate)==null?void 0:s.getTime();return r==null||(e*=1e3,Date.now()-r<e)}async function fBe(t,e,r){if(e==null)return null;const i=[],{objectIdField:n}=t;if(e.forEach(c=>{let u=null;if("attributes"in c){const{attributes:h}=c;u={globalId:h[r],objectId:h[n]!=null&&h[n]!==-1?h[n]:null}}else u={globalId:c.globalId,objectId:c.objectId!=null&&c.objectId!==-1?c.objectId:null};u.globalId!=null&&(u.objectId!=null&&u.objectId!==-1||i.push(u.globalId))}),i.length===0)return null;const s=t.createQuery();s.where=i.map(c=>`${r}='${c}'`).join(" OR "),s.returnGeometry=!1,s.outFields=[n,r],s.cacheHint=!1;const o=await OYe(m9t(t,s));if(!o.ok)return null;const a=new Map,l=o.value.features;for(const c of l){const u=c.attributes[r],h=c.attributes[n];u!=null&&h!=null&&h!==-1&&a.set(u,h)}return a}let hL=class extends Se{constructor(){super(...arguments),this.type=null}};d([m({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],hL.prototype,"type",void 0),hL=d([F("esri.layers.support.FeatureReduction")],hL);var zre;let aU=zre=class extends hL{constructor(t){super(t),this.type="selection"}clone(){return new zre}};d([m({type:["selection"]})],aU.prototype,"type",void 0),aU=zre=d([F("esri.layers.support.FeatureReductionSelection")],aU);const b9t=aU;function w9t(){return{fields:{type:[AN],value:null,set:function(t){if(t&&ne("big-integer-warning-enabled")){const e=t.filter(r=>r.type==="big-integer"||r.type==="oid"&&(r.length||0)>=8);if(e.length){const r=e.map(i=>`'${i.name}'`).join(", ");K.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${r}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",t)}},fieldsIndex:{readOnly:!0,get(){return kG.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){var e;const t=this._userOutFields;if(!(t!=null&&t.length))return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const r of t)((e=this.fieldsIndex)==null?void 0:e.has(r))||K.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${r} found in outFields`,{layer:this,outFields:t});return $7(this.fieldsIndex,t)}}}}let US=class extends Se{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};d([m({type:Number})],US.prototype,"nodesPerPage",void 0),d([m({type:Number})],US.prototype,"rootIndex",void 0),d([m({type:String})],US.prototype,"lodSelectionMetricType",void 0),US=d([F("esri.layer.support.I3SNodePageDefinition")],US);let U0=class extends Se{constructor(){super(...arguments),this.factor=1}};d([m({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],U0.prototype,"id",void 0),d([m({type:Number})],U0.prototype,"factor",void 0),U0=d([F("esri.layer.support.I3SMaterialTexture")],U0);let nv=class extends Se{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};d([m({type:[Number]})],nv.prototype,"baseColorFactor",void 0),d([m({type:U0})],nv.prototype,"baseColorTexture",void 0),d([m({type:U0})],nv.prototype,"metallicRoughnessTexture",void 0),d([m({type:Number})],nv.prototype,"metallicFactor",void 0),d([m({type:Number})],nv.prototype,"roughnessFactor",void 0),nv=d([F("esri.layer.support.I3SMaterialPBRMetallicRoughness")],nv);let xd=class extends Se{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};d([gt({opaque:"opaque",mask:"mask",blend:"blend"})],xd.prototype,"alphaMode",void 0),d([m({type:Number})],xd.prototype,"alphaCutoff",void 0),d([m({type:Boolean})],xd.prototype,"doubleSided",void 0),d([gt({none:"none",back:"back",front:"front"})],xd.prototype,"cullFace",void 0),d([m({type:U0})],xd.prototype,"normalTexture",void 0),d([m({type:U0})],xd.prototype,"occlusionTexture",void 0),d([m({type:U0})],xd.prototype,"emissiveTexture",void 0),d([m({type:[Number]})],xd.prototype,"emissiveFactor",void 0),d([m({type:nv})],xd.prototype,"pbrMetallicRoughness",void 0),xd=d([F("esri.layer.support.I3SMaterialDefinition")],xd);let Y$=class extends Se{};d([m({type:String,json:{read:{source:["name","index"],reader:(t,e)=>t??`${e.index}`}}})],Y$.prototype,"name",void 0),d([gt({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],Y$.prototype,"format",void 0),Y$=d([F("esri.layer.support.I3STextureFormat")],Y$);let X$=class extends Se{constructor(){super(...arguments),this.atlas=!1}};d([m({type:[Y$]})],X$.prototype,"formats",void 0),d([m({type:Boolean})],X$.prototype,"atlas",void 0),X$=d([F("esri.layer.support.I3STextureSetDefinition")],X$);let Cf=class extends Se{};d([gt({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],Cf.prototype,"type",void 0),d([m({type:Number})],Cf.prototype,"component",void 0),Cf=d([F("esri.layer.support.I3SGeometryAttribute")],Cf);let Z$=class extends Se{};d([gt({draco:"draco"})],Z$.prototype,"encoding",void 0),d([m({type:[String]})],Z$.prototype,"attributes",void 0),Z$=d([F("esri.layer.support.I3SGeometryCompressedAttributes")],Z$);let jp=class extends Se{constructor(){super(...arguments),this.offset=0}};d([m({type:Number})],jp.prototype,"offset",void 0),d([m({type:Cf})],jp.prototype,"position",void 0),d([m({type:Cf})],jp.prototype,"normal",void 0),d([m({type:Cf})],jp.prototype,"uv0",void 0),d([m({type:Cf})],jp.prototype,"color",void 0),d([m({type:Cf})],jp.prototype,"uvRegion",void 0),d([m({type:Cf})],jp.prototype,"featureId",void 0),d([m({type:Cf})],jp.prototype,"faceRange",void 0),d([m({type:Z$})],jp.prototype,"compressedAttributes",void 0),jp=d([F("esri.layer.support.I3SGeometryBuffer")],jp);let J$=class extends Se{};d([gt({triangle:"triangle"})],J$.prototype,"topology",void 0),d([m()],J$.prototype,"geometryBuffers",void 0),J$=d([F("esri.layer.support.I3SGeometryDefinition")],J$);var Vre;let sv=Vre=class extends Se{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?zee(e.value):t}writeExpression(t,e,r){this.value!=null&&(t=zee(this.value)),t!=null&&(e[r]=t)}clone(){return new Vre({expression:this.expression,title:this.title,value:this.value})}};d([m({type:String,json:{write:{writerEnsuresNonNull:!0}}})],sv.prototype,"expression",void 0),d([Xe("expression",["expression","value"])],sv.prototype,"readExpression",null),d([nt("expression")],sv.prototype,"writeExpression",null),d([m({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],sv.prototype,"title",void 0),d([m({json:{read:!1,write:!1}})],sv.prototype,"value",void 0),sv=Vre=d([F("esri.layers.support.LabelExpressionInfo")],sv);const mBe=sv;var Bre;const Rk=new Ii({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function $k(t,e,r){return{enabled:!L3e(r==null?void 0:r.layer)}}function gBe(t){var e;return!t||t.origin!=="service"&&((e=t.layer)==null?void 0:e.type)!=="map-image"}function x9t(t){return(t==null?void 0:t.type)==="map-image"}function yBe(t){var e,r;return!!x9t(t)&&!!((r=(e=t.capabilities)==null?void 0:e.exportMap)!=null&&r.supportsArcadeExpressionForLabeling)}function S9t(t){return gBe(t)||yBe(t==null?void 0:t.layer)}let zs=Bre=class extends Se{static evaluateWhere(t,e){const r=(i,n,s)=>{switch(n){case"=":return i==s;case"<>":return i!=s;case">":return i>s;case">=":return i>=s;case"<":return i<s;case"<=":return i<=s}return!1};try{if(t==null)return!0;const i=t.split(" ");if(i.length===3)return r(e[i[0]],i[1],i[2]);if(i.length===7){const n=r(e[i[0]],i[1],i[2]),s=i[3],o=r(e[i[4]],i[5],i[6]);switch(s){case"AND":return n&&o;case"OR":return n||o}}return!1}catch{console.log("Error.: can't parse = "+t)}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=sCt,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const r=e.labelExpressionInfo;if(!r||!r.value&&!r.expression)return t}writeLabelExpression(t,e,r){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=ovt(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const i=ile(this.labelExpressionInfo.expression);i&&(t="["+i+"]")}}t!=null&&(e[r]=t)}writeLabelExpressionInfo(t,e,r,i){if(t==null&&this.labelExpression!=null&&gBe(i))t=new mBe({expression:this.getLabelExpressionArcade()});else if(!t)return;const n=t.toJSON(i);n.expression&&(e[r]=n)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return uG(this)}getLabelExpressionArcade(){return avt(this)}getLabelExpressionSingleField(){return lvt(this)}hash(){return JSON.stringify(this)}clone(){return new Bre({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:ae(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:ae(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};d([m({type:String,json:{write:!0}})],zs.prototype,"name",void 0),d([m({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:$k}}}}})],zs.prototype,"allowOverrun",void 0),d([m({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:$k}}}}})],zs.prototype,"deconflictionStrategy",void 0),d([m({type:String,json:{write:{overridePolicy(t,e,r){return this.labelExpressionInfo&&(r==null?void 0:r.origin)==="service"&&yBe(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],zs.prototype,"labelExpression",void 0),d([Xe("labelExpression")],zs.prototype,"readLabelExpression",null),d([nt("labelExpression")],zs.prototype,"writeLabelExpression",null),d([m({type:mBe,json:{write:{overridePolicy:(t,e,r)=>S9t(r)?{allowNull:!0}:{enabled:!1}}}})],zs.prototype,"labelExpressionInfo",void 0),d([nt("labelExpressionInfo")],zs.prototype,"writeLabelExpressionInfo",null),d([m({type:Rk.apiValues,json:{type:Rk.jsonValues,read:Rk.read,write:Rk.write}})],zs.prototype,"labelPlacement",void 0),d([m({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],zs.prototype,"labelPosition",void 0),d([m({type:Number})],zs.prototype,"maxScale",void 0),d([nt("maxScale")],zs.prototype,"writeMaxScale",null),d([m({type:Number})],zs.prototype,"minScale",void 0),d([nt("minScale")],zs.prototype,"writeMinScale",null),d([m({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:$k}}}}})],zs.prototype,"repeatLabel",void 0),d([m({type:Number,cast:gn,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:$k}}}}})],zs.prototype,"repeatLabelDistance",void 0),d([m({types:xht,json:{origins:{"web-scene":{types:Sht,write:uve,default:null}},write:uve,default:null}})],zs.prototype,"symbol",void 0),d([m({type:Boolean,json:{write:!0}})],zs.prototype,"useCodedValues",void 0),d([m({type:String,json:{write:!0}})],zs.prototype,"where",void 0),zs=Bre=d([F("esri.layers.support.LabelClass")],zs);const fue=zs,kY=()=>K.getLogger("esri.layers.support.labelingInfo"),T9t=/\[([^\[\]]+)\]/gi;function _Se(t,e,r){return t?t.map(i=>{var s;const n=new fue;if(n.read(i,r),n.labelExpression){const o=e.fields||((s=e.layerDefinition)==null?void 0:s.fields)||this.fields;n.labelExpression=n.labelExpression.replaceAll(T9t,(a,l)=>`[${E9t(l,o)}]`)}return n}):null}function E9t(t,e){if(!e)return t;const r=t.toLowerCase();for(let i=0;i<e.length;i++){const n=e[i].name;if(n.toLowerCase()===r)return n}return t}const C9t={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};function P9t(t,e){const r=ae(t);return r.some(i=>A9t(i,e))?[]:r}function A9t(t,e){const r=t.labelPlacement,i=C9t[e];if(!t.symbol)return kY().warn("No ILabelClass symbol specified."),!0;if(!i)return kY().error(new B("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),!0;if(!i.includes(r)){const n=i[0];r&&kY().warn(`Found invalid label placement type ${r} for ${e}. Defaulting to ${n}`),t.labelPlacement=n}return!1}var Gre;let FC=Gre=class extends Se{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new St}clone(){return new Gre({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};d([m({type:String,json:{write:!0}})],FC.prototype,"floorField",void 0),d([m({json:{read:!1,write:!1}})],FC.prototype,"viewAllMode",void 0),d([m({json:{read:!1,write:!1}})],FC.prototype,"viewAllLevelIds",void 0),FC=Gre=d([F("esri.layers.support.LayerFloorInfo")],FC);const _Be=FC,O9t={BingMapsLayer:async()=>(await re(()=>import("./BingMapsLayer-C2jj0MFW.js"),__vite__mapDeps([]))).default,BuildingSceneLayer:async()=>(await re(()=>import("./BuildingSceneLayer-x_p83xB6.js"),__vite__mapDeps([181,97,66,67,68,69,70,71,72,73,74,75,76,65,77,96]))).default,CatalogLayer:async()=>(await re(()=>import("./CatalogLayer-Cd4B-HyY.js"),__vite__mapDeps([182,74,10,11,69,70,71,183,184,28,25,68,72,75,76]))).default,CSVLayer:async()=>(await re(()=>import("./CSVLayer-CztgOj-p.js"),__vite__mapDeps([185,66,67,68,69,70,71,72,73,74,75,76,65,77,28,25]))).default,DimensionLayer:async()=>(await re(()=>import("./DimensionLayer-AsV_oWuN.js"),__vite__mapDeps([186,187,153]))).default,ElevationLayer:async()=>(await re(()=>import("./ElevationLayer-CTwEgTNI.js"),__vite__mapDeps([]))).default,FeatureLayer:async()=>(await re(()=>import("./FeatureLayer-BJkvQ9Vd.js"),__vite__mapDeps([66,67,68,69,70,71,72,73,74,75,76,65,77]))).default,GeoJSONLayer:async()=>(await re(()=>import("./GeoJSONLayer-Dq_iLWOv.js"),__vite__mapDeps([188,28,25,69,70,71,73,74,75]))).default,GeoRSSLayer:async()=>(await re(()=>import("./GeoRSSLayer-CxSbcoRm.js"),__vite__mapDeps([]))).default,GroupLayer:async()=>(await re(()=>import("./GroupLayer-BGDRiZZ9.js"),__vite__mapDeps([189,77]))).default,ImageryLayer:async()=>(await re(()=>import("./ImageryLayer-BNiniZAz.js"),__vite__mapDeps([190,191,49,11,64,65,75,76,77]))).default,ImageryTileLayer:async()=>(await re(()=>import("./ImageryTileLayer-BhHrsl2W.js"),__vite__mapDeps([192,191,49,11,51,50,75,77]))).default,IntegratedMeshLayer:async()=>(await re(()=>import("./IntegratedMeshLayer-BktgOJkP.js"),__vite__mapDeps([193,110]))).default,KMLLayer:async()=>(await re(()=>import("./KMLLayer-CgN0MU_h.js"),__vite__mapDeps([]))).default,LineOfSightLayer:async()=>(await re(()=>import("./LineOfSightLayer-0muamk8-.js"),__vite__mapDeps([194,187,160]))).default,LinkChartLayer:async()=>(await re(()=>import("./LinkChartLayer-D-y3OjFZ.js"),__vite__mapDeps([195,41,22,23,24,15,25,8,9,10,11,196,197,18,19,20,21,26,28,73]))).default,MapImageLayer:async()=>(await re(()=>import("./MapImageLayer-CpKTmmNI.js"),__vite__mapDeps([198,75,124,88,76]))).default,MapNotesLayer:async()=>(await re(()=>import("./MapNotesLayer-SwRLZXf-.js"),__vite__mapDeps([199,66,67,68,69,70,71,72,73,74,75,76,65,77,36]))).default,MediaLayer:async()=>(await re(()=>import("./MediaLayer-eaGJnh46.js"),__vite__mapDeps([200,126,127,19,20,21,77]))).default,OGCFeatureLayer:async()=>(await re(()=>import("./OGCFeatureLayer-DFzp3TZH.js"),__vite__mapDeps([201,42,33,17,28,25,34,69,70,71,73,74,75]))).default,OpenStreetMapLayer:async()=>(await re(()=>import("./OpenStreetMapLayer-DScBxiJ6.js"),__vite__mapDeps([202,203]))).default,OrientedImageryLayer:async()=>(await re(()=>import("./OrientedImageryLayer-Bsc4K44R.js"),__vite__mapDeps([204,66,67,68,69,70,71,72,73,74,75,76,65,77]))).default,PointCloudLayer:async()=>(await re(()=>import("./PointCloudLayer-CFTMPKbK.js"),__vite__mapDeps([205,47]))).default,RouteLayer:async()=>(await re(()=>import("./RouteLayer-BAgvzG7s.js"),__vite__mapDeps([206,133]))).default,SceneLayer:async()=>(await re(()=>Promise.resolve().then(()=>GVt),void 0)).default,StreamLayer:async()=>(await re(()=>import("./StreamLayer-lyTNH85v.js"),__vite__mapDeps([207,69,70,71,73,75,77]))).default,SubtypeGroupLayer:async()=>(await re(()=>import("./SubtypeGroupLayer-D9K4mpr6.js"),__vite__mapDeps([208,72,75,67,76,77]))).default,TileLayer:async()=>(await re(()=>Promise.resolve().then(()=>QBt),void 0)).default,IntegratedMesh3DTilesLayer:async()=>(await re(()=>import("./IntegratedMesh3DTilesLayer-BslRx3UP.js"),__vite__mapDeps([]))).default,UnknownLayer:async()=>(await re(()=>import("./UnknownLayer-sbe1jpa9.js"),__vite__mapDeps([]))).default,UnsupportedLayer:async()=>(await re(()=>import("./UnsupportedLayer-CNhemM3f.js"),__vite__mapDeps([]))).default,VectorTileLayer:async()=>(await re(()=>import("./VectorTileLayer-O_ZxrkIG.js"),__vite__mapDeps([209,58]))).default,VoxelLayer:async()=>(await re(()=>import("./VoxelLayer-C3fJEXTX.js"),__vite__mapDeps([]))).default,WFSLayer:async()=>(await re(()=>import("./WFSLayer-D4wBiAPv.js"),__vite__mapDeps([210,28,25,55,33,17,56,69,70,71,73,74,75]))).default,WMSLayer:async()=>(await re(()=>import("./WMSLayer-Di7wfc1x.js"),__vite__mapDeps([211,75,212,143]))).default,WMTSLayer:async()=>(await re(()=>import("./WMTSLayer-B3-JbwgU.js"),__vite__mapDeps([213,203,212,56]))).default,WebTileLayer:async()=>(await re(()=>import("./WebTileLayer-CJYKCic5.js").then(t=>t.W),__vite__mapDeps([]))).default};let ov=class extends Se{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};d([m({type:String,json:{read:!0,write:!0}})],ov.prototype,"name",void 0),d([m({type:String,json:{read:!0,write:!0}})],ov.prototype,"field",void 0),d([m({type:[Number],json:{read:!0,write:!0}})],ov.prototype,"currentRangeExtent",void 0),d([m({type:[Number],json:{read:!0,write:!0}})],ov.prototype,"fullRangeExtent",void 0),d([m({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],ov.prototype,"type",void 0),ov=d([F("esri.layers.support.RangeInfo")],ov);const XE={Base64:0,Hex:1,String:2,Raw:3},yP=8,vBe=(1<<yP)-1;function Yv(t,e){const r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function M9t(t){const e=[];for(let r=0,i=t.length*yP;r<i;r+=yP)e[r>>5]|=(t.charCodeAt(r/yP)&vBe)<<r%32;return e}function R9t(t){const e=[];for(let r=0,i=32*t.length;r<i;r+=yP)e.push(String.fromCharCode(t[r>>5]>>>r%32&vBe));return e.join("")}function $9t(t){const e="0123456789abcdef",r=[];for(let i=0,n=4*t.length;i<n;i++)r.push(e.charAt(t[i>>2]>>i%4*8+4&15)+e.charAt(t[i>>2]>>i%4*8&15));return r.join("")}function I9t(t){const e="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[];for(let n=0,s=4*t.length;n<s;n+=3){const o=(t[n>>2]>>n%4*8&255)<<16|(t[n+1>>2]>>(n+1)%4*8&255)<<8|t[n+2>>2]>>(n+2)%4*8&255;for(let a=0;a<4;a++)8*n+6*a>32*t.length?i.push(e):i.push(r.charAt(o>>6*(3-a)&63))}return i.join("")}function L9t(t,e){return t<<e|t>>>32-e}function zG(t,e,r,i,n,s){return Yv(L9t(Yv(Yv(e,t),Yv(i,s)),n),r)}function Cl(t,e,r,i,n,s,o){return zG(e&r|~e&i,t,e,n,s,o)}function Pl(t,e,r,i,n,s,o){return zG(e&i|r&~i,t,e,n,s,o)}function Al(t,e,r,i,n,s,o){return zG(e^r^i,t,e,n,s,o)}function Ol(t,e,r,i,n,s,o){return zG(r^(e|~i),t,e,n,s,o)}function D9t(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let r=1732584193,i=-271733879,n=-1732584194,s=271733878;for(let o=0;o<t.length;o+=16){const a=r,l=i,c=n,u=s;r=Cl(r,i,n,s,t[o],7,-680876936),s=Cl(s,r,i,n,t[o+1],12,-389564586),n=Cl(n,s,r,i,t[o+2],17,606105819),i=Cl(i,n,s,r,t[o+3],22,-1044525330),r=Cl(r,i,n,s,t[o+4],7,-176418897),s=Cl(s,r,i,n,t[o+5],12,1200080426),n=Cl(n,s,r,i,t[o+6],17,-1473231341),i=Cl(i,n,s,r,t[o+7],22,-45705983),r=Cl(r,i,n,s,t[o+8],7,1770035416),s=Cl(s,r,i,n,t[o+9],12,-1958414417),n=Cl(n,s,r,i,t[o+10],17,-42063),i=Cl(i,n,s,r,t[o+11],22,-1990404162),r=Cl(r,i,n,s,t[o+12],7,1804603682),s=Cl(s,r,i,n,t[o+13],12,-40341101),n=Cl(n,s,r,i,t[o+14],17,-1502002290),i=Cl(i,n,s,r,t[o+15],22,1236535329),r=Pl(r,i,n,s,t[o+1],5,-165796510),s=Pl(s,r,i,n,t[o+6],9,-1069501632),n=Pl(n,s,r,i,t[o+11],14,643717713),i=Pl(i,n,s,r,t[o],20,-373897302),r=Pl(r,i,n,s,t[o+5],5,-701558691),s=Pl(s,r,i,n,t[o+10],9,38016083),n=Pl(n,s,r,i,t[o+15],14,-660478335),i=Pl(i,n,s,r,t[o+4],20,-405537848),r=Pl(r,i,n,s,t[o+9],5,568446438),s=Pl(s,r,i,n,t[o+14],9,-1019803690),n=Pl(n,s,r,i,t[o+3],14,-187363961),i=Pl(i,n,s,r,t[o+8],20,1163531501),r=Pl(r,i,n,s,t[o+13],5,-1444681467),s=Pl(s,r,i,n,t[o+2],9,-51403784),n=Pl(n,s,r,i,t[o+7],14,1735328473),i=Pl(i,n,s,r,t[o+12],20,-1926607734),r=Al(r,i,n,s,t[o+5],4,-378558),s=Al(s,r,i,n,t[o+8],11,-2022574463),n=Al(n,s,r,i,t[o+11],16,1839030562),i=Al(i,n,s,r,t[o+14],23,-35309556),r=Al(r,i,n,s,t[o+1],4,-1530992060),s=Al(s,r,i,n,t[o+4],11,1272893353),n=Al(n,s,r,i,t[o+7],16,-155497632),i=Al(i,n,s,r,t[o+10],23,-1094730640),r=Al(r,i,n,s,t[o+13],4,681279174),s=Al(s,r,i,n,t[o],11,-358537222),n=Al(n,s,r,i,t[o+3],16,-722521979),i=Al(i,n,s,r,t[o+6],23,76029189),r=Al(r,i,n,s,t[o+9],4,-640364487),s=Al(s,r,i,n,t[o+12],11,-421815835),n=Al(n,s,r,i,t[o+15],16,530742520),i=Al(i,n,s,r,t[o+2],23,-995338651),r=Ol(r,i,n,s,t[o],6,-198630844),s=Ol(s,r,i,n,t[o+7],10,1126891415),n=Ol(n,s,r,i,t[o+14],15,-1416354905),i=Ol(i,n,s,r,t[o+5],21,-57434055),r=Ol(r,i,n,s,t[o+12],6,1700485571),s=Ol(s,r,i,n,t[o+3],10,-1894986606),n=Ol(n,s,r,i,t[o+10],15,-1051523),i=Ol(i,n,s,r,t[o+1],21,-2054922799),r=Ol(r,i,n,s,t[o+8],6,1873313359),s=Ol(s,r,i,n,t[o+15],10,-30611744),n=Ol(n,s,r,i,t[o+6],15,-1560198380),i=Ol(i,n,s,r,t[o+13],21,1309151649),r=Ol(r,i,n,s,t[o+4],6,-145523070),s=Ol(s,r,i,n,t[o+11],10,-1120210379),n=Ol(n,s,r,i,t[o+2],15,718787259),i=Ol(i,n,s,r,t[o+9],21,-343485551),r=Yv(r,a),i=Yv(i,l),n=Yv(n,c),s=Yv(s,u)}return[r,i,n,s]}function N9t(t,e=XE.Hex){const r=e||XE.Base64,i=D9t(M9t(t),t.length*yP);switch(r){case XE.Raw:return i;case XE.Hex:return $9t(i);case XE.String:return R9t(i);case XE.Base64:return I9t(i)}}function jre(t){return mue[F9t(t)]||U9t}function F9t(t){return t.type==="json"?"application/json":t.type==="blob"?t.blob.type:k9t(t.url)}function k9t(t){const e=One(t);return Hre[e]||bBe}const mue={},bBe="text/plain",U9t=mue[bBe],Hre={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const t in Hre)mue[Hre[t]]=t;function z9t(t){const e=(t==null?void 0:t.origins)??[void 0];return(r,i)=>{const n=V9t(t,r,i);for(const s of e){const o=yne(r,s,i);for(const a in n)o[a]=n[a]}}}function V9t(t,e,r){if((t==null?void 0:t.type)==="resource")return B9t(t,e,r);switch((t==null?void 0:t.type)??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:i,write:n}=FXe;return{read:i,write:n}}}}function B9t(t,e,r){const i=eN(e,r);return{type:String,read:(n,s,o)=>{const a=gB(n,s,o);return i.type===String?a:typeof i.type=="function"?new i.type({url:a}):void 0},write:{writer(n,s,o,a){if(!(a!=null&&a.resources))return typeof n=="string"?void(s[o]=l_(n,a)):void(s[o]=n.write({},a));const l=H9t(n),c=l_(l,{...a,verifyItemRelativeUrls:a!=null&&a.verifyItemRelativeUrls?{writtenUrls:a.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},$P.NO),u=i.type!==String&&(!sBe(this)||(a==null?void 0:a.origin)&&this.originIdOf(r)>Au(a.origin)),h={object:this,propertyName:r,value:n,targetUrl:c,dest:s,targetPropertyName:o,context:a,params:t};a!=null&&a.portalItem&&c&&!Fu(c)?u&&(t!=null&&t.contentAddressed)?qre(h):u?G9t(h):j9t(h):a!=null&&a.portalItem&&(c==null||A3e(c)!=null||vb(c)||u)?qre(h):s[o]=c}}}}function qre(t){var g;const{targetUrl:e,params:r,value:i,context:n,dest:s,targetPropertyName:o}=t;if(!n.portalItem)return;const a=O3e(e),l=xBe(i,e,n);if(r!=null&&r.contentAddressed&&l.type!=="json")return void((g=n.messages)==null?void 0:g.push(new B("persistable:contentAddressingUnsupported",`Property "${o}" is trying to serializing a resource with content of type ${l.type} with content addressing. Content addressing is only supported for json resources.`,{content:l})));const c=r!=null&&r.contentAddressed&&l.type==="json"?N9t(l.jsonString):(a==null?void 0:a.filename)??QN(),u=Nc((r==null?void 0:r.prefix)??(a==null?void 0:a.prefix),c),h=`${u}.${jre(l)}`;if(r!=null&&r.contentAddressed&&n.resources&&l.type==="json"){const y=n.resources.toKeep.find(({resource:v})=>v.path===h)??n.resources.toAdd.find(({resource:v})=>v.path===h);if(y)return void(s[o]=y.resource.itemRelativeUrl)}const p=n.portalItem.resourceFromPath(h);vb(e)&&n.resources&&n.resources.pendingOperations.push(VWe(e).then(y=>{p.path=`${u}.${jre({type:"blob",blob:y})}`,s[o]=p.itemRelativeUrl}).catch(()=>{}));const f=(r==null?void 0:r.compress)??!1;n.resources&&wBe({...t,resource:p,content:l,compress:f,updates:n.resources.toAdd}),s[o]=p.itemRelativeUrl}function G9t(t){const{context:e,targetUrl:r,params:i,value:n,dest:s,targetPropertyName:o}=t;if(!e.portalItem)return;const a=e.portalItem.resourceFromPath(r),l=xBe(n,r,e),c=jre(l),u=One(a.path),h=(i==null?void 0:i.compress)??!1;c===u?(e.resources&&wBe({...t,resource:a,content:l,compress:h,updates:e.resources.toUpdate}),s[o]=r):qre(t)}function j9t({context:t,targetUrl:e,dest:r,targetPropertyName:i}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(e),compress:!1}),r[i]=e)}function wBe({object:t,propertyName:e,updates:r,resource:i,content:n,compress:s}){const o=a=>{q9t(t,e,a)};r.push({resource:i,content:n,compress:s,finish:o})}function xBe(t,e,r){return typeof t=="string"?{type:"url",url:e}:{type:"json",jsonString:JSON.stringify(t.toJSON(r))}}function H9t(t){return t==null?null:typeof t=="string"?t:t.url}function q9t(t,e,r){typeof t[e]=="string"?t[e]=r.url:t[e].url=r.url}var lU;let Wre=lU=class extends kA(St.ofType(ku)){constructor(t){super(t)}clone(){return new lU(this.items.map(t=>t.clone()))}write(t,e){return this.toJSON(e)}toJSON(t){var r;const e=(r=t==null?void 0:t.layer)==null?void 0:r.spatialReference;return e?this.toArray().map(i=>{if(!e.equals(i.spatialReference)){if(!ju(i.spatialReference,e))return t!=null&&t.messages&&t.messages.push(new sp("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),null;const s=new ku;nOe(i,s,e),i=s}const n=i.toJSON(t);return delete n.spatialReference,n}).filter(i=>i!=null):(t!=null&&t.messages&&t.messages.push(new sp("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),this.toArray().map(i=>i.toJSON(t)))}static fromJSON(t,e){const r=new lU;return t.forEach(i=>r.add(ku.fromJSON(i,e))),r}};Wre=lU=d([F("esri.layers.support.PolygonCollection")],Wre);const cU=Wre;var Yre;let kC=Yre=class extends Se{constructor(t){super(t),this.spatialRelationship="disjoint",this.geometries=new cU,this._geometriesSource=null}initialize(){this.addHandles(jo(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,ei))}readGeometries(t,e,r){Array.isArray(t)?this.geometries=cU.fromJSON(t,r):this._geometriesSource={url:a_(t,r),context:r}}async loadGeometries(t,e){if(this._geometriesSource==null)return;const{url:r,context:i}=this._geometriesSource,n=await Vt(r,{responseType:"json",signal:e==null?void 0:e.signal}),s=t.toJSON(),o=n.data.map(a=>({...a,spatialReference:s}));this.geometries=cU.fromJSON(o,i),this._geometriesSource=null}clone(){const t=new Yre({geometries:ae(this.geometries),spatialRelationship:this.spatialRelationship});return t._geometriesSource=this._geometriesSource,t}};d([m({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],kC.prototype,"spatialRelationship",void 0),d([m({type:cU,nonNullable:!0,json:{write:!0}}),z9t({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],kC.prototype,"geometries",void 0),d([Xe(["web-scene","portal-item"],"geometries")],kC.prototype,"readGeometries",null),kC=Yre=d([F("esri.layers.support.SceneFilter")],kC);const W9t=kC;async function Y9t(t,e,r){const i=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(i&&i.type==="unique-value"&&i.styleOrigin){const n=await op(i.populateFromStyle());if(dt(r),n.ok===!1){const s=n.error;e!=null&&e.messages&&e.messages.push(new sp("renderer:style-reference",`Failed to create unique value renderer from style reference: ${s.message}`,{error:s,context:e})),t.clear("renderer",e==null?void 0:e.origin)}}}function SBe({displayField:t,editFieldsInfo:e,fields:r,objectIdField:i,title:n},s){if(!r)return null;const o=Q9t({editFieldsInfo:e,fields:r,objectIdField:i},s);if(!o.length)return null;const a=tVt({titleBase:n,fields:r,displayField:t}),l=eVt();return new D7({title:a,content:l,fieldInfos:o})}const X9t=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):Kct(t,e);function Z9t(t,e){const r=t;return e&&(t=t.filter(i=>!e.includes(i.type))),t===r&&(t=t.slice()),t.sort(J9t),t}function J9t(t,e){return t.type==="oid"?-1:e.type==="oid"?1:vSe(t)?-1:vSe(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function Q9t(t,e){const r=e==null?void 0:e.visibleFieldNames;return Z9t(t.fields??[],(e==null?void 0:e.ignoreFieldTypes)||rVt).map(i=>new Boe({fieldName:i.name,isEditable:Qct(i,t),label:i.alias,format:K9t(i),visible:X9t(i,{...t,visibleFieldNames:r})}))}function K9t(t){switch(t.type){case"small-integer":case"integer":case"single":return new O6({digitSeparator:!0,places:0});case"double":return new O6({digitSeparator:!0,places:2});case"string":return Sut(t.name)?new O6({digitSeparator:!0,places:0}):null;default:return null}}function eVt(){return[new lD,new aD]}function tVt(t){const e=Vct(t),{titleBase:r}=t;return e?`${r}: {${e.trim()}}`:r??""}function vSe(t){return(t.name&&t.name.toLowerCase())==="name"?!0:(t.alias&&t.alias.toLowerCase())==="name"}const rVt=["geometry","blob","raster","guid","xml"];async function iVt(t){const e=[];for(const r of t)r.name.toLowerCase().endsWith(".zip")?e.push(nVt(r)):e.push(Promise.resolve(r));return(await Promise.all(e)).flat()}async function nVt(t){const{BlobReader:e,ZipReader:r,BlobWriter:i}=await re(()=>import("./zipjs-wrapper-Ccj19yUd.js"),__vite__mapDeps([])),n=[];return(await new r(new e(t)).getEntries()).forEach(o=>{var c;if(o.directory||/^__MACOS/i.test(o.filename))return;const a=new i,l=(c=o.getData)==null?void 0:c.call(o,a).then(u=>new File([u],o.filename));l&&n.push(l)}),Promise.all(n)}const ns=!0,iT={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function gue(t,e,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(t,r+iT.identifierOffset,iT.identifierLength)),version:e.getUint16(r+iT.versionOffset,ns),checksum:e.getUint32(r+iT.checksumOffset,ns)}}const iu={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function sVt(t,e){return{sizeLo:t.getUint32(e+iu.sizeLo,ns),sizeHi:t.getUint32(e+iu.sizeHi,ns),minX:t.getFloat64(e+iu.minX,ns),minY:t.getFloat64(e+iu.minY,ns),minZ:t.getFloat64(e+iu.minZ,ns),maxX:t.getFloat64(e+iu.maxX,ns),maxY:t.getFloat64(e+iu.maxY,ns),maxZ:t.getFloat64(e+iu.maxZ,ns),errorX:t.getFloat64(e+iu.errorX,ns),errorY:t.getFloat64(e+iu.errorY,ns),errorZ:t.getFloat64(e+iu.errorZ,ns),count:t.getUint32(e+iu.count,ns),reserved:t.getUint32(e+iu.reserved,ns)}}function Kpr(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:n}=gue(t,e,r);if(r+=iT.byteCount,i!=="LEPCC     ")throw new B("lepcc-decode-error","Bad identifier");if(n>1)throw new B("lepcc-decode-error","Unknown version");const s=sVt(e,r);if(r+=iu.byteCount,s.sizeHi*2**32+s.sizeLo!==t.byteLength)throw new B("lepcc-decode-error","Bad size");const o=new Float64Array(3*s.count),a=[],l=[],c=[],u=[];if(r=Ik(t,r,a),r=Ik(t,r,l),r=Ik(t,r,c),r=Ik(t,r,u),r!==t.byteLength)throw new B("lepcc-decode-error","Bad length");let h=0,p=0;for(let f=0;f<a.length;f++){p+=a[f];let g=0;for(let y=0;y<l[f];y++){g+=c[h];const v=u[h];o[3*h]=Math.min(s.maxX,s.minX+2*s.errorX*g),o[3*h+1]=Math.min(s.maxY,s.minY+2*s.errorY*p),o[3*h+2]=Math.min(s.maxZ,s.minZ+2*s.errorZ*v),h++}}return{errorX:s.errorX,errorY:s.errorY,errorZ:s.errorZ,result:o}}function Ik(t,e,r){const i=[];e=Xre(t,e,i);const n=[];for(let s=0;s<i.length;s++){n.length=0,e=Xre(t,e,n);for(let o=0;o<n.length;o++)r.push(n[o]+i[s])}return e}function Xre(t,e,r){const i=new DataView(t,e),n=i.getUint8(0),s=31&n,o=!!(32&n),a=(192&n)>>6;let l=0;if(a===0)l=i.getUint32(1,ns),e+=5;else if(a===1)l=i.getUint16(1,ns),e+=3;else{if(a!==2)throw new B("lepcc-decode-error","Bad count type");l=i.getUint8(1),e+=2}if(o)throw new B("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*s/8),u=new Uint8Array(t,e,c);let h=0,p=0,f=0;const g=-1>>>32-s;for(let y=0;y<l;y++){for(;p<s;)h|=u[f]<<p,p+=8,f+=1;r[y]=h&g,h>>>=s,p-=s,p+s>32&&(h|=u[f-1]>>8-p)}return e+f}const mS={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function oVt(t,e){return{sizeLo:t.getUint32(e+mS.sizeLo,ns),sizeHi:t.getUint32(e+mS.sizeHi,ns),count:t.getUint32(e+mS.count,ns),colorMapCount:t.getUint16(e+mS.colorMapCount,ns),lookupMethod:t.getUint8(e+mS.lookupMethod),compressionMethod:t.getUint8(e+mS.compressionMethod)}}function aVt(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:n}=gue(t,e,r);if(r+=iT.byteCount,i!=="ClusterRGB")throw new B("lepcc-decode-error","Bad identifier");if(n>1)throw new B("lepcc-decode-error","Unknown version");const s=oVt(e,r);if(r+=mS.byteCount,s.sizeHi*2**32+s.sizeLo!==t.byteLength)throw new B("lepcc-decode-error","Bad size");if((s.lookupMethod===2||s.lookupMethod===1)&&s.compressionMethod===0){if(3*s.colorMapCount+s.count+r!==t.byteLength||s.colorMapCount>256)throw new B("lepcc-decode-error","Bad count");const o=new Uint8Array(t,r,3*s.colorMapCount),a=new Uint8Array(t,r+3*s.colorMapCount,s.count),l=new Uint8Array(3*s.count);for(let c=0;c<s.count;c++){const u=a[c];l[3*c]=o[3*u],l[3*c+1]=o[3*u+1],l[3*c+2]=o[3*u+2]}return l}if(s.lookupMethod===0&&s.compressionMethod===0){if(3*s.count+r!==t.byteLength||s.colorMapCount!==0)throw new B("lepcc-decode-error","Bad count");return new Uint8Array(t,r).slice()}if(s.lookupMethod<=2&&s.compressionMethod===1){if(r+3!==t.byteLength||s.colorMapCount!==1)throw new B("lepcc-decode-error","Bad count");const o=e.getUint8(r),a=e.getUint8(r+1),l=e.getUint8(r+2),c=new Uint8Array(3*s.count);for(let u=0;u<s.count;u++)c[3*u]=o,c[3*u+1]=a,c[3*u+2]=l;return c}throw new B("lepcc-decode-error","Bad method "+s.lookupMethod+","+s.compressionMethod)}const gS={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function lVt(t,e){return{sizeLo:t.getUint32(e+gS.sizeLo,ns),sizeHi:t.getUint32(e+gS.sizeHi,ns),count:t.getUint32(e+gS.count,ns),scaleFactor:t.getUint16(e+gS.scaleFactor,ns),bitsPerPoint:t.getUint8(e+gS.bitsPerPoint),reserved:t.getUint8(e+gS.reserved)}}function cVt(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:n}=gue(t,e,r);if(r+=iT.byteCount,i!=="Intensity ")throw new B("lepcc-decode-error","Bad identifier");if(n>1)throw new B("lepcc-decode-error","Unknown version");const s=lVt(e,r);if(r+=gS.byteCount,s.sizeHi*2**32+s.sizeLo!==t.byteLength)throw new B("lepcc-decode-error","Bad size");const o=new Uint16Array(s.count);if(s.bitsPerPoint===8){if(s.count+r!==t.byteLength)throw new B("lepcc-decode-error","Bad size");const a=new Uint8Array(t,r,s.count);for(let l=0;l<s.count;l++)o[l]=a[l]*s.scaleFactor}else if(s.bitsPerPoint===16){if(2*s.count+r!==t.byteLength)throw new B("lepcc-decode-error","Bad size");const a=new Uint16Array(t,r,s.count);for(let l=0;l<s.count;l++)o[l]=a[l]*s.scaleFactor}else{const a=[];if(Xre(t,r,a)!==t.byteLength)throw new B("lepcc-decode-error","Bad size");for(let l=0;l<s.count;l++)o[l]=a[l]*s.scaleFactor}return o}const Zre=()=>K.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function uVt(t,e,r){let i="",n=0;for(;n<r;){const s=t[e+n];if(s<128)i+=String.fromCharCode(s),n++;else if(s>=192&&s<224){if(n+1>=r)throw new B("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&s)<<6|63&t[e+n+1];i+=String.fromCharCode(o),n+=2}else if(s>=224&&s<240){if(n+2>=r)throw new B("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&s)<<12|(63&t[e+n+1])<<6|63&t[e+n+2];i+=String.fromCharCode(o),n+=3}else{if(!(s>=240&&s<248))throw new B("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(n+3>=r)throw new B("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&s)<<18|(63&t[e+n+1])<<12|(63&t[e+n+2])<<6|63&t[e+n+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);i+=String.fromCharCode(a,l)}else i+=String.fromCharCode(o);n+=4}}}return i}function TBe(t,e){const r={byteOffset:0,byteCount:0,fields:Object.create(null)};let i=0;for(let n=0;n<e.length;n++){const s=e[n],o=s.valueType||s.type,a=vVt[o];r.fields[s.property]=a(t,i),i+=VG[o].BYTES_PER_ELEMENT}return r.byteCount=i,r}function hVt(t,e,r){return EBe(t,e,r).map(i=>{const n=i?Date.parse(i):null;return n&&!Number.isNaN(n)?n:null})}function EBe(t,e,r){const i=[];let n,s,o=0;for(s=0;s<t;s+=1){if(n=e[s],n>0){if(i.push(uVt(r,o,n-1)),r[o+n-1]!==0)throw new B("string-array-error","Invalid string array: missing null termination.")}else i.push(null);o+=n}return i}function bSe(t,e){return new VG[e.valueType](t,e.byteOffset,e.count*e.valuesPerElement)}function dVt(t,e){return new Uint8Array(t,e.byteOffset,e.byteCount)}function pVt(t,e,r){const i=e.header!=null?TBe(t,e.header):{byteOffset:0,byteCount:0,fields:{count:r}},n={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)};let s=i.byteCount;for(let o=0;o<e.ordering.length;o++){const a=e.ordering[o],l=ae(e[a]);if(l.count=i.fields.count??0,l.valueType==="String"){if(l.byteOffset=s,l.byteCount=i.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new B("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding});if(l.timeEncoding&&l.timeEncoding!=="ECMA_ISO8601")throw new B("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:l.timeEncoding})}else{if(!PBe(l.valueType))throw new B("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=uU(l.valueType);s+=s%c!=0?c-s%c:0,l.byteOffset=s,l.byteCount=c*l.valuesPerElement*l.count}}s+=l.byteCount??0,n.entries[a]=l}return n.byteCount=s-n.byteOffset,n}function CBe(t,e,r){if(e!==t&&Zre().error(`Invalid ${r} buffer size
 expected: ${t}, actual: ${e})`),e<t)throw new B("buffer-too-small","Binary buffer is too small",{expectedSize:t,actualSize:e})}function fVt(t){return{isDraco:!1,isLegacy:!1,color:t.color!=null,normal:t.normal!=null,uv0:t.uv0!=null,uvRegion:t.uvRegion!=null,featureIndex:t.faceRange!=null&&t.featureId!=null}}function efr(t,e){const r=TBe(t,e&&e.header);let i=r.byteCount;const n={isDraco:!1,header:r,byteOffset:r.byteCount,byteCount:0,vertexAttributes:{}},s=r.fields,o=s.vertexCount!=null?s.vertexCount:s.count;for(const c of e.ordering){if(!e.vertexAttributes[c])continue;const u={...e.vertexAttributes[c],byteOffset:i,count:o},h=yVt[c]||"_"+c;n.vertexAttributes[h]=u,i+=uU(u.valueType)*u.valuesPerElement*o}const a=s.faceCount;if(e.faces&&a){n.faces={};for(const c of e.ordering){if(!e.faces[c])continue;const u={...e.faces[c],byteOffset:i,count:a};n.faces[c]=u,i+=uU(u.valueType)*u.valuesPerElement*a}}const l=s.featureCount;if(e.featureAttributes&&e.featureAttributeOrder&&l){n.featureAttributes={};for(const c of e.featureAttributeOrder){if(!e.featureAttributes[c])continue;const u={...e.featureAttributes[c],byteOffset:i,count:l};n.featureAttributes[c]=u,i+=(u.valueType==="UInt64"?8:uU(u.valueType))*u.valuesPerElement*l}}return CBe(i,t.byteLength,"geometry"),n.byteCount=i-n.byteOffset,n}function tfr(t,e){return!t||!t.compressedAttributes||t.compressedAttributes.encoding!=="draco"?t?fVt(t):mVt(e):gVt(t.compressedAttributes.attributes)}function mVt(t){const e={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of t.ordering)if(t.vertexAttributes[r])switch(r){case"position":break;case"normal":e.normal=!0;break;case"color":e.color=!0;break;case"uv0":e.uv0=!0;break;case"region":e.uvRegion=!0}return t.featureAttributes&&t.featureAttributeOrder&&(e.featureIndex=!0),e}function gVt(t){const e={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of t)switch(r){case"position":break;case"normal":e.normal=!0;break;case"uv0":e.uv0=!0;break;case"color":e.color=!0;break;case"uv-region":e.uvRegion=!0;break;case"feature-index":e.featureIndex=!0}return e}const yVt={position:R.POSITION,normal:R.NORMAL,color:R.COLOR,uv0:R.UV0,region:R.UVREGION};function _Vt(t,e,r){if(t.encoding==="lepcc-rgb")return aVt(e);if(t.encoding==="lepcc-intensity")return cVt(e);if(t.encoding!=null&&t.encoding!=="")throw new B("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");t["attributeByteCounts "]&&!t.attributeByteCounts&&(Zre().warn("Warning: Trailing space in 'attributeByteCounts '."),t.attributeByteCounts=t["attributeByteCounts "]),t.ordering[0]==="ObjectIds"&&t.hasOwnProperty("objectIds")&&(Zre().warn("Warning: Case error in objectIds"),t.ordering[0]="objectIds");const i=pVt(e,t,r);CBe(i.byteOffset+i.byteCount,e.byteLength,"attribute");const n=i.entries.attributeValues||i.entries.objectIds;if(n){if(n.valueType==="String"){const s=i.entries.attributeByteCounts,o=bSe(e,s),a=dVt(e,n);return n.timeEncoding?hVt(s.count,o,a):EBe(s.count,o,a)}return bSe(e,n)}throw new B("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const VG={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},vVt={Float32:(t,e)=>new DataView(t,0).getFloat32(e,!0),Float64:(t,e)=>new DataView(t,0).getFloat64(e,!0),UInt8:(t,e)=>new DataView(t,0).getUint8(e),Int8:(t,e)=>new DataView(t,0).getInt8(e),UInt16:(t,e)=>new DataView(t,0).getUint16(e,!0),Int16:(t,e)=>new DataView(t,0).getInt16(e,!0),UInt32:(t,e)=>new DataView(t,0).getUint32(e,!0),Int32:(t,e)=>new DataView(t,0).getInt32(e,!0)};function PBe(t){return VG.hasOwnProperty(t)}function uU(t){return PBe(t)?VG[t].BYTES_PER_ELEMENT:0}function bVt(t,e,r,i){const n=wVt(t,e,r),s=xe();return Ua(r,n,s,i),s}const ABe=1,wSe=5-ABe;function wVt(t,e,r){const i=C(),n=t[3],s=2**(Math.ceil(Math.log(n)*Math.LOG2E/wSe)*wSe+ABe);if(r.isGeographic){const l=s/zr(r).radius*180/Math.PI,c=Math.round(t[1]/l),u=Math.max(-90,Math.min(90,c*l)),h=l/Math.cos((Math.abs(u)-l/2)/180*Math.PI),p=Math.round(t[0]/h)*h;i[0]=p,i[1]=u}else{const l=Math.round(t[0]/s),c=Math.round(t[1]/s);i[0]=l*s,i[1]=c*s}const o=t[2]+e,a=Math.round(o/s);return i[2]=a*s,i}function OBe(t){return t?parseInt(t.substring(t.lastIndexOf("/")+1,t.length),10):void 0}function rfr(t){var e;if(ne("disable-feature:i3s-draco")||!t)return!1;for(const r of t)for(const i of r.geometryBuffers)if(((e=i.compressedAttributes)==null?void 0:e.encoding)==="draco")return!0;return!1}function ifr(t,e,r,i){r.traverse(e,n=>{const s=n.serviceMbsInIndexSR;return(s!=null&&xVt(t,s))!==nT.OUTSIDE&&(i(n),!0)})}function nfr(t,e,r){let i=0,n=0;for(let s=0;s<e.length&&i<t.length;s++)t[i]===e[s]&&(r(s)&&(t[n]=t[i],n++),i++);t.length=n}function sfr(t,e,r){let i=0,n=0;for(;i<r.length;)TEe(t,r[i])>=0===e&&(r[n]=r[i],n++),i++;r.length=n}const UM=Ht();function ofr(t,e){if(e.rotationScale[1]===0&&e.rotationScale[2]===0&&e.rotationScale[3]===0&&e.rotationScale[5]===0&&e.rotationScale[6]===0&&e.rotationScale[7]===0)return UM[0]=(t[0]-e.position[0])/e.rotationScale[0],UM[1]=(t[1]-e.position[1])/e.rotationScale[4],UM[2]=(t[2]-e.position[0])/e.rotationScale[0],UM[3]=(t[3]-e.position[1])/e.rotationScale[4],UM}var nT;function xVt(t,e){const r=e[0],i=e[1],n=e[3],s=t[0]-r,o=r-t[2],a=t[1]-i,l=i-t[3],c=Math.max(s,o,0),u=Math.max(a,l,0),h=c*c+u*u;return h>n*n?nT.OUTSIDE:h>0?nT.INTERSECTS_CENTER_OUTSIDE:-Math.max(s,o,a,l)>n?nT.INSIDE:nT.INTERSECTS_CENTER_INSIDE}function SVt(t,e,r){const i=[],n=r==null?void 0:r.missingFields,s=r==null?void 0:r.originalFields;for(const o of t){const a=o.toLowerCase();let l=!1;for(const c of e)if(a===c.name.toLowerCase()){i.push(c.name),l=!0,s&&s.push(o);break}!l&&n&&n.push(o)}return i}async function afr(t,e,r,i,n,s){if(e.length===0)return[];const o=t.attributeStorageInfo;if(t.associatedLayer!=null)try{return await EVt(t.associatedLayer,e,r,i,s)}catch(a){if(t.associatedLayer.loaded)throw a}if(o){const a=TVt(e,r,n);if(a==null)throw new B("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const l=t.parsedUrl.path;return(await Promise.all(a.map(c=>CVt(l,o,c.node,c.indices,i,t.apiKey,t.customParameters,s).then(u=>{for(let h=0;h<c.graphics.length;h++){const p=c.graphics[h],f=u[h];if(p.attributes)for(const g in p.attributes)g in f||(f[g]=p.attributes[g]);p.attributes=f}return c.graphics})))).flat()}throw new B("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function TVt(t,e,r){const i=new Map,n=[],s=r();for(const o of t){const a=o.attributes[e];for(let l=0;l<s.length;l++){const c=s[l],u=c.featureIds.indexOf(a);if(u>=0){let h=i.get(c.node);h||(h={node:c.node,indices:[],graphics:[]},n.push(h),i.set(c.node,h)),h.indices.push(u),h.graphics.push(o);for(let p=l;p>0;p--)s[p]=s[p-1];s[0]=c;break}}}return n}async function EVt(t,e,r,i,n){e.sort((c,u)=>c.attributes[r]-u.attributes[r]);const s=e.map(c=>c.attributes[r]),o=[],a=SVt(i,t.fields,{originalFields:o}),l=await MBe(t,s,a,n);for(let c=0;c<e.length;c++){const u=e[c],h=l[c],p={};if(u.attributes)for(const f in u.attributes)p[f]=u.attributes[f];for(let f=0;f<o.length;f++)p[o[f]]=h[a[f]];u.attributes=p}return e}function MBe(t,e,r,i){const n=t.capabilities.query.maxRecordCount;if(n!=null&&e.length>n){const o=uHe(e,n);return Promise.all(o.map(a=>MBe(t,a,r,i))).then(a=>a.flat())}const s=new ec({objectIds:e,outFields:r,orderByFields:[t.objectIdField]});return t.queryFeatures(s,i).then(o=>{if(o&&o.features&&o.features.length===e.length)return o.features.map(a=>a.attributes);throw new B("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function CVt(t,e,r,i,n,s,o,a){return RBe(t,e,r.resources.attributes,i,n,s,o,a)}async function RBe(t,e,r,i,n,s,o,a){const l=[];for(const h of e)if(h&&n.includes(h.name)){const p=`${t}/nodes/${r}/attributes/${h.key}/0`;l.push({url:p,storageInfo:h})}const c=await Promise.allSettled(l.map(h=>Vt(h.url,{responseType:"array-buffer",query:{...o,token:s},signal:a==null?void 0:a.signal}).then(p=>_Vt(h.storageInfo,p.data)))),u=[];for(const h of i){const p={};for(let f=0;f<c.length;f++){const g=c[f];if(g.status==="fulfilled"){const y=g.value;p[l[f].storageInfo.name]=OVt(y,h)}}u.push(p)}return u}(function(t){t[t.OUTSIDE=0]="OUTSIDE",t[t.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",t[t.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",t[t.INSIDE=3]="INSIDE"})(nT||(nT={}));const PVt=-32768,AVt=-(2**31);function OVt(t,e){if(!t)return null;const r=t[e];return ZV(t)?r===PVt?null:r:QV(t)?r===AVt?null:r:r!=r?null:r}function MVt(t){const e=t.store,r=e.indexCRS||e.geographicCRS,i=r===void 0?e.indexWKT:void 0;if(i){if(!t.spatialReference)throw new B("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indexWKT in the scene layer store but no layer spatial reference",{});if(i!==t.spatialReference.wkt)throw new B("layerview:store-spatial-reference-wkt-index-incompatible","The indexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const n=r?new Ve(OBe(r)):t.spatialReference;return n.equals(t.spatialReference)?t.spatialReference:n}function RVt(t){const e=t.store,r=e.vertexCRS||e.projectedCRS,i=r===void 0?e.vertexWKT:void 0;if(i){if(!t.spatialReference)throw new B("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==t.spatialReference.wkt)throw new B("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const n=r?new Ve(OBe(r)):t.spatialReference;return n.equals(t.spatialReference)?t.spatialReference:n}function lfr(t,e){return e==null?"@null":e===Kl(e)?"@ECEF":t.equals(e)?"":e.wkid!=null?"@"+e.wkid:null}function Jre(t,e,r){if(!ju(t,e))throw new B("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(r==="local"&&!$Vt(t,e))throw new B("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function cfr(t,e,r){var i,n,s,o;if(((i=t.serviceUpdateTimeStamp)==null?void 0:i.lastUpdate)!==((n=e.serviceUpdateTimeStamp)==null?void 0:n.lastUpdate)||!r.isEmpty||((s=t.associatedLayer)==null?void 0:s.url)!==((o=e.associatedLayer)==null?void 0:o.url))throw new B("layerview:recycle-failed")}function $Vt(t,e){return t.equals(e)||t.isWGS84&&e.isWebMercator||t.isWebMercator&&e.isWGS84}function IVt(t,e,r){const i=MVt(t),n=RVt(t);Jre(i,e,r),Jre(n,e,r)}function LVt(t){var e;return(t.geometryType==null||t.geometryType==="triangles")&&(t.topology==null||t.topology==="PerAttributeArray")&&((e=t.vertexAttributes)==null?void 0:e.position)!=null}function ufr(t){var e;if(((e=t.store)==null?void 0:e.defaultGeometrySchema)==null||!LVt(t.store.defaultGeometrySchema))throw new B("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:t.parsedUrl.path})}function hfr(t,e){IVt(t,e.spatialReference,e.viewingMode)}function DVt(t){var e;return t.geometryType!=null&&t.geometryType==="points"&&(t.topology==null||t.topology==="PerAttributeArray")&&(t.encoding==null||t.encoding===""||t.encoding==="lepcc-xyz")&&((e=t.vertexAttributes)==null?void 0:e.position)!=null}function dfr(t){var e;if(((e=t.store)==null?void 0:e.defaultGeometrySchema)==null||!DVt(t.store.defaultGeometrySchema))throw new B("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function pfr(t,e){Jre(t.spatialReference,e.spatialReference,e.viewingMode)}function NVt(t){return t.type==="simple"||t.type==="class-breaks"||t.type==="unique-value"}function FVt(t){return t.type==="mesh-3d"}function ffr(t){var r;if(t==null||!NVt(t)||(t.type==="unique-value"||t.type==="class-breaks")&&t.defaultSymbol==null)return!0;const e=t.getSymbols();if(e.length===0)return!0;for(const i of e){if(!FVt(i)||i.symbolLayers.length===0)return!0;for(const n of i.symbolLayers.items)if(n.type!=="fill"||((r=n.material)==null?void 0:r.color)==null||n.material.colorMixMode!=="replace")return!0}return!1}const mfr=_5e({color:[0,0,0,0],opacity:0});class kVt{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function gfr(t){const e=new kVt;let r=!1,i=!1;for(const n of t.symbolLayers.items)if(n.type==="fill"&&n.enabled){const s=n.material,o=n.edges;if(s!=null&&!r){const a=s.color,l=P5e(s.colorMixMode);e.material=a!=null?{color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:{color:[1,1,1],alpha:1,colorMixMode:ws.Multiply},e.castShadows=n.castShadows,r=!0}o==null||i||(e.edgeMaterial=y5e(o,{}),i=!0)}return e.material||(e.material={color:[1,1,1],alpha:1,colorMixMode:ws.Multiply}),e}function yfr(t,e){return(0|t)+(0|e)|0}function _fr(t,e,r,i,n,s,o){if(!s||s.length===0||e==null||!t.serviceMbsInIndexSR)return null;const a=bVt(t.serviceMbsInIndexSR,n,r,e);us(Dk,a);let l=null;const c=()=>{if(!l)if(l=UVt,kc(Lk),t.serviceObbInIndexSR!=null){t.serviceObbInIndexSR.transform(xSe,r,e,n,o),xSe.getCorners(l);for(const g of l)ze(g,g,Dk),U3(Lk,g)}else{const g=t.serviceMbsInIndexSR;if(!g)return;const y=g[3];ga(g,r,kn,e),ze(kn,kn,Dk),kn[2]+=n;for(let v=0;v<8;++v){const b=1&v?y:-y,w=2&v?y:-y,x=4&v?y:-y,S=l[v];he(S,[kn[0]+b,kn[1]+w,kn[2]+x]),U3(Lk,S)}}};let u=1/0,h=-1/0;const p=g=>{if(g.type!=="replace")return;const y=g.geometry;if(!(y!=null&&y.hasZ))return;kc(UY);const v=y.spatialReference||i,b=y.rings.reduce((w,x)=>x.reduce((S,E)=>(se(kn,E[0],E[1],E[2]),ga(kn,v,kn,e),ze(kn,kn,Dk),U3(UY,kn),Math.min(kn[2],S)),w),1/0);c(),lN(Lk,UY)&&(u=Math.min(u,b),h=Math.max(h,b))};if(s.forEach(g=>p(g)),u===1/0)return null;const f=(g,y,v)=>{ze(kn,v,a),g[y]=kn[0],g[y+1]=kn[1],g[y+2]=kn[2],y+=24,v[2]=u,ze(kn,v,a),g[y]=kn[0],g[y+1]=kn[1],g[y+2]=kn[2],y+=24,v[2]=h,ze(kn,v,a),g[y]=kn[0],g[y+1]=kn[1],g[y+2]=kn[2]};for(let g=0;g<8;++g)f(SSe.data,3*g,l[g]);return g$e(SSe)}function vfr(t){return t[3]>=0}function bfr(t){t!=null&&(t[3]=-1)}const UVt=[C(),C(),C(),C(),C(),C(),C(),C()],UY=Ht(),Lk=Ht(),xSe=new Aoe,kn=C(),SSe={data:new Array(72),size:3,exclusive:!0,stride:3},Dk=xe();async function zVt(t,e=t.popupTemplate){var u,h;if(e==null)return[];const r=await e.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:i}=e,{objectIdField:n,typeIdField:s,globalIdField:o,relationships:a}=t;if(r.includes("*"))return["*"];const l=i?qct(t):[],c=$7(t.fieldsIndex,[...r,...l]);return s&&c.push(s),c&&n&&((u=t.fieldsIndex)!=null&&u.has(n))&&!c.includes(n)&&c.push(n),c&&o&&((h=t.fieldsIndex)!=null&&h.has(o))&&!c.includes(o)&&c.push(o),a&&a.forEach(p=>{var g;const{keyField:f}=p;c&&f&&((g=t.fieldsIndex)!=null&&g.has(f))&&!c.includes(f)&&c.push(f)}),c}function $Be(t,e){return t.popupTemplate?t.popupTemplate:e!=null&&e.defaultPopupTemplateEnabled&&t.defaultPopupTemplate!=null?t.defaultPopupTemplate:null}function wfr(t,e){return $Be(t,{defaultPopupTemplateEnabled:e})!=null}const VVt=new Set(["3DObject","Point"]),TSe=w9t();let Nt=class extends c9t(Lzt(o9t(qVe(rBe(nBe(rue(UG(WVe(HVe(ds(LB))))))))))){constructor(...t){super(...t),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new St,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0,this.serviceItemId=void 0}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}destroy(){this._set("renderer",null)}getField(t){return this.fieldsIndex.get(t)}getFieldDomain(t,e){var i,n,s;const r=(n=(i=this.getFeatureType(e==null?void 0:e.feature))==null?void 0:i.domains)==null?void 0:n[t];return r&&r.type!=="inherited"?r:((s=this.getField(t))==null?void 0:s.domain)??null}getFeatureType(t){return t&&this.associatedLayer?this.associatedLayer.getFeatureType(t):null}get types(){var t;return((t=this.associatedLayer)==null?void 0:t.types)??[]}get typeIdField(){var t;return((t=this.associatedLayer)==null?void 0:t.typeIdField)??null}get templates(){var t;return((t=this.associatedLayer)==null?void 0:t.templates)??null}get formTemplate(){var t;return((t=this.associatedLayer)==null?void 0:t.formTemplate)??null}get fieldsIndex(){return new kG(this.fields)}readNodePages(t,e,r){return e.layerType==="Point"&&(t=e.pointNodePages),t==null||typeof t!="object"?null:US.fromJSON(t,r)}set elevationInfo(t){this._set("elevationInfo",t),this.loaded&&this._validateElevationInfo()}get effectiveCapabilities(){var t;return this._capabilitiesFromAssociatedFeatureLayer((t=this.associatedLayer)==null?void 0:t.effectiveCapabilities)}get effectiveEditingEnabled(){return this.associatedLayer!=null&&v9t(this.associatedLayer)}get geometryType(){return BVt[this.profile]||"mesh"}set renderer(t){Dme(t,this.fieldsIndex),this._set("renderer",t)}readCachedDrawingInfo(t){return t!=null&&typeof t=="object"||(t={}),t.color==null&&(t.color=!1),t}get capabilities(){var t;return this._capabilitiesFromAssociatedFeatureLayer((t=this.associatedLayer)==null?void 0:t.capabilities)}_capabilitiesFromAssociatedFeatureLayer(t){var E;t=t??f9t;const{query:e,queryRelated:r,editing:{supportsGlobalId:i,supportsRollbackOnFailure:n,supportsUploadWithItemId:s,supportsGeometryUpdate:o,supportsReturnServiceEditsInSourceSpatialReference:a},data:{supportsZ:l,supportsM:c,isVersioned:u,supportsAttachment:h},operations:{supportsEditing:p,supportsAdd:f,supportsUpdate:g,supportsDelete:y,supportsQuery:v,supportsQueryAttachments:b,supportsAsyncConvert3D:w}}=t,x=t.operations.supportsChangeTracking,S=!!((E=this.associatedLayer)!=null&&E.infoFor3D)&&ave();return{query:e,queryRelated:r,editing:{supportsGlobalId:i,supportsReturnServiceEditsInSourceSpatialReference:a,supportsRollbackOnFailure:n,supportsGeometryUpdate:S&&o,supportsUploadWithItemId:s},data:{supportsAttachment:h,supportsZ:l,supportsM:c,isVersioned:u},operations:{supportsQuery:v,supportsQueryAttachments:b,supportsEditing:p&&x,supportsAdd:S&&f&&x,supportsDelete:S&&y&&x,supportsUpdate:g&&x,supportsAsyncConvert3D:w}}}get editingEnabled(){var t;return this._isOverridden("editingEnabled")?this._get("editingEnabled"):((t=this.associatedLayer)==null?void 0:t.editingEnabled)??!1}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}get infoFor3D(){var t;return((t=this.associatedLayer)==null?void 0:t.infoFor3D)??null}get relationships(){var t;return(t=this.associatedLayer)==null?void 0:t.relationships}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(t,e){return!t&&e.fields&&e.fields.some(r=>(r.type==="esriFieldTypeOID"&&(t=r.name),!!t)),t||void 0}readGlobalIdField(t,e){return!t&&e.fields&&e.fields.some(r=>(r.type==="esriFieldTypeGlobalID"&&(t=r.name),!!t)),t||void 0}get displayField(){var t;return((t=this.associatedLayer)==null?void 0:t.displayField)??null}readProfile(t,e){const r=e.store.profile;return r!=null&&ESe[r]?ESe[r]:(K.getLogger(this).error("Unknown or missing profile",{profile:r,layer:this}),"mesh-pyramids")}load(t){return this.addResolvingPromise(this._load(t)),Promise.resolve(this)}async _load(t){const e=t!=null?t.signal:null;await this.loadFromPortal({supportedTypes:["Scene Service"]},t).catch(ko),await this._fetchService(e),await Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,e),this._setAssociatedFeatureLayer(e),this._loadFilterGeometries()]),this._validateElevationInfo(),this._applyAssociatedLayerOverrides(),this._populateFieldUsageInfo(),await Y9t(this,{origin:"service"},e),Dme(this.renderer,this.fieldsIndex),await this.finishLoadEditablePortalLayer(t)}async beforeSave(){this.filter!=null&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(t){K.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:t}),this.filter=null}}createQuery(){const t=new ec;return this.geometryType!=="mesh"&&(t.returnGeometry=!0,t.returnZ=!0),t.where=this.definitionExpression||"1=1",t.sqlFormat="standard",t.outFields=["*"],t}queryExtent(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryExtent(t||this.createQuery(),e))}queryFeatureCount(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatureCount(t||this.createQuery(),e))}queryFeatures(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatures(t||this.createQuery(),e)).then(r=>{if(r!=null&&r.features)for(const i of r.features)i.layer=this,i.sourceLayer=this;return r})}async queryRelatedFeatures(t,e){if(await this.load(),!this.associatedLayer)throw new B("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeatures(t,e)}async queryRelatedFeaturesCount(t,e){if(await this.load(),!this.associatedLayer)throw new B("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeaturesCount(t,e)}async queryCachedAttributes(t,e){const r=zct(this.fieldsIndex,await zVt(this,$Be(this)));return RBe(this.parsedUrl.path,this.attributeStorageInfo??[],t,e,r,this.apiKey,this.customParameters)}async queryCachedFeature(t,e){const r=await this.queryCachedAttributes(t,[e]);if(!r||r.length===0)throw new B("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const i=new Hu;return i.attributes=r[0],i.layer=this,i.sourceLayer=this,i}queryObjectIds(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryObjectIds(t||this.createQuery(),e))}queryAttachments(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryAttachments(t,e))}getFieldUsageInfo(t){const e={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[t]||e:(K.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),e)}createPopupTemplate(t){return SBe(this,t)}_getAssociatedLayerForQuery(){const t=this.associatedLayer;return t!=null&&t.loaded?Promise.resolve(t):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),!this.associatedLayer)throw new B("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(t){throw new B("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:t})}return this.associatedLayer}hasCachedStatistics(t){return this.statisticsInfo!=null&&this.statisticsInfo.some(e=>e.name===t)}async queryCachedStatistics(t,e){if(await this.load(e),!this.statisticsInfo)throw new B("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const r=this.fieldsIndex.get(t);if(!r)throw new B("scenelayer:field-unexisting",`Field '${t}' does not exist on the layer`);for(const i of this.statisticsInfo)if(i.name===r.name){const n=Nc(this.parsedUrl.path,i.href);return Vt(n,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e?e.signal:null}).then(s=>s.data)}throw new B("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")}async saveAs(t,e){return this._debouncedSaveOperations(CA.SAVE_AS,{...e,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},t)}async save(){const t={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(CA.SAVE,t)}async applyEdits(t,e){const{applyEdits:r}=await re(()=>import("./editingSupport-C0lgLa5s.js"),__vite__mapDeps([]));let i=e;await this.load();const n=this.associatedLayer;if(!n)throw new B(`${this.type}-layer:not-editable`,"Service is not editable");await n.load();const{globalIdField:s}=n,o=!!n.infoFor3D,a=(i==null?void 0:i.globalIdUsed)??!0;if(o&&s==null)throw new B(`${this.type}-layer:not-editable`,"Valid globalIdField expected on editable SceneLayer");if(o&&!a)throw new B(`${this.type}-layer:globalid-required`,"globalIdUsed must not be false for SceneLayer editing as globalIds are required.");return o9(n.url)&&o&&t.deleteFeatures!=null&&s!=null&&(i={...i,globalIdToObjectId:await fBe(n,t.deleteFeatures,s)}),r(this,n.source,t,i)}async uploadAssets(t,e){if(await this.load(),this.associatedLayer==null)throw new B(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),this.associatedLayer.uploadAssets(t,e)}on(t,e){return super.on(t,e)}async convertMesh(t,e){const r=u=>{throw K.getLogger(this).error(".convertMesh()",u.message),u};await this.load(),this.infoFor3D||r(new B("invalid:layer","SceneLayer has no capability for mesh conversion"));const i=await this.extractAndFilterFiles(t),n=i.reduce((u,h)=>Qtt(this.infoFor3D,h)?u+1:u,0);n===0&&r(new Pzt),n>1&&r(new Azt);const s=this.spatialReference,o=(e==null?void 0:e.location)??new He({x:0,y:0,z:0,spatialReference:s}),a=o.spatialReference.isGeographic?"local":"georeferenced",l=u7.createWithExternalSource(o,i,{vertexSpace:a}),[c]=await this.uploadAssets([l],e);return c}async extractAndFilterFiles(t){await this.load();const e=this.infoFor3D;return e?(await iVt(t)).filter(r=>Jtt(e,r)):t}validateLayer(t){if(t.layerType&&!VVt.has(t.layerType))throw new B("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:t.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new B("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new B("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function e(r,i){let n=!1,s=!1;if(r==null)n=!0,s=!0;else{const o=i&&i.isGeographic;switch(r){case"east-north-up":case"earth-centered":n=!0,s=o;break;case"vertex-reference-frame":n=!0,s=!o;break;default:n=!1}}if(!n)throw new B("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!s)throw new B("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}e(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const t=[];if(this.profile==="points")t.push("Point");else{if(this.profile!=="mesh-pyramids")throw new B("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);t.push("3DObject")}return t}_populateFieldUsageInfo(){var t,e;if(this._fieldUsageInfo={},this.fields)for(const r of this.fields){const i=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(o=>o.name===r.name)),n=!!((e=(t=this.associatedLayer)==null?void 0:t.fields)!=null&&e.some(o=>o&&r.name===o.name)),s={supportsLabelingInfo:i,supportsRenderer:i,supportsPopupTemplate:i||n,supportsLayerQuery:n};this._fieldUsageInfo[r.name]=s}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides(),this._applyAssociatedLayerExtentOverride(),this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){var e;if(!((e=this.associatedLayer)!=null&&e.fields))return;let t=null;for(const r of this.associatedLayer.fields){const i=this.getField(r.name);i?(!i.domain&&r.domain&&(i.domain=r.domain.clone()),i.editable=r.editable,i.nullable=r.nullable,i.length=r.length):(t||(t=this.fields?this.fields.slice():[]),t.push(r.clone()))}t&&this._set("fields",t)}_applyAssociatedLayerPopupOverrides(){if(!this.associatedLayer)return;const t=["popupTemplate","popupEnabled"],e=$s(this);for(let r=0;r<t.length;r++){const i=t[r],n=this.originIdOf(i),s=this.associatedLayer.originIdOf(i);n<s&&(s===We.SERVICE||s===We.PORTAL_ITEM)&&e.setAtOrigin(i,this.associatedLayer[i],s)}}_applyAssociatedLayerExtentOverride(){var i,n,s,o,a,l,c;const t=(n=(i=this.associatedLayer)==null?void 0:i.editingInfo)==null?void 0:n.lastEditDate,e=(s=this.associatedLayer)==null?void 0:s.serverGens,r=(o=this.associatedLayer)==null?void 0:o.getAtOrigin("fullExtent","service");!ave()||((a=this.associatedLayer)==null?void 0:a.infoFor3D)==null||!r||!o9((l=this.associatedLayer)==null?void 0:l.url)||!t||((c=this.serviceUpdateTimeStamp)==null?void 0:c.lastUpdate)===t.getTime()||!this.serviceUpdateTimeStamp&&(e==null?void 0:e.minServerGen)===(e==null?void 0:e.serverGen)||$s(this).setAtOrigin("fullExtent",r.clone(),We.SERVICE)}_applyAssociatedLayerPrivileges(){const t=this.associatedLayer;t&&(this._set("userHasEditingPrivileges",t.userHasEditingPrivileges),this._set("userHasFullEditingPrivileges",t.userHasFullEditingPrivileges),this._set("userHasUpdateItemPrivileges",t.userHasUpdateItemPrivileges))}async _setAssociatedFeatureLayer(t){if(["mesh-pyramids","points"].includes(this.profile))try{const{serverUrl:e,layerId:r,portalItem:i}=await u9t(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:t}),n=await O9t.FeatureLayer();this.associatedLayer=new n({url:e,customParameters:this.customParameters,layerId:r,portalItem:i}),await this.associatedLayer.load()}catch(e){on(e)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await qT(()=>this.popupEnabled&&this.popupTemplate!=null);const t=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?K.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${t}`):K.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${t}`)}_validateElevationInfo(){const t=this.elevationInfo;this.profile==="mesh-pyramids"&&cbe(K.getLogger(this),x$t("Mesh scene layers","relative-to-scene",t)),cbe(K.getLogger(this),S$t("Scene layers",t))}};d([m({types:{key:"type",base:hL,typeMap:{selection:b9t}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],Nt.prototype,"featureReduction",void 0),d([m({type:[ov],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],Nt.prototype,"rangeInfos",void 0),d([m({json:{read:!1}})],Nt.prototype,"associatedLayer",void 0),d([m({type:["show","hide"]})],Nt.prototype,"listMode",void 0),d([m({type:["ArcGISSceneServiceLayer"]})],Nt.prototype,"operationalLayerType",void 0),d([m({json:{read:!1},readOnly:!0})],Nt.prototype,"type",void 0),d([m({...TSe.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Nt.prototype,"fields",void 0),d([m()],Nt.prototype,"types",null),d([m()],Nt.prototype,"typeIdField",null),d([m()],Nt.prototype,"templates",null),d([m()],Nt.prototype,"formTemplate",null),d([m({readOnly:!0,clonable:!1})],Nt.prototype,"fieldsIndex",null),d([m({type:_Be,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Nt.prototype,"floorInfo",void 0),d([m(TSe.outFields)],Nt.prototype,"outFields",void 0),d([m({type:US,readOnly:!0,json:{read:!1}})],Nt.prototype,"nodePages",void 0),d([Xe("service","nodePages",["nodePages","pointNodePages"])],Nt.prototype,"readNodePages",null),d([m({type:[xd],readOnly:!0})],Nt.prototype,"materialDefinitions",void 0),d([m({type:[X$],readOnly:!0})],Nt.prototype,"textureSetDefinitions",void 0),d([m({type:[J$],readOnly:!0})],Nt.prototype,"geometryDefinitions",void 0),d([m({readOnly:!0})],Nt.prototype,"serviceUpdateTimeStamp",void 0),d([m({readOnly:!0})],Nt.prototype,"attributeStorageInfo",void 0),d([m({readOnly:!0})],Nt.prototype,"statisticsInfo",void 0),d([m({type:St.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],Nt.prototype,"excludeObjectIds",void 0),d([m({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Nt.prototype,"definitionExpression",void 0),d([m({type:W9t,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],Nt.prototype,"filter",void 0),d([m({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Nt.prototype,"path",void 0),d([m(Vzt)],Nt.prototype,"elevationInfo",null),d([m({readOnly:!0,json:{read:!1}})],Nt.prototype,"effectiveCapabilities",null),d([m({readOnly:!0})],Nt.prototype,"effectiveEditingEnabled",null),d([m({type:String})],Nt.prototype,"geometryType",null),d([m(Uzt)],Nt.prototype,"labelsVisible",void 0),d([m({type:[fue],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:_Se},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:_Se},write:!0}})],Nt.prototype,"labelingInfo",void 0),d([m(zzt)],Nt.prototype,"legendEnabled",void 0),d([m({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(t,e){var i,n;if(typeof t=="number"&&t>=0&&t<=1)return t;const r=(n=(i=e.layerDefinition)==null?void 0:i.drawingInfo)==null?void 0:n.transparency;return r!==void 0?NP(r):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],Nt.prototype,"opacity",void 0),d([m({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Nt.prototype,"priority",void 0),d([m({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Nt.prototype,"semantic",void 0),d([m({types:BVe,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],Nt.prototype,"renderer",null),d([m({json:{read:!1}})],Nt.prototype,"cachedDrawingInfo",void 0),d([Xe("service","cachedDrawingInfo")],Nt.prototype,"readCachedDrawingInfo",null),d([m({readOnly:!0,json:{read:!1}})],Nt.prototype,"capabilities",null),d([m({type:Boolean,json:{read:!1}})],Nt.prototype,"editingEnabled",null),d([m({readOnly:!0,json:{write:!1,read:!1}})],Nt.prototype,"infoFor3D",null),d([m({readOnly:!0,json:{write:!1,read:!1}})],Nt.prototype,"relationships",null),d([m(QVe)],Nt.prototype,"popupEnabled",void 0),d([m({type:D7,json:{name:"popupInfo",write:!0}})],Nt.prototype,"popupTemplate",void 0),d([m({readOnly:!0,json:{read:!1}})],Nt.prototype,"defaultPopupTemplate",null),d([m({type:String,json:{read:!1}})],Nt.prototype,"objectIdField",void 0),d([Xe("service","objectIdField",["objectIdField","fields"])],Nt.prototype,"readObjectIdField",null),d([m({type:String,json:{read:!1}})],Nt.prototype,"globalIdField",void 0),d([Xe("service","globalIdField",["globalIdField","fields"])],Nt.prototype,"readGlobalIdField",null),d([m({readOnly:!0,type:String,json:{read:!1}})],Nt.prototype,"displayField",null),d([m({type:String,json:{read:!1}})],Nt.prototype,"profile",void 0),d([Xe("service","profile",["store.profile"])],Nt.prototype,"readProfile",null),d([m({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],Nt.prototype,"normalReferenceFrame",void 0),d([m(kzt)],Nt.prototype,"screenSizePerspectiveEnabled",void 0),d([m({json:{read:!1,origins:{service:{read:!0}}}})],Nt.prototype,"serviceItemId",void 0),Nt=d([F("esri.layers.SceneLayer")],Nt);const ESe={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},BVt={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},IBe=Nt,GVt=Object.freeze(Object.defineProperty({__proto__:null,default:IBe},Symbol.toStringTag,{value:"Module"}));let jVt=class{constructor(e,r=0,i=e.lods[e.lods.length-1].level){this.tileInfo=e,this.minLOD=r,this.maxLOD=i,e.lodAt(r)||(this.minLOD=e.lods[0].level),e.lodAt(i)||(this.maxLOD=e.lods[e.lods.length-1].level)}get effectiveMinLOD(){return this.minLOD??this.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}getAvailability(e,r,i){var s;const n=(s=this.tileInfo)==null?void 0:s.lodAt(e);return!n||e<this.minLOD||e>this.maxLOD?"unavailable":n.cols&&n.rows?i>=n.cols[0]&&i<=n.cols[1]&&r>=n.rows[0]&&r<=n.rows[1]?"unknown":"unavailable":"unknown"}async fetchAvailability(e,r,i,n){await YU(n);const s=this.getAvailability(e,r,i);if(s==="unavailable")throw new B("tile-map:tile-unavailable","Tile is not available",{level:e,row:r,col:i});return s}async fetchAvailabilityUpsample(e,r,i,n,s){await YU(s),n.level=e,n.row=r,n.col=i;const o=this.tileInfo;return o.updateTileInfo(n),this.fetchAvailability(e,r,i,s).catch(a=>{if(on(a))throw a;if(o.upsampleTile(n))return this.fetchAvailabilityUpsample(n.level,n.row,n.col,n,s);throw a})}};function HVt(t,e=!1){return t<=Vu?e?new Array(t).fill(0):new Array(t):new Uint32Array(t)}let CSe=class Qre{constructor(e){this._validateJSON(e);const{location:r,data:i}=e;this.location=Object.freeze(ae(r));const n=this.location.width,s=this.location.height;let o=!0,a=!0;const l=Math.ceil(n*s/32),c=HVt(l);let u=0;for(let h=0;h<i.length;h++){const p=h%32;i[h]?(a=!1,c[u]|=1<<p):o=!1,p===31&&++u}a?(this._availability="unavailable",this.byteSize=40):o?(this._availability="available",this.byteSize=40):(this._availability=c,this.byteSize=40+i_(c))}getAvailability(e,r){if(this._availability==="unavailable"||this._availability==="available")return this._availability;const i=(e-this.location.top)*this.location.width+(r-this.location.left),n=i%32,s=i>>5,o=this._availability;return s<0||s>o.length?"unknown":o[s]&1<<n?"available":"unavailable"}static fromDefinition(e,r){const i=e.service.request||Vt,{row:n,col:s,width:o,height:a}=e,l={query:{f:"json"}};return r=r?{...l,...r}:l,i(qVt(e),r).then(c=>c.data).catch(c=>{if(c&&c.details&&c.details.httpStatus===422)return{location:{top:n,left:s,width:o,height:a},valid:!0,data:dHe(o*a,0)};throw c}).then(c=>{if(c.location&&(c.location.top!==n||c.location.left!==s||c.location.width!==o||c.location.height!==a))throw new B("tilemap:location-mismatch","Tilemap response for different location than requested",{response:c,definition:{top:n,left:s,width:o,height:a}});return Qre.fromJSON(c)})}static fromJSON(e){return Object.freeze(new Qre(e))}_validateJSON(e){if(!(e!=null&&e.location))throw new B("tilemap:missing-location","Location missing from tilemap response");if(e.valid===!1)throw new B("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new B("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new B("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new B("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}};function PSe(t){return`${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}function qVt(t){var i;let e;if((i=t.service.tileServers)!=null&&i.length){const n=t.service.tileServers;e=`${n&&n.length?n[t.row%n.length]:t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}else e=`${t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`;const r=t.service.query;return r&&(e=`${e}?${r}`),e}var zS;let vg=zS=class extends Pe{constructor(t){super(t),this._pendingTilemapRequests={},this.request=Vt,this.size=32,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new Jle(2*oV.MEGABYTES),this.addHandles(pe(()=>{const{layer:t}=this;return[t==null?void 0:t.parsedUrl,t==null?void 0:t.tileServers,t==null?void 0:t.apiKey,t==null?void 0:t.customParameters]},()=>this._initializeTilemapDefinition(),mi))}get effectiveMinLOD(){return this.minLOD??this.layer.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}fetchTilemap(t,e,r,i){if(!this.layer.tileInfo.lodAt(t)||t<this.effectiveMinLOD||t>this.effectiveMaxLOD)return Promise.reject(new B("tilemap-cache:level-unavailable",`Level ${t} is unavailable in the service`));const n=this._tmpTilemapDefinition,s=this._tilemapFromCache(t,e,r,n);if(s)return Promise.resolve(s);const o=i==null?void 0:i.signal;return i={...i,signal:null},new Promise((a,l)=>{la(o,()=>l(gr()));const c=PSe(n);let u=this._pendingTilemapRequests[c];if(!u){u=CSe.fromDefinition(n,i).then(p=>(this._tilemapCache.put(c,p,p.byteSize),p));const h=()=>{delete this._pendingTilemapRequests[c]};this._pendingTilemapRequests[c]=u,u.then(h,h)}u.then(a,l)})}getAvailability(t,e,r){if(!this.layer.tileInfo.lodAt(t)||t<this.effectiveMinLOD||t>this.effectiveMaxLOD)return"unavailable";const i=this._tilemapFromCache(t,e,r,this._tmpTilemapDefinition);return i?i.getAvailability(e,r):"unknown"}fetchAvailability(t,e,r,i){return!this.layer.tileInfo.lodAt(t)||t<this.effectiveMinLOD||t>this.effectiveMaxLOD?Promise.reject(new B("tile-map:tile-unavailable","Tile is not available",{level:t,row:e,col:r})):this.fetchTilemap(t,e,r,i).catch(n=>n).then(n=>{if(n instanceof CSe){const s=n.getAvailability(e,r);if(s==="unavailable")throw new B("tile-map:tile-unavailable","Tile is not available",{level:t,row:e,col:r});return s}if(on(n))throw n;return"unknown"})}fetchAvailabilityUpsample(t,e,r,i,n){i.level=t,i.row=e,i.col=r;const s=this.layer.tileInfo;s.updateTileInfo(i);const o=this.fetchAvailability(t,e,r,n).catch(a=>{if(on(a))throw a;if(s.upsampleTile(i))return this.fetchAvailabilityUpsample(i.level,i.row,i.col,i,n);throw a});return this._fetchAvailabilityUpsamplePrefetch(i.id,t,e,r,n,o),o}async _fetchAvailabilityUpsamplePrefetch(t,e,r,i,n,s){if(!this._prefetchingEnabled||t==null)return;const o=`prefetch-${t}`;if(this.hasHandles(o))return;const a=new AbortController;s.then(()=>a.abort(),()=>a.abort());let l=!1;const c=ri(()=>{l||(l=!0,a.abort())});if(this.addHandles(c,o),await mqe(10,a.signal).catch(()=>{}),l||(l=!0,this.removeHandles(o)),Ms(a))return;const u=new iIe(t,e,r,i),h={...n,signal:a.signal},p=this.layer.tileInfo;for(let f=0;zS._prefetches.length<zS._maxPrefetch&&p.upsampleTile(u);++f){const g=this.fetchAvailability(u.level,u.row,u.col,h);zS._prefetches.push(g);const y=()=>{zS._prefetches.removeUnordered(g)};g.then(y,y)}}_initializeTilemapDefinition(){var i;if(!this.layer.parsedUrl)return;const{parsedUrl:t,apiKey:e,customParameters:r}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:t.path,query:_b({...t.query,...r,token:e??((i=t.query)==null?void 0:i.token)}),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(t,e,r,i){i.level=t,i.row=e-e%this.size,i.col=r-r%this.size;const n=PSe(i);return this._tilemapCache.get(n)}get test(){const t=this;return{get prefetchingEnabled(){return t._prefetchingEnabled},set prefetchingEnabled(e){t._prefetchingEnabled=e},hasTilemap:(e,r,i)=>!!t._tilemapFromCache(e,r,i,t._tmpTilemapDefinition)}}};vg._maxPrefetch=4,vg._prefetches=new jt({initialSize:zS._maxPrefetch}),d([m({constructOnly:!0})],vg.prototype,"layer",void 0),d([m({constructOnly:!0})],vg.prototype,"minLOD",void 0),d([m({constructOnly:!0})],vg.prototype,"maxLOD",void 0),d([m({constructOnly:!0})],vg.prototype,"request",void 0),d([m({constructOnly:!0})],vg.prototype,"size",void 0),vg=zS=d([F("esri.layers.support.TilemapCache")],vg);const WVt=t=>{let e=class extends t{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}destroy(){var r,i;(i=(r=this.tilemapCache)==null?void 0:r.destroy)==null||i.call(r)}readMinScale(r,i){return i.minLOD!=null&&i.maxLOD!=null?r:0}readMaxScale(r,i){return i.minLOD!=null&&i.maxLOD!=null?r:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(r,i,n){var u;const s=(u=i.capabilities)==null?void 0:u.includes("Tilemap");let{minLOD:o,maxLOD:a,minScale:l,maxScale:c}=i;if(o==null&&a==null&&l!==0&&c!==0){const h=p=>Math.round(1e4*p)/1e4;l=h(l||i.tileInfo.lods[0].scale),c=h(c||i.tileInfo.lods[i.tileInfo.lods.length-1].scale);for(const p of i.tileInfo.lods){const f=h(p.scale);o=f>=l?p.level:o,a=f>=c?p.level:a}}if(s)return new vg({layer:this,minLOD:o,maxLOD:a});if(i.tileInfo){const h=new J3;return h.read(i.tileInfo,n),new jVt(h,o,a)}return null}};return d([m({json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0),d([m()],e.prototype,"minScale",void 0),d([Xe("service","minScale")],e.prototype,"readMinScale",null),d([m()],e.prototype,"maxScale",void 0),d([Xe("service","maxScale")],e.prototype,"readMaxScale",null),d([m({type:Ve})],e.prototype,"spatialReference",void 0),d([m({readOnly:!0})],e.prototype,"supportsBlankTile",null),d([m({type:J3})],e.prototype,"tileInfo",void 0),d([m()],e.prototype,"tilemapCache",void 0),d([Xe("service","tilemapCache",["capabilities","tileInfo"])],e.prototype,"readTilemapCache",null),d([m()],e.prototype,"version",void 0),e=d([F("esri.layers.mixins.ArcGISCachedService")],e),e},YVt=t=>{let e=class extends t{constructor(){super(...arguments),this.capabilities=void 0,this.copyright=null,this.fullExtent=null,this.legendEnabled=!0,this.spatialReference=null,this.version=void 0,this._allLayersAndTablesMap=null}readCapabilities(r,i){const n=i.capabilities&&i.capabilities.split(",").map(w=>w.toLowerCase().trim());if(!n)return{operations:{supportsExportMap:!1,supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};const s=this.type,o=s!=="tile"&&!!i.supportsDynamicLayers,a=n.includes("query"),l=n.includes("map"),c=!!i.exportTilesAllowed,u=n.includes("tilemap"),h=n.includes("data"),p=s!=="tile"&&(!i.tileInfo||o),f=s!=="tile"&&(!i.tileInfo||o),g=s!=="tile",y=i.cimVersion&&pO.parse(i.cimVersion),v=(y==null?void 0:y.since(1,4))??!1,b=(y==null?void 0:y.since(2,0))??!1;return{operations:{supportsExportMap:l,supportsExportTiles:c,supportsIdentify:a,supportsQuery:h,supportsTileMap:u},exportMap:l?{supportsArcadeExpressionForLabeling:v,supportsSublayersChanges:g,supportsDynamicLayers:o,supportsSublayerVisibility:p,supportsSublayerDefinitionExpression:f,supportsCIMSymbols:b}:null,exportTiles:c?{maxExportTilesCount:+i.maxExportTilesCount}:null}}readVersion(r,i){let n=i.currentVersion;return n||(n=i.hasOwnProperty("capabilities")||i.hasOwnProperty("tables")?10:i.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3),n}async fetchRelatedService(r){const i=this.portalItem;if(!i||!cSe(i))return null;this._relatedFeatureServicePromise||(this._relatedFeatureServicePromise=i.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},r).then(s=>s.find(o=>o.type==="Feature Service")??null,()=>null));const n=await this._relatedFeatureServicePromise;return dt(r),n?{itemId:n.id,url:n.url}:null}async fetchSublayerInfo(r,i){var a;const{source:n}=r;if(this!=null&&this.portalItem&&this.type==="tile"&&(n==null?void 0:n.type)==="map-layer"&&cSe(this.portalItem)&&r.originIdOf("url")<We.SERVICE){const l=await this.fetchRelatedService(i);l&&(r.url=Nc(l.url,n.mapLayerId.toString()),r.layerItemId=l.itemId)}const{url:s}=r;let o;if(n.type==="data-layer")o=(await Vt(s,{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey},...i})).data;else if(s&&r.originIdOf("url")>We.SERVICE)try{const l=await this._fetchAllLayersAndTablesFromService(s),c=((a=fm(s))==null?void 0:a.sublayer)??n.mapLayerId;o=l.get(c)}catch{}else{let l=r.id;(n==null?void 0:n.type)==="map-layer"&&(l=n.mapLayerId);try{o=(await this.fetchAllLayersAndTables(i)).get(l)}catch{}}return o}async fetchAllLayersAndTables(r){var i;return this._fetchAllLayersAndTablesFromService((i=this.parsedUrl)==null?void 0:i.path,r)}async _fetchAllLayersAndTablesFromService(r,i){await this.load(i),this._allLayersAndTablesMap||(this._allLayersAndTablesMap=new Map);const n=fm(r),s=rN(this._allLayersAndTablesMap,n==null?void 0:n.url.path,()=>Vt(Nc(n==null?void 0:n.url.path,"/layers"),{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(a=>{const l=new Map;for(const c of a.data.layers)l.set(c.id,c);return{result:l}},a=>({error:a}))),o=await s;if(dt(i),"result"in o)return o.result;throw o.error}};return d([m({readOnly:!0})],e.prototype,"capabilities",void 0),d([Xe("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],e.prototype,"readCapabilities",null),d([m({json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0),d([m({type:br})],e.prototype,"fullExtent",void 0),d([m(tBe)],e.prototype,"id",void 0),d([m({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],e.prototype,"legendEnabled",void 0),d([m(QVe)],e.prototype,"popupEnabled",void 0),d([m({type:Ve})],e.prototype,"spatialReference",void 0),d([m({readOnly:!0})],e.prototype,"version",void 0),d([Xe("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],e.prototype,"readVersion",null),e=d([F("esri.layers.mixins.ArcGISMapService")],e),e};function LBe(t){const e={};for(const r in t){if(r==="declaredClass")continue;const i=t[r];if(i!=null&&typeof i!="function")if(Array.isArray(i)){e[r]=[];for(let n=0;n<i.length;n++)e[r][n]=LBe(i[n])}else typeof i=="object"?i.toJSON&&(e[r]=JSON.stringify(i)):e[r]=i}return e}var xv;(function(t){t[t.varint=0]="varint",t[t.fixed64=1]="fixed64",t[t.delimited=2]="delimited",t[t.fixed32=5]="fixed32",t[t.unknown=99]="unknown"})(xv||(xv={}));const ASe=4294967296,XVt=new TextDecoder("utf-8"),ZVt=ne("safari")||ne("ios")?6:ne("ff")?12:32;let Kre=class hU{constructor(e,r,i=0,n=e?e.byteLength:0){this._tag=0,this._dataType=xv.unknown,this._init(e,r,i,n)}_init(e,r,i,n){this._data=e,this._dataView=r,this._pos=i,this._end=n}asUnsafe(){return this}clone(){return new hU(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const r=this._decodeVarint();if(this._tag=r>>3,this._dataType=7&r,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;if(e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128||(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)||(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)||(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)||(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128))return e;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)|0}getSInt64(){return this._decodeSVarint()}getBool(){const e=this._data[this._pos]!==0;return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,r=this._pos,i=e.getUint32(r,!0)+e.getUint32(r+4,!0)*ASe;return this._skip(8),i}getSFixed64(){const e=this._dataView,r=this._pos,i=e.getUint32(r,!0)+e.getInt32(r+4,!0)*ASe;return this._skip(8),i}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),r=this._pos,i=this._toString(this._data,r,r+e);return this._skip(e),i}getBytes(){const e=this._getLength(),r=this._pos,i=this._toBytes(this._data,r,r+e);return this._skip(e),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,r,i,n){const s=this.getMessage(),o=e(s,r,i,n);return s.release(),o}processMessage(e){const r=this.getMessage(),i=e(r);return r.release(),i}getMessage(){const e=this._getLength(),r=hU.pool.acquire();return r._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),r}release(){hU.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case xv.varint:this._decodeVarint();break;case xv.fixed64:this._skip(8);break;case xv.delimited:this._skip(this._getLength());break;case xv.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let r=this._pos,i=0,n=0;if(this._end-r>=10)do{if(n=e[r++],i|=127&n,(128&n)==0||(n=e[r++],i|=(127&n)<<7,(128&n)==0)||(n=e[r++],i|=(127&n)<<14,(128&n)==0)||(n=e[r++],i|=(127&n)<<21,(128&n)==0)||(n=e[r++],i+=268435456*(127&n),(128&n)==0)||(n=e[r++],i+=34359738368*(127&n),(128&n)==0)||(n=e[r++],i+=4398046511104*(127&n),(128&n)==0)||(n=e[r++],i+=562949953421312*(127&n),(128&n)==0)||(n=e[r++],i+=72057594037927940*(127&n),(128&n)==0)||(n=e[r++],i+=9223372036854776e3*(127&n),(128&n)==0))break;throw new Error("Varint too long!")}while(!1);else{let s=1;for(;r!==this._end&&(n=e[r],(128&n)!=0);)++r,i+=(127&n)*s,s*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=n*s}return this._pos=r,i}_decodeSVarint(){const e=this._data;let r,i=0,n=0;const s=1&e[this._pos];if(n=e[this._pos++],i|=127&n,(128&n)==0||(n=e[this._pos++],i|=(127&n)<<7,(128&n)==0)||(n=e[this._pos++],i|=(127&n)<<14,(128&n)==0)||(n=e[this._pos++],i|=(127&n)<<21,(128&n)==0)||(n=e[this._pos++],i+=268435456*(127&n),(128&n)==0)||(n=e[this._pos++],i+=34359738368*(127&n),(128&n)==0)||(n=e[this._pos++],i+=4398046511104*(127&n),(128&n)==0))return s?-(i+1)/2:i/2;if(r=BigInt(i),n=e[this._pos++],r+=0x2000000000000n*BigInt(127&n),(128&n)==0||(n=e[this._pos++],r+=0x100000000000000n*BigInt(127&n),(128&n)==0)||(n=e[this._pos++],r+=0x8000000000000000n*BigInt(127&n),(128&n)==0))return Number(s?-(r+1n)/2n:r/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==xv.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,r,i){if((i=Math.min(this._end,i))-r>ZVt){const o=e.subarray(r,i);return XVt.decode(o)}let n="",s="";for(let o=r;o<i;++o){const a=e[o];128&a?s+="%"+a.toString(16):(n+=decodeURIComponent(s)+String.fromCharCode(a),s="")}return s.length&&(n+=decodeURIComponent(s)),n}_toBytes(e,r,i){return i=Math.min(this._end,i),new Uint8Array(e.buffer,r,i-r)}};Kre.pool=new fa(Kre,void 0,t=>{t._data=null,t._dataView=null});const DBe=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];let Sfr=class{constructor(e){this._options=e,this.geometryTypes=DBe,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new wFe}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!(e!=null&&e.features)||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||yo(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const r=zT(this._options.sourceSpatialReference)/zT(e.spatialReference);if(r!==1)for(const i of e.features){if(!gwt(i))continue;const n=i.geometry.coords;for(let s=2;s<n.length;s+=3)n[s]*=r}}addFeature(e,r){e.features.push(r)}createFeature(){return new o2}createSpatialReference(){return{wkid:0}}createGeometry(){return new zc}addField(e,r){e.fields.push(r)}allocateCoordinates(e){e.coords.length=e.lengths.reduce((r,i)=>r+i,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,r){e.coords[this._coordinatePtr++]=r}addCoordinatePoint(e,r){e.coords.push(r)}addLength(e,r){e.lengths.push(r)}addQueryGeometry(e,r){e.queryGeometry=r.queryGeometry,e.queryGeometryType=r.queryGeometryType}createPointGeometry(){return new zc}};const OSe=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],MSe=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],RSe=["upperLeft","lowerLeft"];function $Se(t){return t>=OSe.length?null:OSe[t]}function JVt(t){return t>=MSe.length?null:MSe[t]}function ISe(t){return t>=RSe.length?null:RSe[t]}function LSe(t,e){return e>=t.geometryTypes.length?null:t.geometryTypes[e]}function QVt(t,e,r){const n=t.asUnsafe(),s=e.createPointGeometry(r);for(;n.next();)switch(n.tag()){case 3:{const o=n.getUInt32(),a=n.pos()+o;let l=0;for(;n.pos()<a;)e.addCoordinatePoint(s,n.getSInt64(),l++);break}default:n.skip()}return s}function KVt(t,e,r){const s=t.asUnsafe(),o=e.createGeometry(r),a=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;s.next();)switch(s.tag()){case 2:{const l=s.getUInt32(),c=s.pos()+l;let u=0;for(;s.pos()<c;)e.addLength(o,s.getUInt32(),u++);break}case 3:{const l=s.getUInt32(),c=s.pos()+l;let u=0;for(e.allocateCoordinates(o);s.pos()<c;)e.addCoordinate(o,s.getSInt64(),u),u++,u===a&&(u=0);break}default:s.skip()}return o}function eBt(t){const n=t.asUnsafe(),s=new zc;let o="esriGeometryPoint";for(;n.next();)switch(n.tag()){case 2:{const a=n.getUInt32(),l=n.pos()+a;for(;n.pos()<l;)s.lengths.push(n.getUInt32());break}case 3:{const a=n.getUInt32(),l=n.pos()+a;for(;n.pos()<l;)s.coords.push(n.getSInt64());break}case 1:o=DBe[n.getEnum()];break;default:n.skip()}return{queryGeometry:s,queryGeometryType:o}}function tBt(t){const u=t.asUnsafe();for(;u.next();)switch(u.tag()){case 1:return u.getString();case 2:return u.getFloat();case 3:return u.getDouble();case 4:return u.getSInt32();case 5:return u.getUInt32();case 6:return u.getInt64();case 7:return u.getUInt64();case 8:return u.getSInt64();case 9:return u.getBool();default:return u.skip(),null}return null}function rBt(t){const a=t.asUnsafe(),l={type:$Se(0)};for(;a.next();)switch(a.tag()){case 1:l.name=a.getString();break;case 2:l.type=$Se(a.getEnum());break;case 3:l.alias=a.getString();break;case 4:l.sqlType=JVt(a.getEnum());break;case 5:a.skip();break;case 6:l.defaultValue=a.getString();break;default:a.skip()}return l}function iBt(t){const i={},n=t.asUnsafe();for(;n.next();)switch(n.tag()){case 1:i.name=n.getString();break;case 2:i.isSystemMaintained=n.getBool();break;default:n.skip()}return i}function nBt(t,e,r,i){const a=e.createFeature(r);let l=0;for(;t.next();)switch(t.tag()){case 1:{const c=i[l++].name;a.attributes[c]=t.processMessage(tBt);break}case 2:a.geometry=t.processMessageWithArgs(KVt,e,r);break;case 4:a.centroid=t.processMessageWithArgs(QVt,e,r);break;default:t.skip()}return a}function sBt(t){const s=[1,1,1,1],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:s[0]=o.getDouble();break;case 2:s[1]=o.getDouble();break;case 4:s[2]=o.getDouble();break;case 3:s[3]=o.getDouble();break;default:o.skip()}return s}function oBt(t){const s=[0,0,0,0],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:s[0]=o.getDouble();break;case 2:s[1]=o.getDouble();break;case 4:s[2]=o.getDouble();break;case 3:s[3]=o.getDouble();break;default:o.skip()}return s}function aBt(t){const n={originPosition:ISe(0)},s=t.asUnsafe();for(;s.next();)switch(s.tag()){case 1:n.originPosition=ISe(s.getEnum());break;case 2:n.scale=s.processMessage(sBt);break;case 3:n.translate=s.processMessage(oBt);break;default:s.skip()}return n}function lBt(t){const n={},s=t.asUnsafe();for(;s.next();)switch(s.tag()){case 1:n.shapeAreaFieldName=s.getString();break;case 2:n.shapeLengthFieldName=s.getString();break;case 3:n.units=s.getString();break;default:s.skip()}return n}function cBt(t,e){const a=e.createSpatialReference();for(;t.next();)switch(t.tag()){case 1:a.wkid=t.getUInt32();break;case 5:a.wkt=t.getString();break;case 2:a.latestWkid=t.getUInt32();break;case 3:a.vcsWkid=t.getUInt32();break;case 4:a.latestVcsWkid=t.getUInt32();break;default:t.skip()}return a}function uBt(t,e){const y=e.createFeatureResult(),v=t.asUnsafe();y.geometryType=LSe(e,0);let b=!1;for(;v.next();)switch(v.tag()){case 1:y.objectIdFieldName=v.getString();break;case 3:y.globalIdFieldName=v.getString();break;case 4:y.geohashFieldName=v.getString();break;case 5:y.geometryProperties=v.processMessage(lBt);break;case 7:y.geometryType=LSe(e,v.getEnum());break;case 8:y.spatialReference=v.processMessageWithArgs(cBt,e);break;case 10:y.hasZ=v.getBool();break;case 11:y.hasM=v.getBool();break;case 12:y.transform=v.processMessage(aBt);break;case 9:y.exceededTransferLimit=v.getBool();break;case 13:e.addField(y,v.processMessage(rBt));break;case 15:b||(e.prepareFeatures(y),b=!0),e.addFeature(y,v.processMessageWithArgs(nBt,e,y,y.fields));break;case 2:y.uniqueIdField=v.processMessage(iBt);break;default:v.skip()}return e.finishFeatureResult(y),y}function hBt(t,e){const n={};let s=null;for(;t.next();)switch(t.tag()){case 4:s=t.processMessageWithArgs(eBt);break;case 1:n.featureResult=t.processMessageWithArgs(uBt,e);break;default:t.skip()}return s!=null&&n.featureResult&&e.addQueryGeometry(n,s),n}function dBt(t,e){try{const i=new Kre(new Uint8Array(t),new DataView(t)),n={};for(;i.next();)i.tag()===2?n.queryResult=i.processMessageWithArgs(hBt,e):i.skip();return n}catch(r){throw new B("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:r})}}function pBt(t,e){const r=dBt(t,e),i=r.queryResult.featureResult,n=r.queryResult.queryGeometry,s=r.queryResult.queryGeometryType;if(i&&i.features&&i.features.length&&i.objectIdFieldName){const o=i.objectIdFieldName;for(const a of i.features)a.attributes&&(a.objectId=a.attributes[o])}return i&&(i.queryGeometry=n,i.queryGeometryType=s),i}function fBt(t,e,r){if(!(r!=null&&r.features)||!r.hasZ)return;const i=Ise(r.geometryType,e,t.outSpatialReference);if(i!=null)for(const n of r.features)i(n.geometry)}const DSe="Layer does not support extent calculation.";function mBt(t,e){if(e&&t.type==="extent")return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&t.type==="point")return`${t.x},${t.y}`;const r=t.toJSON();return delete r.spatialReference,JSON.stringify(r)}function gBt(t,e){var l;const r=t.geometry,i=t.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const n=i;let s,o,a;if(r!=null&&(o=r.spatialReference,a=AP(o),n.geometryType=BA(r),n.geometry=mBt(r,t.compactGeometryEnabled),n.inSR=a),i.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),!i.outFields||!i.returnDistinctValues&&(e!=null&&e.returnCountOnly||e!=null&&e.returnExtentOnly||e!=null&&e.returnIdsOnly)?delete n.outFields:i.outFields.includes("*")?n.outFields="*":n.outFields=i.outFields.join(","),i.outSR?(n.outSR=AP(i.outSR),s=t.outSpatialReference):r&&(i.returnGeometry||i.returnCentroid)&&(n.outSR=n.inSR,s=o),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(n.outStatistics=JSON.stringify(i.outStatistics)),i.fullText&&(n.fullText=JSON.stringify(i.fullText)),i.pixelSize&&(n.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&o!=null&&((l=t.quantizationParameters)==null?void 0:l.extent)!=null&&o.equals(t.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,n.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(n.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(n.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(n.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const c=i.timeExtent,{start:u,end:h}=c;u==null&&h==null||(n.time=u===h?u:`${u??"null"},${h??"null"}`),delete i.timeExtent}return t.defaultSpatialReferenceEnabled&&o!=null&&s!=null&&o.equals(s)&&(n.defaultSR=n.inSR,delete n.inSR,delete n.outSR),n}async function yBt(t,e,r,i){const n=e.timeExtent!=null&&e.timeExtent.isEmpty?{data:{features:[]}}:await i4(t,e,"json",i);return fBt(e,r,n.data),n}async function _Bt(t,e,r,i){if(e.timeExtent!=null&&e.timeExtent.isEmpty)return{data:r.createFeatureResult()};const n=await vBt(t,e,i),s=n;return s.data=pBt(n.data,r),s}function vBt(t,e,r){return i4(t,e,"pbf",r)}function bBt(t,e,r){return e.timeExtent!=null&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):i4(t,e,"json",r,{returnIdsOnly:!0})}function wBt(t,e,r){return e.timeExtent!=null&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):i4(t,e,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}async function xBt(t,e,r){if(e.timeExtent!=null&&e.timeExtent.isEmpty)return{data:{count:0,extent:null}};const i=await i4(t,e,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}),n=i.data;if(n.hasOwnProperty("extent"))return i;if(n.features)throw new Error(DSe);if(n.hasOwnProperty("count"))throw new Error(DSe);return i}async function i4(t,e,r,i={},n={}){const s=typeof t=="string"?xs(t):t,o=e.geometry?[e.geometry]:[],a=await Sze(o,null,{signal:i.signal}),l=a==null?void 0:a[0];l!=null&&((e=e.clone()).geometry=l);const c=LBe({...s.query,f:r,...n,...gBt(e,n)});return Vt(Nc(s.path,SBt(e,n)?"query3d":"query"),{...i,responseType:r==="pbf"?"array-buffer":"json",query:{...c,...i.query}})}function SBt(t,e){return t.formatOf3DObjects!=null&&!(e.returnCountOnly||e.returnExtentOnly||e.returnIdsOnly)}async function TBt(t,e,r){const i=D_(t);return wBt(i,ec.from(e),{...r}).then(n=>n.data.count)}async function EBt(t,e,r){const i=D_(t),n=await xBt(i,ec.from(e),{...r}),s=n.data.extent;return!s||isNaN(s.xmin)||isNaN(s.ymin)||isNaN(s.xmax)||isNaN(s.ymax)?{count:n.data.count,extent:null}:{count:n.data.count,extent:br.fromJSON(s)}}async function CBt(t,e,r){const i=D_(t);return bBt(i,ec.from(e),{...r}).then(n=>n.data.objectIds)}var eie;const tie=new Ii({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Ca=eie=class extends Se{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){var n;const r=Ve.fromJSON(e.spatialReference),i=[];for(let s=0;s<t.length;s++){const o=t[s],a=Hu.fromJSON(o),l=(n=o.geometry)==null?void 0:n.spatialReference;a.geometry==null||l||(a.geometry.spatialReference=r);const c=o.aggregateGeometries,u=a.aggregateGeometries;if(c&&u!=null)for(const h in u){const p=u[h],f=c[h],g=f==null?void 0:f.spatialReference;p==null||g||(p.spatialReference=r)}i.push(a)}return i}writeGeometryType(t,e,r,i){if(t)return void tie.write(t,e,r,i);const{features:n}=this;if(n){for(const s of n)if((s==null?void 0:s.geometry)!=null)return void tie.write(s.geometry.type,e,r,i)}}readQueryGeometry(t,e){if(!t)return null;const r=!!t.spatialReference,i=Sb(t);return i&&!r&&e.spatialReference&&(i.spatialReference=Ve.fromJSON(e.spatialReference)),i}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:r}=this;if(r){for(const i of r)if(i&&i.geometry!=null&&i.geometry.spatialReference)return void(e.spatialReference=i.geometry.spatialReference.toJSON())}}clone(){return new eie(this.cloneProperties())}cloneProperties(){return ae({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let r=0;r<e.features.length;r++){const i=e.features[r];if(i.geometry){const n=t==null?void 0:t[r];i.geometry=(n==null?void 0:n.toJSON())||i.geometry}}return e}quantize(t){const{scale:[e,r],translate:[i,n]}=t,s=c=>Math.round((c-i)/e),o=c=>Math.round((n-c)/r),a=this.features,l=this._getQuantizationFunction(this.geometryType,s,o);for(let c=0,u=a.length;c<u;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,u--);return this.transform=t,this}unquantize(){var p,f;const{geometryType:t,features:e,transform:r}=this;if(!r)return this;const{translate:[i,n],scale:[s,o]}=r,a=g=>g*s+i,l=g=>n-g*o;let c=null,u=null;if(this.hasZ&&((p=r==null?void 0:r.scale)==null?void 0:p[2])!=null){const{translate:[,,g],scale:[,,y]}=r;c=v=>v*y+g}if(this.hasM&&((f=r==null?void 0:r.scale)==null?void 0:f[3])!=null){const{translate:[,,,g],scale:[,,,y]}=r;u=v=>v==null?v:v*y+g}const h=this._getHydrationFunction(t,a,l,c,u);for(const{geometry:g}of e)g!=null&&h&&h(g);return this.transform=null,this}_quantizePoints(t,e,r){let i,n;const s=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),u=r(l[1]);c===i&&u===n||(s.push([c-i,u-n]),i=c,n=u)}else i=e(l[0]),n=r(l[1]),s.push([i,n])}return s.length>0?s:null}_getQuantizationFunction(t,e,r){return t==="point"?i=>(i.x=e(i.x),i.y=r(i.y),i):t==="polyline"||t==="polygon"?i=>{const n=ol(i)?i.rings:i.paths,s=[];for(let o=0,a=n.length;o<a;o++){const l=n[o],c=this._quantizePoints(l,e,r);c&&s.push(c)}return s.length>0?(ol(i)?i.rings=s:i.paths=s,i):null}:t==="multipoint"?i=>{const n=this._quantizePoints(i.points,e,r);return n&&n.length>0?(i.points=n,i):null}:t==="extent"?i=>i:null}_getHydrationFunction(t,e,r,i,n){return t==="point"?s=>{s.x=e(s.x),s.y=r(s.y),i&&(s.z=i(s.z))}:t==="polyline"||t==="polygon"?s=>{const o=ol(s)?s.rings:s.paths;let a,l;for(let c=0,u=o.length;c<u;c++){const h=o[c];for(let p=0,f=h.length;p<f;p++){const g=h[p];p>0?(a+=g[0],l+=g[1]):(a=g[0],l=g[1]),g[0]=e(a),g[1]=r(l)}}if(i&&n)for(let c=0,u=o.length;c<u;c++){const h=o[c];for(let p=0,f=h.length;p<f;p++){const g=h[p];g[2]=i(g[2]),g[3]=n(g[3])}}else if(i)for(let c=0,u=o.length;c<u;c++){const h=o[c];for(let p=0,f=h.length;p<f;p++){const g=h[p];g[2]=i(g[2])}}else if(n)for(let c=0,u=o.length;c<u;c++){const h=o[c];for(let p=0,f=h.length;p<f;p++){const g=h[p];g[2]=n(g[2])}}}:t==="extent"?s=>{s.xmin=e(s.xmin),s.ymin=r(s.ymin),s.xmax=e(s.xmax),s.ymax=r(s.ymax),i&&s.zmax!=null&&s.zmin!=null&&(s.zmax=i(s.zmax),s.zmin=i(s.zmin)),n&&s.mmax!=null&&s.mmin!=null&&(s.mmax=n(s.mmax),s.mmin=n(s.mmin))}:t==="multipoint"?s=>{const o=s.points;let a,l;for(let c=0,u=o.length;c<u;c++){const h=o[c];c>0?(a+=h[0],l+=h[1]):(a=h[0],l=h[1]),h[0]=e(a),h[1]=r(l)}if(i&&n)for(let c=0,u=o.length;c<u;c++){const h=o[c];h[2]=i(h[2]),h[3]=n(h[3])}else if(i)for(let c=0,u=o.length;c<u;c++){const h=o[c];h[2]=i(h[2])}else if(n)for(let c=0,u=o.length;c<u;c++){const h=o[c];h[2]=n(h[2])}}:null}};d([m({type:String,json:{write:!0}})],Ca.prototype,"displayFieldName",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ca.prototype,"exceededTransferLimit",void 0),d([m({type:[Hu],json:{write:!0}})],Ca.prototype,"features",void 0),d([Xe("features")],Ca.prototype,"readFeatures",null),d([m({type:[AN],json:{write:!0}})],Ca.prototype,"fields",void 0),d([m({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:tie.read}}})],Ca.prototype,"geometryType",void 0),d([nt("geometryType")],Ca.prototype,"writeGeometryType",null),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ca.prototype,"hasM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ca.prototype,"hasZ",void 0),d([m({types:cN,json:{write:!0}})],Ca.prototype,"queryGeometry",void 0),d([Xe("queryGeometry")],Ca.prototype,"readQueryGeometry",null),d([m({type:Ve,json:{write:!0}})],Ca.prototype,"spatialReference",void 0),d([nt("spatialReference")],Ca.prototype,"writeSpatialReference",null),d([m({json:{write:!0}})],Ca.prototype,"transform",void 0),Ca=eie=d([F("esri.rest.support.FeatureSet")],Ca),Ca.prototype.toJSON.isDefaultToJSON=!0;const NBe=Ca;async function Efr(t,e,r){const i=await FBe(t,e,r);return NBe.fromJSON(i)}async function FBe(t,e,r){const i=D_(t),n={...r},s=ec.from(e),{data:o}=await yBt(i,s,s.sourceSpatialReference,n);return o}function PBt(t,e){return e}function yue(t,e,r,i){switch(r){case 0:return VD(t,e+i,0);case 1:return t.originPosition==="lowerLeft"?VD(t,e+i,1):MBt(t,e+i,1)}}function kBe(t,e,r,i){return r===2?VD(t,e,2):yue(t,e,r,i)}function ABt(t,e,r,i){return r===2?e===0?0:VD(t,e,3):yue(t,e,r,i)}function OBt(t,e,r,i){return r===3?e===0?0:VD(t,e,3):kBe(t,e,r,i)}function VD({translate:t,scale:e},r,i){return t[i]+r*e[i]}function MBt({translate:t,scale:e},r,i){return t[i]-r*e[i]}let RBt=class{constructor(e){this._options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=PBt,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._mValueOffset=null,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this._options.applyTransform&&(e.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!e.hasZ)return;const r=Ise(e.geometryType,this._options.sourceSpatialReference,e.spatialReference);if(r!=null)for(const i of e.features)r(i.geometry)}createSpatialReference(){return{}}addField(e,r){const i=e.fields;JD(i),i.push(r);const n=i.map(s=>s.name);this._attributesConstructor=function(){for(const s of n)this[s]=null}}addFeature(e,r){e.features.push(r)}prepareFeatures(e){switch(this._transform=e.transform,this._options.applyTransform&&e.transform&&(this._applyTransform=this._deriveApplyTransform(e)),this._mValueOffset=null,this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&(this._mValueOffset=this._vertexDimension,this._vertexDimension++),e.geometryType){case"esriGeometryPoint":this.addCoordinate=(r,i,n)=>this.addCoordinatePoint(r,i,n),this.createGeometry=r=>this.createPointGeometry(r);break;case"esriGeometryPolygon":this.addCoordinate=(r,i,n)=>this._addCoordinatePolygon(r,i,n),this.createGeometry=r=>this._createPolygonGeometry(r);break;case"esriGeometryPolyline":this.addCoordinate=(r,i,n)=>this._addCoordinatePolyline(r,i,n),this.createGeometry=r=>this._createPolylineGeometry(r);break;case"esriGeometryMultipoint":this.addCoordinate=(r,i,n)=>this._addCoordinateMultipoint(r,i,n),this.createGeometry=r=>this._createMultipointGeometry(r)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(e,r,i){this._lengths.length===0&&(this._toAddInCurrentPath=r),this._lengths.push(r)}addQueryGeometry(e,r){const{queryGeometry:i,queryGeometryType:n}=r,s=qee(i.clone(),i,!1,!1,this._transform),o=$Fe(s,n,!1,!1);e.queryGeometryType=n,e.queryGeometry={...o}}createPointGeometry(e){const r={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(r.z=0),e.hasM&&(r.m=0),r}addCoordinatePoint(e,r,i){const n=this._transform;switch(r=this._applyTransform(n,r,i,0),i){case 0:e.x=r;break;case 1:e.y=r;break;case 2:"z"in e?e.z=r:e.m=r;break;case 3:e.m=r}}_transformPathLikeValue(e,r){let i=0;r<=1&&(i=this._previousCoordinate[r],this._previousCoordinate[r]+=e);const n=this._transform;return this._mValueOffset===null||e!==0||r%this._mValueOffset?this._applyTransform(n,e,r,i):0}_addCoordinatePolyline(e,r,i){this._dehydratedAddPointsCoordinate(e.paths,r,i)}_addCoordinatePolygon(e,r,i){this._dehydratedAddPointsCoordinate(e.rings,r,i)}_addCoordinateMultipoint(e,r,i){i===0&&e.points.push([]);const n=this._transformPathLikeValue(r,i);e.points[e.points.length-1].push(n)}_createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_dehydratedAddPointsCoordinate(e,r,i){i===0&&this._toAddInCurrentPath--==0&&(e.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const n=this._transformPathLikeValue(r,i),s=e[e.length-1];i===0&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),s.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=n}_deriveApplyTransform(e){const{hasZ:r,hasM:i}=e;return r&&i?OBt:r?kBe:i?ABt:yue}};async function $Bt(t,e,r){const i=D_(t),n={...r},s=ec.from(e),o=!s.quantizationParameters,{data:a}=await _Bt(i,s,new RBt({sourceSpatialReference:s.sourceSpatialReference,applyTransform:o}),n);return a}let Sd=class extends Pe{constructor(e){super(e),this.dynamicDataSource=null,this.fieldsIndex=null,this.gdbVersion=null,this.infoFor3D=null,this.pbfSupported=!1,this.queryAttachmentsSupported=!1,this.sourceSpatialReference=null,this.url=null}get parsedUrl(){return xs(this.url)}async execute(e,r){const i=await this.executeJSON(e,r);return this.featureSetFromJSON(e,i,r)}async executeJSON(e,r){var l;const i=this._normalizeQuery(e),n=((l=e.outStatistics)==null?void 0:l[0])!=null,s=ne("featurelayer-pbf-statistics"),o=!n||s;let a;if(this.pbfSupported&&o)try{a=await $Bt(this.url,i,r)}catch(c){if(c.name!=="query:parsing-pbf")throw c;this.pbfSupported=!1}return this.pbfSupported&&o||(a=await FBe(this.url,i,r)),this._normalizeFields(a.fields),a}async featureSetFromJSON(e,r,i){if(!this._queryIs3DObjectFormat(e)||this.infoFor3D==null||!r.features)return NBe.fromJSON(r);const{meshFeatureSetFromJSON:n}=await ff(re(()=>import("./meshFeatureSet-JwziPvP2.js"),__vite__mapDeps([])),i);return n(e,this.infoFor3D,r)}executeForCount(e,r){return TBt(this.url,this._normalizeQuery(e),r)}executeForExtent(e,r){return EBt(this.url,this._normalizeQuery(e),r)}executeForIds(e,r){return CBt(this.url,this._normalizeQuery(e),r)}async executeRelationshipQuery(e,r){const[{default:i},{executeRelationshipQuery:n}]=await ff(Promise.all([re(()=>Promise.resolve().then(()=>ySe),void 0),re(()=>import("./executeRelationshipQuery-BNl3C7HH.js"),__vite__mapDeps([]))]),r);return e=i.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),n(this.url,e,r)}async executeRelationshipQueryForCount(e,r){const[{default:i},{executeRelationshipQueryForCount:n}]=await ff(Promise.all([re(()=>Promise.resolve().then(()=>ySe),void 0),re(()=>import("./executeRelationshipQuery-BNl3C7HH.js"),__vite__mapDeps([]))]),r);return e=i.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),n(this.url,e,r)}async executeAttachmentQuery(e,r){const{executeAttachmentQuery:i,fetchAttachments:n,processAttachmentQueryResult:s}=await ff(re(()=>import("./queryAttachments-CGdvzYF0.js"),__vite__mapDeps([214,64])),r),o=D_(this.url);return s(o,await(this.queryAttachmentsSupported?i(o,e,r):n(o,e,r)))}async executeTopFeaturesQuery(e,r){const{executeTopFeaturesQuery:i}=await ff(re(()=>import("./executeTopFeaturesQuery-B-tBWowl.js"),__vite__mapDeps([215,216,65])),r);return i(this.parsedUrl,e,this.sourceSpatialReference,r)}async executeForTopIds(e,r){const{executeForTopIds:i}=await ff(re(()=>import("./executeForTopIds-wo3gc7pQ.js"),__vite__mapDeps([217,216,65])),r);return i(this.parsedUrl,e,r)}async executeForTopExtents(e,r){const{executeForTopExtents:i}=await ff(re(()=>import("./executeForTopExtents-CzTqjb8A.js"),__vite__mapDeps([218,216,65])),r);return i(this.parsedUrl,e,r)}async executeForTopCount(e,r){const{executeForTopCount:i}=await ff(re(()=>import("./executeForTopCount-BDxXnqce.js"),__vite__mapDeps([219,216,65])),r);return i(this.parsedUrl,e,r)}_normalizeQuery(e){let r=ec.from(e);r.sourceSpatialReference=r.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(r=r===e?r.clone():r,r.gdbVersion=e.gdbVersion||this.gdbVersion,r.dynamicDataSource=e.dynamicDataSource?mu.from(e.dynamicDataSource):this.dynamicDataSource);const{infoFor3D:i}=this;if(i!=null&&this._queryIs3DObjectFormat(e)){r=r===e?r.clone():r,r.formatOf3DObjects=null;const{supportedFormats:n,queryFormats:s}=i,o=Fz("model/gltf-binary",n)??kz("glb",n),a=Fz("model/gltf+json",n)??kz("gltf",n);for(const l of s){if(l===o){r.formatOf3DObjects=l;break}l!==a||r.formatOf3DObjects||(r.formatOf3DObjects=l)}if(!r.formatOf3DObjects)throw new B("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(r.outFields==null||!r.outFields.includes("*")){r=r===e?r.clone():r,r.outFields==null&&(r.outFields=[]);const{originX:l,originY:c,originZ:u,translationX:h,translationY:p,translationZ:f,scaleX:g,scaleY:y,scaleZ:v,rotationX:b,rotationY:w,rotationZ:x,rotationDeg:S}=i.transformFieldRoles;r.outFields.push(l,c,u,h,p,f,g,y,v,b,w,x,S)}}return r}_normalizeFields(e){if(this.fieldsIndex!=null&&e!=null)for(const r of e){const i=this.fieldsIndex.get(r.name);i&&Object.assign(r,i.toJSON())}}_queryIs3DObjectFormat(e){return this.infoFor3D!=null&&e.returnGeometry===!0&&e.multipatchOption!=="xyFootprint"&&!e.outStatistics}};d([m({type:mu})],Sd.prototype,"dynamicDataSource",void 0),d([m()],Sd.prototype,"fieldsIndex",void 0),d([m()],Sd.prototype,"gdbVersion",void 0),d([m()],Sd.prototype,"infoFor3D",void 0),d([m({readOnly:!0})],Sd.prototype,"parsedUrl",null),d([m()],Sd.prototype,"pbfSupported",void 0),d([m()],Sd.prototype,"queryAttachmentsSupported",void 0),d([m()],Sd.prototype,"sourceSpatialReference",void 0),d([m({type:String})],Sd.prototype,"url",void 0),Sd=d([F("esri.tasks.QueryTask")],Sd);const IBt=Sd,NSe=new Ii({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let av=class extends ds(Se){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};d([m({json:{write:!0}})],av.prototype,"name",void 0),d([m({json:{write:!0}})],av.prototype,"description",void 0),d([m({json:{read:NSe.read,write:NSe.write}})],av.prototype,"drawingTool",void 0),d([m({json:{write:!0}})],av.prototype,"prototype",void 0),d([m({json:{write:!0}})],av.prototype,"thumbnail",void 0),av=d([F("esri.layers.support.FeatureTemplate")],av);const LBt=av;let m0=class extends ds(Se){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const r={};for(const i of Object.keys(e))r[i]=hLe(e[i]);return r}writeDomains(e,r){var n;const i={};for(const s of Object.keys(e))e[s]&&(i[s]=(n=e[s])==null?void 0:n.toJSON());r.domains=i}};d([m({json:{write:!0}})],m0.prototype,"id",void 0),d([m({json:{write:!0}})],m0.prototype,"name",void 0),d([m({json:{write:!0}})],m0.prototype,"domains",void 0),d([Xe("domains")],m0.prototype,"readDomains",null),d([nt("domains")],m0.prototype,"writeDomains",null),d([m({type:[LBt],json:{write:!0}})],m0.prototype,"templates",void 0),m0=d([F("esri.layers.support.FeatureType")],m0);const DBt=m0;function Yt(t,e,r){return!!UBe(t,e,r)}function Q$(t,e,r){return UBe(t,e,r)}function UBe(t,e,r){return t&&t.hasOwnProperty(e)?t[e]:r}const NBt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function FBt(t){var r;const e=(r=t==null?void 0:t.supportedSpatialAggregationStatistics)==null?void 0:r.map(i=>i.toLowerCase());return{envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function n4(t,e){var i;const r=(i=t==null?void 0:t.supportedOperationsWithCacheHint)==null?void 0:i.map(n=>n.toLowerCase());return!!(r!=null&&r.includes(e.toLowerCase()))}function kBt(t,e){return{analytics:UBt(t),attachment:zBt(t),data:VBt(t),metadata:BBt(t),operations:GBt(t.capabilities,t,e),query:jBt(t,e),queryRelated:HBt(t),queryTopFeatures:qBt(t),editing:WBt(t)}}function UBt(t){return{supportsCacheHint:n4(t.advancedQueryCapabilities,"queryAnalytics")}}function zBt(t){const e=t.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:n4(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:Yt(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(i=>{const n=NBt[i.name];n&&(r[n]=!!i.isEnabled)}),r}function VBt(t){return{isVersioned:Yt(t,"isDataVersioned",!1),supportsAttachment:Yt(t,"hasAttachments",!1),supportsM:Yt(t,"hasM",!1),supportsZ:Yt(t,"hasZ",!1)}}function BBt(t){return{supportsAdvancedFieldProperties:Yt(t,"supportsFieldDescriptionProperty",!1)}}function GBt(t,e,r){const i=t?t.toLowerCase().split(",").map(p=>p.trim()):[],n=r?fm(r):null,s=i.includes(n!=null&&n.serverType==="MapServer"?"data":"query"),o=i.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&i.includes("create"),l=o&&i.includes("delete"),c=o&&i.includes("update");const u=i.includes("changetracking"),h=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:Yt(e,"supportsCalculate",!1),supportsTruncate:Yt(e,"supportsTruncate",!1),supportsValidateSql:Yt(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:u,supportsQuery:s,supportsQueryAnalytics:Yt(h,"supportsQueryAnalytic",!1),supportsQueryAttachments:Yt(h,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Yt(h,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Yt(e,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:Yt(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:Yt(e,"supportsAsyncConvert3D",!1)}}function jBt(t,e){const r=t.advancedQueryCapabilities,i=t.ownershipBasedAccessControlForFeatures,n=t.archivingInfo,s=t.currentVersion,o=e==null?void 0:e.includes("MapServer"),a=!o||s>=ne("mapserver-pbf-version-support"),l=o9(e),c=new Set((t.supportedQueryFormats??"").split(",").map(u=>u.toLowerCase().trim()));return{supportsStatistics:Yt(r,"supportsStatistics",t.supportsStatistics),supportsPercentileStatistics:Yt(r,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:Yt(r,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:FBt(r),supportsCentroid:Yt(r,"supportsReturningGeometryCentroid",!1),supportsDistance:Yt(r,"supportsQueryWithDistance",!1),supportsDistinct:Yt(r,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:Yt(r,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Yt(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:Yt(r,"supportsHavingClause",!1),supportsOrderBy:Yt(r,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:Yt(r,"supportsPagination",!1),supportsQuantization:Yt(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Yt(t,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Yt(t,"supportsReturningQueryGeometry",!1),supportsResultType:Yt(r,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Yt(r,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Yt(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Yt(t,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Yt(r,"supportsTopFeaturesQuery",!1),supportsQueryByAnonymous:Yt(i,"allowAnonymousToQuery",!0),supportsQueryByOthers:Yt(i,"allowOthersToQuery",!0),supportsHistoricMoment:Yt(n,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a&&c.has("pbf"),supportsDisjointSpatialRelationship:Yt(r,"supportsDisjointSpatialRel",!1),supportsCacheHint:Yt(r,"supportsQueryWithCacheHint",!1)||n4(r,"query"),supportsDefaultSpatialReference:Yt(r,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:Yt(r,"supportsFullTextSearch",!1),maxRecordCountFactor:Q$(t,"maxRecordCountFactor",void 0),maxRecordCount:Q$(t,"maxRecordCount",void 0),standardMaxRecordCount:Q$(t,"standardMaxRecordCount",void 0),tileMaxRecordCount:Q$(t,"tileMaxRecordCount",void 0)}}function HBt(t){const e=t.advancedQueryCapabilities,r=Yt(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Yt(e,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:n4(e,"queryRelated")}}function qBt(t){return{supportsCacheHint:n4(t.advancedQueryCapabilities,"queryTopFilter")}}function WBt(t){const e=t.ownershipBasedAccessControlForFeatures,r=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:Yt(t,"allowGeometryUpdates",!0),supportsGlobalId:Yt(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Yt(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Yt(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Yt(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Yt(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Yt(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Yt(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Yt(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Yt(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:Yt(r,"supportsAsyncApplyEdits",!1),zDefault:Q$(t,"zDefault",void 0)}}var dU;function zY(t){return t!=null&&t.type==="esriSMS"}function VY(t,e,r){var n;const i=this.originIdOf(e)>=Au(r.origin);return{ignoreOrigin:!0,allowNull:i,enabled:!!r&&((n=r.layer)==null?void 0:n.type)==="map-image"&&(r.writeSublayerStructure||i)}}function BY(t,e,r){var i;return{enabled:!!r&&((i=r.layer)==null?void 0:i.type)==="tile"&&(r.origin&&this.originIdOf(e)>=Au(r.origin)||this._isOverridden(e))}}function ad(t,e,r){return{ignoreOrigin:!0,enabled:r&&r.writeSublayerStructure||!1}}function Nk(t,e,r){return{ignoreOrigin:!0,enabled:!!r&&(r.writeSublayerStructure||this.originIdOf(e)>=Au(r.origin))}}let YBt=0;const yS=new Set;yS.add("layer"),yS.add("parent"),yS.add("loaded"),yS.add("loadStatus"),yS.add("loadError"),yS.add("loadWarnings");let Wt=dU=class extends UG(IB(ay)){constructor(t){super(t),this.capabilities=void 0,this.maxScaleRange={minScale:0,maxScale:0},this.fields=null,this.fullExtent=null,this.geometryType=null,this.globalIdField=null,this.legendEnabled=!0,this.objectIdField=null,this.parent=null,this.popupEnabled=!0,this.popupTemplate=null,this.sourceJSON=null,this.title=null,this.typeIdField=null,this.type="sublayer",this.types=null,this._lastParsedUrl=null}async load(t){return this.addResolvingPromise((async()=>{const{layer:e,url:r}=this;if(!e&&!r)throw new B("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});const i=e?await e.fetchSublayerInfo(this,t):(await Vt(r,{responseType:"json",query:{f:"json"},...t})).data;i&&(this.sourceJSON=i,this.read({layerDefinition:i},{origin:"service",layer:e,url:D_(r)}))})()),this}readCapabilities(t,e){e=e.layerDefinition||e;const{operations:{supportsQuery:r,supportsQueryAttachments:i},query:{supportsFormatPBF:n},data:{supportsAttachment:s},queryRelated:o}=kBt(e,this.url);return{exportMap:{supportsModification:!!e.canModifyLayer},operations:{supportsQuery:r,supportsQueryAttachments:i},data:{supportsAttachment:s},query:{supportsFormatPBF:n},queryRelated:o}}get defaultPopupTemplate(){return this.createPopupTemplate()}set definitionExpression(t){this._setAndNotifyLayer("definitionExpression",t)}get effectiveScaleRange(){const{minScale:t,maxScale:e}=this;return{minScale:t,maxScale:e}}readMaxScaleRange(t,e){return{minScale:(e=e.layerDefinition||e).minScale??0,maxScale:e.maxScale??0}}get fieldsIndex(){return new kG(this.fields||[])}set floorInfo(t){this._setAndNotifyLayer("floorInfo",t)}readGlobalIdFieldFromService(t,e){if((e=e.layerDefinition||e).globalIdField)return e.globalIdField;if(e.fields){for(const r of e.fields)if(r.type==="esriFieldTypeGlobalID")return r.name}}get id(){return this._get("id")??YBt++}set id(t){var e,r,i;this._get("id")!==t&&(((i=(r=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:r.exportMap)==null?void 0:i.supportsDynamicLayers)!==!1?this._set("id",t):this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"))}set labelingInfo(t){this._setAndNotifyLayer("labelingInfo",t)}writeLabelingInfo(t,e,r,i){t&&t.length&&(e.layerDefinition={drawingInfo:{labelingInfo:t.map(n=>n.write({},i))}})}set labelsVisible(t){this._setAndNotifyLayer("labelsVisible",t)}set layer(t){this._set("layer",t),this.sublayers&&this.sublayers.forEach(e=>e.layer=t)}set listMode(t){this._set("listMode",t)}set minScale(t){this._setAndNotifyLayer("minScale",t)}readMinScale(t,e){var r;return e.minScale||((r=e.layerDefinition)==null?void 0:r.minScale)||0}set maxScale(t){this._setAndNotifyLayer("maxScale",t)}readMaxScale(t,e){var r;return e.maxScale||((r=e.layerDefinition)==null?void 0:r.maxScale)||0}readObjectIdFieldFromService(t,e){if((e=e.layerDefinition||e).objectIdField)return e.objectIdField;if(e.fields){for(const r of e.fields)if(r.type==="esriFieldTypeOID")return r.name}}set opacity(t){this._setAndNotifyLayer("opacity",t)}readOpacity(t,e){var i;const r=e.layerDefinition;return 1-.01*(((r==null?void 0:r.transparency)!=null?r.transparency:(i=r==null?void 0:r.drawingInfo)==null?void 0:i.transparency)??0)}writeOpacity(t,e,r,i){e.layerDefinition={drawingInfo:{transparency:100-100*t}}}writeParent(t,e){this.parent&&this.parent!==this.layer?e.parentLayerId=oB(this.parent.id):e.parentLayerId=-1}get queryTask(){var o;if(!this.layer)return null;const{spatialReference:t}=this.layer,e="gdbVersion"in this.layer?this.layer.gdbVersion:void 0,{capabilities:r,fieldsIndex:i}=this,n=ne("featurelayer-pbf")&&(r==null?void 0:r.query.supportsFormatPBF),s=((o=r==null?void 0:r.operations)==null?void 0:o.supportsQueryAttachments)??!1;return new IBt({url:this.url,pbfSupported:n,fieldsIndex:i,gdbVersion:e,sourceSpatialReference:t,queryAttachmentsSupported:s})}set renderer(t){if(t){for(const e of t.getSymbols())if(zb(e)){K.getLogger(this).warn("Sublayer renderer should use 2D symbols");break}}this._setAndNotifyLayer("renderer",t)}get source(){return this._get("source")||new M0({mapLayerId:this.id})}set source(t){this._setAndNotifyLayer("source",t)}set sublayers(t){this._handleSublayersChange(t,this._get("sublayers")),this._set("sublayers",t)}castSublayers(t){return to(St.ofType(dU),t)}writeSublayers(t,e,r){var i;(i=this.sublayers)!=null&&i.length&&(e[r]=this.sublayers.map(n=>n.id).toArray().reverse())}readTitle(t,e){var r;return((r=e.layerDefinition)==null?void 0:r.name)??e.name}readTypeIdField(t,e){let r=(e=e.layerDefinition||e).typeIdField;if(r&&e.fields){r=r.toLowerCase();const i=e.fields.find(n=>n.name.toLowerCase()===r);i&&(r=i.name)}return r}get url(){var i;const t=((i=this.layer)==null?void 0:i.parsedUrl)??this._lastParsedUrl,e=this.source;if(!t)return null;if(this._lastParsedUrl=t,(e==null?void 0:e.type)==="map-layer")return`${t.path}/${e.mapLayerId}`;const r={layer:JSON.stringify({source:this.source})};return`${t.path}/dynamicLayer?${_b(r)}`}set url(t){this._overrideIfSome("url",t)}set visible(t){this._setAndNotifyLayer("visible",t)}writeVisible(t,e,r,i){e[r]=this.getAtOrigin("defaultVisibility","service")||t}clone(){const{store:t}=$s(this),e=new dU;return $s(e).store=t.clone(yS),this.commitProperty("url"),e._lastParsedUrl=this._lastParsedUrl,e}createPopupTemplate(t){return SBe(this,t)}createQuery(){return new ec({returnGeometry:!0,where:this.definitionExpression||"1=1"})}async createFeatureLayer(){var n;if(this.hasOwnProperty("sublayers"))return null;const t=(await re(()=>import("./FeatureLayer-BJkvQ9Vd.js"),__vite__mapDeps([66,67,68,69,70,71,72,73,74,75,76,65,77]))).default,{layer:e,url:r}=this;let i;if(r&&this.originIdOf("url")>We.SERVICE)i=new t({url:r});else{if(!(e!=null&&e.parsedUrl))throw new B("createFeatureLayer:missing-information","Cannot create a FeatureLayer without a url or a parent layer");{const s=e.parsedUrl;i=new t({url:s.path}),s&&this.source&&(this.source.type==="map-layer"?i.layerId=this.source.mapLayerId:i.dynamicDataSource=this.source)}}return(e==null?void 0:e.refreshInterval)!=null&&(i.refreshInterval=e.refreshInterval),this.definitionExpression&&(i.definitionExpression=this.definitionExpression),this.floorInfo&&(i.floorInfo=ae(this.floorInfo)),this.originIdOf("labelingInfo")>We.SERVICE&&(i.labelingInfo=ae(this.labelingInfo)),this.originIdOf("labelsVisible")>We.DEFAULTS&&(i.labelsVisible=this.labelsVisible),this.originIdOf("legendEnabled")>We.DEFAULTS&&(i.legendEnabled=this.legendEnabled),this.originIdOf("visible")>We.DEFAULTS&&(i.visible=this.visible),this.originIdOf("minScale")>We.DEFAULTS&&(i.minScale=this.minScale),this.originIdOf("maxScale")>We.DEFAULTS&&(i.maxScale=this.maxScale),this.originIdOf("opacity")>We.DEFAULTS&&(i.opacity=this.opacity),this.originIdOf("popupTemplate")>We.DEFAULTS&&(i.popupTemplate=ae(this.popupTemplate)),this.originIdOf("renderer")>We.SERVICE&&(i.renderer=ae(this.renderer)),((n=this.source)==null?void 0:n.type)==="data-layer"&&(i.dynamicDataSource=this.source.clone()),this.originIdOf("title")>We.DEFAULTS&&(i.title=this.title),(e==null?void 0:e.type)==="map-image"&&e.originIdOf("customParameters")>We.DEFAULTS&&(i.customParameters=e.customParameters),(e==null?void 0:e.type)==="tile"&&e.originIdOf("customParameters")>We.DEFAULTS&&(i.customParameters=e.customParameters),i}getField(t){return this.fieldsIndex.get(t)}getFeatureType(t){const{typeIdField:e,types:r}=this;if(!e||!t)return null;const i=t.attributes?t.attributes[e]:void 0;if(i==null)return null;let n=null;return r==null||r.some(s=>{const{id:o}=s;return o!=null&&(o.toString()===i.toString()&&(n=s),!!n)}),n}getFieldDomain(t,e){const r=e==null?void 0:e.feature,i=this.getFeatureType(r);if(i){const n=i.domains&&i.domains[t];if(n&&n.type!=="inherited")return n}return this._getLayerDomain(t)}async queryAttachments(t,e){var u,h;await this.load(),t=pBe.from(t);const r=this.capabilities;if(!((u=r==null?void 0:r.data)!=null&&u.supportsAttachment))throw new B("queryAttachments:not-supported","this layer doesn't support attachments");const{attachmentTypes:i,objectIds:n,globalIds:s,num:o,size:a,start:l,where:c}=t;if(!((h=r==null?void 0:r.operations)!=null&&h.supportsQueryAttachments)&&((i==null?void 0:i.length)>0||(s==null?void 0:s.length)>0||(a==null?void 0:a.length)>0||o||l||c))throw new B("queryAttachments:option-not-supported","when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",t);if(!(n!=null&&n.length||s!=null&&s.length||c))throw new B("queryAttachments:invalid-query","'objectIds', 'globalIds', or 'where' are required to perform attachment query",t);return this.queryTask.executeAttachmentQuery(t,e)}async queryFeatures(t=this.createQuery(),e){var i,n;if(await this.load(),!this.capabilities.operations.supportsQuery)throw new B("queryFeatures:not-supported","this layer doesn't support queries.");if(!this.url)throw new B("queryFeatures:not-supported","this layer has no url.");const r=await this.queryTask.execute(t,{...e,query:{...(i=this.layer)==null?void 0:i.customParameters,token:(n=this.layer)==null?void 0:n.apiKey}});if(r!=null&&r.features)for(const s of r.features)s.sourceLayer=this;return r}toExportImageJSON(t){var s,o;const e={id:this.id,source:((s=this.source)==null?void 0:s.toJSON())||{mapLayerId:this.id,type:"mapLayer"}},r=Tct(t,this.definitionExpression);r!=null&&(e.definitionExpression=r);const i=["renderer","labelingInfo","opacity","labelsVisible"].reduce((a,l)=>(a[l]=this.originIdOf(l),a),{});if(Object.keys(i).some(a=>i[a]>We.SERVICE)){const a=e.drawingInfo={};if(i.renderer>We.SERVICE&&(a.renderer=this.renderer?this.renderer.toJSON():null),i.labelsVisible>We.SERVICE&&(a.showLabels=this.labelsVisible),this.labelsVisible&&i.labelingInfo>We.SERVICE)if(this.labelingInfo){!this.loaded&&((o=this.labelingInfo)!=null&&o.some(c=>!c.labelPlacement))&&K.getLogger(this).warnOnce(`A Sublayer (title: ${this.title}, id: ${this.id}) has an undefined 'labelPlacement' and so labels cannot be displayed. Either define a valid 'labelPlacement' or call Sublayer.load() to use a default value based on geometry type.`,{sublayer:this});let l=this.labelingInfo;this.geometryType!=null&&(l=P9t(this.labelingInfo,qL.toJSON(this.geometryType))),a.showLabels=!0,a.labelingInfo=l.filter(c=>c.labelPlacement).map(c=>c.toJSON({origin:"service",layer:this.layer}))}else a.showLabels=!1;i.opacity>We.SERVICE&&(a.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(a.renderer)}return e}_assignDefaultSymbolColors(t){this._forEachSimpleMarkerSymbols(t,e=>{var r;e.color||e.style!=="esriSMSX"&&e.style!=="esriSMSCross"||((r=e.outline)!=null&&r.color?e.color=e.outline.color:e.color=[0,0,0,0])})}_forEachSimpleMarkerSymbols(t,e){if(t){const r=("uniqueValueInfos"in t?t.uniqueValueInfos:"classBreakInfos"in t?t.classBreakInfos:null)??[];for(const i of r)zY(i.symbol)&&e(i.symbol);"symbol"in t&&zY(t.symbol)&&e(t.symbol),"defaultSymbol"in t&&zY(t.defaultSymbol)&&e(t.defaultSymbol)}}_setAndNotifyLayer(t,e){var a,l,c,u;const r=this.layer,i=this._get(t);let n,s;switch(t){case"definitionExpression":case"floorInfo":n="supportsSublayerDefinitionExpression";break;case"minScale":case"maxScale":case"visible":n="supportsSublayerVisibility";break;case"labelingInfo":case"labelsVisible":case"opacity":case"renderer":case"source":n="supportsDynamicLayers",s="supportsModification"}const o=$s(this).getDefaultOrigin();if(o!=="service"){if(n&&((c=(l=(a=this.layer)==null?void 0:a.capabilities)==null?void 0:l.exportMap)==null?void 0:c[n])===!1)return void this._logLockedError(t,`capability not available 'layer.capabilities.exportMap.${n}'`);if(s&&((u=this.capabilities)==null?void 0:u.exportMap[s])===!1)return void this._logLockedError(t,`capability not available 'capabilities.exportMap.${s}'`)}t!=="source"||this.loadStatus==="not-loaded"?(this._set(t,e),o!=="service"&&i!==e&&r&&r.emit&&r.emit("sublayer-update",{propertyName:t,target:this})):this._logLockedError(t,"'source' can't be changed after calling sublayer.load()")}_handleSublayersChange(t,e){e&&(e.forEach(r=>{r.parent=null,r.layer=null}),this.removeAllHandles()),t&&(t.forEach(r=>{r.parent=this,r.layer=this.layer}),this.addHandles([t.on("after-add",({item:r})=>{r.parent=this,r.layer=this.layer}),t.on("after-remove",({item:r})=>{r.parent=null,r.layer=null}),t.on("before-changes",r=>{var n,s,o;const i=(o=(s=(n=this.layer)==null?void 0:n.capabilities)==null?void 0:s.exportMap)==null?void 0:o.supportsSublayersChanges;i==null||i||(K.getLogger(this).error(new B("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),r.preventDefault())})]))}_logLockedError(t,e){const{layer:r,declaredClass:i}=this;K.getLogger(i).error(new B("sublayer:locked",`Property '${String(t)}' can't be changed on Sublayer from the layer '${r==null?void 0:r.id}'`,{reason:e,sublayer:this,layer:r}))}_getLayerDomain(t){const e=this.fieldsIndex.get(t);return e?e.domain:null}};Wt.test={isMapImageLayerOverridePolicy:t=>t===ad||t===VY,isTileImageLayerOverridePolicy:t=>t===BY},d([m({readOnly:!0})],Wt.prototype,"capabilities",void 0),d([Xe("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],Wt.prototype,"readCapabilities",null),d([m()],Wt.prototype,"defaultPopupTemplate",null),d([m({type:String,value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:VY}}})],Wt.prototype,"definitionExpression",null),d([m({readOnly:!0})],Wt.prototype,"effectiveScaleRange",null),d([Xe("service","maxScaleRange",["minScale","maxScale"])],Wt.prototype,"readMaxScaleRange",null),d([m({type:[AN],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],Wt.prototype,"fields",void 0),d([m({readOnly:!0})],Wt.prototype,"fieldsIndex",null),d([m({type:_Be,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",overridePolicy:VY},origins:{"web-scene":{read:!1,write:!1}}}})],Wt.prototype,"floorInfo",null),d([m({type:br,json:{read:{source:"layerDefinition.extent"}}})],Wt.prototype,"fullExtent",void 0),d([m({type:qL.apiValues,json:{origins:{service:{name:"layerDefinition.geometryType",read:{reader:qL.read}}}}})],Wt.prototype,"geometryType",void 0),d([m({type:String})],Wt.prototype,"globalIdField",void 0),d([Xe("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],Wt.prototype,"readGlobalIdFieldFromService",null),d([m({type:Vi,json:{write:{ignoreOrigin:!0}}})],Wt.prototype,"id",null),d([m({value:null,type:[fue],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:ad}}})],Wt.prototype,"labelingInfo",null),d([nt("labelingInfo")],Wt.prototype,"writeLabelingInfo",null),d([m({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:ad}}})],Wt.prototype,"labelsVisible",null),d([m({value:null})],Wt.prototype,"layer",null),d([m({type:String,json:{write:{overridePolicy:BY}}})],Wt.prototype,"layerItemId",void 0),d([m({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:Nk}}})],Wt.prototype,"legendEnabled",void 0),d([m({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Wt.prototype,"listMode",null),d([m({type:Number,value:0,json:{write:{overridePolicy:ad}}})],Wt.prototype,"minScale",null),d([Xe("minScale",["minScale","layerDefinition.minScale"])],Wt.prototype,"readMinScale",null),d([m({type:Number,value:0,json:{write:{overridePolicy:ad}}})],Wt.prototype,"maxScale",null),d([Xe("maxScale",["maxScale","layerDefinition.maxScale"])],Wt.prototype,"readMaxScale",null),d([m({type:String})],Wt.prototype,"objectIdField",void 0),d([Xe("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],Wt.prototype,"readObjectIdFieldFromService",null),d([m({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:ad}}})],Wt.prototype,"opacity",null),d([Xe("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],Wt.prototype,"readOpacity",null),d([nt("opacity")],Wt.prototype,"writeOpacity",null),d([m({json:{type:Vi,write:{target:"parentLayerId",writerEnsuresNonNull:!0,overridePolicy:ad}}})],Wt.prototype,"parent",void 0),d([nt("parent")],Wt.prototype,"writeParent",null),d([m({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:(t,e)=>!e.disablePopup},write:{target:"disablePopup",overridePolicy:Nk,writer(t,e,r){e[r]=!t}}}})],Wt.prototype,"popupEnabled",void 0),d([m({type:D7,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:Nk}}})],Wt.prototype,"popupTemplate",void 0),d([m({readOnly:!0})],Wt.prototype,"queryTask",null),d([m({types:VVe,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ad},origins:{"web-scene":{types:BVe,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ad}}}}})],Wt.prototype,"renderer",null),d([m({types:{key:"type",base:null,typeMap:{"data-layer":mu,"map-layer":M0}},cast(t){if(t){if("mapLayerId"in t)return s_(M0,t);if("dataSource"in t)return s_(mu,t)}return t},json:{name:"layerDefinition.source",write:{overridePolicy:ad}}})],Wt.prototype,"source",null),d([m()],Wt.prototype,"sourceJSON",void 0),d([m({value:null,json:{type:[Vi],write:{target:"subLayerIds",allowNull:!0,overridePolicy:ad}}})],Wt.prototype,"sublayers",null),d([Dr("sublayers")],Wt.prototype,"castSublayers",null),d([nt("sublayers")],Wt.prototype,"writeSublayers",null),d([m({type:String,json:{name:"name",write:{overridePolicy:Nk}}})],Wt.prototype,"title",void 0),d([Xe("service","title",["name","layerDefinition.name"])],Wt.prototype,"readTitle",null),d([m({type:String})],Wt.prototype,"typeIdField",void 0),d([m({json:{read:!1},readOnly:!0,value:"sublayer"})],Wt.prototype,"type",void 0),d([Xe("typeIdField",["layerDefinition.typeIdField"])],Wt.prototype,"readTypeIdField",null),d([m({type:[DBt],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],Wt.prototype,"types",void 0),d([m({type:String,json:{name:"layerUrl",write:{overridePolicy:BY}}})],Wt.prototype,"url",null),d([m({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:ad}}})],Wt.prototype,"visible",null),d([nt("visible")],Wt.prototype,"writeVisible",null),Wt=dU=d([F("esri.layers.support.Sublayer")],Wt);const BG=Wt;function Mfr(t,e,r){return e.flatten(({sublayers:n})=>n).length!==t.length?!0:!!t.some(n=>n.originIdOf("minScale")>r||n.originIdOf("maxScale")>r||n.originIdOf("renderer")>r||n.originIdOf("labelingInfo")>r||n.originIdOf("opacity")>r||n.originIdOf("labelsVisible")>r||n.originIdOf("source")>r)||!zBe(t,e)}function Rfr(t,e,r){return!!t.some(i=>{const n=i.source;return!(!n||n.type==="map-layer"&&n.mapLayerId===i.id&&(n.gdbVersion==null||n.gdbVersion===r))||i.originIdOf("renderer")>We.SERVICE||i.originIdOf("labelingInfo")>We.SERVICE||i.originIdOf("opacity")>We.SERVICE||i.originIdOf("labelsVisible")>We.SERVICE})||!zBe(t,e)}function zBe(t,e){if(!(t!=null&&t.length)||e==null)return!0;const r=e.slice().reverse().flatten(({sublayers:s})=>s&&s.toArray().reverse()).map(s=>s.id).toArray();if(t.length>r.length)return!1;let i=0;const n=r.length;for(const{id:s}of t){for(;i<n&&r[i]!==s;)i++;if(i>=n)return!1}return!0}function XBt(t){return!!t&&t.some(e=>{var r;return e.minScale!=null||((r=e.layerDefinition)==null?void 0:r.minScale)!=null})}function ZBt(t,e){const r=[],i={};return t&&t.forEach(n=>{const s=new BG;if(s.read(n,e),i[s.id]=s,n.parentLayerId!=null&&n.parentLayerId!==-1){const o=i[n.parentLayerId];o.sublayers||(o.sublayers=[]),o.sublayers.unshift(s)}else r.unshift(s)}),r}const GY=St.ofType(BG);function VBe(t,e){t&&t.forEach(r=>{e(r),r.sublayers&&r.sublayers.length&&VBe(r.sublayers,e)})}const JBt=t=>{let e=class extends t{constructor(...r){super(...r),this.allSublayers=new FP({getCollections:()=>[this.sublayers],getChildrenFunction:i=>i.sublayers}),this.sublayersSourceJSON={[We.SERVICE]:{},[We.PORTAL_ITEM]:{},[We.WEB_SCENE]:{},[We.WEB_MAP]:{}},this.addHandles(pe(()=>this.sublayers,(i,n)=>this._handleSublayersChange(i,n),ei))}destroy(){this.allSublayers.destroy()}readSublayers(r,i){if(!i||!r)return;const{sublayersSourceJSON:n}=this,s=Au(i.origin);if(s<We.SERVICE||(n[s]={context:i,visibleLayers:r.visibleLayers||n[s].visibleLayers,layers:r.layers||n[s].layers},s>We.SERVICE))return;this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);const{sublayers:o,origin:a}=this.createSublayersForOrigin("web-document"),l=$s(this);l.setDefaultOrigin(a),this._set("sublayers",new GY(o)),l.setDefaultOrigin("user")}findSublayerById(r){return this.allSublayers.find(i=>i.id===r)}createServiceSublayers(){return this.createSublayersForOrigin("service").sublayers}createSublayersForOrigin(r){const i=Au(r==="web-document"?"web-map":r);let n=We.SERVICE,s=this.sublayersSourceJSON[We.SERVICE].layers,o=this.sublayersSourceJSON[We.SERVICE].context,a=null;const l=[We.PORTAL_ITEM,We.WEB_SCENE,We.WEB_MAP].filter(g=>g<=i);for(const g of l){const y=this.sublayersSourceJSON[g];XBt(y.layers)&&(n=g,s=y.layers,o=y.context,y.visibleLayers&&(a={visibleLayers:y.visibleLayers,context:y.context}))}const c=[We.PORTAL_ITEM,We.WEB_SCENE,We.WEB_MAP].filter(g=>g>n&&g<=i);let u=null;for(const g of c){const{layers:y,visibleLayers:v,context:b}=this.sublayersSourceJSON[g];y&&(u={layers:y,context:b}),v&&(a={visibleLayers:v,context:b})}const h=ZBt(s,o),p=new Map,f=new Set;if(u)for(const g of u.layers)p.set(g.id,g);if(a!=null&&a.visibleLayers)for(const g of a.visibleLayers)f.add(g);return VBe(h,g=>{u&&g.read(p.get(g.id),u.context),a&&g.read({defaultVisibility:f.has(g.id)},a.context)}),{origin:$L(n),sublayers:new GY({items:h})}}read(r,i){super.read(r,i),this.readSublayers(r,i)}_handleSublayersChange(r,i){i&&(i.forEach(n=>{n.parent=null,n.layer=null}),this.removeHandles("sublayers-owner")),r&&(r.forEach(n=>{n.parent=this,n.layer=this}),this.addHandles([r.on("after-add",({item:n})=>{n.parent=this,n.layer=this}),r.on("after-remove",({item:n})=>{n.parent=null,n.layer=null})],"sublayers-owner"),this.type==="tile"&&this.addHandles(r.on("before-changes",n=>{K.getLogger("esri.layers.TileLayer").error(new B("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this})),n.preventDefault()}),"sublayers-owner"))}};return d([m({readOnly:!0})],e.prototype,"allSublayers",void 0),d([m({readOnly:!0,type:St.ofType(BG)})],e.prototype,"serviceSublayers",void 0),d([m({value:null,type:GY,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],e.prototype,"sublayers",void 0),d([m({readOnly:!0})],e.prototype,"sublayersSourceJSON",void 0),e=d([F("esri.layers.mixins.SublayersOwner")],e),e};async function $fr(t,e,r){let i;try{i=await createImageBitmap(t)}catch(n){throw new B("request:server",`Unable to load ${e}`,{url:e,error:n})}return dt(r),i}async function FSe(t,e,r,i,n){let s;try{s=await createImageBitmap(t)}catch(o){throw new B("request:server",`Unable to load tile ${e}/${r}/${i}`,{error:o,level:e,row:r,col:i})}return dt(n),s}var rie;const kSe=["Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Elevation/World_Hillshade","Elevation/World_Hillshade_Dark","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Ocean_Basemap","Reference/World_Boundaries_and_Places","Reference/World_Boundaries_and_Places_Alternate","Reference/World_Transportation","World_Imagery","World_Street_Map","World_Topo_Map"];let so=rie=class extends xVe(rue(JBt(WVt(YVt(rBe(nBe(qVe(UG(BIt(HVe(WVe(LB)))))))))))){constructor(...t){super(...t),this.listMode="show",this.isReference=null,this.operationalLayerType="ArcGISTiledMapServiceLayer",this.resampling=!0,this.sourceJSON=null,this.spatialReference=null,this.path=null,this.sublayers=null,this.type="tile",this.url=null}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}load(t){const e=t!=null?t.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},t).catch(ko).then(()=>this._fetchService(e))),Promise.resolve(this)}get attributionDataUrl(){var e;const t=(e=this.parsedUrl)==null?void 0:e.path.toLowerCase();return t?this._getDefaultAttribution(this._getMapName(t)):null}readSpatialReference(t,e){var r;return(t=t||((r=e.tileInfo)==null?void 0:r.spatialReference))&&Ve.fromJSON(t)}writeSublayers(t,e,r,i){if(!this.loaded||!t)return;const n=t.slice().reverse().flatten(({sublayers:a})=>a&&a.toArray().reverse()).toArray(),s=[],o={writeSublayerStructure:!1,...i};n.forEach(a=>{const l=a.write({},o);s.push(l)}),s.some(a=>Object.keys(a).length>1)&&(e.layers=s)}get tileServers(){var t;return this._getDefaultTileServers((t=this.parsedUrl)==null?void 0:t.path)}castTileServers(t){return Array.isArray(t)?t.map(e=>xs(e).path):null}fetchTile(t,e,r,i={}){const{signal:n}=i,s=this.getTileUrl(t,e,r),o={responseType:"image",signal:n,query:{...this.refreshParameters}};return Vt(s,o).then(a=>a.data)}async fetchImageBitmapTile(t,e,r,i={}){const{signal:n}=i;if(this.fetchTile!==rie.prototype.fetchTile){const l=await this.fetchTile(t,e,r,i);return FSe(l,t,e,r,n)}const s=this.getTileUrl(t,e,r),o={responseType:"blob",signal:n,query:{...this.refreshParameters}},{data:a}=await Vt(s,o);return FSe(a,t,e,r,n)}getTileUrl(t,e,r){var o,a;const i=!this.capabilities.operations.supportsTileMap&&this.supportsBlankTile,n=_b({...(o=this.parsedUrl)==null?void 0:o.query,blankTile:!i&&null,...this.customParameters,token:this.apiKey}),s=this.tileServers;return`${s&&s.length?s[e%s.length]:(a=this.parsedUrl)==null?void 0:a.path}/tile/${t}/${e}/${r}${n?"?"+n:""}`}loadAll(){return Lne(this,t=>{t(this.allSublayers)})}_fetchService(t){return new Promise((e,r)=>{if(this.sourceJSON){if(this.sourceJSON.bandCount!=null&&this.sourceJSON.pixelSizeX!=null)throw new B("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");return void e({data:this.sourceJSON})}if(!this.parsedUrl)throw new B("tile-layer:undefined-url","layer's url is not defined");const i=fm(this.parsedUrl.path);if(i!=null&&i.serverType==="ImageServer")throw new B("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");Vt(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:"json",signal:t}).then(e,r)}).then(e=>{let r=this.url;if(e.ssl&&(r=this.url=r.replace(/^http:/i,"https:")),this.sourceJSON=e.data,this.read(e.data,{origin:"service",url:this.parsedUrl}),this.version===10.1&&!o9(r))return this._fetchServerVersion(r,t).then(i=>{this.read({currentVersion:i})}).catch(()=>{})})}_fetchServerVersion(t,e){if(!rdt(t))return Promise.reject();const r=t.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return Vt(r,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(i=>{if(i.data&&i.data.currentVersion)return i.data.currentVersion;throw new B("tile-layer:version-not-available")})}_getMapName(t){const e=t.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i);return e?e[2]:void 0}_getDefaultAttribution(t){if(t==null)return null;let e;t=t.toLowerCase();for(let r=0,i=kSe.length;r<i;r++)if(e=kSe[r],e.toLowerCase().includes(t))return Tu("//static.arcgis.com/attribution/"+e);return null}_getDefaultTileServers(t){if(t==null)return[];const e=t.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i)!==-1,r=t.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i)!==-1;return e||r?[t,t.replace(e?/server\.arcgisonline/i:/services\.arcgisonline/i,e?"services.arcgisonline":"server.arcgisonline")]:[]}get hasOverriddenFetchTile(){return!this.fetchTile[BBe]}};d([m({readOnly:!0})],so.prototype,"attributionDataUrl",null),d([m({type:["show","hide","hide-children"]})],so.prototype,"listMode",void 0),d([m({json:{read:!0,write:!0}})],so.prototype,"blendMode",void 0),d([m({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],so.prototype,"isReference",void 0),d([m({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],so.prototype,"operationalLayerType",void 0),d([m({type:Boolean})],so.prototype,"resampling",void 0),d([m()],so.prototype,"sourceJSON",void 0),d([m({type:Ve})],so.prototype,"spatialReference",void 0),d([Xe("spatialReference",["spatialReference","tileInfo"])],so.prototype,"readSpatialReference",null),d([m({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],so.prototype,"path",void 0),d([m({readOnly:!0})],so.prototype,"sublayers",void 0),d([nt("sublayers",{layers:{type:[BG]}})],so.prototype,"writeSublayers",null),d([m({json:{read:!1,write:!1}})],so.prototype,"popupEnabled",void 0),d([m()],so.prototype,"tileServers",null),d([Dr("tileServers")],so.prototype,"castTileServers",null),d([m({readOnly:!0,json:{read:!1}})],so.prototype,"type",void 0),d([m(KVe)],so.prototype,"url",void 0),so=rie=d([F("esri.layers.TileLayer")],so);const BBe=Symbol("default-fetch-tile");so.prototype.fetchTile[BBe]=!0;const GBe=so,QBt=Object.freeze(Object.defineProperty({__proto__:null,default:GBe},Symbol.toStringTag,{value:"Module"}));var _ue={exports:{}};_ue.exports;(function(t){(function(e,r,i){function n(l){var c=this,u=a();c.next=function(){var h=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=h-(c.c=h|0)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(l),c.s0<0&&(c.s0+=1),c.s1-=u(l),c.s1<0&&(c.s1+=1),c.s2-=u(l),c.s2<0&&(c.s2+=1),u=null}function s(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function o(l,c){var u=new n(l),h=c&&c.state,p=u.next;return p.int32=function(){return u.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,h&&(typeof h=="object"&&s(h,u),p.state=function(){return s(u,{})}),p}function a(){var l=4022871197,c=function(u){u=String(u);for(var h=0;h<u.length;h++){l+=u.charCodeAt(h);var p=.02519603282416938*l;l=p>>>0,p-=l,p*=l,l=p>>>0,p-=l,l+=p*4294967296}return(l>>>0)*23283064365386963e-26};return c}r&&r.exports?r.exports=o:i&&i.amd?i(function(){return o}):this.alea=o})(h2,t,!1)})(_ue);var KBt=_ue.exports,vue={exports:{}};vue.exports;(function(t){(function(e,r,i){function n(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,l.next()}function s(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var c=new n(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var p=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(p+f)/(1<<21);while(g===0);return g},h.int32=c.next,h.quick=h,u&&(typeof u=="object"&&s(u,c),h.state=function(){return s(c,{})}),h}r&&r.exports?r.exports=o:i&&i.amd?i(function(){return o}):this.xor128=o})(h2,t,!1)})(vue);var e7t=vue.exports,bue={exports:{}};bue.exports;(function(t){(function(e,r,i){function n(a){var l=this,c="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,u==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function s(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var c=new n(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var p=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(p+f)/(1<<21);while(g===0);return g},h.int32=c.next,h.quick=h,u&&(typeof u=="object"&&s(u,c),h.state=function(){return s(c,{})}),h}r&&r.exports?r.exports=o:i&&i.amd?i(function(){return o}):this.xorwow=o})(h2,t,!1)})(bue);var t7t=bue.exports,wue={exports:{}};wue.exports;(function(t){(function(e,r,i){function n(a){var l=this;l.next=function(){var u=l.x,h=l.i,p,f;return p=u[h],p^=p>>>7,f=p^p<<24,p=u[h+1&7],f^=p^p>>>10,p=u[h+3&7],f^=p^p>>>3,p=u[h+4&7],f^=p^p<<7,p=u[h+7&7],p=p^p<<13,f^=p^p<<9,u[h]=f,l.i=h+1&7,f};function c(u,h){var p,f=[];if(h===(h|0))f[0]=h;else for(h=""+h,p=0;p<h.length;++p)f[p&7]=f[p&7]<<15^h.charCodeAt(p)+f[p+1&7]<<13;for(;f.length<8;)f.push(0);for(p=0;p<8&&f[p]===0;++p);for(p==8?f[7]=-1:f[p],u.x=f,u.i=0,p=256;p>0;--p)u.next()}c(l,a)}function s(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var c=new n(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var p=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(p+f)/(1<<21);while(g===0);return g},h.int32=c.next,h.quick=h,u&&(u.x&&s(u,c),h.state=function(){return s(c,{})}),h}r&&r.exports?r.exports=o:i&&i.amd?i(function(){return o}):this.xorshift7=o})(h2,t,!1)})(wue);var r7t=wue.exports,xue={exports:{}};xue.exports;(function(t){(function(e,r,i){function n(a){var l=this;l.next=function(){var u=l.w,h=l.X,p=l.i,f,g;return l.w=u=u+1640531527|0,g=h[p+34&127],f=h[p=p+1&127],g^=g<<13,f^=f<<17,g^=g>>>15,f^=f>>>12,g=h[p]=g^f,l.i=p,g+(u^u>>>16)|0};function c(u,h){var p,f,g,y,v,b=[],w=128;for(h===(h|0)?(f=h,h=null):(h=h+"\0",f=0,w=Math.max(w,h.length)),g=0,y=-32;y<w;++y)h&&(f^=h.charCodeAt((y+32)%h.length)),y===0&&(v=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,y>=0&&(v=v+1640531527|0,p=b[y&127]^=f+v,g=p==0?g+1:0);for(g>=128&&(b[(h&&h.length||0)&127]=-1),g=127,y=4*128;y>0;--y)f=b[g+34&127],p=b[g=g+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,b[g]=f^p;u.w=v,u.X=b,u.i=g}c(l,a)}function s(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var c=new n(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var p=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(p+f)/(1<<21);while(g===0);return g},h.int32=c.next,h.quick=h,u&&(u.X&&s(u,c),h.state=function(){return s(c,{})}),h}r&&r.exports?r.exports=o:i&&i.amd?i(function(){return o}):this.xor4096=o})(h2,t,!1)})(xue);var i7t=xue.exports,Sue={exports:{}};Sue.exports;(function(t){(function(e,r,i){function n(a){var l=this,c="";l.next=function(){var h=l.b,p=l.c,f=l.d,g=l.a;return h=h<<25^h>>>7^p,p=p-f|0,f=f<<24^f>>>8^g,g=g-h|0,l.b=h=h<<20^h>>>12^p,l.c=p=p-f|0,l.d=f<<16^p>>>16^g,l.a=g-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var u=0;u<c.length+20;u++)l.b^=c.charCodeAt(u)|0,l.next()}function s(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var c=new n(a),u=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var p=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(p+f)/(1<<21);while(g===0);return g},h.int32=c.next,h.quick=h,u&&(typeof u=="object"&&s(u,c),h.state=function(){return s(c,{})}),h}r&&r.exports?r.exports=o:i&&i.amd?i(function(){return o}):this.tychei=o})(h2,t,!1)})(Sue);var n7t=Sue.exports,jBe={exports:{}};const s7t={},o7t=Object.freeze(Object.defineProperty({__proto__:null,default:s7t},Symbol.toStringTag,{value:"Module"})),a7t=I7e(o7t);(function(t){(function(e,r,i){var n=256,s=6,o=52,a="random",l=i.pow(n,s),c=i.pow(2,o),u=c*2,h=n-1,p;function f(S,E,P){var M=[];E=E==!0?{entropy:!0}:E||{};var L=b(v(E.entropy?[S,x(r)]:S??w(),3),M),U=new g(M),z=function(){for(var W=U.g(s),V=l,J=0;W<c;)W=(W+J)*n,V*=n,J=U.g(1);for(;W>=u;)W/=2,V/=2,J>>>=1;return(W+J)/V};return z.int32=function(){return U.g(4)|0},z.quick=function(){return U.g(4)/4294967296},z.double=z,b(x(U.S),r),(E.pass||P||function(W,V,J,Y){return Y&&(Y.S&&y(Y,U),W.state=function(){return y(U,{})}),J?(i[a]=W,V):W})(z,L,"global"in E?E.global:this==i,E.state)}function g(S){var E,P=S.length,M=this,L=0,U=M.i=M.j=0,z=M.S=[];for(P||(S=[P++]);L<n;)z[L]=L++;for(L=0;L<n;L++)z[L]=z[U=h&U+S[L%P]+(E=z[L])],z[U]=E;(M.g=function(W){for(var V,J=0,Y=M.i,X=M.j,le=M.S;W--;)V=le[Y=h&Y+1],J=J*n+le[h&(le[Y]=le[X=h&X+V])+(le[X]=V)];return M.i=Y,M.j=X,J})(n)}function y(S,E){return E.i=S.i,E.j=S.j,E.S=S.S.slice(),E}function v(S,E){var P=[],M=typeof S,L;if(E&&M=="object")for(L in S)try{P.push(v(S[L],E-1))}catch{}return P.length?P:M=="string"?S:S+"\0"}function b(S,E){for(var P=S+"",M,L=0;L<P.length;)E[h&L]=h&(M^=E[h&L]*19)+P.charCodeAt(L++);return x(E)}function w(){try{var S;return p&&(S=p.randomBytes)?S=S(n):(S=new Uint8Array(n),(e.crypto||e.msCrypto).getRandomValues(S)),x(S)}catch{var E=e.navigator,P=E&&E.plugins;return[+new Date,e,P,e.screen,x(r)]}}function x(S){return String.fromCharCode.apply(0,S)}if(b(i.random(),r),t.exports){t.exports=f;try{p=a7t}catch{}}else i["seed"+a]=f})(typeof self<"u"?self:h2,[],Math)})(jBe);var l7t=jBe.exports,c7t=KBt,u7t=e7t,h7t=t7t,d7t=r7t,p7t=i7t,f7t=n7t,D2=l7t;D2.alea=c7t;D2.xor128=u7t;D2.xorwow=h7t;D2.xorshift7=d7t;D2.xor4096=p7t;D2.tychei=f7t;var m7t=D2;const g7t=uie(m7t);var HBe={};const y7t="1.5.0",_7t={version:y7t};function qBe(t){return"("+t.x+";"+t.y+")"}function v7t(t){var e=t.toString();return e==="[object Object]"?qBe(t):e}function b7t(t,e){return t.y===e.y?t.x-e.x:t.y-e.y}function w7t(t,e){return t.x===e.x&&t.y===e.y}var Tue={toString:v7t,toStringBase:qBe,compare:b7t,equals:w7t},x7t=Tue,PV=function(t,e){this.name="PointError",this.points=e=e||[],this.message=t||"Invalid Points!";for(var r=0;r<e.length;r++)this.message+=" "+x7t.toString(e[r])};PV.prototype=new Error;PV.prototype.constructor=PV;var Eue=PV,s4=Tue,sn=function(t,e){this.x=+t||0,this.y=+e||0,this._p2t_edge_list=null};sn.prototype.toString=function(){return s4.toStringBase(this)};sn.prototype.toJSON=function(){return{x:this.x,y:this.y}};sn.prototype.clone=function(){return new sn(this.x,this.y)};sn.prototype.set_zero=function(){return this.x=0,this.y=0,this};sn.prototype.set=function(t,e){return this.x=+t||0,this.y=+e||0,this};sn.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this};sn.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this};sn.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this};sn.prototype.mul=function(t){return this.x*=t,this.y*=t,this};sn.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};sn.prototype.normalize=function(){var t=this.length();return this.x/=t,this.y/=t,t};sn.prototype.equals=function(t){return this.x===t.x&&this.y===t.y};sn.negate=function(t){return new sn(-t.x,-t.y)};sn.add=function(t,e){return new sn(t.x+e.x,t.y+e.y)};sn.sub=function(t,e){return new sn(t.x-e.x,t.y-e.y)};sn.mul=function(t,e){return new sn(t*e.x,t*e.y)};sn.cross=function(t,e){return typeof t=="number"?typeof e=="number"?t*e:new sn(-t*e.y,t*e.x):typeof e=="number"?new sn(e*t.y,-e*t.x):t.x*e.y-t.y*e.x};sn.toString=s4.toString;sn.compare=s4.compare;sn.cmp=s4.compare;sn.equals=s4.equals;sn.dot=function(t,e){return t.x*e.x+t.y*e.y};var WBe=sn,S7t=Tue,hi=function(t,e,r){this.points_=[t,e,r],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},jY=S7t.toString;hi.prototype.toString=function(){return"["+jY(this.points_[0])+jY(this.points_[1])+jY(this.points_[2])+"]"};hi.prototype.getPoint=function(t){return this.points_[t]};hi.prototype.GetPoint=hi.prototype.getPoint;hi.prototype.getPoints=function(){return this.points_};hi.prototype.getNeighbor=function(t){return this.neighbors_[t]};hi.prototype.containsPoint=function(t){var e=this.points_;return t===e[0]||t===e[1]||t===e[2]};hi.prototype.containsEdge=function(t){return this.containsPoint(t.p)&&this.containsPoint(t.q)};hi.prototype.containsPoints=function(t,e){return this.containsPoint(t)&&this.containsPoint(e)};hi.prototype.isInterior=function(){return this.interior_};hi.prototype.setInterior=function(t){return this.interior_=t,this};hi.prototype.markNeighborPointers=function(t,e,r){var i=this.points_;if(t===i[2]&&e===i[1]||t===i[1]&&e===i[2])this.neighbors_[0]=r;else if(t===i[0]&&e===i[2]||t===i[2]&&e===i[0])this.neighbors_[1]=r;else if(t===i[0]&&e===i[1]||t===i[1]&&e===i[0])this.neighbors_[2]=r;else throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call")};hi.prototype.markNeighbor=function(t){var e=this.points_;t.containsPoints(e[1],e[2])?(this.neighbors_[0]=t,t.markNeighborPointers(e[1],e[2],this)):t.containsPoints(e[0],e[2])?(this.neighbors_[1]=t,t.markNeighborPointers(e[0],e[2],this)):t.containsPoints(e[0],e[1])&&(this.neighbors_[2]=t,t.markNeighborPointers(e[0],e[1],this))};hi.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null};hi.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1};hi.prototype.pointCW=function(t){var e=this.points_;return t===e[0]?e[2]:t===e[1]?e[0]:t===e[2]?e[1]:null};hi.prototype.pointCCW=function(t){var e=this.points_;return t===e[0]?e[1]:t===e[1]?e[2]:t===e[2]?e[0]:null};hi.prototype.neighborCW=function(t){return t===this.points_[0]?this.neighbors_[1]:t===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]};hi.prototype.neighborCCW=function(t){return t===this.points_[0]?this.neighbors_[2]:t===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]};hi.prototype.getConstrainedEdgeCW=function(t){return t===this.points_[0]?this.constrained_edge[1]:t===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]};hi.prototype.getConstrainedEdgeCCW=function(t){return t===this.points_[0]?this.constrained_edge[2]:t===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]};hi.prototype.getConstrainedEdgeAcross=function(t){return t===this.points_[0]?this.constrained_edge[0]:t===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]};hi.prototype.setConstrainedEdgeCW=function(t,e){t===this.points_[0]?this.constrained_edge[1]=e:t===this.points_[1]?this.constrained_edge[2]=e:this.constrained_edge[0]=e};hi.prototype.setConstrainedEdgeCCW=function(t,e){t===this.points_[0]?this.constrained_edge[2]=e:t===this.points_[1]?this.constrained_edge[0]=e:this.constrained_edge[1]=e};hi.prototype.getDelaunayEdgeCW=function(t){return t===this.points_[0]?this.delaunay_edge[1]:t===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]};hi.prototype.getDelaunayEdgeCCW=function(t){return t===this.points_[0]?this.delaunay_edge[2]:t===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]};hi.prototype.setDelaunayEdgeCW=function(t,e){t===this.points_[0]?this.delaunay_edge[1]=e:t===this.points_[1]?this.delaunay_edge[2]=e:this.delaunay_edge[0]=e};hi.prototype.setDelaunayEdgeCCW=function(t,e){t===this.points_[0]?this.delaunay_edge[2]=e:t===this.points_[1]?this.delaunay_edge[0]=e:this.delaunay_edge[1]=e};hi.prototype.neighborAcross=function(t){return t===this.points_[0]?this.neighbors_[0]:t===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]};hi.prototype.oppositePoint=function(t,e){var r=t.pointCW(e);return this.pointCW(r)};hi.prototype.legalize=function(t,e){var r=this.points_;if(t===r[0])r[1]=r[0],r[0]=r[2],r[2]=e;else if(t===r[1])r[2]=r[1],r[1]=r[0],r[0]=e;else if(t===r[2])r[0]=r[2],r[2]=r[1],r[1]=e;else throw new Error("poly2tri Invalid Triangle.legalize() call")};hi.prototype.index=function(t){var e=this.points_;if(t===e[0])return 0;if(t===e[1])return 1;if(t===e[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")};hi.prototype.edgeIndex=function(t,e){var r=this.points_;if(t===r[0]){if(e===r[1])return 2;if(e===r[2])return 1}else if(t===r[1]){if(e===r[2])return 0;if(e===r[0])return 2}else if(t===r[2]){if(e===r[0])return 1;if(e===r[1])return 0}return-1};hi.prototype.markConstrainedEdgeByIndex=function(t){this.constrained_edge[t]=!0};hi.prototype.markConstrainedEdgeByEdge=function(t){this.markConstrainedEdgeByPoints(t.p,t.q)};hi.prototype.markConstrainedEdgeByPoints=function(t,e){var r=this.points_;e===r[0]&&t===r[1]||e===r[1]&&t===r[0]?this.constrained_edge[2]=!0:e===r[0]&&t===r[2]||e===r[2]&&t===r[0]?this.constrained_edge[1]=!0:(e===r[1]&&t===r[2]||e===r[2]&&t===r[1])&&(this.constrained_edge[0]=!0)};var Cue=hi,Pue={};function T7t(t,e){if(!t)throw new Error(e||"Assert Failed")}var E7t=T7t,Aue={exports:{}},C7t=function(t,e){this.point=t,this.triangle=e||null,this.next=null,this.prev=null,this.value=t.x},Py=function(t,e){this.head_=t,this.tail_=e,this.search_node_=t};Py.prototype.head=function(){return this.head_};Py.prototype.setHead=function(t){this.head_=t};Py.prototype.tail=function(){return this.tail_};Py.prototype.setTail=function(t){this.tail_=t};Py.prototype.search=function(){return this.search_node_};Py.prototype.setSearch=function(t){this.search_node_=t};Py.prototype.findSearchNode=function(){return this.search_node_};Py.prototype.locateNode=function(t){var e=this.search_node_;if(t<e.value){for(;e=e.prev;)if(t>=e.value)return this.search_node_=e,e}else for(;e=e.next;)if(t<e.value)return this.search_node_=e.prev,e.prev;return null};Py.prototype.locatePoint=function(t){var e=t.x,r=this.findSearchNode(e),i=r.point.x;if(e===i){if(t!==r.point)if(t===r.prev.point)r=r.prev;else if(t===r.next.point)r=r.next;else throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call")}else if(e<i)for(;(r=r.prev)&&t!==r.point;);else for(;(r=r.next)&&t!==r.point;);return r&&(this.search_node_=r),r};Aue.exports=Py;Aue.exports.Node=C7t;var YBe=Aue.exports,yO={},BD=1e-12;yO.EPSILON=BD;var pU={CW:1,CCW:-1,COLLINEAR:0};yO.Orientation=pU;function P7t(t,e,r){var i=(t.x-r.x)*(e.y-r.y),n=(t.y-r.y)*(e.x-r.x),s=i-n;return s>-BD&&s<BD?pU.COLLINEAR:s>0?pU.CCW:pU.CW}yO.orient2d=P7t;function A7t(t,e,r,i){var n=(t.x-e.x)*(i.y-e.y)-(i.x-e.x)*(t.y-e.y);if(n>=-BD)return!1;var s=(t.x-r.x)*(i.y-r.y)-(i.x-r.x)*(t.y-r.y);return!(s<=BD)}yO.inScanArea=A7t;function O7t(t,e,r){var i=e.x-t.x,n=e.y-t.y,s=r.x-t.x,o=r.y-t.y;return i*s+n*o<0}yO.isAngleObtuse=O7t;var Oue=E7t,AV=Eue,XBe=Cue,M7t=YBe.Node,o4=yO,R7t=o4.EPSILON,go=o4.Orientation,_a=o4.orient2d,ZBe=o4.inScanArea,USe=o4.isAngleObtuse;function $7t(t){t.initTriangulation(),t.createAdvancingFront(),I7t(t),L7t(t)}function I7t(t){var e,r=t.pointCount();for(e=1;e<r;++e)for(var i=t.getPoint(e),n=D7t(t,i),s=i._p2t_edge_list,o=0;s&&o<s.length;++o)N7t(t,s[o],n)}function L7t(t){for(var e=t.front().head().next.triangle,r=t.front().head().next.point;!e.getConstrainedEdgeCW(r);)e=e.neighborCCW(r);t.meshClean(e)}function D7t(t,e){var r=t.locateNode(e),i=F7t(t,e,r);return e.x<=r.point.x+R7t&&PA(t,r),k7t(t,i),i}function N7t(t,e,r){t.edge_event.constrained_edge=e,t.edge_event.right=e.p.x>e.q.x,!JBe(r.triangle,e.p,e.q)&&(G7t(t,e,r),Mue(t,e.p,e.q,r.triangle,e.q))}function Mue(t,e,r,i,n){if(!JBe(i,e,r)){var s=i.pointCCW(n),o=_a(r,s,e);if(o===go.COLLINEAR)throw new AV("poly2tri EdgeEvent: Collinear not supported!",[r,s,e]);var a=i.pointCW(n),l=_a(r,a,e);if(l===go.COLLINEAR)throw new AV("poly2tri EdgeEvent: Collinear not supported!",[r,a,e]);o===l?(o===go.CW?i=i.neighborCCW(n):i=i.neighborCW(n),Mue(t,e,r,i,n)):Iue(t,e,r,i,n)}}function JBe(t,e,r){var i=t.edgeIndex(e,r);if(i!==-1){t.markConstrainedEdgeByIndex(i);var n=t.getNeighbor(i);return n&&n.markConstrainedEdgeByPoints(e,r),!0}return!1}function F7t(t,e,r){var i=new XBe(e,r.point,r.next.point);i.markNeighbor(r.triangle),t.addToMap(i);var n=new M7t(e);return n.next=r.next,n.prev=r,r.next.prev=n,r.next=n,Qb(t,i)||t.mapTriangleToNodes(i),n}function PA(t,e){var r=new XBe(e.prev.point,e.point,e.next.point);r.markNeighbor(e.prev.triangle),r.markNeighbor(e.triangle),t.addToMap(r),e.prev.next=e.next,e.next.prev=e.prev,Qb(t,r)||t.mapTriangleToNodes(r)}function k7t(t,e){for(var r=e.next;r.next&&!USe(r.point,r.next.point,r.prev.point);)PA(t,r),r=r.next;for(r=e.prev;r.prev&&!USe(r.point,r.next.point,r.prev.point);)PA(t,r),r=r.prev;e.next&&e.next.next&&U7t(e)&&V7t(t,e)}function U7t(t){var e=t.point.x-t.next.next.point.x,r=t.point.y-t.next.next.point.y;return Oue(r>=0,"unordered y"),e>=0||Math.abs(e)<r}function Qb(t,e){for(var r=0;r<3;++r)if(!e.delaunay_edge[r]){var i=e.getNeighbor(r);if(i){var n=e.getPoint(r),s=i.oppositePoint(e,n),o=i.index(s);if(i.constrained_edge[o]||i.delaunay_edge[o]){e.constrained_edge[r]=i.constrained_edge[o];continue}var a=z7t(n,e.pointCCW(n),e.pointCW(n),s);if(a){e.delaunay_edge[r]=!0,i.delaunay_edge[o]=!0,QBe(e,n,i,s);var l=!Qb(t,e);return l&&t.mapTriangleToNodes(e),l=!Qb(t,i),l&&t.mapTriangleToNodes(i),e.delaunay_edge[r]=!1,i.delaunay_edge[o]=!1,!0}}}return!1}function z7t(t,e,r,i){var n=t.x-i.x,s=t.y-i.y,o=e.x-i.x,a=e.y-i.y,l=n*a,c=o*s,u=l-c;if(u<=0)return!1;var h=r.x-i.x,p=r.y-i.y,f=h*s,g=n*p,y=f-g;if(y<=0)return!1;var v=o*p,b=h*a,w=n*n+s*s,x=o*o+a*a,S=h*h+p*p,E=w*(v-b)+x*y+S*u;return E>0}function QBe(t,e,r,i){var n,s,o,a;n=t.neighborCCW(e),s=t.neighborCW(e),o=r.neighborCCW(i),a=r.neighborCW(i);var l,c,u,h;l=t.getConstrainedEdgeCCW(e),c=t.getConstrainedEdgeCW(e),u=r.getConstrainedEdgeCCW(i),h=r.getConstrainedEdgeCW(i);var p,f,g,y;p=t.getDelaunayEdgeCCW(e),f=t.getDelaunayEdgeCW(e),g=r.getDelaunayEdgeCCW(i),y=r.getDelaunayEdgeCW(i),t.legalize(e,i),r.legalize(i,e),r.setDelaunayEdgeCCW(e,p),t.setDelaunayEdgeCW(e,f),t.setDelaunayEdgeCCW(i,g),r.setDelaunayEdgeCW(i,y),r.setConstrainedEdgeCCW(e,l),t.setConstrainedEdgeCW(e,c),t.setConstrainedEdgeCCW(i,u),r.setConstrainedEdgeCW(i,h),t.clearNeighbors(),r.clearNeighbors(),n&&r.markNeighbor(n),s&&t.markNeighbor(s),o&&t.markNeighbor(o),a&&r.markNeighbor(a),t.markNeighbor(r)}function V7t(t,e){for(_a(e.point,e.next.point,e.next.next.point)===go.CCW?t.basin.left_node=e.next.next:t.basin.left_node=e.next,t.basin.bottom_node=t.basin.left_node;t.basin.bottom_node.next&&t.basin.bottom_node.point.y>=t.basin.bottom_node.next.point.y;)t.basin.bottom_node=t.basin.bottom_node.next;if(t.basin.bottom_node!==t.basin.left_node){for(t.basin.right_node=t.basin.bottom_node;t.basin.right_node.next&&t.basin.right_node.point.y<t.basin.right_node.next.point.y;)t.basin.right_node=t.basin.right_node.next;t.basin.right_node!==t.basin.bottom_node&&(t.basin.width=t.basin.right_node.point.x-t.basin.left_node.point.x,t.basin.left_highest=t.basin.left_node.point.y>t.basin.right_node.point.y,KBe(t,t.basin.bottom_node))}}function KBe(t,e){if(!B7t(t,e)){PA(t,e);var r;if(!(e.prev===t.basin.left_node&&e.next===t.basin.right_node)){if(e.prev===t.basin.left_node){if(r=_a(e.point,e.next.point,e.next.next.point),r===go.CW)return;e=e.next}else if(e.next===t.basin.right_node){if(r=_a(e.point,e.prev.point,e.prev.prev.point),r===go.CCW)return;e=e.prev}else e.prev.point.y<e.next.point.y?e=e.prev:e=e.next;KBe(t,e)}}}function B7t(t,e){var r;return t.basin.left_highest?r=t.basin.left_node.point.y-e.point.y:r=t.basin.right_node.point.y-e.point.y,t.basin.width>r}function G7t(t,e,r){t.edge_event.right?j7t(t,e,r):H7t(t,e,r)}function j7t(t,e,r){for(;r.next.point.x<e.p.x;)_a(e.q,r.next.point,e.p)===go.CCW?e7e(t,e,r):r=r.next}function e7e(t,e,r){r.point.x<e.p.x&&(_a(r.point,r.next.point,r.next.next.point)===go.CCW?Rue(t,e,r):(t7e(t,e,r),e7e(t,e,r)))}function Rue(t,e,r){PA(t,r.next),r.next.point!==e.p&&_a(e.q,r.next.point,e.p)===go.CCW&&_a(r.point,r.next.point,r.next.next.point)===go.CCW&&Rue(t,e,r)}function t7e(t,e,r){_a(r.next.point,r.next.next.point,r.next.next.next.point)===go.CCW?Rue(t,e,r.next):_a(e.q,r.next.next.point,e.p)===go.CCW&&t7e(t,e,r.next)}function H7t(t,e,r){for(;r.prev.point.x>e.p.x;)_a(e.q,r.prev.point,e.p)===go.CW?r7e(t,e,r):r=r.prev}function r7e(t,e,r){r.point.x>e.p.x&&(_a(r.point,r.prev.point,r.prev.prev.point)===go.CW?$ue(t,e,r):(i7e(t,e,r),r7e(t,e,r)))}function i7e(t,e,r){_a(r.prev.point,r.prev.prev.point,r.prev.prev.prev.point)===go.CW?$ue(t,e,r.prev):_a(e.q,r.prev.prev.point,e.p)===go.CW&&i7e(t,e,r.prev)}function $ue(t,e,r){PA(t,r.prev),r.prev.point!==e.p&&_a(e.q,r.prev.point,e.p)===go.CW&&_a(r.point,r.prev.point,r.prev.prev.point)===go.CW&&$ue(t,e,r)}function Iue(t,e,r,i,n){var s=i.neighborAcross(n);Oue(s,"FLIP failed due to missing triangle!");var o=s.oppositePoint(i,n);if(i.getConstrainedEdgeAcross(n)){var a=i.index(n);throw new AV("poly2tri Intersecting Constraints",[n,o,i.getPoint((a+1)%3),i.getPoint((a+2)%3)])}if(ZBe(n,i.pointCCW(n),i.pointCW(n),o))if(QBe(i,n,s,o),t.mapTriangleToNodes(i),t.mapTriangleToNodes(s),n===r&&o===e)r===t.edge_event.constrained_edge.q&&e===t.edge_event.constrained_edge.p&&(i.markConstrainedEdgeByPoints(e,r),s.markConstrainedEdgeByPoints(e,r),Qb(t,i),Qb(t,s));else{var l=_a(r,o,e);i=q7t(t,l,i,s,n,o),Iue(t,e,r,i,n)}else{var c=n7e(e,r,s,o);s7e(t,e,r,i,s,c),Mue(t,e,r,i,n)}}function q7t(t,e,r,i,n,s){var o;return e===go.CCW?(o=i.edgeIndex(n,s),i.delaunay_edge[o]=!0,Qb(t,i),i.clearDelaunayEdges(),r):(o=r.edgeIndex(n,s),r.delaunay_edge[o]=!0,Qb(t,r),r.clearDelaunayEdges(),i)}function n7e(t,e,r,i){var n=_a(e,i,t);if(n===go.CW)return r.pointCCW(i);if(n===go.CCW)return r.pointCW(i);throw new AV("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[e,i,t])}function s7e(t,e,r,i,n,s){var o=n.neighborAcross(s);Oue(o,"FLIP failed due to missing triangle");var a=o.oppositePoint(n,s);if(ZBe(r,i.pointCCW(r),i.pointCW(r),a))Iue(t,r,a,o,a);else{var l=n7e(e,r,o,a);s7e(t,e,r,i,o,l)}}Pue.triangulate=$7t;var W7t=Eue,zM=WBe,Y7t=Cue,X7t=Pue,o7e=YBe,HY=o7e.Node,zSe=.3,Z7t=function(t,e){if(this.p=t,this.q=e,t.y>e.y)this.q=t,this.p=e;else if(t.y===e.y){if(t.x>e.x)this.q=t,this.p=e;else if(t.x===e.x)throw new W7t("poly2tri Invalid Edge constructor: repeated points!",[t])}this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},a7e=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};a7e.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var J7t=function(){this.constrained_edge=null,this.right=!1},Zi=function(t,e){e=e||{},this.triangles_=[],this.map_=[],this.points_=e.cloneArrays?t.slice(0):t,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new a7e,this.edge_event=new J7t,this.initEdges(this.points_)};Zi.prototype.addHole=function(t){this.initEdges(t);var e,r=t.length;for(e=0;e<r;e++)this.points_.push(t[e]);return this};Zi.prototype.AddHole=Zi.prototype.addHole;Zi.prototype.addHoles=function(t){var e,r=t.length;for(e=0;e<r;e++)this.initEdges(t[e]);return this.points_=this.points_.concat.apply(this.points_,t),this};Zi.prototype.addPoint=function(t){return this.points_.push(t),this};Zi.prototype.AddPoint=Zi.prototype.addPoint;Zi.prototype.addPoints=function(t){return this.points_=this.points_.concat(t),this};Zi.prototype.triangulate=function(){return X7t.triangulate(this),this};Zi.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}};Zi.prototype.getTriangles=function(){return this.triangles_};Zi.prototype.GetTriangles=Zi.prototype.getTriangles;Zi.prototype.front=function(){return this.front_};Zi.prototype.pointCount=function(){return this.points_.length};Zi.prototype.head=function(){return this.head_};Zi.prototype.setHead=function(t){this.head_=t};Zi.prototype.tail=function(){return this.tail_};Zi.prototype.setTail=function(t){this.tail_=t};Zi.prototype.getMap=function(){return this.map_};Zi.prototype.initTriangulation=function(){var t=this.points_[0].x,e=this.points_[0].x,r=this.points_[0].y,i=this.points_[0].y,n,s=this.points_.length;for(n=1;n<s;n++){var o=this.points_[n];o.x>t&&(t=o.x),o.x<e&&(e=o.x),o.y>r&&(r=o.y),o.y<i&&(i=o.y)}this.pmin_=new zM(e,i),this.pmax_=new zM(t,r);var a=zSe*(t-e),l=zSe*(r-i);this.head_=new zM(t+a,i-l),this.tail_=new zM(e-a,i-l),this.points_.sort(zM.compare)};Zi.prototype.initEdges=function(t){var e,r=t.length;for(e=0;e<r;++e)this.edge_list.push(new Z7t(t[e],t[(e+1)%r]))};Zi.prototype.getPoint=function(t){return this.points_[t]};Zi.prototype.addToMap=function(t){this.map_.push(t)};Zi.prototype.locateNode=function(t){return this.front_.locateNode(t.x)};Zi.prototype.createAdvancingFront=function(){var t,e,r,i=new Y7t(this.points_[0],this.tail_,this.head_);this.map_.push(i),t=new HY(i.getPoint(1),i),e=new HY(i.getPoint(0),i),r=new HY(i.getPoint(2)),this.front_=new o7e(t,r),t.next=e,e.next=r,e.prev=t,r.prev=e};Zi.prototype.removeNode=function(t){};Zi.prototype.mapTriangleToNodes=function(t){for(var e=0;e<3;++e)if(!t.getNeighbor(e)){var r=this.front_.locatePoint(t.pointCW(t.getPoint(e)));r&&(r.triangle=t)}};Zi.prototype.removeFromMap=function(t){var e,r=this.map_,i=r.length;for(e=0;e<i;e++)if(r[e]===t){r.splice(e,1);break}};Zi.prototype.meshClean=function(t){for(var e=[t],r,i;r=e.pop();)if(!r.isInterior())for(r.setInterior(!0),this.triangles_.push(r),i=0;i<3;i++)r.constrained_edge[i]||e.push(r.getNeighbor(i))};var Q7t=Zi;(function(t){t.noConflict=function(){return t},t.VERSION=_7t.version,t.PointError=Eue,t.Point=WBe,t.Triangle=Cue,t.SweepContext=Q7t;var e=Pue;t.triangulate=e.triangulate,t.sweep={Triangulate:e.triangulate}})(HBe);const K7t=uie(HBe),eGt=new g7t("lowpoly");async function tGt(t){const r=await(await fetch("../assets/steinerPoints_simplified.json")).json(),n=await(await fetch("../assets/land_simplified.json")).json();let s={};for(let{properties:o,geometry:a}of r.features){const l=o.CID;s[l]||(s[l]=[]),s[l].push(a.coordinates)}for(let o of n.features){const a=o.properties.FID_1,{geometry:l}=o,c=iGt(l),u=new Hu({geometry:c,symbol:{type:"mesh-3d",symbolLayers:[{type:"fill"}]}});t.add(u);const h=s[a]||null,p=nGt(l,h),f=p.vertices.map(function(P){return[P.x,P.y,P.z]}),g=f.map(function(P){const{r:M,g:L,b:U}=rGt(P[1]);return[M,L,U,255]}),y=[].concat.apply([],f),v=[].concat.apply([],g),b=p.triangles.map(function(P){return P.getPoints().map(L=>L.vertexId)}),w=[].concat.apply([],b),x=new Eb({faces:w,shading:"flat",material:new dse({metallic:0,roughness:1,doubleSided:!1})}),S=new u7({components:[x],vertexAttributes:{position:y,color:v},spatialReference:Ve.WebMercator}),E=new Hu({geometry:S,symbol:{type:"mesh-3d",symbolLayers:[{type:"fill"}]}});t.add(E)}}function rGt(t){const e=[{value:-Math.pow(10,7),color:new De([255,255,255])},{value:-5*Math.pow(10,6),color:new De([186,214,75])},{value:0,color:new De([248,250,182])},{value:6*Math.pow(10,6),color:new De([186,214,75])},{value:Math.pow(10,7),color:new De([255,255,255])}];for(let r=0;r<e.length;r++){const i=e[r];if(t<i.value){if(r===0)return i.color;const n=e[r-1],s=(t-n.value)/(i.value-n.value);return De.blendColors(n.color,i.color,s)}}return e[e.length-1].color}function iGt(t){const e=t.coordinates[0].map(o=>[o[0],o[1],25e4]),r=[],i=e.length;for(let o=0;o<i;o++){const a=o,l=(o+1)%e.length,c=i+o,u=i+(o+1)%e.length,h=[].concat.apply([],e[a]);h[2]=1e5,e.push(h),o!==i-1&&r.push(l,c,a,u,c,l)}const n=[].concat.apply([],e);return new u7({vertexAttributes:{position:n},components:[{faces:r,material:{color:[255,255,255],metallic:.8,doubleSided:!0}}],spatialReference:{wkid:3857}})}function nGt(t,e){let r=[],i=null;e&&(i=e.map(a=>{const l=r.length,c={x:a[0],y:a[1],z:25e4+1e5*eGt(),vertexId:l};return r.push(c),c}));const n=t.coordinates[0].map(a=>{const l=r.length,c={x:a[0],y:a[1],z:25e4,vertexId:l};return r.push(c),c});n.pop(),r.pop();const s=new K7t.SweepContext(n,{cloneArrays:!0});return i&&s.addPoints(i),s.triangulate(),{triangles:s.getTriangles(),vertices:r}}class qY{constructor(e,r,i,n){this.name=e,this.speed=r,this.carbonEmissionRate=i,this.icon=n,this.milesTraveled=0,this.color={red:[255,0,0],green:[0,255,0],blue:[0,0,255]}[n]}displayInfo(){console.log(`Speed: ${this.speed} km/h, Carbon Emission: ${this.carbonEmissionRate} g/km, Icon: ${this.icon}`)}}const Fk={air:[new qY("plane",500,10,"red")],land:[new qY("car",75,1,"green")],sea:[new qY("cargo ship",5,100,"blue")]},l7e=$n.createContext(),sGt=({children:t,maxTime:e=60})=>{const[r,i]=$n.useState(),[n,s]=$n.useState(0),[o,a]=$n.useState(!1),[l,c]=$n.useState(0),[u,h]=$n.useState(0),[p,f]=$n.useState({x:0,y:0,z:35e4,headingDegrees:0}),[g,y]=$n.useState(Fk),[v,b]=$n.useState(g.air[0]);$n.useEffect(()=>{function x(E){E.key==="1"?b(Fk.air[0]):E.key==="2"?b(Fk.land[0]):E.key==="3"&&b(Fk.sea[0])}document.addEventListener("keydown",x);function S(E){E.key==="w"?f(P=>({...P,headingDegrees:(P.headingDegrees+5)%360})):E.key==="s"&&f(P=>({...P,headingDegrees:(P.headingDegrees-5)%360}))}return document.addEventListener("keydown",S),()=>{document.removeEventListener("keydown",x),document.removeEventListener("keydown",S)}},[]),$n.useEffect(()=>{const x=setInterval(()=>{const E=Math.floor((new Date-r)/1e3);s(E),E>=e&&(a(!0),clearInterval(x))},1e3);return()=>clearInterval(x)},[r]),$n.useEffect(()=>{const x=setInterval(()=>{if(r){o&&clearInterval(x);var S=150;f(E=>{const P={...E};return P.x+=S*v.speed*Math.cos(E.headingDegrees*Math.PI/180),P.y+=S*v.speed*Math.sin(E.headingDegrees*Math.PI/180),P}),h(E=>E+v.carbonEmissionRate)}},100);return()=>clearInterval(x)},[r,o,v]),$n.useEffect(()=>{},[p]);const w={vehicleLocation:p,setVehicleLocation:f,numVisited:l,setNumVisited:c,totalCO2:u,setTotalCO2:h,currentVehicle:v,setCurrentVehicle:b,gameOver:o,setGameOver:a,elapsedTime:n,setStartTime:i};return Su.jsx(l7e.Provider,{value:w,children:t})},GG=()=>$n.useContext(l7e);function oGt({}){const[t,e]=$n.useState(),[r,i]=$n.useState(),[n,s]=$n.useState({}),[o,a]=$n.useState(),{vehicleLocation:l,currentVehicle:c,setNumVisited:u,setGameOver:h,setStartTime:p}=GG();return $n.useEffect(()=>{const g=new Bxe({opacity:.6}),y=new Bxe({elevationInfo:{mode:"absolute-height",offset:0}}),v=new He({x:0,y:90,z:-6378137});u7.createFromGLTF(v,"/assets/low_poly_sphere.glb").then(E=>{E.scale(6378137*1.02);const P=new Hu({geometry:E,symbol:{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:[31,255,240]}}]}});g.add(P)});const b=new IBe({url:"https://services9.arcgis.com/FF3qnCUixr5w9JQi/arcgis/rest/services/lowPolyLandmarks/SceneServer"}),w=new GBe({url:"https://tiles.arcgis.com/tiles/FF3qnCUixr5w9JQi/arcgis/rest/services/Ocean_shore_buffer/MapServer"}),x=new BPe({layers:[g,y,b,w],ground:{opacity:1,surfaceColor:[33,69,128]}}),S=new $Ut({container:"viewDiv",map:x,alphaCompositingEnabled:!0,qualityProfile:"high",environment:{background:{type:"color",color:[0,0,0,0]},lighting:{directShadowsEnabled:!0,type:"virtual"},starsEnabled:!1,atmosphereEnabled:!1}});window.view=S,tGt(y),e(y),lGt(b).then(s),VSe({meshLandLayer:y,vehicleLocation:l,currentVehicle:c}),S.whenLayerView(b).then(a).then(()=>{p(new Date)}),console.log("initializing")},[]),$n.useEffect(()=>{t&&r&&t.remove(r),i(VSe({meshLayer:t,vehicleLocation:l,currentVehicle:c}))},[l,c]),$n.useEffect(()=>{o&&l&&aGt({vehicleLocation:l,landmarksLayerView:o,setLandmarks:s})},[l,o]),$n.useEffect(()=>{const f=Object.values(n).reduce((g,y)=>y.visited?g+1:g,0);u(f),f>0&&f===Object.values(n).length&&h(!0)},[n]),Su.jsx("div",{id:"viewDiv",style:{height:"100vh",width:"100vw"}})}function VSe({meshLayer:t,vehicleLocation:e,currentVehicle:r}){const i=new He({x:e.x,y:e.y,z:e.z,spatialReference:Ve.WebMercator}),n={type:"simple-marker",color:r.color,size:"24px"},s={type:"text",color:"black",text:r.name,font:{size:12,family:"Arial"},xoffset:20,yoffset:10},o={type:"point-3d",symbolLayers:[{type:"icon",resource:{primitive:"circle"},material:{color:n.color},size:n.size},{type:"text",text:s.text,material:{color:s.color},size:s.font.size}]},a=new Hu({geometry:i,symbol:o});return t&&t.add(a),a}function aGt({vehicleLocation:t,landmarksLayerView:e,setLandmarks:r,distance:i=1e5}){const n={geometry:{type:"point",x:t.x,y:t.y,z:t.z},distance:i,units:"meters",spatialRelationship:"intersects",returnGeometry:!1,outFields:["OBJECTID"]};e.queryFeatures(n).then(s=>{s.features.length>0&&r(o=>{const a={...o};return s.features.forEach(l=>{a[l.attributes.OBJECTID].visited=!0}),a})})}async function lGt(t){let e=t.createQuery();return e.where="1=1",e.returnGeometry=!0,t.queryFeatures(e).then(function(r){const i={};return r.features.forEach(function(n){i[n.attributes.OBJECTID]={visited:!1,name:n.attributes.Name,x:n.geometry.origin.x,y:n.geometry.origin.y,z:n.geometry.origin.z}}),i}).catch(function(r){console.error("Query error: ",r)})}var Iu=function(){return Iu=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Iu.apply(this,arguments)};function OV(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,s;i<n;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}var rs="-ms-",dL="-moz-",Qi="-webkit-",c7e="comm",jG="rule",Lue="decl",cGt="@import",u7e="@keyframes",uGt="@layer",h7e=Math.abs,Due=String.fromCharCode,iie=Object.assign;function hGt(t,e){return $a(t,0)^45?(((e<<2^$a(t,0))<<2^$a(t,1))<<2^$a(t,2))<<2^$a(t,3):0}function d7e(t){return t.trim()}function x0(t,e){return(t=e.exec(t))?t[0]:t}function qr(t,e,r){return t.replace(e,r)}function fU(t,e,r){return t.indexOf(e,r)}function $a(t,e){return t.charCodeAt(e)|0}function AA(t,e,r){return t.slice(e,r)}function Eg(t){return t.length}function p7e(t){return t.length}function K$(t,e){return e.push(t),t}function dGt(t,e){return t.map(e).join("")}function BSe(t,e){return t.filter(function(r){return!x0(r,e)})}var HG=1,OA=1,f7e=0,yp=0,zo=0,_O="";function qG(t,e,r,i,n,s,o,a){return{value:t,root:e,parent:r,type:i,props:n,children:s,line:HG,column:OA,length:o,return:"",siblings:a}}function lv(t,e){return iie(qG("",null,null,"",null,null,0,t.siblings),t,{length:-t.length},e)}function ZE(t){for(;t.root;)t=lv(t.root,{children:[t]});K$(t,t.siblings)}function pGt(){return zo}function fGt(){return zo=yp>0?$a(_O,--yp):0,OA--,zo===10&&(OA=1,HG--),zo}function sm(){return zo=yp<f7e?$a(_O,yp++):0,OA++,zo===10&&(OA=1,HG++),zo}function AT(){return $a(_O,yp)}function mU(){return yp}function WG(t,e){return AA(_O,t,e)}function nie(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function mGt(t){return HG=OA=1,f7e=Eg(_O=t),yp=0,[]}function gGt(t){return _O="",t}function WY(t){return d7e(WG(yp-1,sie(t===91?t+2:t===40?t+1:t)))}function yGt(t){for(;(zo=AT())&&zo<33;)sm();return nie(t)>2||nie(zo)>3?"":" "}function _Gt(t,e){for(;--e&&sm()&&!(zo<48||zo>102||zo>57&&zo<65||zo>70&&zo<97););return WG(t,mU()+(e<6&&AT()==32&&sm()==32))}function sie(t){for(;sm();)switch(zo){case t:return yp;case 34:case 39:t!==34&&t!==39&&sie(zo);break;case 40:t===41&&sie(t);break;case 92:sm();break}return yp}function vGt(t,e){for(;sm()&&t+zo!==57;)if(t+zo===84&&AT()===47)break;return"/*"+WG(e,yp-1)+"*"+Due(t===47?t:sm())}function bGt(t){for(;!nie(AT());)sm();return WG(t,yp)}function wGt(t){return gGt(gU("",null,null,null,[""],t=mGt(t),0,[0],t))}function gU(t,e,r,i,n,s,o,a,l){for(var c=0,u=0,h=o,p=0,f=0,g=0,y=1,v=1,b=1,w=0,x="",S=n,E=s,P=i,M=x;v;)switch(g=w,w=sm()){case 40:if(g!=108&&$a(M,h-1)==58){fU(M+=qr(WY(w),"&","&\f"),"&\f",h7e(c?a[c-1]:0))!=-1&&(b=-1);break}case 34:case 39:case 91:M+=WY(w);break;case 9:case 10:case 13:case 32:M+=yGt(g);break;case 92:M+=_Gt(mU()-1,7);continue;case 47:switch(AT()){case 42:case 47:K$(xGt(vGt(sm(),mU()),e,r,l),l);break;default:M+="/"}break;case 123*y:a[c++]=Eg(M)*b;case 125*y:case 59:case 0:switch(w){case 0:case 125:v=0;case 59+u:b==-1&&(M=qr(M,/\f/g,"")),f>0&&Eg(M)-h&&K$(f>32?jSe(M+";",i,r,h-1,l):jSe(qr(M," ","")+";",i,r,h-2,l),l);break;case 59:M+=";";default:if(K$(P=GSe(M,e,r,c,u,n,a,x,S=[],E=[],h,s),s),w===123)if(u===0)gU(M,e,P,P,S,s,h,a,E);else switch(p===99&&$a(M,3)===110?100:p){case 100:case 108:case 109:case 115:gU(t,P,P,i&&K$(GSe(t,P,P,0,0,n,a,x,n,S=[],h,E),E),n,E,h,a,i?S:E);break;default:gU(M,P,P,P,[""],E,0,a,E)}}c=u=f=0,y=b=1,x=M="",h=o;break;case 58:h=1+Eg(M),f=g;default:if(y<1){if(w==123)--y;else if(w==125&&y++==0&&fGt()==125)continue}switch(M+=Due(w),w*y){case 38:b=u>0?1:(M+="\f",-1);break;case 44:a[c++]=(Eg(M)-1)*b,b=1;break;case 64:AT()===45&&(M+=WY(sm())),p=AT(),u=h=Eg(x=M+=bGt(mU())),w++;break;case 45:g===45&&Eg(M)==2&&(y=0)}}return s}function GSe(t,e,r,i,n,s,o,a,l,c,u,h){for(var p=n-1,f=n===0?s:[""],g=p7e(f),y=0,v=0,b=0;y<i;++y)for(var w=0,x=AA(t,p+1,p=h7e(v=o[y])),S=t;w<g;++w)(S=d7e(v>0?f[w]+" "+x:qr(x,/&\f/g,f[w])))&&(l[b++]=S);return qG(t,e,r,n===0?jG:a,l,c,u,h)}function xGt(t,e,r,i){return qG(t,e,r,c7e,Due(pGt()),AA(t,2,-2),0,i)}function jSe(t,e,r,i,n){return qG(t,e,r,Lue,AA(t,0,i),AA(t,i+1,-1),i,n)}function m7e(t,e,r){switch(hGt(t,e)){case 5103:return Qi+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Qi+t+t;case 4789:return dL+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return Qi+t+dL+t+rs+t+t;case 5936:switch($a(t,e+11)){case 114:return Qi+t+rs+qr(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return Qi+t+rs+qr(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return Qi+t+rs+qr(t,/[svh]\w+-[tblr]{2}/,"lr")+t}case 6828:case 4268:case 2903:return Qi+t+rs+t+t;case 6165:return Qi+t+rs+"flex-"+t+t;case 5187:return Qi+t+qr(t,/(\w+).+(:[^]+)/,Qi+"box-$1$2"+rs+"flex-$1$2")+t;case 5443:return Qi+t+rs+"flex-item-"+qr(t,/flex-|-self/g,"")+(x0(t,/flex-|baseline/)?"":rs+"grid-row-"+qr(t,/flex-|-self/g,""))+t;case 4675:return Qi+t+rs+"flex-line-pack"+qr(t,/align-content|flex-|-self/g,"")+t;case 5548:return Qi+t+rs+qr(t,"shrink","negative")+t;case 5292:return Qi+t+rs+qr(t,"basis","preferred-size")+t;case 6060:return Qi+"box-"+qr(t,"-grow","")+Qi+t+rs+qr(t,"grow","positive")+t;case 4554:return Qi+qr(t,/([^-])(transform)/g,"$1"+Qi+"$2")+t;case 6187:return qr(qr(qr(t,/(zoom-|grab)/,Qi+"$1"),/(image-set)/,Qi+"$1"),t,"")+t;case 5495:case 3959:return qr(t,/(image-set\([^]*)/,Qi+"$1$`$1");case 4968:return qr(qr(t,/(.+:)(flex-)?(.*)/,Qi+"box-pack:$3"+rs+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Qi+t+t;case 4200:if(!x0(t,/flex-|baseline/))return rs+"grid-column-align"+AA(t,e)+t;break;case 2592:case 3360:return rs+qr(t,"template-","")+t;case 4384:case 3616:return r&&r.some(function(i,n){return e=n,x0(i.props,/grid-\w+-end/)})?~fU(t+(r=r[e].value),"span",0)?t:rs+qr(t,"-start","")+t+rs+"grid-row-span:"+(~fU(r,"span",0)?x0(r,/\d+/):+x0(r,/\d+/)-+x0(t,/\d+/))+";":rs+qr(t,"-start","")+t;case 4896:case 4128:return r&&r.some(function(i){return x0(i.props,/grid-\w+-start/)})?t:rs+qr(qr(t,"-end","-span"),"span ","")+t;case 4095:case 3583:case 4068:case 2532:return qr(t,/(.+)-inline(.+)/,Qi+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Eg(t)-1-e>6)switch($a(t,e+1)){case 109:if($a(t,e+4)!==45)break;case 102:return qr(t,/(.+:)(.+)-([^]+)/,"$1"+Qi+"$2-$3$1"+dL+($a(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~fU(t,"stretch",0)?m7e(qr(t,"stretch","fill-available"),e,r)+t:t}break;case 5152:case 5920:return qr(t,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(i,n,s,o,a,l,c){return rs+n+":"+s+c+(o?rs+n+"-span:"+(a?l:+l-+s)+c:"")+t});case 4949:if($a(t,e+6)===121)return qr(t,":",":"+Qi)+t;break;case 6444:switch($a(t,$a(t,14)===45?18:11)){case 120:return qr(t,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Qi+($a(t,14)===45?"inline-":"")+"box$3$1"+Qi+"$2$3$1"+rs+"$2box$3")+t;case 100:return qr(t,":",":"+rs)+t}break;case 5719:case 2647:case 2135:case 3927:case 2391:return qr(t,"scroll-","scroll-snap-")+t}return t}function MV(t,e){for(var r="",i=0;i<t.length;i++)r+=e(t[i],i,t,e)||"";return r}function SGt(t,e,r,i){switch(t.type){case uGt:if(t.children.length)break;case cGt:case Lue:return t.return=t.return||t.value;case c7e:return"";case u7e:return t.return=t.value+"{"+MV(t.children,i)+"}";case jG:if(!Eg(t.value=t.props.join(",")))return""}return Eg(r=MV(t.children,i))?t.return=t.value+"{"+r+"}":""}function TGt(t){var e=p7e(t);return function(r,i,n,s){for(var o="",a=0;a<e;a++)o+=t[a](r,i,n,s)||"";return o}}function EGt(t){return function(e){e.root||(e=e.return)&&t(e)}}function CGt(t,e,r,i){if(t.length>-1&&!t.return)switch(t.type){case Lue:t.return=m7e(t.value,t.length,r);return;case u7e:return MV([lv(t,{value:qr(t.value,"@","@"+Qi)})],i);case jG:if(t.length)return dGt(r=t.props,function(n){switch(x0(n,i=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":ZE(lv(t,{props:[qr(n,/:(read-\w+)/,":"+dL+"$1")]})),ZE(lv(t,{props:[n]})),iie(t,{props:BSe(r,i)});break;case"::placeholder":ZE(lv(t,{props:[qr(n,/:(plac\w+)/,":"+Qi+"input-$1")]})),ZE(lv(t,{props:[qr(n,/:(plac\w+)/,":"+dL+"$1")]})),ZE(lv(t,{props:[qr(n,/:(plac\w+)/,rs+"input-$1")]})),ZE(lv(t,{props:[n]})),iie(t,{props:BSe(r,i)});break}return""})}}var PGt={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},vh={},MA=typeof process<"u"&&vh!==void 0&&(vh.REACT_APP_SC_ATTR||vh.SC_ATTR)||"data-styled",g7e="active",y7e="data-styled-version",YG="6.1.8",Nue=`/*!sc*/
`,Fue=typeof window<"u"&&"HTMLElement"in window,AGt=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&vh!==void 0&&vh.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&vh.REACT_APP_SC_DISABLE_SPEEDY!==""?vh.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&vh.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&vh!==void 0&&vh.SC_DISABLE_SPEEDY!==void 0&&vh.SC_DISABLE_SPEEDY!==""&&vh.SC_DISABLE_SPEEDY!=="false"&&vh.SC_DISABLE_SPEEDY),XG=Object.freeze([]),RA=Object.freeze({});function OGt(t,e,r){return r===void 0&&(r=RA),t.theme!==r.theme&&t.theme||e||r.theme}var _7e=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),MGt=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,RGt=/(^-|-$)/g;function HSe(t){return t.replace(MGt,"-").replace(RGt,"")}var $Gt=/(a)(d)/gi,kk=52,qSe=function(t){return String.fromCharCode(t+(t>25?39:97))};function oie(t){var e,r="";for(e=Math.abs(t);e>kk;e=e/kk|0)r=qSe(e%kk)+r;return(qSe(e%kk)+r).replace($Gt,"$1-$2")}var YY,v7e=5381,A3=function(t,e){for(var r=e.length;r;)t=33*t^e.charCodeAt(--r);return t},b7e=function(t){return A3(v7e,t)};function IGt(t){return oie(b7e(t)>>>0)}function LGt(t){return t.displayName||t.name||"Component"}function XY(t){return typeof t=="string"&&!0}var w7e=typeof Symbol=="function"&&Symbol.for,x7e=w7e?Symbol.for("react.memo"):60115,DGt=w7e?Symbol.for("react.forward_ref"):60112,NGt={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},FGt={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},S7e={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},kGt=((YY={})[DGt]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},YY[x7e]=S7e,YY);function WSe(t){return("type"in(e=t)&&e.type.$$typeof)===x7e?S7e:"$$typeof"in t?kGt[t.$$typeof]:NGt;var e}var UGt=Object.defineProperty,zGt=Object.getOwnPropertyNames,YSe=Object.getOwnPropertySymbols,VGt=Object.getOwnPropertyDescriptor,BGt=Object.getPrototypeOf,XSe=Object.prototype;function T7e(t,e,r){if(typeof e!="string"){if(XSe){var i=BGt(e);i&&i!==XSe&&T7e(t,i,r)}var n=zGt(e);YSe&&(n=n.concat(YSe(e)));for(var s=WSe(t),o=WSe(e),a=0;a<n.length;++a){var l=n[a];if(!(l in FGt||r&&r[l]||o&&l in o||s&&l in s)){var c=VGt(e,l);try{UGt(t,l,c)}catch{}}}}return t}function $A(t){return typeof t=="function"}function kue(t){return typeof t=="object"&&"styledComponentId"in t}function sT(t,e){return t&&e?"".concat(t," ").concat(e):t||e||""}function ZSe(t,e){if(t.length===0)return"";for(var r=t[0],i=1;i<t.length;i++)r+=e?e+t[i]:t[i];return r}function GD(t){return t!==null&&typeof t=="object"&&t.constructor.name===Object.name&&!("props"in t&&t.$$typeof)}function aie(t,e,r){if(r===void 0&&(r=!1),!r&&!GD(t)&&!Array.isArray(t))return e;if(Array.isArray(e))for(var i=0;i<e.length;i++)t[i]=aie(t[i],e[i]);else if(GD(e))for(var i in e)t[i]=aie(t[i],e[i]);return t}function Uue(t,e){Object.defineProperty(t,"toString",{value:e})}function a4(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(t," for more information.").concat(e.length>0?" Args: ".concat(e.join(", ")):""))}var GGt=function(){function t(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return t.prototype.indexOfGroup=function(e){for(var r=0,i=0;i<e;i++)r+=this.groupSizes[i];return r},t.prototype.insertRules=function(e,r){if(e>=this.groupSizes.length){for(var i=this.groupSizes,n=i.length,s=n;e>=s;)if((s<<=1)<0)throw a4(16,"".concat(e));this.groupSizes=new Uint32Array(s),this.groupSizes.set(i),this.length=s;for(var o=n;o<s;o++)this.groupSizes[o]=0}for(var a=this.indexOfGroup(e+1),l=(o=0,r.length);o<l;o++)this.tag.insertRule(a,r[o])&&(this.groupSizes[e]++,a++)},t.prototype.clearGroup=function(e){if(e<this.length){var r=this.groupSizes[e],i=this.indexOfGroup(e),n=i+r;this.groupSizes[e]=0;for(var s=i;s<n;s++)this.tag.deleteRule(i)}},t.prototype.getGroup=function(e){var r="";if(e>=this.length||this.groupSizes[e]===0)return r;for(var i=this.groupSizes[e],n=this.indexOfGroup(e),s=n+i,o=n;o<s;o++)r+="".concat(this.tag.getRule(o)).concat(Nue);return r},t}(),yU=new Map,RV=new Map,_U=1,Uk=function(t){if(yU.has(t))return yU.get(t);for(;RV.has(_U);)_U++;var e=_U++;return yU.set(t,e),RV.set(e,t),e},jGt=function(t,e){_U=e+1,yU.set(t,e),RV.set(e,t)},HGt="style[".concat(MA,"][").concat(y7e,'="').concat(YG,'"]'),qGt=new RegExp("^".concat(MA,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),WGt=function(t,e,r){for(var i,n=r.split(","),s=0,o=n.length;s<o;s++)(i=n[s])&&t.registerName(e,i)},YGt=function(t,e){for(var r,i=((r=e.textContent)!==null&&r!==void 0?r:"").split(Nue),n=[],s=0,o=i.length;s<o;s++){var a=i[s].trim();if(a){var l=a.match(qGt);if(l){var c=0|parseInt(l[1],10),u=l[2];c!==0&&(jGt(u,c),WGt(t,u,l[3]),t.getTag().insertRules(c,n)),n.length=0}else n.push(a)}}};function XGt(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var E7e=function(t){var e=document.head,r=t||e,i=document.createElement("style"),n=function(a){var l=Array.from(a.querySelectorAll("style[".concat(MA,"]")));return l[l.length-1]}(r),s=n!==void 0?n.nextSibling:null;i.setAttribute(MA,g7e),i.setAttribute(y7e,YG);var o=XGt();return o&&i.setAttribute("nonce",o),r.insertBefore(i,s),i},ZGt=function(){function t(e){this.element=E7e(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(r){if(r.sheet)return r.sheet;for(var i=document.styleSheets,n=0,s=i.length;n<s;n++){var o=i[n];if(o.ownerNode===r)return o}throw a4(17)}(this.element),this.length=0}return t.prototype.insertRule=function(e,r){try{return this.sheet.insertRule(r,e),this.length++,!0}catch{return!1}},t.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},t.prototype.getRule=function(e){var r=this.sheet.cssRules[e];return r&&r.cssText?r.cssText:""},t}(),JGt=function(){function t(e){this.element=E7e(e),this.nodes=this.element.childNodes,this.length=0}return t.prototype.insertRule=function(e,r){if(e<=this.length&&e>=0){var i=document.createTextNode(r);return this.element.insertBefore(i,this.nodes[e]||null),this.length++,!0}return!1},t.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},t.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},t}(),QGt=function(){function t(e){this.rules=[],this.length=0}return t.prototype.insertRule=function(e,r){return e<=this.length&&(this.rules.splice(e,0,r),this.length++,!0)},t.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},t.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},t}(),JSe=Fue,KGt={isServer:!Fue,useCSSOMInjection:!AGt},C7e=function(){function t(e,r,i){e===void 0&&(e=RA),r===void 0&&(r={});var n=this;this.options=Iu(Iu({},KGt),e),this.gs=r,this.names=new Map(i),this.server=!!e.isServer,!this.server&&Fue&&JSe&&(JSe=!1,function(s){for(var o=document.querySelectorAll(HGt),a=0,l=o.length;a<l;a++){var c=o[a];c&&c.getAttribute(MA)!==g7e&&(YGt(s,c),c.parentNode&&c.parentNode.removeChild(c))}}(this)),Uue(this,function(){return function(s){for(var o=s.getTag(),a=o.length,l="",c=function(h){var p=function(b){return RV.get(b)}(h);if(p===void 0)return"continue";var f=s.names.get(p),g=o.getGroup(h);if(f===void 0||g.length===0)return"continue";var y="".concat(MA,".g").concat(h,'[id="').concat(p,'"]'),v="";f!==void 0&&f.forEach(function(b){b.length>0&&(v+="".concat(b,","))}),l+="".concat(g).concat(y,'{content:"').concat(v,'"}').concat(Nue)},u=0;u<a;u++)c(u);return l}(n)})}return t.registerId=function(e){return Uk(e)},t.prototype.reconstructWithOptions=function(e,r){return r===void 0&&(r=!0),new t(Iu(Iu({},this.options),e),this.gs,r&&this.names||void 0)},t.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},t.prototype.getTag=function(){return this.tag||(this.tag=(e=function(r){var i=r.useCSSOMInjection,n=r.target;return r.isServer?new QGt(n):i?new ZGt(n):new JGt(n)}(this.options),new GGt(e)));var e},t.prototype.hasNameForId=function(e,r){return this.names.has(e)&&this.names.get(e).has(r)},t.prototype.registerName=function(e,r){if(Uk(e),this.names.has(e))this.names.get(e).add(r);else{var i=new Set;i.add(r),this.names.set(e,i)}},t.prototype.insertRules=function(e,r,i){this.registerName(e,r),this.getTag().insertRules(Uk(e),i)},t.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},t.prototype.clearRules=function(e){this.getTag().clearGroup(Uk(e)),this.clearNames(e)},t.prototype.clearTag=function(){this.tag=void 0},t}(),ejt=/&/g,tjt=/^\s*\/\/.*$/gm;function P7e(t,e){return t.map(function(r){return r.type==="rule"&&(r.value="".concat(e," ").concat(r.value),r.value=r.value.replaceAll(",",",".concat(e," ")),r.props=r.props.map(function(i){return"".concat(e," ").concat(i)})),Array.isArray(r.children)&&r.type!=="@keyframes"&&(r.children=P7e(r.children,e)),r})}function rjt(t){var e,r,i,n=t===void 0?RA:t,s=n.options,o=s===void 0?RA:s,a=n.plugins,l=a===void 0?XG:a,c=function(p,f,g){return g.startsWith(r)&&g.endsWith(r)&&g.replaceAll(r,"").length>0?".".concat(e):p},u=l.slice();u.push(function(p){p.type===jG&&p.value.includes("&")&&(p.props[0]=p.props[0].replace(ejt,r).replace(i,c))}),o.prefix&&u.push(CGt),u.push(SGt);var h=function(p,f,g,y){f===void 0&&(f=""),g===void 0&&(g=""),y===void 0&&(y="&"),e=y,r=f,i=new RegExp("\\".concat(r,"\\b"),"g");var v=p.replace(tjt,""),b=wGt(g||f?"".concat(g," ").concat(f," { ").concat(v," }"):v);o.namespace&&(b=P7e(b,o.namespace));var w=[];return MV(b,TGt(u.concat(EGt(function(x){return w.push(x)})))),w};return h.hash=l.length?l.reduce(function(p,f){return f.name||a4(15),A3(p,f.name)},v7e).toString():"",h}var ijt=new C7e,lie=rjt(),A7e=pL.createContext({shouldForwardProp:void 0,styleSheet:ijt,stylis:lie});A7e.Consumer;pL.createContext(void 0);function QSe(){return $n.useContext(A7e)}var njt=function(){function t(e,r){var i=this;this.inject=function(n,s){s===void 0&&(s=lie);var o=i.name+s.hash;n.hasNameForId(i.id,o)||n.insertRules(i.id,o,s(i.rules,o,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=r,Uue(this,function(){throw a4(12,String(i.name))})}return t.prototype.getName=function(e){return e===void 0&&(e=lie),this.name+e.hash},t}(),sjt=function(t){return t>="A"&&t<="Z"};function KSe(t){for(var e="",r=0;r<t.length;r++){var i=t[r];if(r===1&&i==="-"&&t[0]==="-")return t;sjt(i)?e+="-"+i.toLowerCase():e+=i}return e.startsWith("ms-")?"-"+e:e}var O7e=function(t){return t==null||t===!1||t===""},M7e=function(t){var e,r,i=[];for(var n in t){var s=t[n];t.hasOwnProperty(n)&&!O7e(s)&&(Array.isArray(s)&&s.isCss||$A(s)?i.push("".concat(KSe(n),":"),s,";"):GD(s)?i.push.apply(i,OV(OV(["".concat(n," {")],M7e(s),!1),["}"],!1)):i.push("".concat(KSe(n),": ").concat((e=n,(r=s)==null||typeof r=="boolean"||r===""?"":typeof r!="number"||r===0||e in PGt||e.startsWith("--")?String(r).trim():"".concat(r,"px")),";")))}return i};function OT(t,e,r,i){if(O7e(t))return[];if(kue(t))return[".".concat(t.styledComponentId)];if($A(t)){if(!$A(s=t)||s.prototype&&s.prototype.isReactComponent||!e)return[t];var n=t(e);return OT(n,e,r,i)}var s;return t instanceof njt?r?(t.inject(r,i),[t.getName(i)]):[t]:GD(t)?M7e(t):Array.isArray(t)?Array.prototype.concat.apply(XG,t.map(function(o){return OT(o,e,r,i)})):[t.toString()]}function ojt(t){for(var e=0;e<t.length;e+=1){var r=t[e];if($A(r)&&!kue(r))return!1}return!0}var ajt=b7e(YG),ljt=function(){function t(e,r,i){this.rules=e,this.staticRulesId="",this.isStatic=(i===void 0||i.isStatic)&&ojt(e),this.componentId=r,this.baseHash=A3(ajt,r),this.baseStyle=i,C7e.registerId(r)}return t.prototype.generateAndInjectStyles=function(e,r,i){var n=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,r,i):"";if(this.isStatic&&!i.hash)if(this.staticRulesId&&r.hasNameForId(this.componentId,this.staticRulesId))n=sT(n,this.staticRulesId);else{var s=ZSe(OT(this.rules,e,r,i)),o=oie(A3(this.baseHash,s)>>>0);if(!r.hasNameForId(this.componentId,o)){var a=i(s,".".concat(o),void 0,this.componentId);r.insertRules(this.componentId,o,a)}n=sT(n,o),this.staticRulesId=o}else{for(var l=A3(this.baseHash,i.hash),c="",u=0;u<this.rules.length;u++){var h=this.rules[u];if(typeof h=="string")c+=h;else if(h){var p=ZSe(OT(h,e,r,i));l=A3(l,p+u),c+=p}}if(c){var f=oie(l>>>0);r.hasNameForId(this.componentId,f)||r.insertRules(this.componentId,f,i(c,".".concat(f),void 0,this.componentId)),n=sT(n,f)}}return n},t}(),R7e=pL.createContext(void 0);R7e.Consumer;var ZY={};function cjt(t,e,r){var i=kue(t),n=t,s=!XY(t),o=e.attrs,a=o===void 0?XG:o,l=e.componentId,c=l===void 0?function(S,E){var P=typeof S!="string"?"sc":HSe(S);ZY[P]=(ZY[P]||0)+1;var M="".concat(P,"-").concat(IGt(YG+P+ZY[P]));return E?"".concat(E,"-").concat(M):M}(e.displayName,e.parentComponentId):l,u=e.displayName,h=u===void 0?function(S){return XY(S)?"styled.".concat(S):"Styled(".concat(LGt(S),")")}(t):u,p=e.displayName&&e.componentId?"".concat(HSe(e.displayName),"-").concat(e.componentId):e.componentId||c,f=i&&n.attrs?n.attrs.concat(a).filter(Boolean):a,g=e.shouldForwardProp;if(i&&n.shouldForwardProp){var y=n.shouldForwardProp;if(e.shouldForwardProp){var v=e.shouldForwardProp;g=function(S,E){return y(S,E)&&v(S,E)}}else g=y}var b=new ljt(r,p,i?n.componentStyle:void 0);function w(S,E){return function(P,M,L){var U=P.attrs,z=P.componentStyle,W=P.defaultProps,V=P.foldedComponentIds,J=P.styledComponentId,Y=P.target,X=pL.useContext(R7e),le=QSe(),D=P.shouldForwardProp||le.shouldForwardProp,I=OGt(M,X,W)||RA,k=function(Ae,Ze,Et){for(var xt,Qe=Iu(Iu({},Ze),{className:void 0,theme:Et}),Ke=0;Ke<Ae.length;Ke+=1){var Ge=$A(xt=Ae[Ke])?xt(Qe):xt;for(var Jt in Ge)Qe[Jt]=Jt==="className"?sT(Qe[Jt],Ge[Jt]):Jt==="style"?Iu(Iu({},Qe[Jt]),Ge[Jt]):Ge[Jt]}return Ze.className&&(Qe.className=sT(Qe.className,Ze.className)),Qe}(U,M,I),j=k.as||Y,q={};for(var Q in k)k[Q]===void 0||Q[0]==="$"||Q==="as"||Q==="theme"&&k.theme===I||(Q==="forwardedAs"?q.as=k.forwardedAs:D&&!D(Q,j)||(q[Q]=k[Q]));var ie=function(Ae,Ze){var Et=QSe(),xt=Ae.generateAndInjectStyles(Ze,Et.styleSheet,Et.stylis);return xt}(z,k),ye=sT(V,J);return ie&&(ye+=" "+ie),k.className&&(ye+=" "+k.className),q[XY(j)&&!_7e.has(j)?"class":"className"]=ye,q.ref=L,$n.createElement(j,q)}(x,S,E)}w.displayName=h;var x=pL.forwardRef(w);return x.attrs=f,x.componentStyle=b,x.displayName=h,x.shouldForwardProp=g,x.foldedComponentIds=i?sT(n.foldedComponentIds,n.styledComponentId):"",x.styledComponentId=p,x.target=i?n.target:t,Object.defineProperty(x,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(S){this._foldedDefaultProps=i?function(E){for(var P=[],M=1;M<arguments.length;M++)P[M-1]=arguments[M];for(var L=0,U=P;L<U.length;L++)aie(E,U[L],!0);return E}({},n.defaultProps,S):S}}),Uue(x,function(){return".".concat(x.styledComponentId)}),s&&T7e(x,t,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),x}function eTe(t,e){for(var r=[t[0]],i=0,n=e.length;i<n;i+=1)r.push(e[i],t[i+1]);return r}var tTe=function(t){return Object.assign(t,{isCss:!0})};function ujt(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if($A(t)||GD(t))return tTe(OT(eTe(XG,OV([t],e,!0))));var i=t;return e.length===0&&i.length===1&&typeof i[0]=="string"?OT(i):tTe(OT(eTe(i,e)))}function cie(t,e,r){if(r===void 0&&(r=RA),!e)throw a4(1,e);var i=function(n){for(var s=[],o=1;o<arguments.length;o++)s[o-1]=arguments[o];return t(e,r,ujt.apply(void 0,OV([n],s,!1)))};return i.attrs=function(n){return cie(t,e,Iu(Iu({},r),{attrs:Array.prototype.concat(r.attrs,n).filter(Boolean)}))},i.withConfig=function(n){return cie(t,e,Iu(Iu({},r),n))},i}var $7e=function(t){return cie(cjt,t)},zue=$7e;_7e.forEach(function(t){zue[t]=$7e(t)});const hjt=zue("div")`
    position:absolute;
    top:0;
    right:0;
    font-size:3vmin;
    color:white;
`;function djt({}){const{elapsedTime:t,numVisited:e,totalCO2:r}=GG();return Su.jsxs(hjt,{children:[Su.jsxs("p",{children:[" Time Elapsed: ",t||0," seconds "]}),Su.jsxs("p",{children:[" Visited: ",e," landmarks  "]}),Su.jsxs("p",{children:[" Carbon Emissions: ",r," tons "]})]})}const pjt=zue("div")`
    white-space: nowrap;
    font-size:10vmin;
    background-color:black;
    color:white;
    position:absolute;
    top:50%;
    left:50%;
    transform: translate(-50%,-50%);
`;function fjt({}){return GG(),Su.jsx(pjt,{children:"Game Over!"})}function mjt(){const{gameOver:t}=GG();return Su.jsxs(Su.Fragment,{children:[Su.jsx(oGt,{}),Su.jsx(djt,{}),t&&Su.jsx(fjt,{})]})}JY.createRoot(document.getElementById("root")).render(Su.jsx(sGt,{children:Su.jsx(mjt,{})}));const gjt=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:K3,build:GLe},Symbol.toStringTag,{value:"Module"})),yjt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:cae,build:oDe},Symbol.toStringTag,{value:"Module"})),_jt=Object.freeze(Object.defineProperty({__proto__:null,build:dDe},Symbol.toStringTag,{value:"Module"})),vjt=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:mae,build:vDe},Symbol.toStringTag,{value:"Module"})),bjt=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:gae,build:xDe},Symbol.toStringTag,{value:"Module"})),wjt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:_ae,build:UDe},Symbol.toStringTag,{value:"Module"})),xjt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:wae,SimpleAtmospherePassParameters:Y7,build:YDe},Symbol.toStringTag,{value:"Module"})),Sjt=Object.freeze(Object.defineProperty({__proto__:null,build:iNe},Symbol.toStringTag,{value:"Module"})),Tjt=Object.freeze(Object.defineProperty({__proto__:null,build:oNe},Symbol.toStringTag,{value:"Module"})),Ejt=Object.freeze(Object.defineProperty({__proto__:null,build:V4e,calculateAnchorPosForRendering:bD},Symbol.toStringTag,{value:"Module"})),Cjt=Object.freeze(Object.defineProperty({__proto__:null,build:F5e},Symbol.toStringTag,{value:"Module"})),Pjt=Object.freeze(Object.defineProperty({__proto__:null,build:z5e,getRadius:gG},Symbol.toStringTag,{value:"Module"})),Ajt=Object.freeze(Object.defineProperty({__proto__:null,build:j5e},Symbol.toStringTag,{value:"Module"})),Ojt=Object.freeze(Object.defineProperty({__proto__:null,build:q5e},Symbol.toStringTag,{value:"Module"})),Mjt=Object.freeze(Object.defineProperty({__proto__:null,build:aFe},Symbol.toStringTag,{value:"Module"})),Rjt=Object.freeze(Object.defineProperty({__proto__:null,build:pke,ribbonlineNumRoundJoinSubdivisions:CD},Symbol.toStringTag,{value:"Module"})),$jt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Ple,build:GFe},Symbol.toStringTag,{value:"Module"})),Ijt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:kle,build:Cke},Symbol.toStringTag,{value:"Module"})),Ljt=Object.freeze(Object.defineProperty({__proto__:null,build:G6e},Symbol.toStringTag,{value:"Module"})),Djt=Object.freeze(Object.defineProperty({__proto__:null,build:J6e},Symbol.toStringTag,{value:"Module"})),Njt=Object.freeze(Object.defineProperty({__proto__:null,build:M8e},Symbol.toStringTag,{value:"Module"})),Fjt=Object.freeze(Object.defineProperty({__proto__:null,build:F8e},Symbol.toStringTag,{value:"Module"})),kjt=Object.freeze(Object.defineProperty({__proto__:null,build:z8e},Symbol.toStringTag,{value:"Module"})),Ujt=Object.freeze(Object.defineProperty({__proto__:null,build:J8e},Symbol.toStringTag,{value:"Module"})),zjt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Ece,build:XUe},Symbol.toStringTag,{value:"Module"})),Vjt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Jb},build:yze},Symbol.toStringTag,{value:"Module"})),Bjt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:WUe,ColorizerStretchUniforms:qUe,ColorizerUniforms:YN,build:YUe},Symbol.toStringTag,{value:"Module"})),Gjt=Object.freeze(Object.defineProperty({__proto__:null,build:Lze},Symbol.toStringTag,{value:"Module"})),jjt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:$G,build:Gze},Symbol.toStringTag,{value:"Module"})),Hjt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Bce,build:Hze},Symbol.toStringTag,{value:"Module"})),qjt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:Gce,build:Yze},Symbol.toStringTag,{value:"Module"})),Wjt=Object.freeze(Object.defineProperty({__proto__:null,build:r9e},Symbol.toStringTag,{value:"Module"})),Yjt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:qce,build:s9e},Symbol.toStringTag,{value:"Module"})),Xjt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:jce,blurSize:Hce,build:t9e,gridCellPixelSize:gf,outlineSize:kD},Symbol.toStringTag,{value:"Module"})),Zjt=Object.freeze(Object.defineProperty({__proto__:null,build:u9e},Symbol.toStringTag,{value:"Module"})),Jjt=Object.freeze(Object.defineProperty({__proto__:null,build:p9e},Symbol.toStringTag,{value:"Module"})),Qjt=Object.freeze(Object.defineProperty({__proto__:null,build:g9e},Symbol.toStringTag,{value:"Module"})),Kjt=Object.freeze(Object.defineProperty({__proto__:null,build:v9e},Symbol.toStringTag,{value:"Module"})),eHt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:Yce,build:S9e},Symbol.toStringTag,{value:"Module"})),tHt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:ZN,build:x9e},Symbol.toStringTag,{value:"Module"})),rHt=Object.freeze(Object.defineProperty({__proto__:null,build:O9e},Symbol.toStringTag,{value:"Module"}));export{Ve as $,li as A,MB as B,db as C,DT as D,un as E,HEe as F,Xu as G,ju as H,Is as I,R as J,tt as K,wA as L,Zs as M,Ule as N,Zb as O,mi as P,nr as Q,gi as R,Pe as S,yo as T,zQt as U,St as V,vD as W,VQt as X,zi as Y,ga as Z,re as _,B as a,vIe as a$,um as a0,it as a1,me as a2,se as a3,K as a4,C as a5,Uhr as a6,FP as a7,mzt as a8,on as a9,hN as aA,apr as aB,opr as aC,ma as aD,ae as aE,eZe as aF,QXe as aG,bb as aH,Hhr as aI,Sze as aJ,Fz as aK,kz as aL,SXt as aM,Nne as aN,UL as aO,UT as aP,Vt as aQ,He as aR,Ff as aS,VA as aT,br as aU,une as aV,eB as aW,tst as aX,_7 as aY,nN as aZ,Ft as a_,qtr as aa,Wtr as ab,LB as ac,J1t as ad,h_ as ae,ec as af,Ter as ag,Lnr as ah,cfr as ai,wfr as aj,ave as ak,Ct as al,MVt as am,sfr as an,O2 as ao,De as ap,Gv as aq,Qoe as ar,HIe as as,ght as at,A2 as au,tO as av,Dt as aw,jt as ax,HX as ay,EEe as az,i3e as b,Ds as b$,wXt as b0,xXt as b1,pYt as b2,Qnt as b3,gYt as b4,mYt as b5,Fb as b6,fYt as b7,hw as b8,hue as b9,nt as bA,nOe as bB,sV as bC,LRe as bD,bfr as bE,Xt as bF,NBe as bG,u7 as bH,XT as bI,QWt as bJ,rN as bK,tYt as bL,QOe as bM,lsr as bN,Zg as bO,Ei as bP,t6 as bQ,FYe as bR,Qf as bS,vtr as bT,Edr as bU,Ome as bV,fut as bW,Ub as bX,bs as bY,Cdr as bZ,gt as b_,Xe as ba,l9t as bb,a9t as bc,Fme as bd,o9 as be,zT as bf,Se as bg,f2 as bh,WCt as bi,YCt as bj,Ii as bk,cN as bl,udt as bm,qT as bn,dt as bo,pZt as bp,ylr as bq,_ce as br,hB as bs,Xn as bt,fl as bu,sN as bv,j$t as bw,sp as bx,MYe as by,z9t as bz,F as c,_b as c$,rw as c0,LWt as c1,ktr as c2,Ht as c3,kc as c4,upr as c5,Rfr as c6,Tct as c7,EYt as c8,iz as c9,KAe as cA,ZXe as cB,fm as cC,idt as cD,YHt as cE,xs as cF,u9t as cG,O9t as cH,Aqt as cI,gpr as cJ,Y9t as cK,iBe as cL,Ho as cM,JEt as cN,QEt as cO,KEt as cP,kA as cQ,ds as cR,WVt as cS,qVe as cT,rBe as cU,nBe as cV,UG as cW,HIt as cX,lr as cY,ko as cZ,jIt as c_,ck as ca,GP as cb,dT as cc,If as cd,ol as ce,Lf as cf,kJe as cg,wze as ch,Vqt as ci,rT as cj,efr as ck,bSe as cl,Kpr as cm,_Vt as cn,$Be as co,zct as cp,zVt as cq,xut as cr,HA as cs,KP as ct,lw as cu,yZ as cv,is as cw,gZ as cx,vZ as cy,dz as cz,pe as d,m3e as d$,JA as d0,KVe as d1,xVe as d2,BIt as d3,rue as d4,ai as d5,tBe as d6,zzt as d7,Zu as d8,vp as d9,Bxe as dA,Tu as dB,Pj as dC,$ht as dD,kG as dE,Itr as dF,$Fe as dG,Iwt as dH,d3e as dI,wFe as dJ,Fct as dK,zoe as dL,o2 as dM,mut as dN,EXt as dO,put as dP,TXt as dQ,Ng as dR,nb as dS,J3 as dT,Af as dU,Ce as dV,_e as dW,ge as dX,ze as dY,he as dZ,an as d_,U7 as da,pw as db,MFe as dc,zc as dd,ul as de,ni as df,JBt as dg,YVt as dh,HVe as di,WVe as dj,Au as dk,We as dl,Mfr as dm,TYt as dn,AP as dp,$fr as dq,Lne as dr,jnt as ds,BG as dt,Vi as du,AN as dv,ab as dw,Yet as dx,hT as dy,GZ as dz,d as e,Qhr as e$,j3e as e0,H3e as e1,rn as e2,cbe as e3,For as e4,S$t as e5,Vzt as e6,m2 as e7,pHt as e8,GWe as e9,A5t as eA,b5t as eB,Kur as eC,fV as eD,tur as eE,M5t as eF,cm as eG,LOe as eH,tut as eI,RFe as eJ,$tr as eK,Rtr as eL,LZe as eM,HM as eN,Aoe as eO,aee as eP,lb as eQ,pu as eR,Gc as eS,xu as eT,Iz as eU,di as eV,EHt as eW,cWt as eX,Jle as eY,Y4 as eZ,tht as e_,CP as ea,Ane as eb,OHe as ec,mN as ed,qL as ee,rdt as ef,bXt as eg,Y9e as eh,Yhr as ei,Xhr as ej,Jhr as ek,_8t as el,h8t as em,Nh as en,cHt as eo,D_ as ep,z$t as eq,V$t as er,s_ as es,jHt as et,JHt as eu,LBe as ev,fBt as ew,Nc as ex,BA as ey,P5t as ez,ei as f,Wzt as f$,Whr as f0,Sb as f1,_st as f2,nHt as f3,hSe as f4,ny as f5,jX as f6,mpr as f7,Hzt as f8,fpr as f9,gr as fA,SZ as fB,Lo as fC,oV as fD,WYe as fE,YYe as fF,XYe as fG,ZYe as fH,we as fI,to as fJ,sl as fK,Mc as fL,aQt as fM,lN as fN,Go as fO,Tn as fP,dB as fQ,Si as fR,la as fS,c_ as fT,Cs as fU,zhr as fV,VZ as fW,lpr as fX,sSe as fY,c9t as fZ,ay as f_,qzt as fa,Oqt as fb,jzt as fc,dSe as fd,s9t as fe,pSe as ff,ZZe as fg,xe as fh,Nor as fi,ff as fj,WU as fk,$nr as fl,RL as fm,r9t as fn,w_ as fo,fce as fp,xUe as fq,QC as fr,ib as fs,pLt as ft,ZYt as fu,EPe as fv,JD as fw,iIe as fx,op as fy,ope as fz,ne as g,gB as g$,SBe as g0,f9t as g1,RBe as g2,US as g3,xd as g4,X$ as g5,J$ as g6,SVe as g7,BVe as g8,QVe as g9,hp as gA,yr as gB,XP as gC,get as gD,Ese as gE,bDt as gF,V6t as gG,Dr as gH,soe as gI,Ld as gJ,Tb as gK,FSe as gL,xI as gM,TZ as gN,XHt as gO,IBt as gP,kpr as gQ,spr as gR,Rzt as gS,npr as gT,Mzt as gU,LL as gV,lWt as gW,sYt as gX,KWt as gY,Efr as gZ,vr as g_,D7 as ga,w9t as gb,JL as gc,YAe as gd,Bet as ge,ee as gf,Te as gg,Npe as gh,hLt as gi,pp as gj,ha as gk,$se as gl,Vet as gm,qi as gn,e3 as go,ZP as gp,Ut as gq,xer as gr,wer as gs,uw as gt,$or as gu,Dz as gv,qb as gw,D9 as gx,FN as gy,po as gz,em as h,qee as h$,xb as h0,Dme as h1,Uzt as h2,fue as h3,_Se as h4,Fre as h5,VVe as h6,kzt as h7,LBt as h8,QJe as h9,IVe as hA,pnr as hB,nCt as hC,dnr as hD,Lzt as hE,v9t as hF,ndt as hG,wpr as hH,xpr as hI,Spr as hJ,Epr as hK,Cpr as hL,Ppr as hM,Apr as hN,Opr as hO,Mpr as hP,Rpr as hQ,$pr as hR,Ipr as hS,nB as hT,cpr as hU,due as hV,JC as hW,uJ as hX,Str as hY,Ise as hZ,mwt as h_,JJe as ha,bJe as hb,Xde as hc,ypr as hd,$s as he,o9t as hf,a_ as hg,CA as hh,JT as hi,RWt as hj,_$t as hk,Zqt as hl,DBt as hm,F3 as hn,YWe as ho,oy as hp,Xf as hq,Tzt as hr,Upr as hs,ppr as ht,dpr as hu,FA as hv,aue as hw,Lpr as hx,N_ as hy,lue as hz,Wee as i,bWe as i$,Dqt as i0,btr as i1,Dh as i2,pBt as i3,Jir as i4,rte as i5,ite as i6,ho as i7,Bi as i8,hs as i9,lm as iA,UB as iB,Hd as iC,IVt as iD,rfr as iE,afr as iF,zqt as iG,g$e as iH,Yn as iI,gAe as iJ,pXe as iK,RP as iL,Ctr as iM,i_ as iN,C$t as iO,TEe as iP,jA as iQ,MHe as iR,gn as iS,hl as iT,QAe as iU,Lpe as iV,Yqt as iW,YP as iX,DWt as iY,uHt as iZ,dZt as i_,Bst as ia,Bf as ib,bm as ic,pT as id,CWt as ie,Zst as ig,nn as ih,CUe as ii,FT as ij,i5e as ik,rWt as il,l2t as im,Air as io,v3 as ip,aW as iq,WEt as ir,Qx as is,eYe as it,SVt as iu,nfr as iv,OVt as iw,N0 as ix,vI as iy,uWt as iz,ku as j,jh as j$,hne as j0,R2 as j1,de as j2,Yi as j3,si as j4,Vf as j5,vn as j6,ut as j7,fi as j8,K$t as j9,VPt as jA,NPt as jB,FPt as jC,hm as jD,DPt as jE,dl as jF,zPt as jG,gN as jH,KB as jI,mo as jJ,pKe as jK,kPt as jL,t7 as jM,dp as jN,S2 as jO,V3 as jP,EE as jQ,dr as jR,xi as jS,$i as jT,jor as jU,edr as jV,fUt as jW,tdr as jX,Ka as jY,Ua as jZ,f3e as j_,Fe as ja,uot as jb,Av as jc,Ys as jd,Moe as je,Bor as jf,Pi as jg,dkt as jh,jge as ji,n8e as jj,o8e as jk,DOe as jl,zl as jm,_I as jn,ZI as jo,dse as jp,hAt as jq,Eb as jr,dKe as js,d_ as jt,pAe as ju,Lqt as jv,fKe as jw,UPt as jx,IPt as jy,LPt as jz,Hu as k,Wr as k$,x2 as k0,y2 as k1,Fc as k2,zP as k3,mn as k4,i5t as k5,h1t as k6,lo as k7,Bcr as k8,G0 as k9,sCe as kA,CHt as kB,kdr as kC,irt as kD,Bdr as kE,iYt as kF,Ydr as kG,Zdr as kH,Qdr as kI,epr as kJ,zdr as kK,nYt as kL,jdr as kM,qdr as kN,OYe as kO,m9t as kP,$7 as kQ,vXt as kR,yXt as kS,fde as kT,yBt as kU,Ob as kV,kg as kW,cs as kX,YFe as kY,I_ as kZ,f3 as k_,iir as ka,SOe as kb,r7 as kc,e7 as kd,mB as ke,OB as kf,Fj as kg,zr as kh,xse as ki,t3e as kj,kBt as kk,Dpr as kl,Npr as km,eae as kn,Tpr as ko,bpr as kp,Q3 as kq,mu as kr,gp as ks,Jne as kt,Bzt as ku,ar as kv,FG as kw,qA as kx,al as ky,qh as kz,dLt as l,MHt as l$,aN as l0,uN as l1,znr as l2,_te as l3,k9 as l4,Ln as l5,qd as l6,Ive as l7,aa as l8,cQt as l9,_Xt as lA,Uh as lB,CXt as lC,fwt as lD,X4e as lE,fo as lF,$f as lG,Uqt as lH,hWt as lI,Lae as lJ,v2 as lK,kb as lL,Sn as lM,DG as lN,LG as lO,tue as lP,$u as lQ,Z6t as lR,DEe as lS,Sne as lT,HHt as lU,NA as lV,TWe as lW,lB as lX,ZHt as lY,lCe as lZ,RHt as l_,je as la,g2 as lb,N as lc,uqt as ld,jVt as le,qhr as lf,y5e as lg,ws as lh,Jre as li,lHt as lj,hot as lk,oD as ll,yqt as lm,_qt as ln,hLe as lo,_Be as lp,zpr as lq,odt as lr,adt as ls,Fpr as lt,Vu as lu,vqe as lv,i4 as lw,Etr as lx,mXt as ly,gXt as lz,b_ as m,Dd as m$,xBt as m0,_Bt as m1,Sfr as m2,Dtr as m3,Ltr as m4,_qe as m5,wBt as m6,AEe as m7,vHe as m8,jqt as m9,vf as mA,Eu as mB,Use as mC,kse as mD,Na as mE,pi as mF,oe as mG,Kl as mH,fWt as mI,PKe as mJ,Foe as mK,Nb as mL,Ddr as mM,IEe as mN,__ as mO,Fu as mP,vg as mQ,jCe as mR,uB as mS,GHt as mT,p3e as mU,Ede as mV,M3e as mW,wdr as mX,KUt as mY,yI as mZ,gtt as m_,Zhr as ma,hL as mb,HXt as mc,b9t as md,EVe as me,N9t as mf,MVe as mg,jUt as mh,A_ as mi,xRe as mj,Ast as mk,Ec as ml,YXe as mm,IL as mn,Bft as mo,Mut as mp,gqt as mq,FWt as mr,UWt as ms,kWt as mt,lp as mu,Ag as mv,QL as mw,Dor as mx,J3e as my,iw as mz,kT as n,EFe as n$,Ye as n0,mr as n1,$qt as n2,vB as n3,Jqt as n4,l_ as n5,A3e as n6,$P as n7,yy as n8,vb as n9,zSt as nA,qor as nB,_Re as nC,uA as nD,Yor as nE,Wor as nF,B0 as nG,b$t as nH,v7 as nI,qqt as nJ,Hqt as nK,AZt as nL,$Zt as nM,oQt as nN,Qme as nO,Zme as nP,cg as nQ,Ior as nR,Lor as nS,AIe as nT,hpr as nU,Ftr as nV,G0e as nW,Utr as nX,Mtr as nY,PFe as nZ,OFe as n_,qHt as na,QN as nb,jre as nc,nCe as nd,wXe as ne,fXt as nf,tc as ng,mP as nh,BUt as ni,et as nj,VQe as nk,DB as nl,rQe as nm,Fg as nn,fn as no,IOe as np,Ptt as nq,sne as nr,RQe as ns,WHt as nt,HT as nu,xYt as nv,ca as nw,CG as nx,Wz as ny,P$t as nz,lpe as o,Vft as o$,hI as o0,n6 as o1,H0e as o2,Vwt as o3,_tr as o4,UPe as o5,Xqt as o6,xPe as o7,Bqt as o8,_Xe as o9,fG as oA,I9 as oB,sqt as oC,tfr as oD,iB as oE,THt as oF,pD as oG,tr as oH,zL as oI,Pb as oJ,ber as oK,ODe as oL,fe as oM,vfr as oN,yvt as oO,y$e as oP,uu as oQ,sQe as oR,GL as oS,jv as oT,zst as oU,xVt as oV,nT as oW,nl as oX,ADe as oY,Dg as oZ,RVt as o_,EXe as oa,Une as ob,wqt as oc,Ske as od,XSt as oe,rB as of,HB as og,Xl as oh,XE as oi,$Bt as oj,FBe as ok,Uht as ol,TBt as om,CBt as on,E5e as oo,ule as op,Upt as oq,Z6e as or,ZCe as os,IRe as ot,Kee as ou,csr as ov,KT as ow,Jst as ox,yfr as oy,zer as oz,up as p,dV as p$,ame as p0,iUe as p1,ifr as p2,spe as p3,Vhr as p4,tIt as p5,mbe as p6,g9t as p7,uHe as p8,PEe as p9,eO as pA,gfr as pB,ir as pC,NFe as pD,FFe as pE,Eer as pF,mfr as pG,ofr as pH,H0 as pI,da as pJ,bnr as pK,PZt as pL,rae as pM,CZt as pN,Sf as pO,wbe as pP,Enr as pQ,xnr as pR,Snr as pS,Tnr as pT,kte as pU,Vp as pV,hV as pW,Qa as pX,gnr as pY,dlr as pZ,qle as p_,one as pa,QHt as pb,Ru as pc,Tse as pd,UEe as pe,mHe as pf,Iqt as pg,_me as ph,zor as pi,ffr as pj,ufr as pk,hfr as pl,lfr as pm,jF as pn,eke as po,Ju as pp,bVt as pq,iQe as pr,_fr as ps,wVt as pt,zWt as pu,sQt as pv,Yg as pw,HP as px,Kr as py,pn as pz,Ql as q,DHt as q$,fnr as q0,ynr as q1,C6e as q2,mnr as q3,gu as q4,vu as q5,qP as q6,Vte as q7,Ute as q8,Bte as q9,CAe as qA,yWt as qB,_Wt as qC,vtt as qD,UAt as qE,SM as qF,F7 as qG,PN as qH,k7 as qI,TN as qJ,E6e as qK,But as qL,hnr as qM,eOe as qN,QMt as qO,iwt as qP,twt as qQ,QKe as qR,otr as qS,str as qT,f_ as qU,Btr as qV,Uo as qW,Da as qX,Qor as qY,Ile as qZ,pa as q_,zte as qa,vnr as qb,FTt as qc,wnr as qd,Kre as qe,g2t as qf,dir as qg,xbe as qh,$b as qi,vAe as qj,vo as qk,gOe as ql,NB as qm,use as qn,YT as qo,utt as qp,js as qq,pOe as qr,Yr as qs,x_ as qt,zB as qu,ua as qv,dN as qw,Ci as qx,bI as qy,BB as qz,Ms as r,ti as r$,kf as r0,Ch as r1,Ok as r2,Otr as r3,Fpe as r4,wt as r5,xtr as r6,Fvt as r7,N7 as r8,M2 as r9,_z as rA,bB as rB,Rht as rC,PIe as rD,sy as rE,EZt as rF,lT as rG,ui as rH,Ot as rI,Mr as rJ,ED as rK,ilr as rL,plr as rM,qIt as rN,LS as rO,Tbe as rP,olr as rQ,rlr as rR,slr as rS,IS as rT,elr as rU,Yar as rV,kW as rW,WIt as rX,ey as rY,Kt as rZ,Qir as r_,KMt as ra,ole as rb,ls as rc,CPe as rd,mRt as re,eLt as rf,sdt as rg,L0 as rh,AXe as ri,cqt as rj,gO as rk,DUt as rl,NUt as rm,OVe as rn,Mnr as ro,Qwt as rp,Rnr as rq,kFe as rr,CV as rs,kHt as rt,TVe as ru,cL as rv,Yf as rw,jP as rx,_Ze as ry,kB as rz,IB as s,_ft as s$,Lr as s0,fp as s1,enr as s2,Mqt as s3,eFe as s4,kd as s5,Kir as s6,Ee as s7,LLt as s8,DLt as s9,cy as sA,idr as sB,nme as sC,Inr as sD,Onr as sE,joe as sF,Iut as sG,Lut as sH,TUt as sI,khr as sJ,DZ as sK,ttt as sL,jWt as sM,mqt as sN,Rdt as sO,dqt as sP,hqt as sQ,wn as sR,Gu as sS,evt as sT,eQe as sU,OZt as sV,Jme as sW,bSt as sX,cp as sY,H7 as sZ,z3 as s_,u6 as sa,gz as sb,VCe as sc,vqt as sd,kht as se,Hqe as sf,Sut as sg,yYt as sh,pBe as si,iy as sj,OYt as sk,AYt as sl,pat as sm,t4 as sn,dat as so,Boe as sp,nU as sq,Anr as sr,XV as ss,Cut as st,X6t as su,Eut as sv,i9 as sw,s9 as sx,lD as sy,hHt as sz,Sar as t,Wir as t$,RJt as t0,OJt as t1,MJt as t2,PWt as t3,T$t as t4,pXt as t5,cb as t6,E$t as t7,Q4e as t8,sb as t9,q3t as tA,a2 as tB,Fh as tC,zne as tD,jne as tE,nnr as tF,snr as tG,Nf as tH,b6e as tI,OEt as tJ,y6e as tK,GEt as tL,$1 as tM,jle as tN,Gle as tO,qir as tP,Cnr as tQ,_Et as tR,v2t as tS,eo as tT,PB as tU,Zd as tV,Gg as tW,rnr as tX,SEt as tY,_nr as tZ,Yir as t_,ml as ta,wtt as tb,vWt as tc,pWt as td,vz as te,u_ as tf,NKe as tg,JPe as th,Hst as ti,ap as tj,Lz as tk,LP as tl,rl as tm,kst as tn,Soe as to,Pqt as tp,tWt as tq,ytt as tr,TKe as ts,Db as tt,Prt as tu,EP as tv,Hnr as tw,lne as tx,nZt as ty,tN as tz,Me as u,gy as u$,kr as u0,_t as u1,Ks as u2,Zkt as u3,sHt as u4,iHt as u5,vEt as u6,Oir as u7,onr as u8,anr as u9,q6 as uA,Rdr as uB,Mdr as uC,Fht as uD,Fr as uE,Uu as uF,$c as uG,T as uH,Wn as uI,Yu as uJ,ft as uK,Ie as uL,G as uM,Ty as uN,vt as uO,Vr as uP,qu as uQ,H as uR,Zr as uS,Br as uT,Bt as uU,$_ as uV,j7 as uW,yw as uX,Wu as uY,oG as uZ,rr as u_,Xir as ua,Zir as ub,NHt as uc,z_e as ud,tnr as ue,CEt as uf,hIe as ug,svt as uh,gvt as ui,det as uj,QT as uk,pEt as ul,gwt as um,ztr as un,Rq as uo,$q as up,kne as uq,Ewt as ur,inr as us,$1e as ut,fzt as uu,rBt as uv,aBt as uw,vBt as ux,Ntr as uy,Urt as uz,BI as v,sUe as v$,Yb as v0,_w as v1,cG as v2,Zl as v3,ace as v4,W0 as v5,tmt as v6,aG as v7,hPt as v8,hae as v9,dfr as vA,pfr as vB,Tte as vC,lLe as vD,MR as vE,EAe as vF,mWt as vG,Cn as vH,$dt as vI,Rb as vJ,gWt as vK,dWt as vL,WKe as vM,U3 as vN,Or as vO,ya as vP,fw as vQ,dD as vR,QK as vS,Rqt as vT,fqt as vU,pqt as vV,st as vW,_er as vX,bse as vY,Fqt as vZ,AWt as v_,cO as va,ZB as vb,ser as vc,Jae as vd,$Wt as ve,het as vf,Rz as vg,Li as vh,NWt as vi,oer as vj,GDe as vk,_n as vl,N5e as vm,ci as vn,Vh as vo,r2 as vp,W7 as vq,bp as vr,gw as vs,Nr as vt,dNe as vu,DAe as vv,wse as vw,wm as vx,kor as vy,Oor as vz,fne as w,Mu as w$,_y as w0,Rse as w1,lOe as w2,mm as w3,hA as w4,zt as w5,sa as w6,Bh as w7,lG as w8,mw as w9,Wge as wA,lQt as wB,E2 as wC,kQt as wD,qZe as wE,Ptr as wF,Wqt as wG,aHt as wH,Rlr as wI,Gqt as wJ,Atr as wK,wu as wL,SHt as wM,zUt as wN,gl as wO,sbt as wP,mh as wQ,xm as wR,Sy as wS,Mi as wT,q0 as wU,py as wV,at as wW,Tdr as wX,_2 as wY,dy as wZ,mG as w_,LH as wa,b4e as wb,ln as wc,$4e as wd,Qae as we,IWt as wf,yse as wg,us as wh,RZt as wi,uD as wj,MZt as wk,jc as wl,YL as wm,goe as wn,UP as wo,kqt as wp,Hyt as wq,yoe as wr,K3e as ws,kP as wt,_Ae as wu,$st as wv,p_ as ww,b7 as wx,GQe as wy,EKe as wz,ri as x,cNe as x0,EWt as x1,o1t as x2,Wh as x3,jKe as x4,hSt as x5,dSt as x6,yA as x7,mee as x8,Rle as x9,VWt as xa,GWt as xb,JWt as xc,Htr as xd,asr as xe,m as y,jo as z};
